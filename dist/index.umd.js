(function(Ro,Ei){typeof exports=="object"&&typeof module<"u"?Ei(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],Ei):(Ro=typeof globalThis<"u"?globalThis:Ro||self,Ei(Ro.PlayerMap={},Ro.React))})(this,function(Ro,Ei){"use strict";var Ow={exports:{}},E0={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DN;function fG(){if(DN)return E0;DN=1;var r=Ei,e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(u,c,d){var p,f={},m=null,g=null;d!==void 0&&(m=""+d),c.key!==void 0&&(m=""+c.key),c.ref!==void 0&&(g=c.ref);for(p in c)n.call(c,p)&&!o.hasOwnProperty(p)&&(f[p]=c[p]);if(u&&u.defaultProps)for(p in c=u.defaultProps,c)f[p]===void 0&&(f[p]=c[p]);return{$$typeof:e,type:u,key:m,ref:g,props:f,_owner:s.current}}return E0.Fragment=i,E0.jsx=l,E0.jsxs=l,E0}var w0={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ON;function mG(){return ON||(ON=1,process.env.NODE_ENV!=="production"&&function(){var r=Ei,e=Symbol.for("react.element"),i=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.offscreen"),y=Symbol.iterator,x="@@iterator";function v(me){if(me===null||typeof me!="object")return null;var ct=y&&me[y]||me[x];return typeof ct=="function"?ct:null}var _=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function T(me){{for(var ct=arguments.length,St=new Array(ct>1?ct-1:0),Xt=1;Xt<ct;Xt++)St[Xt-1]=arguments[Xt];w("error",me,St)}}function w(me,ct,St){{var Xt=_.ReactDebugCurrentFrame,Ii=Xt.getStackAddendum();Ii!==""&&(ct+="%s",St=St.concat([Ii]));var sr=St.map(function(Ni){return String(Ni)});sr.unshift("Warning: "+ct),Function.prototype.apply.call(console[me],console,sr)}}var S=!1,R=!1,B=!1,I=!1,D=!1,L;L=Symbol.for("react.module.reference");function O(me){return!!(typeof me=="string"||typeof me=="function"||me===n||me===o||D||me===s||me===d||me===p||I||me===g||S||R||B||typeof me=="object"&&me!==null&&(me.$$typeof===m||me.$$typeof===f||me.$$typeof===l||me.$$typeof===u||me.$$typeof===c||me.$$typeof===L||me.getModuleId!==void 0))}function U(me,ct,St){var Xt=me.displayName;if(Xt)return Xt;var Ii=ct.displayName||ct.name||"";return Ii!==""?St+"("+Ii+")":St}function J(me){return me.displayName||"Context"}function H(me){if(me==null)return null;if(typeof me.tag=="number"&&T("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof me=="function")return me.displayName||me.name||null;if(typeof me=="string")return me;switch(me){case n:return"Fragment";case i:return"Portal";case o:return"Profiler";case s:return"StrictMode";case d:return"Suspense";case p:return"SuspenseList"}if(typeof me=="object")switch(me.$$typeof){case u:var ct=me;return J(ct)+".Consumer";case l:var St=me;return J(St._context)+".Provider";case c:return U(me,me.render,"ForwardRef");case f:var Xt=me.displayName||null;return Xt!==null?Xt:H(me.type)||"Memo";case m:{var Ii=me,sr=Ii._payload,Ni=Ii._init;try{return H(Ni(sr))}catch{return null}}}return null}var V=Object.assign,$=0,Q,G,j,ie,Y,ae,xe;function fe(){}fe.__reactDisabledLog=!0;function de(){{if($===0){Q=console.log,G=console.info,j=console.warn,ie=console.error,Y=console.group,ae=console.groupCollapsed,xe=console.groupEnd;var me={configurable:!0,enumerable:!0,value:fe,writable:!0};Object.defineProperties(console,{info:me,log:me,warn:me,error:me,group:me,groupCollapsed:me,groupEnd:me})}$++}}function Ie(){{if($--,$===0){var me={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:V({},me,{value:Q}),info:V({},me,{value:G}),warn:V({},me,{value:j}),error:V({},me,{value:ie}),group:V({},me,{value:Y}),groupCollapsed:V({},me,{value:ae}),groupEnd:V({},me,{value:xe})})}$<0&&T("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Ge=_.ReactCurrentDispatcher,Xe;function $e(me,ct,St){{if(Xe===void 0)try{throw Error()}catch(Ii){var Xt=Ii.stack.trim().match(/\n( *(at )?)/);Xe=Xt&&Xt[1]||""}return`
`+Xe+me}}var lt=!1,At;{var Gt=typeof WeakMap=="function"?WeakMap:Map;At=new Gt}function gt(me,ct){if(!me||lt)return"";{var St=At.get(me);if(St!==void 0)return St}var Xt;lt=!0;var Ii=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var sr;sr=Ge.current,Ge.current=null,de();try{if(ct){var Ni=function(){throw Error()};if(Object.defineProperty(Ni.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ni,[])}catch(ot){Xt=ot}Reflect.construct(me,[],Ni)}else{try{Ni.call()}catch(ot){Xt=ot}me.call(Ni.prototype)}}else{try{throw Error()}catch(ot){Xt=ot}me()}}catch(ot){if(ot&&Xt&&typeof ot.stack=="string"){for(var Oi=ot.stack.split(`
`),Be=Xt.stack.split(`
`),se=Oi.length-1,ge=Be.length-1;se>=1&&ge>=0&&Oi[se]!==Be[ge];)ge--;for(;se>=1&&ge>=0;se--,ge--)if(Oi[se]!==Be[ge]){if(se!==1||ge!==1)do if(se--,ge--,ge<0||Oi[se]!==Be[ge]){var Ne=`
`+Oi[se].replace(" at new "," at ");return me.displayName&&Ne.includes("<anonymous>")&&(Ne=Ne.replace("<anonymous>",me.displayName)),typeof me=="function"&&At.set(me,Ne),Ne}while(se>=1&&ge>=0);break}}}finally{lt=!1,Ge.current=sr,Ie(),Error.prepareStackTrace=Ii}var ke=me?me.displayName||me.name:"",Ke=ke?$e(ke):"";return typeof me=="function"&&At.set(me,Ke),Ke}function yi(me,ct,St){return gt(me,!1)}function Ze(me){var ct=me.prototype;return!!(ct&&ct.isReactComponent)}function ki(me,ct,St){if(me==null)return"";if(typeof me=="function")return gt(me,Ze(me));if(typeof me=="string")return $e(me);switch(me){case d:return $e("Suspense");case p:return $e("SuspenseList")}if(typeof me=="object")switch(me.$$typeof){case c:return yi(me.render);case f:return ki(me.type,ct,St);case m:{var Xt=me,Ii=Xt._payload,sr=Xt._init;try{return ki(sr(Ii),ct,St)}catch{}}}return""}var hi=Object.prototype.hasOwnProperty,Ri={},Si=_.ReactDebugCurrentFrame;function tr(me){if(me){var ct=me._owner,St=ki(me.type,me._source,ct?ct.type:null);Si.setExtraStackFrame(St)}else Si.setExtraStackFrame(null)}function Vi(me,ct,St,Xt,Ii){{var sr=Function.call.bind(hi);for(var Ni in me)if(sr(me,Ni)){var Oi=void 0;try{if(typeof me[Ni]!="function"){var Be=Error((Xt||"React class")+": "+St+" type `"+Ni+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof me[Ni]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Be.name="Invariant Violation",Be}Oi=me[Ni](ct,Ni,Xt,St,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(se){Oi=se}Oi&&!(Oi instanceof Error)&&(tr(Ii),T("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Xt||"React class",St,Ni,typeof Oi),tr(null)),Oi instanceof Error&&!(Oi.message in Ri)&&(Ri[Oi.message]=!0,tr(Ii),T("Failed %s type: %s",St,Oi.message),tr(null))}}}var Qe=Array.isArray;function Ce(me){return Qe(me)}function yt(me){{var ct=typeof Symbol=="function"&&Symbol.toStringTag,St=ct&&me[Symbol.toStringTag]||me.constructor.name||"Object";return St}}function Ot(me){try{return Jt(me),!1}catch{return!0}}function Jt(me){return""+me}function zt(me){if(Ot(me))return T("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",yt(me)),Jt(me)}var xi=_.ReactCurrentOwner,vt={key:!0,ref:!0,__self:!0,__source:!0},ye,ve;function Le(me){if(hi.call(me,"ref")){var ct=Object.getOwnPropertyDescriptor(me,"ref").get;if(ct&&ct.isReactWarning)return!1}return me.ref!==void 0}function Te(me){if(hi.call(me,"key")){var ct=Object.getOwnPropertyDescriptor(me,"key").get;if(ct&&ct.isReactWarning)return!1}return me.key!==void 0}function Fe(me,ct){typeof me.ref=="string"&&xi.current}function Pe(me,ct){{var St=function(){ye||(ye=!0,T("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};St.isReactWarning=!0,Object.defineProperty(me,"key",{get:St,configurable:!0})}}function k(me,ct){{var St=function(){ve||(ve=!0,T("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};St.isReactWarning=!0,Object.defineProperty(me,"ref",{get:St,configurable:!0})}}var Z=function(me,ct,St,Xt,Ii,sr,Ni){var Oi={$$typeof:e,type:me,key:ct,ref:St,props:Ni,_owner:sr};return Oi._store={},Object.defineProperty(Oi._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(Oi,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Xt}),Object.defineProperty(Oi,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Ii}),Object.freeze&&(Object.freeze(Oi.props),Object.freeze(Oi)),Oi};function re(me,ct,St,Xt,Ii){{var sr,Ni={},Oi=null,Be=null;St!==void 0&&(zt(St),Oi=""+St),Te(ct)&&(zt(ct.key),Oi=""+ct.key),Le(ct)&&(Be=ct.ref,Fe(ct,Ii));for(sr in ct)hi.call(ct,sr)&&!vt.hasOwnProperty(sr)&&(Ni[sr]=ct[sr]);if(me&&me.defaultProps){var se=me.defaultProps;for(sr in se)Ni[sr]===void 0&&(Ni[sr]=se[sr])}if(Oi||Be){var ge=typeof me=="function"?me.displayName||me.name||"Unknown":me;Oi&&Pe(Ni,ge),Be&&k(Ni,ge)}return Z(me,Oi,Be,Ii,Xt,xi.current,Ni)}}var Re=_.ReactCurrentOwner,ce=_.ReactDebugCurrentFrame;function Ue(me){if(me){var ct=me._owner,St=ki(me.type,me._source,ct?ct.type:null);ce.setExtraStackFrame(St)}else ce.setExtraStackFrame(null)}var je;je=!1;function dt(me){return typeof me=="object"&&me!==null&&me.$$typeof===e}function Bt(){{if(Re.current){var me=H(Re.current.type);if(me)return`

Check the render method of \``+me+"`."}return""}}function bt(me){return""}var Ut={};function di(me){{var ct=Bt();if(!ct){var St=typeof me=="string"?me:me.displayName||me.name;St&&(ct=`

Check the top-level render call using <`+St+">.")}return ct}}function br(me,ct){{if(!me._store||me._store.validated||me.key!=null)return;me._store.validated=!0;var St=di(ct);if(Ut[St])return;Ut[St]=!0;var Xt="";me&&me._owner&&me._owner!==Re.current&&(Xt=" It was passed a child from "+H(me._owner.type)+"."),Ue(me),T('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',St,Xt),Ue(null)}}function Pi(me,ct){{if(typeof me!="object")return;if(Ce(me))for(var St=0;St<me.length;St++){var Xt=me[St];dt(Xt)&&br(Xt,ct)}else if(dt(me))me._store&&(me._store.validated=!0);else if(me){var Ii=v(me);if(typeof Ii=="function"&&Ii!==me.entries)for(var sr=Ii.call(me),Ni;!(Ni=sr.next()).done;)dt(Ni.value)&&br(Ni.value,ct)}}}function fn(me){{var ct=me.type;if(ct==null||typeof ct=="string")return;var St;if(typeof ct=="function")St=ct.propTypes;else if(typeof ct=="object"&&(ct.$$typeof===c||ct.$$typeof===f))St=ct.propTypes;else return;if(St){var Xt=H(ct);Vi(St,me.props,"prop",Xt,me)}else if(ct.PropTypes!==void 0&&!je){je=!0;var Ii=H(ct);T("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Ii||"Unknown")}typeof ct.getDefaultProps=="function"&&!ct.getDefaultProps.isReactClassApproved&&T("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Pr(me){{for(var ct=Object.keys(me.props),St=0;St<ct.length;St++){var Xt=ct[St];if(Xt!=="children"&&Xt!=="key"){Ue(me),T("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Xt),Ue(null);break}}me.ref!==null&&(Ue(me),T("Invalid attribute `ref` supplied to `React.Fragment`."),Ue(null))}}var tn={};function gs(me,ct,St,Xt,Ii,sr){{var Ni=O(me);if(!Ni){var Oi="";(me===void 0||typeof me=="object"&&me!==null&&Object.keys(me).length===0)&&(Oi+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Be=bt();Be?Oi+=Be:Oi+=Bt();var se;me===null?se="null":Ce(me)?se="array":me!==void 0&&me.$$typeof===e?(se="<"+(H(me.type)||"Unknown")+" />",Oi=" Did you accidentally export a JSX literal instead of a component?"):se=typeof me,T("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",se,Oi)}var ge=re(me,ct,St,Ii,sr);if(ge==null)return ge;if(Ni){var Ne=ct.children;if(Ne!==void 0)if(Xt)if(Ce(Ne)){for(var ke=0;ke<Ne.length;ke++)Pi(Ne[ke],me);Object.freeze&&Object.freeze(Ne)}else T("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Pi(Ne,me)}if(hi.call(ct,"key")){var Ke=H(me),ot=Object.keys(ct).filter(function(Kt){return Kt!=="key"}),wt=ot.length>0?"{key: someKey, "+ot.join(": ..., ")+": ...}":"{key: someKey}";if(!tn[Ke+wt]){var qt=ot.length>0?"{"+ot.join(": ..., ")+": ...}":"{}";T(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,wt,Ke,qt,Ke),tn[Ke+wt]=!0}}return me===n?Pr(ge):fn(ge),ge}}function mn(me,ct,St){return gs(me,ct,St,!0)}function Rs(me,ct,St){return gs(me,ct,St,!1)}var $n=Rs,As=mn;w0.Fragment=n,w0.jsx=$n,w0.jsxs=As}()),w0}process.env.NODE_ENV==="production"?Ow.exports=fG():Ow.exports=mG();var Mt=Ow.exports;const Pw="data:image/svg+xml,%3csvg%20width='300'%20height='50'%20viewBox='0%200%20500%2084'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3crect%20width='500'%20height='84'%20fill='url(%23pattern0_10_2)'/%3e%3cdefs%3e%3cpattern%20id='pattern0_10_2'%20patternContentUnits='objectBoundingBox'%20width='1'%20height='1'%3e%3cuse%20xlink:href='%23image0_10_2'%20transform='scale(0.002%200.0119048)'/%3e%3c/pattern%3e%3cimage%20id='image0_10_2'%20width='500'%20height='84'%20preserveAspectRatio='none'%20xlink:href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAABUCAYAAAB0vcXQAAAAAXNSR0IArs4c6QAAIABJREFUeF7tXQeYJFW5vfdWro4zw2wgioCoJEUMwDOsGEAFFR/6RFEREAH1IUpQQaIEFcWEiiAGVIKib0URFFBEfQbQJ+CCgODCssvuhE5VXfm+PjVVQ01vz0x3T/eE3arvQ2S6wr3/Def+6fyULPC1YcOGjKZpewiC8JwgCPZkjD07CIIVlNICISRPCMG/JUJImVJa4ZzXov//YBAED3iet0bTtPtVVX2MUore8AXuUvr5VAKpBFIJpBJYaAkADjpGg64eWuieTn4/RMD5vsrl8m6CILyRc/56wsl/EEoEQkhXbclms8S2beL7/oZ6vf6rTCbzy2q1euuyZcs2RO/seEh7Io+lPS96IoIt9SWLeWgXc9u21PmwNPqVzoylMU5za2VXINrNJyuVyrMppScSQt5KCFk+zTtcQsjDhJDHCSElQgg08rLImOdzDk09RwjJEkKWEUKeTQgZEASBQDN3HIcwxggAvlarBZIk/da27Svuv//+H++///4WpXRhgL0bYaXPpBJIJZBKIJVAKoEOJdBXQOecy4Zh/GcQBO8jhLxcEAROOKEBD2LT+AOc819QSv9IKV2TyWTWUEoB6m1d1Wp1med5z1UUZR/XdV8tCMIrGGMZ3/eJ53kEYC8IwngQBN+2bfvr22yzDb5HU3BvS7zpTakEUgmkEghNp6k2tDQmQl8AnXPODMN4G2PsfELILgBYzAhBFIDkd/i+f4PnebcMDAw81ksxcc4Vy7IO9DzvMELIkZIkDQdBwD3PA4jjoHC14zjnDw0NPbFVA3u6Qns57dJ3TfFttTe52rsrFW1/JJBKvz9yXfi39hzQa7XaqznnFxPC9+WchOZwTdVGOeFXm6Z5RaFQeKhVtzdt2pTLZDLPIYQ8k3P+TELIDoQQJTKzi5xzh1I6TiktE0I2BEHwD8YYAuIeb6VxP/TQQ8qKFSveFATBcYyxgxhjOGTSIAjqlmV9yXXdc1euXFlPtfWFn4RpCxa/BBYvBCzels06qku46bP2Lb1hQSTQM0Avl8uDjLEvEkLeEVloKOd8I6X0vGw2eyUhBIA8abnZuHFjVtO0QxhjLyOEHEgI2ZsQwjoNjvN9v+L7/p2MsdsEQbgtm83e26x912q1vSilnyKEHCpJEszx9+i6/oI77rhDXLVqlTdXyafrcq4STJ9PJZBKIJVAKoG5SqAngF6r1V7LOb8qCILt0CDGWKWhWV+azWY/Rwg3KA21YwKfer1eP6yRavY2SunrCCE6Atmmv0KletqfgyD0xYe+crwn8p0/LEkSDhDf13X98SS4V6vVV8iyfKrrul/MZrO3wDVAKZ14SXqlEkglsMQkkB6ll9iApc3tswTmBOgAaNu2P+e67kmKohDDMACs/2NZ1vHLli2Ddh4C+djYWIEx9n7G2AcppTHo96RrUe755Ls47PwTl885/7nv+58qFAp/BLAzSjlv2gOq1eqwIAhfC4IAloT/26p96z0ZkS3kJYsSKxa4UQvw+QX45BYygdNubI0S6BrQOecF0zSv9X3/YKSMqapq+L5/WqFQuDwGRZDGKIpyKmX0I5TQDCLTAMAza+WdDcNmgB7AcT/lHdDAb23cd46u6yGwxwcNBNHZtn1BEAQfJYSMEkJO0nX9ulRz72wM0rtTCcwsgRSW0xmSSmA+JNAVoI+Pjz+DMXaTJEl7oJGyJP/JcZ0jdF1fi/8GaG7cuPFwxtjndF3fMdmRGTTqrvrb7vtgWuecX+O67smFQqEEUOecC7Ztn8A5/1Kk2duO45xXLBYvxG+UUr+rRs36ULrBzSqi9IYF5UXa8sW/BNbgEmjilj9PllYP2wP0xMSqVqugab0d5C6+73NBEG7UNO2dlFIbWL5hw4Zl+Xz+SsbYoa7rclEUN/tGwiwO8J9RYhGoIvCtEGnOUzT8DgA9/A6ldF2DrObDuq7fEGvrlmW9LgiC6wkhGdd1EST3tUKh8MFegXq6LpfWokhbm0oglUAqgaUogfYAPepZvV7fyfO83wmCAD84kPhyTdM+FAeWIWXN87zvSpIEJrfQvN58wdwOf3u1WiW5XA6sbrgFh4E/U0p/Rwj5P9/3/8UYezSXy21MPj86OpoXBGFIFMXdGWNIcXs+53wVIWT7yIwOtXvGcdA0jZTLZV/TtKtWr1594hFHHAEbfLBx48bnZbPZnzRy1XdCRH6Dhe4Luq6f1itQX4qTI21zswTSo1k6J1IJpBJYvBJoG9BHRka203X9TkrpMwOwtXB+Rjab/UxsYq9Wqx9paLifCdngpglNjwEeLG6O4xiiKK5uAPN1uVzuFkqp1Y2YoGU7jrN7EARv5py/mxCye5w2F78vBnlExeP/4x+krzmO8wdZlo/QNO1JHAg2bNiwcz6f/xVy4aM0u0s1Tft4CurdjEz6TCqBVAKpBFIJzKcE2gJ05Jjruv5by7KeyzkPBEH4VCaT+WQE5uKGDRs+VywWEcHOgyCY7Z3ws3++Xq9/c2hoqNpLVkGAe71eP4Axdirn/I0T7vwwrn3StA8gB7BblkWgrQtUeNxyrNcjfx33VSqV3ZHPTgjZjlJaJ4Scoev6F1NQn2ZapkrrfK7X9FupBFIJpBKYVgKzgS+AkNm2/UPHcd4MwBYE4Yu6rp8cgaRcq9WuURTlCPjLZyGFGSGEfELX9asIIUG/Gdocx3keUtE454fiEIJ+oM2u64bsdbIsh8Cuqiqqta13HOcNxWLxHtyDOAEQ1QRBsFwQhDHP896Yz+fv6k30e6cIGN3f6WPppE8lMC8SSCfmvIg5ZVSfHzEv8a/MCOjQbqvV6oc555dCyaWM3pjP5f8TfQbL2gEHHHBlEAQwc4eacNJ/DV85gNO2bT+fz39t7dq1Z+24445hdPl8yQxtMk3zjZTSLxNCto0APfTtx4CONkeuAJRbfaOu63/CfeVy+SXw6cuyjAPNg47jvHCbbbYxQjnMYx/mS1bpd7ZGCfQKjHv1nq1xDNI+b7kSmP91MSOgR6D2W865SAh5NAiCfQcGBkrQVGu12qWe552squqkZh4DOv4d5Zo/6TjOewuFAljZFqzKWalUGpAk6TJK6btgHYgoZjebR5zzfzuO8woUjYGJ3TTNoxtEON/ww+oy5Ke5XA5+epFSOme62C13Eqc9SyWQSiCVwGYSCNENezFjDKWv4drcidKQnwRlsaEQViilcMM+Rjh/SNW0+yilYdR0erUngWkBnXOeaZQ+vS8IgmegoIkkSQdmMpm/ApgrlcpJmqZ9SZIkblnWlHfAhA2zdr1e/61hGIevXLlydDFotADoer2OeuyXRaLZjHMWB5Eg8P9qGOZLV6xYYYBvXlXVy2VZPooQUmtYG84qFAqXzbc/vdNzHudcN03zlYj+B2Ne5AoJXxMVtMEhbU60t/fdd5+84447vkiW5X0453bDvcFAwYsrNNdQqvi+/0Qmk/lJ94e5mXsev9c0zR0YY6+PDl7hQ4IgiEEQoJDPbyMK4Fn7G7+vUqlgwwE1MZ4X4n61t6R6ehcOy4wxhnKBd6mq+uBs43bOOeewc845JxgdHd1eUZSXc87zeD6ymIXvqtfrvykUCg/P9q5OehLLrlarreCcv5wxNgQPVyKZXhIE4Zeqqj7U5XfDcUX/zjjjjNfatr1rIzDXUlUVQAAXXoYx9ntZlv88e7spmXgk5KLI1uv1VzPGtvN9H9k2s7ohZ39/d3f4vo9GyaIoPqiq6u/aDRSO5Wnb9uGc822xHqPOId5JHR0d/eOKFSvu6R+vRuv+xnOxVqs9jzH2XyhxTSndBwuqVQZU01swNmD7vJtzfhvn/Lv5fP6B7iTb/VOJef0aSukzpnsTCodpmnZjv2UMZlPG2JswT5P7EmLCKKU/bDl50YlarXYeIeTMaHP+YC6X+wo6MzIy8iJFUe4KgkDM5XIUL8KFAUL0OnLTGWM/yuVy72wuyNK9WHv3pGVZr25YGlaDD6dZU58A9AB9+Vk2m30DvooNShTFO0VB3K1m1NbWarV9t9tuu/HFaHpPbqqMse8TQpDSB0CfQNqJcbpC07TjQdtLKUV6XkdX/A0ARaVSuViWZRDzuJxzKcEAGFptMMkrlcopy5Yt+9Zf/vIXab/99tus1n2nh5VkY+ODlWVZB3POb/Y8zxcEgWEOSpLEgiBYyxh7n6qqsBDNalmJi/VUKpVjRFG8EhtjVPEvdst0JKse3Bxbv1AV8ERN074FOUelgFu+Pu5nuVx+ra7rV3qeh0NdXK+Acc7rmqYdSyn9/nRj0k27E7I7kFJ6FWMM2SaYezg4A6iEIAiOymaz17QzFhO4+rR3Lp53aPNuu+22WlXVgz3P83Bwi9JM5Qbz40Wapn3i6TPl9O69GATr9fozOOc3CIKwH+ZPEARCksmyDeDpRlyTzzS5KXFwE13Xva7BXIk9d1M7h+F4LVuWdTeldN84Zgjr0nVdKZvNXvjkk09esMMOO9Tbed+cOjQhfHbDDTeIr3zlK4+UZRnxVnvLskxh6OxEnvF+HGctNep//Mn3/cvy+fwPZ1oDc21/qz2mWq3eyBhDHFkr7pTY6ntoJpO5aWKj7WW499MtMgzjhZyQ/6UTB/1QnpATlGjP8/ZpCejlcnk3Qsh9jYkgG4bxx3w+/xK8EuYSURTv4ZyDKW4SyOPPAfwJId/KZDLvnY+JM+1paRZZ1uv1l4LnHcVhpgF1qwF2H89ms5/H0NRqtYMymcwvy+WyA6DM5/NHt7cp9XJqzf6uhQD0fD5/Qr1edz3Pk0RRTC7YcJIHQfBX0zTfMDw8/GSXmtm0HY8BfXR09OBMJnOz67q+KIoMAZqqquLfay3Let/Q0FBHgF6v148RBAFgOAnos0u/L3fMCdBxKGn0Y3ts8FHrmOd59SAIji0UCn0F9Gw2u3u9XofRBBtPoOu6UKlUjioUCm0C+lR5JgF9r732Wi3L8sGWZXlQLHAw1TRNrlarF+Xz+Y4B3XXdGxob8X6I9/F9fzNA79PeHHYwCeiiKIaAXq/XrzNN84MrV67sCNBN07y7kQocAjrk7vu+m81mpWq1emG5XO47oCcOSdj/z0EJ7BiUY/DpdJUkQD0Ul67riIt6pGFN+ditt95641vf+tY+sXlOtDTeYwDogiC8eYb2Y61uaGjpe1NKEQDelwuATgDolIYAHAM6Dkuu624O6BgU0zRvcl33kIaGDl/x/sVi8S9YUIZhXNXwMx8dmW6nHAaik9f/aJoWdnoxmNlnkqhpmijZ+uvoLDWpwSYmEEhtXpHL5dagVjui83VdPyIIgk2lUumNQ0NDf+gYoPq5M0SUu5A7rArTaegNk9wVmUymJxp6uVy+uFAonGCaZgjoSAlsxdzXcNt8K5vN4hA0o3bZ6QpIAno2m70ZG3IUxMgzeobZjt01oEuidKXjOimgtzkosYY+NjZ2oCRJV80HoNfrdS86WHcN6KCxFgThhmw2u59lWf6E0j+5HXSkUbYpqim3NQO6wATRsq3rqtVqx4BuGMbdqqzs6wV+4HleCOi5XK7vgB7vgxs2bNgTAdBROezJAwusnq0UwHbk1QToRNd1YppmkM1m2fj4+K0o+lUsFh9t513d3BPvMZVK5UZRFGcDdPhwrlqzZs0JrayRU77fJRZ0DOgjIyMHybL8K1mWkVP+ZV3XP4SG1Ov1lwVB8Jtm0pbEBv47TdPgt3UXO5jHgjVNExH7NyTN0skFFgTBXblc7qW4v1qtPldTtb+7novVfqemaS/vpcmym8nW/Eyzhk4pXQU/VNLk3ktAh8kdGjoAHaY9ZA40AXqoYQqCMMI5P1lRlO/10rKRBPRcLnczNmRFUZhlWRwL3rKsmQG9aVHFoNSJhh6fkKcxxU07rLGcZmE2XHIa+qICdEZ5wmrfDKRhTEUM6Llcbj9YFJoBvbmQVKvxwj2Rq64llXUrM3Pze/DfgiAg1kF0HGcaQG+NArHJvVqt3q3r+r6e54WA7nmem8/n+wro8RrctGnTkaqqfqmR1jyYFHRzPzsxuTdbMPDfiqyQag1xc4TDtaYoSo1zflQ+n4cbtedXM6DPss4RswC31iGqqv6i540hBBVNO9PQy+XyzfBP+b5fdhxn52KxOI4JY5omcrTDYizJK+rgJvhudF1/oh+d6Nc7oTFalgUSmk9NgDoVnrZOhl81HMc5aWBg4Nucc81xnNNQtc3zvBHHcd5WLBZv71hL71dnWmjojLFVQRAsJKAD4AP4s13XvbtUKr1uxYoVG3slszkDetNYJAGdMXZlFCSlzDRkmP/YzKHVxUyE7WxaKaB3linSyuTeCw0dPvTY5I4DIUzuSQ29HUDH/YgfSgI7TKDxe2YD9Bj0ouDH0Ideq9U61tA7A/QuVcTEYogP57Va7dOiKJ6M/bTVQaUZL6JgyTWEkH8QQtYhsj0IAsT0aBGh13M8z3suBgJyTI4BfMUIvMZag8yjIDSBc35cLpf7ZkxD3qtttkNADy3TjuMAB59XKBTGetWO+D0dAXqtVtuLMfZ3xhg0g0sbJVEBdmBfOwkVyaZpHMxeh2az2b6cSHotkBZabb5er/+UEPKyViltvu8/cPPNN+8JXw247CmliDTGxF2t6zrS2HpqRp5Lf5sijb8vy/JmgB4EQc9M7m1o6OFJmjEWchRwzq/UNO24bmXWvAX1GtDj9zXiRg4RBOEizvmTQRBI041JvNFgY1EUBUE/iPZHENreyX0vChAE6+CaRnAbXDl4ZxjxhY1phgvZAogIRkzHF9sJ7ksGxS2ED31Raegz8EXEh0q4pxqgcJYois/zPK+GbA2MRzy2Sd9vkkI6jiKnlO4niuKAbdsIxAQNNZixmSiKjzLGUJMCAzzpnmw2IcdjH5mlfUTr+77/C9d1vzw4OFhuJxYp1tDL5fLd2Wx2XjT0eJ4ZhoFg6eNjK+A0h9l4kv8MMVaapv0ySk/bbOonMk1Qs+OVnPNjRVE8yLbt8KDVrCFH6ydWWj6QzWa/1stI81aAPuOCnZgkmB5fVVUVdU56muLcDOhxW1r60E3TvIYQ8o4G3SlC13eDxo2a4fV6HSku2Kg2w0Pf96/O5/PHTJ14cz/9zQXY2n92op22bT/H9/2/hZOSEiE200FIQRDYkiR9Utf1T8OXLsvyhaqqfoBzDiKaV0SpRH3PsW9HoklAD4Lg+6qqropSuSadggsA6CGoR3mmALMPRTXnZ406n20cew3os31vloUc9qdaraJs8I8ScZlh6hmlFBv88aqq/rKXbocWB9SwHYhyTwG9PyRWEZ00DlqeaZq3y5K8yqybcPcInuc5uq7LlmVd8Mgjj5y/5557Ou2A8hznXpixUiqV7s7lcn0H9Hj+joyMnK9p2qlxJgj60AToMZD/oHGw+aSqqv/qpJ+x3EZHR587MDBwvmEYb2SMPR3gMPVAHIP6W3O5HNyoPbm6APTwnB6t+YM0TUNl0p5dk4DOKEu6k1oCumEYb2qkGv13o8jJo3Gkummax4BcZZoWbWyYh56Tz+fH5+43bweyeiaXKS/CBK3X6x9tTMyLmtO8wPduGMZD2Wz2WXhobGxsb0VR/k8URQsap6qqKLM6Z3DqRc+aAV3X9FWu504xufcS0Gu12sXZbLalDz3BwBfB+cQkD4LgT4899tghe+yxx9hspvfZZsRSAXSEeWNNpYDe2yj3uZjc57LemgEdB+darearqhoCOiLuOwH02eb5bG2NNfTx8fG7G77kvgJ6vObK5TJKZn+ZUlqILLqhFSIC9DiN65+NctXHNWKr7pytD7MclsN4B6Sn+r7/1YaWP10+eBjxTik9UNf1P7b7zZnk3yWgx/mW/7Zt+/kgY2u3LbPd15GGHr8s7kRExoJk/l1bfAj86CdmMpmv9/sEOlsne/F7tVpdJgjCXyIylnBe4H8cx4E51ajVascODw9fi9Q9ALksy4cLgvCIqqoguEgBfSIoboIOkPN/c87/jzF2WOKAFGrpCJyrVqtfKxaLJ4CcBhpMt+O3KAA92g3iOZDU0CfCF2iYE+/7/qOc8+Oz2WyqoXexXnrtQ+92zuG5dgDdNM0LHn300XnV0PsN6EnSIkmSfpPL5Z5pmuaUGh6xT9v3/Rsx3/P5fE9SuCKZY+8YFEXxes45ArCbr7A4mCAID3ie99K5fzskIIIlxo+j3BMWiNjq+GtUIEWKHhZ7HByZCB7/gqZpH+mVG6ArQI+lVK1WXyEIwh0RiUpzzvq/VVXdZT4Krcxl8bX7LCbr6aef/i7O+dVRup6Y9Jl5nvebgYGBVyCyfeedd37z4ODgda7rbqpWq+8cGhq6dTZts912zOW+djR0PwiuyPYoba2Fhh5omsYQk+D7/scFQbg38iHBTIb5EyA/3LKsDZZlIdgQi77rw9CiAPRowFoBekSkgUhcBAWmgN7jPPRuNPS5asPNgN7I/rk91tA1VRNcz3VUVZUrlcoFjz/++BYF6HHsi2EYq4MgOLQ5YBCHd/ANVKvVq2zb/vDw8HC118oe1jzGoFwug4sAbI5TLrgYZVlGMN1n1q1bd9Zuu+2G1NOOr3iezKChx5U8f8YYu5wQ8kPf9xHUl7xAqISYjP/Qdf134Q9znICtAD2Oy2iZhx63BgNhmuY3KKXHhO2gU/AcDf1vVVW/3OsB61jyPXwgotX7Kwq5RBGrYaejwIuNkiT9B6grx8bGdmwUpXlUEAQwn10xMDDwobkA0/Rd6Gz02wH0zk3urRm7wBTXAtB9TdMEwzRvzWYyrzVN8zMNLma4MqCFg5kvFCdA3ff9Pzz66KMH77rrrtVzzz2Xgq6006FsBnTbsny5k7S1Tj84w/3x+I+Pjx8uy3LoQ4+icLmu6cyyLeTKphp6D4llugH0Xgx5UkOfAuiKJniB5yiKssUBerzWTNMEvSxcsEhPS2rnoWvP9/0fB0FwTJQd1ZfYIrQFe8Zpp52GNOoDmscUwfFIP6xWq3utWLHivrmM+WyAzjn/RaOg1+vq9fqXfd9/f0TVPAmjEW7+U9O0/XrBSz8zoE/DFIfWRHzg6yml+WZAB6WnoiioXgbO4HmrnjaXgZl4dmaAhAl4l112Oc0PgvMFxkIayERUJWgTP5nNZj+L+vCEkG/m8/k3mqa5JpPJoE78gke79wfQp0o9Sf3aDOiiJPkZXQdn/h26rr8SZWglSfpOwPm+NKKgrdfrXNO0kIfY87yv6Lr+gVlN79MMWysNHcQyjuOEeeiGYax1HKdtprju51domtssKA4aOo7xuVwOZE1LEtDbPVIuNWKZ7sd6qsl9Og29XKlc8MQWpKEntHNUo0Qu9BRNFEDGOX/IcZxXDQ4Oru2noheb30dGRlZkMhn4ymHuDpXOaL8OMw0459fCVYq6HN2O90yAjk+6rvvz0dHRt3iex1esWHE/YwxW68krwkcso4s1TTuzG9N7cg1OZ3KHlm7b9gRTXLVaBWe7Aw7zXC53P/5mGMbr8N8JHt3JUwch5GpN05oi27sV2eJ6zrKsXV3XfUiSJM/3fWzSk2QRKJCh6zpoYxXXdY8SBOEbrus+ZVkWaqmDTW/WAiD97O1CA7okSaHJDZucrusHoa+QDeccaYFIbwxN70jlgaxc133Stu33DQ8P/6wbC8fiAfRwk587oLeLnm1YCtIo9/5Vd5xWQ99CTe4J7fwIzvnXCSEDMS7g0CpJEiyVkm3brykWi7/s5x4Xv/v6668XolRiMFCiPDZovAnop23bRtqhp+u6uH79+uduu+22yHnv6moH0HO53OGUUrtWq72qkcYILvdJ7oqmIMGXtBWsN8M+0Bagl8vl9YSQFZIkfVfXdfiR6fj4+CW6riMPfYogOAh6PP+gXC4Hc8cWd3HOC9VqdbWiKC9DTimYfxKHmg3j4+N7bbvttiOVSmV3RVEesG27ZNv2GcPDwwgODAMoFkoorQDdcZ2+EcvEGnqtVnMFQZDgv8pms+Dsvq1QKLwKIPfYY4+JQ0NDZ+dyuTMqlQoOjTK0c1EUA4EJMEX/Znx8/JDtt98+rPLTicWnHUAPguB9Ufnern317Yxn66C4AO4ans/nQw09DYrrbZQ7uNw9zxMFQeiY+rWdMZ3unukAHSlVMa/8YvGhg/q1VqvNics9jqI3TRNVz6YEo6GgDdL1KKXfrtVqHxoaGqr0UztPjkm85iqVyl2NSn4HxnnqcHXBnw8OB8/zPpfL5T7WTSEqvCTeY0ql0o2SJIXFWaIrdDd4nvdzlNWO31+pVL4my/Jx8J0joLqJRvh+VVVfRCk1u51/MaAna5DEhEahhl4qlXaRZflhfMBxnBOLxeJXoT1VKpU/KoqyXzOge543msvltmlv0HqgcnTb8y6fwySpVCof1DTtc7Ztx9Wcwrdxzsu+778zn8/fZBgGXA5/C4JgIAiCbxQKhRPxLKPUmzgCzX/fJ8aE8VqtugJ56EhbmxHQGXWmo8acaTOLyk5O+tCTgA4N3XXd21RVfdWTTz6pb7vttmalUnmWIAjX6rr+fNM0w4WGVJcoIh7z7rP5fP7UWU3vTY1KAX3zUZqWWGbC29n34iybEct4PmNC/4qzpIAe7kthHnqrKPe5AnpsdYzWMHKqt4sVnCi2yBVFUWpUsNwX5bW73Ha7eixuW7lcfp0kSdcxxrIRgVW4XUf/bNQ07TmU0VKne12ngI72rF+/Xi0UCn8XRTE0vcOCkTwANIrmnJfNZs+dYLTrHCOSgB4HMDQD+ltkWf5hBOgvKBaLqKaWN02zFEUxTomGa5wCflwsFhEY0ZeAh65GtscPjY+PPz+Tydxj23Y4WROvBw3UZzKZzJmVSmXI87zv5XP517qeCx77/+gUkHrc7DCdJi7O0hagz7F8arOGjtN6LpeDyf02XdehoatxnAUWnaqqcOGEpnekl8D0HuVow+fWdpnTyRUSWURQbS3mckeKGPxZ8KHXarW1862hR0FDk8QyqPxWKBRSDb1P1dYWG6BDLwKxzJaiocdZq3WfAAAgAElEQVQHxFKpdFqj+BIqqGmxXxjWSKxlz/MQ9f6efgbCTbdXxvU0fNe/16ibe4rilMI6UNVF3/dflc1mb+tmv51NQ4cPPZ/Phxp6vP9Wq9VXMsZ+LoqikgD08HwA/nnf918MF2037Wmloce005Zl7QNa1zMdxzkf0cf5fD4Hc4BpmjAL/DEqh5oEdG7b9n8PDAx8qW1A7/wQ0k0/e/JMYkCWaar2QN2qF0RRRA8mSBMYJb7n35LJZA4Ga1yj3vAnBgcGT3c9d+0ll1yy89lnnw3zPDTQBQkUXMyA/uijj6rDw8PnqIp6uh/4DrJL4OuC6T2TySCV7XZN0+IKfziZzCrDVhp6CugTvvytwYe+GE3uWyCgxyx0N0uSdHBTthPKSaPOx9sHBwev7ckm3OFL4j2gWq2eBUXLtm05YVUOrYG2bV9aKBQ+3o3ZvRNAjzT6MI6qVCp9nVJ6LPajZJcAvo7j/K1UKh2A+vQddneyOEvS5D4F0CuVyncIIQjwAjvcMwEKhmG8UxTF77TgmQZbz8sHBwfv6rQhS+n+0dHRPOhJKaUHJ/jdQwtHEAQP6rr+bJi5KpXKEblc7hrHcdY7jrMqn88/GJMvLER/FwugW5Z1m6ZpoYYOHvLYNGZZ1rMopZDr81AFDoUwoopJ4EHHYfHTxWLxjHYtHSmgd2Byn7h1/k3ufa6Hnmro/TO5x7EC5557bvChD33oHwMDA7ujkmHCn4hUU8+27T2KxeIjbSt5Pdwc429GDJ6/EUWxmDRz43dFVv53vDT+GuTFd/rp2QCdc/5z1PRIHhZi0/vAwMDfBUHYBQVlEKxnWVaY9YK6Dw1r5lnZbPbCTovJzKqhVyqVOwRBeAWlNEw1igD9U6IofiyuHpUQQuD7/rJcLjfWjgbVqfAWy/2PP/64tnLlys+g0hpjLA4qiwF93U033bQTIiwty3qVLMu/bMQebISpdXBw8HcLGem+WAE9OrmG7oBKpXKoIAiroUVGla3w95Aq0vf9xzzPQw7r7XEa1ExzIgX0RQzomezudauOQxu8KgFiKyo9JpZJNfSJ8e+XDz3ey0ql0n6SJP2PKIqIG8JJHBbL0NzeIE35VRAER+ZyuU0LAehR/8OUYcMwHmOMoYDWZNEj3/c9TdUFs24M5/P50U4xpktAD/e6Uqn0almWf0opVSRRIo47ESQXFfJBsa8XDA4O/r2TNs0K6MijJoQ8mxDyA13Xj8QgVqvVb8qy/O4WgD6WyWSGFmrgOun4lHs7NPvDb7Rx48b/Hh4e/qzjOKEfJllgxLbtA3AiXbdu3fNXrlx5j+M4I6ihPTAwsDpOp+i6rW0+2KpLSwHQYXpfuXLlOYqinO44Tmh6b0rt+KWqqjC9h0EtMx0cU0DvDNA5Dk2eVw+C4NhCofD92P/Y5pSb8bZZ89A1XahUt/wo98Vucg84p6wNd1YElGHWjmmab3Uc56uodS6KYlxNDLEwKPV6SS6XQ5BXx+bjXsy7qJ2hm6lULv1YkZU3xeVs8Zvv+66malLdqu+Ry+VQrrWjqxtAj9oUmt4bwdNX+L5/LA5BoL2O0+oa8QgA9r888cQTB3ZCfz0roBuGsYkQgqj1L2SzWdS0RTDRjyRJelMzoKN0aGRu3gIC4mZG+dHR0bcV8oVrPT/MgQgBHYDJGButVquv32abbRBj8AwU3bAsa9y27Y8ODAx8cyFT1xYzoCcnOUzvhBBEpYamdxD4JOI1YAW6MJfLnTWb6T0F9M4APTW5d7SXT3vzTGlrMaCXKpUL1i0CYpm5RLnHAXGWZaGi2jmSJOkIOPU8D/ugSylFqupxuq5f1RuLbYeaVzRCCdC9RBCEU2RZDmm7gV8TGromVqqVwwYHB8GH0dHVLaDH+93dd9+t7rrrrv+QZXknpNOhTYqiEATLwvQuMvFUJrJL25VfO4BeI4RkGtScF2YymU9EgH6bJEmvaOFD/5Ou6y9echp6R0M4cXO5XH490tOQupYEdLDkua77ZuThm6a5g+/7axljtcYJ7Nx8Pv/ZdkzF0zenuwkdv2+xA3o0ycPD4NjY2KGZTGY1fHAA9JjrPTLz/ct13ffk8/nfznRA6j2gdy//ePNLo9zHDpQk6apsNrt7vZ6a3OezfGqv09ZidjjTNC/mnJ8C8hhkPgGYkPuPgDjP8w7OZrO3dLHFTvtIp6sw3gfK5fJJoih+VhRFFdgVFUoJq+CBMS6Xy13dqc96joAe7nXIwpEkCdzzSO9L9pvDSskY2wfxV+3IcFZAr1arYPmBBnoOTCeRyf1/ZVl+YQtAj9ORtgANfWbxlUqlgwqFwq+QuoaJDA0dqVacc5TCOzKTydxsmub2vu8/EqViXZDP5y/qhvGsnYFs556lBOiIDWlUajq7kdb2McZYyPWOU7VpmsHQ0BCsRLdeeumlh5x9Nm5pbXrvJaB3uok0j0cK6HeIq1at8jbLQ0996PNWD71fgG4YxhcJISdFNb6hXcJ0bGuapjTW6QH5fP4P7exP/bonkY/+TlmWEV2ux9gFl0EE6B/KZrOXd0r8NRdAb7JKXmnb9nslSZqSNYYsKtd1f7dmzZpV++23H7BmxmtWQK9UKsdFdJx/ymazf4s09DslSTqwBaDfqev6y7cGDX18fPzlxWLx10lAR7+DIAC5zLsadYdXxxo6IaTWOPmB5/3zc9PQZxvOmX9fCoDeNMl355zfEATBXgg+hKaOaHdMelhGcrncBYIgnDud6X1isTF/dHSkZR56tVZby+eZKS7V0FMNHXnoi4XLfS4m93jdwQ9MCAFOhFzpAHRJkkJAL5VK+w4MDPx1ITEhBnTTNN8CxjpYnIFdsCYAwMFkZxjGGZlMBqbtkEau3WuugB5bJR988MHstttue68oijslvw0XBkDd9/3/zmazX2plem/F5T5t2loLTSPUjiRJOqgFoP9Z1/UXLeTgtTsQc72vUqm8IZfL/bTZ5B4EwXgQBG/J5XJ3mKa5o+/7/4aF3vf9j0UsewtG/7pUAD1pejcMAzXTEUEbRr1H/smwIlsjffLhRsGHdxQKhT+1Mr33UkOf63xJNfQeaugtzCXx3EYg35577bVakeWD0yj3iVnbxyj3OHocXOknxCACk3sM6JVK5SWFQgEFUhbsigG9Xq+/g3OOw0fI6w6LX6yhV6vVk/P5/JfnW0NP7nVPPfXUa3K5HLjeJ8nKIl8/r9frKLs7q+l9Vg29eRSQR33qqaf+BPVu8VuSi5YQ8kAjP/s5WwGg03K5fGQ+n7+mGdBd1x21bfvg4eHhv4yPj+9ULBYfq9Vq457npUFxEVNccx56q5UezyHOuVatVs/XNf0jjuvAPBmWWVVVNfA8j9m2vRpV7aIUGZTtnSScSfjODs7omZuRJgUiB2j5uq6nTHGieKUgCNs3qgTGjrulmYdO4e+aYEEEoO+1117wRy4AoE+cNNoJitsSmOISPvRPN1yNJwdBEAIRQEiSpNCH7rpu1yxsvToBxPuAYRjHU0o/TynVYgrYIAh81KmvGbXjCoXCN+fTh57sX7zfGYaBAMKjGUMQ/EThr8jXj9vvUFX1NTNZEToGdHy4XC5fpSjK0fHgJRpm6LoOvtwt2ocOs/n+++9/kqIolzUDuiAIm+r1+oGFQuEhy7LCAi2NogRjrut+YHBw8AdbXZR7JnNCzTCmFGdpB9CjuRWmdlSr1eeKongd53zPOL8VmzcmPefcbvC+n60oyiXNpvctD9Dn6sl/uupbkiku4DwI38w5Djt9TVurVCoHUko3C4rTNA31qY8q9LAeeqqh91dDj9Maa7Uaipuc5fs+gDJcl6iwhih3UL5qmgYz94JdCUA/v5E+dzraFbPFxVHu1Vr1LQMDAzd22shemNzjbwI3YXpfsWLFvbqu7xQxZU7+HBGXnaDrOuIAWjJldgXotVrtzAYbxHlg3EHeXOJCStHKbDa7qd0w+04FuBjuh9ZYqVQ+qygKCq6E9IFxHnq9Xn8SBW123nlna3R09DWDg4O31Gq1jZ7nvXVgYOA3cyOWmduGvhAm90wmc4LRJaAnzVEjIyOH5/P5HzHKPNux4bagoIUVRRFVi9ZUKpV3LFu2DL66SZfGlgfoc5/9yeIsjLErZVkONfTIfbYggC4IAlwobQD69PM/aXJfOA19EkDRUMxDL1kPHdXWFnseeifKWBwPVKvV3hEEwZcFQSiiemAjroUKghBn/5wry/JFKB8699nb3RviOV+r1b7PGPuvuOgT3pYA9OcPDAz8rdMvzAbolNKfq6o6hSluum/Esi+Xy4dQSuFmhEtjsjx3hDEmpXRPTdMea/UeAHoQBP8Ltqb49ynUr7VaDb5yfCCXy+WOj5jiQDBzDZLfm/zoMIO+AulEnQpmKd0/NjZWyGazNzDKXu16Lsy8k8LjnD+A6j2gNa3VakcjctI0zXX1ev3FQ0NDT6KfC3XYgSI2UW2t1l61tR4UZ9F1/QTTNEMNHYcfaGK2bU+hfp1p7ONJjspsy5cvP58xdoplWa7neWGKDMBAURSQHd2Yz+ffkjS9p4C+uWRnAnQcNoMg6LuGLoriVZqmTaatRWOI1KEJDT3gImUdByctApP71gXoMUkWrC6SJN2gKMpKwzBiQA8ZNBljq+v1+nvBwtbJYaGXeJBwDSD1C/TSkyCJ+rq6pot1qw6GU3CudHT1EtCTCsy6deu+OTg4+J7IfTOlTZzzW3Vdf10rf/+sgF6pVD4my/KF9Xqdj4yMFHfbbbfK6OjoSzRN+wOS35vD7B3HOb1YLH5moQZvsudzU2ZbDmrcp2q1Oqyp2n1+4G+DVLW4OEs0IDfpun4oKtI1ZHa27/unMMYey2QyO8cTq60ZM5f2T/NsJxp6wLnM5gjotm1fLAriCXWr3jWgRzINTe+2bT8XXO9BEOzpum4Y9Q5mKpj4CCF1zvmZuq5/Lja9twJ0aPQLXW2NEDKl2hrqodfr9UcZY8erqvrLfqY2JgGdUnqlqqrbQz3HPAZblWEYnq7rx+bz+W93NF+bJnXzFEzUg18lSdKViqI807Ks8LsYW1mSBcu2jspms9d00//pNHTXdcN66GFkebl8UbFY/ERMAtWvg/VmPnRFXVUzauC4ndTQt4Qo96if9KmnntIYY38dHh7eDTiBAYVsAZyU0hHDMF40MDDw2EJgQgyI9Xp9B0opyrcORntKyASG+aer+t9LldJLUau9rb05cVO8x1QqlRtFUZxSDz3q7+Ya+ix7e2x632677e4jhOyYULbDpkd4c0zDLI+8+Smm9xjQ4wDFSOkJFe+w2trY2NjrFEX5Gf5gmuaBy5cv/z3nXK9UKuMSVPSo0ljcR9/3f4KC7gsxeJ0ORrf3G4YB7uI/gzYwGZFICHE555fpun5auVwelCTpakVRDjNN8w+5XO6A2ZjNum1Pu891AuhxZGy7747vSwSz5QHojLETkNoHDR0WLqSIOI7Ttobe/F6kfTHGftQAbxyuoQGEZVajCXw/TGqKotwXaephFGu5XJ4MiltUgE4JcR2XLwSg12q1VwVBAEDfKQZ0RCdnMhlqWdaJmUzmq3MB9OZ5E4M0uPobmtzXBSasdFwniOdLNC5H6rqOOJOQqrOtuRdtjosa0FV1Va2WAHRNlyvVygWPd8QU1/0Jv19R7hifhx56SNltt91szvntKEAVB5tFYO4ITJAN0zikUCj8oq3x7OVNE8GSoQvO9/2TbNv+LKVUTVRbC8szW5Z1eaFQOKUbt0BXgD5LHxOm99cSQn4mJmu+RkYgQojR2Af3aja9zwroIyMj2ymK8kRUJP3EXC6HhQ4T512SJO0fCicx13zfH8lmsytQhaxfJ+Bejnmn78JmU6/XTxZF8TPwv0SbT/gaznm5QfX67kwm8z+GYayklP5JUZRtDdO4Jp/Lv7uX3Nidtjtpztnc5I4YgImDHtI6MpkMXCthWcTZvzN1o+k3oOMwaRjGBaIofrhRnjZ5oApPro3KTjcUi8W3YlzQ9qhU6OIEdJwA3XkH9HCDq1QqL+WcX5nRM8/yA9/H4QjzGeZHyujHBEG4uJcH0PhwALO6JEmXB0GA4NmQ0Rc+V/AMeJ73Nl3XcVhrH9CjCbqkAH3e6qFPRt2Ha7nXxDLRfhGmrm3cuPF8SZJO0zQNWSjhWmSMxfXGr6xWqx9etmxZbb4VvXjPrVQqqLT2stjcjnmH9iEUp16vHz4wMPDj2fe6KVAX75fxempfQ2/jQ7GcKpXKtymlR8WKc1Jb55zflMlkDkvibLlcfmGjCuj/xm7gzTR0fBt87r7vb0MI+XY+nw/t+q7rfsbzvI80t822bZiWXl8oFLqj++v+INqGmOZ+C+e8UK/X/0dgwssDHkDDgDk4Lkiw3jTN5wwODpYNw3g+pfQe3/dLnPPT8/n8FQsZ4T4zoBOYArsE9KkybQZ0SukJjuOEGjqARBIlwfXcjjX0qP2TUe/gepckaU/45eGrwyYCDukgCIxGyszHdV3/YlyeddFq6AsI6JifnucB0PeNAT0IAheBOJzzr+i6/gHM7dkK4LS7ouIDYr1eP7MRRHo+rAJRVS4uyzLjnCO188hsNvuLbsiXthRAb739zW1T7KeGHgf5btq0ab9MJvNTxhiUuRjQQ6u27/uB67rPLRQK4I3oLgOqCxHEpao3bdq0r6Iot6uqWoAVKtpL0EZY9mxd13eklHZcaS16T18APd6vCSGFWq12LyFke/wtAeihuwCV7AqFwg/iddgWoJdKJQQ8/CfnfKOu68vx8FNPPfVqTdNuFQQhtumH70SUIyHkqlwud1zXg9fuLrEA99m2/Rzf9/+B012sBcbNoJT+TlXV/0AUfBAE76OUXua67nrUiEca20LLYyFM7r0E9OShZHx8/HBoc0EQYIWGXO+R6ZiJongvY+ytSBnEM7Va7WBRFG+Oa3V25UPvYkNJTs8kscwC+9DDQxFoiV3XBaC/1g+gHHsiNHRFUUTTNG8qFovHUEo3zi0rY/KQmIz6/gal9FhYV5C3jDFBhLtt22sEQXhPI9inJUnQbEt9SwH02frZze/9BHS0JxGz8kfLsl6U8POGFrIgCGAtu1jTNFRds7rpQzfPJNw8P5Jl+fCwbKrvT5RpjCOEOf8WAne7bVc/TO4J5WqypLQkST9GzFDMcBdjre/7Y6g3v3z58qfwtxjQYx86ItynRLnjpvHx8aNVVUWlMOI4zguKxeI9mCRI0eKcDzULm1JaMgxjx2222QaUpy3z5boZoIV+BhN3l112Oa0xiMhnjDXDuFmYqOc16A4vgv9cFMVv6rr+xtHR0Xu32WabvbvxR84RQzYT15YE6DC927Z9QWMOTzG9J6qyXavr+tt7BuhznHyLCNAnNaRSqXRlNpM9xg/8MGsAByJBEJC6tk6SJKz5ngToxZveyMjIszOZzNWEkJcgngIHMdd1QzO/WTdvFkXx/bqur+3mELFVAXqHG0O/AT2e2yMjIydkMplPE0KyCVDHksRYwwoDLf6vSRftHJfVtI/HcwhZWqIoIgi1EGdkRQxxobmdc/5iHCK7bUc/AT2pwNTr9e8EQfBOaOVJLd11XZrP528477zz/uucc84J2gL0arW6TBTF9RBSo/73mcVi8VNYQJZlXYHayc3CQJCS4zgfKRQKly20VtrtQLV6DnJolI0Fnz3MSriSRPo4Ib1Y07R/m6a5neM4DzHGRFSW0jTthG78gt20faa1viUAejTJJ03vjLEbGGPPjQEiAejVRs4vTO9fRiCWLMur56ShdzMYiWcWC6BH8gv9nqVS6YxsJnsRNHTf98WoSpYnorKGbX8in89f2It5Gx9mK5XKsZIkgSZUiTd813WdTCYjG4ZxaT6f/2hyE+tE5FsVoHcimD5SvyY1SRzObrjhBn7ooYf+nRCC9Zi03MbKz69d1z0in8+PdIILHZ5fwmYBaO+//35h1113vYcQskccrBeB+UT+Lue3GYbx5uHhYewVXV39BvR4PTz22GOF7bff/l7HcULTe3xBYQbXO2PsCFEUf1gqlfZjjIFqN0ylbqmh44d6vf5nnLAIIX/XdX0f/K1arb6SMXZb0+CFdn7XdR/J5XK7bynBcRi4SqXyflmWsSHFpAlJ2f5S07TXQIvfYYcd3pbP57/DOR91HOe9qqqujnM2u5o1PXpoSwH05KZvmuZbGWOonR6WWY3SCMOod0rpfVbdeqkkSy8QRfFXSxLQu9nNZpkvidS1gxtpa1dyzreDdg4qXUEQfEVWBLNu/r4RDHusoihr5hL7EfsxEc9g2zZS0t6SWD/cdd2QVKZer7+rUCh8t9sDRAro0w96vzX0aD2GgYzIkGi4HC+Blt5gcMT5GmyOuCXcMymln1EU5ewGY1t98xb3ZrLHc2j9+vXXDgwMvC2Oao//jXZG7tKX6rp+11y21/kA9Lh9hmEcQghBzfYw5im2OAC0HccZFUVxD8/zdmgL0E3TRGT35z3Pw2YJQSB9DXzYf2WM7Z04McT/F/edrOv6lzo5jc1FuP18tlarLaeU/rmRuxufkELtXNM0UiqVEIh1Qjab/W6lUhmilF6fzWZfOT4+/uDg4OCzu92ket2fLRHQN2zYkCkWixdJkvRBFyHjnMeFDeJAxUtN0/xJoVD4rWGavhTloWeyWWbUamsR64AAzn6P0SLT0EMLR6lUGtAA6IQcHsUihJkBYPmCT73BAnmOoigomdx1QaFYOx8bGztBUZQvwmqVUADCNEbbtv/i+/4x2Wz2791+a94AvQ3MQVvaY4p74vw999xj3sqnjo2P313I5/fFHo7Dm+d57lyqrTXvT3FEuWEYd+m6HlbjdJynE2UApDBz+76PaPjLYCXqwx4XztVyufxlRVHej3FIpKmFOBiZ/7+naRrinMy5tGG+AD2e36Zp4tD7jtg63ETs9r0gCLDGfh+Dfssod3T40UcfLW6zzTbrwNfLGEO0+9GR2f3oIAiuagHo+NOm9evX7/bMZz6zspR96diUIrrbTzb7zmGm9DwvBG50eGx8bK+B4sDfDcMwfN//fKFQOCsJFm3sB3OZXzM+uyUB+oRWEDBKGQhn9ooIZ8DQNxn1Hk36hx3HuUfTtNc3MjMy0Bq6Coqb06iAmSoINRjk0S9kUFzcjRhoLcuCO+jyUJWi4RkV/xPn9YPd67iGRe7H3Rx4EsQ+LwTNbCaT2RtZMPFmg1QqSqncCKQ9W9O08yIg7IpJcd4AvY150D6gP37+nnvuOW+A3o+0taQ4Yr+14zgvNE1ztaqqKxIusLC0ahwk1zhQnJfNZkEJ27MguWi+cZRzdRznPcjfnqBKmaysNpEnScg4IWS/6ehT2xjiyVvmC9CjPtBSqVQQRfE+xth2SS090ebzG8kzIE8KTe7TAjp+rFQq3yGEHKUoirFhw4Yddtppp3FEdNdqtX9F6QrhoCUubBJX4iTUfy29f1BZrVb3IIQgchq87VPI60VRBFXmqaqqfgXaoizLZw0MDJxeq9UQcwAa3H920/d+9GZLA/R4kuOwWK1W3yYIwrURIUkY9R4v5KhgRPgvzE9oKNlsdsGqrS0SQJ+MdscaJYSAxCLpSgqB13Gch3VdP0aSpDs7SSeLXUylUmlnWZavliUZaZ7wesQpkuH7KaVrGkyK75Fluavo9sQBpSX166Jgimsmlpm3PPQJ6cyHyT0xDuHBtVKpfLxxuD5LlmU1tshEgA5Tcch7EATBTz3PO3FoaOiJTkC0+d54X1u/fv0zMpnMtzzPezksp7Ish7XZE1fMG3KYqqowXc/5mk9AjxtbqVQOEwQBhWTCqPemKz6Mh3+eDdAPlGX5rojeL6RRhDBN0zyGEPINvKAJ0DGZfNu23zQ4OIg6r0vuAm87AqoopS+L4gEmedvRGUmS/vmpT33qOYgwtCxrV8dx7ofWkc1mb6WUvrab6PZ+CWlLBnQcpvL5PE78H0R6N4Ym4TObKEHIWIjyKaBPzLBEtayjKKXfEARBSWpUmO9RkYcNlUrlw8PDw9e2E4Eeb3Ku677M87zLVVXdA77ySqXCsNFGBZ1Csz6l9COg623nvVPWRdOJN9XQp9815hPQowNECOqGYXybMfau+GAdAzrWJaxkWJOc8zFVVc99/PHHrwDjXKd7H+bNr3/9a3nPPfc8qVGs6ZOKouTjXPNcLkdQsSy6QqroRq2C0zOZzOfaZiKcpUHtAzpzYvKuTvuYvD+e55VK5buCIISm9xagPvnIjICOu0ql0q9lWX657/s1y7KeNTw8DE1Usizr7iAI9trsuBAEGLwnZVneT9f1DUvJ9A5aw+XLl58jCMIZcRR104HFqFarxy9fvvx7GzduzEqSdGGxWPygZVkjoigeIUnSrzveqOYy2rNPvlCLma/iLKB+7XUeeqsuJlJU9hIE4XpCCNwfoQYYRbVO1hRuR0Pvk3VkUZnco012wsY+YeH4vKIoJyMXHcFLsZwTAA9T5Q8aVqqzVFX9VyurUzwOqHXQMKWeQSmFjzKZwoTqVkRRlPDA1eB0QEnck6LCHaHFoNvpv7QAXZMrlWqH1K/dSmZ+NfTEvArHs16v39SwvrwOwBqnW8U1vjEXMPfAFOi67kOCIFzNGPuOruvrZuptPNaWZe3SKIb1X5xz1DnfYZq9Afjjy7Ii+L73JdBy98HMD+bFnjLFzdZ/RL0PDQ3d1ziIh6b36a5ZAX18fPxliqL8BoQylNIvyLL8YbwMpUJ1Xb8lIpaZtLvjhZIoEddz/zIyMvKy7bff3poJ1PuxmXa7FEZHR5EKcL0oikm/3+TrfN+/JZfLHRz1fw/4NmRZhqZ+88DAwBsWmuq1ud/NGrqqqqsw2WOfZrQYO6R+nfqV+BsoTjMF0EVBomRuTHEzTvKAU8ooN03zbZTSayPzMQAdh5jNAD2TyTDDMBY8KA6aSi6Xm7fiLC3mRLjx4pAniuIVhBAUFpoE9URAURxk6HPOUWbyds75w0EQlKHJc7Bb0nwAABCXSURBVM5znPNnSJIESlnkmYem1lD40RUdrnwBYbmE/M3zvPciL7nbQLhWmgvWXLJ8ampynwrouWwOzIBhUBxqUWSzWcQHXVguly/YYYcdUOCoOya3pokVxRGwc889lx9//PHXDwwMvEUUROBAeCfmAgAdU6F5jhFC/kEIgQsG1dE2MMYQuIZEjFwEYLtSSl/aYC7dOXatTU6zKTRnIbWyr2u6UK1VL4VFuRu+9lnANcEUJ7054XGOwlLaL5+62XdmAcNKpfJGzvmNyVKpze8A/ka07bBW7DPFIR4NBMjsb/I8DyH0lmVZzxseHn4QA1gul78uSdJxyTS2BKAjze3Hy5YtO7xXk6ZboG7nuVKp9BpBEG5GEFUS8BL70yZBEHC4eQDaeaFQ+IrjOO+SJGnj2NjYIdtuuy3Id+akdbTTzk7uSQI65/z7jYPZvAA6omkppSh36ouCKDiuc1sjXeRVMTVrJ32Y7t7EQSJbr9dhev9AVCwnrCkcmtwngnLCnaERhLWoAN2yrEcppX2vtjaNFhNuSrC4BUEAJje4l8KDXiy32NKRLD0Zb8RJk19TZagpLjgcHJD/6/v+Y/Cba5r2m16AebQvbeZDt23bcxxn4autLSIf+nwBeuIQF84tWIBEUTwpWcyqOZ2sk33g6X14etTDdxs0w4JhGB8dHBz8Qq/M7E0Hyb5Rv85ykAjne7VaRY33t89kdoeLC7+3BHR8BNy4siz/WZIkZtv2XcViEaT3OJHkGlG8IBZ4RrIxSF1AgIKu6wisu64RKHZkrziiO5kE7d6LwhWCINzCGINPEcmUk49GEwk5lGdEfOEoVPP6XC63GnW/GyQn12ua9s62o4Ln0STRDOiyLK9ClFK/NHTXdS/mnJ8wH4AeHzajMqt7+b4/aXrHom4GdFVVmWma/dHQW4zpdGlrvu9zWAts254fQJ9mvsWHz3q9vhMh5GuEEFieQr9jrElNKNZP57+2A+gA+Oi+cJ4pinJ/rVZ7b6FQmFMQXAtLw6IEdMuybsfBOa62hsh+FDCpVDqtttbu7rX5fUkfeiaT2Re0p9DQwd0PDb1cLl9YrVZ7qqE/vWE+XfHM87y3eJ6HGgvbxvMoeUCM/9Z8KGzV8+ZYraZ7Yj19bePw+J5cLndH99Kb+cn2fejtFLrqrJXYz6vV6iD4NhprNiY72+wlWLdYw67rbq6hx6fher2O0pinVatVrmnaKdls9jL8BjCklN4RBAHL6BnquE54So9P+AhYkCTpJw3CirdBg1psPnWYMQRBuA4aZcQmNEVAUYWo67LZbEgrCk5smIdEUVzped6/gyB4SSaTCXl1p+vbPGJ4c9snfejQ0AHoiDiNS41Gbb5C07QOqq1NnT/NJncAOni7EWcB0pJ+aegJjSA+uU5GvUf9S1qbUH+b1a16fwC9xbpsBeiRL5Hrug4GxvkB9Bn2jMTYabZtgyXuZByEkN4PP6eiKOHGkNQGmjWD5s0Y2oFpmr6macg3v85xnFOGh4dBGd1T61XSh/6sZz1rNVxh0NAjAhEkQ6MK2EWaps1rPXTP9W4nhKyyncl0vbA2e6lUumDdunXzmraGOCfG2PwCejTf4pREQkjRtu1PEUKOBZd/xE4Y3oWIdIDPxBxqsp3PgnUJgEccBv65zDCM8+bCAtcOvC4koMftq1arSIW9IU5VizA6/BlyiU3u0wJ69AC4tP8qy/KzKpVKzXXdFwwPD4cpWtVq9RhZlr8hSRJ3HGdqHtvT2u6fG7z+/wnu5nYE1+97MDD1ev0E3/e/BOBJaq3Jb7uu+7exsbH9d955Zwum9lwu93XG2JEonep53knZbPZ7vTIj9rrPzRq6JEmoXzwF0JHD2Qh07Amg12q1UEMXRXHeAR1jgzxXQRA+0KJufYD627ZtLzigY+dSZIW5nrvggJ44FMUpbQcSQj7ted4BiJkBqEeRyZNTcxZABwsc5PwAKg42tMPV0YM9P9P2B9C7a2YyDx2A7npueHBmjOFQ4xQKBbnhCrjgoYcemhbQu/ty6x0j1tA3btx4d6FQ2BeABw0dGKqqqmQYRs996NPtXYmAtmc1SpEj2PjtnuepOCjOrJnPDPCR8mRTSr/FOb+oJa70UqhPH1QWxOTeLF+Y3iHLxBqeBPQY4D3Pa62hxw+Zpnmg7/u/1VSN2o695sknn3zJbrvtVonqpV8ERiBVVaeMRBNrz8YgCN6Nkon98au3N4KIymWMXS4Iwn/Cv5o86TQJ7hFN0w6ilP4boF2tVt8ty/JVoB31PO+HKAbStqm912idfN/0ZtVQe0Uqnqqqx4ADPaopjsUdHrwcx7mzUChc00nOcfLT8Tg+/vjj2rJly94siuJrXdc1okNOIDIx53jO3bquf74XKX2tuhprf+VyeVfG2IdEUZzkDo/XoSAIsud5T/m+f00ul7u/1xpj8/DG70fZUsYYGKzCtB1ciqLIqMrHGPueoij/6Hdb2p168Vi6rnug67of9DwPZvhCssJiC0CP1zvcUncJgvDFhx9++NZ+E6jEbUX++2GHHXZSvV5/kaqq1Qi4EOQ3wDm/Pp/P/6Rfh4qEXOF/xFpD2dBTXNeFVlxF4ZswSEvX85s2bbp+zZo1P1+1atVEPc8+XvFaLpVKn9A0bXfOuRmVrsUhIxsEwY26rv+sH8xtswF7pVJBWW7sE9g794+CKTuRhkEIATPatbZj/2hwYBBBmvN2JTI73i+K4vOjfTQs6BbRT9+rKMpX++G/T3YSckRZ4hC7OD7OJzb0hIbemH/nbRYU17x5VyqVcxog+Mkw+E2SVqPCGO7BJDrggAOu9n3/nTPZT+BDlGX5GhRzyWazI52a4NuD7NbjC57p00477U0wzzRKvu4giii+M8E93LxRcc6fCILgtblcDhGYKFP3WkrpL2BSbORa/qvBjLTvwMAASP6xkreYCnPztjLm40MdTJYObp2Pli/oN5KHtEKhgOIP+zcyCZAauDwIgoGocVWUVxYE4Z9Icbdt5/eDgwPl/hzUF1Qc6cf7JIE77rhDffGLX7xfI3Ib1SkRyQ53ZoEQko+yVqAYlBhjj3POH6GU/p+qaXcz2nv/dJ+6uOCvnRHQ0bqoAhvK070JKWtBEFyYyWTOjH4TTNNEgM2xEcht9r6EqWUUJwxN05A6M2NqWy+kAk2pkSP7Wc75K+P0mmSIf1ydB9+CJsc5P7RQKMBNgPrazwuC4E5CSE4QhDFK6WG6rv9usWhWvZBP+o5UAqkEUgm0JYH09NuWmBbDTbMCegTcecuyfh8EwR4wWTfyWM8Ea1cM6rVa7XMwfTbnpUa/N/dzQ6PW9aeDIPguyuz1UggAXMuykKp1KmMMVJeT7oA4cC8iO5gMzmgQ4T/kuu5h+Xz+gUgz3xU5uBGRQVUURXBdX7cYqqn1Ulbpu1IJTCeBdP9O50YqgaUpgbYAHV0rlUq7MMZ+SwhZGUUZop7yxRFogx72+IYfC7mAYMufQjbRLJrI3G03yrWCLvZ7vu/fMTAwUOpYhDR0VFLX9fYG4UgQBEcIggC/KmeMTelbHCUZR/GiDb7v/8nzvEOXL1++CRaG9evX75HJZH5GCEFqj9Uo1XlusVhE4FfX1ag67lP6wAwS6DHU9Ph16dDNXQKLYUgWQxvmLsn0DVujBNoGdAinUqkg4OI38K0xxhDxc04ul4OjPrzK5fJLGqVWbxQEATlz4bubguTC+2L/deI3BI78JQiCuxhjawgha1zXBaF/eWhoqBK9R/7nP/+ZX7Zs2XaCIIBBCCQZCLI4UBAEBL1NUCBF/vHpCDDANW2apjc2Nvb1crl8yh577BGm1o2MjLxoYGDgZ4ZhIIgDZQC/ksvlTl4yYJ7uQlvj+k373BcJpIupL2JNX9p3CXQE6GhNtVpFCUsk8i8HXsuy/JMHH3zwqH322QfRiPh9mSAIl9m2/XYEoTVrytNo69N2NCa7iG+Ahp0Mq49z8JooBiff10xQ4Pv+esuy3jc8PHxTHNBTLpdfLEnS7b7v65qqOa7nXqJp2ieXDJj3fZosxQ8stk15sbVnKY5p2uZUAqkEZpJAx4CeAHUA4jOhEbuue3cmk3mTruuTZfJc1z2oXq9/DSbwuQxBi+puHb0u8Ty07m+WSqUzV6xYEfru42j1Rm72tg061z8ODQ0NBUHwcZDopGDekZh7cHMKeD0QYvqKVAKpBLZiCXQF6JBXqVQaUBTle5ZlHZLJZBApPo5SiZqmXZ1gpNINwziRUvrRSKPfTNSzUPzNOjStTPrJhwDalNJbkDOfzWbvbZVmg7+Zpvk83/dfkM/nr0yj2WcV+ww3pMA8F+kttWfT0V5qI7ZE25tOtLYGrmtAx9tBHFKtVi+WZfkU0EY2ctZRC/mnpmm+H/SPcQsaUe0A9hMopScTQpB7OHFxQujU2LW2Gp28KU6Liw8GCYB3KaPX8YB/Lqr4FLnYuWqa5qt93/9DFGWfTpWOpb40HkgHdmmM05bSynS+bSkjuXT7MSdAj7sdcc1eHgTBchRp4ZyPNwpeXfLII498ee+99zZj0zbM2IZhHEQIOZpSCoIaNVl+cVoxTrNSwBMMAIcfHQQwEQ/7Pb7v/wBlUXVdB0HBZLlAwzBe6Ps+ige8WJblr2madmJqWl+6kzdteSqBVAKpBFIJPC2BngA6XgcTvCRJn6WUvtdxnDAYznXdjYqiXJzJZC4H62iSYY1znjFNE1XcXtWgkMQ/e0zHrz7TgPm+/ySi40VRvLPBSX1roVB4qNmsDqKYBuif4/s+6suGbHGSJD1Uq9X2HR4eRi3elP1tK1wVqUa1dAe9p2PX05ctXZmmLV/6EugZoMeisCzr9ZzzS0BCI0kSMQyDaJoGJrarbdu+slgsPtJKbA3CfcUwjN0ZY8+JCtsPUErBz1yMABfpa14QBBsZY/8mhPyLc/6viKR/syUZuQMOkSQJhUhQ2x0XtHWHc/7VtWvXnrX77rvXUhrXpT+J0x6kEtgaJJCeO5b4KM/DAPYc0CHyiC72yIZJ/BxCyC4om4cLVc4YY0h5Q/nSW3tdiQ2ad71eh1n9aM75mwVBWI5CEw2CGGpZliOK4reDILi4WCziMDBpiu94mszDwHTcpj49sBV1tU8STF+bSiCVQFsSSDebtsQ00019AfT4gyjrZ1nW213XfR/n/ACUW03UzUU6+T8opTejjq8kSfdls9kH2q1ag/esXbu26HlesMsuu4QVeFABLJ/Pf1UUxXfj7yihGQRBSVEUpKt9ddmyZQ/PCcjnLO70BakEUgmkEkglsPVIYH5PKX0F9OSgVavVPRhjJzRA/K2EkOHI/h0WaMcF9rhGDrjDGHuYUrqRcz5KCEFBl1KjIIxMKdUJIVIjqG2wkU++oyiKuzqOgzq7nxwcHAQ9a/iier3+X5RS1I69pUGCc10QBNcvX758MjBv65lIaU9TCaQSSCWwdUpgfmG0lYwXpgXzBugJrZ0ahrE3pfQNCIjzff+lbOIKA96RhjbbFfGwE9Ri55xfq2nakXG0esN/r61bt25o++23B8nNwkh1tg6kv6cSSCWQSiCVwFYlgafBqH+wNO+A3jyCyFE3TXMPx3H2lCRpz6gO8yDnHJr4UKPgC4LjUCcXjviaKIp1z/PWIijOdd1/EULuKRaLv5rRlN4/+W1VEzLtbCqBVAKpBFIJLF4J/D/xclRhztyp5QAAAABJRU5ErkJggg=='/%3e%3c/defs%3e%3c/svg%3e",Vl="0x1A6950807E33d5bC9975067e6D6b5Ea4cD661665",PN=84532,FN=BigInt("1000000000000000"),kN=BigInt("1000000000000000"),eu=[{type:"function",name:"getAtomByOwner",inputs:[{name:"owner",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"balanceOf",inputs:[{name:"owner",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"atomsByHash",inputs:[{name:"atomHash",type:"bytes32",internalType:"bytes32"}],outputs:[{name:"atomId",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"createAtom",inputs:[{name:"atomUri",type:"bytes",internalType:"bytes"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"payable"},{type:"function",name:"createTriple",inputs:[{name:"subjectId",type:"uint256",internalType:"uint256"},{name:"predicateId",type:"uint256",internalType:"uint256"},{name:"objectId",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"payable"},{type:"function",name:"batchCreateTriple",inputs:[{name:"subjectIds",type:"uint256[]",internalType:"uint256[]"},{name:"predicateIds",type:"uint256[]",internalType:"uint256[]"},{name:"objectIds",type:"uint256[]",internalType:"uint256[]"}],outputs:[{name:"",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"payable"},{type:"function",name:"isTriple",inputs:[{name:"subjectId",type:"uint256",internalType:"uint256"},{name:"predicateId",type:"uint256",internalType:"uint256"},{name:"objectId",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"fallback",stateMutability:"payable"},{type:"receive",stateMutability:"payable"}];function Fw(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function UN(r){return Fw(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const zN="2.29.1";let C0={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:i})=>e?`${r??"https://viem.sh"}${e}${i?`#${i}`:""}`:void 0,version:`viem@${zN}`};class jd extends Error{constructor(e,i={}){var u;const n=(()=>{var c;return i.cause instanceof jd?i.cause.details:(c=i.cause)!=null&&c.message?i.cause.message:i.details})(),s=i.cause instanceof jd&&i.cause.docsPath||i.docsPath,o=(u=C0.getDocsUrl)==null?void 0:u.call(C0,{...i,docsPath:s}),l=[e||"An error occurred.","",...i.metaMessages?[...i.metaMessages,""]:[],...o?[`Docs: ${o}`]:[],...n?[`Details: ${n}`]:[],...C0.version?[`Version: ${C0.version}`]:[]].join(`
`);super(l,i.cause?{cause:i.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=s,this.metaMessages=i.metaMessages,this.name=i.name??this.name,this.shortMessage=e,this.version=zN}walk(e){return jN(this,e)}}function jN(r,e){return e!=null&&e(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?jN(r.cause,e):e?null:r}class VN extends jd{constructor({size:e,targetSize:i,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${i}).`,{name:"SizeExceedsPaddingSizeError"})}}function Sf(r,{dir:e,size:i=32}={}){return typeof r=="string"?gG(r,{dir:e,size:i}):AG(r,{dir:e,size:i})}function gG(r,{dir:e,size:i=32}={}){if(i===null)return r;const n=r.replace("0x","");if(n.length>i*2)throw new VN({size:Math.ceil(n.length/2),targetSize:i,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](i*2,"0")}`}function AG(r,{dir:e,size:i=32}={}){if(i===null)return r;if(r.length>i)throw new VN({size:r.length,targetSize:i,type:"bytes"});const n=new Uint8Array(i);for(let s=0;s<i;s++){const o=e==="right";n[o?s:i-s-1]=r[o?s:r.length-s-1]}return n}class yG extends jd{constructor({max:e,min:i,signed:n,size:s,value:o}){super(`Number "${o}" is not in safe ${s?`${s*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${i} to ${e})`:`(above ${i})`}`,{name:"IntegerOutOfRangeError"})}}class vG extends jd{constructor({givenSize:e,maxSize:i}){super(`Size cannot exceed ${i} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function S0(r,{size:e}){if(UN(r)>e)throw new vG({givenSize:UN(r),maxSize:e})}const xG=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function GN(r,e={}){return typeof r=="number"||typeof r=="bigint"?WN(r,e):typeof r=="string"?EG(r,e):typeof r=="boolean"?bG(r,e):HN(r,e)}function bG(r,e={}){const i=`0x${Number(r)}`;return typeof e.size=="number"?(S0(i,{size:e.size}),Sf(i,{size:e.size})):i}function HN(r,e={}){let i="";for(let s=0;s<r.length;s++)i+=xG[r[s]];const n=`0x${i}`;return typeof e.size=="number"?(S0(n,{size:e.size}),Sf(n,{dir:"right",size:e.size})):n}function WN(r,e={}){const{signed:i,size:n}=e,s=BigInt(r);let o;n?i?o=(1n<<BigInt(n)*8n-1n)-1n:o=2n**(BigInt(n)*8n)-1n:typeof r=="number"&&(o=BigInt(Number.MAX_SAFE_INTEGER));const l=typeof o=="bigint"&&i?-o-1n:0;if(o&&s>o||s<l){const c=typeof r=="bigint"?"n":"";throw new yG({max:o?`${o}${c}`:void 0,min:`${l}${c}`,signed:i,size:n,value:`${r}${c}`})}const u=`0x${(i&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?Sf(u,{size:n}):u}const _G=new TextEncoder;function EG(r,e={}){const i=_G.encode(r);return HN(i,e)}const wG=new TextEncoder;function CG(r,e={}){return typeof r=="number"||typeof r=="bigint"?TG(r,e):typeof r=="boolean"?SG(r,e):Fw(r)?qN(r,e):MG(r,e)}function SG(r,e={}){const i=new Uint8Array(1);return i[0]=Number(r),typeof e.size=="number"?(S0(i,{size:e.size}),Sf(i,{size:e.size})):i}const tu={zero:48,nine:57,A:65,F:70,a:97,f:102};function QN(r){if(r>=tu.zero&&r<=tu.nine)return r-tu.zero;if(r>=tu.A&&r<=tu.F)return r-(tu.A-10);if(r>=tu.a&&r<=tu.f)return r-(tu.a-10)}function qN(r,e={}){let i=r;e.size&&(S0(i,{size:e.size}),i=Sf(i,{dir:"right",size:e.size}));let n=i.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,o=new Uint8Array(s);for(let l=0,u=0;l<s;l++){const c=QN(n.charCodeAt(u++)),d=QN(n.charCodeAt(u++));if(c===void 0||d===void 0)throw new jd(`Invalid byte sequence ("${n[u-2]}${n[u-1]}" in "${n}").`);o[l]=c*16+d}return o}function TG(r,e){const i=WN(r,e);return qN(i)}function MG(r,e={}){const i=wG.encode(r);return typeof e.size=="number"?(S0(i,{size:e.size}),Sf(i,{dir:"right",size:e.size})):i}function XN(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function RG(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function kw(r,...e){if(!RG(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function YN(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function IG(r,e){kw(r);const i=e.outputLen;if(r.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const Bv=BigInt(2**32-1),KN=BigInt(32);function BG(r,e=!1){return e?{h:Number(r&Bv),l:Number(r>>KN&Bv)}:{h:Number(r>>KN&Bv)|0,l:Number(r&Bv)|0}}function NG(r,e=!1){let i=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:o,l}=BG(r[s],e);[i[s],n[s]]=[o,l]}return[i,n]}const LG=(r,e,i)=>r<<i|e>>>32-i,DG=(r,e,i)=>e<<i|r>>>32-i,OG=(r,e,i)=>e<<i-32|r>>>64-i,PG=(r,e,i)=>r<<i-32|e>>>64-i;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function FG(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}const JN=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function kG(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function ZN(r){for(let e=0;e<r.length;e++)r[e]=kG(r[e])}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function UG(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function $N(r){return typeof r=="string"&&(r=UG(r)),kw(r),r}class zG{clone(){return this._cloneInto()}}function jG(r){const e=n=>r().update($N(n)).digest(),i=r();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>r(),e}const eL=[],tL=[],iL=[],VG=BigInt(0),T0=BigInt(1),GG=BigInt(2),HG=BigInt(7),WG=BigInt(256),QG=BigInt(113);for(let r=0,e=T0,i=1,n=0;r<24;r++){[i,n]=[n,(2*i+3*n)%5],eL.push(2*(5*n+i)),tL.push((r+1)*(r+2)/2%64);let s=VG;for(let o=0;o<7;o++)e=(e<<T0^(e>>HG)*QG)%WG,e&GG&&(s^=T0<<(T0<<BigInt(o))-T0);iL.push(s)}const[qG,XG]=NG(iL,!0),rL=(r,e,i)=>i>32?OG(r,e,i):LG(r,e,i),nL=(r,e,i)=>i>32?PG(r,e,i):DG(r,e,i);function YG(r,e=24){const i=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let l=0;l<10;l++)i[l]=r[l]^r[l+10]^r[l+20]^r[l+30]^r[l+40];for(let l=0;l<10;l+=2){const u=(l+8)%10,c=(l+2)%10,d=i[c],p=i[c+1],f=rL(d,p,1)^i[u],m=nL(d,p,1)^i[u+1];for(let g=0;g<50;g+=10)r[l+g]^=f,r[l+g+1]^=m}let s=r[2],o=r[3];for(let l=0;l<24;l++){const u=tL[l],c=rL(s,o,u),d=nL(s,o,u),p=eL[l];s=r[p],o=r[p+1],r[p]=c,r[p+1]=d}for(let l=0;l<50;l+=10){for(let u=0;u<10;u++)i[u]=r[l+u];for(let u=0;u<10;u++)r[l+u]^=~i[(u+2)%10]&i[(u+4)%10]}r[0]^=qG[n],r[1]^=XG[n]}i.fill(0)}class Uw extends zG{constructor(e,i,n,s=!1,o=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=i,this.outputLen=n,this.enableXOF=s,this.rounds=o,XN(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=FG(this.state)}keccak(){JN||ZN(this.state32),YG(this.state32,this.rounds),JN||ZN(this.state32),this.posOut=0,this.pos=0}update(e){YN(this);const{blockLen:i,state:n}=this;e=$N(e);const s=e.length;for(let o=0;o<s;){const l=Math.min(i-this.pos,s-o);for(let u=0;u<l;u++)n[this.pos++]^=e[o++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:n,blockLen:s}=this;e[n]^=i,i&128&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){YN(this,!1),kw(e),this.finish();const i=this.state,{blockLen:n}=this;for(let s=0,o=e.length;s<o;){this.posOut>=n&&this.keccak();const l=Math.min(n-this.posOut,o-s);e.set(i.subarray(this.posOut,this.posOut+l),s),this.posOut+=l,s+=l}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return XN(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(IG(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:i,suffix:n,outputLen:s,rounds:o,enableXOF:l}=this;return e||(e=new Uw(i,n,s,l,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=n,e.outputLen=s,e.enableXOF=l,e.destroyed=this.destroyed,e}}const KG=((r,e,i)=>jG(()=>new Uw(e,r,i)))(1,136,256/8);function JG(r,e){const i=KG(Fw(r,{strict:!1})?CG(r):r);return GN(i)}function sL(r,e){return function(){return r.apply(e,arguments)}}const{toString:ZG}=Object.prototype,{getPrototypeOf:zw}=Object,{iterator:Nv,toStringTag:aL}=Symbol,Lv=(r=>e=>{const i=ZG.call(e);return r[i]||(r[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Gl=r=>(r=r.toLowerCase(),e=>Lv(e)===r),Dv=r=>e=>typeof e===r,{isArray:Tf}=Array,M0=Dv("undefined");function $G(r){return r!==null&&!M0(r)&&r.constructor!==null&&!M0(r.constructor)&&Io(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const oL=Gl("ArrayBuffer");function eH(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&oL(r.buffer),e}const tH=Dv("string"),Io=Dv("function"),lL=Dv("number"),Ov=r=>r!==null&&typeof r=="object",iH=r=>r===!0||r===!1,Pv=r=>{if(Lv(r)!=="object")return!1;const e=zw(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(aL in r)&&!(Nv in r)},rH=Gl("Date"),nH=Gl("File"),sH=Gl("Blob"),aH=Gl("FileList"),oH=r=>Ov(r)&&Io(r.pipe),lH=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Io(r.append)&&((e=Lv(r))==="formdata"||e==="object"&&Io(r.toString)&&r.toString()==="[object FormData]"))},cH=Gl("URLSearchParams"),[uH,hH,dH,pH]=["ReadableStream","Request","Response","Headers"].map(Gl),fH=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function R0(r,e,{allOwnKeys:i=!1}={}){if(r===null||typeof r>"u")return;let n,s;if(typeof r!="object"&&(r=[r]),Tf(r))for(n=0,s=r.length;n<s;n++)e.call(null,r[n],n,r);else{const o=i?Object.getOwnPropertyNames(r):Object.keys(r),l=o.length;let u;for(n=0;n<l;n++)u=o[n],e.call(null,r[u],u,r)}}function cL(r,e){e=e.toLowerCase();const i=Object.keys(r);let n=i.length,s;for(;n-- >0;)if(s=i[n],e===s.toLowerCase())return s;return null}const Vd=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,uL=r=>!M0(r)&&r!==Vd;function jw(){const{caseless:r}=uL(this)&&this||{},e={},i=(n,s)=>{const o=r&&cL(e,s)||s;Pv(e[o])&&Pv(n)?e[o]=jw(e[o],n):Pv(n)?e[o]=jw({},n):Tf(n)?e[o]=n.slice():e[o]=n};for(let n=0,s=arguments.length;n<s;n++)arguments[n]&&R0(arguments[n],i);return e}const mH=(r,e,i,{allOwnKeys:n}={})=>(R0(e,(s,o)=>{i&&Io(s)?r[o]=sL(s,i):r[o]=s},{allOwnKeys:n}),r),gH=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),AH=(r,e,i,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),i&&Object.assign(r.prototype,i)},yH=(r,e,i,n)=>{let s,o,l;const u={};if(e=e||{},r==null)return e;do{for(s=Object.getOwnPropertyNames(r),o=s.length;o-- >0;)l=s[o],(!n||n(l,r,e))&&!u[l]&&(e[l]=r[l],u[l]=!0);r=i!==!1&&zw(r)}while(r&&(!i||i(r,e))&&r!==Object.prototype);return e},vH=(r,e,i)=>{r=String(r),(i===void 0||i>r.length)&&(i=r.length),i-=e.length;const n=r.indexOf(e,i);return n!==-1&&n===i},xH=r=>{if(!r)return null;if(Tf(r))return r;let e=r.length;if(!lL(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=r[e];return i},bH=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&zw(Uint8Array)),_H=(r,e)=>{const n=(r&&r[Nv]).call(r);let s;for(;(s=n.next())&&!s.done;){const o=s.value;e.call(r,o[0],o[1])}},EH=(r,e)=>{let i;const n=[];for(;(i=r.exec(e))!==null;)n.push(i);return n},wH=Gl("HTMLFormElement"),CH=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,s){return n.toUpperCase()+s}),hL=(({hasOwnProperty:r})=>(e,i)=>r.call(e,i))(Object.prototype),SH=Gl("RegExp"),dL=(r,e)=>{const i=Object.getOwnPropertyDescriptors(r),n={};R0(i,(s,o)=>{let l;(l=e(s,o,r))!==!1&&(n[o]=l||s)}),Object.defineProperties(r,n)},TH=r=>{dL(r,(e,i)=>{if(Io(r)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=r[i];if(Io(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},MH=(r,e)=>{const i={},n=s=>{s.forEach(o=>{i[o]=!0})};return Tf(r)?n(r):n(String(r).split(e)),i},RH=()=>{},IH=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function BH(r){return!!(r&&Io(r.append)&&r[aL]==="FormData"&&r[Nv])}const NH=r=>{const e=new Array(10),i=(n,s)=>{if(Ov(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[s]=n;const o=Tf(n)?[]:{};return R0(n,(l,u)=>{const c=i(l,s+1);!M0(c)&&(o[u]=c)}),e[s]=void 0,o}}return n};return i(r,0)},LH=Gl("AsyncFunction"),DH=r=>r&&(Ov(r)||Io(r))&&Io(r.then)&&Io(r.catch),pL=((r,e)=>r?setImmediate:e?((i,n)=>(Vd.addEventListener("message",({source:s,data:o})=>{s===Vd&&o===i&&n.length&&n.shift()()},!1),s=>{n.push(s),Vd.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",Io(Vd.postMessage)),OH=typeof queueMicrotask<"u"?queueMicrotask.bind(Vd):typeof process<"u"&&process.nextTick||pL,Vt={isArray:Tf,isArrayBuffer:oL,isBuffer:$G,isFormData:lH,isArrayBufferView:eH,isString:tH,isNumber:lL,isBoolean:iH,isObject:Ov,isPlainObject:Pv,isReadableStream:uH,isRequest:hH,isResponse:dH,isHeaders:pH,isUndefined:M0,isDate:rH,isFile:nH,isBlob:sH,isRegExp:SH,isFunction:Io,isStream:oH,isURLSearchParams:cH,isTypedArray:bH,isFileList:aH,forEach:R0,merge:jw,extend:mH,trim:fH,stripBOM:gH,inherits:AH,toFlatObject:yH,kindOf:Lv,kindOfTest:Gl,endsWith:vH,toArray:xH,forEachEntry:_H,matchAll:EH,isHTMLForm:wH,hasOwnProperty:hL,hasOwnProp:hL,reduceDescriptors:dL,freezeMethods:TH,toObjectSet:MH,toCamelCase:CH,noop:RH,toFiniteNumber:IH,findKey:cL,global:Vd,isContextDefined:uL,isSpecCompliantForm:BH,toJSONObject:NH,isAsyncFn:LH,isThenable:DH,setImmediate:pL,asap:OH,isIterable:r=>r!=null&&Io(r[Nv])};function Zr(r,e,i,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}Vt.inherits(Zr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Vt.toJSONObject(this.config),code:this.code,status:this.status}}});const fL=Zr.prototype,mL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{mL[r]={value:r}}),Object.defineProperties(Zr,mL),Object.defineProperty(fL,"isAxiosError",{value:!0}),Zr.from=(r,e,i,n,s,o)=>{const l=Object.create(fL);return Vt.toFlatObject(r,l,function(c){return c!==Error.prototype},u=>u!=="isAxiosError"),Zr.call(l,r.message,e,i,n,s),l.cause=r,l.name=r.name,o&&Object.assign(l,o),l};const PH=null;function Vw(r){return Vt.isPlainObject(r)||Vt.isArray(r)}function gL(r){return Vt.endsWith(r,"[]")?r.slice(0,-2):r}function AL(r,e,i){return r?r.concat(e).map(function(s,o){return s=gL(s),!i&&o?"["+s+"]":s}).join(i?".":""):e}function FH(r){return Vt.isArray(r)&&!r.some(Vw)}const kH=Vt.toFlatObject(Vt,{},null,function(e){return/^is[A-Z]/.test(e)});function Fv(r,e,i){if(!Vt.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,i=Vt.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,v){return!Vt.isUndefined(v[x])});const n=i.metaTokens,s=i.visitor||p,o=i.dots,l=i.indexes,c=(i.Blob||typeof Blob<"u"&&Blob)&&Vt.isSpecCompliantForm(e);if(!Vt.isFunction(s))throw new TypeError("visitor must be a function");function d(y){if(y===null)return"";if(Vt.isDate(y))return y.toISOString();if(!c&&Vt.isBlob(y))throw new Zr("Blob is not supported. Use a Buffer instead.");return Vt.isArrayBuffer(y)||Vt.isTypedArray(y)?c&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function p(y,x,v){let _=y;if(y&&!v&&typeof y=="object"){if(Vt.endsWith(x,"{}"))x=n?x:x.slice(0,-2),y=JSON.stringify(y);else if(Vt.isArray(y)&&FH(y)||(Vt.isFileList(y)||Vt.endsWith(x,"[]"))&&(_=Vt.toArray(y)))return x=gL(x),_.forEach(function(w,S){!(Vt.isUndefined(w)||w===null)&&e.append(l===!0?AL([x],S,o):l===null?x:x+"[]",d(w))}),!1}return Vw(y)?!0:(e.append(AL(v,x,o),d(y)),!1)}const f=[],m=Object.assign(kH,{defaultVisitor:p,convertValue:d,isVisitable:Vw});function g(y,x){if(!Vt.isUndefined(y)){if(f.indexOf(y)!==-1)throw Error("Circular reference detected in "+x.join("."));f.push(y),Vt.forEach(y,function(_,T){(!(Vt.isUndefined(_)||_===null)&&s.call(e,_,Vt.isString(T)?T.trim():T,x,m))===!0&&g(_,x?x.concat(T):[T])}),f.pop()}}if(!Vt.isObject(r))throw new TypeError("data must be an object");return g(r),e}function yL(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Gw(r,e){this._pairs=[],r&&Fv(r,this,e)}const vL=Gw.prototype;vL.append=function(e,i){this._pairs.push([e,i])},vL.toString=function(e){const i=e?function(n){return e.call(this,n,yL)}:yL;return this._pairs.map(function(s){return i(s[0])+"="+i(s[1])},"").join("&")};function UH(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function xL(r,e,i){if(!e)return r;const n=i&&i.encode||UH;Vt.isFunction(i)&&(i={serialize:i});const s=i&&i.serialize;let o;if(s?o=s(e,i):o=Vt.isURLSearchParams(e)?e.toString():new Gw(e,i).toString(n),o){const l=r.indexOf("#");l!==-1&&(r=r.slice(0,l)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}class bL{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Vt.forEach(this.handlers,function(n){n!==null&&e(n)})}}const _L={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},zH={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:Gw,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},Hw=typeof window<"u"&&typeof document<"u",Ww=typeof navigator=="object"&&navigator||void 0,jH=Hw&&(!Ww||["ReactNative","NativeScript","NS"].indexOf(Ww.product)<0),VH=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",GH=Hw&&window.location.href||"http://localhost",Ha={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Hw,hasStandardBrowserEnv:jH,hasStandardBrowserWebWorkerEnv:VH,navigator:Ww,origin:GH},Symbol.toStringTag,{value:"Module"})),...zH};function HH(r,e){return Fv(r,new Ha.classes.URLSearchParams,Object.assign({visitor:function(i,n,s,o){return Ha.isNode&&Vt.isBuffer(i)?(this.append(n,i.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function WH(r){return Vt.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function QH(r){const e={},i=Object.keys(r);let n;const s=i.length;let o;for(n=0;n<s;n++)o=i[n],e[o]=r[o];return e}function EL(r){function e(i,n,s,o){let l=i[o++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),c=o>=i.length;return l=!l&&Vt.isArray(s)?s.length:l,c?(Vt.hasOwnProp(s,l)?s[l]=[s[l],n]:s[l]=n,!u):((!s[l]||!Vt.isObject(s[l]))&&(s[l]=[]),e(i,n,s[l],o)&&Vt.isArray(s[l])&&(s[l]=QH(s[l])),!u)}if(Vt.isFormData(r)&&Vt.isFunction(r.entries)){const i={};return Vt.forEachEntry(r,(n,s)=>{e(WH(n),s,i,0)}),i}return null}function qH(r,e,i){if(Vt.isString(r))try{return(e||JSON.parse)(r),Vt.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(r)}const I0={transitional:_L,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const n=i.getContentType()||"",s=n.indexOf("application/json")>-1,o=Vt.isObject(e);if(o&&Vt.isHTMLForm(e)&&(e=new FormData(e)),Vt.isFormData(e))return s?JSON.stringify(EL(e)):e;if(Vt.isArrayBuffer(e)||Vt.isBuffer(e)||Vt.isStream(e)||Vt.isFile(e)||Vt.isBlob(e)||Vt.isReadableStream(e))return e;if(Vt.isArrayBufferView(e))return e.buffer;if(Vt.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return HH(e,this.formSerializer).toString();if((u=Vt.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Fv(u?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||s?(i.setContentType("application/json",!1),qH(e)):e}],transformResponse:[function(e){const i=this.transitional||I0.transitional,n=i&&i.forcedJSONParsing,s=this.responseType==="json";if(Vt.isResponse(e)||Vt.isReadableStream(e))return e;if(e&&Vt.isString(e)&&(n&&!this.responseType||s)){const l=!(i&&i.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(u){if(l)throw u.name==="SyntaxError"?Zr.from(u,Zr.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ha.classes.FormData,Blob:Ha.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Vt.forEach(["delete","get","head","post","put","patch"],r=>{I0.headers[r]={}});const XH=Vt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),YH=r=>{const e={};let i,n,s;return r&&r.split(`
`).forEach(function(l){s=l.indexOf(":"),i=l.substring(0,s).trim().toLowerCase(),n=l.substring(s+1).trim(),!(!i||e[i]&&XH[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},wL=Symbol("internals");function B0(r){return r&&String(r).trim().toLowerCase()}function kv(r){return r===!1||r==null?r:Vt.isArray(r)?r.map(kv):String(r)}function KH(r){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(r);)e[n[1]]=n[2];return e}const JH=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Qw(r,e,i,n,s){if(Vt.isFunction(n))return n.call(this,e,i);if(s&&(e=i),!!Vt.isString(e)){if(Vt.isString(n))return e.indexOf(n)!==-1;if(Vt.isRegExp(n))return n.test(e)}}function ZH(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function $H(r,e){const i=Vt.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+i,{value:function(s,o,l){return this[n].call(this,e,s,o,l)},configurable:!0})})}let Bo=class{constructor(e){e&&this.set(e)}set(e,i,n){const s=this;function o(u,c,d){const p=B0(c);if(!p)throw new Error("header name must be a non-empty string");const f=Vt.findKey(s,p);(!f||s[f]===void 0||d===!0||d===void 0&&s[f]!==!1)&&(s[f||c]=kv(u))}const l=(u,c)=>Vt.forEach(u,(d,p)=>o(d,p,c));if(Vt.isPlainObject(e)||e instanceof this.constructor)l(e,i);else if(Vt.isString(e)&&(e=e.trim())&&!JH(e))l(YH(e),i);else if(Vt.isObject(e)&&Vt.isIterable(e)){let u={},c,d;for(const p of e){if(!Vt.isArray(p))throw TypeError("Object iterator must return a key-value pair");u[d=p[0]]=(c=u[d])?Vt.isArray(c)?[...c,p[1]]:[c,p[1]]:p[1]}l(u,i)}else e!=null&&o(i,e,n);return this}get(e,i){if(e=B0(e),e){const n=Vt.findKey(this,e);if(n){const s=this[n];if(!i)return s;if(i===!0)return KH(s);if(Vt.isFunction(i))return i.call(this,s,n);if(Vt.isRegExp(i))return i.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=B0(e),e){const n=Vt.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||Qw(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let s=!1;function o(l){if(l=B0(l),l){const u=Vt.findKey(n,l);u&&(!i||Qw(n,n[u],u,i))&&(delete n[u],s=!0)}}return Vt.isArray(e)?e.forEach(o):o(e),s}clear(e){const i=Object.keys(this);let n=i.length,s=!1;for(;n--;){const o=i[n];(!e||Qw(this,this[o],o,e,!0))&&(delete this[o],s=!0)}return s}normalize(e){const i=this,n={};return Vt.forEach(this,(s,o)=>{const l=Vt.findKey(n,o);if(l){i[l]=kv(s),delete i[o];return}const u=e?ZH(o):String(o).trim();u!==o&&delete i[o],i[u]=kv(s),n[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Vt.forEach(this,(n,s)=>{n!=null&&n!==!1&&(i[s]=e&&Vt.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(s=>n.set(s)),n}static accessor(e){const n=(this[wL]=this[wL]={accessors:{}}).accessors,s=this.prototype;function o(l){const u=B0(l);n[u]||($H(s,l),n[u]=!0)}return Vt.isArray(e)?e.forEach(o):o(e),this}};Bo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Vt.reduceDescriptors(Bo.prototype,({value:r},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[i]=n}}}),Vt.freezeMethods(Bo);function qw(r,e){const i=this||I0,n=e||i,s=Bo.from(n.headers);let o=n.data;return Vt.forEach(r,function(u){o=u.call(i,o,s.normalize(),e?e.status:void 0)}),s.normalize(),o}function CL(r){return!!(r&&r.__CANCEL__)}function Mf(r,e,i){Zr.call(this,r??"canceled",Zr.ERR_CANCELED,e,i),this.name="CanceledError"}Vt.inherits(Mf,Zr,{__CANCEL__:!0});function SL(r,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?r(i):e(new Zr("Request failed with status code "+i.status,[Zr.ERR_BAD_REQUEST,Zr.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function eW(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function tW(r,e){r=r||10;const i=new Array(r),n=new Array(r);let s=0,o=0,l;return e=e!==void 0?e:1e3,function(c){const d=Date.now(),p=n[o];l||(l=d),i[s]=c,n[s]=d;let f=o,m=0;for(;f!==s;)m+=i[f++],f=f%r;if(s=(s+1)%r,s===o&&(o=(o+1)%r),d-l<e)return;const g=p&&d-p;return g?Math.round(m*1e3/g):void 0}}function iW(r,e){let i=0,n=1e3/e,s,o;const l=(d,p=Date.now())=>{i=p,s=null,o&&(clearTimeout(o),o=null),r.apply(null,d)};return[(...d)=>{const p=Date.now(),f=p-i;f>=n?l(d,p):(s=d,o||(o=setTimeout(()=>{o=null,l(s)},n-f)))},()=>s&&l(s)]}const Uv=(r,e,i=3)=>{let n=0;const s=tW(50,250);return iW(o=>{const l=o.loaded,u=o.lengthComputable?o.total:void 0,c=l-n,d=s(c),p=l<=u;n=l;const f={loaded:l,total:u,progress:u?l/u:void 0,bytes:c,rate:d||void 0,estimated:d&&u&&p?(u-l)/d:void 0,event:o,lengthComputable:u!=null,[e?"download":"upload"]:!0};r(f)},i)},TL=(r,e)=>{const i=r!=null;return[n=>e[0]({lengthComputable:i,total:r,loaded:n}),e[1]]},ML=r=>(...e)=>Vt.asap(()=>r(...e)),rW=Ha.hasStandardBrowserEnv?((r,e)=>i=>(i=new URL(i,Ha.origin),r.protocol===i.protocol&&r.host===i.host&&(e||r.port===i.port)))(new URL(Ha.origin),Ha.navigator&&/(msie|trident)/i.test(Ha.navigator.userAgent)):()=>!0,nW=Ha.hasStandardBrowserEnv?{write(r,e,i,n,s,o){const l=[r+"="+encodeURIComponent(e)];Vt.isNumber(i)&&l.push("expires="+new Date(i).toGMTString()),Vt.isString(n)&&l.push("path="+n),Vt.isString(s)&&l.push("domain="+s),o===!0&&l.push("secure"),document.cookie=l.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function sW(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function aW(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function RL(r,e,i){let n=!sW(e);return r&&(n||i==!1)?aW(r,e):e}const IL=r=>r instanceof Bo?{...r}:r;function Gd(r,e){e=e||{};const i={};function n(d,p,f,m){return Vt.isPlainObject(d)&&Vt.isPlainObject(p)?Vt.merge.call({caseless:m},d,p):Vt.isPlainObject(p)?Vt.merge({},p):Vt.isArray(p)?p.slice():p}function s(d,p,f,m){if(Vt.isUndefined(p)){if(!Vt.isUndefined(d))return n(void 0,d,f,m)}else return n(d,p,f,m)}function o(d,p){if(!Vt.isUndefined(p))return n(void 0,p)}function l(d,p){if(Vt.isUndefined(p)){if(!Vt.isUndefined(d))return n(void 0,d)}else return n(void 0,p)}function u(d,p,f){if(f in e)return n(d,p);if(f in r)return n(void 0,d)}const c={url:o,method:o,data:o,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(d,p,f)=>s(IL(d),IL(p),f,!0)};return Vt.forEach(Object.keys(Object.assign({},r,e)),function(p){const f=c[p]||s,m=f(r[p],e[p],p);Vt.isUndefined(m)&&f!==u||(i[p]=m)}),i}const BL=r=>{const e=Gd({},r);let{data:i,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:o,headers:l,auth:u}=e;e.headers=l=Bo.from(l),e.url=xL(RL(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),u&&l.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let c;if(Vt.isFormData(i)){if(Ha.hasStandardBrowserEnv||Ha.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((c=l.getContentType())!==!1){const[d,...p]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];l.setContentType([d||"multipart/form-data",...p].join("; "))}}if(Ha.hasStandardBrowserEnv&&(n&&Vt.isFunction(n)&&(n=n(e)),n||n!==!1&&rW(e.url))){const d=s&&o&&nW.read(o);d&&l.set(s,d)}return e},oW=typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(i,n){const s=BL(r);let o=s.data;const l=Bo.from(s.headers).normalize();let{responseType:u,onUploadProgress:c,onDownloadProgress:d}=s,p,f,m,g,y;function x(){g&&g(),y&&y(),s.cancelToken&&s.cancelToken.unsubscribe(p),s.signal&&s.signal.removeEventListener("abort",p)}let v=new XMLHttpRequest;v.open(s.method.toUpperCase(),s.url,!0),v.timeout=s.timeout;function _(){if(!v)return;const w=Bo.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),R={data:!u||u==="text"||u==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:w,config:r,request:v};SL(function(I){i(I),x()},function(I){n(I),x()},R),v=null}"onloadend"in v?v.onloadend=_:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(_)},v.onabort=function(){v&&(n(new Zr("Request aborted",Zr.ECONNABORTED,r,v)),v=null)},v.onerror=function(){n(new Zr("Network Error",Zr.ERR_NETWORK,r,v)),v=null},v.ontimeout=function(){let S=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const R=s.transitional||_L;s.timeoutErrorMessage&&(S=s.timeoutErrorMessage),n(new Zr(S,R.clarifyTimeoutError?Zr.ETIMEDOUT:Zr.ECONNABORTED,r,v)),v=null},o===void 0&&l.setContentType(null),"setRequestHeader"in v&&Vt.forEach(l.toJSON(),function(S,R){v.setRequestHeader(R,S)}),Vt.isUndefined(s.withCredentials)||(v.withCredentials=!!s.withCredentials),u&&u!=="json"&&(v.responseType=s.responseType),d&&([m,y]=Uv(d,!0),v.addEventListener("progress",m)),c&&v.upload&&([f,g]=Uv(c),v.upload.addEventListener("progress",f),v.upload.addEventListener("loadend",g)),(s.cancelToken||s.signal)&&(p=w=>{v&&(n(!w||w.type?new Mf(null,r,v):w),v.abort(),v=null)},s.cancelToken&&s.cancelToken.subscribe(p),s.signal&&(s.signal.aborted?p():s.signal.addEventListener("abort",p)));const T=eW(s.url);if(T&&Ha.protocols.indexOf(T)===-1){n(new Zr("Unsupported protocol "+T+":",Zr.ERR_BAD_REQUEST,r));return}v.send(o||null)})},lW=(r,e)=>{const{length:i}=r=r?r.filter(Boolean):[];if(e||i){let n=new AbortController,s;const o=function(d){if(!s){s=!0,u();const p=d instanceof Error?d:this.reason;n.abort(p instanceof Zr?p:new Mf(p instanceof Error?p.message:p))}};let l=e&&setTimeout(()=>{l=null,o(new Zr(`timeout ${e} of ms exceeded`,Zr.ETIMEDOUT))},e);const u=()=>{r&&(l&&clearTimeout(l),l=null,r.forEach(d=>{d.unsubscribe?d.unsubscribe(o):d.removeEventListener("abort",o)}),r=null)};r.forEach(d=>d.addEventListener("abort",o));const{signal:c}=n;return c.unsubscribe=()=>Vt.asap(u),c}},cW=function*(r,e){let i=r.byteLength;if(i<e){yield r;return}let n=0,s;for(;n<i;)s=n+e,yield r.slice(n,s),n=s},uW=async function*(r,e){for await(const i of hW(r))yield*cW(i,e)},hW=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:i,value:n}=await e.read();if(i)break;yield n}}finally{await e.cancel()}},NL=(r,e,i,n)=>{const s=uW(r,e);let o=0,l,u=c=>{l||(l=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:p}=await s.next();if(d){u(),c.close();return}let f=p.byteLength;if(i){let m=o+=f;i(m)}c.enqueue(new Uint8Array(p))}catch(d){throw u(d),d}},cancel(c){return u(c),s.return()}},{highWaterMark:2})},zv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",LL=zv&&typeof ReadableStream=="function",dW=zv&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),DL=(r,...e)=>{try{return!!r(...e)}catch{return!1}},pW=LL&&DL(()=>{let r=!1;const e=new Request(Ha.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),OL=64*1024,Xw=LL&&DL(()=>Vt.isReadableStream(new Response("").body)),jv={stream:Xw&&(r=>r.body)};zv&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!jv[e]&&(jv[e]=Vt.isFunction(r[e])?i=>i[e]():(i,n)=>{throw new Zr(`Response type '${e}' is not supported`,Zr.ERR_NOT_SUPPORT,n)})})})(new Response);const fW=async r=>{if(r==null)return 0;if(Vt.isBlob(r))return r.size;if(Vt.isSpecCompliantForm(r))return(await new Request(Ha.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(Vt.isArrayBufferView(r)||Vt.isArrayBuffer(r))return r.byteLength;if(Vt.isURLSearchParams(r)&&(r=r+""),Vt.isString(r))return(await dW(r)).byteLength},mW=async(r,e)=>{const i=Vt.toFiniteNumber(r.getContentLength());return i??fW(e)},Yw={http:PH,xhr:oW,fetch:zv&&(async r=>{let{url:e,method:i,data:n,signal:s,cancelToken:o,timeout:l,onDownloadProgress:u,onUploadProgress:c,responseType:d,headers:p,withCredentials:f="same-origin",fetchOptions:m}=BL(r);d=d?(d+"").toLowerCase():"text";let g=lW([s,o&&o.toAbortSignal()],l),y;const x=g&&g.unsubscribe&&(()=>{g.unsubscribe()});let v;try{if(c&&pW&&i!=="get"&&i!=="head"&&(v=await mW(p,n))!==0){let R=new Request(e,{method:"POST",body:n,duplex:"half"}),B;if(Vt.isFormData(n)&&(B=R.headers.get("content-type"))&&p.setContentType(B),R.body){const[I,D]=TL(v,Uv(ML(c)));n=NL(R.body,OL,I,D)}}Vt.isString(f)||(f=f?"include":"omit");const _="credentials"in Request.prototype;y=new Request(e,{...m,signal:g,method:i.toUpperCase(),headers:p.normalize().toJSON(),body:n,duplex:"half",credentials:_?f:void 0});let T=await fetch(y);const w=Xw&&(d==="stream"||d==="response");if(Xw&&(u||w&&x)){const R={};["status","statusText","headers"].forEach(L=>{R[L]=T[L]});const B=Vt.toFiniteNumber(T.headers.get("content-length")),[I,D]=u&&TL(B,Uv(ML(u),!0))||[];T=new Response(NL(T.body,OL,I,()=>{D&&D(),x&&x()}),R)}d=d||"text";let S=await jv[Vt.findKey(jv,d)||"text"](T,r);return!w&&x&&x(),await new Promise((R,B)=>{SL(R,B,{data:S,headers:Bo.from(T.headers),status:T.status,statusText:T.statusText,config:r,request:y})})}catch(_){throw x&&x(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new Zr("Network Error",Zr.ERR_NETWORK,r,y),{cause:_.cause||_}):Zr.from(_,_&&_.code,r,y)}})};Vt.forEach(Yw,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const PL=r=>`- ${r}`,gW=r=>Vt.isFunction(r)||r===null||r===!1,FL={getAdapter:r=>{r=Vt.isArray(r)?r:[r];const{length:e}=r;let i,n;const s={};for(let o=0;o<e;o++){i=r[o];let l;if(n=i,!gW(i)&&(n=Yw[(l=String(i)).toLowerCase()],n===void 0))throw new Zr(`Unknown adapter '${l}'`);if(n)break;s[l||"#"+o]=n}if(!n){const o=Object.entries(s).map(([u,c])=>`adapter ${u} `+(c===!1?"is not supported by the environment":"is not available in the build"));let l=e?o.length>1?`since :
`+o.map(PL).join(`
`):" "+PL(o[0]):"as no adapter specified";throw new Zr("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return n},adapters:Yw};function Kw(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Mf(null,r)}function kL(r){return Kw(r),r.headers=Bo.from(r.headers),r.data=qw.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),FL.getAdapter(r.adapter||I0.adapter)(r).then(function(n){return Kw(r),n.data=qw.call(r,r.transformResponse,n),n.headers=Bo.from(n.headers),n},function(n){return CL(n)||(Kw(r),n&&n.response&&(n.response.data=qw.call(r,r.transformResponse,n.response),n.response.headers=Bo.from(n.response.headers))),Promise.reject(n)})}const UL="1.9.0",Vv={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Vv[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const zL={};Vv.transitional=function(e,i,n){function s(o,l){return"[Axios v"+UL+"] Transitional option '"+o+"'"+l+(n?". "+n:"")}return(o,l,u)=>{if(e===!1)throw new Zr(s(l," has been removed"+(i?" in "+i:"")),Zr.ERR_DEPRECATED);return i&&!zL[l]&&(zL[l]=!0,console.warn(s(l," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(o,l,u):!0}},Vv.spelling=function(e){return(i,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function AW(r,e,i){if(typeof r!="object")throw new Zr("options must be an object",Zr.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let s=n.length;for(;s-- >0;){const o=n[s],l=e[o];if(l){const u=r[o],c=u===void 0||l(u,o,r);if(c!==!0)throw new Zr("option "+o+" must be "+c,Zr.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Zr("Unknown option "+o,Zr.ERR_BAD_OPTION)}}const Gv={assertOptions:AW,validators:Vv},Rc=Gv.validators;let Hd=class{constructor(e){this.defaults=e||{},this.interceptors={request:new bL,response:new bL}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const o=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Gd(this.defaults,i);const{transitional:n,paramsSerializer:s,headers:o}=i;n!==void 0&&Gv.assertOptions(n,{silentJSONParsing:Rc.transitional(Rc.boolean),forcedJSONParsing:Rc.transitional(Rc.boolean),clarifyTimeoutError:Rc.transitional(Rc.boolean)},!1),s!=null&&(Vt.isFunction(s)?i.paramsSerializer={serialize:s}:Gv.assertOptions(s,{encode:Rc.function,serialize:Rc.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),Gv.assertOptions(i,{baseUrl:Rc.spelling("baseURL"),withXsrfToken:Rc.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let l=o&&Vt.merge(o.common,o[i.method]);o&&Vt.forEach(["delete","get","head","post","put","patch","common"],y=>{delete o[y]}),i.headers=Bo.concat(l,o);const u=[];let c=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(i)===!1||(c=c&&x.synchronous,u.unshift(x.fulfilled,x.rejected))});const d=[];this.interceptors.response.forEach(function(x){d.push(x.fulfilled,x.rejected)});let p,f=0,m;if(!c){const y=[kL.bind(this),void 0];for(y.unshift.apply(y,u),y.push.apply(y,d),m=y.length,p=Promise.resolve(i);f<m;)p=p.then(y[f++],y[f++]);return p}m=u.length;let g=i;for(f=0;f<m;){const y=u[f++],x=u[f++];try{g=y(g)}catch(v){x.call(this,v);break}}try{p=kL.call(this,g)}catch(y){return Promise.reject(y)}for(f=0,m=d.length;f<m;)p=p.then(d[f++],d[f++]);return p}getUri(e){e=Gd(this.defaults,e);const i=RL(e.baseURL,e.url,e.allowAbsoluteUrls);return xL(i,e.params,e.paramsSerializer)}};Vt.forEach(["delete","get","head","options"],function(e){Hd.prototype[e]=function(i,n){return this.request(Gd(n||{},{method:e,url:i,data:(n||{}).data}))}}),Vt.forEach(["post","put","patch"],function(e){function i(n){return function(o,l,u){return this.request(Gd(u||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:l}))}}Hd.prototype[e]=i(),Hd.prototype[e+"Form"]=i(!0)});let yW=class ZV{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(o){i=o});const n=this;this.promise.then(s=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](s);n._listeners=null}),this.promise.then=s=>{let o;const l=new Promise(u=>{n.subscribe(u),o=u}).then(s);return l.cancel=function(){n.unsubscribe(o)},l},e(function(o,l,u){n.reason||(n.reason=new Mf(o,l,u),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=n=>{e.abort(n)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new ZV(function(s){e=s}),cancel:e}}};function vW(r){return function(i){return r.apply(null,i)}}function xW(r){return Vt.isObject(r)&&r.isAxiosError===!0}const Jw={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Jw).forEach(([r,e])=>{Jw[e]=r});function jL(r){const e=new Hd(r),i=sL(Hd.prototype.request,e);return Vt.extend(i,Hd.prototype,e,{allOwnKeys:!0}),Vt.extend(i,e,null,{allOwnKeys:!0}),i.create=function(s){return jL(Gd(r,s))},i}const Cs=jL(I0);Cs.Axios=Hd,Cs.CanceledError=Mf,Cs.CancelToken=yW,Cs.isCancel=CL,Cs.VERSION=UL,Cs.toFormData=Fv,Cs.AxiosError=Zr,Cs.Cancel=Cs.CanceledError,Cs.all=function(e){return Promise.all(e)},Cs.spread=vW,Cs.isAxiosError=xW,Cs.mergeConfig=Gd,Cs.AxiosHeaders=Bo,Cs.formToJSON=r=>EL(Vt.isHTMLForm(r)?new FormData(r):r),Cs.getAdapter=FL.getAdapter,Cs.HttpStatusCode=Jw,Cs.default=Cs;const{Axios:AMe,AxiosError:yMe,CanceledError:vMe,isCancel:xMe,CancelToken:bMe,VERSION:_Me,all:EMe,Cancel:wMe,isAxiosError:CMe,spread:SMe,toFormData:TMe,AxiosHeaders:MMe,HttpStatusCode:RMe,formToJSON:IMe,getAdapter:BMe,mergeConfig:NMe}=Cs,VL=r=>{localStorage.setItem("auth_token",r)},Zw=()=>localStorage.getItem("auth_token"),Hv=()=>!!Zw(),bW=()=>{localStorage.removeItem("auth_token")},$w=()=>{const r=Zw();return r?`Bearer ${r}`:""};let Wv=null;const Qv=()=>{if(!Wv)throw new Error("Configuration Player-map non initialise. Utilisez PlayerMapConfig.init() pour configurer la bibliothque.");return{...Wv}},_W=r=>{if(!r.apiUrl)throw new Error("L'URL de l'API est requise pour initialiser Player-map");Wv={apiUrl:r.apiUrl},console.log("Configuration Player-map initialise:",Wv)},EW=async r=>{try{if(!Hv())throw new Error("Vous devez tre connect pour envoyer des donnes  IPFS");const{apiUrl:e}=Qv(),i=`${e}/ipfs/hash_data`;console.log("Hashing data to:",i);const n=await Cs.post(i,{data:r},{headers:{"Content-Type":"application/json",Authorization:$w()}});return{ipfsHash:n.data.ipfs_hash,httpUrl:n.data.http_url}}catch(e){throw e instanceof Error&&e.message.includes("Configuration Player-map non initialise")?(console.error("Erreur de configuration Player-map:",e.message),new Error("Erreur de configuration: Initialisez la bibliothque Player-map avec PlayerMapConfig.init() avant utilisation")):(console.error("Erreur lors du hachage de donnes vers IPFS:",e),e)}},GL=async r=>{try{const e=new FormData;if(e.append("file",r),!Hv())throw new Error("Vous devez tre connect pour tlverser des fichiers");const{apiUrl:i}=Qv(),n=`${i}/ipfs/upload_file`;return console.log("Uploading to:",n),(await Cs.post(n,e,{headers:{"Content-Type":"multipart/form-data",Authorization:$w()}})).data.ipfs_url}catch(e){throw e instanceof Error&&e.message.includes("Configuration Player-map non initialise")?(console.error("Erreur de configuration Player-map:",e.message),new Error("Erreur de configuration: Initialisez la bibliothque Player-map avec PlayerMapConfig.init() avant utilisation")):(console.error("Erreur lors du tlversement vers le serveur:",e),new Error("chec du tlversement de l'image vers IPFS"))}},qv=r=>r?r.startsWith("ipfs://"):!1,e2=async r=>{if(!qv(r))return r;try{let e=sessionStorage.getItem("ipfs_gateway");if(!e){if(!Hv())throw new Error("Vous devez tre connect pour accder  la passerelle IPFS");const{apiUrl:n}=Qv();if(e=(await Cs.get(`${n}/ipfs/gateway_url`,{headers:{Authorization:$w()}})).data.gateway_url,e)sessionStorage.setItem("ipfs_gateway",e);else throw new Error("Aucune passerelle IPFS configure")}const i=r.replace("ipfs://","");return`https://${e}/ipfs/${i}`}catch(e){throw e instanceof Error&&e.message.includes("Configuration Player-map non initialise")?(console.error("Erreur de configuration Player-map:",e.message),new Error("Erreur de configuration: Initialisez la bibliothque Player-map avec PlayerMapConfig.init() avant utilisation")):(console.error("Erreur lors de la rcupration du gateway URL:",e),e)}},HL=({walletConnected:r,walletAddress:e,publicClient:i})=>({createAtom:async s=>{if(!r||!e)throw new Error("Wallet not connected");try{const o={"@context":"https://schema.org/","@type":"Thing",...s};o.image&&qv(o.image)&&(o.image=await e2(o.image));const{ipfsHash:l}=await EW(o),u=GN(l),c=JG(u),d=i||r;try{const m=await d.readContract({address:Vl,abi:eu,functionName:"atomsByHash",args:[c]});if(m&&BigInt(m)!==0n)return{atomId:BigInt(m),ipfsHash:l}}catch(m){console.error("Error checking if atom exists:",m)}console.log("Creating atom...",{address:Vl,hexData:u,value:FN});const p=await r.writeContract({address:Vl,abi:eu,functionName:"createAtom",args:[u],value:FN});console.log("Transaction hash:",p);let f;r.waitForTransactionReceipt?f=await r.waitForTransactionReceipt({hash:p}):p.wait?f=await p.wait():(console.log("No wait method available, waiting 3 seconds..."),await new Promise(m=>setTimeout(m,3e3))),console.log("Transaction receipt:",f);try{const m=await d.readContract({address:Vl,abi:eu,functionName:"atomsByHash",args:[c]});return console.log("New atom ID:",m),{atomId:BigInt(m),ipfsHash:l}}catch(m){if(console.error("Error reading new atom ID:",m),i&&d!==i)try{const g=await i.readContract({address:Vl,abi:eu,functionName:"atomsByHash",args:[c]});return{atomId:BigInt(g),ipfsHash:l}}catch(g){console.error("Failed second attempt to read atom ID:",g)}return{atomId:1n,ipfsHash:l}}}catch(o){throw console.error("Error creating atom:",o),o}}}),WL=({isOpen:r,onClose:e,walletConnected:i,walletAddress:n,wagmiConfig:s,walletHooks:o})=>{const[l,u]=Ei.useState({pseudo:"",userId:"",image:""}),[c,d]=Ei.useState(!1),[p,f]=Ei.useState(!1),[m,g]=Ei.useState(!1),[y,x]=Ei.useState(null);s==null||s.publicClient;const[v,_]=Ei.useState(!1),T=Ei.useRef(null),{createAtom:w}=HL({walletConnected:i,walletAddress:n});Ei.useEffect(()=>{(async()=>{if(!(!n||!i))try{const D=await i.readContract({address:Vl,abi:eu,functionName:"balanceOf",args:[n]});d(D>0)}catch(D){console.error("Error checking atom balance:",D)}})()},[n,i]);const S=I=>{const{name:D,value:L}=I.target;u(O=>({...O,[D]:L}))},R=async I=>{if(!I.target.files||I.target.files.length===0)return;const D=I.target.files[0];try{_(!0);const L=await GL(D);u(O=>({...O,image:L})),_(!1)}catch(L){console.error("Erreur lors du tlversement de l'image:",L),alert("Erreur lors du tlversement de l'image. Veuillez ressayer."),_(!1)}},B=async()=>{if(!n||!i){alert("Please connect your wallet first");return}if(c){alert("You already have an atom!");return}if(!l.pseudo||!l.userId){alert("Please fill in all fields");return}try{f(!0);const I=await w({name:l.pseudo,description:l.userId,image:l.image||void 0});x(I.atomId.toString()),g(!0),f(!1),setTimeout(()=>{e()},3e3)}catch(I){console.error("Error creating atom:",I),alert("Error creating atom. Please try again."),f(!1)}};return r?Mt.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:Mt.jsxs("div",{style:{backgroundColor:"#101020",color:"#fff",padding:"30px",borderRadius:"10px",maxWidth:"760px",width:"90%",position:"relative",border:"1px solid #FFD32A"},children:[Mt.jsxs("div",{style:{position:"absolute",top:"40px",right:"10px",fontSize:"10px",color:"#666",textAlign:"left",backgroundColor:"rgba(0,0,0,0.3)",padding:"5px",borderRadius:"3px",maxWidth:"200px",overflow:"hidden"},children:[Mt.jsxs("div",{children:["Wallet:"," ",n?n.slice(0,6)+"..."+n.slice(-4):"Not connected"]}),Mt.jsxs("div",{children:["Connected: ",String(!!i)]}),Mt.jsxs("div",{children:["Has Atom: ",String(c)]})]}),Mt.jsx("button",{onClick:e,style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"transparent",border:"none",color:"#fff",fontSize:"20px",cursor:"pointer"},children:""}),Mt.jsxs("div",{style:{textAlign:"center",marginBottom:"20px"},children:[Mt.jsx("img",{src:Pw,alt:"Intuition Logo",style:{width:"120px",marginBottom:"10px"}}),Mt.jsx("h3",{style:{color:"#FFD32A",fontSize:"1em",margin:"10px 0"},children:"CREATE YOUR ATOM"}),Mt.jsxs("p",{style:{fontSize:"0.8em",color:"#aaa"},children:["Rseau: Base Sepolia (Chain ID: ",PN,")"]})]}),m?Mt.jsxs("div",{style:{textAlign:"center",color:"#4CAF50"},children:[Mt.jsx("h3",{style:{color:"#4CAF50",marginBottom:"10px"},children:"Success!"}),Mt.jsx("p",{children:"Your atom has been created successfully."}),Mt.jsxs("p",{children:["Atom ID: ",y]}),Mt.jsx("p",{children:"This window will close automatically..."})]}):n?c?Mt.jsx("p",{style:{textAlign:"center",color:"#ff4444"},children:"You already have an atom associated with this wallet"}):Mt.jsxs(Mt.Fragment,{children:[Mt.jsxs("div",{style:{marginBottom:"15px"},children:[Mt.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Pseudo"}),Mt.jsx("input",{type:"text",name:"pseudo",value:l.pseudo,onChange:S,placeholder:"Enter your pseudo",style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"}})]}),Mt.jsxs("div",{style:{marginBottom:"15px"},children:[Mt.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"User ID"}),Mt.jsx("input",{type:"text",name:"userId",value:l.userId,onChange:S,placeholder:"Enter your BossFighters user ID",style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"}})]}),Mt.jsxs("div",{style:{marginBottom:"15px"},children:[Mt.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Profile picture (optional)"}),Mt.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[Mt.jsxs("div",{children:[Mt.jsx("button",{onClick:()=>{var I;return(I=T.current)==null?void 0:I.click()},style:{padding:"8px 15px",backgroundColor:"#2e2e40",color:"#fff",border:"1px solid #333",borderRadius:"4px",cursor:"pointer",marginRight:"10px"},disabled:v,children:v?"Uploading...":"Choose an image"}),Mt.jsx("input",{ref:T,type:"file",accept:"image/*",onChange:R,style:{display:"none"}})]}),Mt.jsx("p",{style:{fontSize:"0.8em",color:"#aaa",marginTop:"0px"},children:"This image will be used as your Atom's profile picture."}),l.image&&Mt.jsxs("div",{style:{marginTop:"10px"},children:[Mt.jsx("p",{style:{fontSize:"0.8em",color:"#aaa",marginBottom:"5px"},children:"Preview of the image:"}),Mt.jsx(wW,{src:l.image})]})]})]}),Mt.jsx("div",{style:{textAlign:"center"},children:Mt.jsx("button",{onClick:B,disabled:p||v,style:{padding:"8px 20px",backgroundColor:"#FFD32A",color:"#000",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",opacity:p||v?.7:1},children:p?"Creation...":"CREATE YOUR ATOM"})})]}):Mt.jsx("div",{children:Mt.jsx("p",{style:{textAlign:"center",color:"#ff4444"},children:"Please connect your wallet first"})})]})}):null},wW=({src:r})=>{const[e,i]=Ei.useState(null);return Ei.useEffect(()=>{(async()=>{if(qv(r)){const s=await e2(r);i(s)}else i(r)})()},[r]),e?Mt.jsx("img",{src:e,alt:"preview",style:{width:"100%",maxHeight:"150px",objectFit:"contain"}}):Mt.jsx("div",{children:"Loading image..."})},QL=({walletConnected:r,walletAddress:e,wagmiConfig:i,walletHooks:n,onClose:s,isOpen:o,onCreatePlayer:l})=>{const[u,c]=Ei.useState(!1),d=()=>{c(!0)},p=()=>{c(!1),s&&s()},f=()=>{l?l():d()};return Mt.jsxs("div",{style:{backgroundColor:"#101020",color:"#fff",padding:"20px",textAlign:"center",border:"4px solid #0078D4",borderRadius:"5px",display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"960px",margin:"0 auto",position:"relative",overflow:"hidden"},children:[Mt.jsx("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"4px",backgroundColor:"#0078D4"}}),Mt.jsx("div",{style:{position:"absolute",bottom:"0",left:"0",width:"100%",height:"4px",backgroundColor:"#0078D4"}}),Mt.jsx("img",{src:Pw,alt:"Intuition Logo",style:{width:"200px",marginBottom:"10px",marginTop:"20px"}}),Mt.jsx("h2",{style:{fontSize:"1.2em",margin:"0 0 20px 0",color:"#FFD32A"},children:"BOSS FIGHTERS COMMUNITY PLAYER MAP"}),Mt.jsxs("div",{style:{maxWidth:"80%",margin:"0 auto"},children:[Mt.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"At first, there was nothing. And then, suddenly, the whole community appeared !"}),Mt.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Everything of which the Boss Fighters community would one day be composed, would be born in an instant."}),Mt.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"A single species of condensed matter, exploding in a vast universe."}),Mt.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Although energy would neither be created nor destroyed, the interaction between these newly-created atoms would continue to create something beautiful..."}),Mt.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"What had been separate would become whole again. And what would be created in the process would be even more beautiful than what came before..."}),Mt.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Our story begins with the atom. The cornerstone of our ecosystem."}),Mt.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:'And our "atoms" start with you !'}),Mt.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Every contribution will help build our ecosystem and make it healthy..."})]}),Mt.jsxs("div",{style:{border:"1px solid #FFD32A",borderRadius:"10px",padding:"15px",margin:"20px 0",display:"inline-block",backgroundColor:"rgba(0, 0, 0, 0.3)",width:"80%",maxWidth:"700px"},children:[Mt.jsx("p",{style:{fontSize:"0.9em",margin:"0 0 10px 0",textAlign:"left"},children:'Claims in Intuition, also referred to as "Triples" structured in Semantic Triple format :'}),Mt.jsx("p",{style:{fontSize:"0.9em",margin:"0 0 10px 0",textAlign:"left"},children:"[Subject]  [Predicate]  [Object] (For example, a triple could be : [SciFi] [is] [strong Boss])"}),Mt.jsx("p",{style:{fontSize:"0.9em",margin:"0",textAlign:"left"},children:"This keeps our attestations tidy !"})]}),Mt.jsx("button",{onClick:f,style:{marginTop:"20px",marginBottom:"20px",padding:"10px 20px",backgroundColor:"#FFD32A",color:"#000",border:"none",cursor:"pointer",borderRadius:"5px",fontSize:"1em",fontWeight:"bold"},children:"CREATE YOUR PLAYER"}),Mt.jsx(WL,{isOpen:u,onClose:p,walletConnected:r,walletAddress:e,wagmiConfig:i,walletHooks:n})]})};var CW=Object.defineProperty,SW=(r,e,i)=>e in r?CW(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i,N0=(r,e,i)=>SW(r,typeof e!="symbol"?e+"":e,i);function t2(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function i2(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var i=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(i,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),i}var r2={exports:{}},L0={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qL;function TW(){if(qL)return L0;qL=1;var r=Ei,e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(u,c,d){var p,f={},m=null,g=null;d!==void 0&&(m=""+d),c.key!==void 0&&(m=""+c.key),c.ref!==void 0&&(g=c.ref);for(p in c)n.call(c,p)&&!o.hasOwnProperty(p)&&(f[p]=c[p]);if(u&&u.defaultProps)for(p in c=u.defaultProps,c)f[p]===void 0&&(f[p]=c[p]);return{$$typeof:e,type:u,key:m,ref:g,props:f,_owner:s.current}}return L0.Fragment=i,L0.jsx=l,L0.jsxs=l,L0}var Xv={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XL;function MW(){return XL||(XL=1,process.env.NODE_ENV!=="production"&&function(){var r=Ei,e=Symbol.for("react.element"),i=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.offscreen"),y=Symbol.iterator,x="@@iterator";function v(me){if(me===null||typeof me!="object")return null;var ct=y&&me[y]||me[x];return typeof ct=="function"?ct:null}var _=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function T(me){{for(var ct=arguments.length,St=new Array(ct>1?ct-1:0),Xt=1;Xt<ct;Xt++)St[Xt-1]=arguments[Xt];w("error",me,St)}}function w(me,ct,St){{var Xt=_.ReactDebugCurrentFrame,Ii=Xt.getStackAddendum();Ii!==""&&(ct+="%s",St=St.concat([Ii]));var sr=St.map(function(Ni){return String(Ni)});sr.unshift("Warning: "+ct),Function.prototype.apply.call(console[me],console,sr)}}var S=!1,R=!1,B=!1,I=!1,D=!1,L;L=Symbol.for("react.module.reference");function O(me){return!!(typeof me=="string"||typeof me=="function"||me===n||me===o||D||me===s||me===d||me===p||I||me===g||S||R||B||typeof me=="object"&&me!==null&&(me.$$typeof===m||me.$$typeof===f||me.$$typeof===l||me.$$typeof===u||me.$$typeof===c||me.$$typeof===L||me.getModuleId!==void 0))}function U(me,ct,St){var Xt=me.displayName;if(Xt)return Xt;var Ii=ct.displayName||ct.name||"";return Ii!==""?St+"("+Ii+")":St}function J(me){return me.displayName||"Context"}function H(me){if(me==null)return null;if(typeof me.tag=="number"&&T("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof me=="function")return me.displayName||me.name||null;if(typeof me=="string")return me;switch(me){case n:return"Fragment";case i:return"Portal";case o:return"Profiler";case s:return"StrictMode";case d:return"Suspense";case p:return"SuspenseList"}if(typeof me=="object")switch(me.$$typeof){case u:var ct=me;return J(ct)+".Consumer";case l:var St=me;return J(St._context)+".Provider";case c:return U(me,me.render,"ForwardRef");case f:var Xt=me.displayName||null;return Xt!==null?Xt:H(me.type)||"Memo";case m:{var Ii=me,sr=Ii._payload,Ni=Ii._init;try{return H(Ni(sr))}catch{return null}}}return null}var V=Object.assign,$=0,Q,G,j,ie,Y,ae,xe;function fe(){}fe.__reactDisabledLog=!0;function de(){{if($===0){Q=console.log,G=console.info,j=console.warn,ie=console.error,Y=console.group,ae=console.groupCollapsed,xe=console.groupEnd;var me={configurable:!0,enumerable:!0,value:fe,writable:!0};Object.defineProperties(console,{info:me,log:me,warn:me,error:me,group:me,groupCollapsed:me,groupEnd:me})}$++}}function Ie(){{if($--,$===0){var me={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:V({},me,{value:Q}),info:V({},me,{value:G}),warn:V({},me,{value:j}),error:V({},me,{value:ie}),group:V({},me,{value:Y}),groupCollapsed:V({},me,{value:ae}),groupEnd:V({},me,{value:xe})})}$<0&&T("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Ge=_.ReactCurrentDispatcher,Xe;function $e(me,ct,St){{if(Xe===void 0)try{throw Error()}catch(Ii){var Xt=Ii.stack.trim().match(/\n( *(at )?)/);Xe=Xt&&Xt[1]||""}return`
`+Xe+me}}var lt=!1,At;{var Gt=typeof WeakMap=="function"?WeakMap:Map;At=new Gt}function gt(me,ct){if(!me||lt)return"";{var St=At.get(me);if(St!==void 0)return St}var Xt;lt=!0;var Ii=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var sr;sr=Ge.current,Ge.current=null,de();try{if(ct){var Ni=function(){throw Error()};if(Object.defineProperty(Ni.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ni,[])}catch(ot){Xt=ot}Reflect.construct(me,[],Ni)}else{try{Ni.call()}catch(ot){Xt=ot}me.call(Ni.prototype)}}else{try{throw Error()}catch(ot){Xt=ot}me()}}catch(ot){if(ot&&Xt&&typeof ot.stack=="string"){for(var Oi=ot.stack.split(`
`),Be=Xt.stack.split(`
`),se=Oi.length-1,ge=Be.length-1;se>=1&&ge>=0&&Oi[se]!==Be[ge];)ge--;for(;se>=1&&ge>=0;se--,ge--)if(Oi[se]!==Be[ge]){if(se!==1||ge!==1)do if(se--,ge--,ge<0||Oi[se]!==Be[ge]){var Ne=`
`+Oi[se].replace(" at new "," at ");return me.displayName&&Ne.includes("<anonymous>")&&(Ne=Ne.replace("<anonymous>",me.displayName)),typeof me=="function"&&At.set(me,Ne),Ne}while(se>=1&&ge>=0);break}}}finally{lt=!1,Ge.current=sr,Ie(),Error.prepareStackTrace=Ii}var ke=me?me.displayName||me.name:"",Ke=ke?$e(ke):"";return typeof me=="function"&&At.set(me,Ke),Ke}function yi(me,ct,St){return gt(me,!1)}function Ze(me){var ct=me.prototype;return!!(ct&&ct.isReactComponent)}function ki(me,ct,St){if(me==null)return"";if(typeof me=="function")return gt(me,Ze(me));if(typeof me=="string")return $e(me);switch(me){case d:return $e("Suspense");case p:return $e("SuspenseList")}if(typeof me=="object")switch(me.$$typeof){case c:return yi(me.render);case f:return ki(me.type,ct,St);case m:{var Xt=me,Ii=Xt._payload,sr=Xt._init;try{return ki(sr(Ii),ct,St)}catch{}}}return""}var hi=Object.prototype.hasOwnProperty,Ri={},Si=_.ReactDebugCurrentFrame;function tr(me){if(me){var ct=me._owner,St=ki(me.type,me._source,ct?ct.type:null);Si.setExtraStackFrame(St)}else Si.setExtraStackFrame(null)}function Vi(me,ct,St,Xt,Ii){{var sr=Function.call.bind(hi);for(var Ni in me)if(sr(me,Ni)){var Oi=void 0;try{if(typeof me[Ni]!="function"){var Be=Error((Xt||"React class")+": "+St+" type `"+Ni+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof me[Ni]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Be.name="Invariant Violation",Be}Oi=me[Ni](ct,Ni,Xt,St,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(se){Oi=se}Oi&&!(Oi instanceof Error)&&(tr(Ii),T("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Xt||"React class",St,Ni,typeof Oi),tr(null)),Oi instanceof Error&&!(Oi.message in Ri)&&(Ri[Oi.message]=!0,tr(Ii),T("Failed %s type: %s",St,Oi.message),tr(null))}}}var Qe=Array.isArray;function Ce(me){return Qe(me)}function yt(me){{var ct=typeof Symbol=="function"&&Symbol.toStringTag,St=ct&&me[Symbol.toStringTag]||me.constructor.name||"Object";return St}}function Ot(me){try{return Jt(me),!1}catch{return!0}}function Jt(me){return""+me}function zt(me){if(Ot(me))return T("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",yt(me)),Jt(me)}var xi=_.ReactCurrentOwner,vt={key:!0,ref:!0,__self:!0,__source:!0},ye,ve;function Le(me){if(hi.call(me,"ref")){var ct=Object.getOwnPropertyDescriptor(me,"ref").get;if(ct&&ct.isReactWarning)return!1}return me.ref!==void 0}function Te(me){if(hi.call(me,"key")){var ct=Object.getOwnPropertyDescriptor(me,"key").get;if(ct&&ct.isReactWarning)return!1}return me.key!==void 0}function Fe(me,ct){typeof me.ref=="string"&&xi.current}function Pe(me,ct){{var St=function(){ye||(ye=!0,T("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};St.isReactWarning=!0,Object.defineProperty(me,"key",{get:St,configurable:!0})}}function k(me,ct){{var St=function(){ve||(ve=!0,T("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};St.isReactWarning=!0,Object.defineProperty(me,"ref",{get:St,configurable:!0})}}var Z=function(me,ct,St,Xt,Ii,sr,Ni){var Oi={$$typeof:e,type:me,key:ct,ref:St,props:Ni,_owner:sr};return Oi._store={},Object.defineProperty(Oi._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(Oi,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Xt}),Object.defineProperty(Oi,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Ii}),Object.freeze&&(Object.freeze(Oi.props),Object.freeze(Oi)),Oi};function re(me,ct,St,Xt,Ii){{var sr,Ni={},Oi=null,Be=null;St!==void 0&&(zt(St),Oi=""+St),Te(ct)&&(zt(ct.key),Oi=""+ct.key),Le(ct)&&(Be=ct.ref,Fe(ct));for(sr in ct)hi.call(ct,sr)&&!vt.hasOwnProperty(sr)&&(Ni[sr]=ct[sr]);if(me&&me.defaultProps){var se=me.defaultProps;for(sr in se)Ni[sr]===void 0&&(Ni[sr]=se[sr])}if(Oi||Be){var ge=typeof me=="function"?me.displayName||me.name||"Unknown":me;Oi&&Pe(Ni,ge),Be&&k(Ni,ge)}return Z(me,Oi,Be,Ii,Xt,xi.current,Ni)}}var Re=_.ReactCurrentOwner,ce=_.ReactDebugCurrentFrame;function Ue(me){if(me){var ct=me._owner,St=ki(me.type,me._source,ct?ct.type:null);ce.setExtraStackFrame(St)}else ce.setExtraStackFrame(null)}var je;je=!1;function dt(me){return typeof me=="object"&&me!==null&&me.$$typeof===e}function Bt(){{if(Re.current){var me=H(Re.current.type);if(me)return`

Check the render method of \``+me+"`."}return""}}function bt(me){return""}var Ut={};function di(me){{var ct=Bt();if(!ct){var St=typeof me=="string"?me:me.displayName||me.name;St&&(ct=`

Check the top-level render call using <`+St+">.")}return ct}}function br(me,ct){{if(!me._store||me._store.validated||me.key!=null)return;me._store.validated=!0;var St=di(ct);if(Ut[St])return;Ut[St]=!0;var Xt="";me&&me._owner&&me._owner!==Re.current&&(Xt=" It was passed a child from "+H(me._owner.type)+"."),Ue(me),T('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',St,Xt),Ue(null)}}function Pi(me,ct){{if(typeof me!="object")return;if(Ce(me))for(var St=0;St<me.length;St++){var Xt=me[St];dt(Xt)&&br(Xt,ct)}else if(dt(me))me._store&&(me._store.validated=!0);else if(me){var Ii=v(me);if(typeof Ii=="function"&&Ii!==me.entries)for(var sr=Ii.call(me),Ni;!(Ni=sr.next()).done;)dt(Ni.value)&&br(Ni.value,ct)}}}function fn(me){{var ct=me.type;if(ct==null||typeof ct=="string")return;var St;if(typeof ct=="function")St=ct.propTypes;else if(typeof ct=="object"&&(ct.$$typeof===c||ct.$$typeof===f))St=ct.propTypes;else return;if(St){var Xt=H(ct);Vi(St,me.props,"prop",Xt,me)}else if(ct.PropTypes!==void 0&&!je){je=!0;var Ii=H(ct);T("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Ii||"Unknown")}typeof ct.getDefaultProps=="function"&&!ct.getDefaultProps.isReactClassApproved&&T("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Pr(me){{for(var ct=Object.keys(me.props),St=0;St<ct.length;St++){var Xt=ct[St];if(Xt!=="children"&&Xt!=="key"){Ue(me),T("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Xt),Ue(null);break}}me.ref!==null&&(Ue(me),T("Invalid attribute `ref` supplied to `React.Fragment`."),Ue(null))}}var tn={};function gs(me,ct,St,Xt,Ii,sr){{var Ni=O(me);if(!Ni){var Oi="";(me===void 0||typeof me=="object"&&me!==null&&Object.keys(me).length===0)&&(Oi+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Be=bt();Be?Oi+=Be:Oi+=Bt();var se;me===null?se="null":Ce(me)?se="array":me!==void 0&&me.$$typeof===e?(se="<"+(H(me.type)||"Unknown")+" />",Oi=" Did you accidentally export a JSX literal instead of a component?"):se=typeof me,T("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",se,Oi)}var ge=re(me,ct,St,Ii,sr);if(ge==null)return ge;if(Ni){var Ne=ct.children;if(Ne!==void 0)if(Xt)if(Ce(Ne)){for(var ke=0;ke<Ne.length;ke++)Pi(Ne[ke],me);Object.freeze&&Object.freeze(Ne)}else T("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Pi(Ne,me)}if(hi.call(ct,"key")){var Ke=H(me),ot=Object.keys(ct).filter(function(Kt){return Kt!=="key"}),wt=ot.length>0?"{key: someKey, "+ot.join(": ..., ")+": ...}":"{key: someKey}";if(!tn[Ke+wt]){var qt=ot.length>0?"{"+ot.join(": ..., ")+": ...}":"{}";T(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,wt,Ke,qt,Ke),tn[Ke+wt]=!0}}return me===n?Pr(ge):fn(ge),ge}}function mn(me,ct,St){return gs(me,ct,St,!0)}function Rs(me,ct,St){return gs(me,ct,St,!1)}var $n=Rs,As=mn;Xv.Fragment=n,Xv.jsx=$n,Xv.jsxs=As}()),Xv}process.env.NODE_ENV==="production"?r2.exports=TW():r2.exports=MW();var ir=r2.exports;function RW(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e===0){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function IW(r,e,i){return e=kW(e),e in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function YL(r,e){return LW(r)||RW(r,e)||KL(r,e)||PW()}function BW(r){return NW(r)||DW(r)||KL(r)||OW()}function NW(r){if(Array.isArray(r))return n2(r)}function LW(r){if(Array.isArray(r))return r}function DW(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function KL(r,e){if(r){if(typeof r=="string")return n2(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n2(r,e)}}function n2(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=r[i];return n}function OW(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FW(r,e){if(typeof r!="object"||r===null)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function kW(r){var e=FW(r,"string");return typeof e=="symbol"?e:String(e)}var UW=function(r,e){var i=new Set(e);return Object.assign.apply(Object,[{}].concat(BW(Object.entries(r).filter(function(n){var s=YL(n,1),o=s[0];return!i.has(o)}).map(function(n){var s=YL(n,2),o=s[0],l=s[1];return IW({},o,l)}))))};function s2(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function zW(r){if(Array.isArray(r))return r}function jW(r){if(Array.isArray(r))return s2(r)}function VW(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function GW(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function HW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WW(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QW(r,e){return zW(r)||GW(r,e)||ZL(r,e)||HW()}function JL(r){return jW(r)||VW(r)||ZL(r)||WW()}function ZL(r,e){if(r){if(typeof r=="string")return s2(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s2(r,e):void 0}}function Yv(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.wrapperElementType,n=i===void 0?"div":i,s=e.nodeMapper,o=s===void 0?function(p){return p}:s,l=e.methodNames,u=l===void 0?[]:l,c=e.initPropNames,d=c===void 0?[]:c;return Ei.forwardRef(function(p,f){var m=Ei.useRef(),g=Ei.useMemo(function(){var v=Object.fromEntries(d.filter(function(_){return p.hasOwnProperty(_)}).map(function(_){return[_,p[_]]}));return r(v)},[]);$L(function(){g(o(m.current))},Ei.useLayoutEffect),$L(function(){return g._destructor instanceof Function?g._destructor:void 0});var y=Ei.useCallback(function(v){for(var _=arguments.length,T=new Array(_>1?_-1:0),w=1;w<_;w++)T[w-1]=arguments[w];return g[v]instanceof Function?g[v].apply(g,T):void 0},[g]),x=Ei.useRef({});return Object.keys(UW(p,[].concat(JL(u),JL(d)))).filter(function(v){return x.current[v]!==p[v]}).forEach(function(v){return y(v,p[v])}),x.current=p,Ei.useImperativeHandle(f,function(){return Object.fromEntries(u.map(function(v){return[v,function(){for(var _=arguments.length,T=new Array(_),w=0;w<_;w++)T[w]=arguments[w];return y.apply(void 0,[v].concat(T))}]}))},[y]),Ei.createElement(n,{ref:m})})}function $L(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ei.useEffect,i=Ei.useRef(),n=Ei.useRef(!1),s=Ei.useRef(!1),o=Ei.useState(0),l=QW(o,2);l[0];var u=l[1];n.current&&(s.current=!0),e(function(){return n.current||(i.current=r(),n.current=!0),u(function(c){return c+1}),function(){s.current&&i.current&&i.current()}},[])}var qW={exports:{}};(function(r,e){(function(i,n){r.exports=n()})(self,()=>(()=>{var i={"./node_modules/an-array/index.js":l=>{var u=Object.prototype.toString;l.exports=c;function c(d){return d.BYTES_PER_ELEMENT&&u.call(d.buffer)==="[object ArrayBuffer]"||Array.isArray(d)}},"./node_modules/as-number/index.js":l=>{l.exports=function(u,c){return typeof u=="number"?u:typeof c=="number"?c:0}},"./node_modules/base64-js/index.js":(l,u)=>{u.byteLength=x,u.toByteArray=_,u.fromByteArray=S;for(var c=[],d=[],p=typeof Uint8Array<"u"?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m=0,g=f.length;m<g;++m)c[m]=f[m],d[f.charCodeAt(m)]=m;d[45]=62,d[95]=63;function y(R){var B=R.length;if(B%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=R.indexOf("=");I===-1&&(I=B);var D=I===B?0:4-I%4;return[I,D]}function x(R){var B=y(R),I=B[0],D=B[1];return(I+D)*3/4-D}function v(R,B,I){return(B+I)*3/4-I}function _(R){var B,I=y(R),D=I[0],L=I[1],O=new p(v(R,D,L)),U=0,J=L>0?D-4:D,H;for(H=0;H<J;H+=4)B=d[R.charCodeAt(H)]<<18|d[R.charCodeAt(H+1)]<<12|d[R.charCodeAt(H+2)]<<6|d[R.charCodeAt(H+3)],O[U++]=B>>16&255,O[U++]=B>>8&255,O[U++]=B&255;return L===2&&(B=d[R.charCodeAt(H)]<<2|d[R.charCodeAt(H+1)]>>4,O[U++]=B&255),L===1&&(B=d[R.charCodeAt(H)]<<10|d[R.charCodeAt(H+1)]<<4|d[R.charCodeAt(H+2)]>>2,O[U++]=B>>8&255,O[U++]=B&255),O}function T(R){return c[R>>18&63]+c[R>>12&63]+c[R>>6&63]+c[R&63]}function w(R,B,I){for(var D,L=[],O=B;O<I;O+=3)D=(R[O]<<16&16711680)+(R[O+1]<<8&65280)+(R[O+2]&255),L.push(T(D));return L.join("")}function S(R){for(var B,I=R.length,D=I%3,L=[],O=16383,U=0,J=I-D;U<J;U+=O)L.push(w(R,U,U+O>J?J:U+O));return D===1?(B=R[I-1],L.push(c[B>>2]+c[B<<4&63]+"==")):D===2&&(B=(R[I-2]<<8)+R[I-1],L.push(c[B>>10]+c[B>>4&63]+c[B<<2&63]+"=")),L.join("")}},"./node_modules/buffer-equal/index.js":(l,u,c)=>{var d=c("./node_modules/buffer/index.js").Buffer;l.exports=function(p,f){if(d.isBuffer(p)&&d.isBuffer(f)){if(typeof p.equals=="function")return p.equals(f);if(p.length!==f.length)return!1;for(var m=0;m<p.length;m++)if(p[m]!==f[m])return!1;return!0}}},"./node_modules/buffer/index.js":(l,u,c)=>{/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */const d=c("./node_modules/base64-js/index.js"),p=c("./node_modules/ieee754/index.js"),f=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;u.Buffer=x,u.SlowBuffer=O,u.INSPECT_MAX_BYTES=50;const m=2147483647;u.kMaxLength=m,x.TYPED_ARRAY_SUPPORT=g(),!x.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function g(){try{const k=new Uint8Array(1),Z={foo:function(){return 42}};return Object.setPrototypeOf(Z,Uint8Array.prototype),Object.setPrototypeOf(k,Z),k.foo()===42}catch{return!1}}Object.defineProperty(x.prototype,"parent",{enumerable:!0,get:function(){if(x.isBuffer(this))return this.buffer}}),Object.defineProperty(x.prototype,"offset",{enumerable:!0,get:function(){if(x.isBuffer(this))return this.byteOffset}});function y(k){if(k>m)throw new RangeError('The value "'+k+'" is invalid for option "size"');const Z=new Uint8Array(k);return Object.setPrototypeOf(Z,x.prototype),Z}function x(k,Z,re){if(typeof k=="number"){if(typeof Z=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return w(k)}return v(k,Z,re)}x.poolSize=8192;function v(k,Z,re){if(typeof k=="string")return S(k,Z);if(ArrayBuffer.isView(k))return B(k);if(k==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof k);if(ve(k,ArrayBuffer)||k&&ve(k.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ve(k,SharedArrayBuffer)||k&&ve(k.buffer,SharedArrayBuffer)))return I(k,Z,re);if(typeof k=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Re=k.valueOf&&k.valueOf();if(Re!=null&&Re!==k)return x.from(Re,Z,re);const ce=D(k);if(ce)return ce;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof k[Symbol.toPrimitive]=="function")return x.from(k[Symbol.toPrimitive]("string"),Z,re);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof k)}x.from=function(k,Z,re){return v(k,Z,re)},Object.setPrototypeOf(x.prototype,Uint8Array.prototype),Object.setPrototypeOf(x,Uint8Array);function _(k){if(typeof k!="number")throw new TypeError('"size" argument must be of type number');if(k<0)throw new RangeError('The value "'+k+'" is invalid for option "size"')}function T(k,Z,re){return _(k),k<=0?y(k):Z!==void 0?typeof re=="string"?y(k).fill(Z,re):y(k).fill(Z):y(k)}x.alloc=function(k,Z,re){return T(k,Z,re)};function w(k){return _(k),y(k<0?0:L(k)|0)}x.allocUnsafe=function(k){return w(k)},x.allocUnsafeSlow=function(k){return w(k)};function S(k,Z){if((typeof Z!="string"||Z==="")&&(Z="utf8"),!x.isEncoding(Z))throw new TypeError("Unknown encoding: "+Z);const re=U(k,Z)|0;let Re=y(re);const ce=Re.write(k,Z);return ce!==re&&(Re=Re.slice(0,ce)),Re}function R(k){const Z=k.length<0?0:L(k.length)|0,re=y(Z);for(let Re=0;Re<Z;Re+=1)re[Re]=k[Re]&255;return re}function B(k){if(ve(k,Uint8Array)){const Z=new Uint8Array(k);return I(Z.buffer,Z.byteOffset,Z.byteLength)}return R(k)}function I(k,Z,re){if(Z<0||k.byteLength<Z)throw new RangeError('"offset" is outside of buffer bounds');if(k.byteLength<Z+(re||0))throw new RangeError('"length" is outside of buffer bounds');let Re;return Z===void 0&&re===void 0?Re=new Uint8Array(k):re===void 0?Re=new Uint8Array(k,Z):Re=new Uint8Array(k,Z,re),Object.setPrototypeOf(Re,x.prototype),Re}function D(k){if(x.isBuffer(k)){const Z=L(k.length)|0,re=y(Z);return re.length===0||k.copy(re,0,0,Z),re}if(k.length!==void 0)return typeof k.length!="number"||Le(k.length)?y(0):R(k);if(k.type==="Buffer"&&Array.isArray(k.data))return R(k.data)}function L(k){if(k>=m)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+m.toString(16)+" bytes");return k|0}function O(k){return+k!=k&&(k=0),x.alloc(+k)}x.isBuffer=function(k){return k!=null&&k._isBuffer===!0&&k!==x.prototype},x.compare=function(k,Z){if(ve(k,Uint8Array)&&(k=x.from(k,k.offset,k.byteLength)),ve(Z,Uint8Array)&&(Z=x.from(Z,Z.offset,Z.byteLength)),!x.isBuffer(k)||!x.isBuffer(Z))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(k===Z)return 0;let re=k.length,Re=Z.length;for(let ce=0,Ue=Math.min(re,Re);ce<Ue;++ce)if(k[ce]!==Z[ce]){re=k[ce],Re=Z[ce];break}return re<Re?-1:Re<re?1:0},x.isEncoding=function(k){switch(String(k).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},x.concat=function(k,Z){if(!Array.isArray(k))throw new TypeError('"list" argument must be an Array of Buffers');if(k.length===0)return x.alloc(0);let re;if(Z===void 0)for(Z=0,re=0;re<k.length;++re)Z+=k[re].length;const Re=x.allocUnsafe(Z);let ce=0;for(re=0;re<k.length;++re){let Ue=k[re];if(ve(Ue,Uint8Array))ce+Ue.length>Re.length?(x.isBuffer(Ue)||(Ue=x.from(Ue)),Ue.copy(Re,ce)):Uint8Array.prototype.set.call(Re,Ue,ce);else if(x.isBuffer(Ue))Ue.copy(Re,ce);else throw new TypeError('"list" argument must be an Array of Buffers');ce+=Ue.length}return Re};function U(k,Z){if(x.isBuffer(k))return k.length;if(ArrayBuffer.isView(k)||ve(k,ArrayBuffer))return k.byteLength;if(typeof k!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof k);const re=k.length,Re=arguments.length>2&&arguments[2]===!0;if(!Re&&re===0)return 0;let ce=!1;for(;;)switch(Z){case"ascii":case"latin1":case"binary":return re;case"utf8":case"utf-8":return Jt(k).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return re*2;case"hex":return re>>>1;case"base64":return vt(k).length;default:if(ce)return Re?-1:Jt(k).length;Z=(""+Z).toLowerCase(),ce=!0}}x.byteLength=U;function J(k,Z,re){let Re=!1;if((Z===void 0||Z<0)&&(Z=0),Z>this.length||((re===void 0||re>this.length)&&(re=this.length),re<=0)||(re>>>=0,Z>>>=0,re<=Z))return"";for(k||(k="utf8");;)switch(k){case"hex":return Xe(this,Z,re);case"utf8":case"utf-8":return xe(this,Z,re);case"ascii":return Ie(this,Z,re);case"latin1":case"binary":return Ge(this,Z,re);case"base64":return ae(this,Z,re);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $e(this,Z,re);default:if(Re)throw new TypeError("Unknown encoding: "+k);k=(k+"").toLowerCase(),Re=!0}}x.prototype._isBuffer=!0;function H(k,Z,re){const Re=k[Z];k[Z]=k[re],k[re]=Re}x.prototype.swap16=function(){const k=this.length;if(k%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let Z=0;Z<k;Z+=2)H(this,Z,Z+1);return this},x.prototype.swap32=function(){const k=this.length;if(k%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let Z=0;Z<k;Z+=4)H(this,Z,Z+3),H(this,Z+1,Z+2);return this},x.prototype.swap64=function(){const k=this.length;if(k%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let Z=0;Z<k;Z+=8)H(this,Z,Z+7),H(this,Z+1,Z+6),H(this,Z+2,Z+5),H(this,Z+3,Z+4);return this},x.prototype.toString=function(){const k=this.length;return k===0?"":arguments.length===0?xe(this,0,k):J.apply(this,arguments)},x.prototype.toLocaleString=x.prototype.toString,x.prototype.equals=function(k){if(!x.isBuffer(k))throw new TypeError("Argument must be a Buffer");return this===k?!0:x.compare(this,k)===0},x.prototype.inspect=function(){let k="";const Z=u.INSPECT_MAX_BYTES;return k=this.toString("hex",0,Z).replace(/(.{2})/g,"$1 ").trim(),this.length>Z&&(k+=" ... "),"<Buffer "+k+">"},f&&(x.prototype[f]=x.prototype.inspect),x.prototype.compare=function(k,Z,re,Re,ce){if(ve(k,Uint8Array)&&(k=x.from(k,k.offset,k.byteLength)),!x.isBuffer(k))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof k);if(Z===void 0&&(Z=0),re===void 0&&(re=k?k.length:0),Re===void 0&&(Re=0),ce===void 0&&(ce=this.length),Z<0||re>k.length||Re<0||ce>this.length)throw new RangeError("out of range index");if(Re>=ce&&Z>=re)return 0;if(Re>=ce)return-1;if(Z>=re)return 1;if(Z>>>=0,re>>>=0,Re>>>=0,ce>>>=0,this===k)return 0;let Ue=ce-Re,je=re-Z;const dt=Math.min(Ue,je),Bt=this.slice(Re,ce),bt=k.slice(Z,re);for(let Ut=0;Ut<dt;++Ut)if(Bt[Ut]!==bt[Ut]){Ue=Bt[Ut],je=bt[Ut];break}return Ue<je?-1:je<Ue?1:0};function V(k,Z,re,Re,ce){if(k.length===0)return-1;if(typeof re=="string"?(Re=re,re=0):re>2147483647?re=2147483647:re<-2147483648&&(re=-2147483648),re=+re,Le(re)&&(re=ce?0:k.length-1),re<0&&(re=k.length+re),re>=k.length){if(ce)return-1;re=k.length-1}else if(re<0)if(ce)re=0;else return-1;if(typeof Z=="string"&&(Z=x.from(Z,Re)),x.isBuffer(Z))return Z.length===0?-1:$(k,Z,re,Re,ce);if(typeof Z=="number")return Z=Z&255,typeof Uint8Array.prototype.indexOf=="function"?ce?Uint8Array.prototype.indexOf.call(k,Z,re):Uint8Array.prototype.lastIndexOf.call(k,Z,re):$(k,[Z],re,Re,ce);throw new TypeError("val must be string, number or Buffer")}function $(k,Z,re,Re,ce){let Ue=1,je=k.length,dt=Z.length;if(Re!==void 0&&(Re=String(Re).toLowerCase(),Re==="ucs2"||Re==="ucs-2"||Re==="utf16le"||Re==="utf-16le")){if(k.length<2||Z.length<2)return-1;Ue=2,je/=2,dt/=2,re/=2}function Bt(Ut,di){return Ue===1?Ut[di]:Ut.readUInt16BE(di*Ue)}let bt;if(ce){let Ut=-1;for(bt=re;bt<je;bt++)if(Bt(k,bt)===Bt(Z,Ut===-1?0:bt-Ut)){if(Ut===-1&&(Ut=bt),bt-Ut+1===dt)return Ut*Ue}else Ut!==-1&&(bt-=bt-Ut),Ut=-1}else for(re+dt>je&&(re=je-dt),bt=re;bt>=0;bt--){let Ut=!0;for(let di=0;di<dt;di++)if(Bt(k,bt+di)!==Bt(Z,di)){Ut=!1;break}if(Ut)return bt}return-1}x.prototype.includes=function(k,Z,re){return this.indexOf(k,Z,re)!==-1},x.prototype.indexOf=function(k,Z,re){return V(this,k,Z,re,!0)},x.prototype.lastIndexOf=function(k,Z,re){return V(this,k,Z,re,!1)};function Q(k,Z,re,Re){re=Number(re)||0;const ce=k.length-re;Re?(Re=Number(Re),Re>ce&&(Re=ce)):Re=ce;const Ue=Z.length;Re>Ue/2&&(Re=Ue/2);let je;for(je=0;je<Re;++je){const dt=parseInt(Z.substr(je*2,2),16);if(Le(dt))return je;k[re+je]=dt}return je}function G(k,Z,re,Re){return ye(Jt(Z,k.length-re),k,re,Re)}function j(k,Z,re,Re){return ye(zt(Z),k,re,Re)}function ie(k,Z,re,Re){return ye(vt(Z),k,re,Re)}function Y(k,Z,re,Re){return ye(xi(Z,k.length-re),k,re,Re)}x.prototype.write=function(k,Z,re,Re){if(Z===void 0)Re="utf8",re=this.length,Z=0;else if(re===void 0&&typeof Z=="string")Re=Z,re=this.length,Z=0;else if(isFinite(Z))Z=Z>>>0,isFinite(re)?(re=re>>>0,Re===void 0&&(Re="utf8")):(Re=re,re=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ce=this.length-Z;if((re===void 0||re>ce)&&(re=ce),k.length>0&&(re<0||Z<0)||Z>this.length)throw new RangeError("Attempt to write outside buffer bounds");Re||(Re="utf8");let Ue=!1;for(;;)switch(Re){case"hex":return Q(this,k,Z,re);case"utf8":case"utf-8":return G(this,k,Z,re);case"ascii":case"latin1":case"binary":return j(this,k,Z,re);case"base64":return ie(this,k,Z,re);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,k,Z,re);default:if(Ue)throw new TypeError("Unknown encoding: "+Re);Re=(""+Re).toLowerCase(),Ue=!0}},x.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ae(k,Z,re){return Z===0&&re===k.length?d.fromByteArray(k):d.fromByteArray(k.slice(Z,re))}function xe(k,Z,re){re=Math.min(k.length,re);const Re=[];let ce=Z;for(;ce<re;){const Ue=k[ce];let je=null,dt=Ue>239?4:Ue>223?3:Ue>191?2:1;if(ce+dt<=re){let Bt,bt,Ut,di;switch(dt){case 1:Ue<128&&(je=Ue);break;case 2:Bt=k[ce+1],(Bt&192)===128&&(di=(Ue&31)<<6|Bt&63,di>127&&(je=di));break;case 3:Bt=k[ce+1],bt=k[ce+2],(Bt&192)===128&&(bt&192)===128&&(di=(Ue&15)<<12|(Bt&63)<<6|bt&63,di>2047&&(di<55296||di>57343)&&(je=di));break;case 4:Bt=k[ce+1],bt=k[ce+2],Ut=k[ce+3],(Bt&192)===128&&(bt&192)===128&&(Ut&192)===128&&(di=(Ue&15)<<18|(Bt&63)<<12|(bt&63)<<6|Ut&63,di>65535&&di<1114112&&(je=di))}}je===null?(je=65533,dt=1):je>65535&&(je-=65536,Re.push(je>>>10&1023|55296),je=56320|je&1023),Re.push(je),ce+=dt}return de(Re)}const fe=4096;function de(k){const Z=k.length;if(Z<=fe)return String.fromCharCode.apply(String,k);let re="",Re=0;for(;Re<Z;)re+=String.fromCharCode.apply(String,k.slice(Re,Re+=fe));return re}function Ie(k,Z,re){let Re="";re=Math.min(k.length,re);for(let ce=Z;ce<re;++ce)Re+=String.fromCharCode(k[ce]&127);return Re}function Ge(k,Z,re){let Re="";re=Math.min(k.length,re);for(let ce=Z;ce<re;++ce)Re+=String.fromCharCode(k[ce]);return Re}function Xe(k,Z,re){const Re=k.length;(!Z||Z<0)&&(Z=0),(!re||re<0||re>Re)&&(re=Re);let ce="";for(let Ue=Z;Ue<re;++Ue)ce+=Te[k[Ue]];return ce}function $e(k,Z,re){const Re=k.slice(Z,re);let ce="";for(let Ue=0;Ue<Re.length-1;Ue+=2)ce+=String.fromCharCode(Re[Ue]+Re[Ue+1]*256);return ce}x.prototype.slice=function(k,Z){const re=this.length;k=~~k,Z=Z===void 0?re:~~Z,k<0?(k+=re,k<0&&(k=0)):k>re&&(k=re),Z<0?(Z+=re,Z<0&&(Z=0)):Z>re&&(Z=re),Z<k&&(Z=k);const Re=this.subarray(k,Z);return Object.setPrototypeOf(Re,x.prototype),Re};function lt(k,Z,re){if(k%1!==0||k<0)throw new RangeError("offset is not uint");if(k+Z>re)throw new RangeError("Trying to access beyond buffer length")}x.prototype.readUintLE=x.prototype.readUIntLE=function(k,Z,re){k=k>>>0,Z=Z>>>0,re||lt(k,Z,this.length);let Re=this[k],ce=1,Ue=0;for(;++Ue<Z&&(ce*=256);)Re+=this[k+Ue]*ce;return Re},x.prototype.readUintBE=x.prototype.readUIntBE=function(k,Z,re){k=k>>>0,Z=Z>>>0,re||lt(k,Z,this.length);let Re=this[k+--Z],ce=1;for(;Z>0&&(ce*=256);)Re+=this[k+--Z]*ce;return Re},x.prototype.readUint8=x.prototype.readUInt8=function(k,Z){return k=k>>>0,Z||lt(k,1,this.length),this[k]},x.prototype.readUint16LE=x.prototype.readUInt16LE=function(k,Z){return k=k>>>0,Z||lt(k,2,this.length),this[k]|this[k+1]<<8},x.prototype.readUint16BE=x.prototype.readUInt16BE=function(k,Z){return k=k>>>0,Z||lt(k,2,this.length),this[k]<<8|this[k+1]},x.prototype.readUint32LE=x.prototype.readUInt32LE=function(k,Z){return k=k>>>0,Z||lt(k,4,this.length),(this[k]|this[k+1]<<8|this[k+2]<<16)+this[k+3]*16777216},x.prototype.readUint32BE=x.prototype.readUInt32BE=function(k,Z){return k=k>>>0,Z||lt(k,4,this.length),this[k]*16777216+(this[k+1]<<16|this[k+2]<<8|this[k+3])},x.prototype.readBigUInt64LE=Fe(function(k){k=k>>>0,Qe(k,"offset");const Z=this[k],re=this[k+7];(Z===void 0||re===void 0)&&Ce(k,this.length-8);const Re=Z+this[++k]*2**8+this[++k]*2**16+this[++k]*2**24,ce=this[++k]+this[++k]*2**8+this[++k]*2**16+re*2**24;return BigInt(Re)+(BigInt(ce)<<BigInt(32))}),x.prototype.readBigUInt64BE=Fe(function(k){k=k>>>0,Qe(k,"offset");const Z=this[k],re=this[k+7];(Z===void 0||re===void 0)&&Ce(k,this.length-8);const Re=Z*2**24+this[++k]*2**16+this[++k]*2**8+this[++k],ce=this[++k]*2**24+this[++k]*2**16+this[++k]*2**8+re;return(BigInt(Re)<<BigInt(32))+BigInt(ce)}),x.prototype.readIntLE=function(k,Z,re){k=k>>>0,Z=Z>>>0,re||lt(k,Z,this.length);let Re=this[k],ce=1,Ue=0;for(;++Ue<Z&&(ce*=256);)Re+=this[k+Ue]*ce;return ce*=128,Re>=ce&&(Re-=Math.pow(2,8*Z)),Re},x.prototype.readIntBE=function(k,Z,re){k=k>>>0,Z=Z>>>0,re||lt(k,Z,this.length);let Re=Z,ce=1,Ue=this[k+--Re];for(;Re>0&&(ce*=256);)Ue+=this[k+--Re]*ce;return ce*=128,Ue>=ce&&(Ue-=Math.pow(2,8*Z)),Ue},x.prototype.readInt8=function(k,Z){return k=k>>>0,Z||lt(k,1,this.length),this[k]&128?(255-this[k]+1)*-1:this[k]},x.prototype.readInt16LE=function(k,Z){k=k>>>0,Z||lt(k,2,this.length);const re=this[k]|this[k+1]<<8;return re&32768?re|4294901760:re},x.prototype.readInt16BE=function(k,Z){k=k>>>0,Z||lt(k,2,this.length);const re=this[k+1]|this[k]<<8;return re&32768?re|4294901760:re},x.prototype.readInt32LE=function(k,Z){return k=k>>>0,Z||lt(k,4,this.length),this[k]|this[k+1]<<8|this[k+2]<<16|this[k+3]<<24},x.prototype.readInt32BE=function(k,Z){return k=k>>>0,Z||lt(k,4,this.length),this[k]<<24|this[k+1]<<16|this[k+2]<<8|this[k+3]},x.prototype.readBigInt64LE=Fe(function(k){k=k>>>0,Qe(k,"offset");const Z=this[k],re=this[k+7];(Z===void 0||re===void 0)&&Ce(k,this.length-8);const Re=this[k+4]+this[k+5]*2**8+this[k+6]*2**16+(re<<24);return(BigInt(Re)<<BigInt(32))+BigInt(Z+this[++k]*256+this[++k]*65536+this[++k]*16777216)}),x.prototype.readBigInt64BE=Fe(function(k){k=k>>>0,Qe(k,"offset");const Z=this[k],re=this[k+7];(Z===void 0||re===void 0)&&Ce(k,this.length-8);const Re=(Z<<24)+this[++k]*2**16+this[++k]*2**8+this[++k];return(BigInt(Re)<<BigInt(32))+BigInt(this[++k]*16777216+this[++k]*65536+this[++k]*256+re)}),x.prototype.readFloatLE=function(k,Z){return k=k>>>0,Z||lt(k,4,this.length),p.read(this,k,!0,23,4)},x.prototype.readFloatBE=function(k,Z){return k=k>>>0,Z||lt(k,4,this.length),p.read(this,k,!1,23,4)},x.prototype.readDoubleLE=function(k,Z){return k=k>>>0,Z||lt(k,8,this.length),p.read(this,k,!0,52,8)},x.prototype.readDoubleBE=function(k,Z){return k=k>>>0,Z||lt(k,8,this.length),p.read(this,k,!1,52,8)};function At(k,Z,re,Re,ce,Ue){if(!x.isBuffer(k))throw new TypeError('"buffer" argument must be a Buffer instance');if(Z>ce||Z<Ue)throw new RangeError('"value" argument is out of bounds');if(re+Re>k.length)throw new RangeError("Index out of range")}x.prototype.writeUintLE=x.prototype.writeUIntLE=function(k,Z,re,Re){if(k=+k,Z=Z>>>0,re=re>>>0,!Re){const je=Math.pow(2,8*re)-1;At(this,k,Z,re,je,0)}let ce=1,Ue=0;for(this[Z]=k&255;++Ue<re&&(ce*=256);)this[Z+Ue]=k/ce&255;return Z+re},x.prototype.writeUintBE=x.prototype.writeUIntBE=function(k,Z,re,Re){if(k=+k,Z=Z>>>0,re=re>>>0,!Re){const je=Math.pow(2,8*re)-1;At(this,k,Z,re,je,0)}let ce=re-1,Ue=1;for(this[Z+ce]=k&255;--ce>=0&&(Ue*=256);)this[Z+ce]=k/Ue&255;return Z+re},x.prototype.writeUint8=x.prototype.writeUInt8=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,1,255,0),this[Z]=k&255,Z+1},x.prototype.writeUint16LE=x.prototype.writeUInt16LE=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,2,65535,0),this[Z]=k&255,this[Z+1]=k>>>8,Z+2},x.prototype.writeUint16BE=x.prototype.writeUInt16BE=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,2,65535,0),this[Z]=k>>>8,this[Z+1]=k&255,Z+2},x.prototype.writeUint32LE=x.prototype.writeUInt32LE=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,4,4294967295,0),this[Z+3]=k>>>24,this[Z+2]=k>>>16,this[Z+1]=k>>>8,this[Z]=k&255,Z+4},x.prototype.writeUint32BE=x.prototype.writeUInt32BE=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,4,4294967295,0),this[Z]=k>>>24,this[Z+1]=k>>>16,this[Z+2]=k>>>8,this[Z+3]=k&255,Z+4};function Gt(k,Z,re,Re,ce){Vi(Z,Re,ce,k,re,7);let Ue=Number(Z&BigInt(4294967295));k[re++]=Ue,Ue=Ue>>8,k[re++]=Ue,Ue=Ue>>8,k[re++]=Ue,Ue=Ue>>8,k[re++]=Ue;let je=Number(Z>>BigInt(32)&BigInt(4294967295));return k[re++]=je,je=je>>8,k[re++]=je,je=je>>8,k[re++]=je,je=je>>8,k[re++]=je,re}function gt(k,Z,re,Re,ce){Vi(Z,Re,ce,k,re,7);let Ue=Number(Z&BigInt(4294967295));k[re+7]=Ue,Ue=Ue>>8,k[re+6]=Ue,Ue=Ue>>8,k[re+5]=Ue,Ue=Ue>>8,k[re+4]=Ue;let je=Number(Z>>BigInt(32)&BigInt(4294967295));return k[re+3]=je,je=je>>8,k[re+2]=je,je=je>>8,k[re+1]=je,je=je>>8,k[re]=je,re+8}x.prototype.writeBigUInt64LE=Fe(function(k,Z=0){return Gt(this,k,Z,BigInt(0),BigInt("0xffffffffffffffff"))}),x.prototype.writeBigUInt64BE=Fe(function(k,Z=0){return gt(this,k,Z,BigInt(0),BigInt("0xffffffffffffffff"))}),x.prototype.writeIntLE=function(k,Z,re,Re){if(k=+k,Z=Z>>>0,!Re){const dt=Math.pow(2,8*re-1);At(this,k,Z,re,dt-1,-dt)}let ce=0,Ue=1,je=0;for(this[Z]=k&255;++ce<re&&(Ue*=256);)k<0&&je===0&&this[Z+ce-1]!==0&&(je=1),this[Z+ce]=(k/Ue>>0)-je&255;return Z+re},x.prototype.writeIntBE=function(k,Z,re,Re){if(k=+k,Z=Z>>>0,!Re){const dt=Math.pow(2,8*re-1);At(this,k,Z,re,dt-1,-dt)}let ce=re-1,Ue=1,je=0;for(this[Z+ce]=k&255;--ce>=0&&(Ue*=256);)k<0&&je===0&&this[Z+ce+1]!==0&&(je=1),this[Z+ce]=(k/Ue>>0)-je&255;return Z+re},x.prototype.writeInt8=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,1,127,-128),k<0&&(k=255+k+1),this[Z]=k&255,Z+1},x.prototype.writeInt16LE=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,2,32767,-32768),this[Z]=k&255,this[Z+1]=k>>>8,Z+2},x.prototype.writeInt16BE=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,2,32767,-32768),this[Z]=k>>>8,this[Z+1]=k&255,Z+2},x.prototype.writeInt32LE=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,4,2147483647,-2147483648),this[Z]=k&255,this[Z+1]=k>>>8,this[Z+2]=k>>>16,this[Z+3]=k>>>24,Z+4},x.prototype.writeInt32BE=function(k,Z,re){return k=+k,Z=Z>>>0,re||At(this,k,Z,4,2147483647,-2147483648),k<0&&(k=4294967295+k+1),this[Z]=k>>>24,this[Z+1]=k>>>16,this[Z+2]=k>>>8,this[Z+3]=k&255,Z+4},x.prototype.writeBigInt64LE=Fe(function(k,Z=0){return Gt(this,k,Z,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),x.prototype.writeBigInt64BE=Fe(function(k,Z=0){return gt(this,k,Z,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function yi(k,Z,re,Re,ce,Ue){if(re+Re>k.length)throw new RangeError("Index out of range");if(re<0)throw new RangeError("Index out of range")}function Ze(k,Z,re,Re,ce){return Z=+Z,re=re>>>0,ce||yi(k,Z,re,4),p.write(k,Z,re,Re,23,4),re+4}x.prototype.writeFloatLE=function(k,Z,re){return Ze(this,k,Z,!0,re)},x.prototype.writeFloatBE=function(k,Z,re){return Ze(this,k,Z,!1,re)};function ki(k,Z,re,Re,ce){return Z=+Z,re=re>>>0,ce||yi(k,Z,re,8),p.write(k,Z,re,Re,52,8),re+8}x.prototype.writeDoubleLE=function(k,Z,re){return ki(this,k,Z,!0,re)},x.prototype.writeDoubleBE=function(k,Z,re){return ki(this,k,Z,!1,re)},x.prototype.copy=function(k,Z,re,Re){if(!x.isBuffer(k))throw new TypeError("argument should be a Buffer");if(re||(re=0),!Re&&Re!==0&&(Re=this.length),Z>=k.length&&(Z=k.length),Z||(Z=0),Re>0&&Re<re&&(Re=re),Re===re||k.length===0||this.length===0)return 0;if(Z<0)throw new RangeError("targetStart out of bounds");if(re<0||re>=this.length)throw new RangeError("Index out of range");if(Re<0)throw new RangeError("sourceEnd out of bounds");Re>this.length&&(Re=this.length),k.length-Z<Re-re&&(Re=k.length-Z+re);const ce=Re-re;return this===k&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(Z,re,Re):Uint8Array.prototype.set.call(k,this.subarray(re,Re),Z),ce},x.prototype.fill=function(k,Z,re,Re){if(typeof k=="string"){if(typeof Z=="string"?(Re=Z,Z=0,re=this.length):typeof re=="string"&&(Re=re,re=this.length),Re!==void 0&&typeof Re!="string")throw new TypeError("encoding must be a string");if(typeof Re=="string"&&!x.isEncoding(Re))throw new TypeError("Unknown encoding: "+Re);if(k.length===1){const Ue=k.charCodeAt(0);(Re==="utf8"&&Ue<128||Re==="latin1")&&(k=Ue)}}else typeof k=="number"?k=k&255:typeof k=="boolean"&&(k=Number(k));if(Z<0||this.length<Z||this.length<re)throw new RangeError("Out of range index");if(re<=Z)return this;Z=Z>>>0,re=re===void 0?this.length:re>>>0,k||(k=0);let ce;if(typeof k=="number")for(ce=Z;ce<re;++ce)this[ce]=k;else{const Ue=x.isBuffer(k)?k:x.from(k,Re),je=Ue.length;if(je===0)throw new TypeError('The value "'+k+'" is invalid for argument "value"');for(ce=0;ce<re-Z;++ce)this[ce+Z]=Ue[ce%je]}return this};const hi={};function Ri(k,Z,re){hi[k]=class extends re{constructor(){super(),Object.defineProperty(this,"message",{value:Z.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${k}]`,this.stack,delete this.name}get code(){return k}set code(Re){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Re,writable:!0})}toString(){return`${this.name} [${k}]: ${this.message}`}}}Ri("ERR_BUFFER_OUT_OF_BOUNDS",function(k){return k?`${k} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ri("ERR_INVALID_ARG_TYPE",function(k,Z){return`The "${k}" argument must be of type number. Received type ${typeof Z}`},TypeError),Ri("ERR_OUT_OF_RANGE",function(k,Z,re){let Re=`The value of "${k}" is out of range.`,ce=re;return Number.isInteger(re)&&Math.abs(re)>4294967296?ce=Si(String(re)):typeof re=="bigint"&&(ce=String(re),(re>BigInt(2)**BigInt(32)||re<-(BigInt(2)**BigInt(32)))&&(ce=Si(ce)),ce+="n"),Re+=` It must be ${Z}. Received ${ce}`,Re},RangeError);function Si(k){let Z="",re=k.length;const Re=k[0]==="-"?1:0;for(;re>=Re+4;re-=3)Z=`_${k.slice(re-3,re)}${Z}`;return`${k.slice(0,re)}${Z}`}function tr(k,Z,re){Qe(Z,"offset"),(k[Z]===void 0||k[Z+re]===void 0)&&Ce(Z,k.length-(re+1))}function Vi(k,Z,re,Re,ce,Ue){if(k>re||k<Z){const je=typeof Z=="bigint"?"n":"";let dt;throw Z===0||Z===BigInt(0)?dt=`>= 0${je} and < 2${je} ** ${(Ue+1)*8}${je}`:dt=`>= -(2${je} ** ${(Ue+1)*8-1}${je}) and < 2 ** ${(Ue+1)*8-1}${je}`,new hi.ERR_OUT_OF_RANGE("value",dt,k)}tr(Re,ce,Ue)}function Qe(k,Z){if(typeof k!="number")throw new hi.ERR_INVALID_ARG_TYPE(Z,"number",k)}function Ce(k,Z,re){throw Math.floor(k)!==k?(Qe(k,re),new hi.ERR_OUT_OF_RANGE("offset","an integer",k)):Z<0?new hi.ERR_BUFFER_OUT_OF_BOUNDS:new hi.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${Z}`,k)}const yt=/[^+/0-9A-Za-z-_]/g;function Ot(k){if(k=k.split("=")[0],k=k.trim().replace(yt,""),k.length<2)return"";for(;k.length%4!==0;)k=k+"=";return k}function Jt(k,Z){Z=Z||1/0;let re;const Re=k.length;let ce=null;const Ue=[];for(let je=0;je<Re;++je){if(re=k.charCodeAt(je),re>55295&&re<57344){if(!ce){if(re>56319){(Z-=3)>-1&&Ue.push(239,191,189);continue}else if(je+1===Re){(Z-=3)>-1&&Ue.push(239,191,189);continue}ce=re;continue}if(re<56320){(Z-=3)>-1&&Ue.push(239,191,189),ce=re;continue}re=(ce-55296<<10|re-56320)+65536}else ce&&(Z-=3)>-1&&Ue.push(239,191,189);if(ce=null,re<128){if((Z-=1)<0)break;Ue.push(re)}else if(re<2048){if((Z-=2)<0)break;Ue.push(re>>6|192,re&63|128)}else if(re<65536){if((Z-=3)<0)break;Ue.push(re>>12|224,re>>6&63|128,re&63|128)}else if(re<1114112){if((Z-=4)<0)break;Ue.push(re>>18|240,re>>12&63|128,re>>6&63|128,re&63|128)}else throw new Error("Invalid code point")}return Ue}function zt(k){const Z=[];for(let re=0;re<k.length;++re)Z.push(k.charCodeAt(re)&255);return Z}function xi(k,Z){let re,Re,ce;const Ue=[];for(let je=0;je<k.length&&!((Z-=2)<0);++je)re=k.charCodeAt(je),Re=re>>8,ce=re%256,Ue.push(ce),Ue.push(Re);return Ue}function vt(k){return d.toByteArray(Ot(k))}function ye(k,Z,re,Re){let ce;for(ce=0;ce<Re&&!(ce+re>=Z.length||ce>=k.length);++ce)Z[ce+re]=k[ce];return ce}function ve(k,Z){return k instanceof Z||k!=null&&k.constructor!=null&&k.constructor.name!=null&&k.constructor.name===Z.name}function Le(k){return k!==k}const Te=function(){const k="0123456789abcdef",Z=new Array(256);for(let re=0;re<16;++re){const Re=re*16;for(let ce=0;ce<16;++ce)Z[Re+ce]=k[re]+k[ce]}return Z}();function Fe(k){return typeof BigInt>"u"?Pe:k}function Pe(){throw new Error("BigInt not supported")}},"./node_modules/css-loader/dist/runtime/api.js":l=>{l.exports=function(u){var c=[];return c.toString=function(){return this.map(function(d){var p="",f=typeof d[5]<"u";return d[4]&&(p+="@supports (".concat(d[4],") {")),d[2]&&(p+="@media ".concat(d[2]," {")),f&&(p+="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {")),p+=u(d),f&&(p+="}"),d[2]&&(p+="}"),d[4]&&(p+="}"),p}).join("")},c.i=function(d,p,f,m,g){typeof d=="string"&&(d=[[null,d,void 0]]);var y={};if(f)for(var x=0;x<this.length;x++){var v=this[x][0];v!=null&&(y[v]=!0)}for(var _=0;_<d.length;_++){var T=[].concat(d[_]);f&&y[T[0]]||(typeof g<"u"&&(typeof T[5]>"u"||(T[1]="@layer".concat(T[5].length>0?" ".concat(T[5]):""," {").concat(T[1],"}")),T[5]=g),p&&(T[2]&&(T[1]="@media ".concat(T[2]," {").concat(T[1],"}")),T[2]=p),m&&(T[4]?(T[1]="@supports (".concat(T[4],") {").concat(T[1],"}"),T[4]=m):T[4]="".concat(m)),c.push(T))}},c}},"./node_modules/css-loader/dist/runtime/getUrl.js":l=>{l.exports=function(u,c){return c||(c={}),u&&(u=String(u.__esModule?u.default:u),/^['"].*['"]$/.test(u)&&(u=u.slice(1,-1)),c.hash&&(u+=c.hash),/["'() \t\n]|(%20)/.test(u)||c.needQuotes?'"'.concat(u.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):u)}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":l=>{l.exports=function(u){var c=u[1],d=u[3];if(!d)return c;if(typeof btoa=="function"){var p=btoa(unescape(encodeURIComponent(JSON.stringify(d)))),f="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(p),m="/*# ".concat(f," */");return[c].concat([m]).join(`
`)}return[c].join(`
`)}},"./node_modules/debug/src/browser.js":(l,u,c)=>{u.formatArgs=p,u.save=f,u.load=m,u.useColors=d,u.storage=g(),u.destroy=(()=>{let x=!1;return()=>{x||(x=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),u.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function d(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function p(x){if(x[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+x[0]+(this.useColors?"%c ":" ")+"+"+l.exports.humanize(this.diff),!this.useColors)return;const v="color: "+this.color;x.splice(1,0,v,"color: inherit");let _=0,T=0;x[0].replace(/%[a-zA-Z%]/g,w=>{w!=="%%"&&(_++,w==="%c"&&(T=_))}),x.splice(T,0,v)}u.log=console.debug||console.log||(()=>{});function f(x){try{x?u.storage.setItem("debug",x):u.storage.removeItem("debug")}catch{}}function m(){let x;try{x=u.storage.getItem("debug")}catch{}return!x&&typeof process<"u"&&"env"in process&&(x=process.env.DEBUG),x}function g(){try{return localStorage}catch{}}l.exports=c("./node_modules/debug/src/common.js")(u);const{formatters:y}=l.exports;y.j=function(x){try{return JSON.stringify(x)}catch(v){return"[UnexpectedJSONParseError]: "+v.message}}},"./node_modules/debug/src/common.js":(l,u,c)=>{function d(p){m.debug=m,m.default=m,m.coerce=T,m.disable=x,m.enable=y,m.enabled=v,m.humanize=c("./node_modules/ms/index.js"),m.destroy=w,Object.keys(p).forEach(S=>{m[S]=p[S]}),m.names=[],m.skips=[],m.formatters={};function f(S){let R=0;for(let B=0;B<S.length;B++)R=(R<<5)-R+S.charCodeAt(B),R|=0;return m.colors[Math.abs(R)%m.colors.length]}m.selectColor=f;function m(S){let R,B=null,I,D;function L(...O){if(!L.enabled)return;const U=L,J=Number(new Date),H=J-(R||J);U.diff=H,U.prev=R,U.curr=J,R=J,O[0]=m.coerce(O[0]),typeof O[0]!="string"&&O.unshift("%O");let V=0;O[0]=O[0].replace(/%([a-zA-Z%])/g,($,Q)=>{if($==="%%")return"%";V++;const G=m.formatters[Q];if(typeof G=="function"){const j=O[V];$=G.call(U,j),O.splice(V,1),V--}return $}),m.formatArgs.call(U,O),(U.log||m.log).apply(U,O)}return L.namespace=S,L.useColors=m.useColors(),L.color=m.selectColor(S),L.extend=g,L.destroy=m.destroy,Object.defineProperty(L,"enabled",{enumerable:!0,configurable:!1,get:()=>B!==null?B:(I!==m.namespaces&&(I=m.namespaces,D=m.enabled(S)),D),set:O=>{B=O}}),typeof m.init=="function"&&m.init(L),L}function g(S,R){const B=m(this.namespace+(typeof R>"u"?":":R)+S);return B.log=this.log,B}function y(S){m.save(S),m.namespaces=S,m.names=[],m.skips=[];let R;const B=(typeof S=="string"?S:"").split(/[\s,]+/),I=B.length;for(R=0;R<I;R++)B[R]&&(S=B[R].replace(/\*/g,".*?"),S[0]==="-"?m.skips.push(new RegExp("^"+S.slice(1)+"$")):m.names.push(new RegExp("^"+S+"$")))}function x(){const S=[...m.names.map(_),...m.skips.map(_).map(R=>"-"+R)].join(",");return m.enable(""),S}function v(S){if(S[S.length-1]==="*")return!0;let R,B;for(R=0,B=m.skips.length;R<B;R++)if(m.skips[R].test(S))return!1;for(R=0,B=m.names.length;R<B;R++)if(m.names[R].test(S))return!0;return!1}function _(S){return S.toString().substring(2,S.toString().length-2).replace(/\.\*\?$/,"*")}function T(S){return S instanceof Error?S.stack||S.message:S}function w(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return m.enable(m.load()),m}l.exports=d},"./node_modules/deep-assign/index.js":(l,u,c)=>{var d=c("./node_modules/is-obj/index.js"),p=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;function m(x){if(x==null)throw new TypeError("Sources cannot be null or undefined");return Object(x)}function g(x,v,_){var T=v[_];if(T!=null){if(p.call(x,_)&&(x[_]===void 0||x[_]===null))throw new TypeError("Cannot convert undefined or null to object ("+_+")");!p.call(x,_)||!d(T)?x[_]=T:x[_]=y(Object(x[_]),v[_])}}function y(x,v){if(x===v)return x;v=Object(v);for(var _ in v)p.call(v,_)&&g(x,v,_);if(Object.getOwnPropertySymbols)for(var T=Object.getOwnPropertySymbols(v),w=0;w<T.length;w++)f.call(v,T[w])&&g(x,v,T[w]);return x}l.exports=function(x){x=m(x);for(var v=1;v<arguments.length;v++)y(x,arguments[v]);return x}},"./node_modules/dtype/index.js":l=>{l.exports=function(u){switch(u){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},"./node_modules/global/window.js":(l,u,c)=>{var d;typeof window<"u"?d=window:typeof c.g<"u"?d=c.g:typeof self<"u"?d=self:d={},l.exports=d},"./node_modules/ieee754/index.js":(l,u)=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */u.read=function(c,d,p,f,m){var g,y,x=m*8-f-1,v=(1<<x)-1,_=v>>1,T=-7,w=p?m-1:0,S=p?-1:1,R=c[d+w];for(w+=S,g=R&(1<<-T)-1,R>>=-T,T+=x;T>0;g=g*256+c[d+w],w+=S,T-=8);for(y=g&(1<<-T)-1,g>>=-T,T+=f;T>0;y=y*256+c[d+w],w+=S,T-=8);if(g===0)g=1-_;else{if(g===v)return y?NaN:(R?-1:1)*(1/0);y=y+Math.pow(2,f),g=g-_}return(R?-1:1)*y*Math.pow(2,g-f)},u.write=function(c,d,p,f,m,g){var y,x,v,_=g*8-m-1,T=(1<<_)-1,w=T>>1,S=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=f?0:g-1,B=f?1:-1,I=d<0||d===0&&1/d<0?1:0;for(d=Math.abs(d),isNaN(d)||d===1/0?(x=isNaN(d)?1:0,y=T):(y=Math.floor(Math.log(d)/Math.LN2),d*(v=Math.pow(2,-y))<1&&(y--,v*=2),y+w>=1?d+=S/v:d+=S*Math.pow(2,1-w),d*v>=2&&(y++,v/=2),y+w>=T?(x=0,y=T):y+w>=1?(x=(d*v-1)*Math.pow(2,m),y=y+w):(x=d*Math.pow(2,w-1)*Math.pow(2,m),y=0));m>=8;c[p+R]=x&255,R+=B,x/=256,m-=8);for(y=y<<m|x,_+=m;_>0;c[p+R]=y&255,R+=B,y/=256,_-=8);c[p+R-B]|=I*128}},"./node_modules/is-buffer/index.js":l=>{/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */l.exports=function(d){return d!=null&&(u(d)||c(d)||!!d._isBuffer)};function u(d){return!!d.constructor&&typeof d.constructor.isBuffer=="function"&&d.constructor.isBuffer(d)}function c(d){return typeof d.readFloatLE=="function"&&typeof d.slice=="function"&&u(d.slice(0,0))}},"./node_modules/is-function/index.js":l=>{l.exports=c;var u=Object.prototype.toString;function c(d){if(!d)return!1;var p=u.call(d);return p==="[object Function]"||typeof d=="function"&&p!=="[object RegExp]"||typeof window<"u"&&(d===window.setTimeout||d===window.alert||d===window.confirm||d===window.prompt)}},"./node_modules/is-obj/index.js":l=>{l.exports=function(u){var c=typeof u;return u!==null&&(c==="object"||c==="function")}},"./node_modules/layout-bmfont-text/index.js":(l,u,c)=>{var d=c("./node_modules/word-wrapper/index.js"),p=c("./node_modules/xtend/immutable.js"),f=c("./node_modules/as-number/index.js"),m=["x","e","a","o","n","s","r","c","u","m","v","w","z"],g=["m","w"],y=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],x=9,v=32,_=0,T=1,w=2;l.exports=function(V){return new S(V)};function S(V){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(V)}S.prototype.update=function(V){if(V=p({measure:this._measure},V),this._opt=V,this._opt.tabSize=f(this._opt.tabSize,4),!V.font)throw new Error("must provide a valid bitmap font");var $=this.glyphs,Q=V.text||"",G=V.font;this._setupSpaceGlyphs(G);var j=d.lines(Q,V),ie=V.width||0;$.length=0;var Y=j.reduce(function(At,Gt){return Math.max(At,Gt.width,ie)},0),ae=0,xe=0,fe=f(V.lineHeight,G.common.lineHeight),de=G.common.base,Ie=fe-de,Ge=V.letterSpacing||0,Xe=fe*j.length-Ie,$e=J(this._opt.align);xe-=Xe,this._width=Y,this._height=Xe,this._descender=fe-de,this._baseline=de,this._xHeight=D(G),this._capHeight=O(G),this._lineHeight=fe,this._ascender=fe-Ie-this._xHeight;var lt=this;j.forEach(function(At,Gt){for(var gt=At.start,yi=At.end,Ze=At.width,ki,hi=gt;hi<yi;hi++){var Ri=Q.charCodeAt(hi),Si=lt.getGlyph(G,Ri);if(Si){ki&&(ae+=U(G,ki.id,Si.id));var tr=ae;$e===T?tr+=(Y-Ze)/2:$e===w&&(tr+=Y-Ze),$.push({position:[tr,xe],data:Si,index:hi,line:Gt}),ae+=Si.xadvance+Ge,ki=Si}}xe+=fe,ae=0}),this._linesTotal=j.length},S.prototype._setupSpaceGlyphs=function(V){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,!(!V.chars||V.chars.length===0)){var $=I(V,v)||L(V)||V.chars[0],Q=this._opt.tabSize*$.xadvance;this._fallbackSpaceGlyph=$,this._fallbackTabGlyph=p($,{x:0,y:0,xadvance:Q,id:x,xoffset:0,yoffset:0,width:0,height:0})}},S.prototype.getGlyph=function(V,$){var Q=I(V,$);return Q||($===x?this._fallbackTabGlyph:$===v?this._fallbackSpaceGlyph:null)},S.prototype.computeMetrics=function(V,$,Q,G){var j=this._opt.letterSpacing||0,ie=this._opt.font,Y=0,ae=0,xe=0,fe,de;if(!ie.chars||ie.chars.length===0)return{start:$,end:$,width:0};Q=Math.min(V.length,Q);for(var Ie=$;Ie<Q;Ie++){var Ge=V.charCodeAt(Ie),fe=this.getGlyph(ie,Ge);if(fe){fe.xoffset;var Xe=de?U(ie,de.id,fe.id):0;Y+=Xe;var $e=Y+fe.xadvance+j,lt=Y+fe.width;if(lt>=G||$e>=G)break;Y=$e,ae=lt,de=fe}xe++}return de&&(ae+=de.xoffset),{start:$,end:$+xe,width:ae}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(R);function R(V){Object.defineProperty(S.prototype,V,{get:B(V),configurable:!0})}function B(V){return new Function(["return function "+V+"() {","  return this._"+V,"}"].join(`
`))()}function I(V,$){if(!V.chars||V.chars.length===0)return null;var Q=H(V.chars,$);return Q>=0?V.chars[Q]:null}function D(V){for(var $=0;$<m.length;$++){var Q=m[$].charCodeAt(0),G=H(V.chars,Q);if(G>=0)return V.chars[G].height}return 0}function L(V){for(var $=0;$<g.length;$++){var Q=g[$].charCodeAt(0),G=H(V.chars,Q);if(G>=0)return V.chars[G]}return 0}function O(V){for(var $=0;$<y.length;$++){var Q=y[$].charCodeAt(0),G=H(V.chars,Q);if(G>=0)return V.chars[G].height}return 0}function U(V,$,Q){if(!V.kernings||V.kernings.length===0)return 0;for(var G=V.kernings,j=0;j<G.length;j++){var ie=G[j];if(ie.first===$&&ie.second===Q)return ie.amount}return 0}function J(V){return V==="center"?T:V==="right"?w:_}function H(V,$,Q){Q=Q||0;for(var G=Q;G<V.length;G++)if(V[G].id===$)return G;return-1}},"./node_modules/load-bmfont/browser.js":(l,u,c)=>{var d=c("./node_modules/buffer/index.js").Buffer,p=c("./node_modules/xhr/index.js"),f=function(){},m=c("./node_modules/parse-bmfont-ascii/index.js"),g=c("./node_modules/parse-bmfont-xml/lib/browser.js"),y=c("./node_modules/parse-bmfont-binary/index.js"),x=c("./node_modules/load-bmfont/lib/is-binary.js"),v=c("./node_modules/xtend/immutable.js"),_=function(){return self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}();l.exports=function(S,R){R=typeof R=="function"?R:f,typeof S=="string"?S={uri:S}:S||(S={});var B=S.binary;B&&(S=w(S)),p(S,function(I,D,L){if(I)return R(I);if(!/^2/.test(D.statusCode))return R(new Error("http status code: "+D.statusCode));if(!L)return R(new Error("no body result"));var O=!1;if(T(L)){var U=new Uint8Array(L);L=d.from(U,"binary")}x(L)&&(O=!0,typeof L=="string"&&(L=d.from(L,"binary"))),O||(d.isBuffer(L)&&(L=L.toString(S.encoding)),L=L.trim());var J;try{var H=D.headers["content-type"];O?J=y(L):/json/.test(H)||L.charAt(0)==="{"?J=JSON.parse(L):/xml/.test(H)||L.charAt(0)==="<"?J=g(L):J=m(L)}catch(V){R(new Error("error parsing font "+V.message)),R=f}R(null,J)})};function T(S){var R=Object.prototype.toString;return R.call(S)==="[object ArrayBuffer]"}function w(S){if(_)return v(S,{responseType:"arraybuffer"});if(typeof self.XMLHttpRequest>"u")throw new Error("your browser does not support XHR loading");var R=new self.XMLHttpRequest;return R.overrideMimeType("text/plain; charset=x-user-defined"),v({xhr:R},S)}},"./node_modules/load-bmfont/lib/is-binary.js":(l,u,c)=>{var d=c("./node_modules/buffer/index.js").Buffer,p=c("./node_modules/buffer-equal/index.js"),f=d.from([66,77,70,3]);l.exports=function(m){return typeof m=="string"?m.substring(0,3)==="BMF":m.length>4&&p(m.slice(0,4),f)}},"./node_modules/ms/index.js":l=>{var u=1e3,c=u*60,d=c*60,p=d*24,f=p*7,m=p*365.25;l.exports=function(_,T){T=T||{};var w=typeof _;if(w==="string"&&_.length>0)return g(_);if(w==="number"&&isFinite(_))return T.long?x(_):y(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function g(_){if(_=String(_),!(_.length>100)){var T=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(T){var w=parseFloat(T[1]),S=(T[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return w*m;case"weeks":case"week":case"w":return w*f;case"days":case"day":case"d":return w*p;case"hours":case"hour":case"hrs":case"hr":case"h":return w*d;case"minutes":case"minute":case"mins":case"min":case"m":return w*c;case"seconds":case"second":case"secs":case"sec":case"s":return w*u;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return w;default:return}}}}function y(_){var T=Math.abs(_);return T>=p?Math.round(_/p)+"d":T>=d?Math.round(_/d)+"h":T>=c?Math.round(_/c)+"m":T>=u?Math.round(_/u)+"s":_+"ms"}function x(_){var T=Math.abs(_);return T>=p?v(_,T,p,"day"):T>=d?v(_,T,d,"hour"):T>=c?v(_,T,c,"minute"):T>=u?v(_,T,u,"second"):_+" ms"}function v(_,T,w,S){var R=T>=w*1.5;return Math.round(_/w)+" "+S+(R?"s":"")}},"./node_modules/parse-bmfont-ascii/index.js":l=>{l.exports=function(p){if(!p)throw new Error("no data provided");p=p.toString().trim();var f={pages:[],chars:[],kernings:[]},m=p.split(/\r\n?|\n/g);if(m.length===0)throw new Error("no data in BMFont file");for(var g=0;g<m.length;g++){var y=u(m[g],g);if(y)if(y.key==="page"){if(typeof y.data.id!="number")throw new Error("malformed file at line "+g+" -- needs page id=N");if(typeof y.data.file!="string")throw new Error("malformed file at line "+g+' -- needs page file="path"');f.pages[y.data.id]=y.data.file}else y.key==="chars"||y.key==="kernings"||(y.key==="char"?f.chars.push(y.data):y.key==="kerning"?f.kernings.push(y.data):f[y.key]=y.data)}return f};function u(p,f){if(p=p.replace(/\t+/g," ").trim(),!p)return null;var m=p.indexOf(" ");if(m===-1)throw new Error("no named row at line "+f);var g=p.substring(0,m);p=p.substring(m+1),p=p.replace(/letter=[\'\"]\S+[\'\"]/gi,""),p=p.split("="),p=p.map(function(T){return T.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var y=[],x=0;x<p.length;x++){var v=p[x];x===0?y.push({key:v[0],data:""}):x===p.length-1?y[y.length-1].data=c(v[0]):(y[y.length-1].data=c(v[0]),y.push({key:v[1],data:""}))}var _={key:g,data:{}};return y.forEach(function(T){_.data[T.key]=T.data}),_}function c(p){return!p||p.length===0?"":p.indexOf('"')===0||p.indexOf("'")===0?p.substring(1,p.length-1):p.indexOf(",")!==-1?d(p):parseInt(p,10)}function d(p){return p.split(",").map(function(f){return parseInt(f,10)})}},"./node_modules/parse-bmfont-binary/index.js":l=>{var u=[66,77,70];l.exports=function(v){if(v.length<6)throw new Error("invalid buffer length for BMFont");var _=u.every(function(B,I){return v.readUInt8(I)===B});if(!_)throw new Error("BMFont missing BMF byte header");var T=3,w=v.readUInt8(T++);if(w>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var S={kernings:[],chars:[]},R=0;R<5;R++)T+=c(S,v,T);return S};function c(v,_,T){if(T>_.length-1)return 0;var w=_.readUInt8(T++),S=_.readInt32LE(T);switch(T+=4,w){case 1:v.info=d(_,T);break;case 2:v.common=p(_,T);break;case 3:v.pages=f(_,T,S);break;case 4:v.chars=m(_,T,S);break;case 5:v.kernings=g(_,T,S);break}return 5+S}function d(v,_){var T={};T.size=v.readInt16LE(_);var w=v.readUInt8(_+2);return T.smooth=w>>7&1,T.unicode=w>>6&1,T.italic=w>>5&1,T.bold=w>>4&1,w>>3&1&&(T.fixedHeight=1),T.charset=v.readUInt8(_+3)||"",T.stretchH=v.readUInt16LE(_+4),T.aa=v.readUInt8(_+6),T.padding=[v.readInt8(_+7),v.readInt8(_+8),v.readInt8(_+9),v.readInt8(_+10)],T.spacing=[v.readInt8(_+11),v.readInt8(_+12)],T.outline=v.readUInt8(_+13),T.face=x(v,_+14),T}function p(v,_){var T={};return T.lineHeight=v.readUInt16LE(_),T.base=v.readUInt16LE(_+2),T.scaleW=v.readUInt16LE(_+4),T.scaleH=v.readUInt16LE(_+6),T.pages=v.readUInt16LE(_+8),v.readUInt8(_+10),T.packed=0,T.alphaChnl=v.readUInt8(_+11),T.redChnl=v.readUInt8(_+12),T.greenChnl=v.readUInt8(_+13),T.blueChnl=v.readUInt8(_+14),T}function f(v,_,T){for(var w=[],S=y(v,_),R=S.length+1,B=T/R,I=0;I<B;I++)w[I]=v.slice(_,_+S.length).toString("utf8"),_+=R;return w}function m(v,_,T){for(var w=[],S=T/20,R=0;R<S;R++){var B={},I=R*20;B.id=v.readUInt32LE(_+0+I),B.x=v.readUInt16LE(_+4+I),B.y=v.readUInt16LE(_+6+I),B.width=v.readUInt16LE(_+8+I),B.height=v.readUInt16LE(_+10+I),B.xoffset=v.readInt16LE(_+12+I),B.yoffset=v.readInt16LE(_+14+I),B.xadvance=v.readInt16LE(_+16+I),B.page=v.readUInt8(_+18+I),B.chnl=v.readUInt8(_+19+I),w[R]=B}return w}function g(v,_,T){for(var w=[],S=T/10,R=0;R<S;R++){var B={},I=R*10;B.first=v.readUInt32LE(_+0+I),B.second=v.readUInt32LE(_+4+I),B.amount=v.readInt16LE(_+8+I),w[R]=B}return w}function y(v,_){for(var T=_;T<v.length&&v[T]!==0;T++);return v.slice(_,T)}function x(v,_){return y(v,_).toString("utf8")}},"./node_modules/parse-bmfont-xml/lib/browser.js":(l,u,c)=>{var d=c("./node_modules/parse-bmfont-xml/lib/parse-attribs.js"),p=c("./node_modules/xml-parse-from-string/index.js"),f={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};l.exports=function(x){x=x.toString();var v=p(x),_={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(D){var L=v.getElementsByTagName(D)[0];L&&(_[D]=d(m(L)))});var T=v.getElementsByTagName("pages")[0];if(!T)throw new Error("malformed file -- no <pages> element");for(var w=T.getElementsByTagName("page"),S=0;S<w.length;S++){var R=w[S],B=parseInt(R.getAttribute("id"),10),I=R.getAttribute("file");if(isNaN(B))throw new Error('malformed file -- page "id" attribute is NaN');if(!I)throw new Error('malformed file -- needs page "file" attribute');_.pages[parseInt(B,10)]=I}return["chars","kernings"].forEach(function(D){var L=v.getElementsByTagName(D)[0];if(L)for(var O=D.substring(0,D.length-1),U=L.getElementsByTagName(O),J=0;J<U.length;J++){var H=U[J];_[D].push(d(m(H)))}}),_};function m(x){var v=g(x);return v.reduce(function(_,T){var w=y(T.nodeName);return _[w]=T.nodeValue,_},{})}function g(x){for(var v=[],_=0;_<x.attributes.length;_++)v.push(x.attributes[_]);return v}function y(x){return f[x.toLowerCase()]||x}},"./node_modules/parse-bmfont-xml/lib/parse-attribs.js":l=>{var u="chasrset";l.exports=function(d){u in d&&(d.charset=d[u],delete d[u]);for(var p in d)p==="face"||p==="charset"||(p==="padding"||p==="spacing"?d[p]=c(d[p]):d[p]=parseInt(d[p],10));return d};function c(d){return d.split(",").map(function(p){return parseInt(p,10)})}},"./node_modules/parse-headers/parse-headers.js":l=>{var u=function(d){return d.replace(/^\s+|\s+$/g,"")},c=function(d){return Object.prototype.toString.call(d)==="[object Array]"};l.exports=function(d){if(!d)return{};for(var p={},f=u(d).split(`
`),m=0;m<f.length;m++){var g=f[m],y=g.indexOf(":"),x=u(g.slice(0,y)).toLowerCase(),v=u(g.slice(y+1));typeof p[x]>"u"?p[x]=v:c(p[x])?p[x].push(v):p[x]=[p[x],v]}return p}},"./node_modules/quad-indices/index.js":(l,u,c)=>{var d=c("./node_modules/dtype/index.js"),p=c("./node_modules/an-array/index.js"),f=c("./node_modules/is-buffer/index.js"),m=[0,2,3],g=[2,1,3];l.exports=function(y,x){(!y||!(p(y)||f(y)))&&(x=y||{},y=null),typeof x=="number"?x={count:x}:x=x||{};for(var v=typeof x.type=="string"?x.type:"uint16",_=typeof x.count=="number"?x.count:1,T=x.start||0,w=x.clockwise!==!1?m:g,S=w[0],R=w[1],B=w[2],I=_*6,D=y||new(d(v))(I),L=0,O=0;L<I;L+=6,O+=4){var U=L+T;D[U+0]=O+0,D[U+1]=O+1,D[U+2]=O+2,D[U+3]=O+S,D[U+4]=O+R,D[U+5]=O+B}return D}},"./node_modules/super-animejs/lib/anime.es.js":(l,u,c)=>{c.r(u),c.d(u,{default:()=>Be});var d={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},p={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},f=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],m={CSS:{},springs:{}};function g(se,ge,Ne){return Math.min(Math.max(se,ge),Ne)}function y(se,ge){return se.indexOf(ge)>-1}function x(se,ge){return se.apply(null,ge)}var v=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,_=/^rgb/,T=/^hsl/,w={arr:function(se){return Array.isArray(se)},obj:function(se){return y(Object.prototype.toString.call(se),"Object")},pth:function(se){return w.obj(se)&&se.hasOwnProperty("totalLength")},svg:function(se){return se instanceof SVGElement},inp:function(se){return se instanceof HTMLInputElement},dom:function(se){return se.nodeType||w.svg(se)},str:function(se){return typeof se=="string"},fnc:function(se){return typeof se=="function"},und:function(se){return typeof se>"u"},hex:function(se){return v.test(se)},rgb:function(se){return _.test(se)},hsl:function(se){return T.test(se)},col:function(se){return w.hex(se)||w.rgb(se)||w.hsl(se)},key:function(se){return!d.hasOwnProperty(se)&&!p.hasOwnProperty(se)&&se!=="targets"&&se!=="keyframes"}},S=/\(([^)]+)\)/;function R(se){var ge=S.exec(se);return ge?ge[1].split(",").map(function(Ne){return parseFloat(Ne)}):[]}function B(se,ge){var Ne=R(se),ke=g(w.und(Ne[0])?1:Ne[0],.1,100),Ke=g(w.und(Ne[1])?100:Ne[1],.1,100),ot=g(w.und(Ne[2])?10:Ne[2],.1,100),wt=g(w.und(Ne[3])?0:Ne[3],.1,100),qt=Math.sqrt(Ke/ke),Kt=ot/(2*Math.sqrt(Ke*ke)),Rt=Kt<1?qt*Math.sqrt(1-Kt*Kt):0,ti=1,bi=Kt<1?(Kt*qt+-wt)/Rt:-wt+qt;function Fi(ur){var Ji=ge?ge*ur/1e3:ur;return Kt<1?Ji=Math.exp(-Ji*Kt*qt)*(ti*Math.cos(Rt*Ji)+bi*Math.sin(Rt*Ji)):Ji=(ti+bi*Ji)*Math.exp(-Ji*qt),ur===0||ur===1?ur:1-Ji}function Cr(){var ur=m.springs[se];if(ur)return ur;for(var Ji=.16666666666666666,vi=0,Tn=0;;)if(vi+=Ji,Fi(vi)===1){if(Tn++,Tn>=16)break}else Tn=0;var qn=vi*Ji*1e3;return m.springs[se]=qn,qn}return ge?Fi:Cr}function I(se,ge){se===void 0&&(se=1),ge===void 0&&(ge=.5);var Ne=g(se,1,10),ke=g(ge,.1,2);return function(Ke){return Ke===0||Ke===1?Ke:-Ne*Math.pow(2,10*(Ke-1))*Math.sin((Ke-1-ke/(Math.PI*2)*Math.asin(1/Ne))*(Math.PI*2)/ke)}}function D(se){return se===void 0&&(se=10),function(ge){return Math.round(ge*se)*(1/se)}}var L=function(){var se=11,ge=1/(se-1);function Ne(ti,bi){return 1-3*bi+3*ti}function ke(ti,bi){return 3*bi-6*ti}function Ke(ti){return 3*ti}function ot(ti,bi,Fi){return((Ne(bi,Fi)*ti+ke(bi,Fi))*ti+Ke(bi))*ti}function wt(ti,bi,Fi){return 3*Ne(bi,Fi)*ti*ti+2*ke(bi,Fi)*ti+Ke(bi)}function qt(ti,bi,Fi,Cr,ur){var Ji,vi,Tn=0;do vi=bi+(Fi-bi)/2,Ji=ot(vi,Cr,ur)-ti,Ji>0?Fi=vi:bi=vi;while(Math.abs(Ji)>1e-7&&++Tn<10);return vi}function Kt(ti,bi,Fi,Cr){for(var ur=0;ur<4;++ur){var Ji=wt(bi,Fi,Cr);if(Ji===0)return bi;var vi=ot(bi,Fi,Cr)-ti;bi-=vi/Ji}return bi}function Rt(ti,bi,Fi,Cr){if(!(0<=ti&&ti<=1&&0<=Fi&&Fi<=1))return;var ur=new Float32Array(se);if(ti!==bi||Fi!==Cr)for(var Ji=0;Ji<se;++Ji)ur[Ji]=ot(Ji*ge,ti,Fi);function vi(Tn){for(var qn=0,Mi=1,ar=se-1;Mi!==ar&&ur[Mi]<=Tn;++Mi)qn+=ge;--Mi;var un=(Tn-ur[Mi])/(ur[Mi+1]-ur[Mi]),Qr=qn+un*ge,W=wt(Qr,ti,Fi);return W>=.001?Kt(Tn,Qr,ti,Fi):W===0?Qr:qt(Tn,qn,qn+ge,ti,Fi)}return function(Tn){return ti===bi&&Fi===Cr||Tn===0||Tn===1?Tn:ot(vi(Tn),bi,Cr)}}return Rt}(),O=function(){var se=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],ge={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],I],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(wt,qt){return function(Kt){return 1-I(wt,qt)(1-Kt)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(wt,qt){return function(Kt){return Kt<.5?I(wt,qt)(Kt*2)/2:1-I(wt,qt)(Kt*-2+2)/2}}]},Ne={linear:[.25,.25,.75,.75]};for(var ke in ge)for(var Ke=0,ot=ge[ke].length;Ke<ot;Ke++)Ne["ease"+ke+se[Ke]]=ge[ke][Ke];return Ne}();function U(se,ge){if(w.fnc(se))return se;var Ne=se.split("(")[0],ke=O[Ne],Ke=R(se);switch(Ne){case"spring":return B(se,ge);case"cubicBezier":return x(L,Ke);case"steps":return x(D,Ke);default:return w.fnc(ke)?x(ke,Ke):x(L,ke)}}function J(se){try{var ge=document.querySelectorAll(se);return ge}catch{return}}var H=[];function V(se,ge){for(var Ne=H,ke=se.length,Ke=arguments.length>=2?arguments[1]:void 0,ot=0;ot<ke;ot++)if(ot in se){var wt=se[ot];ge.call(Ke,wt,ot,se)&&Ne.push(wt)}return H=se,H.length=0,Ne}function $(se,ge){ge||(ge=[]);for(var Ne=0,ke=se.length;Ne<ke;Ne++){var Ke=se[Ne];Array.isArray(Ke)?$(Ke,ge):ge.push(Ke)}return ge}function Q(se){return w.arr(se)?se:(w.str(se)&&(se=J(se)||se),se instanceof NodeList||se instanceof HTMLCollection?[].slice.call(se):[se])}function G(se,ge){return se.some(function(Ne){return Ne===ge})}function j(se){var ge={};for(var Ne in se)ge[Ne]=se[Ne];return ge}function ie(se,ge){var Ne=j(se);for(var ke in se)Ne[ke]=ge.hasOwnProperty(ke)?ge[ke]:se[ke];return Ne}function Y(se,ge){var Ne=j(se);for(var ke in ge)Ne[ke]=w.und(se[ke])?ge[ke]:se[ke];return Ne}var ae=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g;function xe(se){var ge=ae.exec(se);return ge?"rgba("+ge[1]+",1)":se}var fe=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,de=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;function Ie(se){var ge=se.replace(fe,function(wt,qt,Kt,Rt){return qt+qt+Kt+Kt+Rt+Rt}),Ne=de.exec(ge),ke=parseInt(Ne[1],16),Ke=parseInt(Ne[2],16),ot=parseInt(Ne[3],16);return"rgba("+ke+","+Ke+","+ot+",1)"}var Ge=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,Xe=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g;function $e(se){var ge=Ge.exec(se)||Xe.exec(se),Ne=parseInt(ge[1],10)/360,ke=parseInt(ge[2],10)/100,Ke=parseInt(ge[3],10)/100,ot=ge[4]||1;function wt(Fi,Cr,ur){return ur<0&&(ur+=1),ur>1&&(ur-=1),ur<.16666666666666666?Fi+(Cr-Fi)*6*ur:ur<.5?Cr:ur<.6666666666666666?Fi+(Cr-Fi)*(.6666666666666666-ur)*6:Fi}var qt,Kt,Rt;if(ke==0)qt=Kt=Rt=Ke;else{var ti=Ke<.5?Ke*(1+ke):Ke+ke-Ke*ke,bi=2*Ke-ti;qt=wt(bi,ti,Ne+.3333333333333333),Kt=wt(bi,ti,Ne),Rt=wt(bi,ti,Ne-.3333333333333333)}return"rgba("+qt*255+","+Kt*255+","+Rt*255+","+ot+")"}function lt(se){if(w.rgb(se))return xe(se);if(w.hex(se))return Ie(se);if(w.hsl(se))return $e(se)}var At=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function Gt(se){var ge=At.exec(se);if(ge)return ge[2]}function gt(se){if(y(se,"translate")||se==="perspective")return"px";if(y(se,"rotate")||y(se,"skew"))return"deg"}function yi(se,ge){return w.fnc(se)?se(ge.target,ge.id,ge.total):se}function Ze(se,ge){return se.getAttribute(ge)}function ki(se,ge,Ne){var ke=Gt(ge);if(G([Ne,"deg","rad","turn"],ke))return ge;var Ke=m.CSS[ge+Ne];if(!w.und(Ke))return Ke;var ot=100,wt=document.createElement(se.tagName),qt=se.parentNode&&se.parentNode!==document?se.parentNode:document.body;qt.appendChild(wt),wt.style.position="absolute",wt.style.width=ot+Ne;var Kt=ot/wt.offsetWidth;qt.removeChild(wt);var Rt=Kt*parseFloat(ge);return m.CSS[ge+Ne]=Rt,Rt}function hi(se,ge,Ne){if(ge in se.style){var ke=ge.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Ke=se.style[ge]||getComputedStyle(se).getPropertyValue(ke)||"0";return Ne?ki(se,Ke,Ne):Ke}}function Ri(se,ge){if(w.dom(se)&&!w.inp(se)&&(Ze(se,ge)||w.svg(se)&&se[ge]))return"attribute";if(w.dom(se)&&G(f,ge))return"transform";if(w.dom(se)&&ge!=="transform"&&hi(se,ge))return"css";if(se[ge]!=null)return"object"}var Si=/(\w+)\(([^)]*)\)/g;function tr(se){if(w.dom(se)){for(var ge=se.style.transform||"",Ne=new Map,ke;ke=Si.exec(ge);)Ne.set(ke[1],ke[2]);return Ne}}function Vi(se,ge,Ne,ke){var Ke=y(ge,"scale")?1:0+gt(ge),ot=tr(se).get(ge)||Ke;return Ne&&(Ne.transforms.list.set(ge,ot),Ne.transforms.last=ge),ke?ki(se,ot,ke):ot}function Qe(se,ge,Ne,ke){switch(Ri(se,ge)){case"transform":return Vi(se,ge,ke,Ne);case"css":return hi(se,ge,Ne);case"attribute":return Ze(se,ge);default:return se[ge]||0}}var Ce=/^(\*=|\+=|-=)/;function yt(se,ge){var Ne=Ce.exec(se);if(!Ne)return se;var ke=Gt(se)||0,Ke=parseFloat(ge),ot=parseFloat(se.replace(Ne[0],""));switch(Ne[0][0]){case"+":return Ke+ot+ke;case"-":return Ke-ot+ke;case"*":return Ke*ot+ke}}var Ot=/\s/g;function Jt(se,ge){if(w.col(se))return lt(se);var Ne=Gt(se),ke=Ne?se.substr(0,se.length-Ne.length):se;return ge&&!Ot.test(se)?ke+ge:ke}function zt(se,ge){return Math.sqrt(Math.pow(ge.x-se.x,2)+Math.pow(ge.y-se.y,2))}function xi(se){return Math.PI*2*Ze(se,"r")}function vt(se){return Ze(se,"width")*2+Ze(se,"height")*2}function ye(se){return zt({x:Ze(se,"x1"),y:Ze(se,"y1")},{x:Ze(se,"x2"),y:Ze(se,"y2")})}function ve(se){for(var ge=se.points,Ne=0,ke,Ke=0;Ke<ge.numberOfItems;Ke++){var ot=ge.getItem(Ke);Ke>0&&(Ne+=zt(ke,ot)),ke=ot}return Ne}function Le(se){var ge=se.points;return ve(se)+zt(ge.getItem(ge.numberOfItems-1),ge.getItem(0))}function Te(se){if(se.getTotalLength)return se.getTotalLength();switch(se.tagName.toLowerCase()){case"circle":return xi(se);case"rect":return vt(se);case"line":return ye(se);case"polyline":return ve(se);case"polygon":return Le(se)}}function Fe(se){var ge=Te(se);return se.setAttribute("stroke-dasharray",ge),ge}function Pe(se){for(var ge=se.parentNode;w.svg(ge)&&(ge=ge.parentNode,!!w.svg(ge.parentNode)););return ge}function k(se,ge){var Ne=ge||{},ke=Ne.el||Pe(se),Ke=ke.getBoundingClientRect(),ot=Ze(ke,"viewBox"),wt=Ke.width,qt=Ke.height,Kt=Ne.viewBox||(ot?ot.split(" "):[0,0,wt,qt]);return{el:ke,viewBox:Kt,x:Kt[0]/1,y:Kt[1]/1,w:wt/Kt[2],h:qt/Kt[3]}}function Z(se,ge){var Ne=w.str(se)?J(se)[0]:se,ke=ge||100;return function(Ke){return{property:Ke,el:Ne,svg:k(Ne),totalLength:Te(Ne)*(ke/100)}}}function re(se,ge){function Ne(qt){qt===void 0&&(qt=0);var Kt=ge+qt>=1?ge+qt:0;return se.el.getPointAtLength(Kt)}var ke=k(se.el,se.svg),Ke=Ne(),ot=Ne(-1),wt=Ne(1);switch(se.property){case"x":return(Ke.x-ke.x)*ke.w;case"y":return(Ke.y-ke.y)*ke.h;case"angle":return Math.atan2(wt.y-ot.y,wt.x-ot.x)*180/Math.PI}}var Re=/-?\d*\.?\d+/g;function ce(se,ge){var Ne=Jt(w.pth(se)?se.totalLength:se,ge)+"";return{original:Ne,numbers:Ne.match(Re)?Ne.match(Re).map(Number):[0],strings:w.str(se)||ge?Ne.split(Re):[]}}function Ue(se){var ge=se?$(w.arr(se)?se.map(Q):Q(se)):[];return V(ge,function(Ne,ke,Ke){return Ke.indexOf(Ne)===ke})}function je(se){var ge=Ue(se);return ge.map(function(Ne,ke){return{target:Ne,id:ke,total:ge.length,transforms:{list:tr(Ne)}}})}var dt=/^spring/;function Bt(se,ge){var Ne=j(ge);if(dt.test(Ne.easing)&&(Ne.duration=B(Ne.easing)),w.arr(se)){var ke=se.length,Ke=ke===2&&!w.obj(se[0]);Ke?se={value:se}:w.fnc(ge.duration)||(Ne.duration=ge.duration/ke)}var ot=w.arr(se)?se:[se];return ot.map(function(wt,qt){var Kt=w.obj(wt)&&!w.pth(wt)?wt:{value:wt};return w.und(Kt.delay)&&(Kt.delay=qt?0:ge.delay),w.und(Kt.endDelay)&&(Kt.endDelay=qt===ot.length-1?ge.endDelay:0),Kt}).map(function(wt){return Y(wt,Ne)})}function bt(se){for(var ge=V($(se.map(function(ot){return Object.keys(ot)})),function(ot){return w.key(ot)}).reduce(function(ot,wt){return ot.indexOf(wt)<0&&ot.push(wt),ot},[]),Ne={},ke=function(ot){var wt=ge[ot];Ne[wt]=se.map(function(qt){var Kt={};for(var Rt in qt)w.key(Rt)?Rt==wt&&(Kt.value=qt[Rt]):Kt[Rt]=qt[Rt];return Kt})},Ke=0;Ke<ge.length;Ke++)ke(Ke);return Ne}function Ut(se,ge){var Ne=[],ke=ge.keyframes;ke&&(ge=Y(bt(ke),ge));for(var Ke in ge)w.key(Ke)&&Ne.push({name:Ke,tweens:Bt(ge[Ke],se)});return Ne}function di(se,ge){var Ne={};for(var ke in se){var Ke=yi(se[ke],ge);w.arr(Ke)&&(Ke=Ke.map(function(ot){return yi(ot,ge)}),Ke.length===1&&(Ke=Ke[0])),Ne[ke]=Ke}return Ne.duration=parseFloat(Ne.duration),Ne.delay=parseFloat(Ne.delay),Ne}function br(se,ge){var Ne;return se.tweens.map(function(ke){var Ke=di(ke,ge),ot=Ke.value,wt=w.arr(ot)?ot[1]:ot,qt=Gt(wt),Kt=Qe(ge.target,se.name,qt,ge),Rt=Ne?Ne.to.original:Kt,ti=w.arr(ot)?ot[0]:Rt,bi=Gt(ti)||Gt(Kt),Fi=qt||bi;return w.und(wt)&&(wt=Rt),Ke.from=ce(ti,Fi),Ke.to=ce(yt(wt,ti),Fi),Ke.start=Ne?Ne.end:0,Ke.end=Ke.start+Ke.delay+Ke.duration+Ke.endDelay,Ke.easing=U(Ke.easing,Ke.duration),Ke.isPath=w.pth(ot),Ke.isColor=w.col(Ke.from.original),Ke.isColor&&(Ke.round=1),Ne=Ke,Ke})}var Pi={css:function(se,ge,Ne){return se.style[ge]=Ne},attribute:function(se,ge,Ne){return se.setAttribute(ge,Ne)},object:function(se,ge,Ne){return se[ge]=Ne},transform:function(se,ge,Ne,ke,Ke){if(ke.list.set(ge,Ne),ge===ke.last||Ke){var ot="";ke.list.forEach(function(wt,qt){ot+=qt+"("+wt+") "}),se.style.transform=ot}}};function fn(se,ge){for(var Ne=je(se),ke=0,Ke=Ne.length;ke<Ke;ke++){var ot=Ne[ke];for(var wt in ge){var qt=yi(ge[wt],ot),Kt=ot.target,Rt=Gt(qt),ti=Qe(Kt,wt,Rt,ot),bi=Rt||Gt(ti),Fi=yt(Jt(qt,bi),ti),Cr=Ri(Kt,wt);Pi[Cr](Kt,wt,Fi,ot.transforms,!0)}}}function Pr(se,ge){var Ne=Ri(se.target,ge.name);if(Ne){var ke=br(ge,se),Ke=ke[ke.length-1];return{type:Ne,property:ge.name,animatable:se,tweens:ke,duration:Ke.end,delay:ke[0].delay,endDelay:Ke.endDelay}}}function tn(se,ge){return V($(se.map(function(Ne){return ge.map(function(ke){return Pr(Ne,ke)})})),function(Ne){return!w.und(Ne)})}function gs(se,ge){var Ne=se.length,ke=function(ot){return ot.timelineOffset?ot.timelineOffset:0},Ke={};return Ke.duration=Ne?Math.max.apply(Math,se.map(function(ot){return ke(ot)+ot.duration})):ge.duration,Ke.delay=Ne?Math.min.apply(Math,se.map(function(ot){return ke(ot)+ot.delay})):ge.delay,Ke.endDelay=Ne?Ke.duration-Math.max.apply(Math,se.map(function(ot){return ke(ot)+ot.duration-ot.endDelay})):ge.endDelay,Ke}var mn=0;function Rs(se){var ge=ie(d,se),Ne=ie(p,se),ke=Ut(Ne,se),Ke=je(se.targets),ot=tn(Ke,ke),wt=gs(ot,Ne),qt=mn;return mn++,Y(ge,{id:qt,children:[],animatables:Ke,animations:ot,duration:wt.duration,delay:wt.delay,endDelay:wt.endDelay})}var $n=[],As=[],me,ct=function(){function se(){me=requestAnimationFrame(ge)}function ge(Ne){var ke=$n.length;if(ke){for(var Ke=0;Ke<ke;){var ot=$n[Ke];if(!ot.paused)ot.tick(Ne);else{var wt=$n.indexOf(ot);wt>-1&&($n.splice(wt,1),ke=$n.length)}Ke++}se()}else me=cancelAnimationFrame(me)}return se}();function St(){if(document.hidden){for(var se=0,ge=$n.length;se<ge;se++)activeInstance[se].pause();As=$n.slice(0),$n=[]}else for(var Ne=0,ke=As.length;Ne<ke;Ne++)As[Ne].play()}document.addEventListener("visibilitychange",St);function Xt(se){se===void 0&&(se={});var ge=0,Ne=0,ke=0,Ke,ot=0,wt=null;function qt(){return window.Promise&&new Promise(function(Mi){return wt=Mi})}var Kt=qt(),Rt=Rs(se);function ti(){Rt.reversed=!Rt.reversed;for(var Mi=0,ar=Ke.length;Mi<ar;Mi++)Ke[Mi].reversed=Rt.reversed}function bi(Mi){return Rt.reversed?Rt.duration-Mi:Mi}function Fi(){ge=0,Ne=bi(Rt.currentTime)*(1/Xt.speed)}function Cr(Mi,ar){ar&&ar.seek(Mi-ar.timelineOffset)}function ur(Mi){if(Rt.reversePlayback)for(var ar=ot;ar--;)Cr(Mi,Ke[ar]);else for(var un=0;un<ot;un++)Cr(Mi,Ke[un])}function Ji(Mi){for(var ar=0,un=Rt.animations,Qr=un.length;ar<Qr;){var W=un[ar],ue=W.animatable,Ae=W.tweens,Se=Ae.length-1,We=Ae[Se];Se&&(We=V(Ae,function(dr){return Mi<dr.end})[0]||We);for(var Ye=g(Mi-We.start-We.delay,0,We.duration)/We.duration,ft=isNaN(Ye)?1:We.easing(Ye),he=We.to.strings,le=We.round,pe=[],be=We.to.numbers.length,Ee=void 0,st=0;st<be;st++){var Ct=void 0,Ht=We.to.numbers[st],ii=We.from.numbers[st]||0;We.isPath?Ct=re(We.value,ft*Ht):Ct=ii+ft*(Ht-ii),le&&(We.isColor&&st>2||(Ct=Math.round(Ct*le)/le)),pe.push(Ct)}var mi=he.length;if(!mi)Ee=pe[0];else{Ee=he[0];for(var Wt=0;Wt<mi;Wt++){he[Wt];var Bi=he[Wt+1],yr=pe[Wt];isNaN(yr)||(Bi?Ee+=yr+Bi:Ee+=yr+" ")}}Pi[W.type](ue.target,W.property,Ee,ue.transforms),W.currentValue=Ee,ar++}}function vi(Mi){Rt[Mi]&&!Rt.passThrough&&Rt[Mi](Rt)}function Tn(){Rt.remaining&&Rt.remaining!==!0&&Rt.remaining--}function qn(Mi){var ar=Rt.duration,un=Rt.delay,Qr=ar-Rt.endDelay,W=bi(Mi);Rt.progress=g(W/ar*100,0,100),Rt.reversePlayback=W<Rt.currentTime,Ke&&ur(W),!Rt.began&&Rt.currentTime>0&&(Rt.began=!0,vi("begin"),vi("loopBegin")),W<=un&&Rt.currentTime!==0&&Ji(0),(W>=Qr&&Rt.currentTime!==ar||!ar)&&Ji(ar),W>un&&W<Qr?(Rt.changeBegan||(Rt.changeBegan=!0,Rt.changeCompleted=!1,vi("changeBegin")),vi("change"),Ji(W)):Rt.changeBegan&&(Rt.changeCompleted=!0,Rt.changeBegan=!1,vi("changeComplete")),Rt.currentTime=g(W,0,ar),Rt.began&&vi("update"),Mi>=ar&&(Ne=0,Tn(),Rt.remaining?(ge=ke,vi("loopComplete"),vi("loopBegin"),Rt.direction==="alternate"&&ti()):(Rt.paused=!0,Rt.completed||(Rt.completed=!0,vi("loopComplete"),vi("complete"),"Promise"in window&&(wt(),Kt=qt()))))}return Rt.reset=function(){var Mi=Rt.direction;Rt.passThrough=!1,Rt.currentTime=0,Rt.progress=0,Rt.paused=!0,Rt.began=!1,Rt.changeBegan=!1,Rt.completed=!1,Rt.changeCompleted=!1,Rt.reversePlayback=!1,Rt.reversed=Mi==="reverse",Rt.remaining=Rt.loop,Ke=Rt.children,ot=Ke.length;for(var ar=ot;ar--;)Rt.children[ar].reset();(Rt.reversed&&Rt.loop!==!0||Mi==="alternate"&&Rt.loop===1)&&Rt.remaining++,Ji(0)},Rt.set=function(Mi,ar){return fn(Mi,ar),Rt},Rt.tick=function(Mi){ke=Mi,ge||(ge=ke),qn((ke+(Ne-ge))*Xt.speed)},Rt.seek=function(Mi){qn(bi(Mi))},Rt.pause=function(){Rt.paused=!0,Fi()},Rt.play=function(){Rt.paused&&(Rt.paused=!1,$n.push(Rt),Fi(),me||ct())},Rt.reverse=function(){ti(),Fi()},Rt.restart=function(){Rt.reset(),Rt.play()},Rt.finished=Kt,Rt.reset(),Rt.autoplay&&Rt.play(),Rt}function Ii(se,ge){for(var Ne=ge.length;Ne--;)G(se,ge[Ne].animatable.target)&&ge.splice(Ne,1)}function sr(se){for(var ge=Ue(se),Ne=$n.length;Ne--;){var ke=$n[Ne],Ke=ke.animations,ot=ke.children;Ii(ge,Ke);for(var wt=ot.length;wt--;){var qt=ot[wt],Kt=qt.animations;Ii(ge,Kt),!Kt.length&&!qt.children.length&&ot.splice(wt,1)}!Ke.length&&!ot.length&&ke.pause()}}function Ni(se,ge){ge===void 0&&(ge={});var Ne=ge.direction||"normal",ke=ge.easing?U(ge.easing):null,Ke=ge.grid,ot=ge.axis,wt=ge.from||0,qt=wt==="first",Kt=wt==="center",Rt=wt==="last",ti=w.arr(se),bi=parseFloat(ti?se[0]:se),Fi=ti?parseFloat(se[1]):0,Cr=Gt(ti?se[1]:se)||0,ur=ge.start||0+(ti?bi:0),Ji=[],vi=0;return function(Tn,qn,Mi){if(qt&&(wt=0),Kt&&(wt=(Mi-1)/2),Rt&&(wt=Mi-1),!Ji.length){for(var ar=0;ar<Mi;ar++){if(!Ke)Ji.push(Math.abs(wt-ar));else{var un=Kt?(Ke[0]-1)/2:wt%Ke[0],Qr=Kt?(Ke[1]-1)/2:Math.floor(wt/Ke[0]),W=ar%Ke[0],ue=Math.floor(ar/Ke[0]),Ae=un-W,Se=Qr-ue,We=Math.sqrt(Ae*Ae+Se*Se);ot==="x"&&(We=-Ae),ot==="y"&&(We=-Se),Ji.push(We)}vi=Math.max.apply(Math,Ji)}ke&&(Ji=Ji.map(function(ft){return ke(ft/vi)*vi})),Ne==="reverse"&&(Ji=Ji.map(function(ft){return ot?ft<0?ft*-1:-ft:Math.abs(vi-ft)}))}var Ye=ti?(Fi-bi)/vi:bi;return ur+Ye*(Math.round(Ji[qn]*100)/100)+Cr}}function Oi(se){se===void 0&&(se={});var ge=Xt(se);return ge.duration=0,ge.add=function(Ne,ke){var Ke=$n.indexOf(ge),ot=ge.children;Ke>-1&&$n.splice(Ke,1);function wt(Fi){Fi.passThrough=!0}for(var qt=0;qt<ot.length;qt++)wt(ot[qt]);var Kt=Y(Ne,ie(p,se));Kt.targets=Kt.targets||se.targets;var Rt=ge.duration;Kt.autoplay=!1,Kt.direction=ge.direction,Kt.timelineOffset=w.und(ke)?Rt:yt(ke,Rt),wt(ge),ge.seek(Kt.timelineOffset);var ti=Xt(Kt);wt(ti),ot.push(ti);var bi=gs(ot,se);return ge.delay=bi.delay,ge.endDelay=bi.endDelay,ge.duration=bi.duration,ge.seek(0),ge.reset(),ge.autoplay&&ge.play(),ge},ge}Xt.version="3.0.0",Xt.speed=1,Xt.running=$n,Xt.remove=sr,Xt.get=Qe,Xt.set=fn,Xt.convertPx=ki,Xt.path=Z,Xt.setDashoffset=Fe,Xt.stagger=Ni,Xt.timeline=Oi,Xt.easing=U,Xt.penner=O,Xt.random=function(se,ge){return Math.floor(Math.random()*(ge-se+1))+se};const Be=Xt},"./node_modules/three-bmfont-text/index.js":(l,u,c)=>{var d=c("./node_modules/layout-bmfont-text/index.js"),p=c("./node_modules/quad-indices/index.js"),f=c("./node_modules/three-bmfont-text/lib/vertices.js"),m=c("./node_modules/three-bmfont-text/lib/utils.js");l.exports=function(y){return new g(y)};class g extends THREE.BufferGeometry{constructor(x){super(),typeof x=="string"&&(x={text:x}),this._opt=Object.assign({},x),x&&this.update(x)}update(x){if(typeof x=="string"&&(x={text:x}),x=Object.assign({},this._opt,x),!x.font)throw new TypeError("must specify a { font } in options");this.layout=d(x);var v=x.flipY!==!1,_=x.font,T=_.common.scaleW,w=_.common.scaleH,S=this.layout.glyphs.filter(function(L){var O=L.data;return O.width*O.height>0});this.visibleGlyphs=S;var R=f.positions(S),B=f.uvs(S,T,w,v),I=p([],{clockwise:!0,type:"uint16",count:S.length});if(this.setIndex(I),this.setAttribute("position",new THREE.BufferAttribute(R,2)),this.setAttribute("uv",new THREE.BufferAttribute(B,2)),!x.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(x.multipage){var D=f.pages(S);this.setAttribute("page",new THREE.BufferAttribute(D,1))}this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere()}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere);var x=this.attributes.position.array,v=this.attributes.position.itemSize;if(!x||!v||x.length<2){this.boundingSphere.radius=0,this.boundingSphere.center.set(0,0,0);return}m.computeSphere(x,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);var x=this.boundingBox,v=this.attributes.position.array,_=this.attributes.position.itemSize;if(!v||!_||v.length<2){x.makeEmpty();return}m.computeBox(v,x)}}},"./node_modules/three-bmfont-text/lib/utils.js":l=>{var u=2,c={min:[0,0],max:[0,0]};function d(p){var f=p.length/u;c.min[0]=p[0],c.min[1]=p[1],c.max[0]=p[0],c.max[1]=p[1];for(var m=0;m<f;m++){var g=p[m*u+0],y=p[m*u+1];c.min[0]=Math.min(g,c.min[0]),c.min[1]=Math.min(y,c.min[1]),c.max[0]=Math.max(g,c.max[0]),c.max[1]=Math.max(y,c.max[1])}}l.exports.computeBox=function(p,f){d(p),f.min.set(c.min[0],c.min[1],0),f.max.set(c.max[0],c.max[1],0)},l.exports.computeSphere=function(p,f){d(p);var m=c.min[0],g=c.min[1],y=c.max[0],x=c.max[1],v=y-m,_=x-g,T=Math.sqrt(v*v+_*_);f.center.set(m+v/2,g+_/2,0),f.radius=T/2}},"./node_modules/three-bmfont-text/lib/vertices.js":l=>{l.exports.pages=function(u){var c=new Float32Array(u.length*4*1),d=0;return u.forEach(function(p){var f=p.data.page||0;c[d++]=f,c[d++]=f,c[d++]=f,c[d++]=f}),c},l.exports.uvs=function(u,c,d,p){var f=new Float32Array(u.length*4*2),m=0;return u.forEach(function(g){var y=g.data,x=y.x+y.width,v=y.y+y.height,_=y.x/c,T=y.y/d,w=x/c,S=v/d;p&&(T=(d-y.y)/d,S=(d-v)/d),f[m++]=_,f[m++]=T,f[m++]=_,f[m++]=S,f[m++]=w,f[m++]=S,f[m++]=w,f[m++]=T}),f},l.exports.positions=function(u){var c=new Float32Array(u.length*4*2),d=0;return u.forEach(function(p){var f=p.data,m=p.position[0]+f.xoffset,g=p.position[1]+f.yoffset,y=f.width,x=f.height;c[d++]=m,c[d++]=g,c[d++]=m,c[d++]=g+x,c[d++]=m+y,c[d++]=g+x,c[d++]=m+y,c[d++]=g}),c}},"./node_modules/webvr-polyfill/build/webvr-polyfill.js":function(l,u,c){/**
 * @license
 * webvr-polyfill
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * webvr-polyfill-dpdb 
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * wglu-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(d,p){l.exports=p()})(this,function(){var d=typeof window<"u"?window:typeof c.g<"u"?c.g:typeof self<"u"?self:{};function p(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}function f(I,D){return D={exports:{}},I(D,D.exports),D.exports}var m=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},g=function(I,D){for(var L=0,O=I.length;L<O;L++)D[L]=I[L]},y=function(I,D){for(var L in D)D.hasOwnProperty(L)&&(I[L]=D[L]);return I},x=f(function(I,D){/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * gl-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * webvr-polyfill-dpdb
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(L,O){I.exports=O()})(d,function(){var L=function(W,ue){if(!(W instanceof ue))throw new TypeError("Cannot call a class as a function")},O=function(){function W(ue,Ae){for(var Se=0;Se<Ae.length;Se++){var We=Ae[Se];We.enumerable=We.enumerable||!1,We.configurable=!0,"value"in We&&(We.writable=!0),Object.defineProperty(ue,We.key,We)}}return function(ue,Ae,Se){return Ae&&W(ue.prototype,Ae),Se&&W(ue,Se),ue}}(),U=function(){function W(ue,Ae){var Se=[],We=!0,Ye=!1,ft=void 0;try{for(var he=ue[Symbol.iterator](),le;!(We=(le=he.next()).done)&&(Se.push(le.value),!(Ae&&Se.length===Ae));We=!0);}catch(pe){Ye=!0,ft=pe}finally{try{!We&&he.return&&he.return()}finally{if(Ye)throw ft}}return Se}return function(ue,Ae){if(Array.isArray(ue))return ue;if(Symbol.iterator in Object(ue))return W(ue,Ae);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),J=.001,H=1,V=function(W,ue){return"data:"+W+","+encodeURIComponent(ue)},$=function(W,ue,Ae){return W+(ue-W)*Ae},Q=function(){var W=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return W}}(),G=function(){var W=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return W}}(),j=function(){var W=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return W}}(),ie=function(){var W=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return W}}(),Y=function(){var W=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),ue=W?parseInt(W[1],10):null;return function(){return ue}}(),ae=function(){var W=!1;return W=Q()&&j()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return W}}(),xe=function(){var W=!1;if(Y()===65){var ue=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(ue){var Ae=ue[1].split("."),Se=U(Ae,4);Se[0],Se[1];var We=Se[2],Ye=Se[3];W=parseInt(We,10)===3325&&parseInt(Ye,10)<148}}return function(){return W}}(),fe=function(){var W=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return W}}(),de=function(){var W=window.orientation==90||window.orientation==-90;return fe()?!W:W},Ie=function(W){return!(isNaN(W)||W<=J||W>H)},Ge=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},Xe=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},$e=function(W){if(G())return!1;if(W.requestFullscreen)W.requestFullscreen();else if(W.webkitRequestFullscreen)W.webkitRequestFullscreen();else if(W.mozRequestFullScreen)W.mozRequestFullScreen();else if(W.msRequestFullscreen)W.msRequestFullscreen();else return!1;return!0},lt=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},At=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},Gt=function(W,ue,Ae,Se){var We=W.createShader(W.VERTEX_SHADER);W.shaderSource(We,ue),W.compileShader(We);var Ye=W.createShader(W.FRAGMENT_SHADER);W.shaderSource(Ye,Ae),W.compileShader(Ye);var ft=W.createProgram();W.attachShader(ft,We),W.attachShader(ft,Ye);for(var he in Se)W.bindAttribLocation(ft,Se[he],he);return W.linkProgram(ft),W.deleteShader(We),W.deleteShader(Ye),ft},gt=function(W,ue){for(var Ae={},Se=W.getProgramParameter(ue,W.ACTIVE_UNIFORMS),We="",Ye=0;Ye<Se;Ye++){var ft=W.getActiveUniform(ue,Ye);We=ft.name.replace("[0]",""),Ae[We]=W.getUniformLocation(ue,We)}return Ae},yi=function(W,ue,Ae,Se,We,Ye,ft){var he=1/(ue-Ae),le=1/(Se-We),pe=1/(Ye-ft);return W[0]=-2*he,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=-2*le,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=2*pe,W[11]=0,W[12]=(ue+Ae)*he,W[13]=(We+Se)*le,W[14]=(ft+Ye)*pe,W[15]=1,W},Ze=function(){var W=!1;return function(ue){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(ue)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ue.substr(0,4)))&&(W=!0)}(navigator.userAgent||navigator.vendor||window.opera),W},ki=function(W,ue){for(var Ae in ue)ue.hasOwnProperty(Ae)&&(W[Ae]=ue[Ae]);return W},hi=function(W){if(Q()){var ue=W.style.width,Ae=W.style.height;W.style.width=parseInt(ue)+1+"px",W.style.height=parseInt(Ae)+"px",setTimeout(function(){W.style.width=ue,W.style.height=Ae},100)}window.canvas=W},Ri=function(){var W=Math.PI/180,ue=Math.PI*.25;function Ae(pe,be,Ee,st){var Ct=Math.tan(be?be.upDegrees*W:ue),Ht=Math.tan(be?be.downDegrees*W:ue),ii=Math.tan(be?be.leftDegrees*W:ue),mi=Math.tan(be?be.rightDegrees*W:ue),Wt=2/(ii+mi),Bi=2/(Ct+Ht);return pe[0]=Wt,pe[1]=0,pe[2]=0,pe[3]=0,pe[4]=0,pe[5]=Bi,pe[6]=0,pe[7]=0,pe[8]=-((ii-mi)*Wt*.5),pe[9]=(Ct-Ht)*Bi*.5,pe[10]=st/(Ee-st),pe[11]=-1,pe[12]=0,pe[13]=0,pe[14]=st*Ee/(Ee-st),pe[15]=0,pe}function Se(pe,be,Ee){var st=be[0],Ct=be[1],Ht=be[2],ii=be[3],mi=st+st,Wt=Ct+Ct,Bi=Ht+Ht,yr=st*mi,dr=st*Wt,pr=st*Bi,Hi=Ct*Wt,Er=Ct*Bi,Sr=Ht*Bi,Fr=ii*mi,jr=ii*Wt,vn=ii*Bi;return pe[0]=1-(Hi+Sr),pe[1]=dr+vn,pe[2]=pr-jr,pe[3]=0,pe[4]=dr-vn,pe[5]=1-(yr+Sr),pe[6]=Er+Fr,pe[7]=0,pe[8]=pr+jr,pe[9]=Er-Fr,pe[10]=1-(yr+Hi),pe[11]=0,pe[12]=Ee[0],pe[13]=Ee[1],pe[14]=Ee[2],pe[15]=1,pe}function We(pe,be,Ee){var st=Ee[0],Ct=Ee[1],Ht=Ee[2],ii,mi,Wt,Bi,yr,dr,pr,Hi,Er,Sr,Fr,jr;return be===pe?(pe[12]=be[0]*st+be[4]*Ct+be[8]*Ht+be[12],pe[13]=be[1]*st+be[5]*Ct+be[9]*Ht+be[13],pe[14]=be[2]*st+be[6]*Ct+be[10]*Ht+be[14],pe[15]=be[3]*st+be[7]*Ct+be[11]*Ht+be[15]):(ii=be[0],mi=be[1],Wt=be[2],Bi=be[3],yr=be[4],dr=be[5],pr=be[6],Hi=be[7],Er=be[8],Sr=be[9],Fr=be[10],jr=be[11],pe[0]=ii,pe[1]=mi,pe[2]=Wt,pe[3]=Bi,pe[4]=yr,pe[5]=dr,pe[6]=pr,pe[7]=Hi,pe[8]=Er,pe[9]=Sr,pe[10]=Fr,pe[11]=jr,pe[12]=ii*st+yr*Ct+Er*Ht+be[12],pe[13]=mi*st+dr*Ct+Sr*Ht+be[13],pe[14]=Wt*st+pr*Ct+Fr*Ht+be[14],pe[15]=Bi*st+Hi*Ct+jr*Ht+be[15]),pe}function Ye(pe,be){var Ee=be[0],st=be[1],Ct=be[2],Ht=be[3],ii=be[4],mi=be[5],Wt=be[6],Bi=be[7],yr=be[8],dr=be[9],pr=be[10],Hi=be[11],Er=be[12],Sr=be[13],Fr=be[14],jr=be[15],vn=Ee*mi-st*ii,zr=Ee*Wt-Ct*ii,cs=Ee*Bi-Ht*ii,Lr=st*Wt-Ct*mi,gl=st*Bi-Ht*mi,qo=Ct*Bi-Ht*Wt,_c=yr*Sr-dr*Er,Qc=yr*Fr-pr*Er,qc=yr*jr-Hi*Er,io=dr*Fr-pr*Sr,Xc=dr*jr-Hi*Sr,ja=pr*jr-Hi*Fr,Ln=vn*ja-zr*Xc+cs*io+Lr*qc-gl*Qc+qo*_c;return Ln?(Ln=1/Ln,pe[0]=(mi*ja-Wt*Xc+Bi*io)*Ln,pe[1]=(Ct*Xc-st*ja-Ht*io)*Ln,pe[2]=(Sr*qo-Fr*gl+jr*Lr)*Ln,pe[3]=(pr*gl-dr*qo-Hi*Lr)*Ln,pe[4]=(Wt*qc-ii*ja-Bi*Qc)*Ln,pe[5]=(Ee*ja-Ct*qc+Ht*Qc)*Ln,pe[6]=(Fr*cs-Er*qo-jr*zr)*Ln,pe[7]=(yr*qo-pr*cs+Hi*zr)*Ln,pe[8]=(ii*Xc-mi*qc+Bi*_c)*Ln,pe[9]=(st*qc-Ee*Xc-Ht*_c)*Ln,pe[10]=(Er*gl-Sr*cs+jr*vn)*Ln,pe[11]=(dr*cs-yr*gl-Hi*vn)*Ln,pe[12]=(mi*Qc-ii*io-Wt*_c)*Ln,pe[13]=(Ee*io-st*Qc+Ct*_c)*Ln,pe[14]=(Sr*zr-Er*Lr-Fr*vn)*Ln,pe[15]=(yr*Lr-dr*zr+pr*vn)*Ln,pe):null}var ft=new Float32Array([0,0,0,1]),he=new Float32Array([0,0,0]);function le(pe,be,Ee,st,Ct,Ht){Ae(pe,st||null,Ht.depthNear,Ht.depthFar);var ii=Ee.orientation||ft,mi=Ee.position||he;Se(be,ii,mi),Ct&&We(be,be,Ct),Ye(be,be)}return function(pe,be,Ee){return!pe||!be?!1:(pe.pose=be,pe.timestamp=be.timestamp,le(pe.leftProjectionMatrix,pe.leftViewMatrix,be,Ee._getFieldOfView("left"),Ee._getEyeOffset("left"),Ee),le(pe.rightProjectionMatrix,pe.rightViewMatrix,be,Ee._getFieldOfView("right"),Ee._getEyeOffset("right"),Ee),!0)}}(),Si=function(){var W=window.self!==window.top,ue=tr(document.referrer),Ae=tr(window.location.href);return W&&ue!==Ae},tr=function(W){var ue,Ae=W.indexOf("://");Ae!==-1?ue=Ae+3:ue=0;var Se=W.indexOf("/",ue);return Se===-1&&(Se=W.length),W.substring(0,Se)},Vi=function(W){if(W.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var ue=2*Math.acos(W.w);return ue},Qe=function(){var W={};return function(ue,Ae){W[ue]===void 0&&(console.warn("webvr-polyfill: "+Ae),W[ue]=!0)}}(),Ce=function(W,ue){var Ae=ue?"Please use "+ue+" instead.":"";Qe(W,W+" has been deprecated. This may not work on native WebVR displays. "+Ae)};function yt(W,ue,Ae){if(!ue){Ae(W);return}for(var Se=[],We=null,Ye=0;Ye<ue.length;++Ye){var ft=ue[Ye];switch(ft){case W.TEXTURE_BINDING_2D:case W.TEXTURE_BINDING_CUBE_MAP:var he=ue[++Ye];if(he<W.TEXTURE0||he>W.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),Se.push(null,null);break}We||(We=W.getParameter(W.ACTIVE_TEXTURE)),W.activeTexture(he),Se.push(W.getParameter(ft),null);break;case W.ACTIVE_TEXTURE:We=W.getParameter(W.ACTIVE_TEXTURE),Se.push(null);break;default:Se.push(W.getParameter(ft));break}}Ae(W);for(var Ye=0;Ye<ue.length;++Ye){var ft=ue[Ye],le=Se[Ye];switch(ft){case W.ACTIVE_TEXTURE:break;case W.ARRAY_BUFFER_BINDING:W.bindBuffer(W.ARRAY_BUFFER,le);break;case W.COLOR_CLEAR_VALUE:W.clearColor(le[0],le[1],le[2],le[3]);break;case W.COLOR_WRITEMASK:W.colorMask(le[0],le[1],le[2],le[3]);break;case W.CURRENT_PROGRAM:W.useProgram(le);break;case W.ELEMENT_ARRAY_BUFFER_BINDING:W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,le);break;case W.FRAMEBUFFER_BINDING:W.bindFramebuffer(W.FRAMEBUFFER,le);break;case W.RENDERBUFFER_BINDING:W.bindRenderbuffer(W.RENDERBUFFER,le);break;case W.TEXTURE_BINDING_2D:var he=ue[++Ye];if(he<W.TEXTURE0||he>W.TEXTURE31)break;W.activeTexture(he),W.bindTexture(W.TEXTURE_2D,le);break;case W.TEXTURE_BINDING_CUBE_MAP:var he=ue[++Ye];if(he<W.TEXTURE0||he>W.TEXTURE31)break;W.activeTexture(he),W.bindTexture(W.TEXTURE_CUBE_MAP,le);break;case W.VIEWPORT:W.viewport(le[0],le[1],le[2],le[3]);break;case W.BLEND:case W.CULL_FACE:case W.DEPTH_TEST:case W.SCISSOR_TEST:case W.STENCIL_TEST:le?W.enable(ft):W.disable(ft);break;default:console.log("No GL restore behavior for 0x"+ft.toString(16));break}We&&W.activeTexture(We)}}var Ot=yt,Jt=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),zt=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function xi(W,ue,Ae,Se){this.gl=W,this.cardboardUI=ue,this.bufferScale=Ae,this.dirtySubmitFrameBindings=Se,this.ctxAttribs=W.getContextAttributes(),this.instanceExt=W.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=W.drawingBufferWidth,this.bufferHeight=W.drawingBufferHeight,this.realBindFramebuffer=W.bindFramebuffer,this.realEnable=W.enable,this.realDisable=W.disable,this.realColorMask=W.colorMask,this.realClearColor=W.clearColor,this.realViewport=W.viewport,Q()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(W.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(W.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=Gt(W,Jt,zt,this.attribs),this.uniforms=gt(W,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=W.createBuffer(),this.indexBuffer=W.createBuffer(),this.indexCount=0,this.renderTarget=W.createTexture(),this.framebuffer=W.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=W.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=W.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=W.createRenderbuffer()),this.patch(),this.onResize()}xi.prototype.destroy=function(){var W=this.gl;this.unpatch(),W.deleteProgram(this.program),W.deleteBuffer(this.vertexBuffer),W.deleteBuffer(this.indexBuffer),W.deleteTexture(this.renderTarget),W.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&W.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&W.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&W.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},xi.prototype.onResize=function(){var W=this.gl,ue=this,Ae=[W.RENDERBUFFER_BINDING,W.TEXTURE_BINDING_2D,W.TEXTURE0];Ot(W,Ae,function(Se){ue.realBindFramebuffer.call(Se,Se.FRAMEBUFFER,null),ue.scissorTest&&ue.realDisable.call(Se,Se.SCISSOR_TEST),ue.realColorMask.call(Se,!0,!0,!0,!0),ue.realViewport.call(Se,0,0,Se.drawingBufferWidth,Se.drawingBufferHeight),ue.realClearColor.call(Se,0,0,0,1),Se.clear(Se.COLOR_BUFFER_BIT),ue.realBindFramebuffer.call(Se,Se.FRAMEBUFFER,ue.framebuffer),Se.bindTexture(Se.TEXTURE_2D,ue.renderTarget),Se.texImage2D(Se.TEXTURE_2D,0,ue.ctxAttribs.alpha?Se.RGBA:Se.RGB,ue.bufferWidth,ue.bufferHeight,0,ue.ctxAttribs.alpha?Se.RGBA:Se.RGB,Se.UNSIGNED_BYTE,null),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MAG_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MIN_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_S,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_T,Se.CLAMP_TO_EDGE),Se.framebufferTexture2D(Se.FRAMEBUFFER,Se.COLOR_ATTACHMENT0,Se.TEXTURE_2D,ue.renderTarget,0),ue.ctxAttribs.depth&&ue.ctxAttribs.stencil?(Se.bindRenderbuffer(Se.RENDERBUFFER,ue.depthStencilBuffer),Se.renderbufferStorage(Se.RENDERBUFFER,Se.DEPTH_STENCIL,ue.bufferWidth,ue.bufferHeight),Se.framebufferRenderbuffer(Se.FRAMEBUFFER,Se.DEPTH_STENCIL_ATTACHMENT,Se.RENDERBUFFER,ue.depthStencilBuffer)):ue.ctxAttribs.depth?(Se.bindRenderbuffer(Se.RENDERBUFFER,ue.depthBuffer),Se.renderbufferStorage(Se.RENDERBUFFER,Se.DEPTH_COMPONENT16,ue.bufferWidth,ue.bufferHeight),Se.framebufferRenderbuffer(Se.FRAMEBUFFER,Se.DEPTH_ATTACHMENT,Se.RENDERBUFFER,ue.depthBuffer)):ue.ctxAttribs.stencil&&(Se.bindRenderbuffer(Se.RENDERBUFFER,ue.stencilBuffer),Se.renderbufferStorage(Se.RENDERBUFFER,Se.STENCIL_INDEX8,ue.bufferWidth,ue.bufferHeight),Se.framebufferRenderbuffer(Se.FRAMEBUFFER,Se.STENCIL_ATTACHMENT,Se.RENDERBUFFER,ue.stencilBuffer)),!Se.checkFramebufferStatus(Se.FRAMEBUFFER)===Se.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),ue.realBindFramebuffer.call(Se,Se.FRAMEBUFFER,ue.lastBoundFramebuffer),ue.scissorTest&&ue.realEnable.call(Se,Se.SCISSOR_TEST),ue.realColorMask.apply(Se,ue.colorMask),ue.realViewport.apply(Se,ue.viewport),ue.realClearColor.apply(Se,ue.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},xi.prototype.patch=function(){if(!this.isPatched){var W=this,ue=this.gl.canvas,Ae=this.gl;Q()||(ue.width=Ge()*this.bufferScale,ue.height=Xe()*this.bufferScale,Object.defineProperty(ue,"width",{configurable:!0,enumerable:!0,get:function(){return W.bufferWidth},set:function(Se){W.bufferWidth=Se,W.realCanvasWidth.set.call(ue,Se),W.onResize()}}),Object.defineProperty(ue,"height",{configurable:!0,enumerable:!0,get:function(){return W.bufferHeight},set:function(Se){W.bufferHeight=Se,W.realCanvasHeight.set.call(ue,Se),W.onResize()}})),this.lastBoundFramebuffer=Ae.getParameter(Ae.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(Ae.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(Se,We){W.lastBoundFramebuffer=We||W.framebuffer,W.realBindFramebuffer.call(Ae,Se,W.lastBoundFramebuffer)},this.cullFace=Ae.getParameter(Ae.CULL_FACE),this.depthTest=Ae.getParameter(Ae.DEPTH_TEST),this.blend=Ae.getParameter(Ae.BLEND),this.scissorTest=Ae.getParameter(Ae.SCISSOR_TEST),this.stencilTest=Ae.getParameter(Ae.STENCIL_TEST),Ae.enable=function(Se){switch(Se){case Ae.CULL_FACE:W.cullFace=!0;break;case Ae.DEPTH_TEST:W.depthTest=!0;break;case Ae.BLEND:W.blend=!0;break;case Ae.SCISSOR_TEST:W.scissorTest=!0;break;case Ae.STENCIL_TEST:W.stencilTest=!0;break}W.realEnable.call(Ae,Se)},Ae.disable=function(Se){switch(Se){case Ae.CULL_FACE:W.cullFace=!1;break;case Ae.DEPTH_TEST:W.depthTest=!1;break;case Ae.BLEND:W.blend=!1;break;case Ae.SCISSOR_TEST:W.scissorTest=!1;break;case Ae.STENCIL_TEST:W.stencilTest=!1;break}W.realDisable.call(Ae,Se)},this.colorMask=Ae.getParameter(Ae.COLOR_WRITEMASK),Ae.colorMask=function(Se,We,Ye,ft){W.colorMask[0]=Se,W.colorMask[1]=We,W.colorMask[2]=Ye,W.colorMask[3]=ft,W.realColorMask.call(Ae,Se,We,Ye,ft)},this.clearColor=Ae.getParameter(Ae.COLOR_CLEAR_VALUE),Ae.clearColor=function(Se,We,Ye,ft){W.clearColor[0]=Se,W.clearColor[1]=We,W.clearColor[2]=Ye,W.clearColor[3]=ft,W.realClearColor.call(Ae,Se,We,Ye,ft)},this.viewport=Ae.getParameter(Ae.VIEWPORT),Ae.viewport=function(Se,We,Ye,ft){W.viewport[0]=Se,W.viewport[1]=We,W.viewport[2]=Ye,W.viewport[3]=ft,W.realViewport.call(Ae,Se,We,Ye,ft)},this.isPatched=!0,hi(ue)}},xi.prototype.unpatch=function(){if(this.isPatched){var W=this.gl,ue=this.gl.canvas;Q()||(Object.defineProperty(ue,"width",this.realCanvasWidth),Object.defineProperty(ue,"height",this.realCanvasHeight)),ue.width=this.bufferWidth,ue.height=this.bufferHeight,W.bindFramebuffer=this.realBindFramebuffer,W.enable=this.realEnable,W.disable=this.realDisable,W.colorMask=this.realColorMask,W.clearColor=this.realClearColor,W.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&W.bindFramebuffer(W.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){hi(ue)},1)}},xi.prototype.setTextureBounds=function(W,ue){W||(W=[0,0,.5,1]),ue||(ue=[.5,0,.5,1]),this.viewportOffsetScale[0]=W[0],this.viewportOffsetScale[1]=W[1],this.viewportOffsetScale[2]=W[2],this.viewportOffsetScale[3]=W[3],this.viewportOffsetScale[4]=ue[0],this.viewportOffsetScale[5]=ue[1],this.viewportOffsetScale[6]=ue[2],this.viewportOffsetScale[7]=ue[3]},xi.prototype.submitFrame=function(){var W=this.gl,ue=this,Ae=[];if(this.dirtySubmitFrameBindings||Ae.push(W.CURRENT_PROGRAM,W.ARRAY_BUFFER_BINDING,W.ELEMENT_ARRAY_BUFFER_BINDING,W.TEXTURE_BINDING_2D,W.TEXTURE0),Ot(W,Ae,function(We){ue.realBindFramebuffer.call(We,We.FRAMEBUFFER,null);var Ye=0,ft=0;ue.instanceExt&&(Ye=We.getVertexAttrib(ue.attribs.position,ue.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),ft=We.getVertexAttrib(ue.attribs.texCoord,ue.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),ue.cullFace&&ue.realDisable.call(We,We.CULL_FACE),ue.depthTest&&ue.realDisable.call(We,We.DEPTH_TEST),ue.blend&&ue.realDisable.call(We,We.BLEND),ue.scissorTest&&ue.realDisable.call(We,We.SCISSOR_TEST),ue.stencilTest&&ue.realDisable.call(We,We.STENCIL_TEST),ue.realColorMask.call(We,!0,!0,!0,!0),ue.realViewport.call(We,0,0,We.drawingBufferWidth,We.drawingBufferHeight),(ue.ctxAttribs.alpha||Q())&&(ue.realClearColor.call(We,0,0,0,1),We.clear(We.COLOR_BUFFER_BIT)),We.useProgram(ue.program),We.bindBuffer(We.ELEMENT_ARRAY_BUFFER,ue.indexBuffer),We.bindBuffer(We.ARRAY_BUFFER,ue.vertexBuffer),We.enableVertexAttribArray(ue.attribs.position),We.enableVertexAttribArray(ue.attribs.texCoord),We.vertexAttribPointer(ue.attribs.position,2,We.FLOAT,!1,20,0),We.vertexAttribPointer(ue.attribs.texCoord,3,We.FLOAT,!1,20,8),ue.instanceExt&&(Ye!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.position,0),ft!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.texCoord,0)),We.activeTexture(We.TEXTURE0),We.uniform1i(ue.uniforms.diffuse,0),We.bindTexture(We.TEXTURE_2D,ue.renderTarget),We.uniform4fv(ue.uniforms.viewportOffsetScale,ue.viewportOffsetScale),We.drawElements(We.TRIANGLES,ue.indexCount,We.UNSIGNED_SHORT,0),ue.cardboardUI&&ue.cardboardUI.renderNoState(),ue.realBindFramebuffer.call(ue.gl,We.FRAMEBUFFER,ue.framebuffer),ue.ctxAttribs.preserveDrawingBuffer||(ue.realClearColor.call(We,0,0,0,0),We.clear(We.COLOR_BUFFER_BIT)),ue.dirtySubmitFrameBindings||ue.realBindFramebuffer.call(We,We.FRAMEBUFFER,ue.lastBoundFramebuffer),ue.cullFace&&ue.realEnable.call(We,We.CULL_FACE),ue.depthTest&&ue.realEnable.call(We,We.DEPTH_TEST),ue.blend&&ue.realEnable.call(We,We.BLEND),ue.scissorTest&&ue.realEnable.call(We,We.SCISSOR_TEST),ue.stencilTest&&ue.realEnable.call(We,We.STENCIL_TEST),ue.realColorMask.apply(We,ue.colorMask),ue.realViewport.apply(We,ue.viewport),(ue.ctxAttribs.alpha||!ue.ctxAttribs.preserveDrawingBuffer)&&ue.realClearColor.apply(We,ue.clearColor),ue.instanceExt&&(Ye!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.position,Ye),ft!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.texCoord,ft))}),Q()){var Se=W.canvas;(Se.width!=ue.bufferWidth||Se.height!=ue.bufferHeight)&&(ue.bufferWidth=Se.width,ue.bufferHeight=Se.height,ue.onResize())}},xi.prototype.updateDeviceInfo=function(W){var ue=this.gl,Ae=this,Se=[ue.ARRAY_BUFFER_BINDING,ue.ELEMENT_ARRAY_BUFFER_BINDING];Ot(ue,Se,function(We){var Ye=Ae.computeMeshVertices_(Ae.meshWidth,Ae.meshHeight,W);if(We.bindBuffer(We.ARRAY_BUFFER,Ae.vertexBuffer),We.bufferData(We.ARRAY_BUFFER,Ye,We.STATIC_DRAW),!Ae.indexCount){var ft=Ae.computeMeshIndices_(Ae.meshWidth,Ae.meshHeight);We.bindBuffer(We.ELEMENT_ARRAY_BUFFER,Ae.indexBuffer),We.bufferData(We.ELEMENT_ARRAY_BUFFER,ft,We.STATIC_DRAW),Ae.indexCount=ft.length}})},xi.prototype.computeMeshVertices_=function(W,ue,Ae){for(var Se=new Float32Array(2*W*ue*5),We=Ae.getLeftEyeVisibleTanAngles(),Ye=Ae.getLeftEyeNoLensTanAngles(),ft=Ae.getLeftEyeVisibleScreenRect(Ye),he=0,le=0;le<2;le++){for(var pe=0;pe<ue;pe++)for(var be=0;be<W;be++,he++){var Ee=be/(W-1),st=pe/(ue-1),Ct=Ee,Ht=st,ii=$(We[0],We[2],Ee),mi=$(We[3],We[1],st),Wt=Math.sqrt(ii*ii+mi*mi),Bi=Ae.distortion.distortInverse(Wt),yr=ii*Bi/Wt,dr=mi*Bi/Wt;Ee=(yr-Ye[0])/(Ye[2]-Ye[0]),st=(dr-Ye[3])/(Ye[1]-Ye[3]),Ee=(ft.x+Ee*ft.width-.5)*2,st=(ft.y+st*ft.height-.5)*2,Se[he*5+0]=Ee,Se[he*5+1]=st,Se[he*5+2]=Ct,Se[he*5+3]=Ht,Se[he*5+4]=le}var pr=We[2]-We[0];We[0]=-(pr+We[0]),We[2]=pr-We[2],pr=Ye[2]-Ye[0],Ye[0]=-(pr+Ye[0]),Ye[2]=pr-Ye[2],ft.x=1-(ft.x+ft.width)}return Se},xi.prototype.computeMeshIndices_=function(W,ue){for(var Ae=new Uint16Array(2*(W-1)*(ue-1)*6),Se=W/2,We=ue/2,Ye=0,ft=0,he=0;he<2;he++)for(var le=0;le<ue;le++)for(var pe=0;pe<W;pe++,Ye++)pe==0||le==0||(pe<=Se==le<=We?(Ae[ft++]=Ye,Ae[ft++]=Ye-W-1,Ae[ft++]=Ye-W,Ae[ft++]=Ye-W-1,Ae[ft++]=Ye,Ae[ft++]=Ye-1):(Ae[ft++]=Ye-1,Ae[ft++]=Ye-W,Ae[ft++]=Ye,Ae[ft++]=Ye-W,Ae[ft++]=Ye-1,Ae[ft++]=Ye-W-1));return Ae},xi.prototype.getOwnPropertyDescriptor_=function(W,ue){var Ae=Object.getOwnPropertyDescriptor(W,ue);return(Ae.get===void 0||Ae.set===void 0)&&(Ae.configurable=!0,Ae.enumerable=!0,Ae.get=function(){return this.getAttribute(ue)},Ae.set=function(Se){this.setAttribute(ue,Se)}),Ae};var vt=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),ye=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),ve=Math.PI/180,Le=60,Te=12,Fe=20,Pe=1,k=.75,Z=.3125,re=4,Re=28,ce=1.5;function Ue(W){this.gl=W,this.attribs={position:0},this.program=Gt(W,vt,ye,this.attribs),this.uniforms=gt(W,this.program),this.vertexBuffer=W.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}Ue.prototype.destroy=function(){var W=this.gl;this.listener&&W.canvas.removeEventListener("click",this.listener,!1),W.deleteProgram(this.program),W.deleteBuffer(this.vertexBuffer)},Ue.prototype.listen=function(W,ue){var Ae=this.gl.canvas;this.listener=function(Se){var We=Ae.clientWidth/2,Ye=Re*ce;Se.clientX>We-Ye&&Se.clientX<We+Ye&&Se.clientY>Ae.clientHeight-Ye?W(Se):Se.clientX<Ye&&Se.clientY<Ye&&ue(Se)},Ae.addEventListener("click",this.listener,!1)},Ue.prototype.onResize=function(){var W=this.gl,ue=this,Ae=[W.ARRAY_BUFFER_BINDING];Ot(W,Ae,function(Se){var We=[],Ye=Se.drawingBufferWidth/2,ft=Math.max(screen.width,screen.height)*window.devicePixelRatio,he=Se.drawingBufferWidth/ft,le=he*window.devicePixelRatio,pe=re*le/2,be=Re*ce*le,Ee=Re*le/2,st=(Re*ce-Re)*le;We.push(Ye-pe,be),We.push(Ye-pe,Se.drawingBufferHeight),We.push(Ye+pe,be),We.push(Ye+pe,Se.drawingBufferHeight),ue.gearOffset=We.length/2;function Ct(Bi,yr){var dr=(90-Bi)*ve,pr=Math.cos(dr),Hi=Math.sin(dr);We.push(Z*pr*Ee+Ye,Z*Hi*Ee+Ee),We.push(yr*pr*Ee+Ye,yr*Hi*Ee+Ee)}for(var Ht=0;Ht<=6;Ht++){var ii=Ht*Le;Ct(ii,Pe),Ct(ii+Te,Pe),Ct(ii+Fe,k),Ct(ii+(Le-Fe),k),Ct(ii+(Le-Te),Pe)}ue.gearVertexCount=We.length/2-ue.gearOffset,ue.arrowOffset=We.length/2;function mi(Bi,yr){We.push(st+Bi,Se.drawingBufferHeight-st-yr)}var Wt=pe/Math.sin(45*ve);mi(0,Ee),mi(Ee,0),mi(Ee+Wt,Wt),mi(Wt,Ee+Wt),mi(Wt,Ee-Wt),mi(0,Ee),mi(Ee,Ee*2),mi(Ee+Wt,Ee*2-Wt),mi(Wt,Ee-Wt),mi(0,Ee),mi(Wt,Ee-pe),mi(Re*le,Ee-pe),mi(Wt,Ee+pe),mi(Re*le,Ee+pe),ue.arrowVertexCount=We.length/2-ue.arrowOffset,Se.bindBuffer(Se.ARRAY_BUFFER,ue.vertexBuffer),Se.bufferData(Se.ARRAY_BUFFER,new Float32Array(We),Se.STATIC_DRAW)})},Ue.prototype.render=function(){var W=this.gl,ue=this,Ae=[W.CULL_FACE,W.DEPTH_TEST,W.BLEND,W.SCISSOR_TEST,W.STENCIL_TEST,W.COLOR_WRITEMASK,W.VIEWPORT,W.CURRENT_PROGRAM,W.ARRAY_BUFFER_BINDING];Ot(W,Ae,function(Se){Se.disable(Se.CULL_FACE),Se.disable(Se.DEPTH_TEST),Se.disable(Se.BLEND),Se.disable(Se.SCISSOR_TEST),Se.disable(Se.STENCIL_TEST),Se.colorMask(!0,!0,!0,!0),Se.viewport(0,0,Se.drawingBufferWidth,Se.drawingBufferHeight),ue.renderNoState()})},Ue.prototype.renderNoState=function(){var W=this.gl;W.useProgram(this.program),W.bindBuffer(W.ARRAY_BUFFER,this.vertexBuffer),W.enableVertexAttribArray(this.attribs.position),W.vertexAttribPointer(this.attribs.position,2,W.FLOAT,!1,8,0),W.uniform4f(this.uniforms.color,1,1,1,1),yi(this.projMat,0,W.drawingBufferWidth,0,W.drawingBufferHeight,.1,1024),W.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),W.drawArrays(W.TRIANGLE_STRIP,0,4),W.drawArrays(W.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),W.drawArrays(W.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function je(W){this.coefficients=W}je.prototype.distortInverse=function(W){for(var ue=0,Ae=1,Se=W-this.distort(ue);Math.abs(Ae-ue)>1e-4;){var We=W-this.distort(Ae),Ye=Ae-We*((Ae-ue)/(We-Se));ue=Ae,Ae=Ye,Se=We}return Ae},je.prototype.distort=function(W){for(var ue=W*W,Ae=0,Se=0;Se<this.coefficients.length;Se++)Ae=ue*(Ae+this.coefficients[Se]);return(Ae+1)*W};var dt=Math.PI/180,Bt=180/Math.PI,bt=function(W,ue,Ae){this.x=W||0,this.y=ue||0,this.z=Ae||0};bt.prototype={constructor:bt,set:function(W,ue,Ae){return this.x=W,this.y=ue,this.z=Ae,this},copy:function(W){return this.x=W.x,this.y=W.y,this.z=W.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var W=this.length();if(W!==0){var ue=1/W;this.multiplyScalar(ue)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(W){this.x*=W,this.y*=W,this.z*=W},applyQuaternion:function(W){var ue=this.x,Ae=this.y,Se=this.z,We=W.x,Ye=W.y,ft=W.z,he=W.w,le=he*ue+Ye*Se-ft*Ae,pe=he*Ae+ft*ue-We*Se,be=he*Se+We*Ae-Ye*ue,Ee=-We*ue-Ye*Ae-ft*Se;return this.x=le*he+Ee*-We+pe*-ft-be*-Ye,this.y=pe*he+Ee*-Ye+be*-We-le*-ft,this.z=be*he+Ee*-ft+le*-Ye-pe*-We,this},dot:function(W){return this.x*W.x+this.y*W.y+this.z*W.z},crossVectors:function(W,ue){var Ae=W.x,Se=W.y,We=W.z,Ye=ue.x,ft=ue.y,he=ue.z;return this.x=Se*he-We*ft,this.y=We*Ye-Ae*he,this.z=Ae*ft-Se*Ye,this}};var Ut=function(W,ue,Ae,Se){this.x=W||0,this.y=ue||0,this.z=Ae||0,this.w=Se!==void 0?Se:1};Ut.prototype={constructor:Ut,set:function(W,ue,Ae,Se){return this.x=W,this.y=ue,this.z=Ae,this.w=Se,this},copy:function(W){return this.x=W.x,this.y=W.y,this.z=W.z,this.w=W.w,this},setFromEulerXYZ:function(W,ue,Ae){var Se=Math.cos(W/2),We=Math.cos(ue/2),Ye=Math.cos(Ae/2),ft=Math.sin(W/2),he=Math.sin(ue/2),le=Math.sin(Ae/2);return this.x=ft*We*Ye+Se*he*le,this.y=Se*he*Ye-ft*We*le,this.z=Se*We*le+ft*he*Ye,this.w=Se*We*Ye-ft*he*le,this},setFromEulerYXZ:function(W,ue,Ae){var Se=Math.cos(W/2),We=Math.cos(ue/2),Ye=Math.cos(Ae/2),ft=Math.sin(W/2),he=Math.sin(ue/2),le=Math.sin(Ae/2);return this.x=ft*We*Ye+Se*he*le,this.y=Se*he*Ye-ft*We*le,this.z=Se*We*le-ft*he*Ye,this.w=Se*We*Ye+ft*he*le,this},setFromAxisAngle:function(W,ue){var Ae=ue/2,Se=Math.sin(Ae);return this.x=W.x*Se,this.y=W.y*Se,this.z=W.z*Se,this.w=Math.cos(Ae),this},multiply:function(W){return this.multiplyQuaternions(this,W)},multiplyQuaternions:function(W,ue){var Ae=W.x,Se=W.y,We=W.z,Ye=W.w,ft=ue.x,he=ue.y,le=ue.z,pe=ue.w;return this.x=Ae*pe+Ye*ft+Se*le-We*he,this.y=Se*pe+Ye*he+We*ft-Ae*le,this.z=We*pe+Ye*le+Ae*he-Se*ft,this.w=Ye*pe-Ae*ft-Se*he-We*le,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var W=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return W===0?(this.x=0,this.y=0,this.z=0,this.w=1):(W=1/W,this.x=this.x*W,this.y=this.y*W,this.z=this.z*W,this.w=this.w*W),this},slerp:function(W,ue){if(ue===0)return this;if(ue===1)return this.copy(W);var Ae=this.x,Se=this.y,We=this.z,Ye=this.w,ft=Ye*W.w+Ae*W.x+Se*W.y+We*W.z;if(ft<0?(this.w=-W.w,this.x=-W.x,this.y=-W.y,this.z=-W.z,ft=-ft):this.copy(W),ft>=1)return this.w=Ye,this.x=Ae,this.y=Se,this.z=We,this;var he=Math.acos(ft),le=Math.sqrt(1-ft*ft);if(Math.abs(le)<.001)return this.w=.5*(Ye+this.w),this.x=.5*(Ae+this.x),this.y=.5*(Se+this.y),this.z=.5*(We+this.z),this;var pe=Math.sin((1-ue)*he)/le,be=Math.sin(ue*he)/le;return this.w=Ye*pe+this.w*be,this.x=Ae*pe+this.x*be,this.y=Se*pe+this.y*be,this.z=We*pe+this.z*be,this},setFromUnitVectors:function(){var W,ue,Ae=1e-6;return function(Se,We){return W===void 0&&(W=new bt),ue=Se.dot(We)+1,ue<Ae?(ue=0,Math.abs(Se.x)>Math.abs(Se.z)?W.set(-Se.y,Se.x,0):W.set(0,-Se.z,Se.y)):W.crossVectors(Se,We),this.x=W.x,this.y=W.y,this.z=W.z,this.w=ue,this.normalize(),this}}()};function di(W){this.width=W.width||Ge(),this.height=W.height||Xe(),this.widthMeters=W.widthMeters,this.heightMeters=W.heightMeters,this.bevelMeters=W.bevelMeters}var br=new di({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Pi=new di({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),fn={CardboardV1:new tn({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new tn({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Pr(W,ue){this.viewer=fn.CardboardV2,this.updateDeviceParams(W),this.distortion=new je(this.viewer.distortionCoefficients);for(var Ae=0;Ae<ue.length;Ae++){var Se=ue[Ae];fn[Se.id]=new tn(Se)}}Pr.prototype.updateDeviceParams=function(W){this.device=this.determineDevice_(W)||this.device},Pr.prototype.getDevice=function(){return this.device},Pr.prototype.setViewer=function(W){this.viewer=W,this.distortion=new je(this.viewer.distortionCoefficients)},Pr.prototype.determineDevice_=function(W){if(!W)return Q()?(console.warn("Using fallback iOS device measurements."),Pi):(console.warn("Using fallback Android device measurements."),br);var ue=.0254,Ae=ue/W.xdpi,Se=ue/W.ydpi,We=Ge(),Ye=Xe();return new di({widthMeters:Ae*We,heightMeters:Se*Ye,bevelMeters:W.bevelMm*.001})},Pr.prototype.getDistortedFieldOfViewLeftEye=function(){var W=this.viewer,ue=this.device,Ae=this.distortion,Se=W.screenLensDistance,We=(ue.widthMeters-W.interLensDistance)/2,Ye=W.interLensDistance/2,ft=W.baselineLensDistance-ue.bevelMeters,he=ue.heightMeters-ft,le=Bt*Math.atan(Ae.distort(We/Se)),pe=Bt*Math.atan(Ae.distort(Ye/Se)),be=Bt*Math.atan(Ae.distort(ft/Se)),Ee=Bt*Math.atan(Ae.distort(he/Se));return{leftDegrees:Math.min(le,W.fov),rightDegrees:Math.min(pe,W.fov),downDegrees:Math.min(be,W.fov),upDegrees:Math.min(Ee,W.fov)}},Pr.prototype.getLeftEyeVisibleTanAngles=function(){var W=this.viewer,ue=this.device,Ae=this.distortion,Se=Math.tan(-dt*W.fov),We=Math.tan(dt*W.fov),Ye=Math.tan(dt*W.fov),ft=Math.tan(-dt*W.fov),he=ue.widthMeters/4,le=ue.heightMeters/2,pe=W.baselineLensDistance-ue.bevelMeters-le,be=W.interLensDistance/2-he,Ee=-pe,st=W.screenLensDistance,Ct=Ae.distort((be-he)/st),Ht=Ae.distort((Ee+le)/st),ii=Ae.distort((be+he)/st),mi=Ae.distort((Ee-le)/st),Wt=new Float32Array(4);return Wt[0]=Math.max(Se,Ct),Wt[1]=Math.min(We,Ht),Wt[2]=Math.min(Ye,ii),Wt[3]=Math.max(ft,mi),Wt},Pr.prototype.getLeftEyeNoLensTanAngles=function(){var W=this.viewer,ue=this.device,Ae=this.distortion,Se=new Float32Array(4),We=Ae.distortInverse(Math.tan(-dt*W.fov)),Ye=Ae.distortInverse(Math.tan(dt*W.fov)),ft=Ae.distortInverse(Math.tan(dt*W.fov)),he=Ae.distortInverse(Math.tan(-dt*W.fov)),le=ue.widthMeters/4,pe=ue.heightMeters/2,be=W.baselineLensDistance-ue.bevelMeters-pe,Ee=W.interLensDistance/2-le,st=-be,Ct=W.screenLensDistance,Ht=(Ee-le)/Ct,ii=(st+pe)/Ct,mi=(Ee+le)/Ct,Wt=(st-pe)/Ct;return Se[0]=Math.max(We,Ht),Se[1]=Math.min(Ye,ii),Se[2]=Math.min(ft,mi),Se[3]=Math.max(he,Wt),Se},Pr.prototype.getLeftEyeVisibleScreenRect=function(W){var ue=this.viewer,Ae=this.device,Se=ue.screenLensDistance,We=(Ae.widthMeters-ue.interLensDistance)/2,Ye=ue.baselineLensDistance-Ae.bevelMeters,ft=(W[0]*Se+We)/Ae.widthMeters,he=(W[1]*Se+Ye)/Ae.heightMeters,le=(W[2]*Se+We)/Ae.widthMeters,pe=(W[3]*Se+Ye)/Ae.heightMeters;return{x:ft,y:pe,width:le-ft,height:he-pe}},Pr.prototype.getFieldOfViewLeftEye=function(W){return W?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Pr.prototype.getFieldOfViewRightEye=function(W){var ue=this.getFieldOfViewLeftEye(W);return{leftDegrees:ue.rightDegrees,rightDegrees:ue.leftDegrees,upDegrees:ue.upDegrees,downDegrees:ue.downDegrees}},Pr.prototype.getUndistortedFieldOfViewLeftEye=function(){var W=this.getUndistortedParams_();return{leftDegrees:Bt*Math.atan(W.outerDist),rightDegrees:Bt*Math.atan(W.innerDist),downDegrees:Bt*Math.atan(W.bottomDist),upDegrees:Bt*Math.atan(W.topDist)}},Pr.prototype.getUndistortedViewportLeftEye=function(){var W=this.getUndistortedParams_(),ue=this.viewer,Ae=this.device,Se=ue.screenLensDistance,We=Ae.widthMeters/Se,Ye=Ae.heightMeters/Se,ft=Ae.width/We,he=Ae.height/Ye,le=Math.round((W.eyePosX-W.outerDist)*ft),pe=Math.round((W.eyePosY-W.bottomDist)*he);return{x:le,y:pe,width:Math.round((W.eyePosX+W.innerDist)*ft)-le,height:Math.round((W.eyePosY+W.topDist)*he)-pe}},Pr.prototype.getUndistortedParams_=function(){var W=this.viewer,ue=this.device,Ae=this.distortion,Se=W.screenLensDistance,We=W.interLensDistance/2/Se,Ye=ue.widthMeters/Se,ft=ue.heightMeters/Se,he=Ye/2-We,le=(W.baselineLensDistance-ue.bevelMeters)/Se,pe=W.fov,be=Ae.distortInverse(Math.tan(dt*pe)),Ee=Math.min(he,be),st=Math.min(We,be),Ct=Math.min(le,be),Ht=Math.min(ft-le,be);return{outerDist:Ee,innerDist:st,topDist:Ht,bottomDist:Ct,eyePosX:he,eyePosY:le}};function tn(W){this.id=W.id,this.label=W.label,this.fov=W.fov,this.interLensDistance=W.interLensDistance,this.baselineLensDistance=W.baselineLensDistance,this.screenLensDistance=W.screenLensDistance,this.distortionCoefficients=W.distortionCoefficients,this.inverseCoefficients=W.inverseCoefficients}Pr.Viewers=fn;var gs=1,mn="2019-11-09T17:36:14Z",Rs=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],$n={format:gs,last_updated:mn,devices:Rs};function As(W,ue){if(this.dpdb=$n,this.recalculateDeviceParams_(),W){this.onDeviceParamsUpdated=ue;var Ae=new XMLHttpRequest,Se=this;Ae.open("GET",W,!0),Ae.addEventListener("load",function(){Se.loading=!1,Ae.status>=200&&Ae.status<=299?(Se.dpdb=JSON.parse(Ae.response),Se.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),Ae.send()}}As.prototype.getDeviceParams=function(){return this.deviceParams},As.prototype.recalculateDeviceParams_=function(){var W=this.calcDeviceParams_();W?(this.deviceParams=W,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},As.prototype.calcDeviceParams_=function(){var W=this.dpdb;if(!W)return console.error("DPDB not available."),null;if(W.format!=1)return console.error("DPDB has unexpected format version."),null;if(!W.devices||!W.devices.length)return console.error("DPDB does not have a devices section."),null;var ue=navigator.userAgent||navigator.vendor||window.opera,Ae=Ge(),Se=Xe();if(!W.devices)return console.error("DPDB has no devices section."),null;for(var We=0;We<W.devices.length;We++){var Ye=W.devices[We];if(!Ye.rules){console.warn("Device["+We+"] has no rules section.");continue}if(Ye.type!="ios"&&Ye.type!="android"){console.warn("Device["+We+"] has invalid type.");continue}if(Q()==(Ye.type=="ios")){for(var ft=!1,he=0;he<Ye.rules.length;he++){var le=Ye.rules[he];if(this.ruleMatches_(le,ue,Ae,Se)){ft=!0;break}}if(ft){var pe=Ye.dpi[0]||Ye.dpi,be=Ye.dpi[1]||Ye.dpi;return new me({xdpi:pe,ydpi:be,bevelMm:Ye.bw})}}}return console.warn("No DPDB device match."),null},As.prototype.ruleMatches_=function(W,ue,Ae,Se){if(!W.ua&&!W.res||(W.ua&&W.ua.substring(0,2)==="SM"&&(W.ua=W.ua.substring(0,7)),W.ua&&ue.indexOf(W.ua)<0))return!1;if(W.res){if(!W.res[0]||!W.res[1])return!1;var We=W.res[0],Ye=W.res[1];if(Math.min(Ae,Se)!=Math.min(We,Ye)||Math.max(Ae,Se)!=Math.max(We,Ye))return!1}return!0};function me(W){this.xdpi=W.xdpi,this.ydpi=W.ydpi,this.bevelMm=W.bevelMm}function ct(W,ue){this.set(W,ue)}ct.prototype.set=function(W,ue){this.sample=W,this.timestampS=ue},ct.prototype.copy=function(W){this.set(W.sample,W.timestampS)};function St(W,ue){this.kFilter=W,this.isDebug=ue,this.currentAccelMeasurement=new ct,this.currentGyroMeasurement=new ct,this.previousGyroMeasurement=new ct,Q()?this.filterQ=new Ut(-1,0,0,1):this.filterQ=new Ut(1,0,0,1),this.previousFilterQ=new Ut,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Ut,this.isOrientationInitialized=!1,this.estimatedGravity=new bt,this.measuredGravity=new bt,this.gyroIntegralQ=new Ut}St.prototype.addAccelMeasurement=function(W,ue){this.currentAccelMeasurement.set(W,ue)},St.prototype.addGyroMeasurement=function(W,ue){this.currentGyroMeasurement.set(W,ue);var Ae=ue-this.previousGyroMeasurement.timestampS;Ie(Ae)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},St.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var W=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,ue=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,W);this.gyroIntegralQ.multiply(ue),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(ue);var Ae=new Ut;Ae.copy(this.filterQ),Ae.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(Ae),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var Se=new Ut;Se.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),Se.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Bt*Vi(Se),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var We=new Ut;We.copy(this.filterQ),We.multiply(Se),this.filterQ.slerp(We,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},St.prototype.getOrientation=function(){return this.filterQ},St.prototype.accelToQuaternion_=function(W){var ue=new bt;ue.copy(W),ue.normalize();var Ae=new Ut;return Ae.setFromUnitVectors(new bt(0,0,-1),ue),Ae.inverse(),Ae},St.prototype.gyroToQuaternionDelta_=function(W,ue){var Ae=new Ut,Se=new bt;return Se.copy(W),Se.normalize(),Ae.setFromAxisAngle(Se,W.length()*ue),Ae};function Xt(W,ue){this.predictionTimeS=W,this.isDebug=ue,this.previousQ=new Ut,this.previousTimestampS=null,this.deltaQ=new Ut,this.outQ=new Ut}Xt.prototype.getPrediction=function(W,ue,Ae){if(!this.previousTimestampS)return this.previousQ.copy(W),this.previousTimestampS=Ae,W;var Se=new bt;Se.copy(ue),Se.normalize();var We=ue.length();if(We<dt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Bt*We).toFixed(1)),this.outQ.copy(W),this.previousQ.copy(W),this.outQ;var Ye=We*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(Se,Ye),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(W),this.previousTimestampS=Ae,this.outQ};function Ii(W,ue,Ae,Se){this.yawOnly=Ae,this.accelerometer=new bt,this.gyroscope=new bt,this.filter=new St(W,Se),this.posePredictor=new Xt(ue,Se),this.isFirefoxAndroid=ie(),this.isIOS=Q();var We=Y();this.isDeviceMotionInRadians=!this.isIOS&&We&&We<66,this.isWithoutDeviceMotion=xe()||ae(),this.filterToWorldQ=new Ut,Q()?this.filterToWorldQ.setFromAxisAngle(new bt(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new bt(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Ut,this.worldToScreenQ=new Ut,this.originalPoseAdjustQ=new Ut,this.originalPoseAdjustQ.setFromAxisAngle(new bt(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),de()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Ut,this.orientationOut_=new Float32Array(4),this.start()}Ii.prototype.getPosition=function(){return null},Ii.prototype.getOrientation=function(){var W=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var We=new Ut().setFromAxisAngle(new bt(0,0,-1),0),Ye=new Ut;return window.orientation===-90?Ye.setFromAxisAngle(new bt(0,1,0),Math.PI/-2):Ye.setFromAxisAngle(new bt(0,1,0),Math.PI/2),We.multiply(Ye)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var We=new Ut;return We.setFromAxisAngle(new bt(1,0,0),-Math.PI/2),We}(),W=this._deviceOrientationQ;var Ae=new Ut;return Ae.copy(W),Ae.multiply(this.deviceOrientationFilterToWorldQ),Ae.multiply(this.resetQ),Ae.multiply(this.worldToScreenQ),Ae.multiplyQuaternions(this.deviceOrientationFixQ,Ae),this.yawOnly&&(Ae.x=0,Ae.z=0,Ae.normalize()),this.orientationOut_[0]=Ae.x,this.orientationOut_[1]=Ae.y,this.orientationOut_[2]=Ae.z,this.orientationOut_[3]=Ae.w,this.orientationOut_}else{var ue=this.filter.getOrientation();W=this.posePredictor.getPrediction(ue,this.gyroscope,this.previousTimestampS)}var Ae=new Ut;return Ae.copy(this.filterToWorldQ),Ae.multiply(this.resetQ),Ae.multiply(W),Ae.multiply(this.worldToScreenQ),this.yawOnly&&(Ae.x=0,Ae.z=0,Ae.normalize()),this.orientationOut_[0]=Ae.x,this.orientationOut_[1]=Ae.y,this.orientationOut_[2]=Ae.z,this.orientationOut_[3]=Ae.w,this.orientationOut_},Ii.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),de()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Ii.prototype.onDeviceOrientation_=function(W){this._deviceOrientationQ=this._deviceOrientationQ||new Ut;var ue=W.alpha,Ae=W.beta,Se=W.gamma;ue=(ue||0)*Math.PI/180,Ae=(Ae||0)*Math.PI/180,Se=(Se||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(Ae,ue,-Se)},Ii.prototype.onDeviceMotion_=function(W){this.updateDeviceMotion_(W)},Ii.prototype.updateDeviceMotion_=function(W){var ue=W.accelerationIncludingGravity,Ae=W.rotationRate,Se=W.timeStamp/1e3,We=Se-this.previousTimestampS;if(We<0){Qe("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=Se;return}else if(We<=J||We>H){Qe("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=Se;return}this.accelerometer.set(-ue.x,-ue.y,-ue.z),Ae&&(fe()?this.gyroscope.set(-Ae.beta,Ae.alpha,Ae.gamma):this.gyroscope.set(Ae.alpha,Ae.beta,Ae.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,Se)),this.filter.addAccelMeasurement(this.accelerometer,Se),this.previousTimestampS=Se},Ii.prototype.onOrientationChange_=function(W){this.setScreenTransform_()},Ii.prototype.onMessage_=function(W){var ue=W.data;if(!(!ue||!ue.type)){var Ae=ue.type.toLowerCase();Ae==="devicemotion"&&this.updateDeviceMotion_(ue.deviceMotionEvent)}},Ii.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new bt(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new bt(0,0,1),Math.PI/2);break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Ii.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),Q()&&Si()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Ii.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var sr=60,Ni=new bt(1,0,0),Oi=new bt(0,0,1),Be=new Ut;Be.setFromAxisAngle(Ni,-Math.PI/2),Be.multiply(new Ut().setFromAxisAngle(Oi,Math.PI/2));var se=function(){function W(ue){L(this,W),this.config=ue,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Ut,this._outQ=new Ut,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return O(W,[{key:"init",value:function(){var ue=null;try{ue=new RelativeOrientationSensor({frequency:sr,referenceFrame:"screen"}),ue.addEventListener("error",this._onSensorError)}catch(Ae){this.errors.push(Ae),Ae.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):Ae.name==="ReferenceError"?this.useDeviceMotion():console.error(Ae)}ue&&(this.api="sensor",this.sensor=ue,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Ii(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var ue=this.sensor.quaternion;this._sensorQ.set(ue[0],ue[1],ue[2],ue[3]);var Ae=this._outQ;return Ae.copy(Be),Ae.multiply(this._sensorQ),this.config.YAW_ONLY&&(Ae.x=Ae.z=0,Ae.normalize()),this._out[0]=Ae.x,this._out[1]=Ae.y,this._out[2]=Ae.z,this._out[3]=Ae.w,this._out}},{key:"_onSensorError",value:function(ue){this.errors.push(ue.error),ue.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):ue.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(ue.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),W}(),ge="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Ne(){this.loadIcon_();var W=document.createElement("div"),ft=W.style;ft.position="fixed",ft.top=0,ft.right=0,ft.bottom=0,ft.left=0,ft.backgroundColor="gray",ft.fontFamily="sans-serif",ft.zIndex=1e6;var ue=document.createElement("img");ue.src=this.icon;var ft=ue.style;ft.marginLeft="25%",ft.marginTop="25%",ft.width="50%",W.appendChild(ue);var Ae=document.createElement("div"),ft=Ae.style;ft.textAlign="center",ft.fontSize="16px",ft.lineHeight="24px",ft.margin="24px 25%",ft.width="50%",Ae.innerHTML="Place your phone into your Cardboard viewer.",W.appendChild(Ae);var Se=document.createElement("div"),ft=Se.style;ft.backgroundColor="#CFD8DC",ft.position="fixed",ft.bottom=0,ft.width="100%",ft.height="48px",ft.padding="14px 24px",ft.boxSizing="border-box",ft.color="#656A6B",W.appendChild(Se);var We=document.createElement("div");We.style.float="left",We.innerHTML="No Cardboard viewer?";var Ye=document.createElement("a");Ye.href="https://www.google.com/get/cardboard/get-cardboard/",Ye.innerHTML="get one",Ye.target="_blank";var ft=Ye.style;ft.float="right",ft.fontWeight=600,ft.textTransform="uppercase",ft.borderLeft="1px solid gray",ft.paddingLeft="24px",ft.textDecoration="none",ft.color="#656A6B",Se.appendChild(We),Se.appendChild(Ye),this.overlay=W,this.text=Ae,this.hide()}Ne.prototype.show=function(W){!W&&!this.overlay.parentElement?document.body.appendChild(this.overlay):W&&(this.overlay.parentElement&&this.overlay.parentElement!=W&&this.overlay.parentElement.removeChild(this.overlay),W.appendChild(this.overlay)),this.overlay.style.display="block";var ue=this.overlay.querySelector("img"),Ae=ue.style;de()?(Ae.width="20%",Ae.marginLeft="40%",Ae.marginTop="3%"):(Ae.width="50%",Ae.marginLeft="25%",Ae.marginTop="25%")},Ne.prototype.hide=function(){this.overlay.style.display="none"},Ne.prototype.showTemporarily=function(W,ue){this.show(ue),this.timer=setTimeout(this.hide.bind(this),W)},Ne.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Ne.prototype.update=function(){this.disableShowTemporarily(),!de()&&Ze()?this.show():this.hide()},Ne.prototype.loadIcon_=function(){this.icon=V("image/svg+xml",ge)};var ke="CardboardV1",Ke="WEBVR_CARDBOARD_VIEWER",ot="webvr-polyfill-viewer-selector";function wt(W){try{this.selectedKey=localStorage.getItem(Ke)}catch(ue){console.error("Failed to load viewer profile: %s",ue)}this.selectedKey||(this.selectedKey=W||ke),this.dialog=this.createDialog_(Pr.Viewers),this.root=null,this.onChangeCallbacks_=[]}wt.prototype.show=function(W){this.root=W,W.appendChild(this.dialog);var ue=this.dialog.querySelector("#"+this.selectedKey);ue.checked=!0,this.dialog.style.display="block"},wt.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},wt.prototype.getCurrentViewer=function(){return Pr.Viewers[this.selectedKey]},wt.prototype.getSelectedKey_=function(){var W=this.dialog.querySelector("input[name=field]:checked");return W?W.id:null},wt.prototype.onChange=function(W){this.onChangeCallbacks_.push(W)},wt.prototype.fireOnChange_=function(W){for(var ue=0;ue<this.onChangeCallbacks_.length;ue++)this.onChangeCallbacks_[ue](W)},wt.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Pr.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Pr.Viewers[this.selectedKey]);try{localStorage.setItem(Ke,this.selectedKey)}catch(W){console.error("Failed to save viewer profile: %s",W)}this.hide()},wt.prototype.createDialog_=function(W){var ue=document.createElement("div");ue.classList.add(ot),ue.style.display="none";var Ae=document.createElement("div"),Ye=Ae.style;Ye.position="fixed",Ye.left=0,Ye.top=0,Ye.width="100%",Ye.height="100%",Ye.background="rgba(0, 0, 0, 0.3)",Ae.addEventListener("click",this.hide.bind(this));var Se=280,We=document.createElement("div"),Ye=We.style;Ye.boxSizing="border-box",Ye.position="fixed",Ye.top="24px",Ye.left="50%",Ye.marginLeft=-280/2+"px",Ye.width=Se+"px",Ye.padding="24px",Ye.overflow="hidden",Ye.background="#fafafa",Ye.fontFamily="'Roboto', sans-serif",Ye.boxShadow="0px 5px 20px #666",We.appendChild(this.createH1_("Select your viewer"));for(var ft in W)We.appendChild(this.createChoice_(ft,W[ft].label));return We.appendChild(this.createButton_("Save",this.onSave_.bind(this))),ue.appendChild(Ae),ue.appendChild(We),ue},wt.prototype.createH1_=function(W){var ue=document.createElement("h1"),Ae=ue.style;return Ae.color="black",Ae.fontSize="20px",Ae.fontWeight="bold",Ae.marginTop=0,Ae.marginBottom="24px",ue.innerHTML=W,ue},wt.prototype.createChoice_=function(W,ue){var Ae=document.createElement("div");Ae.style.marginTop="8px",Ae.style.color="black";var Se=document.createElement("input");Se.style.fontSize="30px",Se.setAttribute("id",W),Se.setAttribute("type","radio"),Se.setAttribute("value",W),Se.setAttribute("name","field");var We=document.createElement("label");return We.style.marginLeft="4px",We.setAttribute("for",W),We.innerHTML=ue,Ae.appendChild(Se),Ae.appendChild(We),Ae},wt.prototype.createButton_=function(W,ue){var Ae=document.createElement("button");Ae.innerHTML=W;var Se=Ae.style;return Se.float="right",Se.textTransform="uppercase",Se.color="#1094f7",Se.fontSize="14px",Se.letterSpacing=0,Se.border=0,Se.background="none",Se.marginTop="16px",Ae.addEventListener("click",ue),Ae};var qt=typeof window<"u"?window:typeof d<"u"?d:typeof self<"u"?self:{};function Kt(W){return W&&W.__esModule&&Object.prototype.hasOwnProperty.call(W,"default")?W.default:W}function Rt(W,ue){return ue={exports:{}},W(ue,ue.exports),ue.exports}var ti=Rt(function(W,ue){(function(Ae,Se){W.exports=Se()})(qt,function(){return function(Ae){var Se={};function We(Ye){if(Se[Ye])return Se[Ye].exports;var ft=Se[Ye]={i:Ye,l:!1,exports:{}};return Ae[Ye].call(ft.exports,ft,ft.exports,We),ft.l=!0,ft.exports}return We.m=Ae,We.c=Se,We.d=function(Ye,ft,he){We.o(Ye,ft)||Object.defineProperty(Ye,ft,{configurable:!1,enumerable:!0,get:he})},We.n=function(Ye){var ft=Ye&&Ye.__esModule?function(){return Ye.default}:function(){return Ye};return We.d(ft,"a",ft),ft},We.o=function(Ye,ft){return Object.prototype.hasOwnProperty.call(Ye,ft)},We.p="",We(We.s=0)}([function(Ae,Se,We){var Ye=function(){function be(Ee,st){for(var Ct=0;Ct<st.length;Ct++){var Ht=st[Ct];Ht.enumerable=Ht.enumerable||!1,Ht.configurable=!0,"value"in Ht&&(Ht.writable=!0),Object.defineProperty(Ee,Ht.key,Ht)}}return function(Ee,st,Ct){return st&&be(Ee.prototype,st),Ct&&be(Ee,Ct),Ee}}();function ft(be,Ee){if(!(be instanceof Ee))throw new TypeError("Cannot call a class as a function")}var he=We(1),le=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,pe=function(){function be(){ft(this,be),le?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",he),this.noSleepVideo.addEventListener("timeupdate",(function(Ee){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}).bind(this)))}return Ye(be,[{key:"enable",value:function(){le?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){le?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),be}();Ae.exports=pe},function(Ae,Se,We){Ae.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),bi=Kt(ti),Fi=1e3,Cr=[0,0,.5,1],ur=[.5,0,.5,1],Ji=window.requestAnimationFrame,vi=window.cancelAnimationFrame;function Tn(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function qn(W){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:W.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:W.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:W.canPresent},maxLayers:{writable:!1,enumerable:!0,value:W.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Ce("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),W.hasOrientation}}})}function Mi(W){W=W||{};var ue="wakelock"in W?W.wakelock:!0;this.isPolyfilled=!0,this.displayId=Fi++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Ce("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new qn({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,ue&&Ze()&&(this.wakelock_=new bi)}Mi.prototype.getFrameData=function(W){return Ri(W,this._getPose(),this)},Mi.prototype.getPose=function(){return Ce("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},Mi.prototype.resetPose=function(){return Ce("VRDisplay.prototype.resetPose"),this._resetPose()},Mi.prototype.getImmediatePose=function(){return Ce("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},Mi.prototype.requestAnimationFrame=function(W){return Ji(W)},Mi.prototype.cancelAnimationFrame=function(W){return vi(W)},Mi.prototype.wrapForFullscreen=function(W){if(Q())return W;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var ue=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",ue.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==W)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=W,this.originalParent_=W.parentElement,this.originalParent_||document.body.appendChild(W),!this.fullscreenWrapper_.parentElement){var Ae=this.fullscreenElement_.parentElement;Ae.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),Ae.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var Se=this;function We(){if(Se.fullscreenElement_){var Ye=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];Se.fullscreenElement_.setAttribute("style",Ye.join("; ")+";")}}return We(),this.fullscreenWrapper_},Mi.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var W=this.fullscreenElement_;this.fullscreenElementCachedStyle_?W.setAttribute("style",this.fullscreenElementCachedStyle_):W.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var ue=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(W),this.originalParent_===ue?ue.insertBefore(W,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(W),ue.removeChild(this.fullscreenWrapper_),W}},Mi.prototype.requestPresent=function(W){var ue=this.isPresenting,Ae=this;return W instanceof Array||(Ce("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),W=[W]),new Promise(function(Se,We){if(!Ae.capabilities.canPresent){We(new Error("VRDisplay is not capable of presenting."));return}if(W.length==0||W.length>Ae.capabilities.maxLayers){We(new Error("Invalid number of layers."));return}var Ye=W[0];if(!Ye.source){Se();return}var ft=Ye.leftBounds||Cr,he=Ye.rightBounds||ur;if(ue){var le=Ae.layer_;le.source!==Ye.source&&(le.source=Ye.source);for(var pe=0;pe<4;pe++)le.leftBounds[pe]=ft[pe],le.rightBounds[pe]=he[pe];Ae.wrapForFullscreen(Ae.layer_.source),Ae.updatePresent_(),Se();return}if(Ae.layer_={predistorted:Ye.predistorted,source:Ye.source,leftBounds:ft.slice(0),rightBounds:he.slice(0)},Ae.waitingForPresent_=!1,Ae.layer_&&Ae.layer_.source){var be=Ae.wrapForFullscreen(Ae.layer_.source),Ee=function(){var Ct=At();Ae.isPresenting=be===Ct,Ae.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Ht){console.error("screen.orientation.lock() failed due to",Ht.message)}),Ae.waitingForPresent_=!1,Ae.beginPresent_(),Se()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),Ae.removeFullscreenWrapper(),Ae.disableWakeLock(),Ae.endPresent_(),Ae.removeFullscreenListeners_()),Ae.fireVRDisplayPresentChange_()},st=function(){Ae.waitingForPresent_&&(Ae.removeFullscreenWrapper(),Ae.removeFullscreenListeners_(),Ae.disableWakeLock(),Ae.waitingForPresent_=!1,Ae.isPresenting=!1,We(new Error("Unable to present.")))};Ae.addFullscreenListeners_(be,Ee,st),$e(be)?(Ae.enableWakeLock(),Ae.waitingForPresent_=!0):(Q()||G())&&(Ae.enableWakeLock(),Ae.isPresenting=!0,Ae.beginPresent_(),Ae.fireVRDisplayPresentChange_(),Se())}!Ae.waitingForPresent_&&!Q()&&(lt(),We(new Error("Unable to present.")))})},Mi.prototype.exitPresent=function(){var W=this.isPresenting,ue=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(Ae,Se){W?(!lt()&&Q()&&(ue.endPresent_(),ue.fireVRDisplayPresentChange_()),G()&&(ue.removeFullscreenWrapper(),ue.removeFullscreenListeners_(),ue.endPresent_(),ue.fireVRDisplayPresentChange_()),Ae()):Se(new Error("Was not presenting to VRDisplay."))})},Mi.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},Mi.prototype.fireVRDisplayPresentChange_=function(){var W=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(W)},Mi.prototype.fireVRDisplayConnect_=function(){var W=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(W)},Mi.prototype.addFullscreenListeners_=function(W,ue,Ae){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=W,this.fullscreenChangeHandler_=ue,this.fullscreenErrorHandler_=Ae,ue&&(document.fullscreenEnabled?W.addEventListener("fullscreenchange",ue,!1):document.webkitFullscreenEnabled?W.addEventListener("webkitfullscreenchange",ue,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",ue,!1):document.msFullscreenEnabled&&W.addEventListener("msfullscreenchange",ue,!1)),Ae&&(document.fullscreenEnabled?W.addEventListener("fullscreenerror",Ae,!1):document.webkitFullscreenEnabled?W.addEventListener("webkitfullscreenerror",Ae,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",Ae,!1):document.msFullscreenEnabled&&W.addEventListener("msfullscreenerror",Ae,!1))},Mi.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var W=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var ue=this.fullscreenChangeHandler_;W.removeEventListener("fullscreenchange",ue,!1),W.removeEventListener("webkitfullscreenchange",ue,!1),document.removeEventListener("mozfullscreenchange",ue,!1),W.removeEventListener("msfullscreenchange",ue,!1)}if(this.fullscreenErrorHandler_){var Ae=this.fullscreenErrorHandler_;W.removeEventListener("fullscreenerror",Ae,!1),W.removeEventListener("webkitfullscreenerror",Ae,!1),document.removeEventListener("mozfullscreenerror",Ae,!1),W.removeEventListener("msfullscreenerror",Ae,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},Mi.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},Mi.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},Mi.prototype.beginPresent_=function(){},Mi.prototype.endPresent_=function(){},Mi.prototype.submitFrame=function(W){},Mi.prototype.getEyeParameters=function(W){return null};var ar={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},un={LEFT:"left",RIGHT:"right"};function Qr(W){var ue=ki({},ar);W=ki(ue,W||{}),Mi.call(this,{wakelock:W.MOBILE_WAKE_LOCK}),this.config=W,this.displayName="Cardboard VRDisplay",this.capabilities=new qn({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new se(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new As(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Pr(this.dpdb_.getDeviceParams(),W.ADDITIONAL_VIEWERS),this.viewerSelector_=new wt(W.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Ne),Q()&&window.addEventListener("resize",this.onResize_.bind(this))}return Qr.prototype=Object.create(Mi.prototype),Qr.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Qr.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Qr.prototype._getFieldOfView=function(W){var ue;if(W==un.LEFT)ue=this.deviceInfo_.getFieldOfViewLeftEye();else if(W==un.RIGHT)ue=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",W),null;return ue},Qr.prototype._getEyeOffset=function(W){var ue;if(W==un.LEFT)ue=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(W==un.RIGHT)ue=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",W),null;return ue},Qr.prototype.getEyeParameters=function(W){var ue=this._getEyeOffset(W),Ae=this._getFieldOfView(W),Se={offset:ue,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(Se,"fieldOfView",{enumerable:!0,get:function(){return Ce("VRFieldOfView","VRFrameData's projection matrices"),Ae}}),Se},Qr.prototype.onDeviceParamsUpdated_=function(W){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(W),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Qr.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Qr.prototype.beginPresent_=function(){var W=this.layer_.source.getContext("webgl");W||(W=this.layer_.source.getContext("experimental-webgl")),W||(W=this.layer_.source.getContext("webgl2")),W&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(W.canvas.width=Ge()*this.bufferScale_,W.canvas.height=Xe()*this.bufferScale_,this.cardboardUI_=new Ue(W)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Ue(W)),this.distorter_=new xi(W,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen((function(ue){this.viewerSelector_.show(this.layer_.source.parentElement),ue.stopPropagation(),ue.preventDefault()}).bind(this),(function(ue){this.exitPresent(),ue.stopPropagation(),ue.preventDefault()}).bind(this)),this.rotateInstructions_&&(de()&&Ze()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Qr.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Qr.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Qr.prototype.submitFrame=function(W){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var ue=this.layer_.source.getContext("webgl");ue||(ue=this.layer_.source.getContext("experimental-webgl")),ue||(ue=this.layer_.source.getContext("webgl2"));var Ae=ue.canvas;(Ae.width!=this.lastWidth||Ae.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=Ae.width,this.lastHeight=Ae.height,this.cardboardUI_.render()}},Qr.prototype.onOrientationChange_=function(W){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Qr.prototype.onResize_=function(W){if(this.layer_){var ue=this.layer_.source.getContext("webgl");ue||(ue=this.layer_.source.getContext("experimental-webgl")),ue||(ue=this.layer_.source.getContext("webgl2"));var Ae=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];ue.canvas.setAttribute("style",Ae.join("; ")+";"),hi(ue.canvas)}},Qr.prototype.onViewerChanged_=function(W){this.deviceInfo_.setViewer(W),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Qr.prototype.fireVRDisplayDeviceParamsChange_=function(){var W=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(W)},Qr.VRFrameData=Tn,Qr.VRDisplay=Mi,Qr})}),v=p(x),_="0.10.12",T={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function w(I){this.config=y(y({},T),I),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&m())&&(this.enable(),this.getVRDisplays().then(function(D){D&&D[0]&&D[0].fireVRDisplayConnect_&&D[0].fireVRDisplayConnect_()}))}w.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(m()){var I=new v({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(I)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},w.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var I=this.native.VRFrameData,D=new this.native.VRFrameData,L=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(O){if(O instanceof I){L.call(this,O);return}L.call(this,D),O.pose=D.pose,g(D.leftProjectionMatrix,O.leftProjectionMatrix),g(D.rightProjectionMatrix,O.rightProjectionMatrix),g(D.leftViewMatrix,O.leftViewMatrix),g(D.rightViewMatrix,O.rightViewMatrix)}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=v.VRDisplay,window.VRFrameData=v.VRFrameData},w.prototype.getVRDisplays=function(){var I=this;return this.config,this.hasNative?this.native.getVRDisplays.call(navigator).then(function(D){return D.length>0?D:I.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},w.version=_,w.VRFrameData=v.VRFrameData,w.VRDisplay=v.VRDisplay;var S=Object.freeze({default:w}),R=S&&w||S;typeof d<"u"&&d.window&&(d.document||(d.document=d.window.document),d.navigator||(d.navigator=d.window.navigator));var B=R;return B})},"./node_modules/word-wrapper/index.js":l=>{var u=/\n/,c=`
`,d=/\s/;l.exports=function(x,v){var _=l.exports.lines(x,v);return _.map(function(T){return x.substring(T.start,T.end)}).join(`
`)},l.exports.lines=function(x,v){if(v=v||{},v.width===0&&v.mode!=="nowrap")return[];x=x||"";var _=typeof v.width=="number"?v.width:Number.MAX_VALUE,T=Math.max(0,v.start||0),w=typeof v.end=="number"?v.end:x.length,S=v.mode,R=v.measure||y;return S==="pre"?m(R,x,T,w,_):g(R,x,T,w,_,S)};function p(x,v,_,T){var w=x.indexOf(v,_);return w===-1||w>T?T:w}function f(x){return d.test(x)}function m(x,v,_,T,w){for(var S=[],R=_,B=_;B<T&&B<v.length;B++){var I=v.charAt(B),D=u.test(I);if(D||B===T-1){var L=D?B:B+1,O=x(v,R,L,w);S.push(O),R=B+1}}return S}function g(x,v,_,T,w,S){var R=[],B=w;for(S==="nowrap"&&(B=Number.MAX_VALUE);_<T&&_<v.length;){for(var I=p(v,c,_,T);_<I&&f(v.charAt(_));)_++;var D=x(v,_,I,B),L=_+(D.end-D.start),O=L+c.length;if(L<I){for(;L>_&&!f(v.charAt(L));)L--;if(L===_)O>_+c.length&&O--,L=O;else for(O=L;L>_&&f(v.charAt(L-c.length));)L--}if(L>=_){var U=x(v,_,L,B);R.push(U)}_=O}return R}function y(x,v,_,T){var w=Math.min(T,_-v);return{start:v,end:v+w}}},"./node_modules/xhr/index.js":(l,u,c)=>{var d=c("./node_modules/global/window.js"),p=c("./node_modules/is-function/index.js"),f=c("./node_modules/parse-headers/parse-headers.js"),m=c("./node_modules/xtend/immutable.js");l.exports=v,l.exports.default=v,v.XMLHttpRequest=d.XMLHttpRequest||w,v.XDomainRequest="withCredentials"in new v.XMLHttpRequest?v.XMLHttpRequest:d.XDomainRequest,g(["get","put","post","patch","head","delete"],function(S){v[S==="delete"?"del":S]=function(R,B,I){return B=x(R,B,I),B.method=S.toUpperCase(),_(B)}});function g(S,R){for(var B=0;B<S.length;B++)R(S[B])}function y(S){for(var R in S)if(S.hasOwnProperty(R))return!1;return!0}function x(S,R,B){var I=S;return p(R)?(B=R,typeof S=="string"&&(I={uri:S})):I=m(R,{uri:S}),I.callback=B,I}function v(S,R,B){return R=x(S,R,B),_(R)}function _(S){if(typeof S.callback>"u")throw new Error("callback argument missing");var R=!1,B=function(xe,fe,de){R||(R=!0,S.callback(xe,fe,de))};function I(){U.readyState===4&&setTimeout(O,0)}function D(){var xe=void 0;if(U.response?xe=U.response:xe=U.responseText||T(U),ie)try{xe=JSON.parse(xe)}catch{}return xe}function L(xe){return clearTimeout(Y),xe instanceof Error||(xe=new Error(""+(xe||"Unknown XMLHttpRequest Error"))),xe.statusCode=0,B(xe,ae)}function O(){if(!H){var xe;clearTimeout(Y),S.useXDR&&U.status===void 0?xe=200:xe=U.status===1223?204:U.status;var fe=ae,de=null;return xe!==0?(fe={body:D(),statusCode:xe,method:$,headers:{},url:V,rawRequest:U},U.getAllResponseHeaders&&(fe.headers=f(U.getAllResponseHeaders()))):de=new Error("Internal XMLHttpRequest Error"),B(de,fe,fe.body)}}var U=S.xhr||null;U||(S.cors||S.useXDR?U=new v.XDomainRequest:U=new v.XMLHttpRequest);var J,H,V=U.url=S.uri||S.url,$=U.method=S.method||"GET",Q=S.body||S.data,G=U.headers=S.headers||{},j=!!S.sync,ie=!1,Y,ae={body:void 0,headers:{},statusCode:0,method:$,url:V,rawRequest:U};if("json"in S&&S.json!==!1&&(ie=!0,G.accept||G.Accept||(G.Accept="application/json"),$!=="GET"&&$!=="HEAD"&&(G["content-type"]||G["Content-Type"]||(G["Content-Type"]="application/json"),Q=JSON.stringify(S.json===!0?Q:S.json))),U.onreadystatechange=I,U.onload=O,U.onerror=L,U.onprogress=function(){},U.onabort=function(){H=!0},U.ontimeout=L,U.open($,V,!j,S.username,S.password),j||(U.withCredentials=!!S.withCredentials),!j&&S.timeout>0&&(Y=setTimeout(function(){if(!H){H=!0,U.abort("timeout");var xe=new Error("XMLHttpRequest timeout");xe.code="ETIMEDOUT",L(xe)}},S.timeout)),U.setRequestHeader)for(J in G)G.hasOwnProperty(J)&&U.setRequestHeader(J,G[J]);else if(S.headers&&!y(S.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in S&&(U.responseType=S.responseType),"beforeSend"in S&&typeof S.beforeSend=="function"&&S.beforeSend(U),U.send(Q||null),U}function T(S){try{if(S.responseType==="document")return S.responseXML;var R=S.responseXML&&S.responseXML.documentElement.nodeName==="parsererror";if(S.responseType===""&&!R)return S.responseXML}catch{}return null}function w(){}},"./node_modules/xml-parse-from-string/index.js":l=>{l.exports=function(){return typeof self.DOMParser<"u"?function(u){var c=new self.DOMParser;return c.parseFromString(u,"application/xml")}:typeof self.ActiveXObject<"u"&&new self.ActiveXObject("Microsoft.XMLDOM")?function(u){var c=new self.ActiveXObject("Microsoft.XMLDOM");return c.async="false",c.loadXML(u),c}:function(u){var c=document.createElement("div");return c.innerHTML=u,c}}()},"./node_modules/xtend/immutable.js":l=>{l.exports=c;var u=Object.prototype.hasOwnProperty;function c(){for(var d={},p=0;p<arguments.length;p++){var f=arguments[p];for(var m in f)u.call(f,m)&&(d[m]=f[m])}return d}},"./src/components/anchored.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js"),f=p.debug("components:anchored:warn");l.exports.Component=d("anchored",{schema:{persistent:{default:!1}},init:function(){var g=this.el.sceneEl,y=g.getAttribute("webxr"),x=y.optionalFeatures;x.indexOf("anchors")===-1&&(x.push("anchors"),this.el.sceneEl.setAttribute("webxr",y)),this.auxQuaternion=new THREE.Quaternion,this.onEnterVR=this.onEnterVR.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR)},onEnterVR:function(){this.anchor=void 0,this.requestPersistentAnchorPending=this.data.persistent,this.requestAnchorPending=!this.data.persistent},tick:function(){var g=this.el.sceneEl,y=g.renderer.xr,x,v,_,T=this.el.object3D;!g.is("ar-mode")&&!g.is("vr-mode")||(!this.anchor&&this.requestPersistentAnchorPending&&this.restorePersistentAnchor(),!this.anchor&&this.requestAnchorPending&&this.createAnchor(),this.anchor&&(x=g.frame,v=y.getReferenceSpace(),_=x.getPose(this.anchor.anchorSpace,v),T.matrix.elements=_.transform.matrix,T.matrix.decompose(T.position,T.rotation,T.scale)))},createAnchor:async function(g,y){var x=this.el.sceneEl,v=x.renderer.xr,_,T,w,S,R=this.el.object3D;if(g=g||R.position,y=y||this.auxQuaternion.setFromEuler(R.rotation),!m(x)){f("This browser doesn't support the WebXR anchors module");return}this.anchor&&this.deleteAnchor(),_=x.frame,T=v.getReferenceSpace(),w=new XRRigidTransform({x:g.x,y:g.y,z:g.z},{x:y.x,y:y.y,z:y.z,w:y.w}),this.requestAnchorPending=!1,S=await _.createAnchor(w,T),this.data.persistent&&(this.el.id?(this.persistentHandle=await S.requestPersistentHandle(),localStorage.setItem(this.el.id,this.persistentHandle)):f("The anchor won't be persisted because the entity has no assigned id.")),x.object3D.attach(this.el.object3D),this.anchor=S},restorePersistentAnchor:async function(){var g=this.el.sceneEl.renderer.xr,y=g.getSession(),x=y.persistentAnchors,v;if(this.requestPersistentAnchorPending=!1,!this.el.id){f("The entity associated to the persistent anchor cannot be retrieved because it doesn't have an assigned id."),this.requestAnchorPending=!0;return}if(x){v=localStorage.getItem(this.el.id);for(var _=0;_<x.length;++_)if(v===x[_]){this.anchor=await y.restorePersistentAnchor(x[_]),this.anchor&&(this.persistentHandle=x[_]);break}this.anchor||(this.requestAnchorPending=!0)}else this.requestPersistentAnchorPending=!0},deleteAnchor:function(){var g,y,x=this.anchor;x&&(g=this.el.sceneEl.renderer.xr,y=g.getSession(),x.delete(),this.el.sceneEl.object3D.add(this.el.object3D),this.persistentHandle&&y.deletePersistentAnchor(this.persistentHandle),this.anchor=void 0)}});function m(g){var y=g.renderer.xr,x=y.getSession();return x&&x.restorePersistentAnchor}},"./src/components/animation.js":(l,u,c)=>{var d=c("./node_modules/super-animejs/lib/anime.es.js").default,p=c("./src/core/component.js").components,f=c("./src/core/component.js").registerComponent,m=c("./src/lib/three.js"),g=c("./src/utils/index.js"),y=new m.Color,x=new m.Color,v=g.entity.getComponentProperty,_=g.entity.setComponentProperty,T={},w="color",S="position",R="rotation",B="scale",I="components",D="object3D";l.exports.Component=f("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(G){return G===!0||G==="true"?!0:G===!1||G==="false"?!1:parseInt(G,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var G=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){G.animationIsPlaying=!1,G.el.emit("animationcomplete",G.eventDetail,!1),G.id&&G.el.emit("animationcomplete__"+G.id,G.eventDetail,!1)}}},update:function(G){var j=this.config,ie=this.data;this.animationIsPlaying=!1,this.data.enabled&&ie.property&&(j.autoplay=!1,j.direction=ie.dir,j.duration=ie.dur,j.easing=ie.easing,j.elasticity=ie.elasticity,j.loop=ie.loop,j.round=ie.round,this.createAndStartAnimation())},tick:function(G,j){this.animationIsPlaying&&(this.time+=j,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var G=this.data;if(this.updateConfig(),this.animationIsPlaying=!1,this.animation=d(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!(!G.autoplay||G.startEvents&&G.startEvents.length)){if(G.delay){setTimeout(this.beginAnimation,G.delay);return}this.beginAnimation()}},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){if(this.data.enabled){if(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=d(this.config),this.data.delay){setTimeout(this.beginAnimation,this.data.delay);return}this.beginAnimation()}},updateConfigForRawColor:function(){var G=this.config,j=this.data,ie=this.el,Y,ae,xe;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){Y=j.from===""?H(ie,j.property):j.from,xe=j.to,this.setColorConfig(Y,xe),Y=this.fromColor,xe=this.toColor,this.targetsArray.length=0,this.targetsArray.push(Y),G.targets=this.targetsArray;for(ae in xe)G[ae]=xe[ae];G.update=function(){var fe={};return function(de){var Ie;Ie=de.animatables[0].target,!(Ie.r===fe.r&&Ie.g===fe.g&&Ie.b===fe.b)&&V(ie,j.property,Ie,j.type)}}()}},updateConfigForDefault:function(){var G=this.config,j=this.data,ie=this.el,Y,ae,xe,fe;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(j.from===""?Y=Q(j)?H(ie,j.property):v(ie,j.property):Y=j.from,fe=j.to,xe=!isNaN(Y||fe),xe?(Y=parseFloat(Y),fe=parseFloat(fe)):(Y=Y&&Y.toString(),fe=fe&&fe.toString()),ae=j.to==="true"||j.to==="false"||j.to===!0||j.to===!1,ae&&(Y=j.from==="true"||j.from===!0?1:0,fe=j.to==="true"||j.to===!0?1:0),this.targets.aframeProperty=Y,G.targets=this.targets,G.aframeProperty=fe,G.update=function(){var de;return function(Ie){var Ge;Ge=Ie.animatables[0].target.aframeProperty,Ge!==de&&(de=Ge,ae&&(Ge=Ge>=1),Q(j)?V(ie,j.property,Ge,j.type):_(ie,j.property,Ge))}}())},updateConfigForVector:function(){var G=this.config,j=this.data,ie=this.el,Y,ae,xe;ae=j.from!==""?g.coordinates.parse(j.from):v(ie,j.property),xe=g.coordinates.parse(j.to),j.property===R&&(O(ae),O(xe)),this.targetsArray.length=0,this.targetsArray.push(ae),G.targets=this.targetsArray;for(Y in xe)G[Y]=xe[Y];if(j.property===S||j.property===R||j.property===B){G.update=function(){var fe={};return function(de){var Ie=de.animatables[0].target;Ie.x===fe.x&&Ie.y===fe.y&&Ie.z===fe.z||(fe.x=Ie.x,fe.y=Ie.y,fe.z=Ie.z,ie.object3D[j.property].set(Ie.x,Ie.y,Ie.z))}}();return}G.update=function(){var fe={};return function(de){var Ie=de.animatables[0].target;Ie.x===fe.x&&Ie.y===fe.y&&Ie.z===fe.z||(fe.x=Ie.x,fe.y=Ie.y,fe.z=Ie.z,_(ie,j.property,Ie))}}()},updateConfig:function(){var G;G=L(this.el,this.data.property),Q(this.data)&&this.data.type===w?this.updateConfigForRawColor():G==="vec2"||G==="vec3"||G==="vec4"?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(G){var j,ie=this.data,Y=this.el,ae=this;return ie.from!==""||!ie.property.startsWith(I)||(j=$(ie.property)[1],Y.components[j])?!1:(Y.addEventListener("componentinitialized",function xe(fe){fe.detail.name===j&&(G(),ae.animation=d(ae.config),Y.removeEventListener("componentinitialized",xe))}),!0)},stopRelatedAnimations:function(){var G,j;for(j in this.el.components)G=this.el.components[j],j!==this.attrName&&G.name==="animation"&&G.animationIsPlaying&&G.data.property===this.data.property&&(G.animationIsPlaying=!1)},addEventListeners:function(){var G=this.data,j=this.el;U(j,G.startEvents,this.onStartEvent),U(j,G.pauseEvents,this.pauseAnimation),U(j,G.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var G=this.data,j=this.el;J(j,G.startEvents,this.onStartEvent),J(j,G.pauseEvents,this.pauseAnimation),J(j,G.resumeEvents,this.resumeAnimation)},setColorConfig:function(G,j){y.set(G),x.set(j),G=this.fromColor,j=this.toColor,G.r=y.r,G.g=y.g,G.b=y.b,j.r=x.r,j.g=x.g,j.b=x.b}});function L(G,j){var ie,Y,ae,xe;return ae=j.split("."),Y=ae[0],xe=ae[1],ie=G.components[Y]||p[Y],!ie||xe&&!ie.schema[xe]?null:xe?ie.schema[xe].type:ie.schema.type}function O(G){G.x=m.MathUtils.degToRad(G.x),G.y=m.MathUtils.degToRad(G.y),G.z=m.MathUtils.degToRad(G.z)}function U(G,j,ie){var Y;for(Y=0;Y<j.length;Y++)G.addEventListener(j[Y],ie)}function J(G,j,ie){var Y;for(Y=0;Y<j.length;Y++)G.removeEventListener(j[Y],ie)}function H(G,j){var ie,Y,ae;for(Y=$(j),ae=G,ie=0;ie<Y.length;ie++)ae=ae[Y[ie]];if(ae===void 0)throw console.log(G),new Error("[animation] property ("+j+") could not be found");return ae}function V(G,j,ie,Y){var ae,xe,fe,de;for(j.startsWith("object3D.rotation")&&(ie=m.MathUtils.degToRad(ie)),xe=$(j),de=G,ae=0;ae<xe.length-1;ae++)de=de[xe[ae]];if(fe=xe[xe.length-1],Y===w){"r"in de[fe]?(de[fe].r=ie.r,de[fe].g=ie.g,de[fe].b=ie.b):(de[fe].x=ie.r,de[fe].y=ie.g,de[fe].z=ie.b);return}de[fe]=ie}function $(G){return G in T||(T[G]=G.split(".")),T[G]}function Q(G){return G.isRawProperty||G.property.startsWith(I)||G.property.startsWith(D)}},"./src/components/camera.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");l.exports.Component=d("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var f,m=this.el;f=this.camera=new p.PerspectiveCamera,m.setObject3D("camera",f)},update:function(f){var m=this.data,g=this.camera;g.aspect=m.aspect||window.innerWidth/window.innerHeight,g.far=m.far,g.fov=m.fov,g.near=m.near,g.zoom=m.zoom,g.updateProjectionMatrix(),this.updateActiveCamera(f),this.updateSpectatorCamera(f)},updateActiveCamera:function(f){var m=this.data,g=this.el,y=this.system;f&&f.active===m.active||m.spectator||(m.active&&y.activeCameraEl!==g?y.setActiveCamera(g):!m.active&&y.activeCameraEl===g&&y.disableActiveCamera())},updateSpectatorCamera:function(f){var m=this.data,g=this.el,y=this.system;f&&f.spectator===m.spectator||(m.spectator&&y.spectatorCameraEl!==g?y.setSpectatorCamera(g):!m.spectator&&y.spectatorCameraEl===g&&y.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}})},"./src/components/cursor.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js"),f={CLICK:"click",FUSING:"fusing",MOUSEENTER:"mouseenter",MOUSEDOWN:"mousedown",MOUSELEAVE:"mouseleave",MOUSEUP:"mouseup"},m={FUSING:"cursor-fusing",HOVERING:"cursor-hovering",HOVERED:"cursor-hovered"},g={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},y={DOWN:["selectstart"],UP:["selectend"]},x="a-mouse-cursor-hover";l.exports.Component=d("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:p.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity","xrselect"]}},after:["tracked-controls"],multiple:!0,init:function(){var v=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.activeXRInput=null,this.updateCanvasBounds=p.debounce(function(){v.canvasBounds=v.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=this.onCursorDown.bind(this),this.onCursorUp=this.onCursorUp.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},update:function(v){this.data.rayOrigin!==v.rayOrigin&&this.updateMouseEventListeners()},tick:function(){var v=this.el.sceneEl.frame,_=this.activeXRInput;this.data.rayOrigin==="xrselect"&&v&&_&&this.onMouseMove({frame:v,inputSource:_,type:"fakeselectevent"})},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var v=this.el;v.removeState(m.HOVERING),v.removeState(m.FUSING),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(m.HOVERED),this.removeEventListeners()},addEventListeners:function(){var v,_=this.data,T=this.el,w=this;function S(){v=T.sceneEl.canvas,!(_.downEvents.length||_.upEvents.length)&&(g.DOWN.forEach(function(R){v.addEventListener(R,w.onCursorDown,{passive:!1})}),g.UP.forEach(function(R){v.addEventListener(R,w.onCursorUp,{passive:!1})}))}v=T.sceneEl.canvas,v?S():T.sceneEl.addEventListener("render-target-loaded",S),_.downEvents.forEach(function(R){T.addEventListener(R,w.onCursorDown)}),_.upEvents.forEach(function(R){T.addEventListener(R,w.onCursorUp)}),T.addEventListener("raycaster-intersection",this.onIntersection),T.addEventListener("raycaster-closest-entity-changed",this.onIntersection),T.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),T.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),T.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var v,_=this.data,T=this.el,w=this;v=T.sceneEl.canvas,v&&!_.downEvents.length&&!_.upEvents.length&&(g.DOWN.forEach(function(S){v.removeEventListener(S,w.onCursorDown)}),g.UP.forEach(function(S){v.removeEventListener(S,w.onCursorUp)})),_.downEvents.forEach(function(S){T.removeEventListener(S,w.onCursorDown)}),_.upEvents.forEach(function(S){T.removeEventListener(S,w.onCursorUp)}),T.removeEventListener("raycaster-intersection",this.onIntersection),T.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),v.removeEventListener("mousemove",this.onMouseMove),v.removeEventListener("touchstart",this.onMouseMove),v.removeEventListener("touchmove",this.onMouseMove),T.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),T.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var v,_=this.el;v=_.sceneEl.canvas,v.removeEventListener("mousemove",this.onMouseMove),v.removeEventListener("touchmove",this.onMouseMove),_.setAttribute("raycaster","useWorldCoordinates",!1),this.data.rayOrigin==="mouse"&&(v.addEventListener("mousemove",this.onMouseMove),v.addEventListener("touchmove",this.onMouseMove,{passive:!1}),_.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:function(){var v=new THREE.Vector3,_=new THREE.Vector2,T=new THREE.Vector3,w={origin:T,direction:v};return function(S){var R=this.canvasBounds,B=this.el.sceneEl.camera,I,D,L,O,U,J,H,V;B.parent.updateMatrixWorld(),S.type==="touchmove"||S.type==="touchstart"?D=S.touches.item(0):D=S,I=D.clientX-R.left,L=D.clientY-R.top,_.x=I/R.width*2-1,_.y=-(L/R.height)*2+1,this.data.rayOrigin==="xrselect"&&(S.type==="selectstart"||S.type==="fakeselectevent")?(O=S.frame,U=S.inputSource,J=this.el.renderer.xr.getReferenceSpace(),H=O.getPose(U.targetRaySpace,J),V=H.transform,v.set(0,0,-1),v.applyQuaternion(V.orientation),T.copy(V.position)):S.type==="fakeselectout"?(v.set(0,1,0),T.set(0,9999,0)):B&&B.isPerspectiveCamera?(T.setFromMatrixPosition(B.matrixWorld),v.set(_.x,_.y,.5).unproject(B).sub(T).normalize()):B&&B.isOrthographicCamera?(T.set(_.x,_.y,(B.near+B.far)/(B.near-B.far)).unproject(B),v.set(0,0,-1).transformDirection(B.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+B.type),this.el.setAttribute("raycaster",w),S.type==="touchmove"&&S.preventDefault()}}(),onCursorDown:function(v){this.isCursorDown=!0,this.data.rayOrigin==="mouse"&&v.type==="touchstart"&&(this.onMouseMove(v),this.el.components.raycaster.checkIntersections(),v.preventDefault()),this.data.rayOrigin==="xrselect"&&v.type==="selectstart"&&(this.activeXRInput=v.inputSource,this.onMouseMove(v),this.el.components.raycaster.checkIntersections(),this.el.components.raycaster.intersectedEls.length&&this.el.sceneEl.components["ar-hit-test"]!==void 0&&this.el.sceneEl.getAttribute("ar-hit-test").enabled&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!1),this.reenableARHitTest=!0)),this.twoWayEmit(f.MOUSEDOWN,v),this.cursorDownEl=this.intersectedEl},onCursorUp:function(v){if(this.isCursorDown){this.isCursorDown=!1;var _=this.data;this.twoWayEmit(f.MOUSEUP,v),this.reenableARHitTest===!0&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!0),this.reenableARHitTest=void 0),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(f.MOUSEUP,this.intersectedEventDetail)),(!_.fuse||_.rayOrigin==="mouse"||_.rayOrigin==="xrselect")&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl&&this.twoWayEmit(f.CLICK,v),_.rayOrigin==="xrselect"&&this.activeXRInput===v.inputSource&&this.onMouseMove({type:"fakeselectout"}),this.activeXRInput=null,this.cursorDownEl=null,v.type==="touchend"&&v.preventDefault()}},onIntersection:function(v){var _,T=this.el,w,S,R;w=v.detail.els[0]===T?1:0,R=v.detail.intersections[w],S=v.detail.els[w],S&&this.intersectedEl!==S&&(this.intersectedEl&&(_=this.el.components.raycaster.getIntersection(this.intersectedEl),_&&_.distance<=R.distance)||(this.clearCurrentIntersection(!0),this.setIntersection(S,R)))},onIntersectionCleared:function(v){var _=v.detail.clearedEls;_.indexOf(this.intersectedEl)!==-1&&this.clearCurrentIntersection()},onEnterVR:function(){this.clearCurrentIntersection(!0);var v=this.el.sceneEl.xrSession,_=this;v&&this.data.rayOrigin!=="mouse"&&(y.DOWN.forEach(function(T){v.addEventListener(T,_.onCursorDown)}),y.UP.forEach(function(T){v.addEventListener(T,_.onCursorUp)}))},setIntersection:function(v,_){var T=this.el,w=this.data,S=this;this.intersectedEl!==v&&(this.intersectedEl=v,T.addState(m.HOVERING),v.addState(m.HOVERED),this.twoWayEmit(f.MOUSEENTER),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.add(x),!(w.fuseTimeout===0||!w.fuse||w.rayOrigin==="xrselect"||w.rayOrigin==="mouse")&&(T.addState(m.FUSING),this.twoWayEmit(f.FUSING),this.fuseTimeout=setTimeout(function(){T.removeState(m.FUSING),S.twoWayEmit(f.CLICK)},w.fuseTimeout)))},clearCurrentIntersection:function(v){var _,T,w,S=this.el;this.intersectedEl&&(this.intersectedEl.removeState(m.HOVERED),S.removeState(m.HOVERING),S.removeState(m.FUSING),this.twoWayEmit(f.MOUSELEAVE),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.remove(x),this.intersectedEl=null,clearTimeout(this.fuseTimeout),v!==!0&&(w=this.el.components.raycaster.intersections,w.length!==0&&(_=w[0].object.el===S?1:0,T=w[_],T&&this.setIntersection(T.object.el,T))))},twoWayEmit:function(v,_){var T=this.el,w=this.intersectedEl,S;function R(B,I){_ instanceof MouseEvent?B.mouseEvent=_:typeof TouchEvent<"u"&&_ instanceof TouchEvent&&(B.touchEvent=_)}S=this.el.components.raycaster.getIntersection(w),this.eventDetail.intersectedEl=w,this.eventDetail.intersection=S,R(this.eventDetail),T.emit(v,this.eventDetail),w&&(this.intersectedEventDetail.intersection=S,R(this.intersectedEventDetail),w.emit(v,this.intersectedEventDetail))}})},"./src/components/generic-tracked-controller-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,m=p.emitIfAxesChanged,g=p.onButtonEvent,y="generic",x={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]};l.exports.Component=d("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},orientationOffset:{type:"vec3"},disabled:{default:!1}},after:["tracked-controls"],mapping:x,bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var v=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(_){g(_.detail.id,"down",v)},this.onButtonUp=function(_){g(_.detail.id,"up",v)},this.onButtonTouchStart=function(_){g(_.detail.id,"touchstart",v)},this.onButtonTouchEnd=function(_){g(_.detail.id,"touchend",v)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.lastControllerCheck=0,this.bindMethods(),this.el.addEventListener("controllerconnected",function(_){_.detail.name!==v.name&&(v.wasControllerConnected=!0,v.removeEventListeners(),v.removeControllersUpdateListener())})},addEventListeners:function(){var v=this.el;v.addEventListener("buttonchanged",this.onButtonChanged),v.addEventListener("buttondown",this.onButtonDown),v.addEventListener("buttonup",this.onButtonUp),v.addEventListener("touchstart",this.onButtonTouchStart),v.addEventListener("touchend",this.onButtonTouchEnd),v.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var v=this.el;v.removeEventListener("buttonchanged",this.onButtonChanged),v.removeEventListener("buttondown",this.onButtonDown),v.removeEventListener("buttonup",this.onButtonUp),v.removeEventListener("touchstart",this.onButtonTouchStart),v.removeEventListener("touchend",this.onButtonTouchEnd),v.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var v=this.data,_=v.hand?v.hand:void 0;f(this,y,{hand:_,iterateControllerProfiles:!0})},play:function(){this.wasControllerConnected||(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var v=this.el,_=this.data;if(this.el.components["tracked-controls"]){this.removeEventListeners();return}v.setAttribute("tracked-controls",{hand:_.hand,idPrefix:y,orientationOffset:_.orientationOffset,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.wasControllerConnected&&this.checkIfControllerPresent()},onButtonChanged:function(v){var _=this.mapping.buttons[v.detail.id];_&&this.el.emit(_+"changed",v.detail.state)},onAxisMoved:function(v){m(this,this.mapping.axes,v)},initDefaultModel:function(){var v=this.modelEl=document.createElement("a-entity");v.setAttribute("geometry",{primitive:"sphere",radius:.03}),v.setAttribute("material",{color:this.data.color}),this.el.appendChild(v),this.el.emit("controllermodelready",{name:"generic-tracked-controller-controls",model:this.modelEl,rayOrigin:{origin:{x:0,y:0,z:-.01},direction:{x:0,y:0,z:-1}}})}})},"./src/components/geometry.js":(l,u,c)=>{var d=c("./src/core/geometry.js").geometries,p=c("./src/core/geometry.js").geometryNames,f=c("./src/core/component.js").registerComponent,m=c("./src/lib/three.js"),g=new m.BufferGeometry;l.exports.Component=f("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:p,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(y){var x=this.data,v=this.el,_,T=this.system;this.geometry&&(T.unuseGeometry(y),this.geometry=null),this.geometry=T.getOrCreateGeometry(x),_=v.getObject3D("mesh"),_?_.geometry=this.geometry:(_=new m.Mesh,_.geometry=this.geometry,this.el.getAttribute("material")||(_.material=new m.MeshStandardMaterial({color:Math.random()*16777215,metalness:0,roughness:.5})),v.setObject3D("mesh",_))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=g,this.geometry=null},updateSchema:function(y){var x=this.oldData&&this.oldData.primitive,v=y.primitive,_=d[v]&&d[v].schema;if(!_)throw new Error("Unknown geometry schema `"+v+"`");x&&x===v||this.extendSchema(_)}})},"./src/components/gltf-model.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),m=f.debug("components:gltf-model:warn");l.exports.Component=d("gltf-model",{schema:{type:"model"},init:function(){var g=this,y=this.system.getDRACOLoader(),x=this.system.getMeshoptDecoder(),v=this.system.getKTX2Loader();this.model=null,this.loader=new p.GLTFLoader,y&&this.loader.setDRACOLoader(y),x?this.ready=x.then(function(_){g.loader.setMeshoptDecoder(_)}):this.ready=Promise.resolve(),v&&this.loader.setKTX2Loader(v)},update:function(){var g=this,y=this.el,x=this.data;x&&(this.remove(),this.ready.then(function(){g.loader.load(x,function(v){g.model=v.scene||v.scenes[0],g.model.animations=v.animations,y.setObject3D("mesh",g.model),y.emit("model-loaded",{format:"gltf",model:g.model})},void 0,function(v){var _=v&&v.message?v.message:"Failed to load glTF model";m(_),y.emit("model-error",{format:"gltf",src:x})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},"./src/components/grabbable.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;d("grabbable",{init:function(){this.el.setAttribute("obb-collider","centerModel: true")}})},"./src/components/hand-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/constants/index.js").AFRAME_CDN_ROOT,f={toonLeft:p+"controllers/hands/leftHand.glb",toonRight:p+"controllers/hands/rightHand.glb",lowPolyLeft:p+"controllers/hands/leftHandLow.glb",lowPolyRight:p+"controllers/hands/rightHandLow.glb",highPolyLeft:p+"controllers/hands/leftHandHigh.glb",highPolyRight:p+"controllers/hands/rightHandHigh.glb"},m={open:"Open",point:"Point",pointThumb:"Point + Thumb",fist:"Fist",hold:"Hold",thumbUp:"Thumb Up"},g={};g[m.fist]="grip",g[m.thumbUp]="pistol",g[m.point]="pointing",l.exports.Component=d("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},after:["tracked-controls"],init:function(){var v=this,_=this.el;this.pressedButtons={},this.touchedButtons={},this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){v.handleButton("grip","down")},this.onGripUp=function(){v.handleButton("grip","up")},this.onTrackpadDown=function(){v.handleButton("trackpad","down")},this.onTrackpadUp=function(){v.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){v.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){v.handleButton("trackpad","touchend")},this.onTriggerDown=function(){v.handleButton("trigger","down")},this.onTriggerUp=function(){v.handleButton("trigger","up")},this.onTriggerTouchStart=function(){v.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){v.handleButton("trigger","touchend")},this.onGripTouchStart=function(){v.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){v.handleButton("grip","touchend")},this.onThumbstickDown=function(){v.handleButton("thumbstick","down")},this.onThumbstickUp=function(){v.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){v.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){v.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){v.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){v.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){v.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){v.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),_.addEventListener("controllerconnected",this.onControllerConnected),_.addEventListener("controllerdisconnected",this.onControllerDisconnected),_.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(v,_){var T=this.el.getObject3D("mesh");!T||!T.mixer||T.mixer.update(_/1e3)},onControllerConnected:function(){this.el.object3D.visible=!0},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var v=this.el;v.addEventListener("gripdown",this.onGripDown),v.addEventListener("gripup",this.onGripUp),v.addEventListener("trackpaddown",this.onTrackpadDown),v.addEventListener("trackpadup",this.onTrackpadUp),v.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),v.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),v.addEventListener("triggerdown",this.onTriggerDown),v.addEventListener("triggerup",this.onTriggerUp),v.addEventListener("triggertouchstart",this.onTriggerTouchStart),v.addEventListener("triggertouchend",this.onTriggerTouchEnd),v.addEventListener("griptouchstart",this.onGripTouchStart),v.addEventListener("griptouchend",this.onGripTouchEnd),v.addEventListener("thumbstickdown",this.onThumbstickDown),v.addEventListener("thumbstickup",this.onThumbstickUp),v.addEventListener("abuttontouchstart",this.onAorXTouchStart),v.addEventListener("abuttontouchend",this.onAorXTouchEnd),v.addEventListener("bbuttontouchstart",this.onBorYTouchStart),v.addEventListener("bbuttontouchend",this.onBorYTouchEnd),v.addEventListener("xbuttontouchstart",this.onAorXTouchStart),v.addEventListener("xbuttontouchend",this.onAorXTouchEnd),v.addEventListener("ybuttontouchstart",this.onBorYTouchStart),v.addEventListener("ybuttontouchend",this.onBorYTouchEnd),v.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),v.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var v=this.el;v.removeEventListener("gripdown",this.onGripDown),v.removeEventListener("gripup",this.onGripUp),v.removeEventListener("trackpaddown",this.onTrackpadDown),v.removeEventListener("trackpadup",this.onTrackpadUp),v.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),v.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),v.removeEventListener("triggerdown",this.onTriggerDown),v.removeEventListener("triggerup",this.onTriggerUp),v.removeEventListener("triggertouchstart",this.onTriggerTouchStart),v.removeEventListener("triggertouchend",this.onTriggerTouchEnd),v.removeEventListener("griptouchstart",this.onGripTouchStart),v.removeEventListener("griptouchend",this.onGripTouchEnd),v.removeEventListener("thumbstickdown",this.onThumbstickDown),v.removeEventListener("thumbstickup",this.onThumbstickUp),v.removeEventListener("abuttontouchstart",this.onAorXTouchStart),v.removeEventListener("abuttontouchend",this.onAorXTouchEnd),v.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),v.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),v.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),v.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),v.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),v.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),v.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),v.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(v){var _,T=this.el,w=this.data.hand,S=this.data.handModelStyle,R=this.data.color,B=this;if(_={hand:w,model:!1},w!==v){var I=f[S+w.charAt(0).toUpperCase()+w.slice(1)];this.loader.load(I,function(D){var L=D.scene.children[0],O=w==="left"?Math.PI/2:-Math.PI/2,U=T.sceneEl.hasWebXR?-Math.PI/2:0;L.mixer=new THREE.AnimationMixer(L),B.clips=D.animations,T.setObject3D("mesh",L),L.traverse(function(J){J.isMesh&&(J.material.color=new THREE.Color(R))}),L.position.set(0,0,0),L.rotation.set(U,0,O),T.setAttribute("magicleap-controls",_),T.setAttribute("vive-controls",_),T.setAttribute("oculus-touch-controls",_),T.setAttribute("pico-controls",_),T.setAttribute("windows-motion-controls",_),T.setAttribute("hp-mixed-reality-controls",_)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(v,_){var T,w=_==="down",S=_==="touchstart";if(_.indexOf("touch")===0){if(S===this.touchedButtons[v])return;this.touchedButtons[v]=S}else{if(w===this.pressedButtons[v])return;this.pressedButtons[v]=w}T=this.gesture,this.gesture=this.determineGesture(),this.gesture!==T&&(this.animateGesture(this.gesture,T),this.emitGestureEvents(this.gesture,T))},determineGesture:function(){var v,_=this.pressedButtons.grip,T=this.pressedButtons.surface||this.touchedButtons.surface,w=this.pressedButtons.trackpad||this.touchedButtons.trackpad,S=this.pressedButtons.trigger||this.touchedButtons.trigger,R=this.touchedButtons.AorX||this.touchedButtons.BorY,B=x(this.el.components["tracked-controls"]);return B?_||S?v=m.fist:w&&(v=m.point):_?T||R||w?v=S?m.fist:m.point:v=S?m.thumbUp:m.pointThumb:S&&(v=m.hold),v},getClip:function(v){var _,T;for(T=0;T<this.clips.length;T++)if(_=this.clips[T],_.name===v)return _},animateGesture:function(v,_){if(v){this.playAnimation(v||m.open,_,!1);return}this.playAnimation(_,_,!0)},emitGestureEvents:function(v,_){var T=this.el,w;_!==v&&(w=y(_,!1),w&&T.emit(w),w=y(v,!0),w&&T.emit(w))},playAnimation:function(v,_,T){var w,S,R=this.el.getObject3D("mesh"),B;if(R){if(w=this.getClip(v),B=R.mixer.clipAction(w),T){B.paused=!1,B.timeScale=-1;return}if(B.clampWhenFinished=!0,B.loop=THREE.LoopOnce,B.repetitions=0,B.timeScale=1,B.time=0,B.weight=1,!_){R.mixer.stopAllAction(),B.play();return}w=this.getClip(_),B.reset(),B.play(),S=R.mixer.clipAction(w),S.crossFadeTo(B,.15,!0)}}});function y(v,_){var T;if(v){if(T=g[v],T==="grip")return T+(_?"close":"open");if(T==="point")return T+(_?"up":"down");if(T==="pointing"||T==="pistol")return T+(_?"start":"end")}}function x(v){var _=v&&v.controller,T=_&&(_.id&&_.id.indexOf("OpenVR ")===0||_.profiles&&_.profiles[0]&&_.profiles[0]==="htc-vive");return T}},"./src/components/hand-tracking-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/core/a-entity.js").AEntity,f=c("./src/utils/tracked-controls.js"),m=f.checkControllerPresentAndSetup,g=c("./src/constants/index.js").AFRAME_CDN_ROOT,y=g+"controllers/oculus-hands/v4/left.glb",x=g+"controllers/oculus-hands/v4/right.glb",v=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],_=0,T=4,w=9,S=.015,R=.1;l.exports.Component=d("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"},modelOpacity:{default:1}},after:["tracked-controls"],bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var B=0;B<this.jointEls.length;++B)this.jointEls[B].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var B=0;B<this.jointEls.length;++B)this.jointEls[B].object3D.visible=!1},init:function(){var B=this.el.sceneEl,I=B.getAttribute("webxr"),D=I.optionalFeatures;D.indexOf("hand-tracking")===-1&&(D.push("hand-tracking"),B.setAttribute("webxr",I)),this.wristObject3D=new THREE.Object3D,this.el.sceneEl.object3D.add(this.wristObject3D),this.onModelLoaded=this.onModelLoaded.bind(this),this.onChildAttached=this.onChildAttached.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new THREE.Vector3,wristRotation:new THREE.Quaternion},this.indexTipPosition=new THREE.Vector3,this.hasPoses=!1,this.jointPoses=new Float32Array(16*v.length),this.jointRadii=new Float32Array(v.length),this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace),this.el.addEventListener("child-attached",this.onChildAttached),this.el.object3D.visible=!1,this.wristObject3D.visible=!1},onChildAttached:function(B){this.addChildEntity(B.detail.el)},update:function(){this.updateModelMaterial()},updateModelMaterial:function(){var B=this.jointEls,I=this.skinnedMesh,D=this.data.modelOpacity!==1;I&&(this.skinnedMesh.material.color.set(this.data.modelColor),this.skinnedMesh.material.transparent=D,this.skinnedMesh.material.opacity=this.data.modelOpacity);for(var L=0;L<B.length;L++)B[L].setAttribute("material",{color:this.data.modelColor,transparent:D,opacity:this.data.modelOpacity})},updateReferenceSpace:function(){var B=this,I=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,!!I){var D=B.el.sceneEl.systems.webxr.sessionReferenceSpaceType;I.requestReferenceSpace(D).then(function(L){B.referenceSpace=L}).catch(function(L){throw B.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(D,"tracked-controls-webxr uses reference space "+D),L})}},checkIfControllerPresent:function(){var B=this.data,I=B.hand?B.hand:void 0;m(this,"",{hand:I,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var B=this.el.sceneEl,I=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,D=B.frame,L=this.el.components["tracked-controls-webxr"],O=this.referenceSpace;!I||!D||!O||!L||(this.hasPoses=!1,I.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),this.hasPoses=D.fillPoses(I.hand.values(),O,this.jointPoses)&&D.fillJointRadii(I.hand.values(),this.jointRadii),this.updateHandModel(),this.detectGesture(),this.updateWristObject()))},updateWristObject:function(){var B=new THREE.Matrix4;return function(){var I=this.wristObject3D;!I||!this.hasPoses||(B.fromArray(this.jointPoses,_*16),I.position.setFromMatrixPosition(B),I.quaternion.setFromRotationMatrix(B))}}(),updateHandModel:function(){this.data.modelStyle==="dots"&&this.updateHandDotsModel(),this.data.modelStyle==="mesh"&&this.updateHandMeshModel()},getBone:function(B){for(var I=this.bones,D=0;D<I.length;D++)if(I[D].name===B)return I[D];return null},updateHandMeshModel:function(){var B=new THREE.Matrix4;return function(){var I=0,D=this.jointPoses,L=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller;if(!(!L||!this.mesh)&&(this.mesh.visible=!1,!!this.hasPoses))for(var O of L.hand.values()){var U=this.getBone(O.jointName);U!=null&&(this.mesh.visible=!0,B.fromArray(D,I*16),U.position.setFromMatrixPosition(B),U.quaternion.setFromRotationMatrix(B)),I++}}}(),updateHandDotsModel:function(){for(var B=this.jointPoses,I=this.jointRadii,D=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,L,O,U=0;U<D.hand.size;U++)L=this.jointEls[U],O=L.object3D,L.object3D.visible=this.hasPoses,this.hasPoses&&(O.matrix.fromArray(B,U*16),O.matrix.decompose(O.position,O.rotation,O.scale),L.setAttribute("scale",{x:I[U],y:I[U],z:I[U]}))},detectGesture:function(){this.detectPinch()},detectPinch:function(){var B=new THREE.Vector3,I=new THREE.Matrix4;return function(){var D=this.indexTipPosition,L=this.pinchEventDetail;if(this.hasPoses){B.setFromMatrixPosition(I.fromArray(this.jointPoses,T*16)),D.setFromMatrixPosition(I.fromArray(this.jointPoses,w*16)),L.wristRotation.setFromRotationMatrix(I.fromArray(this.jointPoses,_*16));var O=D.distanceTo(B);O<S&&this.isPinched===!1&&(this.isPinched=!0,this.pinchDistance=O,L.position.copy(D).add(B).multiplyScalar(.5),this.el.emit("pinchstarted",L)),O>this.pinchDistance+this.pinchDistance*R&&this.isPinched===!0&&(this.isPinched=!1,L.position.copy(D).add(B).multiplyScalar(.5),this.el.emit("pinchended",L)),this.isPinched&&(L.position.copy(D).add(B).multiplyScalar(.5),this.el.emit("pinchmoved",L))}}}(),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var B=this.el,I=this.data;if(B.setAttribute("tracked-controls",{id:"",hand:I.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.mesh){this.mesh!==B.getObject3D("mesh")&&B.setObject3D("mesh",this.mesh);return}this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var B=this.el,I;this.checkIfControllerPresent(),I=B.components["tracked-controls"]&&B.components["tracked-controls"].controller,this.mesh&&I&&I.hand&&I.hand instanceof XRHand&&B.setObject3D("mesh",this.mesh)},initDefaultModel:function(){var B=this.data;B.modelStyle==="dots"&&this.initDotsModel(),B.modelStyle==="mesh"&&this.initMeshHandModel(),this.el.object3D.visible=!0,this.wristObject3D.visible=!0},initDotsModel:function(){if(this.jointEls.length===0){for(var B=0;B<v.length;++B){var I=this.jointEl=document.createElement("a-entity");I.setAttribute("geometry",{primitive:"sphere",radius:1}),I.object3D.visible=!1,this.el.appendChild(I),this.jointEls.push(I)}this.updateModelMaterial()}},initMeshHandModel:function(){var B=this.data.hand==="left"?y:x;this.el.setAttribute("gltf-model",B)},onModelLoaded:function(){var B=this.mesh=this.el.getObject3D("mesh").children[0],I=this.skinnedMesh=B.getObjectByProperty("type","SkinnedMesh");this.skinnedMesh&&(this.bones=I.skeleton.bones,this.el.removeObject3D("mesh"),B.position.set(0,0,0),B.rotation.set(0,0,0),I.frustumCulled=!1,I.material=new THREE.MeshStandardMaterial,this.updateModelMaterial(),this.setupChildrenEntities(),this.el.setObject3D("mesh",B))},setupChildrenEntities:function(){for(var B=this.el.children,I=0;I<B.length;++I)B[I]instanceof p&&this.addChildEntity(B[I])},addChildEntity:function(B){B instanceof p&&this.wristObject3D.add(B.object3D)}})},"./src/components/hand-tracking-grab-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");d("hand-tracking-grab-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},color:{type:"color",default:"white"},hoverColor:{type:"color",default:"#538df1"},hoverEnabled:{default:!1}},init:function(){var f=this.el,m=this.data,g;m.hand==="right"?g="components.hand-tracking-controls.bones.3":g="components.hand-tracking-controls.bones.21",f.setAttribute("hand-tracking-controls",{hand:m.hand}),f.setAttribute("obb-collider",{trackedObject3D:g,size:.04}),this.auxMatrix=new p.Matrix4,this.auxQuaternion=new p.Quaternion,this.auxQuaternion2=new p.Quaternion,this.auxVector=new p.Vector3,this.auxVector2=new p.Vector3,this.grabbingObjectPosition=new p.Vector3,this.grabbedObjectPosition=new p.Vector3,this.grabbedObjectPositionDelta=new p.Vector3,this.grabDeltaPosition=new p.Vector3,this.grabInitialRotation=new p.Quaternion,this.onCollisionStarted=this.onCollisionStarted.bind(this),this.el.addEventListener("obbcollisionstarted",this.onCollisionStarted),this.onCollisionEnded=this.onCollisionEnded.bind(this),this.el.addEventListener("obbcollisionended",this.onCollisionEnded),this.onPinchStarted=this.onPinchStarted.bind(this),this.el.addEventListener("pinchstarted",this.onPinchStarted),this.onPinchEnded=this.onPinchEnded.bind(this),this.el.addEventListener("pinchended",this.onPinchEnded),this.onPinchMoved=this.onPinchMoved.bind(this),this.el.addEventListener("pinchmoved",this.onPinchMoved)},transferEntityOwnership:function(){for(var f,m=this.el.sceneEl.querySelectorAll("[hand-tracking-grab-controls]"),g=0;g<m.length;++g)f=m[g].components["hand-tracking-grab-controls"],f!==this&&this.grabbedEl&&this.grabbedEl===f.grabbedEl&&f.releaseGrabbedEntity();return!1},onCollisionStarted:function(f){var m=f.detail.withEl;this.collidedEl||m.getAttribute("grabbable")&&(this.collidedEl=m,this.grabbingObject3D=f.detail.trackedObject3D,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.hoverColor))},onCollisionEnded:function(){this.collidedEl=void 0,!this.grabbedEl&&(this.grabbingObject3D=void 0,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.color))},onPinchStarted:function(f){this.collidedEl&&(this.pinchPosition=f.detail.position,this.wristRotation=f.detail.wristRotation,this.grabbedEl=this.collidedEl,this.transferEntityOwnership(),this.grab())},onPinchEnded:function(){this.releaseGrabbedEntity()},onPinchMoved:function(f){this.wristRotation=f.detail.wristRotation},releaseGrabbedEntity:function(){var f=this.grabbedEl;f&&(f.object3D.updateMatrixWorld=this.originalUpdateMatrixWorld,f.object3D.matrixAutoUpdate=!0,f.object3D.matrixWorldAutoUpdate=!0,f.object3D.matrixWorld.decompose(this.auxVector,this.auxQuaternion,this.auxVector2),f.object3D.position.copy(this.auxVector),f.object3D.quaternion.copy(this.auxQuaternion),this.el.emit("grabended",{grabbedEl:f}),this.grabbedEl=void 0)},grab:function(){var f=this.grabbedEl,m;m=f.object3D.getWorldPosition(this.grabbedObjectPosition),this.grabDeltaPosition.copy(m).sub(this.pinchPosition),this.grabInitialRotation.copy(this.auxQuaternion.copy(this.wristRotation).invert()),this.originalUpdateMatrixWorld=f.object3D.updateMatrixWorld,f.object3D.updateMatrixWorld=function(){},f.object3D.updateMatrixWorldChildren=function(g){for(var y=this.children,x=0,v=y.length;x<v;x++){var _=y[x];(_.matrixWorldAutoUpdate===!0||g===!0)&&_.updateMatrixWorld(!0)}},f.object3D.matrixAutoUpdate=!1,f.object3D.matrixWorldAutoUpdate=!1,this.el.emit("grabstarted",{grabbedEl:f})},tock:function(){var f=this.auxMatrix,m=this.auxQuaternion,g=this.auxQuaternion2,y,x=this.grabbedEl;x&&(y=x.object3D,y.getWorldQuaternion(g),y.matrixWorld.identity(),f.identity(),f.makeTranslation(this.pinchPosition),y.matrixWorld.multiply(f),f.identity(),f.makeRotationFromQuaternion(m.copy(this.wristRotation).multiply(this.grabInitialRotation)),y.matrixWorld.multiply(f),f.identity(),f.makeTranslation(this.grabDeltaPosition),y.matrixWorld.multiply(f),f.identity(),f.makeRotationFromQuaternion(g),y.matrixWorld.multiply(f),f.makeScale(x.object3D.scale.x,x.object3D.scale.y,x.object3D.scale.z),y.matrixWorld.multiply(f),y.updateMatrixWorldChildren())}})},"./src/components/hide-on-enter-ar.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("hide-on-enter-ar",{init:function(){var p=this;this.el.sceneEl.addEventListener("enter-vr",function(){p.el.sceneEl.is("ar-mode")&&(p.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){p.el.object3D.visible=!0})}})},"./src/components/hide-on-enter-vr.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("hide-on-enter-vr",{init:function(){var p=this;this.el.sceneEl.addEventListener("enter-vr",function(){p.el.sceneEl.is("vr-mode")&&(p.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){p.el.object3D.visible=!0})}})},"./src/components/hp-mixed-reality-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),m=f.checkControllerPresentAndSetup,g=f.emitIfAxesChanged,y=f.onButtonEvent,x="hp-mixed-reality",v=c("./src/constants/index.js").AFRAME_CDN_ROOT,_=v+"controllers/hp/mixed-reality/",T={x:0,y:0,z:.06},w={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"},S={left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}};l.exports.Component=d("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:S,init:function(){var R=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(B){y(B.detail.id,"down",R,R.data.hand)},this.onButtonUp=function(B){y(B.detail.id,"up",R,R.data.hand)},this.onButtonTouchEnd=function(B){y(B.detail.id,"touchend",R,R.data.hand)},this.onButtonTouchStart=function(B){y(B.detail.id,"touchstart",R,R.data.hand)},this.previousButtonValues={},this.bindMethods()},update:function(){var R=this.data;this.controllerIndex=R.hand==="right"?0:R.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var R=this.el;R.addEventListener("buttonchanged",this.onButtonChanged),R.addEventListener("buttondown",this.onButtonDown),R.addEventListener("buttonup",this.onButtonUp),R.addEventListener("touchstart",this.onButtonTouchStart),R.addEventListener("touchend",this.onButtonTouchEnd),R.addEventListener("axismove",this.onAxisMoved),R.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var R=this.el;R.removeEventListener("buttonchanged",this.onButtonChanged),R.removeEventListener("buttondown",this.onButtonDown),R.removeEventListener("buttonup",this.onButtonUp),R.removeEventListener("touchstart",this.onButtonTouchStart),R.removeEventListener("touchend",this.onButtonTouchEnd),R.removeEventListener("axismove",this.onAxisMoved),R.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var R=this.data;m(this,x,{index:this.controllerIndex,hand:R.hand})},injectTrackedControls:function(){var R=this.el,B=this.data;R.setAttribute("tracked-controls",{idPrefix:x,hand:B.hand,controller:this.controllerIndex,orientationOffset:B.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",_+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(R){var B=this.mapping[this.data.hand].buttons[R.detail.id],I;B&&(B==="trigger"&&(I=R.detail.state.value,console.log("analog value of trigger press: "+I)),this.el.emit(B+"changed",R.detail.state))},onModelLoaded:function(R){var B=R.detail.model;this.data.model&&(B.position.copy(T),B.rotation.copy(w),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new p.Vector3(0,0,0)}))},onAxisMoved:function(R){g(this,this.mapping.axes,R)}})},"./src/components/index.js":(l,u,c)=>{c("./src/components/animation.js"),c("./src/components/anchored.js"),c("./src/components/camera.js"),c("./src/components/cursor.js"),c("./src/components/geometry.js"),c("./src/components/generic-tracked-controller-controls.js"),c("./src/components/gltf-model.js"),c("./src/components/grabbable.js"),c("./src/components/hand-tracking-controls.js"),c("./src/components/hand-tracking-grab-controls.js"),c("./src/components/hand-controls.js"),c("./src/components/hide-on-enter-ar.js"),c("./src/components/hide-on-enter-vr.js"),c("./src/components/hp-mixed-reality-controls.js"),c("./src/components/layer.js"),c("./src/components/laser-controls.js"),c("./src/components/light.js"),c("./src/components/line.js"),c("./src/components/link.js"),c("./src/components/look-controls.js"),c("./src/components/magicleap-controls.js"),c("./src/components/material.js"),c("./src/components/obb-collider.js"),c("./src/components/obj-model.js"),c("./src/components/oculus-go-controls.js"),c("./src/components/oculus-touch-controls.js"),c("./src/components/pico-controls.js"),c("./src/components/position.js"),c("./src/components/raycaster.js"),c("./src/components/rotation.js"),c("./src/components/scale.js"),c("./src/components/shadow.js"),c("./src/components/sound.js"),c("./src/components/text.js"),c("./src/components/tracked-controls.js"),c("./src/components/tracked-controls-webvr.js"),c("./src/components/tracked-controls-webxr.js"),c("./src/components/visible.js"),c("./src/components/valve-index-controls.js"),c("./src/components/vive-controls.js"),c("./src/components/vive-focus-controls.js"),c("./src/components/wasd-controls.js"),c("./src/components/windows-motion-controls.js"),c("./src/components/scene/ar-hit-test.js"),c("./src/components/scene/background.js"),c("./src/components/scene/debug.js"),c("./src/components/scene/device-orientation-permission-ui.js"),c("./src/components/scene/embedded.js"),c("./src/components/scene/inspector.js"),c("./src/components/scene/fog.js"),c("./src/components/scene/keyboard-shortcuts.js"),c("./src/components/scene/pool.js"),c("./src/components/scene/real-world-meshing.js"),c("./src/components/scene/reflection.js"),c("./src/components/scene/screenshot.js"),c("./src/components/scene/stats.js"),c("./src/components/scene/xr-mode-ui.js")},"./src/components/laser-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js");d("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var f=this.config,m=this.data,g=this.el,y=this,x={hand:m.hand,model:m.model};g.setAttribute("hp-mixed-reality-controls",x),g.setAttribute("magicleap-controls",x),g.setAttribute("oculus-go-controls",x),g.setAttribute("oculus-touch-controls",x),g.setAttribute("pico-controls",x),g.setAttribute("valve-index-controls",x),g.setAttribute("vive-controls",x),g.setAttribute("vive-focus-controls",x),g.setAttribute("windows-motion-controls",x),g.setAttribute("generic-tracked-controller-controls",{hand:x.hand}),g.addEventListener("controllerconnected",v),g.addEventListener("controllerdisconnected",_),g.addEventListener("controllermodelready",function(T){v(T),y.modelReady=!0});function v(T){var w=f[T.detail.name];if(w){var S=p.extend({showLine:!0},w.raycaster||{});T.detail.rayOrigin&&(S.origin=T.detail.rayOrigin.origin,S.direction=T.detail.rayOrigin.direction,S.showLine=!0),T.detail.rayOrigin||!y.modelReady?g.setAttribute("raycaster",S):g.setAttribute("raycaster","showLine",!0),g.setAttribute("cursor",p.extend({fuse:!1},w.cursor))}}function _(T){var w=f[T.detail.name];w&&g.setAttribute("raycaster","showLine",!1)}},config:{"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"pico-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},"./src/components/layer.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js"),f=p.debug("components:layer:warn");l.exports.Component=d("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var g=this.el.sceneEl.renderer.getContext();this.quaternion=new THREE.Quaternion,this.position=new THREE.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=g.createFramebuffer();var y=this.el.sceneEl.getAttribute("webxr"),x=y.requiredFeatures;x.indexOf("layers")===-1&&(x.push("layers"),this.el.sceneEl.setAttribute("webxr",y)),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(g){this.data.src!==g.src&&this.updateSrc()},updateSrc:function(){var g=this.data.type;if(this.texture=void 0,g==="quad"){this.loadQuadImage();return}if(g==="monocubemap"||g==="stereocubemap"){this.loadCubeMapImages();return}},loadCubeMapImages:function(){var g,y=this.xrGLFactory,x=this.el.sceneEl.frame,v=this.data.src,_=this.data.type;this.visibilityChanged=!1,this.layer&&(_!=="monocubemap"&&_!=="stereocubemap"||(v.complete?this.pendingCubeMapUpdate=!1:this.pendingCubeMapUpdate=!0,this.loadingScreen?this.loadingScreen=!1:this.loadingScreen=!0,_==="monocubemap"?(g=y.getSubImage(this.layer,x),this.loadCubeMapImage(g.colorTexture,v,0)):(g=y.getSubImage(this.layer,x,"left"),this.loadCubeMapImage(g.colorTexture,v,0),g=y.getSubImage(this.layer,x,"right"),this.loadCubeMapImage(g.colorTexture,v,6))))},loadQuadImage:function(){var g=this.data.src,y=this;this.el.sceneEl.systems.material.loadTexture(g,{src:g},function(x){y.el.sceneEl.renderer.initTexture(x),y.texture=x,g.tagName==="VIDEO"&&setTimeout(function(){y.textureIsVideo=!0},1e3),y.layer&&(y.layer.height=y.data.height/2||y.texture.image.height/1e3,y.layer.width=y.data.width/2||y.texture.image.width/1e3,y.needsRedraw=!0),y.updateQuadPanel()})},preGenerateCubeMapTextures:function(g,y){this.data.type==="monocubemap"?this.generateCubeMapTextures(g,0,y):(this.generateCubeMapTextures(g,0,y),this.generateCubeMapTextures(g,6,y))},generateCubeMapTextures:function(g,y,x){for(var v=this.data,_=this.cubeFaceSize,T=Math.min(g.width,g.height),w=[],S,R,B=0;B<6;B++){var I=document.createElement("CANVAS");I.width=I.height=_;var D=I.getContext("2d");v.rotateCubemap&&(B===2||B===3)&&(D.save(),D.translate(_,_),D.rotate(Math.PI)),D.drawImage(g,(B+y)*T,0,T,T,0,0,_,_),D.restore(),x&&x(),w.push(I)}return v.rotateCubemap&&(S=w[0],R=w[1],w[0]=R,w[1]=S,S=w[4],R=w[5],w[4]=R,w[5]=S),x&&x(),w},loadCubeMapImage:function(g,y,x){var v=this.el.sceneEl.renderer.getContext(),_;v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1),v.bindTexture(v.TEXTURE_CUBE_MAP,g),!y.complete||this.loadingScreen?_=this.loadingScreenImages:_=this.generateCubeMapTextures(y,x);var T=0;_.forEach(function(w,S){v.texSubImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,0,0,v.RGBA,v.UNSIGNED_BYTE,w),T=v.getError()}),T!==0&&console.log("renderingError, WebGL Error Code: "+T),v.bindTexture(v.TEXTURE_CUBE_MAP,null)},tick:function(){this.el.sceneEl.xrSession&&(!this.layer&&(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),!(!this.needsRedraw&&!this.layer.needsRedraw&&!this.textureIsVideo)&&(this.data.type==="quad"&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var g=this,y=this.data.type;if(this.el.sceneEl.xrSession.onvisibilitychange=function(x){g.visibilityChanged=x.session.visibilityState!=="hidden"},y==="quad"){this.initQuadLayer();return}if(y==="monocubemap"||y==="stereocubemap"){this.initCubeMapLayer();return}},initQuadLayer:function(){var g=this.el.sceneEl,y=g.renderer.getContext(),x=this.xrGLFactory=new XRWebGLBinding(g.xrSession,y);this.texture&&(this.layer=x.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),g.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var g=this.data.src,y=this.el.sceneEl,x=y.renderer.getContext(),v=x.getParameter(x.MAX_CUBE_MAP_TEXTURE_SIZE),_=this.cubeFaceSize=Math.min(v,Math.min(g.width,g.height)),T=this.xrGLFactory=new XRWebGLBinding(y.xrSession,x);this.layer=T.createCubeLayer({space:this.referenceSpace,viewPixelWidth:_,viewPixelHeight:_,layout:this.data.type==="monocubemap"?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),y.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var g=this.cubeFaceSize,y=this.loadingScreenImages=[],x=0;x<6;x++){var v=document.createElement("CANVAS");v.width=v.height=g;var _=v.getContext("2d");v.width=v.height=g,_.fillStyle="black",_.fillRect(0,0,g,g),x!==2&&x!==3&&(_.translate(g,0),_.scale(-1,1),_.fillStyle="white",_.font="30px Arial",_.fillText("Loading",g/2,g/2)),y.push(v)}},destroyLayer:function(){this.layer&&(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(g){this.layerEnabled=g,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var g=this.quadPanelEl;this.quadPanelEl||(g=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(g)),g.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),g.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var g=this.el.sceneEl,y=this.el.sceneEl.renderer.getContext(),x=this.xrGLFactory.getSubImage(this.layer,g.frame),v=g.renderer.properties.get(this.texture).__webglTexture,_=y.getParameter(y.FRAMEBUFFER_BINDING);y.viewport(x.viewport.x,x.viewport.y,x.viewport.width,x.viewport.height),y.bindFramebuffer(y.FRAMEBUFFER,this.frameBuffer),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,x.colorTexture,0),m(y,v,x,this.data.src),y.bindFramebuffer(y.FRAMEBUFFER,_)},updateTransform:function(){var g=this.el,y=this.position,x=this.quaternion;g.object3D.updateMatrixWorld(),y.setFromMatrixPosition(g.object3D.matrixWorld),x.setFromRotationMatrix(g.object3D.matrixWorld),this.layerEnabled||y.set(0,0,1e8),this.layer.transform=new XRRigidTransform(y,x)},onEnterVR:function(){var g=this.el.sceneEl,y=g.xrSession;if(!g.hasWebXR||!XRWebGLBinding||!y){f("The layer component requires WebXR and the layers API enabled");return}y.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(g){this.referenceSpace=g}});function m(g,y,x,v){var _=g.createFramebuffer(),T=x.viewport.x,w=x.viewport.y,S=x.viewport.x+x.viewport.width,R=x.viewport.y+x.viewport.height;v.tagName==="VIDEO"&&(g.bindTexture(g.TEXTURE_2D,y),g.texSubImage2D(g.TEXTURE_2D,0,0,0,v.width,v.height,g.RGB,g.UNSIGNED_BYTE,v)),g.bindFramebuffer(g.READ_FRAMEBUFFER,_),g.framebufferTexture2D(g.READ_FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,y,0),g.readBuffer(g.COLOR_ATTACHMENT0),g.blitFramebuffer(0,0,v.width,v.height,T,w,S,R,g.COLOR_BUFFER_BIT,g.NEAREST),g.bindFramebuffer(g.READ_FRAMEBUFFER,null),g.deleteFramebuffer(_)}},"./src/components/light.js":(l,u,c)=>{var d=c("./src/utils/index.js"),p=d.diff,f=c("./src/utils/debug.js"),m=c("./src/core/component.js").registerComponent,g=c("./src/lib/three.js"),y=c("./src/utils/math.js"),x=g.MathUtils.degToRad,v=f("components:light:warn"),_=new g.CubeTextureLoader,T={};l.exports.Component=m("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowCameraAutomatic:{default:"",if:{type:["directional"]}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var w=this.el;this.light=null,this.defaultTarget=null,this.system.registerLight(w)},update:function(w){var S=this.data,R=p(S,w),B=this.light,I=this;if(B&&!("type"in R)){var D=!1;Object.keys(R).forEach(function(L){var O=S[L];switch(L){case"color":{B.color.set(O);break}case"groundColor":{B.groundColor.set(O);break}case"angle":{B.angle=x(O);break}case"target":{O===null?(S.type==="spot"||S.type==="directional")&&(B.target=I.defaultTarget):O.hasLoaded?I.onSetTarget(O,B):O.addEventListener("loaded",I.onSetTarget.bind(I,O,B));break}case"envMap":I.updateProbeMap(S,B);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":D||(I.updateShadow(),D=!0);break;case"shadowCameraAutomatic":S.shadowCameraAutomatic?I.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(S.shadowCameraAutomatic)):I.shadowCameraAutomaticEls=[];break;default:B[L]=O}});return}this.setLight(this.data),this.updateShadow()},tick:function(){var w=new g.Box3,S=new g.Vector3,R=new g.Vector3,B=new g.Matrix4,I=new g.Sphere,D=new g.Vector3;return function(){if(this.data.type==="directional"&&this.light.shadow&&this.light.shadow.camera instanceof g.OrthographicCamera&&this.shadowCameraAutomaticEls.length){var L=this.light.shadow.camera;L.getWorldDirection(S),L.getWorldPosition(R),B.copy(L.matrixWorld),B.invert(),L.near=1,L.left=1e5,L.right=-1e5,L.top=-1e5,L.bottom=1e5,this.shadowCameraAutomaticEls.forEach(function(O){w.setFromObject(O.object3D),w.getBoundingSphere(I);var U=y.distanceOfPointFromPlane(R,S,I.center),J=y.nearestPointInPlane(R,S,I.center,D),H=J.applyMatrix4(B);L.near=Math.min(-U-I.radius-1,L.near),L.left=Math.min(-I.radius+H.x,L.left),L.right=Math.max(I.radius+H.x,L.right),L.top=Math.max(I.radius+H.y,L.top),L.bottom=Math.min(-I.radius+H.y,L.bottom)}),L.updateProjectionMatrix()}}}(),setLight:function(w){var S=this.el,R=this.getLight(w);R&&(this.light&&S.removeObject3D("light"),this.light=R,this.light.el=S,S.setObject3D("light",this.light),(w.type==="spot"||w.type==="directional"||w.type==="hemisphere")&&S.getObject3D("light").translateY(-1),w.type==="spot"&&(S.setObject3D("light-target",this.defaultTarget),S.getObject3D("light-target").position.set(0,0,-1)),w.shadowCameraAutomatic?this.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(w.shadowCameraAutomatic)):this.shadowCameraAutomaticEls=[])},updateShadow:function(){var w=this.el,S=this.data,R=this.light;R.castShadow=S.castShadow;var B=w.getObject3D("cameraHelper");if(S.shadowCameraVisible&&!B?w.setObject3D("cameraHelper",new g.CameraHelper(R.shadow.camera)):!S.shadowCameraVisible&&B&&w.removeObject3D("cameraHelper"),!S.castShadow)return R;R.shadow.bias=S.shadowBias,R.shadow.radius=S.shadowRadius,R.shadow.mapSize.height=S.shadowMapHeight,R.shadow.mapSize.width=S.shadowMapWidth,R.shadow.camera.near=S.shadowCameraNear,R.shadow.camera.far=S.shadowCameraFar,R.shadow.camera instanceof g.OrthographicCamera?(R.shadow.camera.top=S.shadowCameraTop,R.shadow.camera.right=S.shadowCameraRight,R.shadow.camera.bottom=S.shadowCameraBottom,R.shadow.camera.left=S.shadowCameraLeft):R.shadow.camera.fov=S.shadowCameraFov,R.shadow.camera.updateProjectionMatrix(),B&&B.update()},getLight:function(w){var S=w.angle,R=new g.Color(w.color);R=R.getHex();var B=w.decay,I=w.distance,D=new g.Color(w.groundColor);D=D.getHex();var L=w.intensity,O=w.type,U=w.target,J=null;switch(O.toLowerCase()){case"ambient":return new g.AmbientLight(R,L);case"directional":return J=new g.DirectionalLight(R,L),this.defaultTarget=J.target,U&&(U.hasLoaded?this.onSetTarget(U,J):U.addEventListener("loaded",this.onSetTarget.bind(this,U,J))),J;case"hemisphere":return new g.HemisphereLight(R,D,L);case"point":return new g.PointLight(R,L,I,B);case"spot":return J=new g.SpotLight(R,L,I,x(S),w.penumbra,B),this.defaultTarget=J.target,U&&(U.hasLoaded?this.onSetTarget(U,J):U.addEventListener("loaded",this.onSetTarget.bind(this,U,J))),J;case"probe":return J=new g.LightProbe,this.updateProbeMap(w,J),J;default:v("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",O)}},updateProbeMap:function(w,S){w.envMap||S.copy(new g.LightProbe),T[w.envMap]instanceof window.Promise&&T[w.envMap].then(function(R){S.copy(R)}),T[w.envMap]instanceof g.LightProbe&&S.copy(T[w.envMap]),T[w.envMap]=new window.Promise(function(R){d.srcLoader.validateCubemapSrc(w.envMap,function(B){_.load(B,function(I){var D=g.LightProbeGenerator.fromCubeTexture(I);T[w.envMap]=D,S.copy(D)})})})},onSetTarget:function(w,S){S.target=w.object3D},remove:function(){var w=this.el;w.removeObject3D("light"),w.getObject3D("cameraHelper")&&w.removeObject3D("cameraHelper")}})},"./src/components/line.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var f=this.data,m,g;g=this.material=new THREE.LineBasicMaterial({color:f.color,opacity:f.opacity,transparent:f.opacity<1,visible:f.visible}),m=this.geometry=new THREE.BufferGeometry,m.setAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.line=new THREE.Line(m,g),this.el.setObject3D(this.attrName,this.line)},update:function(f){var m=this.data,g=this.geometry,y=!1,x=this.material,v=g.attributes.position.array;p(m.start,f.start)||(v[0]=m.start.x,v[1]=m.start.y,v[2]=m.start.z,y=!0),p(m.end,f.end)||(v[3]=m.end.x,v[4]=m.end.y,v[5]=m.end.z,y=!0),y&&(g.attributes.position.needsUpdate=!0,g.computeBoundingSphere()),x.color.setStyle(m.color),x.opacity=m.opacity,x.transparent=m.opacity<1,x.visible=m.visible},remove:function(){this.el.removeObject3D(this.attrName,this.line)}});function p(f,m){return!f||!m?!1:f.x===m.x&&f.y===m.y&&f.z===m.z}},"./src/components/link.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/core/shader.js").registerShader,f=c("./src/lib/three.js");l.exports.Component=d("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new f.Quaternion,this.hiddenEls=[]},update:function(m){var g=this.data,y=this.el,x,v;g.visualAspectEnabled&&(this.initVisualAspect(),x=g.highlighted?g.highlightedColor:g.backgroundColor,v=g.highlighted?g.highlightedColor:g.borderColor,y.setAttribute("material","backgroundColor",x),y.setAttribute("material","strokeColor",v),g.on!==m.on&&this.updateEventListener(),m.peekMode!==void 0&&g.peekMode!==m.peekMode&&this.updatePeekMode(),!(!g.image||m.image===g.image)&&y.setAttribute("material","pano",typeof g.image=="string"?g.image:g.image.src))},updatePeekMode:function(){var m=this.el,g=this.sphereEl;this.data.peekMode?(this.hideAll(),m.getObject3D("mesh").visible=!1,g.setAttribute("visible",!0)):(this.showAll(),m.getObject3D("mesh").visible=!0,g.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var m=this.el;m.isPlaying&&(this.removeEventListener(),m.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var m=this.data.on;m&&this.el.removeEventListener(m,this.navigate)},initVisualAspect:function(){var m=this.el,g,y,x;!this.data.visualAspectEnabled||this.visualAspectInitialized||(x=this.textEl=this.textEl||document.createElement("a-entity"),y=this.sphereEl=this.sphereEl||document.createElement("a-entity"),g=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),m.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),m.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"}),x.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),x.setAttribute("position","0 1.5 0"),m.appendChild(x),g.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),g.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),g.setAttribute("rotation","0 180 0"),g.setAttribute("position","0 0 0"),g.setAttribute("visible",!1),m.appendChild(g),y.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),y.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),y.setAttribute("visible",!1),m.appendChild(y),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:function(){var m=new f.Vector3,g=new f.Vector3,y=new f.Quaternion,x=new f.Vector3;return function(){var v=this.el,_=v.object3D,T=v.sceneEl.camera,w,S,R=this.textEl;if(this.data.visualAspectEnabled)if(_.updateMatrixWorld(),T.parent.updateMatrixWorld(),T.updateMatrixWorld(),_.matrix.decompose(g,y,x),g.setFromMatrixPosition(_.matrixWorld),m.setFromMatrixPosition(T.matrixWorld),S=g.distanceTo(m),S>20)this.previousQuaternion||(this.quaternionClone.copy(y),this.previousQuaternion=this.quaternionClone),_.lookAt(m);else{if(w=this.calculateCameraPortalOrientation(),S<.5){if(this.semiSphereEl.getAttribute("visible")===!0)return;R.setAttribute("text","width",1.5),w<=0?(R.setAttribute("position","0 0 0.75"),R.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(R.setAttribute("position","0 0 -0.75"),R.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),v.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=w}else w<=0?R.setAttribute("rotation","0 180 0"):R.setAttribute("rotation","0 0 0"),R.setAttribute("text","width",5),R.setAttribute("position","0 1.5 0"),v.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(_.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}}(),hideAll:function(){var m=this.el,g=this.hiddenEls,y=this;g.length>0||m.sceneEl.object3D.traverse(function(x){x&&x.el&&x.el.hasAttribute("link-controls")||!x.el||x===m.sceneEl.object3D||x.el===m||x.el===y.sphereEl||x.el===m.sceneEl.cameraEl||x.el.getAttribute("visible")===!1||x.el===y.textEl||x.el===y.semiSphereEl||(x.el.setAttribute("visible",!1),g.push(x.el))})},showAll:function(){this.hiddenEls.forEach(function(m){m.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:function(){var m=new f.Matrix4,g=new f.Vector3,y=new f.Vector3(0,0,1),x=new f.Vector3(0,0,0);return function(){var v=this.el,_=v.sceneEl.camera;return g.set(0,0,0),y.set(0,0,1),x.set(0,0,0),v.object3D.matrixWorld.extractRotation(m),y.applyMatrix4(m),v.object3D.updateMatrixWorld(),v.object3D.localToWorld(x),_.parent.parent.updateMatrixWorld(),_.parent.updateMatrixWorld(),_.updateMatrixWorld(),_.localToWorld(g),g.sub(x).normalize(),y.normalize(),Math.sign(y.dot(g))}}(),remove:function(){this.removeEventListener()}}),p("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(`
`),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));","}","}"].join(`
`)})},"./src/components/look-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),m=Math.PI/2;l.exports.Component=d("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new p.Vector3,this.hmdQuaternion=new p.Quaternion,this.magicWindowAbsoluteEuler=new p.Euler,this.magicWindowDeltaEuler=new p.Euler,this.position=new p.Vector3,this.magicWindowObject=new p.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new p.Vector3,rotation:new p.Euler},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var g,y=this.data;(f.device.isMobile()||f.device.isMobileDeviceRequestingDesktopSite())&&(g=this.magicWindowControls=new p.DeviceOrientationControls(this.magicWindowObject),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission&&(g.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?g.enabled=y.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){g.enabled=y.magicWindowTrackingEnabled})))},update:function(g){var y=this.data;y.enabled!==g.enabled&&this.updateGrabCursor(y.enabled),g&&!y.magicWindowTrackingEnabled&&g.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=y.magicWindowTrackingEnabled),g&&!y.pointerLockEnabled!==g.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(g){var y=this.data;y.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onPointerLockError=this.onPointerLockError.bind(this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new p.Object3D,this.yawObject=new p.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var g=this.el.sceneEl,y=g.canvas;if(!y){g.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}y.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),y.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),g.addEventListener("enter-vr",this.onEnterVR),g.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))},removeEventListeners:function(){var g=this.el.sceneEl,y=g&&g.canvas;y&&(y.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),y.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),g.removeEventListener("enter-vr",this.onEnterVR),g.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var g=this.el.object3D,y=this.pitchObject,x=this.yawObject,v=this.el.sceneEl;(v.is("vr-mode")||v.is("ar-mode"))&&v.checkHeadsetConnected()||(this.updateMagicWindowOrientation(),g.rotation.x=this.magicWindowDeltaEuler.x+y.rotation.x,g.rotation.y=this.magicWindowDeltaEuler.y+x.rotation.y,g.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var g=this.magicWindowAbsoluteEuler,y=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),g.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),!this.previousMagicWindowYaw&&g.y!==0&&(this.previousMagicWindowYaw=g.y),this.previousMagicWindowYaw&&(y.x=g.x,y.y+=g.y-this.previousMagicWindowYaw,y.z=g.z,this.previousMagicWindowYaw=g.y))},onMouseMove:function(g){var y,x,v,_=this.pitchObject,T=this.previousMouseEvent,w=this.yawObject;!this.data.enabled||!this.mouseDown&&!this.pointerLocked||(this.pointerLocked?(x=g.movementX||g.mozMovementX||0,v=g.movementY||g.mozMovementY||0):(x=g.screenX-T.screenX,v=g.screenY-T.screenY),this.previousMouseEvent.screenX=g.screenX,this.previousMouseEvent.screenY=g.screenY,y=this.data.reverseMouseDrag?1:-1,w.rotation.y+=x*.002*y,_.rotation.x+=v*.002*y,_.rotation.x=Math.max(-m,Math.min(m,_.rotation.x)))},onMouseDown:function(g){var y=this.el.sceneEl;if(!(!this.data.enabled||!this.data.mouseEnabled||(y.is("vr-mode")||y.is("ar-mode"))&&y.checkHeadsetConnected())&&g.button===0){var x=y&&y.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=g.screenX,this.previousMouseEvent.screenY=g.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(x.requestPointerLock?x.requestPointerLock():x.mozRequestPointerLock&&x.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(g){g.touches.length!==1||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode")||(this.touchStart={x:g.touches[0].pageX,y:g.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(g){var y,x=this.el.sceneEl.canvas,v,_=this.yawObject;!this.touchStarted||!this.data.touchEnabled||(v=2*Math.PI*(g.touches[0].pageX-this.touchStart.x)/x.clientWidth,y=this.data.reverseTouchDrag?1:-1,_.rotation.y-=v*.5*y,this.touchStart={x:g.touches[0].pageX,y:g.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var g=this.el.sceneEl;g.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),g.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!!(document.pointerLockElement||document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(g){var y=this.el.sceneEl;function x(){y.canvas.classList.add("a-grab-cursor")}function v(){y.canvas.classList.remove("a-grab-cursor")}if(!y.canvas){g?y.addEventListener("render-target-loaded",x):y.addEventListener("render-target-loaded",v);return}if(g){x();return}v()},saveCameraPose:function(){var g=this.el;this.savedPose.position.copy(g.object3D.position),this.savedPose.rotation.copy(g.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var g=this.el,y=this.savedPose;this.hasSavedPose&&(g.object3D.position.copy(y.position),g.object3D.rotation.copy(y.rotation),this.hasSavedPose=!1)}})},"./src/components/magicleap-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,m=p.emitIfAxesChanged,g=p.onButtonEvent,y="magicleap",x="-one",v=y+x,_=c("./src/constants/index.js").AFRAME_CDN_ROOT,T=_+"controllers/magicleap/magicleap-one-controller.glb",w={axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]};l.exports.Component=d("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:w,init:function(){var S=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(R){g(R.detail.id,"down",S)},this.onButtonUp=function(R){g(R.detail.id,"up",S)},this.onButtonTouchEnd=function(R){g(R.detail.id,"touchend",S)},this.onButtonTouchStart=function(R){g(R.detail.id,"touchstart",S)},this.previousButtonValues={},this.bindMethods()},update:function(){var S=this.data;this.controllerIndex=S.hand==="right"?0:S.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var S=this.el;S.addEventListener("buttonchanged",this.onButtonChanged),S.addEventListener("buttondown",this.onButtonDown),S.addEventListener("buttonup",this.onButtonUp),S.addEventListener("touchstart",this.onButtonTouchStart),S.addEventListener("touchend",this.onButtonTouchEnd),S.addEventListener("axismove",this.onAxisMoved),S.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var S=this.el;S.removeEventListener("buttonchanged",this.onButtonChanged),S.removeEventListener("buttondown",this.onButtonDown),S.removeEventListener("buttonup",this.onButtonUp),S.removeEventListener("touchstart",this.onButtonTouchStart),S.removeEventListener("touchend",this.onButtonTouchEnd),S.removeEventListener("axismove",this.onAxisMoved),S.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var S=this.data;f(this,v,{index:this.controllerIndex,hand:S.hand})},injectTrackedControls:function(){var S=this.el,R=this.data;S.setAttribute("tracked-controls",{idPrefix:v,hand:R.hand,controller:this.controllerIndex,orientationOffset:R.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",T)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(S){var R=this.mapping.buttons[S.detail.id],B;R&&(R==="trigger"&&(B=S.detail.state.value,console.log("analog value of trigger press: "+B)),this.el.emit(R+"changed",S.detail.state))},onModelLoaded:function(S){var R=S.detail.model;R.scale.set(.01,.01,.01)},onAxisMoved:function(S){m(this,this.mapping.axes,S)},updateModel:function(S,R){},setButtonColor:function(S,R){}})},"./src/components/material.js":(l,u,c)=>{var d=c("./src/utils/index.js"),p=c("./src/core/component.js"),f=c("./src/lib/three.js"),m=c("./src/core/shader.js"),g=d.debug("components:material:error"),y=p.registerComponent,x=m.shaders,v=m.shaderNames;l.exports.Component=y("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:v,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColorsEnabled:{default:!1},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0},anisotropy:{default:0,min:0}},init:function(){this.material=null},update:function(S){var R=this.data;(!this.shader||R.shader!==S.shader)&&this.updateShader(R.shader),this.shader.update(this.data),this.updateMaterial(S)},updateSchema:function(S){var R,B,I,D;B=S&&S.shader,R=this.oldData&&this.oldData.shader,D=B||R,I=x[D]&&x[D].schema,I||g("Unknown shader schema "+D),!(R&&B===R)&&(this.extendSchema(I),this.updateBehavior())},updateBehavior:function(){var S,R=this.el.sceneEl,B=this.schema,I=this,D;function L(O,U){var J;for(J in D)D[J]=O;I.shader.update(D)}this.tick=void 0,D={};for(S in B)B[S].type==="time"&&(this.tick=L,D[S]=!0);R&&(this.tick?R.addBehavior(this):R.removeBehavior(this))},updateShader:function(S){var R=this.data,B=x[S]&&x[S].Shader,I;if(!B)throw new Error("Unknown shader "+S);I=this.shader=new B,I.el=this.el,I.init(R),this.setMaterial(I.material),this.updateSchema(R)},updateMaterial:function(S){var R=this.data,B=this.material,I;B.alphaTest=R.alphaTest,B.depthTest=R.depthTest!==!1,B.depthWrite=R.depthWrite!==!1,B.opacity=R.opacity,B.flatShading=R.flatShading,B.side=_(R.side),B.transparent=R.transparent!==!1||R.opacity<1,B.vertexColors=R.vertexColorsEnabled,B.visible=R.visible,B.blending=T(R.blending),B.dithering=R.dithering;for(I in S)break;I&&(S.alphaTest!==R.alphaTest||S.side!==R.side||S.vertexColorsEnabled!==R.vertexColorsEnabled)&&(B.needsUpdate=!0)},remove:function(){var S=new f.MeshBasicMaterial,R=this.material,B=this.el.getObject3D("mesh");B&&(B.material=S),w(R,this.system)},setMaterial:function(S){var R=this.el,B,I=this.system;this.material&&w(this.material,I),this.material=S,I.registerMaterial(S),B=R.getObject3D("mesh"),B?B.material=S:R.addEventListener("object3dset",function D(L){L.detail.type!=="mesh"||L.target!==R||(R.getObject3D("mesh").material=S,R.removeEventListener("object3dset",D))})}});function _(S){switch(S){case"back":return f.BackSide;case"double":return f.DoubleSide;default:return f.FrontSide}}function T(S){switch(S){case"none":return f.NoBlending;case"additive":return f.AdditiveBlending;case"subtractive":return f.SubtractiveBlending;case"multiply":return f.MultiplyBlending;default:return f.NormalBlending}}function w(S,R){S.dispose(),R.unregisterMaterial(S),Object.keys(S).filter(function(B){return S[B]&&S[B].isTexture}).forEach(function(B){S[B].dispose()})}},"./src/components/obb-collider.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");d("obb-collider",{schema:{size:{default:0},trackedObject3D:{default:""},minimumColliderDimension:{default:.02},centerModel:{default:!1}},init:function(){this.previousScale=new p.Vector3().copy(this.el.object3D.scale),this.auxEuler=new p.Euler,this.boundingBox=new p.Box3,this.boundingBoxSize=new p.Vector3,this.updateCollider=this.updateCollider.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.updateBoundingBox=this.updateBoundingBox.bind(this),this.el.addEventListener("model-loaded",this.onModelLoaded),this.updateCollider(),this.system.addCollider(this.el)},remove:function(){this.system.removeCollider(this.el)},update:function(){this.data.trackedObject3D&&(this.trackedObject3DPath=this.data.trackedObject3D.split("."))},onModelLoaded:function(){this.data.centerModel&&this.centerModel(),this.updateCollider()},centerModel:function(){var f=this.el,m=f.components["gltf-model"]&&f.components["gltf-model"].model,g,y;m&&(this.el.removeObject3D("mesh"),g=new p.Box3().setFromObject(m),y=g.getCenter(new p.Vector3),m.position.x+=m.position.x-y.x,m.position.y+=m.position.y-y.y,m.position.z+=m.position.z-y.z,this.el.setObject3D("mesh",m))},updateCollider:function(){var f=this.el,m=this.boundingBoxSize,g=this.aabb=this.aabb||new p.OBB;if(this.obb=this.obb||new p.OBB,!f.hasLoaded){f.addEventListener("loaded",this.updateCollider);return}this.updateBoundingBox(),g.halfSize.copy(m).multiplyScalar(.5),this.el.sceneEl.systems["obb-collider"].data.showColliders&&this.showCollider()},showCollider:function(){this.updateColliderMesh(),this.renderColliderMesh.visible=!0},updateColliderMesh:function(){var f=this.renderColliderMesh,m=this.boundingBoxSize;if(!f){this.initColliderMesh();return}f.geometry.dispose(),f.geometry=new p.BoxGeometry(m.x,m.y,m.z)},hideCollider:function(){this.renderColliderMesh&&(this.renderColliderMesh.visible=!1)},initColliderMesh:function(){var f,m,g;f=this.boundingBoxSize,m=this.renderColliderGeometry=new p.BoxGeometry(f.x,f.y,f.z),g=this.renderColliderMesh=new p.Mesh(m,new p.MeshLambertMaterial({color:65280,side:p.DoubleSide})),g.matrixAutoUpdate=!1,g.matrixWorldAutoUpdate=!1,g.updateMatrixWorld=function(){},this.el.sceneEl.object3D.add(g)},updateBoundingBox:function(){var f=new p.Vector3,m=new p.Vector3,g=new p.Quaternion,y=new p.Quaternion,x=new p.Matrix4;return function(){var v=this.auxEuler,_=this.boundingBox,T=this.data.size,w=this.trackedObject3D||this.el.object3D,S=this.boundingBoxSize,R=this.data.minimumColliderDimension;if(T){this.boundingBoxSize.x=T,this.boundingBoxSize.y=T,this.boundingBoxSize.z=T;return}v.copy(w.rotation),w.rotation.set(0,0,0),w.parent.matrixWorld.decompose(f,g,m),x.compose(f,y,m),w.parent.matrixWorld.copy(x),_.setFromObject(w,!0),_.getSize(S),S.x=S.x<R?R:S.x,S.y=S.y<R?R:S.y,S.z=S.z<R?R:S.z,w.parent.matrixWorld.compose(f,g,m),this.el.object3D.rotation.copy(v)}}(),checkTrackedObject:function(){var f=this.trackedObject3DPath,m;if(f&&f.length&&!this.trackedObject3D){m=this.el;for(var g=0;g<f.length&&(m=m[f[g]],!!m);g++);m&&(this.trackedObject3D=m,this.updateCollider())}return this.trackedObject3D},tick:function(){var f=new p.Vector3,m=new p.Vector3,g=new p.Quaternion,y=new p.Matrix4;return function(){var x=this.obb,v=this.renderColliderMesh,_=this.checkTrackedObject()||this.el.object3D;_&&(_.updateMatrix(),_.updateMatrixWorld(!0),_.matrixWorld.decompose(f,g,m),(Math.abs(m.x-this.previousScale.x)>1e-4||Math.abs(m.y-this.previousScale.y)>1e-4||Math.abs(m.z-this.previousScale.z)>1e-4)&&this.updateCollider(),this.previousScale.copy(m),m.set(1,1,1),y.compose(f,g,m),v&&v.matrixWorld.copy(y),x.copy(this.aabb),x.applyMatrix4(y))}}()})},"./src/components/obj-model.js":(l,u,c)=>{var d=c("./src/utils/debug.js"),p=c("./src/core/component.js").registerComponent,f=c("./src/lib/three.js"),m=d("components:obj-model:warn");l.exports.Component=p("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var g=this;this.model=null,this.objLoader=new f.OBJLoader,this.mtlLoader=new f.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(y){g.model&&y.detail.name==="material"&&g.applyMaterial()})},update:function(){var g=this.data;g.obj&&(this.resetMesh(),this.loadObj(g.obj,g.mtl))},remove:function(){this.resetMesh()},resetMesh:function(){this.model&&this.el.removeObject3D("mesh")},loadObj:function(g,y){var x=this,v=this.el,_=this.mtlLoader,T=this.objLoader,w=this.el.sceneEl.systems.renderer,S=y.substr(0,y.lastIndexOf("/")+1);if(y){v.hasAttribute("material")&&m("Material component properties are ignored when a .MTL is provided"),_.setResourcePath(S),_.load(y,function(R){R.preload(),T.setMaterials(R),T.load(g,function(B){x.model=B,x.model.traverse(function(I){if(I.isMesh){var D=I.material;D.map&&w.applyColorCorrection(D.map),D.emissiveMap&&w.applyColorCorrection(D.emissiveMap)}}),v.setObject3D("mesh",B),v.emit("model-loaded",{format:"obj",model:B})})});return}T.load(g,function(R){x.model=R,x.applyMaterial(),v.setObject3D("mesh",R),v.emit("model-loaded",{format:"obj",model:R})})},applyMaterial:function(){var g=this.el.components.material;g&&this.model.traverse(function(y){y instanceof f.Mesh&&(y.material=g.material)})}})},"./src/components/oculus-go-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,m=p.emitIfAxesChanged,g=p.onButtonEvent,y=c("./src/utils/index.js").device.isWebXRAvailable,x="oculus-go",v="Oculus Go",_=c("./src/constants/index.js").AFRAME_CDN_ROOT,T=_+"controllers/oculus/go/oculus-go-controller.gltf",w=y?x:v,S={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},R={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]},B=y?R:S;l.exports.Component=d("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:B,bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var I=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(D){g(D.detail.id,"down",I)},this.onButtonUp=function(D){g(D.detail.id,"up",I)},this.onButtonTouchStart=function(D){g(D.detail.id,"touchstart",I)},this.onButtonTouchEnd=function(D){g(D.detail.id,"touchend",I)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var I=this.el;I.addEventListener("buttonchanged",this.onButtonChanged),I.addEventListener("buttondown",this.onButtonDown),I.addEventListener("buttonup",this.onButtonUp),I.addEventListener("touchstart",this.onButtonTouchStart),I.addEventListener("touchend",this.onButtonTouchEnd),I.addEventListener("model-loaded",this.onModelLoaded),I.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var I=this.el;I.removeEventListener("buttonchanged",this.onButtonChanged),I.removeEventListener("buttondown",this.onButtonDown),I.removeEventListener("buttonup",this.onButtonUp),I.removeEventListener("touchstart",this.onButtonTouchStart),I.removeEventListener("touchend",this.onButtonTouchEnd),I.removeEventListener("model-loaded",this.onModelLoaded),I.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){f(this,w,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var I=this.el,D=this.data;I.setAttribute("tracked-controls",{armModel:D.armModel,hand:D.hand,idPrefix:w,orientationOffset:D.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",T)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(I){var D=I.detail.model,L;I.target!==this.el||!this.data.model||(L=this.buttonMeshes={},L.trigger=D.getObjectByName("oculus_go_button_trigger"),L.trackpad=D.getObjectByName("oculus_go_touchpad"),L.touchpad=D.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(I){var D=this.mapping.buttons[I.detail.id];D&&this.el.emit(D+"changed",I.detail.state)},onAxisMoved:function(I){m(this,this.mapping.axes,I)},updateModel:function(I,D){this.data.model&&this.updateButtonModel(I,D)},updateButtonModel:function(I,D){var L=this.buttonMeshes;if(!(!L||!L[I])){var O,U;switch(D){case"down":O=this.data.buttonHighlightColor;break;case"touchstart":O=this.data.buttonTouchedColor;break;default:O=this.data.buttonColor}U=L[I],U.material.color.set(O)}}})},"./src/components/oculus-touch-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),m=f.checkControllerPresentAndSetup,g=f.emitIfAxesChanged,y=f.onButtonEvent,x=c("./src/utils/index.js").device.isWebXRAvailable,v="oculus-touch",_="Oculus Touch",T=x?v:_,w=c("./src/constants/index.js").AFRAME_CDN_ROOT,S=w+"controllers/oculus/oculus-touch-controller-",R=w+"controllers/meta/",B={left:{modelUrl:S+"left.gltf",rayOrigin:{origin:{x:.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(-.005,.003,-.055),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:S+"right.gltf",rayOrigin:{origin:{x:-.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(.005,.003,-.055),modelPivotRotation:new p.Euler(0,0,0)}},I={left:{modelUrl:S+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(-.005,.036,-.037),modelPivotRotation:new p.Euler(Math.PI/4.5,0,0)},right:{modelUrl:S+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(.005,.036,-.037),modelPivotRotation:new p.Euler(Math.PI/4.5,0,0)}},D=x?I:B,L="oculus-touch",O={"oculus-touch":D,"oculus-touch-v2":{left:{modelUrl:S+"gen2-left.gltf",rayOrigin:{origin:{x:-.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new p.Vector3(0,-.007,-.021),modelPivotRotation:new p.Euler(-Math.PI/4,0,0)},right:{modelUrl:S+"gen2-right.gltf",rayOrigin:{origin:{x:.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new p.Vector3(0,-.007,-.021),modelPivotRotation:new p.Euler(-Math.PI/4,0,0)}},"oculus-touch-v3":{left:{modelUrl:S+"v3-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:S+"v3-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)}},"meta-quest-touch-pro":{left:{modelUrl:R+"quest-touch-pro-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:R+"quest-touch-pro-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)}},"meta-quest-touch-plus":{left:{modelUrl:R+"quest-touch-plus-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:R+"quest-touch-plus-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)}}},U={left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}},J={left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}},H=x?J:U;l.exports.Component=d("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},after:["tracked-controls"],mapping:H,bindMethods:function(){this.onButtonChanged=this.onButtonChanged.bind(this),this.onThumbstickMoved=this.onThumbstickMoved.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var $=this;this.onButtonDown=function(Q){y(Q.detail.id,"down",$,$.data.hand)},this.onButtonUp=function(Q){y(Q.detail.id,"up",$,$.data.hand)},this.onButtonTouchStart=function(Q){y(Q.detail.id,"touchstart",$,$.data.hand)},this.onButtonTouchEnd=function(Q){y(Q.detail.id,"touchend",$,$.data.hand)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.triggerEuler=new p.Euler},addEventListeners:function(){var $=this.el;$.addEventListener("buttonchanged",this.onButtonChanged),$.addEventListener("buttondown",this.onButtonDown),$.addEventListener("buttonup",this.onButtonUp),$.addEventListener("touchstart",this.onButtonTouchStart),$.addEventListener("touchend",this.onButtonTouchEnd),$.addEventListener("axismove",this.onAxisMoved),$.addEventListener("model-loaded",this.onModelLoaded),$.addEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var $=this.el;$.removeEventListener("buttonchanged",this.onButtonChanged),$.removeEventListener("buttondown",this.onButtonDown),$.removeEventListener("buttonup",this.onButtonUp),$.removeEventListener("touchstart",this.onButtonTouchStart),$.removeEventListener("touchend",this.onButtonTouchEnd),$.removeEventListener("axismove",this.onAxisMoved),$.removeEventListener("model-loaded",this.onModelLoaded),$.removeEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){m(this,T,{hand:this.data.hand,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function($){var Q=this.data,G;if(Q.model){if(this.controllerObject3D){this.el.setObject3D("mesh",this.controllerObject3D);return}if(this.displayModel=O[Q.controllerType]||O[L],Q.controllerType==="auto"){var j=this.el.sceneEl.systems["tracked-controls-webvr"];if(j&&j.vrDisplay){var ie=j.vrDisplay.displayName;/^Oculus Quest$/.test(ie)&&(this.displayModel=O["oculus-touch-v2"])}else{G=L;for(var Y=Object.keys(O),ae=0;ae<$.profiles.length;ae++)if(Y.indexOf($.profiles[ae])!==-1){G=$.profiles[ae];break}this.displayModel=O[G]}}var xe=this.displayModel[Q.hand].modelUrl;this.isTouchV3orPROorPlus=this.displayModel===O["oculus-touch-v3"]||this.displayModel===O["meta-quest-touch-pro"]||this.displayModel===O["meta-quest-touch-plus"],this.el.setAttribute("gltf-model",xe)}},injectTrackedControls:function($){var Q=this.data,G=v,j=Q.hand==="right"?"Oculus Touch (Right)":"Oculus Touch (Left)",ie=x?G:j;this.el.setAttribute("tracked-controls",{id:ie,hand:Q.hand,orientationOffset:Q.orientationOffset,handTrackingEnabled:!1,iterateControllerProfiles:!0,space:"gripSpace"}),this.loadModel($)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function($){var Q=this.mapping[this.data.hand].buttons[$.detail.id];if(Q){if(this.isTouchV3orPROorPlus)this.onButtonChangedV3orPROorPlus($);else{var G=this.buttonMeshes,j;(Q==="trigger"||Q==="grip")&&(j=$.detail.state.value),G&&(Q==="trigger"&&G.trigger&&(G.trigger.rotation.x=this.originalXRotationTrigger-j*(Math.PI/26)),Q==="grip"&&G.grip&&(j*=this.data.hand==="left"?-1:1,G.grip.position.x=this.originalXPositionGrip+j*.004))}this.el.emit(Q+"changed",$.detail.state)}},onButtonChangedV3orPROorPlus:function($){var Q=this.mapping[this.data.hand].buttons[$.detail.id],G=this.buttonObjects,j;!G||!G[Q]||(j=$.detail.state.value,G[Q].quaternion.slerpQuaternions(this.buttonRanges[Q].min.quaternion,this.buttonRanges[Q].max.quaternion,j),G[Q].position.lerpVectors(this.buttonRanges[Q].min.position,this.buttonRanges[Q].max.position,j))},onModelLoaded:function($){if(!($.target!==this.el||!this.data.model)){if(this.isTouchV3orPROorPlus)this.onTouchV3orPROorPlusModelLoaded($);else{var Q=this.controllerObject3D=$.detail.model,G;G=this.buttonMeshes={},G.grip=Q.getObjectByName("buttonHand"),this.originalXPositionGrip=G.grip&&G.grip.position.x,G.trigger=Q.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=G.trigger&&G.trigger.rotation.x,G.thumbstick=Q.getObjectByName("stick"),G.xbutton=Q.getObjectByName("buttonX"),G.abutton=Q.getObjectByName("buttonA"),G.ybutton=Q.getObjectByName("buttonY"),G.bbutton=Q.getObjectByName("buttonB")}for(var j in this.buttonMeshes)this.buttonMeshes[j]&&V(this.buttonMeshes[j]);this.applyOffset($.detail.model),this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin})}},applyOffset:function($){$.position.copy(this.displayModel[this.data.hand].modelPivotOffset),$.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation)},onTouchV3orPROorPlusModelLoaded:function($){var Q=this.controllerObject3D=$.detail.model,G=this.buttonObjects={},j=this.buttonMeshes={},ie=this.buttonRanges={};j.grip=Q.getObjectByName("squeeze"),G.grip=Q.getObjectByName("xr_standard_squeeze_pressed_value"),ie.grip={min:Q.getObjectByName("xr_standard_squeeze_pressed_min"),max:Q.getObjectByName("xr_standard_squeeze_pressed_max")},G.grip.minX=G.grip.position.x,j.thumbstick=Q.getObjectByName("thumbstick"),G.thumbstick=Q.getObjectByName("xr_standard_thumbstick_pressed_value"),ie.thumbstick={min:Q.getObjectByName("xr_standard_thumbstick_pressed_min"),max:Q.getObjectByName("xr_standard_thumbstick_pressed_max")},G.thumbstickXAxis=Q.getObjectByName("xr_standard_thumbstick_xaxis_pressed_value"),ie.thumbstickXAxis={min:Q.getObjectByName("xr_standard_thumbstick_xaxis_pressed_min"),max:Q.getObjectByName("xr_standard_thumbstick_xaxis_pressed_max")},G.thumbstickYAxis=Q.getObjectByName("xr_standard_thumbstick_yaxis_pressed_value"),ie.thumbstickYAxis={min:Q.getObjectByName("xr_standard_thumbstick_yaxis_pressed_min"),max:Q.getObjectByName("xr_standard_thumbstick_yaxis_pressed_max")},j.trigger=Q.getObjectByName("trigger"),G.trigger=Q.getObjectByName("xr_standard_trigger_pressed_value"),ie.trigger={min:Q.getObjectByName("xr_standard_trigger_pressed_min"),max:Q.getObjectByName("xr_standard_trigger_pressed_max")},ie.trigger.diff={x:Math.abs(ie.trigger.max.rotation.x)-Math.abs(ie.trigger.min.rotation.x),y:Math.abs(ie.trigger.max.rotation.y)-Math.abs(ie.trigger.min.rotation.y),z:Math.abs(ie.trigger.max.rotation.z)-Math.abs(ie.trigger.min.rotation.z)};var Y=this.data.hand==="left"?"x":"a",ae=this.data.hand==="left"?"y":"b",xe=Y+"button",fe=ae+"button";j[xe]=Q.getObjectByName(Y+"_button"),G[xe]=Q.getObjectByName(Y+"_button_pressed_value"),ie[xe]={min:Q.getObjectByName(Y+"_button_pressed_min"),max:Q.getObjectByName(Y+"_button_pressed_max")},j[fe]=Q.getObjectByName(ae+"_button"),G[fe]=Q.getObjectByName(ae+"_button_pressed_value"),ie[fe]={min:Q.getObjectByName(ae+"_button_pressed_min"),max:Q.getObjectByName(ae+"_button_pressed_max")}},onAxisMoved:function($){g(this,this.mapping[this.data.hand].axes,$)},onThumbstickMoved:function($){if(!(!this.buttonMeshes||!this.buttonMeshes.thumbstick)){if(this.isTouchV3orPROorPlus){this.updateThumbstickTouchV3orPROorPlus($);return}for(var Q in $.detail)this.buttonObjects.thumbstick.rotation[this.axisMap[Q]]=this.buttonRanges.thumbstick.originalRotation[this.axisMap[Q]]-Math.PI/8*$.detail[Q]*(Q==="y"||this.data.hand==="right"?-1:1)}},axisMap:{y:"x",x:"z"},updateThumbstickTouchV3orPROorPlus:function($){var Q=($.detail.x+1)/2;this.buttonObjects.thumbstickXAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickXAxis.min.quaternion,this.buttonRanges.thumbstickXAxis.max.quaternion,Q);var G=($.detail.y+1)/2;this.buttonObjects.thumbstickYAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickYAxis.min.quaternion,this.buttonRanges.thumbstickYAxis.max.quaternion,G)},updateModel:function($,Q){this.data.model&&this.updateButtonModel($,Q)},updateButtonModel:function($,Q){var G=this.buttonMeshes,j,ie;G&&G[$]&&(ie=Q==="up"||Q==="touchend"?G[$].originalColor||this.data.buttonColor:Q==="touchstart"?this.data.buttonTouchColor:this.data.buttonHighlightColor,j=G[$],j.material.color.set(ie))}});function V($){$.traverse(function(Q){var G;Q.type==="Mesh"&&(G=Q.material.clone(),$.originalColor=Q.material.color,Q.material.dispose(),Q.material=G)})}},"./src/components/pico-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),m=f.checkControllerPresentAndSetup,g=f.emitIfAxesChanged,y=f.onButtonEvent,x="pico-4",v=c("./src/constants/index.js").AFRAME_CDN_ROOT,_=v+"controllers/pico/pico4/",T={left:{axes:{touchpad:[2,3]},buttons:["trigger","squeeze","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","squeeze","none","thumbstick","abutton","bbutton"]}};l.exports.Component=d("pico-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:T,init:function(){var w=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(S){y(S.detail.id,"down",w,w.data.hand)},this.onButtonUp=function(S){y(S.detail.id,"up",w,w.data.hand)},this.onButtonTouchEnd=function(S){y(S.detail.id,"touchend",w,w.data.hand)},this.onButtonTouchStart=function(S){y(S.detail.id,"touchstart",w,w.data.hand)},this.bindMethods()},update:function(){var w=this.data;this.controllerIndex=w.hand==="right"?0:w.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var w=this.el;w.addEventListener("buttonchanged",this.onButtonChanged),w.addEventListener("buttondown",this.onButtonDown),w.addEventListener("buttonup",this.onButtonUp),w.addEventListener("touchstart",this.onButtonTouchStart),w.addEventListener("touchend",this.onButtonTouchEnd),w.addEventListener("axismove",this.onAxisMoved),w.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var w=this.el;w.removeEventListener("buttonchanged",this.onButtonChanged),w.removeEventListener("buttondown",this.onButtonDown),w.removeEventListener("buttonup",this.onButtonUp),w.removeEventListener("touchstart",this.onButtonTouchStart),w.removeEventListener("touchend",this.onButtonTouchEnd),w.removeEventListener("axismove",this.onAxisMoved),w.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var w=this.data;m(this,x,{index:this.controllerIndex,hand:w.hand})},injectTrackedControls:function(){var w=this.el,S=this.data;w.setAttribute("tracked-controls",{idPrefix:x,hand:S.hand,controller:this.controllerIndex,orientationOffset:S.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",_+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(w){var S=this.mapping[this.data.hand].buttons[w.detail.id],R;S&&(S==="trigger"&&(R=w.detail.state.value,console.log("analog value of trigger press: "+R)),this.el.emit(S+"changed",w.detail.state))},onModelLoaded:function(w){w.target!==this.el||!this.data.model||this.el.emit("controllermodelready",{name:"pico-controls",model:this.data.model,rayOrigin:new p.Vector3(0,0,0)})},onAxisMoved:function(w){g(this,this.mapping.axes,w)}})},"./src/components/position.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("position",{schema:{type:"vec3"},update:function(){var p=this.el.object3D,f=this.data;p.position.set(f.x,f.y,f.z)},remove:function(){this.el.object3D.position.set(0,0,0)}})},"./src/components/raycaster.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),m=f.debug("components:raycaster:warn"),g=/^[\w\s-.,[\]#]*$/,y={childList:!0,attributes:!0,subtree:!0},x={INTERSECT:"raycaster-intersected",INTERSECTION:"raycaster-intersection",INTERSECT_CLEAR:"raycaster-intersected-cleared",INTERSECTION_CLEAR:"raycaster-intersection-cleared",INTERSECTION_CLOSEST_ENTITY_CHANGED:"raycaster-closest-entity-changed"};l.exports.Component=d("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new p.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new p.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new p.Vector3,this.otherLineEndVec3=new p.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(_){var T=this.data,w=this.el,S=this.raycaster;S.far=T.far,S.near=T.near,T.showLine&&(T.far!==_.far||T.origin!==_.origin||T.direction!==_.direction||!_.showLine)&&(this.unitLineEndVec3.copy(T.direction).normalize(),this.drawLine()),!T.showLine&&_.showLine&&w.removeAttribute("line"),T.objects!==_.objects&&!g.test(T.objects)&&m('[raycaster] Selector "'+T.objects+'" may not update automatically with DOM changes.'),T.objects||m('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),T.autoRefresh!==_.autoRefresh&&w.isPlaying&&(T.autoRefresh?this.addEventListeners():this.removeEventListeners()),_.enabled&&!T.enabled&&this.clearAllIntersections(),this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,y),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var _=this.data,T;T=_.objects?this.el.sceneEl.querySelectorAll(_.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(T),this.dirty=!1},tock:function(_){var T=this.data,w=this.prevCheckTime;T.enabled&&(w&&_-w<T.interval||(this.prevCheckTime=_,this.checkIntersections()))},checkIntersections:function(){var _=this.clearedIntersectedEls,T=this.el,w=this.data,S,R=this.intersectedEls,B,I=this.intersections,D=this.newIntersectedEls,L=this.newIntersections,O=this.prevIntersectedEls,U=this.rawIntersections;for(this.dirty&&this.refreshObjects(),v(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),U.length=0,this.raycaster.intersectObjects(this.objects,!0,U),I.length=0,R.length=0,S=0;S<U.length;S++)B=U[S],!(w.showLine&&B.object===T.getObject3D("line"))&&B.object.el&&(I.push(B),R.push(B.object.el));for(L.length=0,D.length=0,S=0;S<I.length;S++)O.indexOf(I[S].object.el)===-1&&(L.push(I[S]),D.push(I[S].object.el));for(_.length=0,S=0;S<O.length;S++)R.indexOf(O[S])===-1&&(O[S].emit(x.INTERSECT_CLEAR,this.intersectedClearedDetail),_.push(O[S]));for(_.length&&T.emit(x.INTERSECTION_CLEAR,this.intersectionClearedDetail),S=0;S<D.length;S++)D[S].emit(x.INTERSECT,this.intersectedDetail);L.length&&(this.intersectionDetail.els=D,this.intersectionDetail.intersections=L,T.emit(x.INTERSECTION,this.intersectionDetail)),(O.length===0&&I.length>0||O.length>0&&I.length===0||O.length&&I.length&&O[0]!==I[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=I,T.emit(x.INTERSECTION_CLOSEST_ENTITY_CHANGED,this.intersectionDetail)),w.showLine&&setTimeout(this.updateLine)},updateLine:function(){var _=this.el,T=this.intersections,w;T.length&&(T[0].object.el===_&&T[1]?w=T[1].distance:w=T[0].distance),this.drawLine(w)},getIntersection:function(_){var T,w;for(T=0;T<this.intersections.length;T++)if(w=this.intersections[T],w.object.el===_)return w;return null},updateOriginDirection:function(){var _=new p.Vector3,T=new p.Vector3;return function(){var w=this.el,S=this.data;if(S.useWorldCoordinates){this.raycaster.set(S.origin,S.direction);return}w.object3D.updateMatrixWorld(),T.setFromMatrixPosition(w.object3D.matrixWorld),(S.origin.x!==0||S.origin.y!==0||S.origin.z!==0)&&(T=w.object3D.localToWorld(T.copy(S.origin))),_.copy(S.direction).transformDirection(w.object3D.matrixWorld).normalize(),this.raycaster.set(T,_)}}(),drawLine:function(_){var T=this.data,w=this.el,S;S=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,_===void 0&&(_=T.far===1/0?1e3:T.far),this.lineData.start=T.origin,this.lineData.end=S.copy(this.unitLineEndVec3).multiplyScalar(_).add(T.origin),this.lineData.color=T.lineColor,this.lineData.opacity=T.lineOpacity,w.setAttribute("line",this.lineData)},flattenObject3DMaps:function(_){var T,w,S=this.objects,R=this.el.sceneEl.object3D;function B(D){return D.parent?B(D.parent):D===R}for(S.length=0,w=0;w<_.length;w++){var I=_[w];if(I.isEntity&&I.object3D&&B(I.object3D))for(T in I.object3DMap)S.push(I.getObject3D(T))}return S},clearAllIntersections:function(){var _;for(_=0;_<this.intersectedEls.length;_++)this.intersectedEls[_].emit(x.INTERSECT_CLEAR,this.intersectedClearedDetail);v(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(x.INTERSECTION_CLEAR,this.intersectionClearedDetail)}});function v(_,T){var w;for(_.length=T.length,w=0;w<T.length;w++)_[w]=T[w]}},"./src/components/rotation.js":(l,u,c)=>{var d=c("./src/lib/three.js").MathUtils.degToRad,p=c("./src/core/component.js").registerComponent;l.exports.Component=p("rotation",{schema:{type:"vec3"},update:function(){var f=this.data,m=this.el.object3D;m.rotation.set(d(f.x),d(f.y),d(f.z),"YXZ")},remove:function(){this.el.object3D.rotation.set(0,0,0)}})},"./src/components/scale.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var p=this.data,f=this.el.object3D;f.scale.set(p.x,p.y,p.z)},remove:function(){this.el.object3D.scale.set(1,1,1)}})},"./src/components/scene/ar-hit-test.js":(l,u,c)=>{var d="data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",p=c("./src/core/component.js").registerComponent,f=c("./src/lib/three.js"),m=21,g=function(){var _=new f.Quaternion,T=new f.Vector3;function w(S,R,B){R.position.copy(S.transform.position),R.quaternion.copy(S.transform.orientation),T.copy(B),_.copy(S.transform.orientation),T.applyQuaternion(_),R.position.sub(T)}return w}();g.tempFakePose={transform:{orientation:new f.Quaternion,position:new f.Vector3}};function y(_,T){this.renderer=_,this.xrHitTestSource=null,_.xr.addEventListener("sessionend",(function(){this.xrHitTestSource=null}).bind(this)),_.xr.addEventListener("sessionstart",(function(){this.sessionStart(T)}).bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(T)}y.prototype.previousFrameAnchors=new Set,y.prototype.anchorToObject3D=new Map;function x(_){console.warn(_.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}y.prototype.sessionStart=function(_){if(this.session=this.renderer.xr.getSession(),!("requestHitTestSource"in this.session)){x({message:"No requestHitTestSource on the session."});return}_.space?this.session.requestHitTestSource(_).then((function(T){this.xrHitTestSource=T}).bind(this)).catch(x):_.profile&&this.session.requestHitTestSourceForTransientInput(_).then((function(T){this.xrHitTestSource=T,this.transient=!0}).bind(this)).catch(x)},y.prototype.anchorFromLastHitTestResult=function(_,T){var w=this.lastHitTest;if(w){var S={object3D:_,offset:T};Array.from(this.anchorToObject3D.entries()).forEach((function(R){var B=R[1].object3D,I=R[0];B===_&&(this.anchorToObject3D.delete(I),I.delete())}).bind(this)),w.createAnchor&&w.createAnchor().then((function(R){this.anchorToObject3D.set(R,S)}).bind(this)).catch(function(R){console.warn(R.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')})}},y.prototype.doHit=function(_){if(this.renderer.xr.isPresenting){var T=this.renderer.xr.getReferenceSpace(),w=_.getViewerPose(T),S,R;if(this.xrHitTestSource&&w)return this.transient?(S=_.getHitTestResultsForTransientInput(this.xrHitTestSource),S.length>0?(R=S[0].results,R.length>0?(this.lastHitTest=R[0],R[0].getPose(T)):!1):!1):(S=_.getHitTestResults(this.xrHitTestSource),S.length>0?(this.lastHitTest=S[0],S[0].getPose(T)):!1)}},y.updateAnchorPoses=function(_,T){var w=_.trackedAnchors||y.prototype.previousFrameAnchors;y.prototype.previousFrameAnchors.forEach(function(S){w.has(S)||y.prototype.anchorToObject3D.delete(S)}),w.forEach(function(S){var R,B,I,D;try{R=_.getPose(S.anchorSpace,T)}catch{}if(R){if(B=y.prototype.anchorToObject3D.get(S),!B)return;I=B.offset,D=B.object3D,g(R,D,I)}})};var v;l.exports.Component=p("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:d,type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},sceneOnly:!0,init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(1048576),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new f.OrthographicCamera,this.orthoCam.layers.set(m),this.textureTarget=new f.WebGLRenderTarget(512,512,{}),this.basicMaterial=new f.MeshBasicMaterial({color:0,side:f.DoubleSide}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new f.CanvasTexture(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var _=this.el.getAttribute("webxr"),T=_.optionalFeatures;(!T.includes("hit-test")||!T.includes("anchors"))&&(T.push("hit-test"),T.push("anchors"),this.el.setAttribute("webxr",_)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",(function(){this.hitTest=null}).bind(this)),this.el.sceneEl.renderer.xr.addEventListener("sessionstart",(function(){if(this.el.is("ar-mode")){var w=this.el.sceneEl.renderer,S=this.session=w.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,v||(v=new Map),S.requestReferenceSpace("viewer").then((function(I){this.hitTest=new y(w,{space:I}),v.set(I,this.hitTest),this.el.emit("ar-hit-test-start")}).bind(this));var R="generic-touchscreen",B=new y(w,{profile:R});S.addEventListener("selectstart",(function(I){if(this.data.enabled===!0){var D=I.inputSource;this.bboxMesh.visible=!0,this.hasPosedOnce===!0&&(this.el.emit("ar-hit-test-select-start",{inputSource:D,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),D.profiles[0]===R?this.hitTest=B:(this.hitTest=v.get(D)||new y(w,{space:D.targetRaySpace}),v.set(D,this.hitTest)))}}).bind(this)),S.addEventListener("selectend",(function(I){if(!this.hitTest||this.data.enabled!==!0){this.hitTest=null;return}var D=I.inputSource,L;this.hasPosedOnce===!0&&(this.bboxMesh.visible=!1,this.data.target&&(L=this.data.target.object3D,L&&(g.tempFakePose.transform.position.copy(this.bboxMesh.position),g.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),g(g.tempFakePose,L,this.bboxOffset),L.visible=!0,this.hitTest.anchorFromLastHitTestResult(L,this.bboxOffset))),this.el.emit("ar-hit-test-select",{inputSource:D,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion})),this.hitTest=null}).bind(this))}}).bind(this)),this.bboxOffset=new f.Vector3,this.update=this.update.bind(this),this.makeBBox()},update:function(){this.data.enabled===!1&&(this.hitTest=null,this.bboxMesh.visible=!1),this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(m),this.data.target.object3D.traverse(function(_){_.layers.enable(m)})):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var _=new f.PlaneGeometry(1,1),T=new f.MeshBasicMaterial({transparent:!0,color:16777215});_.rotateX(-Math.PI/2),_.rotateY(-Math.PI/2),this.bbox=new f.Box3,this.bboxMesh=new f.Mesh(_,T),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var _,T=this.el.sceneEl.renderer,w,S,R=T.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),w=T.getRenderTarget(),T.setRenderTarget(this.textureTarget),T.xr.enabled=!1,S=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,T.render(this.el.object3D,this.orthoCam),this.el.object3D.background=S,this.el.object3D.overrideMaterial=null,T.xr.enabled=R,T.setRenderTarget(w),T.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),_=this.context.getImageData(0,0,512,512);for(var B=0;B<262144;B++)_.data[B*4+3]!==0&&_.data[B*4+3]!==255&&(_.data[B*4+3]=128);this.context.putImageData(_,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var _,T=this.el.sceneEl.frame,w=this.el.sceneEl.renderer;if(T&&y.updateAnchorPoses(T,w.xr.getReferenceSpace()),this.bboxNeedsUpdate){if(this.bboxNeedsUpdate=!1,!this.data.target||this.data.type==="map"){var S;this.textureCache.has(this.data.src)?S=this.textureCache.get(this.data.src):(S=new f.TextureLoader().load(this.data.src),this.textureCache.set(this.data.src,S)),this.bboxMesh.material.map=S,this.bboxMesh.material.needsUpdate=!0}this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),this.data.type==="footprint"&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)}this.hitTest&&(_=this.hitTest.doHit(T),_&&(this.hasPosedOnce!==!0&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(_.transform.position),this.bboxMesh.quaternion.copy(_.transform.orientation)))}})},"./src/components/scene/background.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},sceneOnly:!0,update:function(){var p=this.data,f=this.el.object3D;p.transparent?f.background=null:f.background=new THREE.Color(p.color)},remove:function(){var p=this.el.object3D;p.background=null}})},"./src/components/scene/debug.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("debug",{schema:{default:!0},sceneOnly:!0})},"./src/components/scene/device-orientation-permission-ui.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/constants/index.js"),f="a-modal",m="a-dialog",g="a-dialog-text",y="a-dialog-text-container",x="a-dialog-buttons-container",v="a-dialog-button",_="a-dialog-allow-button",T="a-dialog-deny-button",w="a-dialog-ok-button";l.exports.Component=d("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},sceneOnly:!0,init:function(){var I=this;if(this.data.enabled){if(window.isSecureContext||this.showHTTPAlert(),typeof DeviceOrientationEvent>"u"||!DeviceOrientationEvent.requestPermission){this.permissionGranted=!0;return}this.onDeviceMotionDialogAllowClicked=this.onDeviceMotionDialogAllowClicked.bind(this),this.onDeviceMotionDialogDenyClicked=this.onDeviceMotionDialogDenyClicked.bind(this),DeviceOrientationEvent.requestPermission().then(function(){I.el.emit("deviceorientationpermissiongranted"),I.permissionGranted=!0}).catch(function(){I.devicePermissionDialogEl=S(I.data.denyButtonText,I.data.allowButtonText,I.data.deviceMotionMessage,I.onDeviceMotionDialogAllowClicked,I.onDeviceMotionDialogDenyClicked),I.el.appendChild(I.devicePermissionDialogEl)})}},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var I=this,D=R(I.data.cancelButtonText,I.data.httpsMessage,function(){I.el.removeChild(D)});this.el.appendChild(D)},onDeviceMotionDialogAllowClicked:function(){var I=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(D){D==="granted"?(I.el.emit("deviceorientationpermissiongranted"),I.permissionGranted=!0):I.el.emit("deviceorientationpermissionrejected"),I.remove()}).catch(console.error)}});function S(I,D,L,O,U){var J,H,V;return J=document.createElement("div"),J.classList.add(x),H=document.createElement("button"),H.classList.add(v,T),H.setAttribute(p.AFRAME_INJECTED,""),H.innerHTML=I,J.appendChild(H),V=document.createElement("button"),V.classList.add(v,_),V.setAttribute(p.AFRAME_INJECTED,""),V.innerHTML=D,J.appendChild(V),V.addEventListener("click",function($){$.stopPropagation(),O()}),H.addEventListener("click",function($){$.stopPropagation(),U()}),B(L,J)}function R(I,D,L){var O,U;return O=document.createElement("div"),O.classList.add(x),U=document.createElement("button"),U.classList.add(v,w),U.setAttribute(p.AFRAME_INJECTED,""),U.innerHTML=I,O.appendChild(U),U.addEventListener("click",function(J){J.stopPropagation(),L()}),B(D,O)}function B(I,D){var L,O,U,J;return L=document.createElement("div"),L.classList.add(f),L.setAttribute(p.AFRAME_INJECTED,""),O=document.createElement("div"),O.className=m,O.setAttribute(p.AFRAME_INJECTED,""),L.appendChild(O),U=document.createElement("div"),U.classList.add(y),O.appendChild(U),J=document.createElement("div"),J.classList.add(g),J.innerHTML=I,U.appendChild(J),O.appendChild(D),L}},"./src/components/scene/embedded.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("embedded",{dependencies:["xr-mode-ui"],schema:{default:!0},sceneOnly:!0,update:function(){var p=this.el,f=p.querySelector(".a-enter-vr");this.data===!0?(f&&f.classList.add("embedded"),p.removeFullScreenStyles()):(f&&f.classList.remove("embedded"),p.addFullScreenStyles())}})},"./src/components/scene/fog.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/debug.js");f("components:fog:warn"),l.exports.Component=d("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},sceneOnly:!0,update:function(){var g=this.data,y=this.el,x=this.el.object3D.fog;if(!x||g.type!==x.name){y.object3D.fog=m(g);return}Object.keys(this.schema).forEach(function(v){var _=g[v];v==="color"&&(_=new p.Color(_)),x[v]=_})},remove:function(){var g=this.el,y=this.el.object3D.fog;y&&(g.object3D.fog=null)}});function m(g){var y;return g.type==="exponential"?y=new p.FogExp2(g.color,g.density):y=new p.Fog(g.color,g.near,g.far),y.name=g.type,y}},"./src/components/scene/inspector.js":(l,u,c)=>{var d=c("./src/constants/index.js").AFRAME_INJECTED,p=c("./package.json"),f=c("./src/core/component.js").registerComponent,m=c("./src/utils/index.js");function g(T){var w=T.split(".");return w[2]="x",w.join(".")}var y="https://unpkg.com/aframe-inspector@"+g(p.version)+"/dist/aframe-inspector.min.js",x=y,v="Loading Inspector",_="Error loading Inspector";l.exports.Component=f("inspector",{schema:{url:{default:x}},sceneOnly:!0,init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var T;this.firstPlay&&(T=m.getUrlParameter("inspector"),T!=="false"&&T&&(this.openInspector(),this.firstPlay=!1))},initOverlay:function(){var T='<span class="dots"><span>.</span><span>.</span><span>.</span></span>';this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML=v+T},remove:function(){this.removeEventListeners()},onKeydown:function(T){var w=T.keyCode===73&&(T.ctrlKey&&T.altKey||T.getModifierState("AltGraph"));w&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(T){T.data==="INJECT_AFRAME_INSPECTOR"&&this.openInspector()},openInspector:function(T){var w=this,S;if(AFRAME.INSPECTOR||AFRAME.inspectorInjected){AFRAME.INSPECTOR.open(T);return}this.showLoader(),S=document.createElement("script"),S.src=this.data.url,S.setAttribute("data-name","aframe-inspector"),S.setAttribute(d,""),S.onload=function(){AFRAME.INSPECTOR.open(T),w.hideLoader(),w.removeEventListeners()},S.onerror=function(){w.loadingMessageEl.innerHTML=_},document.head.appendChild(S),AFRAME.inspectorInjected=!0},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}})},"./src/components/scene/keyboard-shortcuts.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js").shouldCaptureKeyEvent;l.exports.Component=d("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},sceneOnly:!0,init:function(){this.onKeyup=this.onKeyup.bind(this)},update:function(f){var m=this.data;this.enterVREnabled=m.enterVR},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(f){var m=this.el;p(f)&&(this.enterVREnabled&&f.keyCode===70&&m.enterVR(),this.enterVREnabled&&f.keyCode===27&&m.exitVR())}})},"./src/components/scene/pool.js":(l,u,c)=>{var d=c("./src/utils/debug.js"),p=c("./src/core/component.js").registerComponent,f=d("components:pool:warn");l.exports.Component=p("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},sceneOnly:!0,multiple:!0,initPool:function(){var m;for(this.availableEls=[],this.usedEls=[],this.data.mixin||f("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||f("Container "+this.data.container+" not found.")),this.container=this.container||this.el,m=0;m<this.data.size;++m)this.createEntity()},update:function(m){var g=this.data;(m.mixin!==g.mixin||m.size!==g.size)&&this.initPool()},createEntity:function(){var m;m=document.createElement("a-entity"),m.play=this.wrapPlay(m.play),m.setAttribute("mixin",this.data.mixin),m.object3D.visible=!1,m.pause(),this.container.appendChild(m),this.availableEls.push(m);var g=this.usedEls;m.addEventListener("loaded",function(){g.indexOf(m)===-1&&(m.object3DParent=m.object3D.parent,m.object3D.parent.remove(m.object3D))})},wrapPlay:function(m){var g=this.usedEls;return function(){g.indexOf(this)!==-1&&m.call(this)}},requestEntity:function(){var m;if(this.availableEls.length===0){if(this.data.dynamic===!1){f("Requested entity from empty pool: "+this.attrName);return}else f("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName);this.createEntity()}return m=this.availableEls.shift(),this.usedEls.push(m),m.object3DParent&&(m.object3DParent.add(m.object3D),this.updateRaycasters()),m.object3D.visible=!0,m},returnEntity:function(m){var g=this.usedEls.indexOf(m);if(g===-1){f("The returned entity was not previously pooled from "+this.attrName);return}return this.usedEls.splice(g,1),this.availableEls.push(m),m.object3DParent=m.object3D.parent,m.object3D.parent.remove(m.object3D),this.updateRaycasters(),m.object3D.visible=!1,m.pause(),m},updateRaycasters:function(){var m=document.querySelectorAll("[raycaster]");m.forEach(function(g){g.components.raycaster.setDirty()})}})},"./src/components/scene/real-world-meshing.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");l.exports.Component=d("real-world-meshing",{schema:{filterLabels:{type:"array"},meshesEnabled:{default:!0},meshMixin:{default:!0},planesEnabled:{default:!0},planeMixin:{default:""}},sceneOnly:!0,init:function(){var f=this.el.getAttribute("webxr"),m=f.requiredFeatures;m.indexOf("mesh-detection")===-1&&(m.push("mesh-detection"),this.el.setAttribute("webxr",f)),m.indexOf("plane-detection")===-1&&(m.push("plane-detection"),this.el.setAttribute("webxr",f)),this.meshEntities=[],this.initWorldMeshEntity=this.initWorldMeshEntity.bind(this)},tick:function(){this.el.is("ar-mode")&&(this.detectMeshes(),this.updateMeshes())},detectMeshes:function(){var f=this.data,m,g,y=this.el;y.renderer.xr;var x,v=this.meshEntities,_=!1,T=[],w=this.data.filterLabels;x=y.frame,m=x.detectedMeshes,g=x.detectedPlanes;for(var S=0;S<v.length;S++)v[S].present=!1;if(f.meshesEnabled){for(var R of m.values())if(!(w.length&&w.indexOf(R.semanticLabel)===-1)){for(S=0;S<v.length;S++)if(R===v[S].mesh){_=!0,v[S].present=!0,v[S].lastChangedTime<R.lastChangedTime&&this.updateMeshGeometry(v[S].el,R),v[S].lastChangedTime=R.lastChangedTime;break}_||T.push(R),_=!1}}if(f.planesEnabled){for(R of g.values())if(!(w.length&&w.indexOf(R.semanticLabel)===-1)){for(S=0;S<v.length;S++)if(R===v[S].mesh){_=!0,v[S].present=!0,v[S].lastChangedTime<R.lastChangedTime&&this.updateMeshGeometry(v[S].el,R),v[S].lastChangedTime=R.lastChangedTime;break}_||T.push(R),_=!1}}this.deleteMeshes(),this.createNewMeshes(T)},updateMeshes:function(){var f=new p.Matrix4;return function(){for(var m,g=this.el,y,x=g.frame,v=this.meshEntities,_=g.renderer.xr.getReferenceSpace(),T,w=0;w<v.length;w++)T=v[w].mesh.meshSpace||v[w].mesh.planeSpace,m=x.getPose(T,_),y=v[w].el,y.hasLoaded&&(f.fromArray(m.transform.matrix),f.decompose(y.object3D.position,y.object3D.quaternion,y.object3D.scale))}}(),deleteMeshes:function(){for(var f=this.meshEntities,m=[],g=0;g<f.length;g++)f[g].present?m.push(f[g]):this.el.removeChild(f[g]);this.meshEntities=m},createNewMeshes:function(f){for(var m,g=0;g<f.length;g++)m=document.createElement("a-entity"),this.meshEntities.push({mesh:f[g],el:m}),m.addEventListener("loaded",this.initWorldMeshEntity),this.el.appendChild(m)},initMeshGeometry:function(f){var m,g,y;if(f instanceof XRPlane){g=new p.Shape,y=f.polygon;for(var x=0;x<y.length;++x)x===0?g.moveTo(y[x].x,y[x].z):g.lineTo(y[x].x,y[x].z);return m=new p.ShapeGeometry(g),m.rotateX(Math.PI/2),m}return m=new p.BufferGeometry,m.setAttribute("position",new p.BufferAttribute(f.vertices,3)),m.setIndex(new p.BufferAttribute(f.indices,1)),m},initWorldMeshEntity:function(f){for(var m=f.target,g,y,x,v=this.meshEntities,_=0;_<v.length;_++)if(v[_].el===m){x=v[_];break}g=this.initMeshGeometry(x.mesh),y=new p.Mesh(g,new p.MeshBasicMaterial({color:Math.random()*16777215,side:p.DoubleSide})),m.setObject3D("mesh",y),x.mesh instanceof XRPlane&&this.data.planeMixin?m.setAttribute("mixin",this.data.planeMixin):this.data.meshMixin&&m.setAttribute("mixin",this.data.meshMixin),m.setAttribute("data-world-mesh",x.mesh.semanticLabel)},updateMeshGeometry:function(f,m){var g=f.getObject3D("mesh");g.geometry.dispose(),g.geometry=this.initMeshGeometry(m)}})},"./src/components/scene/reflection.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;function p(f,m,g,y){var x=Math.max(f.primaryLightIntensity.x,Math.max(f.primaryLightIntensity.y,f.primaryLightIntensity.z));m.sh.fromArray(f.sphericalHarmonicsCoefficients),m.intensity=1,g&&(g.color.setRGB(f.primaryLightIntensity.x/x,f.primaryLightIntensity.y/x,f.primaryLightIntensity.z/x),g.intensity=x,y.copy(f.primaryLightDirection))}l.exports.Component=d("reflection",{schema:{directionalLight:{type:"selector"}},sceneOnly:!0,init:function(){var f=this;this.cubeRenderTarget=new THREE.WebGLCubeRenderTarget(16),this.cubeCamera=new THREE.CubeCamera(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new THREE.WebGLCubeRenderTarget(16).texture,this.needsVREnvironmentUpdate=!0;var m=this.el.getAttribute("webxr"),g=m.optionalFeatures;g.includes("light-estimation")||(g.push("light-estimation"),this.el.setAttribute("webxr",m)),this.el.addEventListener("enter-vr",function(){if(f.el.is("ar-mode")){var y=f.el.renderer,x=y.xr.getSession();x.requestLightProbe&&f.startLightProbe()}}),this.el.addEventListener("exit-vr",function(){f.xrLightProbe&&f.stopLightProbe()}),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var f=this.el.renderer,m=f.xr.getSession(),g=this,y=f.getContext();if(!this.probeLight){var x=document.createElement("a-light");x.setAttribute("type","probe"),x.setAttribute("intensity",0),this.el.appendChild(x),this.probeLight=x}switch(m.preferredReflectionFormat){case"srgba8":y.getExtension("EXT_sRGB");break;case"rgba16f":y.getExtension("OES_texture_half_float");break}this.glBinding=new XRWebGLBinding(m,y),y.getExtension("EXT_sRGB"),y.getExtension("OES_texture_half_float"),m.requestLightProbe().then(function(v){g.xrLightProbe=v,v.addEventListener("reflectionchange",g.updateXRCubeMap.bind(g))}).catch(function(v){console.warn("Lighting estimation not supported: "+v.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')})},updateXRCubeMap:function(){var f=this.el.renderer,m=this.glBinding.getReflectionCubeMap(this.xrLightProbe);if(m){var g=f.properties.get(this.lightingEstimationTexture);g.__webglTexture=m,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture}},tick:function(){var f=this.el.object3D,m=this.el.renderer,g=this.el.frame;if(g&&this.xrLightProbe){var y=g.getLightEstimate(this.xrLightProbe);y&&p(y,this.probeLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.object3D.position)}this.needsVREnvironmentUpdate&&(f.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(m,f),f.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&g&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.probeLight&&this.el.removeChild(this.probeLight)}})},"./src/components/scene/screenshot.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),m=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join(`
`);l.exports.Component=d("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},sceneOnly:!0,setup:function(){var g=this.el;if(!this.canvas){var y=g.renderer.getContext();y&&(this.cubeMapSize=y.getParameter(y.MAX_CUBE_MAP_TEXTURE_SIZE),this.material=new p.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:f,fragmentShader:m,side:p.DoubleSide}),this.quad=new p.Mesh(new p.PlaneGeometry(1,1),this.material),this.quad.visible=!1,this.camera=new p.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),g.object3D.add(this.quad),this.onKeyDown=this.onKeyDown.bind(this))}},getRenderTarget:function(g,y){return new p.WebGLRenderTarget(g,y,{colorSpace:this.el.sceneEl.renderer.outputColorSpace,minFilter:p.LinearFilter,magFilter:p.LinearFilter,wrapS:p.ClampToEdgeWrapping,wrapT:p.ClampToEdgeWrapping,format:p.RGBAFormat,type:p.UnsignedByteType})},resize:function(g,y){this.quad.scale.set(g,y,1),this.camera.left=-1*g/2,this.camera.right=g/2,this.camera.top=y/2,this.camera.bottom=-1*y/2,this.camera.updateProjectionMatrix(),this.canvas.width=g,this.canvas.height=y},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(g){var y=g.keyCode===83&&g.ctrlKey&&g.altKey;if(!(!this.data||!y)){var x=g.shiftKey?"equirectangular":"perspective";this.capture(x)}},setCapture:function(g){var y=this.el,x,v,_,T;return g==="perspective"?(this.quad.visible=!1,v=this.data.camera&&this.data.camera.components.camera.camera||y.camera,x={width:this.data.width,height:this.data.height}):(v=this.camera,T=new p.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:p.RGBFormat,generateMipmaps:!0,minFilter:p.LinearMipmapLinearFilter,colorSpace:p.SRGBColorSpace}),_=new p.CubeCamera(y.camera.near,y.camera.far,T),y.camera.getWorldPosition(_.position),y.camera.getWorldQuaternion(_.quaternion),_.update(y.renderer,y.object3D),this.quad.material.uniforms.map.value=_.renderTarget.texture,x={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:v,size:x,projection:g}},capture:function(g){var y=this.el.renderer.xr.enabled,x=this.el.renderer,v;this.setup(),x.xr.enabled=!1,v=this.setCapture(g),this.renderCapture(v.camera,v.size,v.projection),this.saveCapture(),x.xr.enabled=y},getCanvas:function(g){var y=this.el.renderer.xr.enabled,x=this.el.renderer;this.setup();var v=this.setCapture(g);return x.xr.enabled=!1,this.renderCapture(v.camera,v.size,v.projection),x.xr.enabled=y,this.canvas},renderCapture:function(g,y,x){var v=this.el.renderer.autoClear,_=this.el,T,w,S,R=_.renderer;w=this.getRenderTarget(y.width,y.height),S=new Uint8Array(4*y.width*y.height),this.resize(y.width,y.height),R.autoClear=!0,R.clear(),R.setRenderTarget(w),R.render(_.object3D,g),R.autoClear=v,R.readRenderTargetPixels(w,0,0,y.width,y.height,S),R.setRenderTarget(null),x==="perspective"&&(S=this.flipPixelsVertically(S,y.width,y.height)),T=new ImageData(new Uint8ClampedArray(S),y.width,y.height),this.quad.visible=!1,this.ctx.putImageData(T,0,0)},flipPixelsVertically:function(g,y,x){for(var v=g.slice(0),_=0;_<y;++_)for(var T=0;T<x;++T)v[_*4+T*y*4]=g[_*4+(x-T)*y*4],v[_*4+1+T*y*4]=g[_*4+1+(x-T)*y*4],v[_*4+2+T*y*4]=g[_*4+2+(x-T)*y*4],v[_*4+3+T*y*4]=g[_*4+3+(x-T)*y*4];return v},saveCapture:function(){this.canvas.toBlob(function(g){var y="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",x=document.createElement("a"),v=URL.createObjectURL(g);x.href=v,x.setAttribute("download",y),x.innerHTML="downloading...",x.style.display="none",document.body.appendChild(x),setTimeout(function(){x.click(),document.body.removeChild(x)},1)},"image/png")}})},"./src/components/scene/stats.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./vendor/rStats.js"),f=c("./src/utils/index.js");c("./vendor/rStats.extras.js"),c("./src/lib/rStatsAframe.js");var m=window.aframeStats,g="a-hidden",y=window.threeStats;l.exports.Component=d("stats",{schema:{default:!0},sceneOnly:!0,init:function(){var v=this.el;f.getUrlParameter("stats")!=="false"&&(this.stats=x(v),this.statsEl=document.querySelector(".rs-base"),this.hideBound=this.hide.bind(this),this.showBound=this.show.bind(this),v.addEventListener("enter-vr",this.hideBound),v.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var v=this.stats;v&&(v("rAF").tick(),v("FPS").frame(),v().update())},hide:function(){this.statsEl.classList.add(g)},show:function(){this.statsEl.classList.remove(g)}});function x(v){var _=new y(v.renderer),T=new m(v),w=v.isMobile?[]:[_,T];return new p({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:w})}},"./src/components/scene/xr-mode-ui.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/constants/index.js"),f=c("./src/utils/index.js"),m="a-enter-vr",g="a-enter-ar",y="a-enter-vr-button",x="a-enter-ar-button",v="a-hidden",_="a-orientation-modal";l.exports.Component=d("xr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},cardboardModeEnabled:{default:!1},enterVRButton:{default:""},enterVREnabled:{default:!0},enterARButton:{default:""},enterAREnabled:{default:!0},XRMode:{default:"vr",oneOf:["vr","ar","xr"]}},sceneOnly:!0,init:function(){var B=this,I=this.el;f.getUrlParameter("ui")!=="false"&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),I.addEventListener("enter-vr",this.updateEnterInterfaces),I.addEventListener("exit-vr",this.updateEnterInterfaces),I.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(D){D.data.type==="loaderReady"&&(B.insideLoader=!0,B.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=this.onEnterVRButtonClick.bind(this),this.onEnterARButtonClick=this.onEnterARButtonClick.bind(this),this.onModalClick=this.onModalClick.bind(this),this.toggleOrientationModalIfNeeded=this.toggleOrientationModalIfNeeded.bind(this),this.updateEnterInterfaces=this.updateEnterInterfaces.bind(this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var B=this.data,I=this.el;if(!B.enabled||this.insideLoader||f.getUrlParameter("ui")==="false")return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(!this.enterVREl&&B.enterVREnabled&&(B.XRMode==="xr"||B.XRMode==="vr")&&(B.enterVRButton?(this.enterVREl=document.querySelector(B.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=T(this.onEnterVRButtonClick),I.appendChild(this.enterVREl))),!this.enterAREl&&B.enterAREnabled&&(B.XRMode==="xr"||B.XRMode==="ar")&&(B.enterARButton?(this.enterAREl=document.querySelector(B.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=w(this.onEnterARButtonClick,B.XRMode==="xr"),I.appendChild(this.enterAREl))),this.orientationModalEl=S(this.onModalClick),I.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function(B){B&&B.parentNode&&B.parentNode.removeChild(B)}),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var B=this.el;this.enterVREl&&(B.is("vr-mode")||(B.isMobile||f.device.isMobileDeviceRequestingDesktopSite())&&!this.data.cardboardModeEnabled&&!f.device.checkVRSupport()?this.enterVREl.classList.add(v):(f.device.checkVRSupport()||this.enterVREl.classList.add("fullscreen"),this.enterVREl.classList.remove(v),B.enterVR(!1,!0)))},toggleEnterARButtonIfNeeded:function(){var B=this.el;this.enterAREl&&(B.is("vr-mode")||!f.device.checkARSupport()?this.enterAREl.classList.add(v):(this.enterAREl.classList.remove(v),B.enterVR(!0,!0)))},toggleOrientationModalIfNeeded:function(){var B=this.el,I=this.orientationModalEl;!I||!B.isMobile||(!f.device.isLandscape()&&B.is("vr-mode")?I.classList.remove(v):I.classList.add(v))}});function T(B){var I,D;return D=document.createElement("div"),D.classList.add(m),D.setAttribute(p.AFRAME_INJECTED,""),I=document.createElement("button"),I.className=y,I.setAttribute("title","Enter VR mode with a headset or fullscreen without"),I.setAttribute(p.AFRAME_INJECTED,""),f.device.isMobile()&&R(I),D.appendChild(I),I.addEventListener("click",function(L){B(),L.stopPropagation()}),D}function w(B,I){var D,L;return L=document.createElement("div"),L.classList.add(g),I&&L.classList.add("xr"),L.setAttribute(p.AFRAME_INJECTED,""),D=document.createElement("button"),D.className=x,D.setAttribute("title","Enter AR mode with a headset or handheld device."),D.setAttribute(p.AFRAME_INJECTED,""),f.device.isMobile()&&R(D),L.appendChild(D),D.addEventListener("click",function(O){B(),O.stopPropagation()}),L}function S(B){var I=document.createElement("div");I.className=_,I.classList.add(v),I.setAttribute(p.AFRAME_INJECTED,"");var D=document.createElement("button");return D.setAttribute(p.AFRAME_INJECTED,""),D.innerHTML="Exit VR",D.addEventListener("click",B),I.appendChild(D),I}function R(B){B.addEventListener("touchstart",function(){B.classList.remove("resethover")},{passive:!0}),B.addEventListener("touchend",function(){B.classList.add("resethover")},{passive:!0})}},"./src/components/shadow.js":(l,u,c)=>{var d=c("./src/core/component.js"),p=c("./src/lib/three.js"),f=d.registerComponent;l.exports.Component=f("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=this.update.bind(this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var m=this.data;this.updateDescendants(m.cast,m.receive)},remove:function(){var m=this.el;m.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(m,g){var y=this.el.sceneEl;this.el.object3D.traverse(function(x){if(x instanceof p.Mesh&&(x.castShadow=m,x.receiveShadow=g,y.hasLoaded&&x.material))for(var v=Array.isArray(x.material)?x.material:[x.material],_=0;_<v.length;_++)v[_].needsUpdate=!0})}})},"./src/components/sound.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/debug.js"),f=c("./src/lib/three.js"),m=p("components:sound:warn");l.exports.Component=d("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},loopStart:{default:0},loopEnd:{default:0},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var g=this;this.listener=null,this.audioLoader=new f.AudioLoader,this.pool=new f.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){g.playSound()}},update:function(g){var y=this.data,x,v,_=y.src!==g.src;if(_){if(!y.src)return;this.setupSound()}for(x=0;x<this.pool.children.length;x++)v=this.pool.children[x],y.positional&&(v.setDistanceModel(y.distanceModel),v.setMaxDistance(y.maxDistance),v.setRefDistance(y.refDistance),v.setRolloffFactor(y.rolloffFactor)),v.setLoop(y.loop),v.setLoopStart(y.loopStart),y.loopStart!==0&&y.loopEnd===0?v.setLoopEnd(v.buffer.duration):v.setLoopEnd(y.loopEnd),v.setVolume(y.volume),v.isPaused=!1;if(y.on!==g.on&&this.updateEventListener(g.on),_){var T=this;this.loaded=!1,this.audioLoader.load(y.src,function(w){for(x=0;x<T.pool.children.length;x++)v=T.pool.children[x],v.setBuffer(w);T.loaded=!0,f.Cache.remove(y.src),(T.data.autoplay||T.mustPlay)&&T.playSound(T.processSound),T.el.emit("sound-loaded",T.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var g,y;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(g=0;g<this.pool.children.length;g++)y=this.pool.children[g],y.disconnect()}catch{m("Audio source not properly disconnected")}},updateEventListener:function(g){var y=this.el;g&&y.removeEventListener(g,this.playSoundBound),y.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var g=this.el,y,x=g.sceneEl,v=this,_;this.pool.children.length>0&&(this.stopSound(),g.removeObject3D("sound"));var T=this.listener=x.audioListener||new f.AudioListener;for(x.audioListener=T,x.camera&&x.camera.add(T),x.addEventListener("camera-set-active",function(w){w.detail.cameraEl.getObject3D("camera").add(T)}),this.pool=new f.Group,y=0;y<this.data.poolSize;y++)_=this.data.positional?new f.PositionalAudio(T):new f.Audio(T),this.pool.add(_);for(g.setObject3D(this.attrName,this.pool),y=0;y<this.pool.children.length;y++)_=this.pool.children[y],_.onEnded=function(){this.isPlaying=!1,v.el.emit("sound-ended",v.evtDetail,!1)}},pauseSound:function(){var g,y;for(this.isPlaying=!1,g=0;g<this.pool.children.length;g++)y=this.pool.children[g],!(!y.source||!y.source.buffer||!y.isPlaying||y.isPaused)&&(y.isPaused=!0,y.pause())},playSound:function(g){var y,x,v;if(!this.loaded){m("Sound not loaded yet. It will be played once it finished loading"),this.mustPlay=!0,this.processSound=g;return}for(y=!1,this.isPlaying=!0,x=0;x<this.pool.children.length;x++)if(v=this.pool.children[x],!v.isPlaying&&v.buffer&&!y){g&&g(v),v.play(),v.isPaused=!1,y=!0;continue}if(!y){m("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el);return}this.mustPlay=!1,this.processSound=void 0},stopSound:function(){var g,y;for(this.isPlaying=!1,g=0;g<this.pool.children.length;g++){if(y=this.pool.children[g],!y.source||!y.source.buffer)return;y.stop()}}})},"./src/components/text.js":(l,u,c)=>{var d=c("./node_modules/three-bmfont-text/index.js"),p=c("./node_modules/load-bmfont/browser.js"),f=c("./src/core/component.js").registerComponent,m=c("./src/core/shader.js"),g=c("./src/lib/three.js"),y=c("./src/utils/index.js"),x=y.debug("components:text:error"),v=m.shaders,_=y.debug("components:text:warn"),T=1,w=16,S=c("./src/constants/index.js").AFRAME_CDN_ROOT,R=S+"fonts/",B={aileronsemibold:R+"Aileron-Semibold.fnt",dejavu:R+"DejaVu-sdf.fnt",exo2bold:R+"Exo2Bold.fnt",exo2semibold:R+"Exo2SemiBold.fnt",kelsonsans:R+"KelsonSans.fnt",monoid:R+"Monoid.fnt",mozillavr:R+"mozillavr.fnt",roboto:R+"Roboto-msdf.json",sourcecodepro:R+"SourceCodePro.fnt"},I=["roboto"],D="roboto";l.exports.FONTS=B;var L=new ie,O={},U={},J=/^\w+:/;l.exports.Component=f("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:D},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:v},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=d(),this.createOrUpdateMaterial(),this.explicitGeoDimensionsChecked=!1},update:function(Y){var ae=this.data,xe=this.currentFont;if(U[ae.font]?this.texture=U[ae.font]:(this.texture=U[ae.font]=new g.Texture,this.texture.anisotropy=w),this.createOrUpdateMaterial(),Y.font!==ae.font){this.updateFont();return}xe&&(this.updateGeometry(this.geometry,xe),this.updateLayout())},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var Y=this.data,ae,xe=this.material,fe,de=this.shaderData,Ie;if(Ie=Y.shader,I.indexOf(Y.font)!==-1||Y.font.indexOf("-msdf.")>=0?Ie="msdf":Y.font in B&&I.indexOf(Y.font)===-1&&(Ie="sdf"),ae=(this.shaderObject&&this.shaderObject.name)!==Ie,de.alphaTest=Y.alphaTest,de.color=Y.color,de.map=this.texture,de.opacity=Y.opacity,de.side=H(Y.side),de.transparent=Y.transparent,de.negate=Y.negate,!ae){this.shaderObject.update(de),xe.transparent=de.transparent,xe.side=de.side;return}fe=Q(this.el,Ie,de),this.material=fe.material,this.shaderObject=fe.shader,this.material.side=de.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var Y=this.data,ae=this.el,xe,fe=this.geometry,de=this;Y.font||_("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),xe=this.lookupFont(Y.font||D)||Y.font,L.get(xe,function(){return V(xe,Y.yOffset)}).then(function(Ie){var Ge;if(Ie.pages.length!==1)throw new Error("Currently only single-page bitmap fonts are supported.");O[xe]||(Ie.widthFactor=O[Ie]=j(Ie)),de.currentFont=Ie,Ge=de.getFontImageSrc(),L.get(Ge,function(){return $(Ge)}).then(function(Xe){var $e=de.texture;$e&&($e.image=Xe,$e.needsUpdate=!0,U[Y.font]=$e,de.texture=$e,de.initMesh(),de.currentFont=Ie,de.updateGeometry(fe,Ie),de.updateLayout(),de.mesh.visible=!0,ae.emit("textfontset",{font:Y.font,fontObj:Ie}))}).catch(function(Xe){x(Xe.message),x(Xe.stack)})}).catch(function(Ie){x(Ie.message),x(Ie.stack)})},initMesh:function(){this.mesh||(this.mesh=new g.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var Y=this.lookupFont(this.data.font||D)||this.data.font,ae=this.currentFont.pages[0];return ae.match(J)&&ae.indexOf("http")!==0?Y.replace(/(\.fnt)|(\.json)/,".png"):g.LoaderUtils.extractUrlBase(Y)+ae},updateLayout:function(){var Y,ae,xe=this.el,fe=this.data,de=this.geometry,Ie,Ge,Xe,$e=this.mesh,lt,At,Gt,gt,yi;if(!(!$e||!de.layout)){if(Ie=xe.getAttribute("geometry"),Gt=fe.width||Ie&&Ie.width||T,lt=G(fe.wrapPixels,fe.wrapCount,this.currentFont.widthFactor),At=Gt/lt,Xe=de.layout,Ge=At*(Xe.height+Xe.descender),Ie&&Ie.primitive==="plane"&&(this.explicitGeoDimensionsChecked||(this.explicitGeoDimensionsChecked=!0,this.hasExplicitGeoWidth=!!Ie.width,this.hasExplicitGeoHeight=!!Ie.height),this.hasExplicitGeoWidth||xe.setAttribute("geometry","width",Gt),this.hasExplicitGeoHeight||xe.setAttribute("geometry","height",Ge)),Y=fe.anchor==="align"?fe.align:fe.anchor,Y==="left")gt=0;else if(Y==="right")gt=-1*Xe.width;else if(Y==="center")gt=-1*Xe.width/2;else throw new TypeError("Invalid text.anchor property value",Y);if(ae=fe.baseline,ae==="bottom")yi=0;else if(ae==="top")yi=-1*Xe.height+Xe.ascender;else if(ae==="center")yi=-1*Xe.height/2;else throw new TypeError("Invalid text.baseline property value",ae);$e.position.x=gt*At+fe.xOffset,$e.position.y=yi*At,$e.position.z=fe.zOffset,$e.scale.set(At,-1*At,At)}},lookupFont:function(Y){return B[Y]},updateGeometry:function(){var Y={},ae={},xe=/\\n/g,fe=/\\t/g;return function(de,Ie){var Ge=this.data;ae.font=Ie,ae.lineHeight=Ge.lineHeight&&isFinite(Ge.lineHeight)?Ge.lineHeight:Ie.common.lineHeight,ae.text=Ge.value.toString().replace(xe,`
`).replace(fe,"	"),ae.width=G(Ge.wrapPixels,Ge.wrapCount,Ie.widthFactor),de.update(y.extend(Y,Ge,ae))}}()});function H(Y){switch(Y){case"back":return g.FrontSide;case"double":return g.DoubleSide;default:return g.BackSide}}function V(Y,ae){return new Promise(function(xe,fe){p(Y,function(de,Ie){if(de){x("Error loading font",Y),fe(de);return}Y.indexOf("/Roboto-msdf.json")>=0&&(ae=30),ae&&Ie.chars.map(function(Ge){Ge.yoffset+=ae}),xe(Ie)})})}function $(Y){return new Promise(function(ae,xe){new g.ImageLoader().load(Y,function(fe){ae(fe)},void 0,function(){x("Error loading font image",Y),xe(null)})})}function Q(Y,ae,xe){var fe,de;return de=new v[ae].Shader,de.el=Y,de.init(xe),de.update(xe),fe=de.material,fe.transparent=xe.transparent,{material:fe,shader:de}}function G(Y,ae,xe){return Y||(.5+ae)*xe}function j(Y){var ae=0,xe=0,fe=0;return Y.chars.map(function(de){ae+=de.xadvance,de.id>=48&&de.id<=57&&(fe++,xe+=de.xadvance)}),fe?xe/fe:ae/Y.chars.length}function ie(){var Y=this.cache={};this.get=function(ae,xe){return ae in Y||(Y[ae]=xe()),Y[ae]}}},"./src/components/tracked-controls-webvr.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=c("./src/constants/index.js").DEFAULT_CAMERA_HEIGHT,m=c("./src/lib/three.js"),g=c("./src/constants/index.js").DEFAULT_HANDEDNESS,y={x:.175,y:-.3,z:-.03},x={x:0,y:0,z:-.175},v={touches:[]},_={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};l.exports.Component=d("tracked-controls-webvr",{schema:{autoHide:{default:!0},controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"}},init:function(){this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.changedAxes=[],this.targetControllerNumber=this.data.controller,this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.deltaControllerPosition=new m.Vector3,this.controllerQuaternion=new m.Quaternion,this.controllerEuler=new m.Euler,this.updateGamepad(),this.buttonEventDetails={}},tick:function(T,w){var S=this.el.getObject3D("mesh");S&&S.update&&S.update(w/1e3),this.updateGamepad(),this.updatePose(),this.updateButtons()},defaultUserHeight:function(){return f},getHeadElement:function(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function(){var T=this.data,w=p.findMatchingControllerWebVR(this.system.controllers,T.id,T.idPrefix,T.hand,T.controller);this.controller=w,this.el.components["tracked-controls"].controller=w,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},applyArmModel:function(T){var w=this.controller,S=this.controllerEuler,R=this.controllerQuaternion,B=this.deltaControllerPosition,I,D,L,O,U;D=this.getHeadElement(),L=D.object3D,U=this.defaultUserHeight(),O=w.pose,I=(w?w.hand:void 0)||g,T.copy(L.position),B.set(y.x*(I==="left"?-1:I==="right"?1:0),y.y,y.z),B.multiplyScalar(U),B.applyAxisAngle(L.up,L.rotation.y),T.add(B),B.set(x.x,x.y,x.z),B.multiplyScalar(U),O.orientation?R.fromArray(O.orientation):R.copy(L.quaternion),S.setFromQuaternion(R),S.set(S.x,S.y,0),B.applyEuler(S),T.add(B)},updatePose:function(){var T=this.controller,w=this.data,S=this.el.object3D,R,B=this.system.vrDisplay,I;T&&(R=T.pose,R.position?S.position.fromArray(R.position):w.armModel&&this.applyArmModel(S.position),R.orientation&&S.quaternion.fromArray(R.orientation),B&&R.position&&(I=this.el.sceneEl.renderer.xr.getStandingMatrix(),S.matrix.compose(S.position,S.quaternion,S.scale),S.matrix.multiplyMatrices(I,S.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),S.rotateX(this.data.orientationOffset.x*m.MathUtils.DEG2RAD),S.rotateY(this.data.orientationOffset.y*m.MathUtils.DEG2RAD),S.rotateZ(this.data.orientationOffset.z*m.MathUtils.DEG2RAD))},updateButtons:function(){var T,w=this.controller,S;if(w){for(S=0;S<w.buttons.length;++S)this.buttonStates[S]||(this.buttonStates[S]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[S]||(this.buttonEventDetails[S]={id:S,state:this.buttonStates[S]}),T=w.buttons[S],this.handleButton(S,T);this.handleAxes()}},handleButton:function(T,w){var S;return S=this.handlePress(T,w)|this.handleTouch(T,w)|this.handleValue(T,w),S?(this.el.emit(_.BUTTONCHANGED,this.buttonEventDetails[T],!1),!0):!1},handleAxes:function(){var T=!1,w=this.controller.axes,S,R=this.axis,B=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),S=0;S<w.length;++S)B.push(R[S]!==w[S]),B[S]&&(T=!0);if(!T)return!1;for(this.axis.splice(0,this.axis.length),S=0;S<w.length;S++)this.axis.push(w[S]);return this.el.emit(_.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(T,w){var S,R=this.buttonStates[T];return w.pressed===R.pressed?!1:(S=w.pressed?_.BUTTONDOWN:_.BUTTONUP,this.el.emit(S,this.buttonEventDetails[T],!1),R.pressed=w.pressed,!0)},handleTouch:function(T,w){var S,R=this.buttonStates[T];return w.touched===R.touched?!1:(S=w.touched?_.TOUCHSTART:_.TOUCHEND,this.el.emit(S,this.buttonEventDetails[T],!1,v),R.touched=w.touched,!0)},handleValue:function(T,w){var S=this.buttonStates[T];return w.value===S.value?!1:(S.value=w.value,!0)}})},"./src/components/tracked-controls-webxr.js":(l,u,c)=>{var d=c("./src/utils/tracked-controls.js"),p=c("./src/core/component.js").registerComponent,f={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};l.exports.Component=p("tracked-controls-webxr",{schema:{id:{type:"string",default:""},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},index:{type:"int",default:-1},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"gripSpace"}},init:function(){this.updateController=this.updateController.bind(this),this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes}},update:function(){this.updateController()},play:function(){var m=this.el.sceneEl;this.updateController(),m.addEventListener("controllersupdated",this.updateController)},pause:function(){var m=this.el.sceneEl;m.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(m){return!(!this.controller||this.controller.gamepad||m.inputSource.handedness!=="none"&&m.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=d.findMatchingControllerWebXR(this.system.controllers,this.data.id,this.data.hand,this.data.index,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},tick:function(){var m=this.el.sceneEl,g=this.controller,y=m.frame;!g||!m.frame||!this.system.referenceSpace||g.hand||(this.pose=y.getPose(g[this.data.space],this.system.referenceSpace),this.updatePose(),this.updateButtons())},updatePose:function(){var m=this.el.object3D,g=this.pose;g&&(m.matrix.elements=g.transform.matrix,m.matrix.decompose(m.position,m.rotation,m.scale))},updateButtons:function(){var m,g,y=this.controller,x;if(!(!y||!y.gamepad)){for(x=y.gamepad,g=0;g<x.buttons.length;++g)this.buttonStates[g]||(this.buttonStates[g]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[g]||(this.buttonEventDetails[g]={id:g,state:this.buttonStates[g]}),m=x.buttons[g],this.handleButton(g,m);this.handleAxes()}},handleButton:function(m,g){var y;return y=this.handlePress(m,g)|this.handleTouch(m,g)|this.handleValue(m,g),y?(this.el.emit(f.BUTTONCHANGED,this.buttonEventDetails[m],!1),!0):!1},handleAxes:function(){var m=!1,g=this.controller.gamepad.axes,y,x=this.axis,v=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),y=0;y<g.length;++y)v.push(x[y]!==g[y]),v[y]&&(m=!0);if(!m)return!1;for(this.axis.splice(0,this.axis.length),y=0;y<g.length;y++)this.axis.push(g[y]);return this.el.emit(f.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(m,g){var y,x=this.buttonStates[m];return g.pressed===x.pressed?!1:(y=g.pressed?f.BUTTONDOWN:f.BUTTONUP,this.el.emit(y,this.buttonEventDetails[m],!1),x.pressed=g.pressed,!0)},handleTouch:function(m,g){var y,x=this.buttonStates[m];return g.touched===x.touched?!1:(y=g.touched?f.TOUCHSTART:f.TOUCHEND,this.el.emit(y,this.buttonEventDetails[m],!1),x.touched=g.touched,!0)},handleValue:function(m,g){var y=this.buttonStates[m];return g.value===y.value?!1:(y.value=g.value,!0)}})},"./src/components/tracked-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("tracked-controls",{schema:{autoHide:{default:!0},controller:{default:-1},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},handTrackingEnabled:{default:!1},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"targetRaySpace"}},after:["tracked-controls-webvr","tracked-controls-webxr"],update:function(){var p=this.data,f=this.el;f.sceneEl.hasWebXR?f.setAttribute("tracked-controls-webxr",{id:p.id,hand:p.hand,index:p.controller,iterateControllerProfiles:p.iterateControllerProfiles,handTrackingEnabled:p.handTrackingEnabled,space:p.space}):f.setAttribute("tracked-controls-webvr",p)}})},"./src/components/valve-index-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),m=f.checkControllerPresentAndSetup,g=f.emitIfAxesChanged,y=f.onButtonEvent,x=c("./src/constants/index.js").AFRAME_CDN_ROOT,v=x+"controllers/valve/index/valve-index-",_={left:v+"left.glb",right:v+"right.glb"},T="valve",w=c("./src/utils/index.js").device.isWebXRAvailable,S={left:{x:-.00023692678902063457,y:.04724540367838371,z:-.061959880395271096},right:{x:.002471558599671131,y:.055765208987076195,z:-.061068168708348844}},R={left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}},B={left:{_x:.692295102620542,_y:-.0627618864318427,_z:-.06265893149611756,_order:"XYZ"},right:{_x:.6484021229942998,_y:-.032563619881892894,_z:-.1327973171917482,_order:"XYZ"}},I={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},D=w?I:B,L=w?R:S;l.exports.Component=d("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},after:["tracked-controls"],mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var O=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(U){y(U.detail.id,"down",O)},this.onButtonUp=function(U){y(U.detail.id,"up",O)},this.onButtonTouchEnd=function(U){y(U.detail.id,"touchend",O)},this.onButtonTouchStart=function(U){y(U.detail.id,"touchstart",O)},this.previousButtonValues={},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var O=this.el;O.addEventListener("buttonchanged",this.onButtonChanged),O.addEventListener("buttondown",this.onButtonDown),O.addEventListener("buttonup",this.onButtonUp),O.addEventListener("touchend",this.onButtonTouchEnd),O.addEventListener("touchstart",this.onButtonTouchStart),O.addEventListener("model-loaded",this.onModelLoaded),O.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var O=this.el;O.removeEventListener("buttonchanged",this.onButtonChanged),O.removeEventListener("buttondown",this.onButtonDown),O.removeEventListener("buttonup",this.onButtonUp),O.removeEventListener("touchend",this.onButtonTouchEnd),O.removeEventListener("touchstart",this.onButtonTouchStart),O.removeEventListener("model-loaded",this.onModelLoaded),O.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var O=this.data,U=O.hand==="right"?0:O.hand==="left"?1:2;m(this,T,{index:U,iterateControllerProfiles:!0,hand:O.hand})},injectTrackedControls:function(){var O=this.el,U=this.data;O.setAttribute("tracked-controls",{idPrefix:T,controller:U.hand==="right"?1:U.hand==="left"?0:2,hand:U.hand,orientationOffset:U.orientationOffset}),this.loadModel()},loadModel:function(){var O=this.data;O.model&&this.el.setAttribute("gltf-model",""+_[O.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(O){var U=this.mapping.buttons[O.detail.id],J=this.buttonMeshes,H;U&&(U==="trigger"&&(H=O.detail.state.value,J&&J.trigger&&(J.trigger.rotation.x=this.triggerOriginalRotationX-H*(Math.PI/40))),this.el.emit(U+"changed",O.detail.state))},onModelLoaded:function(O){var U,J=O.detail.model,H=this;O.target!==this.el||!this.data.model||(U=this.buttonMeshes={},U.grip={left:J.getObjectByName("leftgrip"),right:J.getObjectByName("rightgrip")},U.menu=J.getObjectByName("menubutton"),U.system=J.getObjectByName("systembutton"),U.trackpad=J.getObjectByName("touchpad"),U.trigger=J.getObjectByName("trigger"),this.triggerOriginalRotationX=U.trigger.rotation.x,Object.keys(U).forEach(function(V){H.setButtonColor(V,H.data.buttonColor)}),J.position.copy(L[this.data.hand]),J.rotation.copy(D[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controls",model:this.data.model,rayOrigin:new p.Vector3(0,0,0)}))},onAxisMoved:function(O){g(this,this.mapping.axes,O)},updateModel:function(O,U){var J,H;this.data.model&&(H=U.indexOf("touch")!==-1,!H&&(J=U==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(O,J)))},setButtonColor:function(O,U){}})},"./src/components/visible.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent;l.exports.Component=d("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}})},"./src/components/vive-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,m=p.emitIfAxesChanged,g=p.onButtonEvent,y=c("./src/constants/index.js").AFRAME_CDN_ROOT,x=y+"controllers/vive/vr_controller_vive.obj",v=y+"controllers/vive/vr_controller_vive.mtl",_=c("./src/utils/index.js").device.isWebXRAvailable,T="htc-vive",w="OpenVR ",S=_?T:w,R={axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]},B={axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","none"]},I=_?B:R;l.exports.Component=d("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},after:["tracked-controls"],mapping:I,init:function(){var D=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(L){g(L.detail.id,"down",D)},this.onButtonUp=function(L){g(L.detail.id,"up",D)},this.onButtonTouchEnd=function(L){g(L.detail.id,"touchend",D)},this.onButtonTouchStart=function(L){g(L.detail.id,"touchstart",D)},this.previousButtonValues={},this.bindMethods()},update:function(){var D=this.data;this.controllerIndex=D.hand==="right"?0:D.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var D=this.el;D.addEventListener("buttonchanged",this.onButtonChanged),D.addEventListener("buttondown",this.onButtonDown),D.addEventListener("buttonup",this.onButtonUp),D.addEventListener("touchend",this.onButtonTouchEnd),D.addEventListener("touchstart",this.onButtonTouchStart),D.addEventListener("model-loaded",this.onModelLoaded),D.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var D=this.el;D.removeEventListener("buttonchanged",this.onButtonChanged),D.removeEventListener("buttondown",this.onButtonDown),D.removeEventListener("buttonup",this.onButtonUp),D.removeEventListener("touchend",this.onButtonTouchEnd),D.removeEventListener("touchstart",this.onButtonTouchStart),D.removeEventListener("model-loaded",this.onModelLoaded),D.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var D=this.data;f(this,S,{index:this.controllerIndex,hand:D.hand})},injectTrackedControls:function(){var D=this.el,L=this.data;D.setAttribute("tracked-controls",{idPrefix:S,hand:L.hand,controller:this.controllerIndex,orientationOffset:L.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:x,mtl:v})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(D){var L=this.mapping.buttons[D.detail.id],O=this.buttonMeshes,U;L&&(L==="trigger"&&(U=D.detail.state.value,O&&O.trigger&&(O.trigger.rotation.x=-U*(Math.PI/12))),this.el.emit(L+"changed",D.detail.state))},onModelLoaded:function(D){var L,O=D.detail.model,U=this;D.target!==this.el||!this.data.model||(L=this.buttonMeshes={},L.grip={left:O.getObjectByName("leftgrip"),right:O.getObjectByName("rightgrip")},L.menu=O.getObjectByName("menubutton"),L.system=O.getObjectByName("systembutton"),L.trackpad=O.getObjectByName("touchpad"),L.touchpad=O.getObjectByName("touchpad"),L.trigger=O.getObjectByName("trigger"),Object.keys(L).forEach(function(J){U.setButtonColor(J,U.data.buttonColor)}),O.position.set(0,-.015,.04))},onAxisMoved:function(D){m(this,this.mapping.axes,D)},updateModel:function(D,L){var O,U;this.data.model&&(U=L.indexOf("touch")!==-1,!U&&(O=L==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(D,O)))},setButtonColor:function(D,L){var O=this.buttonMeshes;if(O){if(D==="grip"){O.grip.left.material.color.set(L),O.grip.right.material.color.set(L);return}O[D].material.color.set(L)}}})},"./src/components/vive-focus-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,m=p.emitIfAxesChanged,g=p.onButtonEvent,y=c("./src/constants/index.js").AFRAME_CDN_ROOT,x=y+"controllers/vive/focus-controller/focus-controller.gltf",v=c("./src/utils/index.js").device.isWebXRAvailable,_="htc-vive-focus",T="HTC Vive Focus ",w=v?_:T,S={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},R={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]},B=v?R:S;l.exports.Component=d("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},after:["tracked-controls"],mapping:B,bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var I=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(D){g(D.detail.id,"down",I)},this.onButtonUp=function(D){g(D.detail.id,"up",I)},this.onButtonTouchStart=function(D){g(D.detail.id,"touchstart",I)},this.onButtonTouchEnd=function(D){g(D.detail.id,"touchend",I)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var I=this.el;I.addEventListener("buttonchanged",this.onButtonChanged),I.addEventListener("buttondown",this.onButtonDown),I.addEventListener("buttonup",this.onButtonUp),I.addEventListener("touchstart",this.onButtonTouchStart),I.addEventListener("touchend",this.onButtonTouchEnd),I.addEventListener("model-loaded",this.onModelLoaded),I.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var I=this.el;I.removeEventListener("buttonchanged",this.onButtonChanged),I.removeEventListener("buttondown",this.onButtonDown),I.removeEventListener("buttonup",this.onButtonUp),I.removeEventListener("touchstart",this.onButtonTouchStart),I.removeEventListener("touchend",this.onButtonTouchEnd),I.removeEventListener("model-loaded",this.onModelLoaded),I.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){f(this,w,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var I=this.el,D=this.data;I.setAttribute("tracked-controls",{armModel:D.armModel,idPrefix:w,orientationOffset:D.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",x)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(I){var D=I.detail.model,L;I.target!==this.el||!this.data.model||(L=this.buttonMeshes={},L.trigger=D.getObjectByName("BumperKey"),L.triggerPressed=D.getObjectByName("BumperKey_Press"),L.triggerPressed&&(L.triggerPressed.visible=!1),L.trackpad=D.getObjectByName("TouchPad"),L.trackpadPressed=D.getObjectByName("TouchPad_Press"),L.trackpadPressed&&(L.trackpadPressed.visible=!1))},onButtonChanged:function(I){var D=this.mapping.buttons[I.detail.id];D&&this.el.emit(D+"changed",I.detail.state)},onAxisMoved:function(I){m(this,this.mapping.axes,I)},updateModel:function(I,D){this.data.model&&this.updateButtonModel(I,D)},updateButtonModel:function(I,D){var L=this.buttonMeshes,O=I+"Pressed";if(!(!L||!L[I]||!L[O])){var U;switch(D){case"down":U=this.data.buttonHighlightColor;break;case"touchstart":U=this.data.buttonTouchedColor;break}U&&L[O].material.color.set(U),L[O].visible=!!U,L[I].visible=!U}}})},"./src/components/wasd-controls.js":(l,u,c)=>{var d=c("./src/constants/index.js").keyboardevent.KEYCODE_TO_CODE,p=c("./src/core/component.js").registerComponent,f=c("./src/lib/three.js"),m=c("./src/utils/index.js"),g=m.shouldCaptureKeyEvent,y=1e-5,x=.2,v=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];l.exports.Component=p("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},after:["look-controls"],init:function(){this.keys={},this.easing=1.1,this.velocity=new f.Vector3,this.onBlur=this.onBlur.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onFocus=this.onFocus.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.attachVisibilityEventListeners()},tick:function(T,w){var S=this.data,R=this.el,B=this.velocity;!B[S.adAxis]&&!B[S.wsAxis]&&_(this.keys)||(w=w/1e3,this.updateVelocity(w),!(!B[S.adAxis]&&!B[S.wsAxis])&&R.object3D.position.add(this.getMovementVector(w)))},update:function(T){T.adAxis!==this.data.adAxis&&(this.velocity[T.adAxis]=0),T.wsAxis!==this.data.wsAxis&&(this.velocity[T.wsAxis]=0)},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(T){var w,S,R,B=this.data,I=this.keys,D=this.velocity,L,O;if(S=B.adAxis,L=B.wsAxis,T>x){D[S]=0,D[L]=0;return}var U=Math.pow(1/this.easing,T*60);D[S]!==0&&(D[S]=D[S]*U),D[L]!==0&&(D[L]=D[L]*U),Math.abs(D[S])<y&&(D[S]=0),Math.abs(D[L])<y&&(D[L]=0),B.enabled&&(w=B.acceleration,B.adEnabled&&(R=B.adInverted?-1:1,(I.KeyA||I.ArrowLeft)&&(D[S]-=R*w*T),(I.KeyD||I.ArrowRight)&&(D[S]+=R*w*T)),B.wsEnabled&&(O=B.wsInverted?-1:1,(I.KeyW||I.ArrowUp)&&(D[L]-=O*w*T),(I.KeyS||I.ArrowDown)&&(D[L]+=O*w*T)))},getMovementVector:function(){var T=new f.Vector3(0,0,0),w=new f.Euler(0,0,0,"YXZ");return function(S){var R=this.el.getAttribute("rotation"),B=this.velocity,I;return T.copy(B),T.multiplyScalar(S),R&&(I=this.data.fly?R.x:0,w.set(f.MathUtils.degToRad(I),f.MathUtils.degToRad(R.y),0),T.applyEuler(w)),T}}(),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var T=Object.keys(this.keys),w=0;w<T.length;w++)delete this.keys[T[w]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(T){var w;g(T)&&(w=T.code||d[T.keyCode],v.indexOf(w)!==-1&&(this.keys[w]=!0))},onKeyUp:function(T){var w;w=T.code||d[T.keyCode],delete this.keys[w]}});function _(T){var w;for(w in T)return!1;return!0}},"./src/components/windows-motion-controls.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,m=p.emitIfAxesChanged,g=p.onButtonEvent,y=c("./src/utils/index.js"),x=y.debug("components:windows-motion-controls:debug"),v=y.debug("components:windows-motion-controls:warn"),_=c("./src/constants/index.js").DEFAULT_HANDEDNESS,T=c("./src/constants/index.js").AFRAME_CDN_ROOT,w=T+"controllers/microsoft/",S={left:"left.glb",right:"right.glb",default:"universal.glb"},R=c("./src/utils/index.js").device.isWebXRAvailable,B="windows-mixed-reality",I="Spatial Controller (Spatial Interaction Source) ",D=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,L=R?B:I,O={axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},U={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},J=R?U:O;l.exports.Component=d("windows-motion-controls",{schema:{hand:{default:_},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},after:["tracked-controls"],mapping:J,bindMethods:function(){this.onModelError=this.onModelError.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var H=this,V=this.el;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function($){g($.detail.id,"down",H)},this.onButtonUp=function($){g($.detail.id,"up",H)},this.onButtonTouchStart=function($){g($.detail.id,"touchstart",H)},this.onButtonTouchEnd=function($){g($.detail.id,"touchend",H)},this.onControllerConnected=function(){H.setModelVisibility(!0)},this.onControllerDisconnected=function(){H.setModelVisibility(!1)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1},V.addEventListener("controllerconnected",this.onControllerConnected),V.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var H=this.el;H.addEventListener("buttonchanged",this.onButtonChanged),H.addEventListener("buttondown",this.onButtonDown),H.addEventListener("buttonup",this.onButtonUp),H.addEventListener("touchstart",this.onButtonTouchStart),H.addEventListener("touchend",this.onButtonTouchEnd),H.addEventListener("axismove",this.onAxisMoved),H.addEventListener("model-error",this.onModelError),H.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var H=this.el;H.removeEventListener("buttonchanged",this.onButtonChanged),H.removeEventListener("buttondown",this.onButtonDown),H.removeEventListener("buttonup",this.onButtonUp),H.removeEventListener("touchstart",this.onButtonTouchStart),H.removeEventListener("touchend",this.onButtonTouchEnd),H.removeEventListener("axismove",this.onAxisMoved),H.removeEventListener("model-error",this.onModelError),H.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){f(this,L,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(!this.data.model||this.rayOrigin.createdFromMesh){this.modelReady();return}var H=this.createControllerModelUrl();this.loadModel(H)},createControllerModelUrl:function(H){var V=this.el.components["tracked-controls"],$=V?V.controller:null,Q="default",G=this.data.hand,j;if($&&!window.hasNativeWebXRImplementation&&(G=$.hand,!H)){var ie=$.id.match(D);Q=ie&&ie[0]||Q}return j=S[G]||S.default,w+Q+"/"+j},injectTrackedControls:function(){var H=this.data;this.el.setAttribute("tracked-controls",{idPrefix:L,controller:H.pair,hand:H.hand,armModel:!1}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(H){var V=this.createControllerModelUrl(!0);H.detail.src!==V?(v("Failed to load controller model for device, attempting to load default."),this.loadModel(V)):v("Failed to load default controller model.")},loadModel:function(H){this.el.setAttribute("gltf-model","url("+H+")")},onModelLoaded:function(H){var V=this.controllerModel=H.detail.model,$=this.loadedMeshInfo,Q,G,j,ie;if(H.target!==this.el)return;if(x("Processing model"),$.buttonMeshes={},$.axisMeshes={},V){for(Q=0;Q<this.mapping.buttons.length;Q++){if(G=this.mapping.buttonMeshNames[this.mapping.buttons[Q]],!G){x("Skipping unknown button at index: "+Q+" with mapped name: "+this.mapping.buttons[Q]);continue}if(j=V.getObjectByName(G),!j){v("Missing button mesh with name: "+G);continue}ie={index:Q,value:Y(j,"VALUE"),pressed:Y(j,"PRESSED"),unpressed:Y(j,"UNPRESSED")},ie.value&&ie.pressed&&ie.unpressed?$.buttonMeshes[this.mapping.buttons[Q]]=ie:v("Missing button submesh under mesh with name: "+G+"(VALUE: "+!!ie.value+", PRESSED: "+!!ie.pressed+", UNPRESSED:"+!!ie.unpressed+")")}for(Q=0;Q<this.mapping.axisMeshNames.length;Q++){if(G=this.mapping.axisMeshNames[Q],!G){x("Skipping unknown axis at index: "+Q);continue}if(j=V.getObjectByName(G),!j){v("Missing axis mesh with name: "+G);continue}ie={index:Q,value:Y(j,"VALUE"),min:Y(j,"MIN"),max:Y(j,"MAX")},ie.value&&ie.min&&ie.max?$.axisMeshes[Q]=ie:v("Missing axis submesh under mesh with name: "+G+"(VALUE: "+!!ie.value+", MIN: "+!!ie.min+", MAX:"+!!ie.max+")")}this.calculateRayOriginFromMesh(V),this.setModelVisibility()}x("Model load complete.");function Y(ae,xe){for(var fe=0,de=ae.children.length;fe<de;fe++){var Ie=ae.children[fe];if(Ie&&Ie.name===xe)return Ie}}},calculateRayOriginFromMesh:function(){var H=new THREE.Quaternion;return function(V){var $;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,$=V.getObjectByName(this.mapping.pointingPoseMeshName),$){var Q=V.parent;Q&&(V.parent=null,V.updateMatrixWorld(!0),V.parent=Q),$.getWorldPosition(this.rayOrigin.origin),$.getWorldQuaternion(H),this.rayOrigin.direction.applyQuaternion(H),Q&&V.updateMatrixWorld(!0)}else x("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}}(),lerpAxisTransform:function(){var H=new THREE.Quaternion;return function(V,$){var Q=this.loadedMeshInfo.axisMeshes[V];if(Q){var G=Q.min,j=Q.max,ie=Q.value,Y=$*.5+.5;ie.setRotationFromQuaternion(H.copy(G.quaternion).slerp(j.quaternion,Y)),ie.position.lerpVectors(G.position,j.position,Y)}}}(),lerpButtonTransform:function(){var H=new THREE.Quaternion;return function(V,$){var Q=this.loadedMeshInfo.buttonMeshes[V];if(Q){var G=Q.unpressed,j=Q.pressed,ie=Q.value;ie.setRotationFromQuaternion(H.copy(G.quaternion).slerp(j.quaternion,$)),ie.position.lerpVectors(G.position,j.position,$)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(H){var V=this.mapping.buttons[H.detail.id];V&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(V,H.detail.state.value),this.el.emit(V+"changed",H.detail.state))},onAxisMoved:function(H){var V=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var $=0;$<V;$++)this.lerpAxisTransform($,H.detail.axis[$]||0);m(this,this.mapping.axes,H)},setModelVisibility:function(H){var V=this.el.getObject3D("mesh");this.controllerPresent&&(H=H!==void 0?H:this.modelVisible,this.modelVisible=H,V&&(V.visible=H))}})},"./src/constants/index.js":(l,u,c)=>{l.exports={AFRAME_CDN_ROOT:window.AFRAME_CDN_ROOT||"https://cdn.aframe.io/",AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",keyboardevent:c("./src/constants/keyboardevent.js")}},"./src/constants/keyboardevent.js":l=>{l.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},"./src/core/a-assets.js":(l,u,c)=>{var d=c("./src/core/a-node.js").ANode,p=c("./src/utils/debug.js"),f=c("./src/lib/three.js"),m=new f.FileLoader,g=p("core:a-assets:warn");class y extends d{constructor(){super(),this.isAssets=!0,this.fileLoader=m,this.timeout=null}doConnectedCallback(){var I=this,D,L=[],O,U,J,H,V,$;if(super.doConnectedCallback(),!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(H=this.querySelectorAll("img"),D=0;D<H.length;D++)J=_(H[D]),L.push(new Promise(function(Q,G){if(f.Cache.add(H[D].getAttribute("src"),J),J.complete){Q();return}J.onload=Q,J.onerror=G}));for(U=this.querySelectorAll("audio, video"),D=0;D<U.length;D++)O=_(U[D]),!O.src&&!O.srcObject&&g("Audio/video asset has neither `src` nor `srcObject` attributes."),L.push(v(O));$=this.getChildren(),$.forEach(function(Q){!Q.isAssetItem||!Q.hasAttribute("src")||L.push(new Promise(function(G,j){if(Q.hasLoaded)return G();Q.addEventListener("loaded",G),Q.addEventListener("error",j)}))}),Promise.allSettled(L).then(function(){I.timeout!==null&&I.load()}),V=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){I.hasLoaded||(g("Asset loading timed out in",V,"ms"),I.timeout=null,I.emit("timeout"),I.load())},V)}disconnectedCallback(){super.disconnectedCallback(),this.timeout&&clearTimeout(this.timeout)}load(){super.load.call(this,null,function(){return!1})}}customElements.define("a-assets",y);class x extends d{constructor(){super(),this.data=null,this.isAssetItem=!0}connectedCallback(){var I=this,D=this.getAttribute("src");m.setResponseType(this.getAttribute("response-type")||S(D)),m.load(D,function(L){I.data=L,d.prototype.load.call(I)},function(L){I.emit("progress",{loadedBytes:L.loaded,totalBytes:L.total,xhr:L})},function(L){I.emit("error",{xhr:L})})}}customElements.define("a-asset-item",x);function v(B){if(!(!B.hasAttribute("autoplay")&&B.getAttribute("preload")!=="auto"))return new Promise(function(I,D){if(B.readyState===4)return I();if(B.error)return D();B.addEventListener("loadeddata",L,!1),B.addEventListener("progress",L,!1),B.addEventListener("error",D,!1);function L(){for(var O=0,U=0;U<B.buffered.length;U++)O+=B.buffered.end(U)-B.buffered.start(U);O>=B.duration&&(B.tagName==="VIDEO"&&f.Cache.add(B.getAttribute("src"),B),I())}})}function _(B){var I=T(B);return I.tagName&&I.tagName.toLowerCase()==="video"&&(I.setAttribute("playsinline",""),I.setAttribute("webkit-playsinline","")),I!==B&&(B.parentNode.appendChild(I),B.parentNode.removeChild(B)),I}function T(B){var I,D;return B.hasAttribute("crossorigin")||(D=B.getAttribute("src"),D!==null&&(D.indexOf("://")===-1||w(D)===window.location.host))?B:(g('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',D),B.crossOrigin="anonymous",I=B.cloneNode(!0),I)}function w(B){var I=B.indexOf("://")>-1?B.split("/")[2]:B.split("/")[0];return I.substring(0,I.indexOf(":"))}function S(B){var I=R(B),D=I.lastIndexOf(".");if(D>=0){var L=I.slice(D,B.search(/\?|#|$/));if(L===".glb")return"arraybuffer"}return"text"}l.exports.inferResponseType=S;function R(B){var I=document.createElement("a");I.href=B;var D=I.search.replace(/^\?/,""),L=B.replace(D,"").replace("?","");return L.substring(L.lastIndexOf("/")+1)}l.exports.getFileNameFromURL=R},"./src/core/a-cubemap.js":(l,u,c)=>{var d=c("./src/utils/debug.js"),p=d("core:cubemap:warn");class f extends HTMLElement{constructor(g){return g=super(g),g}onReadyStateChange(){document.readyState==="complete"&&this.doConnectedCallback()}connectedCallback(){if(document.readyState!=="complete"){document.addEventListener("readystatechange",this.onReadyStateChange.bind(this));return}f.prototype.doConnectedCallback.call(this)}doConnectedCallback(){this.srcs=this.validate()}validate(){var g=this.querySelectorAll("[src]"),y,x=[];if(g.length===6){for(y=0;y<g.length;y++)g[y].tagName==="IMG"?x.push(g[y]):x.push(g[y].getAttribute("src"));return x}p("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")}}customElements.define("a-cubemap",f)},"./src/core/a-entity.js":(l,u,c)=>{var d=c("./src/core/a-node.js").ANode,p=c("./src/core/component.js").components,f=c("./src/lib/three.js"),m=c("./src/utils/index.js"),g=m.debug("core:a-entity:debug"),y=m.debug("core:a-entity:warn"),x="__",v=["position","rotation","scale","visible"],_={once:!0};class T extends d{constructor(){super(),this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new f.Group,this.object3D.rotation.order="YXZ",this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}attributeChangedCallback(L,O,U){var J=this.components[L];if(super.attributeChangedCallback(),J&&J.justInitialized&&U===""){delete J.justInitialized;return}!J&&U===null||this.setEntityAttribute(L,O,U)}doConnectedCallback(){var L=this,O,U;if(super.doConnectedCallback(),U=this.sceneEl,this.addToParent(),!this.isScene){if(!U){this.load();return}if(O=U.querySelector("a-assets"),O&&!O.hasLoaded){O.addEventListener("loaded",function(){L.load()});return}this.load()}}disconnectedCallback(){var L;if(this.parentEl){for(L in this.components)this.removeComponent(L,!1);this.isScene||(this.removeFromParent(),super.disconnectedCallback(),this.object3D.el=null)}}getObject3D(L){return this.object3DMap[L]}setObject3D(L,O){var U,J=this;if(!(O instanceof f.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");U=this.getObject3D(L),U&&this.object3D.remove(U),O.el=this,O.children.length&&O.traverse(function(H){H.el=J}),this.object3D.add(O),this.object3DMap[L]=O,this.emit("object3dset",{object:O,type:L})}removeObject3D(L){var O=this.getObject3D(L);if(!O){y("Tried to remove `Object3D` of type:",L,"which was not defined.");return}this.object3D.remove(O),delete this.object3DMap[L],this.emit("object3dremove",{type:L})}getOrCreateObject3D(L,O){var U=this.getObject3D(L);return!U&&O&&(U=new O,this.setObject3D(L,U)),y("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),U}add(L){if(!L.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(L.object3D),this.emit("child-attached",{el:L})}addToParent(){var L=this.parentEl=this.parentNode;!L||!L.add||this.attachedToParent||(L.add(this),this.attachedToParent=!0)}removeFromParent(){var L=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,L.emit("child-detached",{el:this})}load(){var L=this;this.hasLoaded||!this.parentEl||super.load.call(this,function(){L.parentEl&&(L.updateComponents(),(L.isScene||L.parentEl.isPlaying)&&L.play())})}remove(L){L?this.object3D.remove(L.object3D):this.parentNode.removeChild(this)}getChildEntities(){for(var L=this.children,O=[],U=0;U<L.length;U++){var J=L[U];J instanceof T&&O.push(J)}return O}initComponent(L,O,U){var J,H,V,$,Q;V=m.split(L,x),$=V[0],H=V.length>2?V.slice(1).join("__"):V[1],p[$]&&(Q=w(this,L)||O!==void 0,!(!Q&&!U)&&(L in this.components||(this.initComponentDependencies($),J=new p[$].Component(this,O,H),this.isPlaying&&J.play(),this.hasAttribute(L)||(J.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,L,"")),g("Component initialized: %s",L))))}initComponentDependencies(L){var O=this,U=p[L],J,H;if(U&&(J=p[L].dependencies,!!J))for(H=0;H<J.length;H++)O.initComponent(J[H],window.HTMLElement.prototype.getAttribute.call(O,J[H])||void 0,!0)}removeComponent(L,O){var U;if(U=this.components[L],!!U){if(!U.initialized){this.addEventListener("componentinitialized",function J(H){H.detail.name===L&&(this.removeComponent(L,O),this.removeEventListener("componentinitialized",J))});return}U.pause(),U.remove(),O&&(U.destroy(),delete this.components[L],this.hasAttribute(L)&&window.HTMLElement.prototype.removeAttribute.call(this,L)),this.emit("componentremoved",U.evtDetail,!1)}}updateComponents(){var L,O,U,J,H=this.componentsToUpdate;if(!(!this.hasLoaded&&!this.isLoading)){for(U=0;U<this.mixinEls.length;U++)for(J in this.mixinEls[U].componentCache)B(J)&&(H[J]=!0);if(this.getExtraComponents){O=this.getExtraComponents();for(J in O)B(J)&&(H[J]=!0)}for(U=0;U<this.attributes.length;++U)J=this.attributes[U].name,v.indexOf(J)===-1&&B(J)&&(H[J]=!0);for(U=0;U<v.length;U++)J=v[U],this.hasAttribute(J)&&this.updateComponent(J,this.getDOMAttribute(J));for(J in H)L=R(this.getDOMAttribute(J),O&&O[J]),this.updateComponent(J,L),delete H[J]}}updateComponent(L,O,U){var J=this.components[L];if(J){if(O===null&&!w(this,L)){this.removeComponent(L,!0);return}J.updateProperties(O,U);return}this.initComponent(L,O,!1)}removeAttribute(L,O){var U=this.components[L];if(U&&O===void 0&&this.removeComponent(L,!0),U&&O!==void 0){U.resetProperty(O);return}L==="mixin"&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,L)}play(){var L,O,U;if(!(this.isPlaying||!this.hasLoaded&&!this.isLoading)){this.isPlaying=!0;for(U in this.components)this.components[U].play();for(L=this.getChildEntities(),O=0;O<L.length;O++)L[O].play();this.emit("play")}}pause(){var L,O,U;if(this.isPlaying){this.isPlaying=!1;for(U in this.components)this.components[U].pause();for(L=this.getChildEntities(),O=0;O<L.length;O++)L[O].pause();this.emit("pause")}}setEntityAttribute(L,O,U){if(p[L]||this.components[L]){this.updateComponent(L,U);return}if(L==="mixin"){if(U===this.computedMixinStr)return;this.mixinUpdate(U,O)}}mixinUpdate(L,O,U){var J=T.componentsUpdated,H,V,$,Q,G=this;if(U||(O=O||this.getAttribute("mixin")),!this.hasLoaded){this.addEventListener("loaded-private",function(){G.mixinUpdate(L,O,!0)},_);return}for($=this.updateMixins(L,O),J.length=0,Q=0;Q<this.mixinEls.length;Q++)for(H in this.mixinEls[Q].componentCache)J.indexOf(H)===-1&&(this.components[H]?this.components[H].handleMixinUpdate():this.initComponent(H,null),J.push(H));for(Q=0;Q<$.oldMixinIds.length;Q++)if(V=document.getElementById($.oldMixinIds[Q]),!!V)for(H in V.componentCache)J.indexOf(H)===-1&&this.components[H]&&(this.getDOMAttribute(H)?this.components[H].handleMixinUpdate():this.removeComponent(H,!0))}setAttribute(L,O,U){var J=T.singlePropUpdate,H,V,$,Q,G,j;if(Q=L.indexOf(x),$=Q>0?L.substring(0,Q):L,!p[$]){L==="mixin"&&this.mixinUpdate(O),super.setAttribute.call(this,L,O);return}if(!this.components[L]&&this.hasAttribute(L)&&this.updateComponent(L,window.HTMLElement.prototype.getAttribute.call(this,L)),typeof U<"u"&&typeof O=="string"&&O.length>0&&typeof m.styleParser.parse(O)=="string"){for(j in J)delete J[j];H=J,H[O]=U,V=!1}else H=O,V=U===!0;this.updateComponent(L,H,V),G=this.sceneEl&&this.sceneEl.getAttribute("debug"),G&&this.components[L].flushToDOM()}flushToDOM(L){var O=this.components,U,J=this.children,H,V;for(V in O)O[V].flushToDOM();if(L)for(H=0;H<J.length;++H)U=J[H],U.flushToDOM&&U.flushToDOM(L)}getAttribute(L){var O;return L==="position"?this.object3D.position:L==="rotation"?I(this):L==="scale"?this.object3D.scale:L==="visible"?this.object3D.visible:(O=this.components[L],O?O.data:window.HTMLElement.prototype.getAttribute.call(this,L))}getDOMAttribute(L){var O=this.components[L];return O?O.attrValue:window.HTMLElement.prototype.getAttribute.call(this,L)}addState(L){this.is(L)||(this.states.push(L),this.emit("stateadded",L))}removeState(L){var O=this.states.indexOf(L);O!==-1&&(this.states.splice(O,1),this.emit("stateremoved",L))}is(L){return this.states.indexOf(L)!==-1}inspect(){this.sceneEl.components.inspector.openInspector(this)}destroy(){var L;if(this.parentNode){y("Entity can only be destroyed if detached from scenegraph.");return}for(L in this.components)this.components[L].destroy()}}function w(D,L){return D.components[L]&&D.components[L].attrValue?!0:S(L,D.mixinEls)}function S(D,L){var O,U=!1;for(O=0;O<L.length&&(U=L[O].hasAttribute(D),!U);++O);return U}function R(D,L){return L?L.constructor===Object?m.extend(L,m.styleParser.parse(D||{})):D||L:D}function B(D){return D.indexOf(x)!==-1&&(D=m.split(D,x)[0]),!!p[D]}function I(D){var L=f.MathUtils.radToDeg,O=D.object3D.rotation,U=D.rotationObj;return U.x=L(O.x),U.y=L(O.y),U.z=L(O.z),U}T.componentsUpdated=[],T.singlePropUpdate={},customElements.define("a-entity",T),l.exports.AEntity=T},"./src/core/a-mixin.js":(l,u,c)=>{var d=c("./src/core/a-node.js").ANode,p=c("./src/core/component.js").components,f=c("./src/utils/index.js"),m=f.styleParser,g="__";class y extends d{constructor(){super(),this.componentCache={},this.rawAttributeCache={},this.isMixin=!0}doConnectedCallback(){super.doConnectedCallback(),this.sceneEl=this.closestScene(),this.id=this.getAttribute("id"),this.cacheAttributes(),this.updateEntities(),this.load()}attributeChangedCallback(v,_,T){super.attributeChangedCallback(),this.cacheAttribute(v,T),this.updateEntities()}setAttribute(v,_){window.HTMLElement.prototype.setAttribute.call(this,v,_),this.cacheAttribute(v,_)}cacheAttribute(v,_){var T,w;w=f.split(v,g)[0],T=p[w],_===void 0&&(_=window.HTMLElement.prototype.getAttribute.call(this,v)),this.rawAttributeCache[v]=_,T&&(this.componentCache[v]=this.parseComponentAttrValue(T,_))}parseComponentAttrValue(v,_){var T;return typeof _!="string"?_:(v.isSingleProperty?(T=v.schema.parse(_),typeof T=="string"&&(T=_)):T=m.parse(_),T)}getAttribute(v){return this.componentCache[v]||window.HTMLElement.prototype.getAttribute.call(this,v)}cacheAttributes(){var v=this.attributes,_,T;for(T=0;T<v.length;T++)_=v[T].name,this.cacheAttribute(_)}updateEntities(){var v,_,T;if(this.sceneEl)for(_=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),T=0;T<_.length;T++)v=_[T],!(!v.hasLoaded||v.isMixin)&&v.mixinUpdate(this.id)}}customElements.define("a-mixin",y)},"./src/core/a-node.js":(l,u,c)=>{var d=c("./src/utils/index.js"),p=c("./src/core/readyState.js"),f=d.debug("core:a-node:warn"),m={"a-scene":!0,"a-assets":!0,"a-assets-items":!0,"a-cubemap":!0,"a-mixin":!0,"a-node":!0,"a-entity":!0};function g(x){return x.tagName.toLowerCase()in m||x.isNode}class y extends HTMLElement{constructor(){super(),this.computedMixinStr="",this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[]}connectedCallback(){if(!p.canInitializeElements){document.addEventListener("aframeready",this.connectedCallback.bind(this));return}this.doConnectedCallback()}doConnectedCallback(){var v;this.sceneEl=this.closestScene(),this.sceneEl||f("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(v=this.getAttribute("mixin"),v&&this.updateMixins(v))}attributeChangedCallback(v,_,T){T!==this.computedMixinStr&&v==="mixin"&&!this.isMixin&&this.updateMixins(T,_)}closestScene(){for(var v=this;v&&!v.isScene;)v=v.parentElement;return v}closest(v){for(var _=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,T=this;T&&!_.call(T,v);)T=T.parentElement;return T}disconnectedCallback(){this.hasLoaded=!1}load(v,_){var T,w,S=this;this.hasLoaded||(_=_||g,T=this.getChildren(),w=T.filter(_).map(function(R){return new Promise(function(B,I){if(R.hasLoaded)return B();R.addEventListener("loaded",B),R.addEventListener("error",I)})}),Promise.allSettled(w).then(function(R){R.forEach(function(B){B.status==="rejected"&&f("Rendering scene with errors on node: ",B.reason.target)}),S.isLoading=!0,S.setupMutationObserver(),v&&v(),S.isLoading=!1,S.hasLoaded=!0,S.emit("loaded-private",void 0,!1),S.emit("loaded",void 0,!1)}))}setupMutationObserver(){var v=this,_={attributes:!0,attributeOldValue:!0},T=new MutationObserver(function(w){var S;for(S=0;S<w.length;S++)if(w[S].type==="attributes"){var R=w[S].attributeName,B=window.HTMLElement.prototype.getAttribute.call(v,R),I=w[S].oldValue;v.attributeChangedCallback(R,I,B)}});T.observe(this,_)}getChildren(){return Array.prototype.slice.call(this.children,0)}updateMixins(v,_){var T=y.newMixinIdArray,w=y.oldMixinIdArray,S=y.mixinIds,R,B,I;for(T.length=0,w.length=0,B=v?d.split(v.trim(),/\s+/):T,I=_?d.split(_.trim(),/\s+/):w,S.newMixinIds=B,S.oldMixinIds=I,R=0;R<I.length;R++)B.indexOf(I[R])===-1&&this.unregisterMixin(I[R]);for(this.computedMixinStr="",this.mixinEls.length=0,R=0;R<B.length;R++)this.registerMixin(B[R]);return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),B.length===0&&window.HTMLElement.prototype.removeAttribute.call(this,"mixin"),S}registerMixin(v){var _,T,w,S=document.getElementById(v);if(!S){f("No mixin was found with id `%s`",v);return}if(w=S.getAttribute("mixin"),w)for(_=d.split(w.trim(),/\s+/),T=0;T<_.length;T++)this.registerMixin(_[T]);this.computedMixinStr=this.computedMixinStr+" "+S.id,this.mixinEls.push(S)}setAttribute(v,_){v==="mixin"&&this.updateMixins(_),window.HTMLElement.prototype.setAttribute.call(this,v,_)}unregisterMixin(v){var _,T=this.mixinEls,w;for(_=0;_<T.length;++_)if(w=T[_],v===w.id){T.splice(_,1);break}}emit(v,_,T,w){var S=y.evtData;T===void 0&&(T=!0),S.bubbles=!!T,S.detail=_,w&&(S=d.extend({},w,S)),this.dispatchEvent(new CustomEvent(v,S))}}y.evtData={},y.newMixinIdArray=[],y.oldMixinIdArray=[],y.mixinIds={},customElements.define("a-node",y),l.exports.ANode=y,l.exports.knownTags=m},"./src/core/component.js":(l,u,c)=>{var d=c("./src/core/schema.js"),p=c("./src/core/scene/scenes.js"),f=c("./src/core/system.js"),m=c("./src/utils/index.js"),g=l.exports.components={},y=d.parseProperty,x=d.process,v=d.isSingleProperty,_=d.stringifyProperties,T=d.stringifyProperty,w=m.styleParser,S=m.debug("core:component:warn"),R=document.currentScript,B=new RegExp("[A-Z]+"),I={},D=Object.freeze({}),L=[],O={get:function(j,ie){return j.getComputedPropertyValue(ie)},set:function(j,ie,Y){return ie in j.schema?j.recomputeProperty(ie,Y):Y!==void 0&&j.handleUnknownProperty(ie,Y),!0}},U=l.exports.Component=function(j,ie,Y){var ae=this;if(this.sceneOnly&&!j.isScene)throw new Error("Component `"+this.name+"` can only be applied to <a-scene>");if(Y&&!this.multiple)throw new Error("Trying to initialize multiple components of type `"+this.name+"`. There can only be one component of this type per entity.");this.el=j,this.id=Y,this.attrName=this.name+(Y?"__"+Y:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.el.components[this.attrName]=this,this.objectPool=I[this.name];var xe=this.events;this.events={},J(this,xe),this.attrValue=void 0,this.isObjectBased?(this.data=this.objectPool.use(),m.objectPool.removeUnusedKeys(this.data,this.schema),this.oldData=this.objectPool.use(),m.objectPool.removeUnusedKeys(this.oldData,this.schema),this.attrValueProxy=new Proxy(this,O)):(this.data=void 0,this.oldData=void 0,this.attrValueProxy=void 0),this.deferUnknownPropertyWarnings=!!this.updateSchema,this.silenceUnknownPropertyWarnings=!1,this.throttledEmitComponentChanged=m.throttleLeadingAndTrailing(function(){j.emit("componentchanged",ae.evtDetail,!1)},200),this.updateProperties(ie,!0)};U.prototype={schema:{},init:function(){},events:{},update:function(j){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},stringify:function(j){var ie=this.schema;return typeof j=="string"?j:this.isSingleProperty?T(j,ie):(j=_(j,ie),w.stringify(j))},flushToDOM:function(j){var ie=j?this.data:this.attrValue;ie!=null&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(ie))},updateProperties:function(j,ie){var Y=this.el;this.updateData(j,ie),!(!Y.hasLoaded&&!Y.isLoading)&&(this.initialized?this.callUpdateHandler():this.initComponent())},initComponent:function(){var j=this.el,ie;j.initializingComponents[this.name]||(j.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete j.initializingComponents[this.name],ie=this.isObjectBased?D:void 0,this.dataChanged=!1,this.storeOldData(),this.update(ie),j.isPlaying&&this.play(),j.emit("componentinitialized",this.evtDetail,!1))},updateData:function(j,ie){if(this.isSingleProperty){this.recomputeProperty(void 0,j);return}ie?(m.objectPool.clearObject(this.attrValue),this.recomputeData(j),this.schemaChangeRequired=!!this.updateSchema):typeof j=="string"?w.parse(j,this.attrValueProxy):m.extend(this.attrValueProxy,j),this.updateSchemaIfNeeded(j)},updateSchemaIfNeeded:function(j){if(!this.schemaChangeRequired||!this.updateSchema){for(var ie=0;ie<L.length;ie++)S("Unknown property `"+L[ie]+"` for component `"+this.name+"`.");L.length=0;return}L.length=0,this.updateSchema(this.data),m.objectPool.removeUnusedKeys(this.data,this.schema),this.silenceUnknownPropertyWarnings=!0,this.recomputeData(j),this.silenceUnknownPropertyWarnings=!1,this.schemaChangeRequired=!1},callUpdateHandler:function(){if(!(!this.isPositionRotationScale&&!this.dataChanged)){this.dataChanged=!1;var j=this.oldData;this.oldDataInUse=!0,this.update(j),j!==this.oldData&&this.objectPool.recycle(j),this.oldDataInUse=!1,this.storeOldData(),this.throttledEmitComponentChanged()}},handleMixinUpdate:function(){this.recomputeData(),this.updateSchemaIfNeeded(),this.callUpdateHandler()},resetProperty:function(j){!this.isSingleProperty&&!(j in this.schema)||(j?this.attrValue[j]=void 0:(this.isObjectBased&&this.objectPool.recycle(this.attrValue),this.attrValue=void 0),this.recomputeProperty(j,void 0),this.updateSchemaIfNeeded(),this.callUpdateHandler())},extendSchema:function(j){var ie;ie=m.extend({},g[this.name].schema),m.extend(ie,j),this.schema=x(ie),this.el.emit("schemachanged",this.evtDetail)},getComputedPropertyValue:function(j){var ie=this.el.mixinEls,Y=this.attrValue&&j?this.attrValue[j]:this.attrValue;if(Y!==void 0)return Y;for(var ae=ie.length-1;ae>=0;ae--){var xe=ie[ae].getAttribute(this.attrName);if(!(xe===null||j&&!(j in xe)))return j?xe[j]:xe}var fe=j?this.schema[j].default:this.schema.default;return fe},recomputeProperty:function(j,ie){var Y=j?this.schema[j]:this.schema;if(ie!=null){this.attrValue===void 0&&this.isObjectBased&&(this.attrValue=this.objectPool.use());var ae=j?this.attrValue[j]:this.attrValue;ae=Y.isCacheable?y(ie,Y,ae):ie,typeof ae=="string"&&(ae=ie===""?void 0:ie),j?this.attrValue[j]=ae:this.attrValue=ae}this.oldDataInUse&&(this.oldData=this.objectPool.use(),m.objectPool.removeUnusedKeys(this.oldData,this.schema),this.storeOldData(),this.oldDataInUse=!1);var xe=j?this.oldData[j]:this.oldData,fe=j?this.data[j]:this.data,de=y(this.getComputedPropertyValue(j),Y,fe);return Y.type==="array"&&!j&&(de=m.clone(de)),Y.equals(de,xe)||(this.dataChanged=!0,Y.schemaChange&&(this.schemaChangeRequired=!0)),j?this.data[j]=de:this.data=de,de},handleUnknownProperty:function(j,ie){this.attrValue===void 0&&(this.attrValue=this.objectPool.use()),this.attrValue[j]=ie,this.silenceUnknownPropertyWarnings||(this.deferUnknownPropertyWarnings?L.push(j):this.silenceUnknownPropertyWarnings||S("Unknown property `"+j+"` for component `"+this.name+"`."))},storeOldData:function(){if(!this.isObjectBased){this.oldData=this.data;return}if(this.isSingleProperty){this.oldData=y(this.data,this.schema,this.oldData);return}var j;for(j in this.schema)this.data[j]!==void 0&&(this.data[j]&&typeof this.data[j]=="object"?this.oldData[j]=y(this.data[j],this.schema[j],this.oldData[j]):this.oldData[j]=this.data[j])},recomputeData:function(j){var ie;if(this.isSingleProperty){this.recomputeProperty(void 0,j);return}if(j&&typeof j=="object")for(ie in this.schema)this.attrValueProxy[ie]=j[ie];else for(ie in this.schema)this.attrValueProxy[ie]=void 0;typeof j=="string"&&w.parse(j,this.attrValueProxy);for(ie in this.attrValue)this.attrValue[ie]!==void 0&&L.indexOf(ie)!==-1&&(ie in this.schema||S("Unknown property `"+ie+"` for component `"+this.name+"`."))},eventsAttach:function(){var j;this.eventsDetach();for(j in this.events)this.el.addEventListener(j,this.events[j])},eventsDetach:function(){var j;for(j in this.events)this.el.removeEventListener(j,this.events[j])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.data),this.objectPool.recycle(this.oldData),this.attrValue=this.data=this.oldData=this.attrValueProxy=void 0}};function J(j,ie){var Y;for(Y in ie)j.events[Y]=ie[Y].bind(j)}if(window.debug)var H=l.exports.registrationOrderWarnings={};l.exports.registerComponent=function(j,ie){var Y,ae={},xe,fe;if(document.currentScript&&document.currentScript!==R&&p.forEach(function(Ie){Ie.hasLoaded||document.currentScript.compareDocumentPosition(Ie)!==Node.DOCUMENT_POSITION_FOLLOWING&&(S("The component `"+j+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(H[j]=!0))}),B.test(j)===!0&&S("The component name `"+j+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+j.toLowerCase()+"`"),j.indexOf("__")!==-1)throw new Error("The component name `"+j+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(ie).forEach(function(Ie){ae[Ie]={value:ie[Ie],writable:!0}}),g[j])throw new Error("The component `"+j+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");Y=function(Ie,Ge,Xe){U.call(this,Ie,Ge,Xe)},Y.prototype=Object.create(U.prototype,ae),Y.prototype.name=j,Y.prototype.isPositionRotationScale=j==="position"||j==="rotation"||j==="scale",Y.prototype.constructor=Y,Y.prototype.system=f&&f.systems[j],Y.prototype.play=Q(Y.prototype.play),Y.prototype.pause=$(Y.prototype.pause),xe=m.extend(x(Y.prototype.schema,Y.prototype.name)),Y.prototype.isSingleProperty=fe=v(Y.prototype.schema),Y.prototype.isObjectBased=!fe||fe&&(G(xe.default)||G(y(void 0,xe))),I[j]=m.objectPool.createPool(),g[j]={Component:Y,dependencies:Y.prototype.dependencies,before:Y.prototype.before,after:Y.prototype.after,isSingleProperty:Y.prototype.isSingleProperty,isObjectBased:Y.prototype.isObjectBased,multiple:Y.prototype.multiple,sceneOnly:Y.prototype.sceneOnly,name:j,schema:xe,stringify:Y.prototype.stringify};for(var de=0;de<p.length;de++)p[de].emit("componentregistered",{name:j},!1);return Y};function V(j){return j.tick||j.tock}function $(j){return function(){var ie=this.el.sceneEl;this.isPlaying&&(j.call(this),this.isPlaying=!1,this.eventsDetach(),V(this)&&ie.removeBehavior(this))}}function Q(j){return function(){var ie=this.el.sceneEl,Y=this.el.isPlaying&&!this.isPlaying;!this.initialized||!Y||(j.call(this),this.isPlaying=!0,this.eventsAttach(),V(this)&&ie.addBehavior(this))}}function G(j){return j&&j.constructor===Object&&!(j instanceof window.HTMLElement)}},"./src/core/geometry.js":(l,u,c)=>{var d=c("./src/core/schema.js"),p=d.process,f=l.exports.geometries={},m=l.exports.geometryNames=[],g=c("./src/lib/three.js"),y=l.exports.Geometry=function(){};y.prototype={schema:{},init:function(x){return this.geometry=new g.BufferGeometry,this.geometry},update:function(x){}},l.exports.registerGeometry=function(x,v){var _,T={};if(Object.keys(v).forEach(function(w){T[w]={value:v[w],writable:!0}}),f[x])throw new Error("The geometry `"+x+"` has been already registered");return _=function(){y.call(this)},_.prototype=Object.create(y.prototype,T),_.prototype.name=x,_.prototype.constructor=_,f[x]={Geometry:_,schema:p(_.prototype.schema)},m.push(x),_}},"./src/core/propertyTypes.js":(l,u,c)=>{var d=c("./src/utils/coordinates.js"),p=c("./node_modules/debug/src/browser.js"),f=p("core:propertyTypes:warn"),m=l.exports.propertyTypes={},g=/[,> .[\]:]/,y=/url\((.+)\)/;x("audio","",w),x("array",[],v,_,T),x("asset","",w),x("boolean",!1,I),x("color","#FFF"),x("int",0,D),x("number",0,L),x("map","",w),x("model","",w),x("selector",null,O,J,B,!1),x("selectorAll",null,U,H,T,!1),x("src","",V),x("string",""),x("time",0,D),x("vec2",{x:0,y:0},$,d.stringify,d.equals),x("vec3",{x:0,y:0,z:0},$,d.stringify,d.equals),x("vec4",{x:0,y:0,z:0,w:1},$,d.stringify,d.equals);function x(j,ie,Y,ae,xe,fe){if(j in m)throw new Error("Property type "+j+" is already registered.");m[j]={default:ie,parse:Y||S,stringify:ae||R,equals:xe||B,isCacheable:fe!==!1}}l.exports.registerPropertyType=x;function v(j){if(Array.isArray(j))return j;if(!j||typeof j!="string")return[];return j.split(",").map(ie);function ie(Y){return Y.trim()}}function _(j){return j.join(", ")}function T(j,ie){if(!Array.isArray(j)||!Array.isArray(ie))return j===ie;if(j.length!==ie.length)return!1;for(var Y=0;Y<j.length;Y++)if(j[Y]!==ie[Y])return!1;return!0}function w(j){var ie,Y;if(typeof j!="string")return j;if(Y=j.match(y),Y)return Y[1];if(j.charAt(0)==="#"){if(ie=document.getElementById(j.substring(1)),ie)return ie.tagName==="CANVAS"||ie.tagName==="VIDEO"||ie.tagName==="IMG"?ie:ie.getAttribute("src");f('"'+j+'" asset not found.');return}return j}function S(j){return j}function R(j){return j===null?"null":j.toString()}function B(j,ie){return j===ie}function I(j){return j!=="false"&&j!==!1}function D(j){return parseInt(j,10)}function L(j){return parseFloat(j,10)}function O(j){return j?typeof j!="string"?j:j[0]==="#"&&!g.test(j)?document.getElementById(j.substring(1)):document.querySelector(j):null}function U(j){return j?typeof j!="string"?j:Array.prototype.slice.call(document.querySelectorAll(j),0):null}function J(j){return j.getAttribute?"#"+j.getAttribute("id"):R(j)}function H(j){return j instanceof Array?j.map(function(ie){return"#"+ie.getAttribute("id")}).join(", "):R(j)}function V(j){return f("`src` property type is deprecated. Use `asset` instead."),w(j)}function $(j,ie,Y){return d.parse(j,ie,Y)}function Q(j,ie){return j==="audio"&&typeof ie!="string"||j==="array"&&!Array.isArray(ie)||j==="asset"&&typeof ie!="string"||j==="boolean"&&typeof ie!="boolean"||j==="color"&&typeof ie!="string"||j==="int"&&typeof ie!="number"||j==="number"&&typeof ie!="number"||j==="map"&&typeof ie!="string"||j==="model"&&typeof ie!="string"||j==="selector"&&typeof ie!="string"&&ie!==null||j==="selectorAll"&&typeof ie!="string"&&ie!==null||j==="src"&&typeof ie!="string"||j==="string"&&typeof ie!="string"||j==="time"&&typeof ie!="number"?!1:j==="vec2"?G(ie,2):j==="vec3"?G(ie,3):j==="vec4"?G(ie,4):!0}l.exports.isValidDefaultValue=Q;function G(j,ie){if(j===null)return!0;if(typeof j!="object"||Object.keys(j).length!==ie)return!1;var Y=j.x,ae=j.y,xe=j.z,fe=j.w;return!(typeof Y!="number"||typeof ae!="number"||ie>2&&typeof xe!="number"||ie>3&&typeof fe!="number")}l.exports.isValidDefaultCoordinate=G},"./src/core/readyState.js":l=>{l.exports.canInitializeElements=!1;function u(){if(document.readyState==="complete"){c();return}document.addEventListener("readystatechange",function d(){document.readyState==="complete"&&(document.removeEventListener("readystatechange",d),c())})}l.exports.waitForDocumentReadyState=u;function c(){l.exports.canInitializeElements||(l.exports.canInitializeElements=!0,setTimeout(function(){document.dispatchEvent(new CustomEvent("aframeready"))}))}l.exports.emitReady=c},"./src/core/scene/a-scene.js":(l,u,c)=>{var d=c("./src/core/scene/metaTags.js").inject,p=c("./src/core/scene/wakelock.js"),f=c("./src/core/scene/loadingScreen.js"),m=c("./src/core/scene/scenes.js"),g=c("./src/core/system.js").systems,y=c("./src/core/component.js").components,x=c("./src/lib/three.js"),v=c("./src/utils/index.js"),_=v.debug("core:a-scene:warn"),T=c("./src/core/a-entity.js").AEntity,w=c("./src/core/a-node.js").ANode,S=c("./src/core/scene/postMessage.js"),R=v.device.isIOS(),B=v.device.isMobile(),I=v.device.isWebXRAvailable;R&&c("./src/utils/ios-orientationchange-blank-bug.js");class D extends T{constructor(){var G;super(),G=this,G.clock=new x.Clock,G.isIOS=R,G.isMobile=B,G.hasWebXR=I,G.isAR=!1,G.isScene=!0,G.object3D=new x.Scene,G.object3D.onAfterRender=function(j,ie,Y){G.isPlaying&&G.tock(G.time,G.delta,Y)},G.resize=G.resize.bind(G),G.render=G.render.bind(G),G.systems={},G.systemNames=[],G.time=G.delta=0,G.usedOfferSession=!1,G.componentOrder=[],G.behaviors={},G.hasLoaded=!1,G.isPlaying=!1,G.originalHTML=G.innerHTML}addFullScreenStyles(){document.documentElement.classList.add("a-fullscreen")}removeFullScreenStyles(){document.documentElement.classList.remove("a-fullscreen")}doConnectedCallback(){var G=this,j=this.hasAttribute("embedded");this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("xr-mode-ui",""),this.setAttribute("device-orientation-permission-ui",""),super.doConnectedCallback(),$(this),this.setupRenderer(),f.setup(this,U),this.resize(),j||this.addFullScreenStyles(),S(this),d(this),p(this),this.onVRPresentChangeBound=this.onVRPresentChange.bind(this),window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),this.enterVRBound=function(){G.enterVR()},this.exitVRBound=function(){G.exitVR()},this.exitVRTrueBound=function(){G.exitVR(!0)},this.pointerRestrictedBound=function(){G.pointerRestricted()},this.pointerUnrestrictedBound=function(){G.pointerUnrestricted()},G.hasWebXR||(window.addEventListener("vrdisplaydeactivate",this.exitVRBound),window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)),window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){G.attachedCallbackPostCamera()}),this.initSystems(),this.componentOrder=L(y,this.componentOrder),this.addEventListener("componentregistered",function(){G.componentOrder=L(y,G.componentOrder)}),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){G.enterVR()})}attachedCallbackPostCamera(){var G,j=this;window.addEventListener("load",G),window.addEventListener("resize",function(){j.isIOS?setTimeout(j.resize,100):j.resize()}),this.play(),m.push(this)}initSystems(){var G;this.initSystem("camera");for(G in g)G!=="camera"&&this.initSystem(G)}initSystem(G){this.systems[G]||(this.systems[G]=new g[G](this),this.systemNames.push(G))}disconnectedCallback(){var G=m.indexOf(this);super.disconnectedCallback(),m.splice(G,1),window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),window.removeEventListener("vrdisplayactivate",this.enterVRBound),window.removeEventListener("vrdisplaydeactivate",this.exitVRBound),window.removeEventListener("vrdisplayconnect",this.enterVRBound),window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound),window.removeEventListener("sessionend",this.resize),this.renderer.dispose()}addBehavior(G){var j,ie=this.behaviors[G.name],Y;ie||(ie=this.behaviors[G.name]={tick:{inUse:!1,array:[],markedForRemoval:[]},tock:{inUse:!1,array:[],markedForRemoval:[]}});for(Y in ie)if(G[Y]){if(j=ie[Y],j.inUse){var ae=j.markedForRemoval.indexOf(G);ae!==-1&&j.markedForRemoval.splice(ae,1)}j.array.indexOf(G)===-1&&j.array.push(G)}}getPointerLockElement(){return document.pointerLockElement}checkHeadsetConnected(){return v.device.checkHeadsetConnected()}enterAR(){var G;if(!this.hasWebXR)throw G="Failed to enter AR mode, WebXR not supported.",new Error(G);if(!v.device.checkARSupport())throw G="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(G);return this.enterVR(!0)}enterVR(G,j){var ie=this,Y,ae=ie.renderer.xr,xe;if(j&&(!navigator.xr||!navigator.xr.offerSession))return Promise.resolve("OfferSession is not supported.");if(ie.usedOfferSession&&j)return Promise.resolve("OfferSession was already called.");if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){var fe=ie.getAttribute("renderer");if(ae.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound);var de=this.sceneEl.systems.webxr.sessionReferenceSpaceType;ae.setReferenceSpaceType(de);var Ie=G?"immersive-ar":"immersive-vr";return xe=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(lt,At){var Gt=j?navigator.xr.offerSession.bind(navigator.xr):navigator.xr.requestSession.bind(navigator.xr);ie.usedOfferSession|=j,Gt(Ie,xe).then(function(gt){j&&(ie.usedOfferSession=!1),ae.layersEnabled=xe.requiredFeatures.indexOf("layers")!==-1,ae.setSession(gt).then(function(){ae.setFoveation(fe.foveationLevel),ie.xrSession=gt,ie.systems.renderer.setWebXRFrameRate(gt),gt.addEventListener("end",ie.exitVRBound),Xe(lt)})},function(gt){var yi=Ie==="immersive-ar",Ze=yi?"AR":"VR";At(new Error("Failed to enter "+Ze+" mode (`requestSession`)",{cause:gt}))})})}else{if(Y=v.device.getVRDisplay(),ae.setDevice(Y),Y.isPresenting&&!window.hasNativeWebVRImplementation)return Xe(),Promise.resolve();var Ge={highRefreshRate:fe.highRefreshRate};return Y.requestPresent([{source:this.canvas,attributes:Ge}]).then(Xe,$e)}}return Xe(),Promise.resolve();function Xe(lt){var At;window.hasNativeWebVRImplementation&&!window.hasNativeWebXRImplementation&&(At=new CustomEvent("vrdisplaypresentchange",{detail:{display:v.device.getVRDisplay()}}),window.dispatchEvent(At)),G?ie.addState("ar-mode"):ie.addState("vr-mode"),ie.emit("enter-vr",{target:ie}),!ie.hasWebXR&&ie.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),ie.addFullScreenStyles(),!ie.isMobile&&!ie.checkHeadsetConnected()&&H(ie.canvas),ie.resize(),lt&&lt()}function $e(lt){throw ie.removeState("vr-mode"),lt&&lt.message?new Error("Failed to enter VR mode (`requestPresent`): "+lt.message):new Error("Failed to enter VR mode (`requestPresent`).")}}exitVR(){var G=this,j,ie=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(ie.enabled=!1,j=v.device.getVRDisplay(),this.hasWebXR)this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0;else if(j.isPresenting)return j.exitPresent().then(Y,ae)}else V();return Y(),Promise.resolve();function Y(){G.removeState("vr-mode"),G.removeState("ar-mode"),G.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),G.hasAttribute("embedded")&&G.removeFullScreenStyles(),G.resize(),G.isIOS&&v.forceCanvasResizeSafariMobile(G.canvas),G.renderer.setPixelRatio(window.devicePixelRatio),G.emit("exit-vr",{target:G})}function ae(xe){throw xe&&xe.message?new Error("Failed to exit VR mode (`exitPresent`): "+xe.message):new Error("Failed to exit VR mode (`exitPresent`).")}}pointerRestricted(){if(this.canvas){var G=this.getPointerLockElement();G&&G!==this.canvas&&document.exitPointerLock&&document.exitPointerLock(),this.canvas.requestPointerLock&&this.canvas.requestPointerLock()}}pointerUnrestricted(){var G=this.getPointerLockElement();G&&G===this.canvas&&document.exitPointerLock&&document.exitPointerLock()}onVRPresentChange(G){var j=G.display||G.detail.display;if(j&&j.isPresenting){this.enterVR();return}this.exitVR()}getAttribute(G){var j=this.systems[G];return j?j.data:T.prototype.getAttribute.call(this,G)}getDOMAttribute(G){var j=this.systems[G];return j?j.data:T.prototype.getDOMAttribute.call(this,G)}setAttribute(G,j,ie){if(g[G]){w.prototype.setAttribute.call(this,G,j);var Y=this.systems[G];Y&&Y.updateProperties(j);return}T.prototype.setAttribute.call(this,G,j,ie)}removeBehavior(G){var j,ie,Y=this.behaviors[G.name],ae;for(ie in Y)G[ie]&&(j=Y[ie],ae=j.array.indexOf(G),ae!==-1&&(j.inUse?j.markedForRemoval.indexOf(G)===-1&&j.markedForRemoval.push(G):(j.array[ae]=j.array[j.array.length-1],j.array.pop())))}resize(){var G=this.camera,j=this.canvas,ie,Y,ae,xe=this.renderer.xr.isPresenting;Y=this.renderer.xr.enabled&&xe,!(!G||!j||this.is("vr-mode")&&(this.isMobile||Y))&&(ie=this.getAttribute("embedded")&&!this.is("vr-mode"),ae=U(j,ie,this.maxCanvasSize,this.is("vr-mode")),G.aspect=ae.width/ae.height,G.updateProjectionMatrix(),this.renderer.setSize(ae.width,ae.height,!1),this.emit("rendererresize",null,!1))}setupRenderer(){var G=this,j,ie,Y,ae;ae={alpha:!0,antialias:!B,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:-1,width:-1},this.hasAttribute("renderer")&&(Y=this.getAttribute("renderer"),ie=v.styleParser.parse(Y),ie.precision&&(ae.precision=ie.precision+"p"),ie.antialias&&ie.antialias!=="auto"&&(ae.antialias=ie.antialias==="true"),ie.logarithmicDepthBuffer&&ie.logarithmicDepthBuffer!=="auto"&&(ae.logarithmicDepthBuffer=ie.logarithmicDepthBuffer==="true"),ie.alpha&&(ae.alpha=ie.alpha==="true"),ie.stencil&&(ae.stencil=ie.stencil==="true"),ie.multiviewStereo&&(ae.multiviewStereo=ie.multiviewStereo==="true"),this.maxCanvasSize={width:ie.maxCanvasWidth?parseInt(ie.maxCanvasWidth):this.maxCanvasSize.width,height:ie.maxCanvasHeight?parseInt(ie.maxCanvasHeight):this.maxCanvasSize.height}),j=this.renderer=new x.WebGLRenderer(ae),j.setPixelRatio(window.devicePixelRatio),this.camera&&j.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){j.xr.setPoseTarget(G.camera.el.object3D)})}play(){var G=this,j=this;if(this.renderStarted){T.prototype.play.call(this);return}this.addEventListener("loaded",function(){var ie=this.renderer,Y,ae=this.renderer.xr;T.prototype.play.call(this),!j.renderStarted&&(j.resize(),j.renderer&&(window.performance&&window.performance.mark("render-started"),f.remove(),Y=v.device.getVRDisplay(),Y&&Y.isPresenting&&(ae.setDevice(Y),ae.enabled=!0,j.enterVR()),ie.setAnimationLoop(this.render),j.renderStarted=!0,j.emit("renderstart")))}),setTimeout(function(){T.prototype.load.call(G)})}updateComponent(G){G in g||T.prototype.updateComponent.apply(this,arguments)}tick(G,j){var ie,Y=this.systems;for(this.callComponentBehaviors("tick",G,j),ie=0;ie<this.systemNames.length;ie++)Y[this.systemNames[ie]].tick&&Y[this.systemNames[ie]].tick(G,j)}tock(G,j,ie){var Y,ae=this.systems;for(this.callComponentBehaviors("tock",G,j),Y=0;Y<this.systemNames.length;Y++)ae[this.systemNames[Y]].tock&&ae[this.systemNames[Y]].tock(G,j,ie)}render(G,j){var ie=this.renderer;this.frame=j,this.delta=this.clock.getDelta()*1e3,this.time=this.clock.elapsedTime*1e3,this.isPlaying&&this.tick(this.time,this.delta);var Y=null;this.is("ar-mode")&&(Y=this.object3D.background,this.object3D.background=null),ie.render(this.object3D,this.camera),Y&&(this.object3D.background=Y)}callComponentBehaviors(G,j,ie){for(var Y,ae=0;ae<this.componentOrder.length;ae++){var xe=this.behaviors[this.componentOrder[ae]];if(xe){var fe=xe[G];for(fe.inUse=!0,Y=0;Y<fe.array.length;Y++)fe.array[Y].isPlaying&&fe.array[Y][G](j,ie);for(fe.inUse=!1,Y=0;Y<fe.markedForRemoval.length;Y++)this.removeBehavior(fe.markedForRemoval[Y]);fe.markedForRemoval.length=0}}}}function L(Q,G){var j={},ie,Y,ae=G||[];ae.length=0;for(Y in Q){var xe=Q[Y];if(xe!==void 0){var fe=xe.before?xe.before.slice(0):[],de=xe.after?xe.after.slice(0):[];j[Y]={before:fe,after:de,visited:!1,done:!1}}}for(Y in j)for(ie=0;ie<j[Y].before.length;ie++){var Ie=j[Y].before[ie];if(!(Ie in j)){_("Invalid ordering constraint, no component named `"+Ie+"` referenced by `"+Y+"`");continue}j[Ie].after.push(Y)}function Ge(Xe){if(!(!(Xe in j)||j[Xe].done)){if(j[Xe].visited){_("Cycle detected, ignoring one or more before/after constraints. The resulting order might be incorrect");return}j[Xe].visited=!0;for(var $e=0;$e<j[Xe].after.length;$e++){var lt=j[Xe].after[$e];lt in j||_("Invalid before/after constraint, no component named `"+lt+"` referenced in `"+Xe+"`"),Ge(lt)}j[Xe].done=!0,ae.push(Xe)}}for(Y in j)j[Y].done||Ge(Y);return ae}l.exports.determineComponentBehaviorOrder=L;function O(Q,G){var j,ie=window.devicePixelRatio;return!G||G.width===-1&&G.height===-1||Q.width*ie<G.width&&Q.height*ie<G.height||(j=Q.width/Q.height,Q.width*ie>G.width&&G.width!==-1&&(Q.width=Math.round(G.width/ie),Q.height=Math.round(G.width/j/ie)),Q.height*ie>G.height&&G.height!==-1&&(Q.height=Math.round(G.height/ie),Q.width=Math.round(G.height*j/ie))),Q}customElements.define("a-scene",D);function U(Q,G,j,ie){if(!Q.parentElement)return{height:0,width:0};if(G){var Y;return Y={height:Q.parentElement.offsetHeight,width:Q.parentElement.offsetWidth},O(Y,j)}return J(j,ie)}function J(Q,G){var j;return j={height:document.body.offsetHeight,width:document.body.offsetWidth},G?j:O(j,Q)}function H(Q){var G=Q.requestFullscreen||Q.webkitRequestFullscreen||Q.mozRequestFullScreen||Q.msRequestFullscreen;G.apply(Q,[{navigationUI:"hide"}])}function V(){var Q=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;Q&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}function $(Q){var G;G=document.createElement("canvas"),G.classList.add("a-canvas"),G.dataset.aframeCanvas=!0,Q.appendChild(G),document.addEventListener("fullscreenchange",j),document.addEventListener("mozfullscreenchange",j),document.addEventListener("webkitfullscreenchange",j),document.addEventListener("MSFullscreenChange",j),G.addEventListener("touchmove",function(ie){ie.preventDefault()},{passive:!1}),Q.canvas=G,Q.emit("render-target-loaded",{target:G}),setTimeout(Q.resize.bind(Q),0);function j(){var ie=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;ie||Q.exitVR(),document.activeElement.blur(),document.body.focus()}}l.exports.setupCanvas=$,l.exports.AScene=D},"./src/core/scene/loadingScreen.js":(l,u,c)=>{var d=c("./src/utils/index.js"),p=d.styleParser,f,m,g,y="loading-screen",x="a-loader-title";l.exports.setup=function(T,w){f=T,g=w;var S=f.hasAttribute(y)?p.parse(f.getAttribute(y)):void 0,R=S&&S.dotsColor||"white",B=S&&S.backgroundColor||"#24CAFF",I=S===void 0||S.enabled==="true"||S.enabled===void 0,D,L,O,U,J,H,V,$,Q,G;I&&(D=new THREE.Scene,L=new THREE.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),O=new THREE.MeshBasicMaterial({color:R}),U=new THREE.Mesh(L,O),J=U.clone(),H=U.clone(),V=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),$=new THREE.Clock,Q=0,G=function(){f.renderer.render(D,V),Q=$.getElapsedTime()%4,U.visible=Q>=1,J.visible=Q>=2,H.visible=Q>=3},D.background=new THREE.Color(B),D.add(V),U.position.set(-1,0,-15),J.position.set(0,0,-15),H.position.set(1,0,-15),V.add(U),V.add(J),V.add(H),_(),setTimeout(function(){f.hasLoaded||(v(V),m.style.display="block",window.addEventListener("resize",function(){v(V)}),f.renderer.setAnimationLoop(G))},200))},l.exports.remove=function(){window.removeEventListener("resize",v),m&&(m.style.display="none")};function v(T){var w=f.hasAttribute("embedded"),S=g(f.canvas,w,f.maxCanvasSize,f.is("vr-mode"));T.aspect=S.width/S.height,T.updateProjectionMatrix(),f.renderer.setSize(S.width,S.height,!1)}function _(){m=document.createElement("div"),m.className=x,m.innerHTML=document.title,m.style.display="none",f.appendChild(m)}},"./src/core/scene/metaTags.js":(l,u,c)=>{var d=c("./src/constants/index.js"),p=c("./src/utils/index.js").extend,f=l.exports.MOBILE_HEAD_TAGS=[g({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),g({name:"mobile-web-app-capable",content:"yes"}),g({name:"theme-color",content:"black"})],m=[g({name:"apple-mobile-web-app-capable",content:"yes"}),g({name:"apple-mobile-web-app-status-bar-style",content:"black"}),y({rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"})];function g(v){return{tagName:"meta",attributes:v,exists:function(){return document.querySelector('meta[name="'+v.name+'"]')}}}function y(v){return{tagName:"link",attributes:v,exists:function(){return document.querySelector('link[rel="'+v.rel+'"]')}}}l.exports.inject=function(v){var _=document.head,T=_.querySelector("script"),w,S=[];return f.forEach(R),v.isIOS&&m.forEach(R),S;function R(B){!B||B.exists()||(w=x(B),w&&(T?T.parentNode.insertBefore(w,T):_.appendChild(w),S.push(w)))}};function x(v){if(!(!v||!v.tagName)){var _=document.createElement(v.tagName);return _.setAttribute(d.AFRAME_INJECTED,""),p(_,v.attributes)}}},"./src/core/scene/postMessage.js":(l,u,c)=>{var d=c("./src/utils/index.js").isIframed;l.exports=function(f){d()&&window.addEventListener("message",p.bind(f))};function p(f){var m=this;if(f.data)switch(f.data.type){case"vr":switch(f.data.data){case"enter":m.enterVR();break;case"exit":m.exitVR();break}}}},"./src/core/scene/scenes.js":l=>{l.exports=[]},"./src/core/scene/wakelock.js":(l,u,c)=>{var d=c("./vendor/wakelock/wakelock.js");l.exports=function(p){if(p.isMobile){var f=p.wakelock=new d;p.addEventListener("enter-vr",function(){f.request()}),p.addEventListener("exit-vr",function(){f.release()})}}},"./src/core/schema.js":(l,u,c)=>{var d=c("./src/utils/index.js"),p=c("./src/core/propertyTypes.js"),f=d.debug,m=p.isValidDefaultValue,g=p.propertyTypes,y=f("core:schema:warn");function x(w){return"type"in w?typeof w.type=="string":"default"in w}l.exports.isSingleProperty=x,l.exports.process=function(w,S){var R;if(x(w))return v(w,S);for(R in w)w[R]=v(w[R],S);return w};function v(w,S){var R=w.default,B,I,D=w.type;return w.type?w.type==="bool"?D="boolean":w.type==="float"&&(D="number"):R!==void 0&&(typeof R=="boolean"||typeof R=="number")?D=typeof R:Array.isArray(R)?D="array":D="string",I=g[D],I||y("Unknown property type for component `"+S+"`: "+D),B=!!w.parse,w.parse=w.parse||I.parse,w.stringify=w.stringify||I.stringify,w.equals=w.equals||I.equals,w.isCacheable=w.isCacheable===!0||I.isCacheable,w.type=D,"default"in w?!B&&!m(D,R)&&y("Default value `"+R+"` does not match type `"+D+"` in component `"+S+"`"):w.default=I.default,w}l.exports.processPropertyDefinition=v,l.exports.parseProperties=function(){var w=[];return function(S,R,B,I,D){var L,O,U,J;w.length=0;for(O in B?S:R)B&&S[O]===void 0||w.push(O);if(S===null||typeof S!="object")return S;for(O in S)S[O]!==void 0&&!R[O]&&!D&&y("Unknown property `"+O+"` for component/system `"+I+"`.");for(L=0;L<w.length;L++){if(O=w[L],U=R[O],J=S[O],!R[O])return;S[O]=_(J,U)}return S}}();function _(w,S,R){return(w==null||w==="")&&(w=S.default,Array.isArray(w)&&(w=w.slice())),S.parse(w,S.default,R)}l.exports.parseProperty=_,l.exports.stringifyProperties=function(w,S){var R,B,I,D={},L;for(R in w)B=S[R],I=w[R],L=I,typeof L=="object"&&(L=T(I,B),B||y("Unknown component property: "+R)),D[R]=L;return D};function T(w,S){return typeof w!="object"?w:!S||w===null?JSON.stringify(w):S.stringify(w)}l.exports.stringifyProperty=T},"./src/core/shader.js":(l,u,c)=>{var d=c("./src/core/schema.js"),p=d.process,f=l.exports.shaders={},m=l.exports.shaderNames=[],g=c("./src/lib/three.js"),y=c("./src/utils/index.js"),x={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},v=l.exports.Shader=function(){};v.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(_){return this.uniforms=this.initUniforms(),this.material=new(this.raw?g.RawShaderMaterial:g.ShaderMaterial)({uniforms:this.uniforms,glslVersion:this.raw||this.glsl3?g.GLSL3:null,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initUniforms:function(){var _,T=this.schema,w={},S;for(_ in T)T[_].is==="uniform"&&(S=x[T[_].type],w[_]={type:S,value:void 0});return w},update:function(_){var T,w,S=this.schema,R=this.uniforms;for(T in _)if(!(!S[T]||S[T].is!=="uniform")){if(S[T].type==="map"){if(!R[T]||R[T].value===_[T])continue;w="_texture_"+T,this.setMapOnTextureLoad(R,T,w),y.material.updateMapMaterialFromData(w,T,this,_);continue}R[T].value=this.parseValue(S[T].type,_[T]),R[T].needsUpdate=!0}},parseValue:function(_,T){var w;switch(_){case"vec2":return new g.Vector2(T.x,T.y);case"vec3":return new g.Vector3(T.x,T.y,T.z);case"vec4":return new g.Vector4(T.x,T.y,T.z,T.w);case"color":return w=new g.Color(T),new g.Vector3(w.r,w.g,w.b);default:return T}},setMapOnTextureLoad:function(_,T,w){var S=this;this.el.addEventListener("materialtextureloaded",function(){_[T].value=S.material[w],_[T].needsUpdate=!0})}},l.exports.registerShader=function(_,T){var w,S={};if(Object.keys(T).forEach(function(R){S[R]={value:T[R],writable:!0}}),f[_])throw new Error("The shader "+_+" has already been registered");return w=function(){v.call(this)},w.prototype=Object.create(v.prototype,S),w.prototype.name=_,w.prototype.constructor=w,f[_]={Shader:w,schema:p(w.prototype.schema)},m.push(_),w}},"./src/core/system.js":(l,u,c)=>{var d=c("./src/core/component.js"),p=c("./src/core/schema.js"),f=c("./src/utils/index.js"),m=c("./src/core/readyState.js"),g=p.parseProperties,y=p.parseProperty,x=p.process,v=p.isSingleProperty,_=f.styleParser,T=l.exports.systems={},w=l.exports.System=function(S){var R=d&&d.components[this.name];this.el=S,this.sceneEl=S,R&&(R.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};w.prototype={schema:{},init:function(){},update:function(S){},updateProperties:function(S){var R=this.data;Object.keys(p).length&&(this.buildData(S),this.update(R))},buildData:function(S){var R=this.schema;Object.keys(R).length&&(S=S||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),v(R)?this.data=y(S,R):this.data=g(_.parse(S)||{},R,!1,this.name))},tick:void 0,tock:void 0,play:function(){},pause:function(){}},l.exports.registerSystem=function(S,R){var B,I,D={},L=f.findAllScenes(document);if(Object.keys(R).forEach(function(O){D[O]={value:R[O],writable:!0}}),T[S])throw new Error("The system `"+S+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");if(I=function(O){w.call(this,O)},I.prototype=Object.create(w.prototype,D),I.prototype.name=S,I.prototype.constructor=I,I.prototype.schema=f.extend(x(I.prototype.schema)),T[S]=I,m.canInitializeElements)for(B=0;B<L.length;B++)L[B].initSystem(S)}},"./src/extras/components/index.js":(l,u,c)=>{c("./src/extras/components/pivot.js")},"./src/extras/components/pivot.js":(l,u,c)=>{var d=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=new p.Vector3,m=new p.Vector3;d("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var g=this.data,y=this.el,x=y.object3D.parent,v=y.object3D,_=new p.Group;f.copy(v.position),m.copy(v.rotation),x.remove(v),_.add(v),x.add(_),y.object3D=_,v.position.set(-1*g.x,-1*g.y,-1*g.z),_.position.set(g.x+f.x,g.y+f.y,g.z+f.z),_.rotation.copy(v.rotation),v.rotation.set(0,0,0)}})},"./src/extras/primitives/getMeshMixin.js":(l,u,c)=>{var d=c("./src/core/component.js").components,p=c("./src/core/shader.js").shaders,f=c("./src/utils/index.js"),m={};Object.keys(d.material.schema).forEach(g),Object.keys(p.standard.schema).forEach(g);function g(y){var x=y.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();y==="fog"&&(x="material-fog"),y==="visible"&&(x="material-visible"),m[x]="material."+y}l.exports=function(){return{defaultComponents:{material:{}},mappings:f.extend({},m)}}},"./src/extras/primitives/index.js":(l,u,c)=>{c("./src/extras/primitives/primitives/a-camera.js"),c("./src/extras/primitives/primitives/a-cursor.js"),c("./src/extras/primitives/primitives/a-curvedimage.js"),c("./src/extras/primitives/primitives/a-gltf-model.js"),c("./src/extras/primitives/primitives/a-image.js"),c("./src/extras/primitives/primitives/a-light.js"),c("./src/extras/primitives/primitives/a-link.js"),c("./src/extras/primitives/primitives/a-obj-model.js"),c("./src/extras/primitives/primitives/a-sky.js"),c("./src/extras/primitives/primitives/a-sound.js"),c("./src/extras/primitives/primitives/a-text.js"),c("./src/extras/primitives/primitives/a-video.js"),c("./src/extras/primitives/primitives/a-videosphere.js"),c("./src/extras/primitives/primitives/meshPrimitives.js")},"./src/extras/primitives/primitives.js":(l,u,c)=>{var d=c("./src/core/a-node.js").knownTags,p=c("./src/core/a-entity.js").AEntity,f=c("./src/core/component.js").components,m=c("./src/utils/index.js"),g=m.debug,y=m.entity.setComponentProperty,x=g("extras:primitives:debug"),v=g("extras:primitives:warn"),_=g("extras:primitives:error"),T=l.exports.primitives={};l.exports.registerPrimitive=function(B,I){if(B=B.toLowerCase(),d[B]){_("Trying to register primitive "+B+" that has been already previously registered");return}d[B]=!0,x("Registering <%s>",B),I.defaultAttributes&&v("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var D=I.mappings||{},L=class extends p{constructor(){super(),this.defaultComponentsFromPrimitive=I.defaultComponents||I.defaultAttributes||{},this.deprecated=I.deprecated||null,this.deprecatedMappings=I.deprecatedMappings||{},this.mappings=D,I.deprecated&&console.warn(I.deprecated),this.resolveMappingCollisions()}resolveMappingCollisions(){var O=this.mappings,U=this;Object.keys(O).forEach(function(J){var H;J!==J.toLowerCase()&&v("Mapping keys should be specified in lower case. The mapping key "+J+" may not be recognized"),f[J]&&(H=O[J].replace(".","-"),O[H]=O[J],delete O[J],console.warn("The primitive "+U.tagName.toLowerCase()+" has a mapping collision. The attribute "+J+" has the same name as a registered component and has been renamed to "+H))})}getExtraComponents(){var O,U,J,H,V,$=this;for(U=m.clone(this.defaultComponentsFromPrimitive),V=this.getAttribute("mixin"),V&&(V=m.split(V.trim(),/\s+/),V.forEach(function(Y){var ae=document.getElementById(Y);if(ae){var xe=ae.rawAttributeCache,fe=ae.componentCache;for(var de in xe){if(H=$.mappings[de],H){w(H,xe[de],U);return}de in fe&&(U[de]=Q(U[de],fe[de]))}}})),J=0;J<this.attributes.length;J++)O=this.attributes[J],H=this.mappings[O.name],H&&w(H,O.value,U);return U;function Q(Y,ae){return G(Y)?j(ae):G(ae)?j(Y):ie(Y)&&ie(ae)?m.extendDeep(Y,ae):j(ae)}function G(Y){return typeof Y>"u"}function j(Y){return ie(Y)?m.extendDeep({},Y):Y}function ie(Y){return Y!==null&&Y.constructor===Object}}attributeChangedCallback(O,U,J){var H=this.mappings[O];if(O in this.deprecatedMappings&&console.warn(this.deprecatedMappings[O]),!O||!H){super.attributeChangedCallback(O,U,J);return}y(this,H,J)}};return customElements.define(B,L),L.mappings=D,T[B]=L,L};function w(B,I,D){var L=m.entity.getComponentPropertyPath(B);L.constructor===Array?(D[L[0]]=D[L[0]]||{},D[L[0]][L[1]]=I.trim()):D[L]=I.trim()}function S(B,I){var D=f[B].schema;Object.keys(D).map(function(L){var O=L.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();I[O]!==void 0&&(O=B+"-"+L),I[O]=B+"."+L})}function R(B,I,D){D=D||{},Object.keys(I).map(function(L){S(L,D)}),l.exports.registerPrimitive(B,m.extendDeep({},null,{defaultComponents:I,mappings:D}))}l.exports.definePrimitive=R},"./src/extras/primitives/primitives/a-camera.js":(l,u,c)=>{var d=c("./src/extras/primitives/primitives.js").registerPrimitive;d("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},"./src/extras/primitives/primitives/a-cursor.js":(l,u,c)=>{var d=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-cursor",f.extendDeep({},d(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},"./src/extras/primitives/primitives/a-curvedimage.js":(l,u,c)=>{var d=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-curvedimage",f.extendDeep({},d(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},"./src/extras/primitives/primitives/a-gltf-model.js":(l,u,c)=>{var d=c("./src/extras/primitives/primitives.js").registerPrimitive;d("a-gltf-model",{mappings:{src:"gltf-model"}})},"./src/extras/primitives/primitives/a-image.js":(l,u,c)=>{var d=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-image",f.extendDeep({},d(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-light.js":(l,u,c)=>{var d=c("./src/extras/primitives/primitives.js").registerPrimitive;d("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap","shadow-camera-automatic":"light.shadowCameraAutomatic"}})},"./src/extras/primitives/primitives/a-link.js":(l,u,c)=>{var d=c("./src/extras/primitives/primitives.js").registerPrimitive;d("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},"./src/extras/primitives/primitives/a-obj-model.js":(l,u,c)=>{var d=c("./src/extras/primitives/getMeshMixin.js")(),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-obj-model",f.extendDeep({},d,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},"./src/extras/primitives/primitives/a-sky.js":(l,u,c)=>{var d=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js"),m=c("./src/extras/primitives/primitives/meshPrimitives.js");p("a-sky",f.extendDeep({},d(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:f.extendDeep({},m["a-sphere"].mappings)}))},"./src/extras/primitives/primitives/a-sound.js":(l,u,c)=>{var d=c("./src/extras/primitives/primitives.js").registerPrimitive;d("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},"./src/extras/primitives/primitives/a-text.js":(l,u,c)=>{var d=c("./src/extras/primitives/primitives.js").definePrimitive;d("a-text",{text:{anchor:"align",width:5}})},"./src/extras/primitives/primitives/a-video.js":(l,u,c)=>{var d=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-video",f.extendDeep({},d(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-videosphere.js":(l,u,c)=>{var d=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-videosphere",f.extendDeep({},d(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},"./src/extras/primitives/primitives/meshPrimitives.js":(l,u,c)=>{var d=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/core/geometry.js").geometries,f=c("./src/core/geometry.js").geometryNames,m=c("./src/extras/primitives/primitives.js").registerPrimitive,g=c("./src/utils/index.js"),y=l.exports={};f.forEach(function(v){var _=p[v],T=x(v),w={};Object.keys(_.schema).forEach(function(B){w[x(B)]="geometry."+B});var S="a-"+T,R=m(S,g.extendDeep({},d(),{defaultComponents:{geometry:{primitive:v}},mappings:w}));y[S]=R});function x(v){return v.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}},"./src/geometries/box.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");d("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(f){this.geometry=new p.BoxGeometry(f.width,f.height,f.depth,f.segmentsWidth,f.segmentsHeight,f.segmentsDepth)}})},"./src/geometries/circle.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;d("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(m){this.geometry=new p.CircleGeometry(m.radius,m.segments,f(m.thetaStart),f(m.thetaLength))}})},"./src/geometries/cone.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;d("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(m){this.geometry=new p.CylinderGeometry(m.radiusTop,m.radiusBottom,m.height,m.segmentsRadial,m.segmentsHeight,m.openEnded,f(m.thetaStart),f(m.thetaLength))}})},"./src/geometries/cylinder.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;d("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(m){this.geometry=new p.CylinderGeometry(m.radius,m.radius,m.height,m.segmentsRadial,m.segmentsHeight,m.openEnded,f(m.thetaStart),f(m.thetaLength))}})},"./src/geometries/dodecahedron.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");d("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.DodecahedronGeometry(f.radius,f.detail)}})},"./src/geometries/icosahedron.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");d("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.IcosahedronGeometry(f.radius,f.detail)}})},"./src/geometries/index.js":(l,u,c)=>{c("./src/geometries/box.js"),c("./src/geometries/circle.js"),c("./src/geometries/cone.js"),c("./src/geometries/cylinder.js"),c("./src/geometries/dodecahedron.js"),c("./src/geometries/icosahedron.js"),c("./src/geometries/octahedron.js"),c("./src/geometries/plane.js"),c("./src/geometries/ring.js"),c("./src/geometries/sphere.js"),c("./src/geometries/tetrahedron.js"),c("./src/geometries/torus.js"),c("./src/geometries/torusKnot.js"),c("./src/geometries/triangle.js")},"./src/geometries/octahedron.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");d("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.OctahedronGeometry(f.radius,f.detail)}})},"./src/geometries/plane.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");d("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(f){this.geometry=new p.PlaneGeometry(f.width,f.height,f.segmentsWidth,f.segmentsHeight)}})},"./src/geometries/ring.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;d("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(m){this.geometry=new p.RingGeometry(m.radiusInner,m.radiusOuter,m.segmentsTheta,m.segmentsPhi,f(m.thetaStart),f(m.thetaLength))}})},"./src/geometries/sphere.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;d("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(m){this.geometry=new p.SphereGeometry(m.radius,m.segmentsWidth,m.segmentsHeight,f(m.phiStart),f(m.phiLength),f(m.thetaStart),f(m.thetaLength))}})},"./src/geometries/tetrahedron.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");d("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.TetrahedronGeometry(f.radius,f.detail)}})},"./src/geometries/torus.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;d("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(m){this.geometry=new p.TorusGeometry(m.radius,m.radiusTubular*2,m.segmentsRadial,m.segmentsTubular,f(m.arc))}})},"./src/geometries/torusKnot.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");d("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(f){this.geometry=new p.TorusKnotGeometry(f.radius,f.radiusTubular*2,f.segmentsTubular,f.segmentsRadial,f.p,f.q)}})},"./src/geometries/triangle.js":(l,u,c)=>{var d=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=new p.Quaternion,m=new p.Vector3(0,0,1),g=new p.Vector2,y=new p.Vector2,x=new p.Vector2;d("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(v){var _,T,w,S,R,B,I,D,L;w=new p.Triangle,w.a.set(v.vertexA.x,v.vertexA.y,v.vertexA.z),w.b.set(v.vertexB.x,v.vertexB.y,v.vertexB.z),w.c.set(v.vertexC.x,v.vertexC.y,v.vertexC.z),T=w.getNormal(new p.Vector3),f.setFromUnitVectors(T,m),S=w.a.clone().applyQuaternion(f),R=w.b.clone().applyQuaternion(f),B=w.c.clone().applyQuaternion(f),g.set(Math.min(S.x,R.x,B.x),Math.min(S.y,R.y,B.y)),y.set(Math.max(S.x,R.x,B.x),Math.max(S.y,R.y,B.y)),x.set(0,0).subVectors(y,g),S=new p.Vector2().subVectors(S,g).divide(x),R=new p.Vector2().subVectors(R,g).divide(x),B=new p.Vector2().subVectors(B,g).divide(x),_=this.geometry=new p.BufferGeometry,I=[w.a.x,w.a.y,w.a.z,w.b.x,w.b.y,w.b.z,w.c.x,w.c.y,w.c.z],D=[T.x,T.y,T.z,T.x,T.y,T.z,T.x,T.y,T.z],L=[S.x,S.y,R.x,R.y,B.x,B.y],_.setAttribute("position",new p.Float32BufferAttribute(I,3)),_.setAttribute("normal",new p.Float32BufferAttribute(D,3)),_.setAttribute("uv",new p.Float32BufferAttribute(L,2))}})},"./src/index.js":(l,u,c)=>{if(window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices,window.hasNativeWebXRImplementation=navigator.xr!==void 0,!window.hasNativeWebXRImplementation&&!window.hasNativeWebVRImplementation){var d=c("./src/utils/isIOSOlderThan10.js"),p=d(window.navigator.userAgent)?1/window.devicePixelRatio:1,f=c("./node_modules/webvr-polyfill/build/webvr-polyfill.js"),m={BUFFER_SCALE:p,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0,MOBILE_WAKE_LOCK:!!window.cordova};window.webvrpolyfill=new f(m)}var g=c("./src/utils/index.js"),y=g.debug,x=y("A-Frame:error"),v=y("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&v("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),!window.cordova&&window.location.protocol==="file:"&&x("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/1.4.0/introduction/installation.html#use-a-local-server."),g.device.isBrowserEnvironment&&(c("./src/style/aframe.css"),c("./src/style/rStats.css"));var _=c("./src/core/scene/a-scene.js").AScene,T=c("./src/core/component.js").components,w=c("./src/core/component.js").registerComponent,S=c("./src/core/geometry.js").registerGeometry,R=c("./src/extras/primitives/primitives.js").registerPrimitive,B=c("./src/core/shader.js").registerShader,I=c("./src/core/system.js").registerSystem,D=c("./src/core/shader.js").shaders,L=c("./src/core/system.js").systems,O=window.THREE=c("./src/lib/three.js"),U=c("./src/core/readyState.js"),J=c("./package.json");c("./src/components/index.js"),c("./src/geometries/index.js"),c("./src/shaders/index.js"),c("./src/systems/index.js");var H=c("./src/core/a-node.js").ANode,V=c("./src/core/a-entity.js").AEntity;c("./src/core/a-assets.js"),c("./src/core/a-cubemap.js"),c("./src/core/a-mixin.js"),c("./src/extras/components/index.js"),c("./src/extras/primitives/index.js"),console.log("A-Frame Version: 1.6.0 (Date 2024-05-23, Commit #e6c47761)"),console.log("THREE Version (https://github.com/supermedium/three.js):",O.REVISION),console.log("WebVR Polyfill Version:",J.dependencies["webvr-polyfill"]),window.AFRAME_ASYNC||U.waitForDocumentReadyState(),l.exports=window.AFRAME={AComponent:c("./src/core/component.js").Component,AEntity:V,ANode:H,ANIME:c("./node_modules/super-animejs/lib/anime.es.js").default,AScene:_,components:T,coreComponents:Object.keys(T),geometries:c("./src/core/geometry.js").geometries,registerComponent:w,registerGeometry:S,registerPrimitive:R,registerShader:B,registerSystem:I,primitives:{getMeshMixin:c("./src/extras/primitives/getMeshMixin.js"),primitives:c("./src/extras/primitives/primitives.js").primitives},scenes:c("./src/core/scene/scenes.js"),schema:c("./src/core/schema.js"),shaders:D,systems:L,emitReady:U.emitReady,THREE:O,utils:g,version:J.version}},"./src/lib/rStatsAframe.js":l=>{window.aframeStats=function(u){var c=null,d=u,p={te:{caption:"Entities"},lt:{caption:"Load Time"}},f=[{caption:"A-Frame",values:["te","lt"]}];function m(){c("te").set(g()),window.performance.getEntriesByName&&c("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))}function g(){var _=d.querySelectorAll("*");return Array.prototype.slice.call(_).filter(function(T){return T.isEntity}),_.length}function y(){}function x(){}function v(_){c=_}return{update:m,start:y,end:x,attach:v,values:p,groups:f,fractions:[]}},l.exports={aframeStats:window.aframeStats}},"./src/lib/three.js":(l,u,c)=>{var d=c("./src/lib/three.mjs").default;c.g.THREE=d,c("./vendor/DeviceOrientationControls.js"),d.Cache&&(d.Cache.enabled=!0),l.exports=d},"./src/shaders/flat.js":(l,u,c)=>{var d=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=c("./src/utils/index.js");l.exports.Shader=d("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2},toneMapped:{default:!0}},init:function(g){this.materialData={color:new p.Color},m(g,this.materialData),this.material=new p.MeshBasicMaterial(this.materialData)},update:function(g){this.updateMaterial(g),f.material.updateMap(this,g)},updateMaterial:function(g){var y;m(g,this.materialData);for(y in this.materialData)this.material[y]=this.materialData[y]}});function m(g,y){return y.color.set(g.color),y.fog=g.fog,y.wireframe=g.wireframe,y.toneMapped=g.toneMapped,y.wireframeLinewidth=g.wireframeLinewidth,y}},"./src/shaders/index.js":(l,u,c)=>{c("./src/shaders/flat.js"),c("./src/shaders/standard.js"),c("./src/shaders/phong.js"),c("./src/shaders/sdf.js"),c("./src/shaders/msdf.js"),c("./src/shaders/shadow.js")},"./src/shaders/msdf.js":(l,u,c)=>{var d=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),m=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`);l.exports.Shader=d("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},vertexShader:f,fragmentShader:m,init:function(){return this.uniforms=p.UniformsUtils.merge([p.UniformsLib.fog,this.initUniforms()]),this.material=new p.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}})},"./src/shaders/phong.js":(l,u,c)=>{var d=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=c("./src/utils/index.js");l.exports.Shader=d("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(g){this.materialData={color:new p.Color,specular:new p.Color,emissive:new p.Color},m(g,this.materialData),this.material=new p.MeshPhongMaterial(this.materialData);var y=this.el.sceneEl;Object.defineProperty(this.material,"envMap",{get:function(){return this._envMap||y.object3D.environment},set:function(x){this._envMap=x}})},update:function(g){this.updateMaterial(g),f.material.updateMap(this,g),f.material.updateDistortionMap("normal",this,g),f.material.updateDistortionMap("displacement",this,g),f.material.updateDistortionMap("ambientOcclusion",this,g),f.material.updateDistortionMap("bump",this,g),f.material.updateEnvMap(this,g)},updateMaterial:function(g){var y;m(g,this.materialData);for(y in this.materialData)this.material[y]=this.materialData[y]}});function m(g,y){switch(y.color.set(g.color),y.specular.set(g.specular),y.emissive.set(g.emissive),y.emissiveIntensity=g.emissiveIntensity,y.fog=g.fog,y.transparent=g.transparent,y.wireframe=g.wireframe,y.wireframeLinewidth=g.wireframeLinewidth,y.shininess=g.shininess,y.flatShading=g.flatShading,y.wireframe=g.wireframe,y.wireframeLinewidth=g.wireframeLinewidth,y.reflectivity=g.reflectivity,y.refractionRatio=g.refractionRatio,g.combine){case"mix":y.combine=p.MixOperation;break;case"multiply":y.combine=p.MultiplyOperation;break;case"add":y.combine=p.AddOperation;break}return g.normalMap&&(y.normalScale=g.normalScale),g.ambientOcclusionMap&&(y.aoMapIntensity=g.ambientOcclusionMapIntensity),g.bumpMap&&(y.bumpScale=g.bumpMapScale),g.displacementMap&&(y.displacementScale=g.displacementScale,y.displacementBias=g.displacementBias),y}},"./src/shaders/sdf.js":(l,u,c)=>{var d=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),m=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float contour(float width, float value) {","  return smoothstep(0.5 - value, 0.5 + value, width);","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec2 uv = vUV;","  vec4 texColor = texture(map, uv);","  float dist = texColor.a;","  float width = fwidth(dist);","  float alpha = contour(dist, width);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * dist;","  }","  if (isBigEnough <= BIG_ENOUGH) {","    vec4 box = vec4 (uv - duv, uv + duv);","    alpha = (alpha + 0.5 * (","      contour(texture(map, box.xy).a, width)","      + contour(texture(map, box.zw).a, width)","      + contour(texture(map, box.xw).a, width)","      + contour(texture(map, box.zy).a, width)","    )) / 3.0;","  }","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color, opacity * alpha);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`);l.exports.Shader=d("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:f,fragmentShader:m,init:function(){return this.uniforms=p.UniformsUtils.merge([p.UniformsLib.fog,this.initUniforms()]),this.material=new p.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}})},"./src/shaders/shadow.js":(l,u,c)=>{var d=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js");l.exports.Shader=d("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(f){this.material=new p.ShadowMaterial},update:function(f){this.material.opacity=f.opacity,this.material.alphaToCoverage=f.alphaToCoverage,this.material.transparent=f.transparent}})},"./src/shaders/standard.js":(l,u,c)=>{var d=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=c("./src/utils/index.js");l.exports.Shader=d("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(g){this.materialData={color:new p.Color,emissive:new p.Color},m(g,this.materialData),this.material=new p.MeshStandardMaterial(this.materialData)},update:function(g){this.updateMaterial(g),f.material.updateMap(this,g),f.material.updateDistortionMap("normal",this,g),f.material.updateDistortionMap("displacement",this,g),f.material.updateDistortionMap("ambientOcclusion",this,g),f.material.updateDistortionMap("metalness",this,g),f.material.updateDistortionMap("roughness",this,g),f.material.updateEnvMap(this,g)},updateMaterial:function(g){var y,x=this.material;m(g,this.materialData);for(y in this.materialData)x[y]=this.materialData[y]}});function m(g,y){return y.color.set(g.color),y.emissive.set(g.emissive),y.emissiveIntensity=g.emissiveIntensity,y.fog=g.fog,y.metalness=g.metalness,y.roughness=g.roughness,y.wireframe=g.wireframe,y.wireframeLinewidth=g.wireframeLinewidth,g.normalMap&&(y.normalScale=g.normalScale),g.ambientOcclusionMap&&(y.aoMapIntensity=g.ambientOcclusionMapIntensity),g.displacementMap&&(y.displacementScale=g.displacementScale,y.displacementBias=g.displacementBias),y}},"./src/systems/camera.js":(l,u,c)=>{var d=c("./src/constants/index.js"),p=c("./src/core/system.js").registerSystem,f="data-aframe-default-camera";l.exports.System=p("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var g,y,x=this.sceneEl,v=this;if(x.camera&&!x.camera.el.getAttribute("camera").spectator){x.emit("cameraready",{cameraEl:x.camera.el});return}if(g=x.querySelectorAll("a-camera, :not(a-mixin)[camera]"),!g.length){this.createDefaultCamera();return}for(this.numUserCameras=g.length,y=0;y<g.length;y++)g[y].addEventListener("object3dset",function(_){_.detail.type==="camera"&&v.checkUserCamera(this)}),g[y].isNode?g[y].load():g[y].addEventListener("nodeready",function(){this.load()})},checkUserCamera:function(g){var y,x=this.el.sceneEl;if(this.numUserCamerasChecked++,!this.initialCameraFound){if(y=g.getAttribute("camera"),!y.active||y.spectator){this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera();return}this.initialCameraFound=!0,x.camera=g.getObject3D("camera"),x.emit("cameraready",{cameraEl:g})}},createDefaultCamera:function(){var g,y=this.sceneEl;g=document.createElement("a-entity"),g.setAttribute("camera",{active:!0}),g.setAttribute("position",{x:0,y:d.DEFAULT_CAMERA_HEIGHT,z:0}),g.setAttribute("wasd-controls",""),g.setAttribute("look-controls",""),g.setAttribute(d.AFRAME_INJECTED,""),g.addEventListener("object3dset",function(x){x.detail.type==="camera"&&(y.camera=x.detail.object,y.emit("cameraready",{cameraEl:g}))}),y.appendChild(g)},disableActiveCamera:function(){var g,y;g=this.sceneEl.querySelectorAll(":not(a-mixin)[camera]"),y=g[g.length-1],y.setAttribute("camera","active",!0)},setActiveCamera:function(g){var y,x,v,_,T=this.activeCameraEl,w=this.sceneEl;if(_=g.getObject3D("camera"),!(!_||g===this.activeCameraEl)){var S=w.querySelector("["+f+"]"),R=S&&S.querySelector(":not(a-mixin)[camera]");for(g!==R&&m(w),this.activeCameraEl=g,this.activeCameraEl.play(),w.camera=_,T&&T.setAttribute("camera","active",!1),x=w.querySelectorAll(":not(a-mixin)[camera]"),v=0;v<x.length;v++)y=x[v],!(!y.isEntity||g===y)&&(y.setAttribute("camera","active",!1),y.pause());w.emit("camera-set-active",{cameraEl:g})}},setSpectatorCamera:function(g){var y,x=this.spectatorCameraEl,v=this.sceneEl,_;y=g.getObject3D("camera"),!(!y||g===this.spectatorCameraEl)&&(x&&x.setAttribute("camera","spectator",!1),_=this.spectatorCameraEl=g,v.addEventListener("enter-vr",this.wrapRender),v.addEventListener("exit-vr",this.unwrapRender),_.setAttribute("camera","active",!1),_.play(),v.emit("camera-set-spectator",{cameraEl:g}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){!this.spectatorCameraEl||this.originalRender||(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(g,y){var x,v=this.sceneEl,_;x=v.renderer.xr.enabled,this.originalRender.call(v.renderer,g,y),!(!this.spectatorCameraEl||v.isMobile||!x)&&(_=this.spectatorCameraEl.components.camera.camera,v.renderer.xr.enabled=!1,this.originalRender.call(v.renderer,g,_),v.renderer.xr.enabled=x)}});function m(g){var y,x=g.camera;x&&(y=g.querySelector("["+f+"]"),y&&g.removeChild(y))}},"./src/systems/geometry.js":(l,u,c)=>{var d=c("./src/core/geometry.js").geometries,p=c("./src/core/system.js").registerSystem;l.exports.System=p("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(y){var x=this.cache,v,_;return y.skipCache?f(y):(_=this.hash(y),v=x[_],g(this.cacheCount,_),v||(v=f(y),x[_]=v,v))},unuseGeometry:function(y){var x=this.cache,v=this.cacheCount,_,T;y.skipCache||(T=this.hash(y),x[T]&&(m(v,T),!(v[T]>0)&&(_=x[T],_.dispose(),delete x[T],delete v[T])))},hash:function(y){return JSON.stringify(y)}});function f(y){var x=y.primitive,v=d[x]&&d[x].Geometry,_=new v;if(!v)throw new Error("Unknown geometry `"+x+"`");return _.init(y),_.geometry}function m(y,x){y[x]--}function g(y,x){y[x]=y[x]===void 0?1:y[x]+1}},"./src/systems/gltf-model.js":(l,u,c)=>{var d=c("./src/core/system.js").registerSystem,p=c("./src/lib/three.js");function f(m){return new Promise(function(g,y){var x=document.createElement("script");document.body.appendChild(x),x.onload=g,x.onerror=y,x.async=!0,x.src=m})}l.exports.System=d("gltf-model",{schema:{dracoDecoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.5.6/"},basisTranscoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var m=this.data.dracoDecoderPath,g=this.data.basisTranscoderPath,y=this.data.meshoptDecoderPath;!this.dracoLoader&&m&&(this.dracoLoader=new p.DRACOLoader,this.dracoLoader.setDecoderPath(m)),!this.ktx2Loader&&g&&(this.ktx2Loader=new p.KTX2Loader,this.ktx2Loader.setTranscoderPath(g).detectSupport(this.el.renderer)),!this.meshoptDecoder&&y&&(this.meshoptDecoder=f(y).then(function(){return window.MeshoptDecoder.ready}).then(function(){return window.MeshoptDecoder}))},getDRACOLoader:function(){return this.dracoLoader},getKTX2Loader:function(){return this.ktx2Loader},getMeshoptDecoder:function(){return this.meshoptDecoder}})},"./src/systems/index.js":(l,u,c)=>{c("./src/systems/camera.js"),c("./src/systems/geometry.js"),c("./src/systems/gltf-model.js"),c("./src/systems/light.js"),c("./src/systems/material.js"),c("./src/systems/obb-collider.js"),c("./src/systems/renderer.js"),c("./src/systems/shadow.js"),c("./src/systems/tracked-controls-webvr.js"),c("./src/systems/tracked-controls-webxr.js"),c("./src/systems/webxr.js")},"./src/systems/light.js":(l,u,c)=>{var d=c("./src/core/system.js").registerSystem,p=c("./src/constants/index.js"),f="data-aframe-default-light";l.exports.System=d("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",this.setupDefaultLights.bind(this))},registerLight:function(m){m.hasAttribute(f)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var m,g=this.sceneEl;if(this.defaultLights){m=document.querySelectorAll("["+f+"]");for(var y=0;y<m.length;y++)g.removeChild(m[y]);this.defaultLights=!1}},setupDefaultLights:function(){var m=this.sceneEl,g,y;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||(g=document.createElement("a-entity"),g.setAttribute("light",{color:"#BBB",type:"ambient"}),g.setAttribute(f,""),g.setAttribute(p.AFRAME_INJECTED,""),m.appendChild(g),y=document.createElement("a-entity"),y.setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0}),y.setAttribute("position",{x:-.5,y:1,z:1}),y.setAttribute(f,""),y.setAttribute(p.AFRAME_INJECTED,""),m.appendChild(y),this.defaultLights=!0)}})},"./src/systems/material.js":(l,u,c)=>{var d=c("./src/core/system.js").registerSystem,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),m=c("./src/utils/material.js").setTextureProperties,g=c("./src/utils/material.js").createCompatibleTexture,y=f.debug,x=y("components:texture:error"),v=y("components:texture:warn"),_=new p.ImageLoader;l.exports.System=d("material",{init:function(){this.materials={},this.sourceCache={}},clearTextureSourceCache:function(){this.sourceCache={}},loadTexture:function(R,B,I){this.loadTextureSource(R,function(D){var L=g(D);m(L,B),I(L)})},loadTextureSource:function(R,B){var I=this,D=this.sourceCache,L=this.hash(R);if(D[L]){D[L].then(B);return}if(R.tagName==="CANVAS"){U(new p.Source(R));return}U(new Promise(O));function O(J,H){f.srcLoader.validateSrc(R,V,$);function V(Q){I.loadImage(Q,J)}function $(Q){I.loadVideo(Q,J)}}function U(J){D[L]=Promise.resolve(J),D[L].then(B)}},loadCubeMapTexture:function(R,B){var I=this,D=0,L=new p.CubeTexture;L.colorSpace=p.SRGBColorSpace;function O(J){I.loadTextureSource(R[J],function(H){L.images[J]=H,D++,D===6&&(L.needsUpdate=!0,B(L))})}if(R.length!==6){v("Cube map texture requires exactly 6 sources, got only %s sources",R.length);return}for(var U=0;U<R.length;U++)O(U)},loadImage:function(R,B){if(typeof R!="string"){B(new p.Source(R));return}B(T(R))},loadVideo:function(R,B){var I;typeof R!="string"&&(I=R,S(I)),I=I||w(R),B(new p.Source(I))},hash:function(R){return R.tagName&&(R.id||R.src)||R},registerMaterial:function(R){this.materials[R.uuid]=R},unregisterMaterial:function(R){delete this.materials[R.uuid]}});function T(R){return new Promise(B);function B(I,D){_.load(R,L,function(){},function(O){x("`$s` could not be fetched (Error code: %s; Response: %s)",O.status,O.statusText)});function L(O){I(new p.Source(O))}}}function w(R){var B=document.createElement("video");return B.setAttribute("playsinline",""),B.setAttribute("webkit-playsinline",""),B.autoplay=!0,B.loop=!0,B.crossOrigin="anonymous",B.addEventListener("error",function(){v("`%s` is not a valid video",R)},!0),B.src=R,B}function S(R){return R.autoplay=R.hasAttribute("autoplay")&&R.getAttribute("autoplay")!=="false",R.controls=R.hasAttribute("controls")&&R.getAttribute("controls")!=="false",R.getAttribute("loop")==="false"&&R.removeAttribute("loop"),R.getAttribute("preload")==="false"&&(R.preload="none"),R.crossOrigin=R.crossOrigin||"anonymous",R.setAttribute("playsinline",""),R.setAttribute("webkit-playsinline",""),R}},"./src/systems/obb-collider.js":(l,u,c)=>{var d=c("./src/core/system.js").registerSystem;d("obb-collider",{schema:{showColliders:{default:!1}},init:function(){this.collisions=[],this.colliderEls=[]},addCollider:function(p){this.colliderEls.push(p),this.data.showColliders?p.components["obb-collider"].showCollider():p.components["obb-collider"].hideCollider(),this.tick=this.detectCollisions},removeCollider:function(p){var f=this.colliderEls,m=f.indexOf(p);p.components["obb-collider"].hideCollider(),m>-1&&f.splice(m,1),f.length===0&&(this.tick=void 0)},registerCollision:function(p,f){var m=this.collisions,g=!1,y=p.obb,x=f.obb,v=p.renderColliderMesh,_=f.renderColliderMesh;v&&v.material.color.set(16711680),_&&_.material.color.set(16711680);for(var T=0;T<m.length;T++)if(m[T].componentA.obb===y&&m[T].componentB.obb===x||m[T].componentA.obb===x&&m[T].componentB.obb===y){g=!0,m[T].detected=!0;break}g||(m.push({componentA:p,componentB:f,detected:!0}),p.el.emit("obbcollisionstarted",{trackedObject3D:p.trackedObject3D,withEl:f.el}),f.el.emit("obbcollisionstarted",{trackedObject3D:f.trackedObject3D,withEl:p.el}))},resetCollisions:function(){for(var p=this.collisions,f=0;f<p.length;f++)p[f].detected=!1},clearCollisions:function(){for(var p=this.collisions,f=[],m,g,y,x,v=0;v<p.length;v++)p[v].detected?f.push(p[v]):(m=p[v].componentA,g=p[v].componentB,y=m.renderColliderMesh,x=g.renderColliderMesh,y&&y.material.color.set(65280),m.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:g.el}),x&&x.material.color.set(65280),g.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:m.el}));this.collisions=f},detectCollisions:function(){var p,f,m,g,y=this.colliderEls;if(!(y.length<2)){this.resetCollisions();for(var x=0;x<y.length;x++)if(m=y[x].components["obb-collider"],p=y[x].components["obb-collider"].obb,!(p.halfSize.x===0||p.halfSize.y===0||p.halfSize.z===0))for(var v=x+1;v<y.length;v++)g=y[v].components["obb-collider"],f=g.obb,!(f.halfSize.x===0||f.halfSize.y===0||f.halfSize.z===0)&&p.intersectsOBB(f)&&this.registerCollision(m,g);this.clearCollisions()}}})},"./src/systems/renderer.js":(l,u,c)=>{var d=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js"),f=c("./src/lib/three.js"),m=p.debug,g=m("components:renderer:warn");l.exports.System=d("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:p.device.isOculusBrowser()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:-1},maxCanvasHeight:{default:-1},multiviewStereo:{default:!1},physicallyCorrectLights:{default:!1},exposure:{default:1,if:{toneMapping:["ACESFilmic","linear","reinhard","cineon"]}},toneMapping:{default:"no",oneOf:["no","ACESFilmic","linear","reinhard","cineon"]},precision:{default:"high",oneOf:["high","medium","low"]},anisotropy:{default:1},sortTransparentObjects:{default:!1},colorManagement:{default:!0},alpha:{default:!0},stencil:{default:!1},foveationLevel:{default:1}},init:function(){var _=this.data,T=this.el,w=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1),S=T.renderer;_.physicallyCorrectLights||(S.useLegacyLights=!_.physicallyCorrectLights),S.toneMapping=f[w+"ToneMapping"],f.Texture.DEFAULT_ANISOTROPY=_.anisotropy,f.ColorManagement.enabled=_.colorManagement,S.outputColorSpace=_.colorManagement?f.SRGBColorSpace:f.LinearSRGBColorSpace,T.hasAttribute("antialias")&&g('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),T.hasAttribute("logarithmicDepthBuffer")&&g('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.'),S.sortObjects=!0,S.setOpaqueSort(y)},update:function(){var _=this.data,T=this.el,w=T.renderer,S=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1);w.toneMapping=f[S+"ToneMapping"],w.toneMappingExposure=_.exposure,w.xr.setFoveation(_.foveationLevel),_.sortObjects&&g('`sortObjects` property is deprecated. Use `renderer="sortTransparentObjects: true"` instead.'),_.sortTransparentObjects?w.setTransparentSort(v):w.setTransparentSort(x)},applyColorCorrection:function(_){!this.data.colorManagement||!_||_.isTexture&&_.colorSpace!==f.SRGBColorSpace&&(_.colorSpace=f.SRGBColorSpace,_.needsUpdate=!0)},setWebXRFrameRate:function(_){var T=this.data,w=_.supportedFrameRates;if(w&&_.updateTargetFrameRate){var S;w.includes(90)?S=T.highRefreshRate?90:72:S=T.highRefreshRate?72:60,_.updateTargetFrameRate(S).catch(function(R){console.warn("failed to set target frame rate of "+S+". Error info: "+R)})}}});function y(_,T){return _.groupOrder!==T.groupOrder?_.groupOrder-T.groupOrder:_.renderOrder!==T.renderOrder?_.renderOrder-T.renderOrder:_.z-T.z}function x(_,T){return _.groupOrder!==T.groupOrder?_.groupOrder-T.groupOrder:_.renderOrder-T.renderOrder}function v(_,T){return _.groupOrder!==T.groupOrder?_.groupOrder-T.groupOrder:_.renderOrder!==T.renderOrder?_.renderOrder-T.renderOrder:T.z-_.z}l.exports.sortFrontToBack=y,l.exports.sortRenderOrderOnly=x,l.exports.sortBackToFront=v},"./src/systems/shadow.js":(l,u,c)=>{var d=c("./src/core/system.js").registerSystem,p=c("./src/lib/three.js"),f={basic:p.BasicShadowMap,pcf:p.PCFShadowMap,pcfsoft:p.PCFSoftShadowMap};l.exports.System=d("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var g=this.sceneEl,y=this.data;this.shadowMapEnabled=!1,g.renderer.shadowMap.type=f[y.type],g.renderer.shadowMap.autoUpdate=y.autoUpdate},update:function(g){g.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.shadowMapEnabled)},setShadowMapEnabled:function(g){var y=this.sceneEl,x=this.sceneEl.renderer;this.shadowMapEnabled=g;var v=this.data.enabled&&this.shadowMapEnabled;x&&v!==x.shadowMap.enabled&&(x.shadowMap.enabled=v,m(y))}});function m(g){g.hasLoaded&&g.object3D.traverse(function(y){if(y.material)for(var x=Array.isArray(y.material)?y.material:[y.material],v=0;v<x.length;v++)x[v].needsUpdate=!0})}},"./src/systems/tracked-controls-webvr.js":(l,u,c)=>{var d=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js"),f=p.device.isWebXRAvailable;l.exports.System=d("tracked-controls-webvr",{init:function(){var m=this;this.controllers=[],this.isChrome=navigator.userAgent.indexOf("Chrome")!==-1,this.updateControllerList(),this.throttledUpdateControllerList=p.throttle(this.updateControllerList,500,this),!f&&navigator.getVRDisplays&&this.sceneEl.addEventListener("enter-vr",function(){navigator.getVRDisplays().then(function(g){g.length&&(m.vrDisplay=g[0])})})},tick:function(){this.isChrome?this.updateControllerList():this.throttledUpdateControllerList()},updateControllerList:function(){var m=this.controllers,g,y,x,v;if(y=navigator.getGamepads&&navigator.getGamepads(),!!y){for(v=m.length,m.length=0,x=0;x<y.length;++x)g=y[x],g&&g.pose&&m.push(g);m.length!==v&&this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/tracked-controls-webxr.js":(l,u,c)=>{var d=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js");l.exports.System=d("tracked-controls-webxr",{init:function(){this.controllers=[],this.oldControllers=[],this.oldControllersLength=0,this.throttledUpdateControllerList=p.throttle(this.updateControllerList,500,this),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.addEventListener("enter-vr",this.updateReferenceSpace),this.el.addEventListener("exit-vr",this.updateReferenceSpace)},tick:function(){this.throttledUpdateControllerList()},updateReferenceSpace:function(){var f=this,m=this.el.xrSession;if(!m){this.referenceSpace=void 0,this.controllers=[],this.oldControllersLength>0&&(this.oldControllersLength=0,this.el.emit("controllersupdated",void 0,!1));return}var g=f.el.sceneEl.systems.webxr.sessionReferenceSpaceType;m.requestReferenceSpace(g).then(function(y){f.referenceSpace=y}).catch(function(y){throw f.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(g,'tracked-controls-webxr uses reference space "'+g+'".'),y})},updateControllerList:function(){var f=this.el.xrSession,m=this.oldControllers,g;if(!f){if(this.oldControllersLength===0)return;this.oldControllersLength=0,this.controllers=[],this.el.emit("controllersupdated",void 0,!1);return}if(f.inputSources){if(this.controllers=f.inputSources,this.oldControllersLength===this.controllers.length){var y=!0;for(g=0;g<this.controllers.length;++g)if(!(this.controllers[g]===m[g]&&this.controllers[g].gamepad===m[g].gamepad)){y=!1;break}if(y)return}for(m.length=0,g=0;g<this.controllers.length;g++)m.push(this.controllers[g]);this.oldControllersLength=this.controllers.length,this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/webxr.js":(l,u,c)=>{var d=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js"),f=p.debug("systems:webxr:warn");l.exports.System=d("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var m=this.data;this.sessionConfiguration={requiredFeatures:m.requiredFeatures,optionalFeatures:m.optionalFeatures},this.sessionReferenceSpaceType=m.referenceSpaceType,m.overlayElement&&(m.overlayElement.classList.remove("a-dom-overlay"),m.optionalFeatures.includes("dom-overlay")||(m.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",m)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:m.overlayElement},m.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(m){return!!(m==="viewer"||m==="local"||this.sessionConfiguration.requiredFeatures.includes(m)||this.sessionConfiguration.optionalFeatures.includes(m))},warnIfFeatureNotRequested:function(m,g){if(!this.wasFeatureRequested(m)){var y='Please add the feature "'+m+`" to a-scene's webxr system options in requiredFeatures/optionalFeatures.`;f((g?g+" ":"")+y)}}})},"./src/utils/coordinates.js":(l,u,c)=>{var d=c("./src/utils/debug.js"),p=d("utils:coordinates:warn"),f=["x","y","z","w"],m=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;l.exports.regex=m;var g=/\s+/g;function y(w,S,R){var B,I,D,L,O=R&&typeof R=="object"?R:{},U,J,H,V;if(w&&w instanceof Object)return U=w.x===void 0?S&&S.x:w.x,J=w.y===void 0?S&&S.y:w.y,H=w.z===void 0?S&&S.z:w.z,V=w.w===void 0?S&&S.w:w.w,U!=null&&(O.x=T(U)),J!=null&&(O.y=T(J)),H!=null&&(O.z=T(H)),V!=null&&(O.w=T(V)),O;if(w==null)return typeof S=="object"?Object.assign(O,S):S;for(B=w.trim().split(g),L=0;L<f.length;L++)if(D=f[L],B[L])O[D]=parseFloat(B[L],10);else{if(I=S&&S[D],I===void 0)continue;O[D]=T(I)}return O}l.exports.parse=y;function x(w){var S;return typeof w!="object"?w:(S=w.x+" "+w.y,w.z!=null&&(S+=" "+w.z),w.w!=null&&(S+=" "+w.w),S)}l.exports.stringify=x;function v(w,S){return typeof w!="object"||typeof S!="object"?w===S:w.x===S.x&&w.y===S.y&&w.z===S.z&&w.w===S.w}l.exports.equals=v;function _(w){return m.test(w)}l.exports.isCoordinates=_,l.exports.isCoordinate=function(w){return p("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),_(w)};function T(w){return w!=null&&w.constructor===String?parseFloat(w,10):w}l.exports.toVector3=function(w){return new THREE.Vector3(w.x,w.y,w.z)}},"./src/utils/debug.js":(l,u,c)=>{var d=c("./node_modules/debug/src/browser.js"),p=c("./src/utils/device.js").isBrowserEnvironment,f={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}};d.formatArgs=m;function m(_){if(_[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_[0]+(this.useColors?"%c ":" "),!!this.useColors){this.color=y(this.namespace);var T="color: "+this.color;_.splice(1,0,T,"color: inherit");var w=0,S=0;_[0].replace(/%[a-zA-Z%]/g,function(R){R!=="%%"&&(w++,R==="%c"&&(S=w))}),_.splice(S,0,T)}}function g(_){var T=_.split(":");return T[T.length-1]}function y(_){var T=g(_),w=f.colors&&f.colors[T];return w||null}function x(){try{return window.localStorage}catch{}}var v=x();v&&(parseInt(v.logs,10)||v.logs==="true")?d.enable("*"):d.enable("*:error,*:info,*:warn"),p&&(window.logs=d),l.exports=d},"./src/utils/device.js":(l,u,c)=>{var d=c("./node_modules/debug/src/browser.js")("device:error"),p,f=!1,m=!1,g=l.exports.isWebXRAvailable=navigator.xr!==void 0;if(window.addEventListener("vrdisplayactivate",function(H){var V;g||(V=document.createElement("canvas"),p=H.display,V.getContext("webgl",{}),p.requestPresent([{source:V}]).then(function(){},function(){}))}),g){var y=function(){var H=document.querySelector("a-scene");if(!H){window.addEventListener("DOMContentLoaded",y);return}H.hasLoaded?H.components["xr-mode-ui"].updateEnterInterfaces():H.addEventListener("loaded",y)},x=function(H){d("WebXR session support error: "+H.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(H){f=H,y()}).catch(x),navigator.xr.isSessionSupported("immersive-ar").then(function(H){m=H,y()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){f=!0,y()}).catch(x),navigator.xr.supportsSession("immersive-ar").then(function(){m=!0,y()}).catch(function(){})):d("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then(function(H){var V=document.querySelector("a-scene");p=H.length&&H[0],V&&V.emit("displayconnected",{vrDisplay:p})});function v(){return p}l.exports.getVRDisplay=v;function _(){return f||m||!!v()}l.exports.checkHeadsetConnected=_;function T(){return m}l.exports.checkARSupport=T;function w(){return f}l.exports.checkVRSupport=w;var S=function(){var H=!1;return function(V){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(V)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(V.substr(0,4)))&&(H=!0),(I()||R()||J())&&(H=!0),U()&&(H=!1)}(window.navigator.userAgent||window.navigator.vendor||window.opera),function(){return H}}();l.exports.isMobile=S;function R(H){var V=H||window.navigator.userAgent,$=/Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(V);return $||B()}l.exports.isTablet=R;function B(H,V,$){var Q=H||window.navigator.userAgent,G=V||window.navigator.platform,j=$||window.navigator.maxTouchPoints||0;return(G==="iPad"||G==="MacIntel")&&j>0&&/Macintosh|Intel|iPad|ipad/i.test(Q)&&!window.MSStream}l.exports.isIpad=B;function I(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}l.exports.isIOS=I;function D(){return!S()&&!U()&&window.orientation!==void 0}l.exports.isMobileDeviceRequestingDesktopSite=D;function L(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}l.exports.isOculusBrowser=L;function O(){return/(Mobile VR)/i.test(window.navigator.userAgent)}l.exports.isFirefoxReality=O;function U(){return L()||O()}l.exports.isMobileVR=U;function J(){return/R7 Build/.test(window.navigator.userAgent)}l.exports.isR7=J,l.exports.isLandscape=function(){var H=window.orientation;return J()&&(H+=90),H===90||H===-90},l.exports.isBrowserEnvironment=typeof process>"u"||process.browser===!0,l.exports.isNodeEnvironment=!l.exports.isBrowserEnvironment},"./src/utils/entity.js":(l,u,c)=>{var d=c("./src/utils/split.js").split;function p(f,m){m=m||".";var g=d(f,m);return g.length===1?g[0]:g}l.exports.getComponentPropertyPath=p,l.exports.getComponentProperty=function(f,m,g){var y;return g=g||".",m.indexOf(g)!==-1?(y=p(m,g),y.constructor===String?f.getAttribute(y):f.getAttribute(y[0])[y[1]]):f.getAttribute(m)},l.exports.setComponentProperty=function(f,m,g,y){var x;if(y=y||".",m.indexOf(y)!==-1){x=p(m,y),x.constructor===String?f.setAttribute(x,g):f.setAttribute(x[0],x[1],g);return}f.setAttribute(m,g)}},"./src/utils/forceCanvasResizeSafariMobile.js":l=>{l.exports=function(u){var c=u.style.width,d=u.style.height;u.style.width=parseInt(c,10)+1+"px",u.style.height=parseInt(d,10)+1+"px",setTimeout(function(){u.style.width=c,u.style.height=d},200)}},"./src/utils/index.js":(l,u,c)=>{var d=c("./src/utils/debug.js"),p=c("./node_modules/deep-assign/index.js"),f=c("./src/utils/device.js"),m=c("./src/utils/object-pool.js"),g=d("utils:warn");l.exports.bind=function(x){return x.bind.apply(x,Array.prototype.slice.call(arguments,1))},l.exports.coordinates=c("./src/utils/coordinates.js"),l.exports.debug=d,l.exports.device=f,l.exports.entity=c("./src/utils/entity.js"),l.exports.forceCanvasResizeSafariMobile=c("./src/utils/forceCanvasResizeSafariMobile.js"),l.exports.material=c("./src/utils/material.js"),l.exports.objectPool=m,l.exports.split=c("./src/utils/split.js").split,l.exports.styleParser=c("./src/utils/styleParser.js"),l.exports.trackedControls=c("./src/utils/tracked-controls.js"),l.exports.checkHeadsetConnected=function(){return g("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),f.checkHeadsetConnected(arguments)},l.exports.isGearVR=l.exports.device.isGearVR=function(){g("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},l.exports.isIOS=function(){return g("`utils.isIOS` has moved to `utils.device.isIOS`"),f.isIOS(arguments)},l.exports.isOculusGo=l.exports.device.isOculusGo=function(){g("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},l.exports.isMobile=function(){return g("`utils.isMobile has moved to `utils.device.isMobile`"),f.isMobile(arguments)},l.exports.throttle=function(x,v,_){var T;return _&&(x=x.bind(_)),function(){var w=Date.now(),S=typeof T>"u"?v:w-T;(typeof T>"u"||S>=v)&&(T=w,x.apply(null,arguments))}},l.exports.throttleLeadingAndTrailing=function(x,v,_){var T,w;_&&(x=x.bind(_));var S,R=function(){T=Date.now(),x.apply(this,S),w=void 0};return function(){var B=Date.now(),I=typeof T>"u"?v:B-T;I>=v?(clearTimeout(w),w=void 0,T=B,x.apply(null,arguments)):(w=w||setTimeout(R,v-I),S=arguments)}},l.exports.throttleTick=function(x,v,_){var T;return _&&(x=x.bind(_)),function(w,S){var R=typeof T>"u"?S:w-T;(typeof T>"u"||R>=v)&&(T=w,x(w,R))}},l.exports.debounce=function(x,v,_){var T;return function(){var w=this,S=arguments,R=function(){T=null,_||x.apply(w,S)},B=_&&!T;clearTimeout(T),T=setTimeout(R,v),B&&x.apply(w,S)}},l.exports.extend=Object.assign,l.exports.extendDeep=p,l.exports.clone=function(x){return JSON.parse(JSON.stringify(x))};var y=function(){var x=m.createPool(function(){return[]});return function(v,_){var T,w,S,R,B,I;if(v===void 0||_===void 0||v===null||_===null||!(v&&_&&v.constructor===Object&&_.constructor===Object||v.constructor===Array&&_.constructor===Array))return v===_;w=x.use(),S=x.use(),w.length=0,S.length=0;for(T in v)w.push(T);for(T in _)S.push(T);if(w.length!==S.length)return x.recycle(w),x.recycle(S),!1;for(R=0;R<w.length;++R)if(B=v[w[R]],I=_[w[R]],typeof B=="object"||typeof I=="object"||Array.isArray(B)&&Array.isArray(I)){if(B===I)continue;if(!y(B,I))return x.recycle(w),x.recycle(S),!1}else if(B!==I)return x.recycle(w),x.recycle(S),!1;return x.recycle(w),x.recycle(S),!0}}();l.exports.deepEqual=y,l.exports.diff=function(){var x=[];return function(v,_,T){var w,S,R,B,I,D,L;B=T||{},x.length=0;for(I in v)x.push(I);if(!_)return B;for(R in _)x.indexOf(R)===-1&&x.push(R);for(D=0;D<x.length;D++)I=x[D],w=v[I],S=_[I],L=w&&S&&w.constructor===Object&&S.constructor===Object,(L&&!y(w,S)||!L&&w!==S)&&(B[I]=S);return B}}(),l.exports.shouldCaptureKeyEvent=function(x){return x.metaKey?!1:document.activeElement===document.body},l.exports.splitString=function(x,v){typeof v>"u"&&(v=" ");var _=new RegExp(v,"g");return x=(x||"").replace(_,v),x.split(v)},l.exports.getElData=function(x,v){v=v||{};var _={};Object.keys(v).forEach(T);function T(w){x.hasAttribute(w)&&(_[w]=x.getAttribute(w))}return _},l.exports.getUrlParameter=function(x){x=x.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var v=new RegExp("[\\?&]"+x+"=([^&#]*)"),_=v.exec(location.search);return _===null?"":decodeURIComponent(_[1].replace(/\+/g," "))},l.exports.isIframed=function(){return window.top!==window.self},l.exports.findAllScenes=function(x){for(var v=[],_=x.getElementsByTagName("*"),T=0,w=_.length;T<w;T++)_[T].isScene&&v.push(_[T]);return v},l.exports.srcLoader=c("./src/utils/src-loader.js")},"./src/utils/ios-orientationchange-blank-bug.js":()=>{window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)})},"./src/utils/isIOSOlderThan10.js":l=>{l.exports=function(u){return/(iphone|ipod|ipad).*os.(7_|8_|9_)/i.test(u)}},"./src/utils/material.js":(l,u,c)=>{var d=c("./src/lib/three.js"),p=c("./src/utils/src-loader.js"),f=c("./src/utils/debug.js"),m=f("utils:material:warn"),g=new Set(["emissiveMap","envMap","map","specularMap"]);function y(w,S){var R=S.offset||{x:0,y:0},B=S.repeat||{x:1,y:1},I=S.npot||!1,D=S.anisotropy||d.Texture.DEFAULT_ANISOTROPY,L=w.wrapS,O=w.wrapT,U=w.magFilter,J=w.minFilter;I&&(L=d.ClampToEdgeWrapping,O=d.ClampToEdgeWrapping,U=d.LinearFilter,J=d.LinearFilter),(B.x!==1||B.y!==1)&&(L=d.RepeatWrapping,O=d.RepeatWrapping),w.offset.set(R.x,R.y),w.repeat.set(B.x,B.y),(w.wrapS!==L||w.wrapT!==O||w.magFilter!==U||w.minFilter!==J||w.anisotropy!==D)&&(w.wrapS=L,w.wrapT=O,w.magFilter=U,w.minFilter=J,w.anisotropy=D,w.needsUpdate=!0)}l.exports.setTextureProperties=y,l.exports.updateMapMaterialFromData=function(w,S,R,B){var I=R.el,D=R.material,L=I.sceneEl.systems.renderer,O=B[S];if(R.materialSrcs||(R.materialSrcs={}),!O){delete R.materialSrcs[w],J(null);return}if(O===R.materialSrcs[w]&&D[w]){y(D[w],B);return}R.materialSrcs[w]=O,O instanceof d.Texture?J(O):I.sceneEl.systems.material.loadTextureSource(O,U);function U(H){if(R.materialSrcs[w]===O){var V=D[w];V&&(H===null||!_(V,H))&&(V=null),!V&&H&&(V=T(H)),V&&(V.source!==H&&(V.source=H,V.needsUpdate=!0),g.has(w)&&L.applyColorCorrection(V),y(V,B)),J(V)}}function J(H){D[w]!==H&&(D[w]&&D[w].dispose(),D[w]=H,D.needsUpdate=!0,v(I,H))}},l.exports.updateMap=function(w,S){return l.exports.updateMapMaterialFromData("map","src",w,S)},l.exports.updateDistortionMap=function(w,S,R){var B=w;w==="ambientOcclusion"&&(B="ao");var I={};return I.src=R[w+"Map"],I.offset=R[w+"TextureOffset"],I.repeat=R[w+"TextureRepeat"],I.wrap=R[w+"TextureWrap"],l.exports.updateMapMaterialFromData(B+"Map","src",S,I)};var x={};l.exports.updateEnvMap=function(w,S){var R=w.material,B=w.el,I="envMap",D=S.envMap,L=S.sphericalEnvMap,O=S.refract;if(L&&(D=L,m("`sphericalEnvMap` property is deprecated, using spherical map as equirectangular map instead. Use `envMap` property with a CubeMap or Equirectangular image instead.")),w.materialSrcs||(w.materialSrcs={}),!D){delete w.materialSrcs[I],R.envMap=null,R.needsUpdate=!0;return}if(w.materialSrcs[I]=D,x[D]){x[D].then(U);return}x[D]=new Promise(function(J){p.validateEnvMapSrc(D,function(H){B.sceneEl.systems.material.loadCubeMapTexture(H,function(V){V.mapping=O?d.CubeRefractionMapping:d.CubeReflectionMapping,U(V),J(V)})},function(H){B.sceneEl.systems.material.loadTexture(H,{src:H},function(V){V.mapping=O?d.EquirectangularRefractionMapping:d.EquirectangularReflectionMapping,U(V),J(V)})})});function U(J){w.materialSrcs[I]===D&&(R.envMap=J,R.needsUpdate=!0,v(B,J))}};function v(w,S){if(!S||(w.emit("materialtextureloaded",{src:S.image,texture:S}),!S.image||S.image.tagName!=="VIDEO"))return;S.image.addEventListener("loadeddata",R),S.image.addEventListener("ended",B);function R(){w.emit("materialvideoloadeddata",{src:S.image,texture:S})}function B(){w.emit("materialvideoended",{src:S.image,texture:S})}S.addEventListener("dispose",function(){S.image.removeEventListener("loadeddata",R),S.image.removeEventListener("ended",B)})}l.exports.handleTextureEvents=v;function _(w,S){return S.data instanceof HTMLCanvasElement?w.isCanvasTexture:S.data instanceof HTMLVideoElement?w.isVideoTexture&&w.source===S:w.isTexture&&!w.isCanvasTexture&&!w.isVideoTexture}l.exports.isCompatibleTexture=_;function T(w){var S;return w.data instanceof HTMLCanvasElement?S=new d.CanvasTexture:w.data instanceof HTMLVideoElement?S=new d.VideoTexture(w.data):S=new d.Texture,S.source=w,S.needsUpdate=!0,S}l.exports.createCompatibleTexture=T},"./src/utils/math.js":l=>{function u(d,p,f){var m=p.dot(d);return(m-p.dot(f))/p.length()}function c(d,p,f,m){var g=u(d,p,f);return m.copy(p),m.multiplyScalar(g),m.add(f),m}l.exports.distanceOfPointFromPlane=u,l.exports.nearestPointInPlane=c},"./src/utils/object-pool.js":l=>{var u=Object.freeze(Object.create(null));function c(){return{}}l.exports.createPool=function(f){var m=[],g=null;f=f||c;function y(){var T;return(g===null||g===m.length)&&v(m.length||5),T=m[g],m[g++]=u,d(T),T}function x(T){if(T instanceof Object){if(g===null||g===-1){m[m.length]=T;return}m[--g]=T}}function v(T){var w,S;if(T=T===void 0?m.length:T,T>0&&g==null&&(g=0),T>0)for(w=m.length,m.length+=Number(T),S=w;S<m.length;S++)m[S]=f();return m.length}function _(){return m.length}return{grow:v,pool:m,recycle:x,size:_,use:y}};function d(f){var m;if(!(!f||f.constructor!==Object))for(m in f)f[m]=void 0}l.exports.clearObject=d;function p(f,m){var g;if(!(!f||f.constructor!==Object))for(g in f)g in m||delete f[g]}l.exports.removeUnusedKeys=p},"./src/utils/split.js":l=>{l.exports.split=function(){var u={};return function(c,d){return d in u||(u[d]={}),c in u[d]||(u[d][c]=c.split(d)),u[d][c]}}()},"./src/utils/src-loader.js":(l,u,c)=>{var d=c("./src/utils/debug.js"),p=d("utils:src-loader:warn");function f(T,w,S){x(T,function(R){if(R){w(T);return}S(T)})}function m(T,w,S){var R,B="",I,D,L=[];if(typeof T=="string"){let U=function(J){L.push(J),L.length===6&&w(L)};for(I=0;I<5;I++)B+="(url\\((?:[^\\)]+)\\),\\s*)";if(B+="(url\\((?:[^\\)]+)\\)\\s*)",D=T.match(new RegExp(B)),D){for(I=1;I<7;I++)f(y(D[I]),U);return}if(!T.startsWith("#")){var O=y(T);f(O||T,S);return}}if(T.tagName?R=T:R=_(T),!!R){if(R.tagName==="A-CUBEMAP"&&R.srcs)return w(R.srcs);if(R.tagName==="IMG")return S(R);p('Selector "%s" does not point to <a-cubemap> or <img>',T)}}function g(T,w){return m(T,w,function(){p("Expected cubemap but got image")})}function y(T){var w=T.match(/url\((.+)\)/);if(w)return w[1]}function x(T,w){var S;if(T.tagName){w(T.tagName==="IMG");return}S=new XMLHttpRequest,S.open("HEAD",T),S.addEventListener("load",function(R){var B;S.status>=200&&S.status<300?(B=S.getResponseHeader("Content-Type"),B==null?v(T,w):B.startsWith("image")?w(!0):w(!1)):v(T,w),S.abort()}),S.send()}function v(T,w){var S=new Image;S.addEventListener("load",R);function R(){w(!0)}S.addEventListener("error",B);function B(){w(!1)}S.src=T}function _(T){try{var w=document.querySelector(T);return w||p('No element was found matching the selector: "%s"',T),w}catch{p('"%s" is not a valid selector',T);return}}l.exports={parseUrl:y,validateSrc:f,validateCubemapSrc:g,validateEnvMapSrc:m}},"./src/utils/styleParser.js":l=>{var u=/-([a-z])/g;l.exports.parse=function(g,y){var x;return typeof g!="string"||(x=p(g,y),x[""])?g:x},l.exports.stringify=function(g){return typeof g=="string"?g:f(g)};function c(g){return g.replace(u,m)}l.exports.toCamelCase=c;var d=function(){var g=[],y=/url\([^)]+$/;return function(x){var v="",_,T=0,w=";";for(g.length=0;T<x.length;){if(_=x.indexOf(w,T),_===-1&&(_=x.length),v+=x.substring(T,_),y.test(v)){v+=";",T=_+1;continue}g.push(v.trim()),v="",T=_+1}return g}}();function p(g,y){var x,v,_,T,w,S;for(y=y||{},x=d(g),v=0;v<x.length;v++)_=x[v],_&&(T=_.indexOf(":"),w=_.substr(0,T).trim(),S=_.substr(T+1).trim(),y[c(w)]=S);return y}function f(g){var y,x=0,v=0,_="";for(y in g)x++;for(y in g)_+=y+": "+g[y],v<x-1&&(_+="; "),v++;return _}function m(g){return g[1].toUpperCase()}},"./src/utils/tracked-controls.js":(l,u,c)=>{var d=c("./src/constants/index.js").DEFAULT_HANDEDNESS,p=["x","y","z","w"],f=2;l.exports.checkControllerPresentAndSetup=function(v,_,T){var w=v.el,S,R=w.sceneEl.hasWebXR,B=R?g:m,I;if(S=B(v,_,T),I=!!S,v.controllerPresent&&!v.controllerEventsActive&&!R&&v.addEventListeners(),I===v.controllerPresent)return I;v.controllerPresent=I,I?(v.addEventListeners(),v.injectTrackedControls(S),w.emit("controllerconnected",{name:v.name,component:v})):(v.removeEventListeners(),w.emit("controllerdisconnected",{name:v.name,component:v}))};function m(v,_,T){var w,S=v.el.sceneEl,R,B=T.index||0;return!_||(R=S&&S.systems["tracked-controls-webvr"],!R)||(w=R.controllers,!w.length)?!1:!!y(w,null,_,T.hand,B)}function g(v,_,T){var w,S=v.el.sceneEl,R=S&&S.systems["tracked-controls-webxr"];return!R||(w=R.controllers,!w||!w.length)?!1:x(w,_,T.hand,T.index,T.iterateControllerProfiles,T.handTracking)}l.exports.isControllerPresentWebVR=m,l.exports.isControllerPresentWebXR=g;function y(v,_,T,w,S){var R,B,I=0,D=S>=0?S:0;for(B=0;B<v.length;B++)if(R=v[B],!(T&&!R.id.startsWith(T))&&!(!T&&R.id!==_)&&!(w&&R.hand&&w!==R.hand)){if(w&&!R.hand)D=f*S+(w===d?0:1);else return R;if(I===D)return R;++I}}function x(v,_,T,w,S,R){var B,I,D,L=!1,O,U;for(B=0;B<v.length;B++){if(D=v[B],U=D.profiles,R)L=D.hand;else if(S)for(I=0;I<U.length&&(L=U[I].startsWith(_),!L);I++);else L=U.length>0&&U[0].startsWith(_);if(L){if(O=D.handedness==="right"||D.handedness==="left",O){if(D.handedness===T)return v[B]}else if(B===w)return v[B]}}}l.exports.findMatchingControllerWebVR=y,l.exports.findMatchingControllerWebXR=x,l.exports.emitIfAxesChanged=function(v,_,T){var w,S,R,B,I;for(S in _){for(w=_[S],R=!1,I=0;I<w.length;I++)T.detail.changed[w[I]]&&(R=!0);if(R){for(B={},I=0;I<w.length;I++)B[p[I]]=T.detail.axis[w[I]];v.el.emit(S+"moved",B)}}},l.exports.onButtonEvent=function(v,_,T,w){var S=w?T.mapping[w]:T.mapping,R=S.buttons[v];T.el.emit(R+_),T.updateModel&&T.updateModel(R,_)}},"./vendor/DeviceOrientationControls.js":()=>{THREE.DeviceOrientationControls=function(l){var u=this;this.object=l,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var c=function(f){u.deviceOrientation=f},d=function(){u.screenOrientation=window.orientation||0},p=function(){var f=new THREE.Vector3(0,0,1),m=new THREE.Euler,g=new THREE.Quaternion,y=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(x,v,_,T,w){m.set(_,v,-T,"YXZ"),x.setFromEuler(m),x.multiply(y),x.multiply(g.setFromAxisAngle(f,-w))}}();this.connect=function(){d(),window.addEventListener("orientationchange",d,!1),window.addEventListener("deviceorientation",c,!1),u.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",d,!1),window.removeEventListener("deviceorientation",c,!1),u.enabled=!1},this.update=function(){if(u.enabled!==!1){var f=u.deviceOrientation;if(f){var m=f.alpha?THREE.MathUtils.degToRad(f.alpha)+u.alphaOffset:0,g=f.beta?THREE.MathUtils.degToRad(f.beta):0,y=f.gamma?THREE.MathUtils.degToRad(f.gamma):0,x=u.screenOrientation?THREE.MathUtils.degToRad(u.screenOrientation):0;p(u.object.quaternion,m,g,y,x)}}},this.dispose=function(){u.disconnect()},this.connect()}},"./vendor/rStats.extras.js":l=>{window.glStats=function(){var u=null,c=0,d=0,p=0,f=0,m=0,g=0,y=0;function x(I,D){return function(){D.apply(this,arguments),I.apply(this,arguments)}}WebGLRenderingContext.prototype.drawArrays=x(WebGLRenderingContext.prototype.drawArrays,function(){c++,arguments[0]==this.POINTS?g+=arguments[2]:m+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=x(WebGLRenderingContext.prototype.drawElements,function(){d++,f+=arguments[1]/3,m+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=x(WebGLRenderingContext.prototype.useProgram,function(){p++}),WebGLRenderingContext.prototype.bindTexture=x(WebGLRenderingContext.prototype.bindTexture,function(){y++});var v={allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},_=[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],T=[{base:"allcalls",steps:["drawelements","drawarrays"]}];function w(){u("allcalls").set(c+d),u("drawElements").set(d),u("drawArrays").set(c),u("bindTexture").set(y),u("useProgram").set(p),u("glfaces").set(f),u("glvertices").set(m),u("glpoints").set(g)}function S(){c=0,d=0,p=0,f=0,m=0,g=0,y=0}function R(){}function B(I){u=I}return{update:w,start:S,end:R,attach:B,values:v,groups:_,fractions:T}},window.threeStats=function(u){var c=null,d={"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},p=[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],f=[];function m(){c("renderer.info.memory.geometries").set(u.info.memory.geometries),c("renderer.info.programs").set(u.info.programs.length),c("renderer.info.memory.textures").set(u.info.memory.textures),c("renderer.info.render.calls").set(u.info.render.calls),c("renderer.info.render.triangles").set(u.info.render.triangles),c("renderer.info.render.points").set(u.info.render.points)}function g(){}function y(){}function x(v){c=v}return{update:m,start:g,end:y,attach:x,values:d,groups:p,fractions:f}},window.BrowserStats=function(){var u=null,c=0,d=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),performance.memory.totalJSHeapSize===0&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var p={memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},f=[{caption:"Browser",values:["memory","total"]}],m=[{base:"total",steps:["memory"]}],g=Math.log(1024);function y(w){var S=100,R=Math.floor(Math.log(w)/g);return Math.round(w*S/Math.pow(1024,R))/S}function x(){c=y(performance.memory.usedJSHeapSize),d=y(performance.memory.totalJSHeapSize),u("memory").set(c),u("total").set(d)}function v(){c=0}function _(){}function T(w){u=w}return{update:x,start:v,end:_,attach:T,values:p,groups:f,fractions:m}},l.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats}},"./vendor/rStats.js":l=>{(function(){"performance"in window||(window.performance={});var u=window.performance;if(!("now"in u)){var c=Date.now();u.timing&&u.timing.navigationStart&&(c=u.timing.navigationStart),u.now=function(){return Date.now()-c}}u.mark||(u.mark=function(){}),u.measure||(u.measure=function(){})})(),window.rStats=function(u){function c(O,U){for(var J=Object.keys(O),H=0,V=J.length;H<V;H++)U(J[H])}function d(O){var U=document.createElement("link");U.href=O,U.rel="stylesheet",U.type="text/css",document.getElementsByTagName("head")[0].appendChild(U)}var p=u||{},f=p.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],m="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",g=(p.CSSPath?p.CSSPath:"")+"rStats.css",y=p.css||[m,g];y.forEach(function(O){d(O)}),p.values||(p.values={});var x,v,_=10,T=200,w={};function S(O,U,J){var H=J||{},V=document.createElement("canvas"),$=V.getContext("2d"),Q=0,G=0,j=H.color?H.color:"#666666",ie=document.createElement("canvas"),Y=ie.getContext("2d");ie.width=1,ie.height=2*_,Y.fillStyle="#444444",Y.fillRect(0,0,1,2*_),Y.fillStyle=j,Y.fillRect(0,_,1,_),Y.fillStyle="#ffffff",Y.globalAlpha=.5,Y.fillRect(0,_,1,1),Y.globalAlpha=1;var ae=document.createElement("canvas"),xe=ae.getContext("2d");ae.width=1,ae.height=2*_,xe.fillStyle="#444444",xe.fillRect(0,0,1,2*_),xe.fillStyle="#b70000",xe.fillRect(0,_,1,_),xe.globalAlpha=.5,xe.fillStyle="#ffffff",xe.fillRect(0,_,1,1),xe.globalAlpha=1;function fe(){V.width=T,V.height=_,V.style.width=V.width+"px",V.style.height=V.height+"px",V.className="rs-canvas",O.appendChild(V),$.fillStyle="#444444",$.fillRect(0,0,V.width,V.height)}function de(Ie,Ge){G+=(Ie-G)*.1,Q*=.99,G>Q&&(Q=G),$.drawImage(V,1,0,V.width-1,V.height,0,0,V.width-1,V.height),Ge?$.drawImage(ae,V.width-1,V.height-G*V.height/Q-_):$.drawImage(ie,V.width-1,V.height-G*V.height/Q-_)}return fe(),{draw:de}}function R(O,U){var J=document.createElement("canvas"),H=J.getContext("2d");function V(){J.width=T,J.height=_*U,J.style.width=J.width+"px",J.style.height=J.height+"px",J.className="rs-canvas",O.appendChild(J),H.fillStyle="#444444",H.fillRect(0,0,J.width,J.height)}function $(Q){H.drawImage(J,1,0,J.width-1,J.height,0,0,J.width-1,J.height);var G=0;c(Q,function(j){var ie=Q[j]*J.height;H.fillStyle=f[j],H.fillRect(J.width-1,G,1,ie),G+=ie})}return V(),{draw:$}}function B(O,U){var J=O,H,V=0,$=0,Q=0,G=0,j=performance.now(),ie=0,Y=document.createElement("div"),ae=document.createElement("span"),xe=document.createElement("div"),fe=document.createTextNode(""),de=p?p.values[J.toLowerCase()]:null,Ie=new S(Y,J,de),Ge=!1;ae.className="rs-counter-id",ae.textContent=de&&de.caption?de.caption:J,xe.className="rs-counter-value",xe.appendChild(fe),Y.appendChild(ae),Y.appendChild(xe),U?U.div.appendChild(Y):v.appendChild(Y),H=performance.now();function Xe(Ze){if(de&&de.average){G+=Ze,ie++;var ki=performance.now();ki-j>=(de.avgMs||1e3)&&(Q=G/ie,G=0,j=ki,ie=0)}}function $e(){H=performance.now(),p.userTimingAPI&&performance.mark(J+"-start"),Ge=!0}function lt(){V=performance.now()-H,p.userTimingAPI&&(performance.mark(J+"-end"),Ge&&performance.measure(J,J+"-start",J+"-end")),Xe(V)}function At(){lt(),$e()}function Gt(){var Ze=de&&de.average?Q:V;fe.nodeValue=Math.round(Ze*100)/100;var ki=de&&(de.below&&V<de.below||de.over&&V>de.over);Ie.draw(V,ki),Y.className=ki?"rs-counter-base alarm":"rs-counter-base"}function gt(){var Ze=performance.now(),ki=Ze-H;$++,ki>1e3&&(de&&de.interpolate===!1?V=$:V=$*1e3/ki,$=0,H=Ze,Xe(V))}function yi(Ze){V=Ze,Xe(V)}return{set:yi,start:$e,tick:At,end:lt,frame:gt,value:function(){return V},draw:Gt}}function I(O){var U=O.toLowerCase();if(U===void 0&&(U="default"),w[U])return w[U];var J=null;p&&p.groups&&c(p.groups,function(V){var $=p.groups[parseInt(V,10)];!J&&$.values.indexOf(U.toLowerCase())!==-1&&(J=$)});var H=new B(U,J);return w[U]=H,H}function D(){if(p.plugins){p.values||(p.values={}),p.groups||(p.groups=[]),p.fractions||(p.fractions=[]);for(var O=0;O<p.plugins.length;O++)p.plugins[O].attach(I),c(p.plugins[O].values,function(U){p.values[U]=p.plugins[O].values[U]}),p.groups=p.groups.concat(p.plugins[O].groups),p.fractions=p.fractions.concat(p.plugins[O].fractions)}else p.plugins={};x=document.createElement("div"),x.className="rs-base",v=document.createElement("div"),v.className="rs-container",v.style.height="auto",x.appendChild(v),document.body.appendChild(x),p&&(p.groups&&c(p.groups,function(U){var J=p.groups[parseInt(U,10)],H=document.createElement("div");H.className="rs-group",J.div=H;var V=document.createElement("h1");V.textContent=J.caption,V.addEventListener("click",(function($){this.classList.toggle("hidden"),$.preventDefault()}).bind(H)),v.appendChild(V),v.appendChild(H)}),p.fractions&&c(p.fractions,function(U){var J=p.fractions[parseInt(U,10)],H=document.createElement("div");H.className="rs-fraction";var V=document.createElement("div");V.className="rs-legend";var $=0;c(p.fractions[U].steps,function(G){var j=document.createElement("p");j.textContent=p.fractions[U].steps[G],j.style.color=f[$],V.appendChild(j),$++}),H.appendChild(V),H.style.height=$*_+"px",J.div=H;var Q=new R(H,$);J.graph=Q,v.appendChild(H)}))}function L(){c(p.plugins,function(O){p.plugins[O].update()}),c(w,function(O){w[O].draw()}),p&&p.fractions&&c(p.fractions,function(O){var U=p.fractions[parseInt(O,10)],J=[],H=w[U.base.toLowerCase()];H&&(H=H.value(),c(p.fractions[O].steps,function(V){var $=p.fractions[O].steps[parseInt(V,10)].toLowerCase(),Q=w[$];Q&&J.push(Q.value()/H)})),U.graph.draw(J)})}return D(),function(O){return O?I(O):{element:x,update:L}}},l.exports=window.rStats},"./vendor/wakelock/util.js":l=>{var u={};u.base64=function(c,d){return"data:"+c+";base64,"+d},u.isMobile=function(){var c=!1;return function(d){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4)))&&(c=!0)}(navigator.userAgent||navigator.vendor||window.opera),c},u.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},u.isIFrame=function(){try{return window.self!==window.top}catch{return!0}},u.appendQueryParameter=function(c,d,p){var f=c.indexOf("?")<0?"?":"&";return c+=f+d+"="+p,c},u.getQueryParameter=function(c){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var d=new RegExp("[\\?&]"+c+"=([^&#]*)"),p=d.exec(location.search);return p===null?"":decodeURIComponent(p[1].replace(/\+/g," "))},u.isLandscapeMode=function(){return window.orientation==90||window.orientation==-90},l.exports=u},"./vendor/wakelock/wakelock.js":(l,u,c)=>{var d=c("./vendor/wakelock/util.js");function p(){var g=document.createElement("video");g.addEventListener("ended",function(){g.play()}),this.request=function(){g.paused&&(g.src=d.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),g.play())},this.release=function(){g.pause(),g.src=""}}function f(){var g=null;this.request=function(){g||(g=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){g&&(clearInterval(g),g=null)}}function m(){var g=navigator.userAgent||navigator.vendor||window.opera;return g.match(/iPhone/i)||g.match(/iPod/i)?f:p}l.exports=m()},"./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>O});var d=c("./node_modules/css-loader/dist/runtime/sourceMaps.js"),p=c.n(d),f=c("./node_modules/css-loader/dist/runtime/api.js"),m=c.n(f),g=c("./node_modules/css-loader/dist/runtime/getUrl.js"),y=c.n(g),x=new URL(c("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),c.b),v=new URL(c("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),c.b),_=new URL(c("data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"),c.b),T=new URL(c("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"),c.b),w=new URL(c("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"),c.b),S=m()(p()),R=y()(x),B=y()(v),I=y()(_),D=y()(T),L=y()(w);S.push([l.id,`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url(`+R+`) 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url(`+B+`) 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url(`+I+`);
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(`+D+`) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(`+L+`) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`,"",{version:3,sources:["webpack://./src/style/aframe.css"],names:[],mappings:"AAAA,sCAAsC;AACtC;EACE,SAAS;EACT,OAAO;EACP,eAAe;EACf,QAAQ;EACR,MAAM;AACR;;AAEA;EACE,YAAY;EACZ,SAAS;EACT,gBAAgB;EAChB,UAAU;EACV,WAAW;AACb;;AAEA,oDAAoD;AACpD;EACE,sBAAsB;EACtB,uBAAuB;EACvB,iBAAiB;EACjB,kBAAkB;EAClB,mBAAmB;EACnB,oBAAoB;EACpB,0BAA0B;AAC5B;;AAEA;;EAEE,UAAU;EACV,WAAW;AACb;;AAEA;EACE,WAAW;AACb;;AAEA,gEAAgE;AAChE;EACE,6BAA6B;AAC/B;;AAEA;EACE,wBAAwB;AAC1B;;AAEA;EACE,YAAY;EACZ,OAAO;EACP,kBAAkB;EAClB,MAAM;EACN,WAAW;AACb;;AAEA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,yBAAyB;EACzB,eAAe;EACf,SAAS;EACT,QAAQ;EACR,iBAAiB;EACjB,WAAW;EACX,qBAAqB;EACrB,eAAe;EACf,8BAA8B;EAC9B,kBAAkB;EAClB,cAAc;EACd,YAAY;AACd;;AAEA,+BAA+B;AAC/B,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;;AAErE;EACE,sCAAsC;EACtC,8CAA8C;AAChD;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,WAAW;AACb;;AAEA;;;;EAIE,aAAa;AACf;;AAEA;;EAEE,0DAA0D;AAC5D;;AAEA;EACE,6BAA6B;EAC7B,cAAc;EACd,qBAAqB;EACrB,6BAA6B;AAC/B;;AAEA;EACE,sBAAsB;EACtB,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,UAAU;AACZ;;AAEA;;EAEE,kCAAkC;EAClC,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,WAAW;EACX,YAAY;AACd;;AAEA;EACE,WAAW;AACb;;AAEA;;;EAGE,WAAW;EACX,iBAAiB;EACjB,aAAa;AACf;;AAEA;EACE,yFAA4qB;AAC9qB;;AAEA;EACE,yFAAkzB;AACpzB;;AAEA;EACE,yDAA2qK;AAC7qK;;AAEA;;EAEE,wBAAwB;EACxB,SAAS;EACT,SAAS;EACT,eAAe;EACf,eAAe;EACf,gBAAgB;EAChB,kBAAkB;EAClB;;;;GAIC;EACD,gBAAgB;EAChB,cAAc;EACd,kBAAkB;EAClB,QAAQ;EACR,sCAAsC;EACtC,8CAA8C;EAC9C,aAAa;EACb,kBAAkB;EAClB,0BAA0B,EAAE,8CAA8C;AAC5E;;AAEA;EACE,yBAAyB;EACzB,kBAAkB;AACpB;;AAEA;;;;EAIE,yBAAyB;AAC3B;;AAEA;EACE,qCAAqC;AACvC;;AAEA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,kBAAkB;EAClB,YAAY;EACZ,YAAY;EACZ,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,qCAAqC;EACrC,4BAA4B;EAC5B,kCAAkC;EAClC,qBAAqB;EACrB,WAAW;EACX,kBAAkB;EAClB,WAAW;EACX,QAAQ;EACR,QAAQ;EACR,SAAS;AACX;;AAEA;;EAEE,eAAe;AACjB;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,2FAAivF;EACjvF,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,WAAW;EACX,8CAA8C;EAC9C,cAAc;EACd,kBAAkB;EAClB,kBAAkB;EAClB,QAAQ;EACR,2BAA2B;EAC3B,WAAW;AACb;;AAEA;EACE,6DAA25B;EAC35B,YAAY;EACZ,YAAY;EACZ,oBAAoB;EACpB,WAAW;AACb;;AAEA;EACE,oCAAoC;EACpC,kCAAkC;EAClC,kBAAkB;EAClB,eAAe;EACf,YAAY;EACZ,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,UAAU;EACV,SAAS;EACT,QAAQ;EACR,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,+BAA+B;EAC/B,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,QAAQ;EACR,gCAAgC;EAChC,eAAe;EACf,YAAY;EACZ,aAAa;EACb,wBAAwB;EACxB,uBAAuB;EACvB,kCAAkC;EAClC,eAAe;EACf,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,WAAW;EACX,WAAW;EACX,sBAAsB;EACtB,aAAa;EACb,uBAAuB;EACvB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,qBAAqB;EACrB,mBAAmB;EACnB,eAAe;EACf,WAAW;AACb;;AAEA;EACE,oBAAoB;EACpB,oBAAoB;EACpB,WAAW;EACX,WAAW;AACb;;AAEA;EACE,eAAe;EACf,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,UAAU;EACV,eAAe;EACf,WAAW;EACX,kBAAkB;EAClB,iBAAiB;EACjB,YAAY;EACZ,qBAAqB;EACrB,yCAAyC;EACzC,iCAAiC;EACjC,wEAAwE;EACxE,iBAAiB;AACnB;;AAEA;EACE,mEAAmE;AACrE;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,oBAAoB;EACpB,sBAAsB;EACtB,SAAS;EACT,OAAO;EACP,QAAQ;EACR,MAAM;EACN,YAAY;AACd;;AAEA;EACE,oBAAoB;AACtB",sourcesContent:[`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='no'%3F%3E%3Csvg width='108' height='62' viewBox='0 0 108 62' version='1.1' id='svg320' sodipodi:docname='fullscreen-aframe.svg' xml:space='preserve' inkscape:version='1.2.1 (9c6d41e  2022-07-14)' xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape' xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23' xmlns:cc='http://creativecommons.org/ns%23' xmlns:dc='http://purl.org/dc/elements/1.1/'%3E%3Cdefs id='defs324' /%3E%3Csodipodi:namedview id='namedview322' pagecolor='%23ffffff' bordercolor='%23000000' borderopacity='0.25' inkscape:showpageshadow='2' inkscape:pageopacity='0.0' inkscape:pagecheckerboard='0' inkscape:deskcolor='%23d1d1d1' showgrid='false' inkscape:zoom='3.8064516' inkscape:cx='91.423729' inkscape:cy='-1.4449153' inkscape:window-width='1440' inkscape:window-height='847' inkscape:window-x='32' inkscape:window-y='25' inkscape:window-maximized='0' inkscape:current-layer='svg320' /%3E%3Ctitle id='title312'%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z' fill='%23fff' id='path314' style='fill:%23ffffff' /%3E%3Cg id='g356' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g358' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g360' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g362' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g364' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g366' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g368' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g370' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g372' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g374' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g376' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g378' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g380' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g382' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g384' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cmetadata id='metadata561'%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=''%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d='m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4' id='path596' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4' id='path598' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4' id='path600' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616' id='path602' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3C/svg%3E");
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`],sourceRoot:""}]);const O=S},"./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>y});var d=c("./node_modules/css-loader/dist/runtime/sourceMaps.js"),p=c.n(d),f=c("./node_modules/css-loader/dist/runtime/api.js"),m=c.n(f),g=m()(p());g.push([l.id,`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`,"",{version:3,sources:["webpack://./src/style/rStats.css"],names:[],mappings:"AAAA;EACE,sBAAsB;EACtB,cAAc;EACd,gBAAgB;EAChB,oBAAoB;EACpB,SAAS;EACT,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,eAAe;EACf,QAAQ;EACR,YAAY;EACZ,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,WAAW;EACX,eAAe;EACf,gBAAgB;EAChB,gBAAgB;EAChB,eAAe;EACf,UAAU;AACZ;;AAEA;EACE,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,sCAAsC;EACtC,8BAA8B;EAC9B,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,mBAAmB;EACnB,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,YAAY;EACZ,sCAAsC;EACtC,8BAA8B;EAC9B,aAAa;AACf;;AAEA;EACE,cAAc;EACd;;;;;;;;2BAQyB;AAC3B;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,iBAAiB;EACjB,WAAW;AACb;;AAEA;EACE,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;AACV;;AAEA;EACE;IACE,UAAU;IACV,SAAS;EACX;AACF",sourcesContent:[`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`],sourceRoot:""}]);const y=g},"./src/style/aframe.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>I});var d=c("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),p=c.n(d),f=c("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),m=c.n(f),g=c("./node_modules/style-loader/dist/runtime/insertBySelector.js"),y=c.n(g),x=c("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),v=c.n(x),_=c("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),T=c.n(_),w=c("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),S=c.n(w),R=c("./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css"),B={};B.styleTagTransform=S(),B.setAttributes=v(),B.insert=y().bind(null,"head"),B.domAPI=m(),B.insertStyleElement=T(),p()(R.default,B);const I=R.default&&R.default.locals?R.default.locals:void 0},"./src/style/rStats.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>I});var d=c("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),p=c.n(d),f=c("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),m=c.n(f),g=c("./node_modules/style-loader/dist/runtime/insertBySelector.js"),y=c.n(g),x=c("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),v=c.n(x),_=c("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),T=c.n(_),w=c("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),S=c.n(w),R=c("./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css"),B={};B.styleTagTransform=S(),B.setAttributes=v(),B.insert=y().bind(null,"head"),B.domAPI=m(),B.insertStyleElement=T(),p()(R.default,B);const I=R.default&&R.default.locals?R.default.locals:void 0},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":l=>{var u=[];function c(f){for(var m=-1,g=0;g<u.length;g++)if(u[g].identifier===f){m=g;break}return m}function d(f,m){for(var g={},y=[],x=0;x<f.length;x++){var v=f[x],_=m.base?v[0]+m.base:v[0],T=g[_]||0,w="".concat(_," ").concat(T);g[_]=T+1;var S=c(w),R={css:v[1],media:v[2],sourceMap:v[3],supports:v[4],layer:v[5]};if(S!==-1)u[S].references++,u[S].updater(R);else{var B=p(R,m);m.byIndex=x,u.splice(x,0,{identifier:w,updater:B,references:1})}y.push(w)}return y}function p(f,m){var g=m.domAPI(m);g.update(f);var y=function(x){if(x){if(x.css===f.css&&x.media===f.media&&x.sourceMap===f.sourceMap&&x.supports===f.supports&&x.layer===f.layer)return;g.update(f=x)}else g.remove()};return y}l.exports=function(f,m){m=m||{},f=f||[];var g=d(f,m);return function(y){y=y||[];for(var x=0;x<g.length;x++){var v=g[x],_=c(v);u[_].references--}for(var T=d(y,m),w=0;w<g.length;w++){var S=g[w],R=c(S);u[R].references===0&&(u[R].updater(),u.splice(R,1))}g=T}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":l=>{var u={};function c(p){if(typeof u[p]>"u"){var f=document.querySelector(p);if(window.HTMLIFrameElement&&f instanceof window.HTMLIFrameElement)try{f=f.contentDocument.head}catch{f=null}u[p]=f}return u[p]}function d(p,f){var m=c(p);if(!m)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");m.appendChild(f)}l.exports=d},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":l=>{function u(c){var d=document.createElement("style");return c.setAttributes(d,c.attributes),c.insert(d,c.options),d}l.exports=u},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(l,u,c)=>{function d(p){var f=c.nc;f&&p.setAttribute("nonce",f)}l.exports=d},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":l=>{function u(p,f,m){var g="";m.supports&&(g+="@supports (".concat(m.supports,") {")),m.media&&(g+="@media ".concat(m.media," {"));var y=typeof m.layer<"u";y&&(g+="@layer".concat(m.layer.length>0?" ".concat(m.layer):""," {")),g+=m.css,y&&(g+="}"),m.media&&(g+="}"),m.supports&&(g+="}");var x=m.sourceMap;x&&typeof btoa<"u"&&(g+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(x))))," */")),f.styleTagTransform(g,p,f.options)}function c(p){if(p.parentNode===null)return!1;p.parentNode.removeChild(p)}function d(p){if(typeof document>"u")return{update:function(){},remove:function(){}};var f=p.insertStyleElement(p);return{update:function(m){u(f,p,m)},remove:function(){c(f)}}}l.exports=d},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":l=>{function u(c,d){if(d.styleSheet)d.styleSheet.cssText=c;else{for(;d.firstChild;)d.removeChild(d.firstChild);d.appendChild(document.createTextNode(c))}}l.exports=u},"data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"},"./node_modules/three/build/three.module.js":(l,u,c)=>{c.r(u),c.d(u,{ACESFilmicToneMapping:()=>vt,AddEquation:()=>H,AddOperation:()=>yt,AdditiveAnimationBlendMode:()=>Lr,AdditiveBlending:()=>L,AgXToneMapping:()=>ve,AlphaFormat:()=>Be,AlwaysCompare:()=>sE,AlwaysDepth:()=>Ze,AlwaysStencilFunc:()=>Xy,AmbientLight:()=>gV,AnimationAction:()=>NV,AnimationClip:()=>Tv,AnimationLoader:()=>rTe,AnimationMixer:()=>NTe,AnimationObjectGroup:()=>ITe,AnimationUtils:()=>$Se,ArcCurve:()=>Nj,ArrayCamera:()=>zB,ArrowHelper:()=>eMe,AttachedBindMode:()=>Te,Audio:()=>RV,AudioAnalyser:()=>xTe,AudioContext:()=>xN,AudioListener:()=>ATe,AudioLoader:()=>fTe,AxesHelper:()=>tMe,BackSide:()=>R,BasicDepthPacking:()=>Qc,BasicShadowMap:()=>v,BatchedMesh:()=>Ej,Bone:()=>QB,BooleanKeyframeTrack:()=>yf,Box2:()=>zTe,Box3:()=>Is,Box3Helper:()=>ZTe,BoxGeometry:()=>af,BoxHelper:()=>JTe,BufferAttribute:()=>ns,BufferGeometry:()=>hn,BufferGeometryLoader:()=>bV,ByteType:()=>Rs,Cache:()=>yh,Camera:()=>ME,CameraHelper:()=>KTe,CanvasTexture:()=>ESe,CapsuleGeometry:()=>rw,CatmullRomCurve3:()=>Lj,CineonToneMapping:()=>xi,CircleGeometry:()=>nw,ClampToEdgeWrapping:()=>je,Clock:()=>SV,Color:()=>or,ColorKeyframeTrack:()=>fN,ColorManagement:()=>Xn,CompressedArrayTexture:()=>bSe,CompressedCubeTexture:()=>_Se,CompressedTexture:()=>$E,CompressedTextureLoader:()=>nTe,ConeGeometry:()=>sw,ConstantAlphaFactor:()=>Gt,ConstantColorFactor:()=>lt,CubeCamera:()=>C9,CubeReflectionMapping:()=>k,CubeRefractionMapping:()=>Z,CubeTexture:()=>sv,CubeTextureLoader:()=>sTe,CubeUVReflectionMapping:()=>ce,CubicBezierCurve:()=>iN,CubicBezierCurve3:()=>Oj,CubicInterpolant:()=>sV,CullFaceBack:()=>g,CullFaceFront:()=>y,CullFaceFrontBack:()=>x,CullFaceNone:()=>m,Curve:()=>Tc,CurvePath:()=>Fj,CustomBlending:()=>J,CustomToneMapping:()=>ye,CylinderGeometry:()=>y0,Cylindrical:()=>UTe,Data3DTexture:()=>Xr,DataArrayTexture:()=>Wg,DataTexture:()=>Dd,DataTextureLoader:()=>aTe,DataUtils:()=>K_e,DecrementStencilOp:()=>BI,DecrementWrapStencilOp:()=>LI,DefaultLoadingManager:()=>lV,DepthFormat:()=>Ke,DepthStencilFormat:()=>ot,DepthTexture:()=>OB,DetachedBindMode:()=>Fe,DirectionalLight:()=>mV,DirectionalLightHelper:()=>YTe,DiscreteInterpolant:()=>aV,DisplayP3ColorSpace:()=>jg,DodecahedronGeometry:()=>aw,DoubleSide:()=>B,DstAlphaFactor:()=>de,DstColorFactor:()=>Ge,DynamicCopyUsage:()=>XI,DynamicDrawUsage:()=>VI,DynamicReadUsage:()=>WI,EdgesGeometry:()=>kj,EllipseCurve:()=>ew,EqualCompare:()=>tE,EqualDepth:()=>Ri,EqualStencilFunc:()=>FI,EquirectangularReflectionMapping:()=>re,EquirectangularRefractionMapping:()=>Re,Euler:()=>xl,EventDispatcher:()=>Eo,ExtrudeGeometry:()=>pw,FileLoader:()=>xh,Float16BufferAttribute:()=>iEe,Float32BufferAttribute:()=>vr,FloatType:()=>St,Fog:()=>PE,FogExp2:()=>OE,FramebufferTexture:()=>xSe,FrontSide:()=>S,Frustum:()=>av,GLBufferAttribute:()=>PTe,GLSL1:()=>KI,GLSL3:()=>Ky,GreaterCompare:()=>iE,GreaterDepth:()=>tr,GreaterEqualCompare:()=>nE,GreaterEqualDepth:()=>Si,GreaterEqualStencilFunc:()=>jI,GreaterStencilFunc:()=>UI,GridHelper:()=>qTe,Group:()=>hf,HalfFloatType:()=>Xt,HemisphereLight:()=>cV,HemisphereLightHelper:()=>QTe,IcosahedronGeometry:()=>fw,ImageBitmapLoader:()=>pTe,ImageLoader:()=>Mv,ImageUtils:()=>Td,IncrementStencilOp:()=>II,IncrementWrapStencilOp:()=>NI,InstancedBufferAttribute:()=>m0,InstancedBufferGeometry:()=>xV,InstancedInterleavedBuffer:()=>OTe,InstancedMesh:()=>xj,Int16BufferAttribute:()=>eEe,Int32BufferAttribute:()=>tEe,Int8BufferAttribute:()=>J_e,IntType:()=>me,InterleavedBuffer:()=>FE,InterleavedBufferAttribute:()=>pf,Interpolant:()=>wv,InterpolateDiscrete:()=>Er,InterpolateLinear:()=>Sr,InterpolateSmooth:()=>Fr,InvertStencilOp:()=>DI,KeepStencilOp:()=>ch,KeyframeTrack:()=>Mc,LOD:()=>uj,LatheGeometry:()=>yv,Layers:()=>gE,LessCompare:()=>eE,LessDepth:()=>ki,LessEqualCompare:()=>Yy,LessEqualDepth:()=>hi,LessEqualStencilFunc:()=>kI,LessStencilFunc:()=>PI,Light:()=>kd,LightProbe:()=>vV,Line:()=>Pd,Line3:()=>jTe,LineBasicMaterial:()=>Mo,LineCurve:()=>rN,LineCurve3:()=>Pj,LineDashedMaterial:()=>iV,LineLoop:()=>Mj,LineSegments:()=>Jc,LinearDisplayP3ColorSpace:()=>Kp,LinearFilter:()=>Pi,LinearInterpolant:()=>pN,LinearMipMapLinearFilter:()=>gs,LinearMipMapNearestFilter:()=>Pr,LinearMipmapLinearFilter:()=>tn,LinearMipmapNearestFilter:()=>fn,LinearSRGBColorSpace:()=>Ec,LinearToneMapping:()=>Jt,LinearTransfer:()=>Jp,Loader:()=>Zo,LoaderUtils:()=>vN,LoadingManager:()=>mN,LoopOnce:()=>dr,LoopPingPong:()=>Hi,LoopRepeat:()=>pr,LuminanceAlphaFormat:()=>ke,LuminanceFormat:()=>Ne,MOUSE:()=>p,Material:()=>so,MaterialLoader:()=>bw,MathUtils:()=>pB,Matrix3:()=>qr,Matrix4:()=>fr,MaxEquation:()=>G,Mesh:()=>sa,MeshBasicMaterial:()=>Bd,MeshDepthMaterial:()=>kB,MeshDistanceMaterial:()=>UB,MeshLambertMaterial:()=>eV,MeshMatcapMaterial:()=>tV,MeshNormalMaterial:()=>$j,MeshPhongMaterial:()=>Jj,MeshPhysicalMaterial:()=>Kj,MeshStandardMaterial:()=>uN,MeshToonMaterial:()=>Zj,MinEquation:()=>Q,MirroredRepeatWrapping:()=>dt,MixOperation:()=>Ce,MultiplyBlending:()=>U,MultiplyOperation:()=>Qe,NearestFilter:()=>Bt,NearestMipMapLinearFilter:()=>br,NearestMipMapNearestFilter:()=>Ut,NearestMipmapLinearFilter:()=>di,NearestMipmapNearestFilter:()=>bt,NeutralToneMapping:()=>Le,NeverCompare:()=>$_,NeverDepth:()=>yi,NeverStencilFunc:()=>OI,NoBlending:()=>I,NoColorSpace:()=>ja,NoToneMapping:()=>Ot,NormalAnimationBlendMode:()=>cs,NormalBlending:()=>D,NotEqualCompare:()=>rE,NotEqualDepth:()=>Vi,NotEqualStencilFunc:()=>zI,NumberKeyframeTrack:()=>Cv,Object3D:()=>Vn,ObjectLoader:()=>hTe,ObjectSpaceNormalMap:()=>Xc,OctahedronGeometry:()=>_v,OneFactor:()=>ie,OneMinusConstantAlphaFactor:()=>gt,OneMinusConstantColorFactor:()=>At,OneMinusDstAlphaFactor:()=>Ie,OneMinusDstColorFactor:()=>Xe,OneMinusSrcAlphaFactor:()=>fe,OneMinusSrcColorFactor:()=>ae,OrthographicCamera:()=>BE,P3Primaries:()=>$p,PCFShadowMap:()=>_,PCFSoftShadowMap:()=>T,PMREMGenerator:()=>LB,Path:()=>Av,PerspectiveCamera:()=>fa,Plane:()=>Ld,PlaneGeometry:()=>o0,PlaneHelper:()=>$Te,PointLight:()=>fV,PointLightHelper:()=>HTe,Points:()=>Ij,PointsMaterial:()=>KB,PolarGridHelper:()=>XTe,PolyhedronGeometry:()=>Fd,PositionalAudio:()=>vTe,PropertyBinding:()=>kn,PropertyMixer:()=>BV,QuadraticBezierCurve:()=>nN,QuadraticBezierCurve3:()=>sN,Quaternion:()=>jn,QuaternionKeyframeTrack:()=>x0,QuaternionLinearInterpolant:()=>oV,RED_GREEN_RGTC2_Format:()=>Bi,RED_RGTC1_Format:()=>mi,REVISION:()=>d,RGBADepthPacking:()=>qc,RGBAFormat:()=>ge,RGBAIntegerFormat:()=>ti,RGBA_ASTC_10x10_Format:()=>be,RGBA_ASTC_10x5_Format:()=>he,RGBA_ASTC_10x6_Format:()=>le,RGBA_ASTC_10x8_Format:()=>pe,RGBA_ASTC_12x10_Format:()=>Ee,RGBA_ASTC_12x12_Format:()=>st,RGBA_ASTC_4x4_Format:()=>Qr,RGBA_ASTC_5x4_Format:()=>W,RGBA_ASTC_5x5_Format:()=>ue,RGBA_ASTC_6x5_Format:()=>Ae,RGBA_ASTC_6x6_Format:()=>Se,RGBA_ASTC_8x5_Format:()=>We,RGBA_ASTC_8x6_Format:()=>Ye,RGBA_ASTC_8x8_Format:()=>ft,RGBA_BPTC_Format:()=>Ct,RGBA_ETC2_EAC_Format:()=>un,RGBA_PVRTC_2BPPV1_Format:()=>qn,RGBA_PVRTC_4BPPV1_Format:()=>Tn,RGBA_S3TC_DXT1_Format:()=>Fi,RGBA_S3TC_DXT3_Format:()=>Cr,RGBA_S3TC_DXT5_Format:()=>ur,RGBFormat:()=>se,RGB_BPTC_SIGNED_Format:()=>Ht,RGB_BPTC_UNSIGNED_Format:()=>ii,RGB_ETC1_Format:()=>Mi,RGB_ETC2_Format:()=>ar,RGB_PVRTC_2BPPV1_Format:()=>vi,RGB_PVRTC_4BPPV1_Format:()=>Ji,RGB_S3TC_DXT1_Format:()=>bi,RGFormat:()=>Kt,RGIntegerFormat:()=>Rt,RawShaderMaterial:()=>Yj,Ray:()=>pa,Raycaster:()=>FTe,Rec709Primaries:()=>Zp,RectAreaLight:()=>AV,RedFormat:()=>wt,RedIntegerFormat:()=>qt,ReinhardToneMapping:()=>zt,RenderTarget:()=>Hg,RepeatWrapping:()=>Ue,ReplaceStencilOp:()=>RI,ReverseSubtractEquation:()=>$,RingGeometry:()=>mw,SIGNED_RED_GREEN_RGTC2_Format:()=>yr,SIGNED_RED_RGTC1_Format:()=>Wt,SRGBColorSpace:()=>Ln,SRGBTransfer:()=>os,Scene:()=>nj,ShaderChunk:()=>sn,ShaderLib:()=>Sc,ShaderMaterial:()=>Cc,ShadowMaterial:()=>Xj,Shape:()=>mf,ShapeGeometry:()=>gw,ShapePath:()=>iMe,ShapeUtils:()=>Zc,ShortType:()=>$n,Skeleton:()=>GE,SkeletonHelper:()=>GTe,SkinnedMesh:()=>gj,Source:()=>ys,Sphere:()=>da,SphereGeometry:()=>Ev,Spherical:()=>kTe,SphericalHarmonics3:()=>yV,SplineCurve:()=>aN,SpotLight:()=>dV,SpotLightHelper:()=>VTe,Sprite:()=>lj,SpriteMaterial:()=>VB,SrcAlphaFactor:()=>xe,SrcAlphaSaturateFactor:()=>$e,SrcColorFactor:()=>Y,StaticCopyUsage:()=>qI,StaticDrawUsage:()=>ef,StaticReadUsage:()=>HI,StereoCamera:()=>mTe,StreamCopyUsage:()=>YI,StreamDrawUsage:()=>GI,StreamReadUsage:()=>QI,StringKeyframeTrack:()=>vf,SubtractEquation:()=>V,SubtractiveBlending:()=>O,TOUCH:()=>f,TangentSpaceNormalMap:()=>io,TetrahedronGeometry:()=>Aw,Texture:()=>us,TextureLoader:()=>oTe,TorusGeometry:()=>yw,TorusKnotGeometry:()=>vw,Triangle:()=>bl,TriangleFanDrawMode:()=>_c,TriangleStripDrawMode:()=>qo,TrianglesDrawMode:()=>gl,TubeGeometry:()=>xw,UVMapping:()=>Pe,Uint16BufferAttribute:()=>_B,Uint32BufferAttribute:()=>EB,Uint8BufferAttribute:()=>Z_e,Uint8ClampedBufferAttribute:()=>$_e,Uniform:()=>EN,UniformsGroup:()=>DTe,UniformsLib:()=>Wi,UniformsUtils:()=>_9,UnsignedByteType:()=>mn,UnsignedInt248Type:()=>Ni,UnsignedInt5999Type:()=>Oi,UnsignedIntType:()=>ct,UnsignedShort4444Type:()=>Ii,UnsignedShort5551Type:()=>sr,UnsignedShortType:()=>As,VSMShadowMap:()=>w,Vector2:()=>ni,Vector3:()=>He,Vector4:()=>Fn,VectorKeyframeTrack:()=>Sv,VideoTexture:()=>vSe,WebGL3DRenderTarget:()=>Rn,WebGLArrayRenderTarget:()=>hr,WebGLCoordinateSystem:()=>Pl,WebGLCubeRenderTarget:()=>S9,WebGLMultipleRenderTargets:()=>rMe,WebGLRenderTarget:()=>Xo,WebGLRenderer:()=>uSe,WebGLUtils:()=>$9,WebGPUCoordinateSystem:()=>tf,WireframeGeometry:()=>Wj,WrapAroundEnding:()=>zr,ZeroCurvatureEnding:()=>jr,ZeroFactor:()=>j,ZeroSlopeEnding:()=>vn,ZeroStencilOp:()=>MI,createCanvasElement:()=>lE});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const d="164",p={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},f={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},m=0,g=1,y=2,x=3,v=0,_=1,T=2,w=3,S=0,R=1,B=2,I=0,D=1,L=2,O=3,U=4,J=5,H=100,V=101,$=102,Q=103,G=104,j=200,ie=201,Y=202,ae=203,xe=204,fe=205,de=206,Ie=207,Ge=208,Xe=209,$e=210,lt=211,At=212,Gt=213,gt=214,yi=0,Ze=1,ki=2,hi=3,Ri=4,Si=5,tr=6,Vi=7,Qe=0,Ce=1,yt=2,Ot=0,Jt=1,zt=2,xi=3,vt=4,ye=5,ve=6,Le=7,Te="attached",Fe="detached",Pe=300,k=301,Z=302,re=303,Re=304,ce=306,Ue=1e3,je=1001,dt=1002,Bt=1003,bt=1004,Ut=1004,di=1005,br=1005,Pi=1006,fn=1007,Pr=1007,tn=1008,gs=1008,mn=1009,Rs=1010,$n=1011,As=1012,me=1013,ct=1014,St=1015,Xt=1016,Ii=1017,sr=1018,Ni=1020,Oi=35902,Be=1021,se=1022,ge=1023,Ne=1024,ke=1025,Ke=1026,ot=1027,wt=1028,qt=1029,Kt=1030,Rt=1031,ti=1033,bi=33776,Fi=33777,Cr=33778,ur=33779,Ji=35840,vi=35841,Tn=35842,qn=35843,Mi=36196,ar=37492,un=37496,Qr=37808,W=37809,ue=37810,Ae=37811,Se=37812,We=37813,Ye=37814,ft=37815,he=37816,le=37817,pe=37818,be=37819,Ee=37820,st=37821,Ct=36492,Ht=36494,ii=36495,mi=36283,Wt=36284,Bi=36285,yr=36286,dr=2200,pr=2201,Hi=2202,Er=2300,Sr=2301,Fr=2302,jr=2400,vn=2401,zr=2402,cs=2500,Lr=2501,gl=0,qo=1,_c=2,Qc=3200,qc=3201,io=0,Xc=1,ja="",Ln="srgb",Ec="srgb-linear",jg="display-p3",Kp="display-p3-linear",Jp="linear",os="srgb",Zp="rec709",$p="p3",MI=0,ch=7680,RI=7681,II=7682,BI=7683,NI=34055,LI=34056,DI=5386,OI=512,PI=513,FI=514,kI=515,UI=516,zI=517,jI=518,Xy=519,$_=512,eE=513,tE=514,Yy=515,iE=516,rE=517,nE=518,sE=519,ef=35044,VI=35048,GI=35040,HI=35045,WI=35049,QI=35041,qI=35046,XI=35050,YI=35042,KI="100",Ky="300 es",Pl=2e3,tf=2001;class Eo{addEventListener(a,h){this._listeners===void 0&&(this._listeners={});const A=this._listeners;A[a]===void 0&&(A[a]=[]),A[a].indexOf(h)===-1&&A[a].push(h)}hasEventListener(a,h){if(this._listeners===void 0)return!1;const A=this._listeners;return A[a]!==void 0&&A[a].indexOf(h)!==-1}removeEventListener(a,h){if(this._listeners===void 0)return;const A=this._listeners[a];if(A!==void 0){const b=A.indexOf(h);b!==-1&&A.splice(b,1)}}dispatchEvent(a){if(this._listeners===void 0)return;const h=this._listeners[a.type];if(h!==void 0){a.target=this;const A=h.slice(0);for(let b=0,E=A.length;b<E;b++)A[b].call(this,a);a.target=null}}}const Sa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let aE=1234567;const uh=Math.PI/180,wd=180/Math.PI;function wo(){const C=Math.random()*4294967295|0,a=Math.random()*4294967295|0,h=Math.random()*4294967295|0,A=Math.random()*4294967295|0;return(Sa[C&255]+Sa[C>>8&255]+Sa[C>>16&255]+Sa[C>>24&255]+"-"+Sa[a&255]+Sa[a>>8&255]+"-"+Sa[a>>16&15|64]+Sa[a>>24&255]+"-"+Sa[h&63|128]+Sa[h>>8&255]+"-"+Sa[h>>16&255]+Sa[h>>24&255]+Sa[A&255]+Sa[A>>8&255]+Sa[A>>16&255]+Sa[A>>24&255]).toLowerCase()}function ws(C,a,h){return Math.max(a,Math.min(h,C))}function Jy(C,a){return(C%a+a)%a}function JI(C,a,h,A,b){return A+(C-a)*(b-A)/(h-a)}function ZI(C,a,h){return C!==a?(h-C)/(a-C):0}function rf(C,a,h){return(1-h)*C+h*a}function $I(C,a,h,A){return rf(C,a,1-Math.exp(-h*A))}function eB(C,a=1){return a-Math.abs(Jy(C,a*2)-a)}function tB(C,a,h){return C<=a?0:C>=h?1:(C=(C-a)/(h-a),C*C*(3-2*C))}function iB(C,a,h){return C<=a?0:C>=h?1:(C=(C-a)/(h-a),C*C*C*(C*(C*6-15)+10))}function rB(C,a){return C+Math.floor(Math.random()*(a-C+1))}function nB(C,a){return C+Math.random()*(a-C)}function sB(C){return C*(.5-Math.random())}function aB(C){C!==void 0&&(aE=C);let a=aE+=1831565813;return a=Math.imul(a^a>>>15,a|1),a^=a+Math.imul(a^a>>>7,a|61),((a^a>>>14)>>>0)/4294967296}function oB(C){return C*uh}function lB(C){return C*wd}function cB(C){return(C&C-1)===0&&C!==0}function uB(C){return Math.pow(2,Math.ceil(Math.log(C)/Math.LN2))}function hB(C){return Math.pow(2,Math.floor(Math.log(C)/Math.LN2))}function dB(C,a,h,A,b){const E=Math.cos,M=Math.sin,N=E(h/2),P=M(h/2),F=E((a+A)/2),z=M((a+A)/2),X=E((a-A)/2),q=M((a-A)/2),K=E((A-a)/2),te=M((A-a)/2);switch(b){case"XYX":C.set(N*z,P*X,P*q,N*F);break;case"YZY":C.set(P*q,N*z,P*X,N*F);break;case"ZXZ":C.set(P*X,P*q,N*z,N*F);break;case"XZX":C.set(N*z,P*te,P*K,N*F);break;case"YXY":C.set(P*K,N*z,P*te,N*F);break;case"ZYZ":C.set(P*te,P*K,N*z,N*F);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+b)}}function Va(C,a){switch(a.constructor){case Float32Array:return C;case Uint32Array:return C/4294967295;case Uint16Array:return C/65535;case Uint8Array:return C/255;case Int32Array:return Math.max(C/2147483647,-1);case Int16Array:return Math.max(C/32767,-1);case Int8Array:return Math.max(C/127,-1);default:throw new Error("Invalid component type.")}}function Yr(C,a){switch(a.constructor){case Float32Array:return C;case Uint32Array:return Math.round(C*4294967295);case Uint16Array:return Math.round(C*65535);case Uint8Array:return Math.round(C*255);case Int32Array:return Math.round(C*2147483647);case Int16Array:return Math.round(C*32767);case Int8Array:return Math.round(C*127);default:throw new Error("Invalid component type.")}}const pB={DEG2RAD:uh,RAD2DEG:wd,generateUUID:wo,clamp:ws,euclideanModulo:Jy,mapLinear:JI,inverseLerp:ZI,lerp:rf,damp:$I,pingpong:eB,smoothstep:tB,smootherstep:iB,randInt:rB,randFloat:nB,randFloatSpread:sB,seededRandom:aB,degToRad:oB,radToDeg:lB,isPowerOfTwo:cB,ceilPowerOfTwo:uB,floorPowerOfTwo:hB,setQuaternionFromProperEuler:dB,normalize:Yr,denormalize:Va};class ni{constructor(a=0,h=0){ni.prototype.isVector2=!0,this.x=a,this.y=h}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,h){return this.x=a,this.y=h,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,h){switch(a){case 0:this.x=h;break;case 1:this.y=h;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,h){return this.x=a.x+h.x,this.y=a.y+h.y,this}addScaledVector(a,h){return this.x+=a.x*h,this.y+=a.y*h,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,h){return this.x=a.x-h.x,this.y=a.y-h.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){const h=this.x,A=this.y,b=a.elements;return this.x=b[0]*h+b[3]*A+b[6],this.y=b[1]*h+b[4]*A+b[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,h){return this.x=Math.max(a.x,Math.min(h.x,this.x)),this.y=Math.max(a.y,Math.min(h.y,this.y)),this}clampScalar(a,h){return this.x=Math.max(a,Math.min(h,this.x)),this.y=Math.max(a,Math.min(h,this.y)),this}clampLength(a,h){const A=this.length();return this.divideScalar(A||1).multiplyScalar(Math.max(a,Math.min(h,A)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){const h=Math.sqrt(this.lengthSq()*a.lengthSq());if(h===0)return Math.PI/2;const A=this.dot(a)/h;return Math.acos(ws(A,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const h=this.x-a.x,A=this.y-a.y;return h*h+A*A}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,h){return this.x+=(a.x-this.x)*h,this.y+=(a.y-this.y)*h,this}lerpVectors(a,h,A){return this.x=a.x+(h.x-a.x)*A,this.y=a.y+(h.y-a.y)*A,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,h=0){return this.x=a[h],this.y=a[h+1],this}toArray(a=[],h=0){return a[h]=this.x,a[h+1]=this.y,a}fromBufferAttribute(a,h){return this.x=a.getX(h),this.y=a.getY(h),this}rotateAround(a,h){const A=Math.cos(h),b=Math.sin(h),E=this.x-a.x,M=this.y-a.y;return this.x=E*A-M*b+a.x,this.y=E*b+M*A+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class qr{constructor(a,h,A,b,E,M,N,P,F){qr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],a!==void 0&&this.set(a,h,A,b,E,M,N,P,F)}set(a,h,A,b,E,M,N,P,F){const z=this.elements;return z[0]=a,z[1]=b,z[2]=N,z[3]=h,z[4]=E,z[5]=P,z[6]=A,z[7]=M,z[8]=F,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){const h=this.elements,A=a.elements;return h[0]=A[0],h[1]=A[1],h[2]=A[2],h[3]=A[3],h[4]=A[4],h[5]=A[5],h[6]=A[6],h[7]=A[7],h[8]=A[8],this}extractBasis(a,h,A){return a.setFromMatrix3Column(this,0),h.setFromMatrix3Column(this,1),A.setFromMatrix3Column(this,2),this}setFromMatrix4(a){const h=a.elements;return this.set(h[0],h[4],h[8],h[1],h[5],h[9],h[2],h[6],h[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,h){const A=a.elements,b=h.elements,E=this.elements,M=A[0],N=A[3],P=A[6],F=A[1],z=A[4],X=A[7],q=A[2],K=A[5],te=A[8],oe=b[0],ne=b[3],ee=b[6],Me=b[1],we=b[4],_e=b[7],nt=b[2],qe=b[5],Je=b[8];return E[0]=M*oe+N*Me+P*nt,E[3]=M*ne+N*we+P*qe,E[6]=M*ee+N*_e+P*Je,E[1]=F*oe+z*Me+X*nt,E[4]=F*ne+z*we+X*qe,E[7]=F*ee+z*_e+X*Je,E[2]=q*oe+K*Me+te*nt,E[5]=q*ne+K*we+te*qe,E[8]=q*ee+K*_e+te*Je,this}multiplyScalar(a){const h=this.elements;return h[0]*=a,h[3]*=a,h[6]*=a,h[1]*=a,h[4]*=a,h[7]*=a,h[2]*=a,h[5]*=a,h[8]*=a,this}determinant(){const a=this.elements,h=a[0],A=a[1],b=a[2],E=a[3],M=a[4],N=a[5],P=a[6],F=a[7],z=a[8];return h*M*z-h*N*F-A*E*z+A*N*P+b*E*F-b*M*P}invert(){const a=this.elements,h=a[0],A=a[1],b=a[2],E=a[3],M=a[4],N=a[5],P=a[6],F=a[7],z=a[8],X=z*M-N*F,q=N*P-z*E,K=F*E-M*P,te=h*X+A*q+b*K;if(te===0)return this.set(0,0,0,0,0,0,0,0,0);const oe=1/te;return a[0]=X*oe,a[1]=(b*F-z*A)*oe,a[2]=(N*A-b*M)*oe,a[3]=q*oe,a[4]=(z*h-b*P)*oe,a[5]=(b*E-N*h)*oe,a[6]=K*oe,a[7]=(A*P-F*h)*oe,a[8]=(M*h-A*E)*oe,this}transpose(){let a;const h=this.elements;return a=h[1],h[1]=h[3],h[3]=a,a=h[2],h[2]=h[6],h[6]=a,a=h[5],h[5]=h[7],h[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){const h=this.elements;return a[0]=h[0],a[1]=h[3],a[2]=h[6],a[3]=h[1],a[4]=h[4],a[5]=h[7],a[6]=h[2],a[7]=h[5],a[8]=h[8],this}setUvTransform(a,h,A,b,E,M,N){const P=Math.cos(E),F=Math.sin(E);return this.set(A*P,A*F,-A*(P*M+F*N)+M+a,-b*F,b*P,-b*(-F*M+P*N)+N+h,0,0,1),this}scale(a,h){return this.premultiply(Zy.makeScale(a,h)),this}rotate(a){return this.premultiply(Zy.makeRotation(-a)),this}translate(a,h){return this.premultiply(Zy.makeTranslation(a,h)),this}makeTranslation(a,h){return a.isVector2?this.set(1,0,a.x,0,1,a.y,0,0,1):this.set(1,0,a,0,1,h,0,0,1),this}makeRotation(a){const h=Math.cos(a),A=Math.sin(a);return this.set(h,-A,0,A,h,0,0,0,1),this}makeScale(a,h){return this.set(a,0,0,0,h,0,0,0,1),this}equals(a){const h=this.elements,A=a.elements;for(let b=0;b<9;b++)if(h[b]!==A[b])return!1;return!0}fromArray(a,h=0){for(let A=0;A<9;A++)this.elements[A]=a[A+h];return this}toArray(a=[],h=0){const A=this.elements;return a[h]=A[0],a[h+1]=A[1],a[h+2]=A[2],a[h+3]=A[3],a[h+4]=A[4],a[h+5]=A[5],a[h+6]=A[6],a[h+7]=A[7],a[h+8]=A[8],a}clone(){return new this.constructor().fromArray(this.elements)}}const Zy=new qr;function oE(C){for(let a=C.length-1;a>=0;--a)if(C[a]>=65535)return!0;return!1}const fB={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Cd(C,a){return new fB[C](a)}function nf(C){return document.createElementNS("http://www.w3.org/1999/xhtml",C)}function lE(){const C=nf("canvas");return C.style.display="block",C}const cE={};function uE(C){C in cE||(cE[C]=!0,console.warn(C))}const hE=new qr().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),dE=new qr().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Vg={[Ec]:{transfer:Jp,primaries:Zp,toReference:C=>C,fromReference:C=>C},[Ln]:{transfer:os,primaries:Zp,toReference:C=>C.convertSRGBToLinear(),fromReference:C=>C.convertLinearToSRGB()},[Kp]:{transfer:Jp,primaries:$p,toReference:C=>C.applyMatrix3(dE),fromReference:C=>C.applyMatrix3(hE)},[jg]:{transfer:os,primaries:$p,toReference:C=>C.convertSRGBToLinear().applyMatrix3(dE),fromReference:C=>C.applyMatrix3(hE).convertLinearToSRGB()}},mB=new Set([Ec,Kp]),Xn={enabled:!0,_workingColorSpace:Ec,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(C){if(!mB.has(C))throw new Error(`Unsupported working color space, "${C}".`);this._workingColorSpace=C},convert:function(C,a,h){if(this.enabled===!1||a===h||!a||!h)return C;const A=Vg[a].toReference,b=Vg[h].fromReference;return b(A(C))},fromWorkingColorSpace:function(C,a){return this.convert(C,this._workingColorSpace,a)},toWorkingColorSpace:function(C,a){return this.convert(C,a,this._workingColorSpace)},getPrimaries:function(C){return Vg[C].primaries},getTransfer:function(C){return C===ja?Jp:Vg[C].transfer}};function Sd(C){return C<.04045?C*.0773993808:Math.pow(C*.9478672986+.0521327014,2.4)}function $y(C){return C<.0031308?C*12.92:1.055*Math.pow(C,.41666)-.055}let hh;class Td{static getDataURL(a){if(/^data:/i.test(a.src)||typeof HTMLCanvasElement>"u")return a.src;let h;if(a instanceof HTMLCanvasElement)h=a;else{hh===void 0&&(hh=nf("canvas")),hh.width=a.width,hh.height=a.height;const A=hh.getContext("2d");a instanceof ImageData?A.putImageData(a,0,0):A.drawImage(a,0,0,a.width,a.height),h=hh}return h.width>2048||h.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",a),h.toDataURL("image/jpeg",.6)):h.toDataURL("image/png")}static sRGBToLinear(a){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap){const h=nf("canvas");h.width=a.width,h.height=a.height;const A=h.getContext("2d");A.drawImage(a,0,0,a.width,a.height);const b=A.getImageData(0,0,a.width,a.height),E=b.data;for(let M=0;M<E.length;M++)E[M]=Sd(E[M]/255)*255;return A.putImageData(b,0,0),h}else if(a.data){const h=a.data.slice(0);for(let A=0;A<h.length;A++)h instanceof Uint8Array||h instanceof Uint8ClampedArray?h[A]=Math.floor(Sd(h[A]/255)*255):h[A]=Sd(h[A]);return{data:h,width:a.width,height:a.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),a}}let pE=0;class ys{constructor(a=null){this.isSource=!0,Object.defineProperty(this,"id",{value:pE++}),this.uuid=wo(),this.data=a,this.dataReady=!0,this.version=0}set needsUpdate(a){a===!0&&this.version++}toJSON(a){const h=a===void 0||typeof a=="string";if(!h&&a.images[this.uuid]!==void 0)return a.images[this.uuid];const A={uuid:this.uuid,url:""},b=this.data;if(b!==null){let E;if(Array.isArray(b)){E=[];for(let M=0,N=b.length;M<N;M++)b[M].isDataTexture?E.push(Gg(b[M].image)):E.push(Gg(b[M]))}else E=Gg(b);A.url=E}return h||(a.images[this.uuid]=A),A}}function Gg(C){return typeof HTMLImageElement<"u"&&C instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&C instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&C instanceof ImageBitmap?Td.getDataURL(C):C.data?{data:Array.from(C.data),width:C.width,height:C.height,type:C.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let fE=0;class us extends Eo{constructor(a=us.DEFAULT_IMAGE,h=us.DEFAULT_MAPPING,A=je,b=je,E=Pi,M=tn,N=ge,P=mn,F=us.DEFAULT_ANISOTROPY,z=ja){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:fE++}),this.uuid=wo(),this.name="",this.source=new ys(a),this.mipmaps=[],this.mapping=h,this.channel=0,this.wrapS=A,this.wrapT=b,this.magFilter=E,this.minFilter=M,this.anisotropy=F,this.format=N,this.internalFormat=null,this.type=P,this.offset=new ni(0,0),this.repeat=new ni(1,1),this.center=new ni(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new qr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=z,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(a=null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.channel=a.channel,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.colorSpace=a.colorSpace,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}toJSON(a){const h=a===void 0||typeof a=="string";if(!h&&a.textures[this.uuid]!==void 0)return a.textures[this.uuid];const A={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(A.userData=this.userData),h||(a.textures[this.uuid]=A),A}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(this.mapping!==Pe)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case Ue:a.x=a.x-Math.floor(a.x);break;case je:a.x=a.x<0?0:1;break;case dt:Math.abs(Math.floor(a.x)%2)===1?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x);break}if(a.y<0||a.y>1)switch(this.wrapT){case Ue:a.y=a.y-Math.floor(a.y);break;case je:a.y=a.y<0?0:1;break;case dt:Math.abs(Math.floor(a.y)%2)===1?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y);break}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){a===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(a){a===!0&&this.pmremVersion++}}us.DEFAULT_IMAGE=null,us.DEFAULT_MAPPING=Pe,us.DEFAULT_ANISOTROPY=1;class Fn{constructor(a=0,h=0,A=0,b=1){Fn.prototype.isVector4=!0,this.x=a,this.y=h,this.z=A,this.w=b}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,h,A,b){return this.x=a,this.y=h,this.z=A,this.w=b,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,h){switch(a){case 0:this.x=h;break;case 1:this.y=h;break;case 2:this.z=h;break;case 3:this.w=h;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w!==void 0?a.w:1,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,h){return this.x=a.x+h.x,this.y=a.y+h.y,this.z=a.z+h.z,this.w=a.w+h.w,this}addScaledVector(a,h){return this.x+=a.x*h,this.y+=a.y*h,this.z+=a.z*h,this.w+=a.w*h,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,h){return this.x=a.x-h.x,this.y=a.y-h.y,this.z=a.z-h.z,this.w=a.w-h.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){const h=this.x,A=this.y,b=this.z,E=this.w,M=a.elements;return this.x=M[0]*h+M[4]*A+M[8]*b+M[12]*E,this.y=M[1]*h+M[5]*A+M[9]*b+M[13]*E,this.z=M[2]*h+M[6]*A+M[10]*b+M[14]*E,this.w=M[3]*h+M[7]*A+M[11]*b+M[15]*E,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);const h=Math.sqrt(1-a.w*a.w);return h<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/h,this.y=a.y/h,this.z=a.z/h),this}setAxisAngleFromRotationMatrix(a){let h,A,b,E;const M=a.elements,N=M[0],P=M[4],F=M[8],z=M[1],X=M[5],q=M[9],K=M[2],te=M[6],oe=M[10];if(Math.abs(P-z)<.01&&Math.abs(F-K)<.01&&Math.abs(q-te)<.01){if(Math.abs(P+z)<.1&&Math.abs(F+K)<.1&&Math.abs(q+te)<.1&&Math.abs(N+X+oe-3)<.1)return this.set(1,0,0,0),this;h=Math.PI;const ee=(N+1)/2,Me=(X+1)/2,we=(oe+1)/2,_e=(P+z)/4,nt=(F+K)/4,qe=(q+te)/4;return ee>Me&&ee>we?ee<.01?(A=0,b=.707106781,E=.707106781):(A=Math.sqrt(ee),b=_e/A,E=nt/A):Me>we?Me<.01?(A=.707106781,b=0,E=.707106781):(b=Math.sqrt(Me),A=_e/b,E=qe/b):we<.01?(A=.707106781,b=.707106781,E=0):(E=Math.sqrt(we),A=nt/E,b=qe/E),this.set(A,b,E,h),this}let ne=Math.sqrt((te-q)*(te-q)+(F-K)*(F-K)+(z-P)*(z-P));return Math.abs(ne)<.001&&(ne=1),this.x=(te-q)/ne,this.y=(F-K)/ne,this.z=(z-P)/ne,this.w=Math.acos((N+X+oe-1)/2),this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,h){return this.x=Math.max(a.x,Math.min(h.x,this.x)),this.y=Math.max(a.y,Math.min(h.y,this.y)),this.z=Math.max(a.z,Math.min(h.z,this.z)),this.w=Math.max(a.w,Math.min(h.w,this.w)),this}clampScalar(a,h){return this.x=Math.max(a,Math.min(h,this.x)),this.y=Math.max(a,Math.min(h,this.y)),this.z=Math.max(a,Math.min(h,this.z)),this.w=Math.max(a,Math.min(h,this.w)),this}clampLength(a,h){const A=this.length();return this.divideScalar(A||1).multiplyScalar(Math.max(a,Math.min(h,A)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,h){return this.x+=(a.x-this.x)*h,this.y+=(a.y-this.y)*h,this.z+=(a.z-this.z)*h,this.w+=(a.w-this.w)*h,this}lerpVectors(a,h,A){return this.x=a.x+(h.x-a.x)*A,this.y=a.y+(h.y-a.y)*A,this.z=a.z+(h.z-a.z)*A,this.w=a.w+(h.w-a.w)*A,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,h=0){return this.x=a[h],this.y=a[h+1],this.z=a[h+2],this.w=a[h+3],this}toArray(a=[],h=0){return a[h]=this.x,a[h+1]=this.y,a[h+2]=this.z,a[h+3]=this.w,a}fromBufferAttribute(a,h){return this.x=a.getX(h),this.y=a.getY(h),this.z=a.getZ(h),this.w=a.getW(h),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Hg extends Eo{constructor(a=1,h=1,A={}){super(),this.isRenderTarget=!0,this.width=a,this.height=h,this.depth=1,this.scissor=new Fn(0,0,a,h),this.scissorTest=!1,this.viewport=new Fn(0,0,a,h);const b={width:a,height:h,depth:1};A=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Pi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},A);const E=new us(b,A.mapping,A.wrapS,A.wrapT,A.magFilter,A.minFilter,A.format,A.type,A.anisotropy,A.colorSpace);E.flipY=!1,E.generateMipmaps=A.generateMipmaps,E.internalFormat=A.internalFormat,this.textures=[];const M=A.count;for(let N=0;N<M;N++)this.textures[N]=E.clone(),this.textures[N].isRenderTargetTexture=!0;this.depthBuffer=A.depthBuffer,this.stencilBuffer=A.stencilBuffer,this.resolveDepthBuffer=A.resolveDepthBuffer,this.resolveStencilBuffer=A.resolveStencilBuffer,this.depthTexture=A.depthTexture,this.samples=A.samples}get texture(){return this.textures[0]}set texture(a){this.textures[0]=a}setSize(a,h,A=1){if(this.width!==a||this.height!==h||this.depth!==A){this.width=a,this.height=h,this.depth=A;for(let b=0,E=this.textures.length;b<E;b++)this.textures[b].image.width=a,this.textures[b].image.height=h,this.textures[b].image.depth=A;this.dispose()}this.viewport.set(0,0,a,h),this.scissor.set(0,0,a,h)}clone(){return new this.constructor().copy(this)}copy(a){this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.textures.length=0;for(let A=0,b=a.textures.length;A<b;A++)this.textures[A]=a.textures[A].clone(),this.textures[A].isRenderTargetTexture=!0;const h=Object.assign({},a.texture.image);return this.texture.source=new ys(h),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,this.resolveDepthBuffer=a.resolveDepthBuffer,this.resolveStencilBuffer=a.resolveStencilBuffer,a.depthTexture!==null&&(this.depthTexture=a.depthTexture.clone()),this.samples=a.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Xo extends Hg{constructor(a=1,h=1,A={}){super(a,h,A),this.isWebGLRenderTarget=!0}}class Wg extends us{constructor(a=null,h=1,A=1,b=1){super(null),this.isDataArrayTexture=!0,this.image={data:a,width:h,height:A,depth:b},this.magFilter=Bt,this.minFilter=Bt,this.wrapR=je,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class hr extends Xo{constructor(a=1,h=1,A=1,b={}){super(a,h,b),this.isWebGLArrayRenderTarget=!0,this.depth=A,this.texture=new Wg(null,a,h,A),this.texture.isRenderTargetTexture=!0}}class Xr extends us{constructor(a=null,h=1,A=1,b=1){super(null),this.isData3DTexture=!0,this.image={data:a,width:h,height:A,depth:b},this.magFilter=Bt,this.minFilter=Bt,this.wrapR=je,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Rn extends Xo{constructor(a=1,h=1,A=1,b={}){super(a,h,b),this.isWebGL3DRenderTarget=!0,this.depth=A,this.texture=new Xr(null,a,h,A),this.texture.isRenderTargetTexture=!0}}class jn{constructor(a=0,h=0,A=0,b=1){this.isQuaternion=!0,this._x=a,this._y=h,this._z=A,this._w=b}static slerpFlat(a,h,A,b,E,M,N){let P=A[b+0],F=A[b+1],z=A[b+2],X=A[b+3];const q=E[M+0],K=E[M+1],te=E[M+2],oe=E[M+3];if(N===0){a[h+0]=P,a[h+1]=F,a[h+2]=z,a[h+3]=X;return}if(N===1){a[h+0]=q,a[h+1]=K,a[h+2]=te,a[h+3]=oe;return}if(X!==oe||P!==q||F!==K||z!==te){let ne=1-N;const ee=P*q+F*K+z*te+X*oe,Me=ee>=0?1:-1,we=1-ee*ee;if(we>Number.EPSILON){const nt=Math.sqrt(we),qe=Math.atan2(nt,ee*Me);ne=Math.sin(ne*qe)/nt,N=Math.sin(N*qe)/nt}const _e=N*Me;if(P=P*ne+q*_e,F=F*ne+K*_e,z=z*ne+te*_e,X=X*ne+oe*_e,ne===1-N){const nt=1/Math.sqrt(P*P+F*F+z*z+X*X);P*=nt,F*=nt,z*=nt,X*=nt}}a[h]=P,a[h+1]=F,a[h+2]=z,a[h+3]=X}static multiplyQuaternionsFlat(a,h,A,b,E,M){const N=A[b],P=A[b+1],F=A[b+2],z=A[b+3],X=E[M],q=E[M+1],K=E[M+2],te=E[M+3];return a[h]=N*te+z*X+P*K-F*q,a[h+1]=P*te+z*q+F*X-N*K,a[h+2]=F*te+z*K+N*q-P*X,a[h+3]=z*te-N*X-P*q-F*K,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,h,A,b){return this._x=a,this._y=h,this._z=A,this._w=b,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,h=!0){const A=a._x,b=a._y,E=a._z,M=a._order,N=Math.cos,P=Math.sin,F=N(A/2),z=N(b/2),X=N(E/2),q=P(A/2),K=P(b/2),te=P(E/2);switch(M){case"XYZ":this._x=q*z*X+F*K*te,this._y=F*K*X-q*z*te,this._z=F*z*te+q*K*X,this._w=F*z*X-q*K*te;break;case"YXZ":this._x=q*z*X+F*K*te,this._y=F*K*X-q*z*te,this._z=F*z*te-q*K*X,this._w=F*z*X+q*K*te;break;case"ZXY":this._x=q*z*X-F*K*te,this._y=F*K*X+q*z*te,this._z=F*z*te+q*K*X,this._w=F*z*X-q*K*te;break;case"ZYX":this._x=q*z*X-F*K*te,this._y=F*K*X+q*z*te,this._z=F*z*te-q*K*X,this._w=F*z*X+q*K*te;break;case"YZX":this._x=q*z*X+F*K*te,this._y=F*K*X+q*z*te,this._z=F*z*te-q*K*X,this._w=F*z*X-q*K*te;break;case"XZY":this._x=q*z*X-F*K*te,this._y=F*K*X-q*z*te,this._z=F*z*te+q*K*X,this._w=F*z*X+q*K*te;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+M)}return h===!0&&this._onChangeCallback(),this}setFromAxisAngle(a,h){const A=h/2,b=Math.sin(A);return this._x=a.x*b,this._y=a.y*b,this._z=a.z*b,this._w=Math.cos(A),this._onChangeCallback(),this}setFromRotationMatrix(a){const h=a.elements,A=h[0],b=h[4],E=h[8],M=h[1],N=h[5],P=h[9],F=h[2],z=h[6],X=h[10],q=A+N+X;if(q>0){const K=.5/Math.sqrt(q+1);this._w=.25/K,this._x=(z-P)*K,this._y=(E-F)*K,this._z=(M-b)*K}else if(A>N&&A>X){const K=2*Math.sqrt(1+A-N-X);this._w=(z-P)/K,this._x=.25*K,this._y=(b+M)/K,this._z=(E+F)/K}else if(N>X){const K=2*Math.sqrt(1+N-A-X);this._w=(E-F)/K,this._x=(b+M)/K,this._y=.25*K,this._z=(P+z)/K}else{const K=2*Math.sqrt(1+X-A-N);this._w=(M-b)/K,this._x=(E+F)/K,this._y=(P+z)/K,this._z=.25*K}return this._onChangeCallback(),this}setFromUnitVectors(a,h){let A=a.dot(h)+1;return A<Number.EPSILON?(A=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0,this._w=A):(this._x=0,this._y=-a.z,this._z=a.y,this._w=A)):(this._x=a.y*h.z-a.z*h.y,this._y=a.z*h.x-a.x*h.z,this._z=a.x*h.y-a.y*h.x,this._w=A),this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(ws(this.dot(a),-1,1)))}rotateTowards(a,h){const A=this.angleTo(a);if(A===0)return this;const b=Math.min(1,h/A);return this.slerp(a,b),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return a===0?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,h){const A=a._x,b=a._y,E=a._z,M=a._w,N=h._x,P=h._y,F=h._z,z=h._w;return this._x=A*z+M*N+b*F-E*P,this._y=b*z+M*P+E*N-A*F,this._z=E*z+M*F+A*P-b*N,this._w=M*z-A*N-b*P-E*F,this._onChangeCallback(),this}slerp(a,h){if(h===0)return this;if(h===1)return this.copy(a);const A=this._x,b=this._y,E=this._z,M=this._w;let N=M*a._w+A*a._x+b*a._y+E*a._z;if(N<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,N=-N):this.copy(a),N>=1)return this._w=M,this._x=A,this._y=b,this._z=E,this;const P=1-N*N;if(P<=Number.EPSILON){const K=1-h;return this._w=K*M+h*this._w,this._x=K*A+h*this._x,this._y=K*b+h*this._y,this._z=K*E+h*this._z,this.normalize(),this}const F=Math.sqrt(P),z=Math.atan2(F,N),X=Math.sin((1-h)*z)/F,q=Math.sin(h*z)/F;return this._w=M*X+this._w*q,this._x=A*X+this._x*q,this._y=b*X+this._y*q,this._z=E*X+this._z*q,this._onChangeCallback(),this}slerpQuaternions(a,h,A){return this.copy(a).slerp(h,A)}random(){const a=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),A=Math.random(),b=Math.sqrt(1-A),E=Math.sqrt(A);return this.set(b*Math.sin(a),b*Math.cos(a),E*Math.sin(h),E*Math.cos(h))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,h=0){return this._x=a[h],this._y=a[h+1],this._z=a[h+2],this._w=a[h+3],this._onChangeCallback(),this}toArray(a=[],h=0){return a[h]=this._x,a[h+1]=this._y,a[h+2]=this._z,a[h+3]=this._w,a}fromBufferAttribute(a,h){return this._x=a.getX(h),this._y=a.getY(h),this._z=a.getZ(h),this._w=a.getW(h),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class He{constructor(a=0,h=0,A=0){He.prototype.isVector3=!0,this.x=a,this.y=h,this.z=A}set(a,h,A){return A===void 0&&(A=this.z),this.x=a,this.y=h,this.z=A,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,h){switch(a){case 0:this.x=h;break;case 1:this.y=h;break;case 2:this.z=h;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,h){return this.x=a.x+h.x,this.y=a.y+h.y,this.z=a.z+h.z,this}addScaledVector(a,h){return this.x+=a.x*h,this.y+=a.y*h,this.z+=a.z*h,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,h){return this.x=a.x-h.x,this.y=a.y-h.y,this.z=a.z-h.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,h){return this.x=a.x*h.x,this.y=a.y*h.y,this.z=a.z*h.z,this}applyEuler(a){return this.applyQuaternion(Fs.setFromEuler(a))}applyAxisAngle(a,h){return this.applyQuaternion(Fs.setFromAxisAngle(a,h))}applyMatrix3(a){const h=this.x,A=this.y,b=this.z,E=a.elements;return this.x=E[0]*h+E[3]*A+E[6]*b,this.y=E[1]*h+E[4]*A+E[7]*b,this.z=E[2]*h+E[5]*A+E[8]*b,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){const h=this.x,A=this.y,b=this.z,E=a.elements,M=1/(E[3]*h+E[7]*A+E[11]*b+E[15]);return this.x=(E[0]*h+E[4]*A+E[8]*b+E[12])*M,this.y=(E[1]*h+E[5]*A+E[9]*b+E[13])*M,this.z=(E[2]*h+E[6]*A+E[10]*b+E[14])*M,this}applyQuaternion(a){const h=this.x,A=this.y,b=this.z,E=a.x,M=a.y,N=a.z,P=a.w,F=2*(M*b-N*A),z=2*(N*h-E*b),X=2*(E*A-M*h);return this.x=h+P*F+M*X-N*z,this.y=A+P*z+N*F-E*X,this.z=b+P*X+E*z-M*F,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){const h=this.x,A=this.y,b=this.z,E=a.elements;return this.x=E[0]*h+E[4]*A+E[8]*b,this.y=E[1]*h+E[5]*A+E[9]*b,this.z=E[2]*h+E[6]*A+E[10]*b,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,h){return this.x=Math.max(a.x,Math.min(h.x,this.x)),this.y=Math.max(a.y,Math.min(h.y,this.y)),this.z=Math.max(a.z,Math.min(h.z,this.z)),this}clampScalar(a,h){return this.x=Math.max(a,Math.min(h,this.x)),this.y=Math.max(a,Math.min(h,this.y)),this.z=Math.max(a,Math.min(h,this.z)),this}clampLength(a,h){const A=this.length();return this.divideScalar(A||1).multiplyScalar(Math.max(a,Math.min(h,A)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,h){return this.x+=(a.x-this.x)*h,this.y+=(a.y-this.y)*h,this.z+=(a.z-this.z)*h,this}lerpVectors(a,h,A){return this.x=a.x+(h.x-a.x)*A,this.y=a.y+(h.y-a.y)*A,this.z=a.z+(h.z-a.z)*A,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,h){const A=a.x,b=a.y,E=a.z,M=h.x,N=h.y,P=h.z;return this.x=b*P-E*N,this.y=E*M-A*P,this.z=A*N-b*M,this}projectOnVector(a){const h=a.lengthSq();if(h===0)return this.set(0,0,0);const A=a.dot(this)/h;return this.copy(a).multiplyScalar(A)}projectOnPlane(a){return Al.copy(this).projectOnVector(a),this.sub(Al)}reflect(a){return this.sub(Al.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){const h=Math.sqrt(this.lengthSq()*a.lengthSq());if(h===0)return Math.PI/2;const A=this.dot(a)/h;return Math.acos(ws(A,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const h=this.x-a.x,A=this.y-a.y,b=this.z-a.z;return h*h+A*A+b*b}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,h,A){const b=Math.sin(h)*a;return this.x=b*Math.sin(A),this.y=Math.cos(h)*a,this.z=b*Math.cos(A),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,h,A){return this.x=a*Math.sin(h),this.y=A,this.z=a*Math.cos(h),this}setFromMatrixPosition(a){const h=a.elements;return this.x=h[12],this.y=h[13],this.z=h[14],this}setFromMatrixScale(a){const h=this.setFromMatrixColumn(a,0).length(),A=this.setFromMatrixColumn(a,1).length(),b=this.setFromMatrixColumn(a,2).length();return this.x=h,this.y=A,this.z=b,this}setFromMatrixColumn(a,h){return this.fromArray(a.elements,h*4)}setFromMatrix3Column(a,h){return this.fromArray(a.elements,h*3)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,h=0){return this.x=a[h],this.y=a[h+1],this.z=a[h+2],this}toArray(a=[],h=0){return a[h]=this.x,a[h+1]=this.y,a[h+2]=this.z,a}fromBufferAttribute(a,h){return this.x=a.getX(h),this.y=a.getY(h),this.z=a.getZ(h),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const a=Math.random()*Math.PI*2,h=Math.random()*2-1,A=Math.sqrt(1-h*h);return this.x=A*Math.cos(a),this.y=h,this.z=A*Math.sin(a),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Al=new He,Fs=new jn;class Is{constructor(a=new He(1/0,1/0,1/0),h=new He(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=a,this.max=h}set(a,h){return this.min.copy(a),this.max.copy(h),this}setFromArray(a){this.makeEmpty();for(let h=0,A=a.length;h<A;h+=3)this.expandByPoint(ro.fromArray(a,h));return this}setFromBufferAttribute(a){this.makeEmpty();for(let h=0,A=a.count;h<A;h++)this.expandByPoint(ro.fromBufferAttribute(a,h));return this}setFromPoints(a){this.makeEmpty();for(let h=0,A=a.length;h<A;h++)this.expandByPoint(a[h]);return this}setFromCenterAndSize(a,h){const A=ro.copy(h).multiplyScalar(.5);return this.min.copy(a).sub(A),this.max.copy(a).add(A),this}setFromObject(a,h=!1){return this.makeEmpty(),this.expandByObject(a,h)}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}expandByObject(a,h=!1){a.updateWorldMatrix(!1,!1);const A=a.geometry;if(A!==void 0){const E=A.getAttribute("position");if(h===!0&&E!==void 0&&a.isInstancedMesh!==!0)for(let M=0,N=E.count;M<N;M++)a.isMesh===!0?a.getVertexPosition(M,ro):ro.fromBufferAttribute(E,M),ro.applyMatrix4(a.matrixWorld),this.expandByPoint(ro);else a.boundingBox!==void 0?(a.boundingBox===null&&a.computeBoundingBox(),Yc.copy(a.boundingBox)):(A.boundingBox===null&&A.computeBoundingBox(),Yc.copy(A.boundingBox)),Yc.applyMatrix4(a.matrixWorld),this.union(Yc)}const b=a.children;for(let E=0,M=b.length;E<M;E++)this.expandByObject(b[E],h);return this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,h){return h.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)}intersectsSphere(a){return this.clampPoint(a.center,ro),ro.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let h,A;return a.normal.x>0?(h=a.normal.x*this.min.x,A=a.normal.x*this.max.x):(h=a.normal.x*this.max.x,A=a.normal.x*this.min.x),a.normal.y>0?(h+=a.normal.y*this.min.y,A+=a.normal.y*this.max.y):(h+=a.normal.y*this.max.y,A+=a.normal.y*this.min.y),a.normal.z>0?(h+=a.normal.z*this.min.z,A+=a.normal.z*this.max.z):(h+=a.normal.z*this.max.z,A+=a.normal.z*this.min.z),h<=-a.constant&&A>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(Dn),rs.subVectors(this.max,Dn),Yo.subVectors(a.a,Dn),Ta.subVectors(a.b,Dn),rn.subVectors(a.c,Dn),Ga.subVectors(Ta,Yo),yl.subVectors(rn,Ta),Ma.subVectors(Yo,rn);let h=[0,-Ga.z,Ga.y,0,-yl.z,yl.y,0,-Ma.z,Ma.y,Ga.z,0,-Ga.x,yl.z,0,-yl.x,Ma.z,0,-Ma.x,-Ga.y,Ga.x,0,-yl.y,yl.x,0,-Ma.y,Ma.x,0];return!Co(h,Yo,Ta,rn,rs)||(h=[1,0,0,0,1,0,0,0,1],!Co(h,Yo,Ta,rn,rs))?!1:(nn.crossVectors(Ga,yl),h=[nn.x,nn.y,nn.z],Co(h,Yo,Ta,rn,rs))}clampPoint(a,h){return h.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,ro).distanceTo(a)}getBoundingSphere(a){return this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=this.getSize(ro).length()*.5),a}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}applyMatrix4(a){return this.isEmpty()?this:(_n[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),_n[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),_n[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),_n[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),_n[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),_n[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),_n[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),_n[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(_n),this)}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const _n=[new He,new He,new He,new He,new He,new He,new He,new He],ro=new He,Yc=new Is,Yo=new He,Ta=new He,rn=new He,Ga=new He,yl=new He,Ma=new He,Dn=new He,rs=new He,nn=new He,On=new He;function Co(C,a,h,A,b){for(let E=0,M=C.length-3;E<=M;E+=3){On.fromArray(C,E);const N=b.x*Math.abs(On.x)+b.y*Math.abs(On.y)+b.z*Math.abs(On.z),P=a.dot(On),F=h.dot(On),z=A.dot(On);if(Math.max(-Math.max(P,F,z),Math.min(P,F,z))>N)return!1}return!0}const Md=new Is,dh=new He,Qg=new He;class da{constructor(a=new He,h=-1){this.isSphere=!0,this.center=a,this.radius=h}set(a,h){return this.center.copy(a),this.radius=h,this}setFromPoints(a,h){const A=this.center;h!==void 0?A.copy(h):Md.setFromPoints(a).getCenter(A);let b=0;for(let E=0,M=a.length;E<M;E++)b=Math.max(b,A.distanceToSquared(a[E]));return this.radius=Math.sqrt(b),this}copy(a){return this.center.copy(a.center),this.radius=a.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){const h=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=h*h}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,h){const A=this.center.distanceToSquared(a);return h.copy(a),A>this.radius*this.radius&&(h.sub(this.center).normalize(),h.multiplyScalar(this.radius).add(this.center)),h}getBoundingBox(a){return this.isEmpty()?(a.makeEmpty(),a):(a.set(this.center,this.center),a.expandByScalar(this.radius),a)}applyMatrix4(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this}translate(a){return this.center.add(a),this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;dh.subVectors(a,this.center);const h=dh.lengthSq();if(h>this.radius*this.radius){const A=Math.sqrt(h),b=(A-this.radius)*.5;this.center.addScaledVector(dh,b/A),this.radius+=b}return this}union(a){return a.isEmpty()?this:this.isEmpty()?(this.copy(a),this):(this.center.equals(a.center)===!0?this.radius=Math.max(this.radius,a.radius):(Qg.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(dh.copy(a.center).add(Qg)),this.expandByPoint(dh.copy(a.center).sub(Qg))),this)}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Fl=new He,qg=new He,Xg=new He,Kc=new He,ev=new He,Yg=new He,tv=new He;class pa{constructor(a=new He,h=new He(0,0,-1)){this.origin=a,this.direction=h}set(a,h){return this.origin.copy(a),this.direction.copy(h),this}copy(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}at(a,h){return h.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){return this.direction.copy(a).sub(this.origin).normalize(),this}recast(a){return this.origin.copy(this.at(a,Fl)),this}closestPointToPoint(a,h){h.subVectors(a,this.origin);const A=h.dot(this.direction);return A<0?h.copy(this.origin):h.copy(this.origin).addScaledVector(this.direction,A)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){const h=Fl.subVectors(a,this.origin).dot(this.direction);return h<0?this.origin.distanceToSquared(a):(Fl.copy(this.origin).addScaledVector(this.direction,h),Fl.distanceToSquared(a))}distanceSqToSegment(a,h,A,b){qg.copy(a).add(h).multiplyScalar(.5),Xg.copy(h).sub(a).normalize(),Kc.copy(this.origin).sub(qg);const E=a.distanceTo(h)*.5,M=-this.direction.dot(Xg),N=Kc.dot(this.direction),P=-Kc.dot(Xg),F=Kc.lengthSq(),z=Math.abs(1-M*M);let X,q,K,te;if(z>0)if(X=M*P-N,q=M*N-P,te=E*z,X>=0)if(q>=-te)if(q<=te){const oe=1/z;X*=oe,q*=oe,K=X*(X+M*q+2*N)+q*(M*X+q+2*P)+F}else q=E,X=Math.max(0,-(M*q+N)),K=-X*X+q*(q+2*P)+F;else q=-E,X=Math.max(0,-(M*q+N)),K=-X*X+q*(q+2*P)+F;else q<=-te?(X=Math.max(0,-(-M*E+N)),q=X>0?-E:Math.min(Math.max(-E,-P),E),K=-X*X+q*(q+2*P)+F):q<=te?(X=0,q=Math.min(Math.max(-E,-P),E),K=q*(q+2*P)+F):(X=Math.max(0,-(M*E+N)),q=X>0?E:Math.min(Math.max(-E,-P),E),K=-X*X+q*(q+2*P)+F);else q=M>0?-E:E,X=Math.max(0,-(M*q+N)),K=-X*X+q*(q+2*P)+F;return A&&A.copy(this.origin).addScaledVector(this.direction,X),b&&b.copy(qg).addScaledVector(Xg,q),K}intersectSphere(a,h){Fl.subVectors(a.center,this.origin);const A=Fl.dot(this.direction),b=Fl.dot(Fl)-A*A,E=a.radius*a.radius;if(b>E)return null;const M=Math.sqrt(E-b),N=A-M,P=A+M;return P<0?null:N<0?this.at(P,h):this.at(N,h)}intersectsSphere(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){const h=a.normal.dot(this.direction);if(h===0)return a.distanceToPoint(this.origin)===0?0:null;const A=-(this.origin.dot(a.normal)+a.constant)/h;return A>=0?A:null}intersectPlane(a,h){const A=this.distanceToPlane(a);return A===null?null:this.at(A,h)}intersectsPlane(a){const h=a.distanceToPoint(this.origin);return h===0||a.normal.dot(this.direction)*h<0}intersectBox(a,h){let A,b,E,M,N,P;const F=1/this.direction.x,z=1/this.direction.y,X=1/this.direction.z,q=this.origin;return F>=0?(A=(a.min.x-q.x)*F,b=(a.max.x-q.x)*F):(A=(a.max.x-q.x)*F,b=(a.min.x-q.x)*F),z>=0?(E=(a.min.y-q.y)*z,M=(a.max.y-q.y)*z):(E=(a.max.y-q.y)*z,M=(a.min.y-q.y)*z),A>M||E>b||((E>A||isNaN(A))&&(A=E),(M<b||isNaN(b))&&(b=M),X>=0?(N=(a.min.z-q.z)*X,P=(a.max.z-q.z)*X):(N=(a.max.z-q.z)*X,P=(a.min.z-q.z)*X),A>P||N>b)||((N>A||A!==A)&&(A=N),(P<b||b!==b)&&(b=P),b<0)?null:this.at(A>=0?A:b,h)}intersectsBox(a){return this.intersectBox(a,Fl)!==null}intersectTriangle(a,h,A,b,E){ev.subVectors(h,a),Yg.subVectors(A,a),tv.crossVectors(ev,Yg);let M=this.direction.dot(tv),N;if(M>0){if(b)return null;N=1}else if(M<0)N=-1,M=-M;else return null;Kc.subVectors(this.origin,a);const P=N*this.direction.dot(Yg.crossVectors(Kc,Yg));if(P<0)return null;const F=N*this.direction.dot(ev.cross(Kc));if(F<0||P+F>M)return null;const z=-N*Kc.dot(tv);return z<0?null:this.at(z/M,E)}applyMatrix4(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class fr{constructor(a,h,A,b,E,M,N,P,F,z,X,q,K,te,oe,ne){fr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a!==void 0&&this.set(a,h,A,b,E,M,N,P,F,z,X,q,K,te,oe,ne)}set(a,h,A,b,E,M,N,P,F,z,X,q,K,te,oe,ne){const ee=this.elements;return ee[0]=a,ee[4]=h,ee[8]=A,ee[12]=b,ee[1]=E,ee[5]=M,ee[9]=N,ee[13]=P,ee[2]=F,ee[6]=z,ee[10]=X,ee[14]=q,ee[3]=K,ee[7]=te,ee[11]=oe,ee[15]=ne,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new fr().fromArray(this.elements)}copy(a){const h=this.elements,A=a.elements;return h[0]=A[0],h[1]=A[1],h[2]=A[2],h[3]=A[3],h[4]=A[4],h[5]=A[5],h[6]=A[6],h[7]=A[7],h[8]=A[8],h[9]=A[9],h[10]=A[10],h[11]=A[11],h[12]=A[12],h[13]=A[13],h[14]=A[14],h[15]=A[15],this}copyPosition(a){const h=this.elements,A=a.elements;return h[12]=A[12],h[13]=A[13],h[14]=A[14],this}setFromMatrix3(a){const h=a.elements;return this.set(h[0],h[3],h[6],0,h[1],h[4],h[7],0,h[2],h[5],h[8],0,0,0,0,1),this}extractBasis(a,h,A){return a.setFromMatrixColumn(this,0),h.setFromMatrixColumn(this,1),A.setFromMatrixColumn(this,2),this}makeBasis(a,h,A){return this.set(a.x,h.x,A.x,0,a.y,h.y,A.y,0,a.z,h.z,A.z,0,0,0,0,1),this}extractRotation(a){const h=this.elements,A=a.elements,b=1/ph.setFromMatrixColumn(a,0).length(),E=1/ph.setFromMatrixColumn(a,1).length(),M=1/ph.setFromMatrixColumn(a,2).length();return h[0]=A[0]*b,h[1]=A[1]*b,h[2]=A[2]*b,h[3]=0,h[4]=A[4]*E,h[5]=A[5]*E,h[6]=A[6]*E,h[7]=0,h[8]=A[8]*M,h[9]=A[9]*M,h[10]=A[10]*M,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this}makeRotationFromEuler(a){const h=this.elements,A=a.x,b=a.y,E=a.z,M=Math.cos(A),N=Math.sin(A),P=Math.cos(b),F=Math.sin(b),z=Math.cos(E),X=Math.sin(E);if(a.order==="XYZ"){const q=M*z,K=M*X,te=N*z,oe=N*X;h[0]=P*z,h[4]=-P*X,h[8]=F,h[1]=K+te*F,h[5]=q-oe*F,h[9]=-N*P,h[2]=oe-q*F,h[6]=te+K*F,h[10]=M*P}else if(a.order==="YXZ"){const q=P*z,K=P*X,te=F*z,oe=F*X;h[0]=q+oe*N,h[4]=te*N-K,h[8]=M*F,h[1]=M*X,h[5]=M*z,h[9]=-N,h[2]=K*N-te,h[6]=oe+q*N,h[10]=M*P}else if(a.order==="ZXY"){const q=P*z,K=P*X,te=F*z,oe=F*X;h[0]=q-oe*N,h[4]=-M*X,h[8]=te+K*N,h[1]=K+te*N,h[5]=M*z,h[9]=oe-q*N,h[2]=-M*F,h[6]=N,h[10]=M*P}else if(a.order==="ZYX"){const q=M*z,K=M*X,te=N*z,oe=N*X;h[0]=P*z,h[4]=te*F-K,h[8]=q*F+oe,h[1]=P*X,h[5]=oe*F+q,h[9]=K*F-te,h[2]=-F,h[6]=N*P,h[10]=M*P}else if(a.order==="YZX"){const q=M*P,K=M*F,te=N*P,oe=N*F;h[0]=P*z,h[4]=oe-q*X,h[8]=te*X+K,h[1]=X,h[5]=M*z,h[9]=-N*z,h[2]=-F*z,h[6]=K*X+te,h[10]=q-oe*X}else if(a.order==="XZY"){const q=M*P,K=M*F,te=N*P,oe=N*F;h[0]=P*z,h[4]=-X,h[8]=F*z,h[1]=q*X+oe,h[5]=M*z,h[9]=K*X-te,h[2]=te*X-K,h[6]=N*z,h[10]=oe*X+q}return h[3]=0,h[7]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this}makeRotationFromQuaternion(a){return this.compose(V_e,a,G_e)}lookAt(a,h,A){const b=this.elements;return vl.subVectors(a,h),vl.lengthSq()===0&&(vl.z=1),vl.normalize(),Rd.crossVectors(A,vl),Rd.lengthSq()===0&&(Math.abs(A.z)===1?vl.x+=1e-4:vl.z+=1e-4,vl.normalize(),Rd.crossVectors(A,vl)),Rd.normalize(),mE.crossVectors(vl,Rd),b[0]=Rd.x,b[4]=mE.x,b[8]=vl.x,b[1]=Rd.y,b[5]=mE.y,b[9]=vl.y,b[2]=Rd.z,b[6]=mE.z,b[10]=vl.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,h){const A=a.elements,b=h.elements,E=this.elements,M=A[0],N=A[4],P=A[8],F=A[12],z=A[1],X=A[5],q=A[9],K=A[13],te=A[2],oe=A[6],ne=A[10],ee=A[14],Me=A[3],we=A[7],_e=A[11],nt=A[15],qe=b[0],Je=b[4],it=b[8],ze=b[12],Oe=b[1],rt=b[5],mt=b[9],pt=b[13],Tt=b[2],Pt=b[6],ui=b[10],Li=b[14],Ft=b[3],gi=b[7],Di=b[11],kr=b[15];return E[0]=M*qe+N*Oe+P*Tt+F*Ft,E[4]=M*Je+N*rt+P*Pt+F*gi,E[8]=M*it+N*mt+P*ui+F*Di,E[12]=M*ze+N*pt+P*Li+F*kr,E[1]=z*qe+X*Oe+q*Tt+K*Ft,E[5]=z*Je+X*rt+q*Pt+K*gi,E[9]=z*it+X*mt+q*ui+K*Di,E[13]=z*ze+X*pt+q*Li+K*kr,E[2]=te*qe+oe*Oe+ne*Tt+ee*Ft,E[6]=te*Je+oe*rt+ne*Pt+ee*gi,E[10]=te*it+oe*mt+ne*ui+ee*Di,E[14]=te*ze+oe*pt+ne*Li+ee*kr,E[3]=Me*qe+we*Oe+_e*Tt+nt*Ft,E[7]=Me*Je+we*rt+_e*Pt+nt*gi,E[11]=Me*it+we*mt+_e*ui+nt*Di,E[15]=Me*ze+we*pt+_e*Li+nt*kr,this}multiplyScalar(a){const h=this.elements;return h[0]*=a,h[4]*=a,h[8]*=a,h[12]*=a,h[1]*=a,h[5]*=a,h[9]*=a,h[13]*=a,h[2]*=a,h[6]*=a,h[10]*=a,h[14]*=a,h[3]*=a,h[7]*=a,h[11]*=a,h[15]*=a,this}determinant(){const a=this.elements,h=a[0],A=a[4],b=a[8],E=a[12],M=a[1],N=a[5],P=a[9],F=a[13],z=a[2],X=a[6],q=a[10],K=a[14],te=a[3],oe=a[7],ne=a[11],ee=a[15];return te*(+E*P*X-b*F*X-E*N*q+A*F*q+b*N*K-A*P*K)+oe*(+h*P*K-h*F*q+E*M*q-b*M*K+b*F*z-E*P*z)+ne*(+h*F*X-h*N*K-E*M*X+A*M*K+E*N*z-A*F*z)+ee*(-b*N*z-h*P*X+h*N*q+b*M*X-A*M*q+A*P*z)}transpose(){const a=this.elements;let h;return h=a[1],a[1]=a[4],a[4]=h,h=a[2],a[2]=a[8],a[8]=h,h=a[6],a[6]=a[9],a[9]=h,h=a[3],a[3]=a[12],a[12]=h,h=a[7],a[7]=a[13],a[13]=h,h=a[11],a[11]=a[14],a[14]=h,this}setPosition(a,h,A){const b=this.elements;return a.isVector3?(b[12]=a.x,b[13]=a.y,b[14]=a.z):(b[12]=a,b[13]=h,b[14]=A),this}invert(){const a=this.elements,h=a[0],A=a[1],b=a[2],E=a[3],M=a[4],N=a[5],P=a[6],F=a[7],z=a[8],X=a[9],q=a[10],K=a[11],te=a[12],oe=a[13],ne=a[14],ee=a[15],Me=X*ne*F-oe*q*F+oe*P*K-N*ne*K-X*P*ee+N*q*ee,we=te*q*F-z*ne*F-te*P*K+M*ne*K+z*P*ee-M*q*ee,_e=z*oe*F-te*X*F+te*N*K-M*oe*K-z*N*ee+M*X*ee,nt=te*X*P-z*oe*P-te*N*q+M*oe*q+z*N*ne-M*X*ne,qe=h*Me+A*we+b*_e+E*nt;if(qe===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Je=1/qe;return a[0]=Me*Je,a[1]=(oe*q*E-X*ne*E-oe*b*K+A*ne*K+X*b*ee-A*q*ee)*Je,a[2]=(N*ne*E-oe*P*E+oe*b*F-A*ne*F-N*b*ee+A*P*ee)*Je,a[3]=(X*P*E-N*q*E-X*b*F+A*q*F+N*b*K-A*P*K)*Je,a[4]=we*Je,a[5]=(z*ne*E-te*q*E+te*b*K-h*ne*K-z*b*ee+h*q*ee)*Je,a[6]=(te*P*E-M*ne*E-te*b*F+h*ne*F+M*b*ee-h*P*ee)*Je,a[7]=(M*q*E-z*P*E+z*b*F-h*q*F-M*b*K+h*P*K)*Je,a[8]=_e*Je,a[9]=(te*X*E-z*oe*E-te*A*K+h*oe*K+z*A*ee-h*X*ee)*Je,a[10]=(M*oe*E-te*N*E+te*A*F-h*oe*F-M*A*ee+h*N*ee)*Je,a[11]=(z*N*E-M*X*E-z*A*F+h*X*F+M*A*K-h*N*K)*Je,a[12]=nt*Je,a[13]=(z*oe*b-te*X*b+te*A*q-h*oe*q-z*A*ne+h*X*ne)*Je,a[14]=(te*N*b-M*oe*b-te*A*P+h*oe*P+M*A*ne-h*N*ne)*Je,a[15]=(M*X*b-z*N*b+z*A*P-h*X*P-M*A*q+h*N*q)*Je,this}scale(a){const h=this.elements,A=a.x,b=a.y,E=a.z;return h[0]*=A,h[4]*=b,h[8]*=E,h[1]*=A,h[5]*=b,h[9]*=E,h[2]*=A,h[6]*=b,h[10]*=E,h[3]*=A,h[7]*=b,h[11]*=E,this}getMaxScaleOnAxis(){const a=this.elements,h=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],A=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],b=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(h,A,b))}makeTranslation(a,h,A){return a.isVector3?this.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1):this.set(1,0,0,a,0,1,0,h,0,0,1,A,0,0,0,1),this}makeRotationX(a){const h=Math.cos(a),A=Math.sin(a);return this.set(1,0,0,0,0,h,-A,0,0,A,h,0,0,0,0,1),this}makeRotationY(a){const h=Math.cos(a),A=Math.sin(a);return this.set(h,0,A,0,0,1,0,0,-A,0,h,0,0,0,0,1),this}makeRotationZ(a){const h=Math.cos(a),A=Math.sin(a);return this.set(h,-A,0,0,A,h,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,h){const A=Math.cos(h),b=Math.sin(h),E=1-A,M=a.x,N=a.y,P=a.z,F=E*M,z=E*N;return this.set(F*M+A,F*N-b*P,F*P+b*N,0,F*N+b*P,z*N+A,z*P-b*M,0,F*P-b*N,z*P+b*M,E*P*P+A,0,0,0,0,1),this}makeScale(a,h,A){return this.set(a,0,0,0,0,h,0,0,0,0,A,0,0,0,0,1),this}makeShear(a,h,A,b,E,M){return this.set(1,A,E,0,a,1,M,0,h,b,1,0,0,0,0,1),this}compose(a,h,A){const b=this.elements,E=h._x,M=h._y,N=h._z,P=h._w,F=E+E,z=M+M,X=N+N,q=E*F,K=E*z,te=E*X,oe=M*z,ne=M*X,ee=N*X,Me=P*F,we=P*z,_e=P*X,nt=A.x,qe=A.y,Je=A.z;return b[0]=(1-(oe+ee))*nt,b[1]=(K+_e)*nt,b[2]=(te-we)*nt,b[3]=0,b[4]=(K-_e)*qe,b[5]=(1-(q+ee))*qe,b[6]=(ne+Me)*qe,b[7]=0,b[8]=(te+we)*Je,b[9]=(ne-Me)*Je,b[10]=(1-(q+oe))*Je,b[11]=0,b[12]=a.x,b[13]=a.y,b[14]=a.z,b[15]=1,this}decompose(a,h,A){const b=this.elements;let E=ph.set(b[0],b[1],b[2]).length();const M=ph.set(b[4],b[5],b[6]).length(),N=ph.set(b[8],b[9],b[10]).length();this.determinant()<0&&(E=-E),a.x=b[12],a.y=b[13],a.z=b[14],Ko.copy(this);const P=1/E,F=1/M,z=1/N;return Ko.elements[0]*=P,Ko.elements[1]*=P,Ko.elements[2]*=P,Ko.elements[4]*=F,Ko.elements[5]*=F,Ko.elements[6]*=F,Ko.elements[8]*=z,Ko.elements[9]*=z,Ko.elements[10]*=z,h.setFromRotationMatrix(Ko),A.x=E,A.y=M,A.z=N,this}makePerspective(a,h,A,b,E,M,N=Pl){const P=this.elements,F=2*E/(h-a),z=2*E/(A-b),X=(h+a)/(h-a),q=(A+b)/(A-b);let K,te;if(N===Pl)K=-(M+E)/(M-E),te=-2*M*E/(M-E);else if(N===tf)K=-M/(M-E),te=-M*E/(M-E);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+N);return P[0]=F,P[4]=0,P[8]=X,P[12]=0,P[1]=0,P[5]=z,P[9]=q,P[13]=0,P[2]=0,P[6]=0,P[10]=K,P[14]=te,P[3]=0,P[7]=0,P[11]=-1,P[15]=0,this}makeOrthographic(a,h,A,b,E,M,N=Pl){const P=this.elements,F=1/(h-a),z=1/(A-b),X=1/(M-E),q=(h+a)*F,K=(A+b)*z;let te,oe;if(N===Pl)te=(M+E)*X,oe=-2*X;else if(N===tf)te=E*X,oe=-1*X;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+N);return P[0]=2*F,P[4]=0,P[8]=0,P[12]=-q,P[1]=0,P[5]=2*z,P[9]=0,P[13]=-K,P[2]=0,P[6]=0,P[10]=oe,P[14]=-te,P[3]=0,P[7]=0,P[11]=0,P[15]=1,this}equals(a){const h=this.elements,A=a.elements;for(let b=0;b<16;b++)if(h[b]!==A[b])return!1;return!0}fromArray(a,h=0){for(let A=0;A<16;A++)this.elements[A]=a[A+h];return this}toArray(a=[],h=0){const A=this.elements;return a[h]=A[0],a[h+1]=A[1],a[h+2]=A[2],a[h+3]=A[3],a[h+4]=A[4],a[h+5]=A[5],a[h+6]=A[6],a[h+7]=A[7],a[h+8]=A[8],a[h+9]=A[9],a[h+10]=A[10],a[h+11]=A[11],a[h+12]=A[12],a[h+13]=A[13],a[h+14]=A[14],a[h+15]=A[15],a}}const ph=new He,Ko=new fr,V_e=new He(0,0,0),G_e=new He(1,1,1),Rd=new He,mE=new He,vl=new He,o9=new fr,l9=new jn;class xl{constructor(a=0,h=0,A=0,b=xl.DEFAULT_ORDER){this.isEuler=!0,this._x=a,this._y=h,this._z=A,this._order=b}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a,this._onChangeCallback()}set(a,h,A,b=this._order){return this._x=a,this._y=h,this._z=A,this._order=b,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this}setFromRotationMatrix(a,h=this._order,A=!0){const b=a.elements,E=b[0],M=b[4],N=b[8],P=b[1],F=b[5],z=b[9],X=b[2],q=b[6],K=b[10];switch(h){case"XYZ":this._y=Math.asin(ws(N,-1,1)),Math.abs(N)<.9999999?(this._x=Math.atan2(-z,K),this._z=Math.atan2(-M,E)):(this._x=Math.atan2(q,F),this._z=0);break;case"YXZ":this._x=Math.asin(-ws(z,-1,1)),Math.abs(z)<.9999999?(this._y=Math.atan2(N,K),this._z=Math.atan2(P,F)):(this._y=Math.atan2(-X,E),this._z=0);break;case"ZXY":this._x=Math.asin(ws(q,-1,1)),Math.abs(q)<.9999999?(this._y=Math.atan2(-X,K),this._z=Math.atan2(-M,F)):(this._y=0,this._z=Math.atan2(P,E));break;case"ZYX":this._y=Math.asin(-ws(X,-1,1)),Math.abs(X)<.9999999?(this._x=Math.atan2(q,K),this._z=Math.atan2(P,E)):(this._x=0,this._z=Math.atan2(-M,F));break;case"YZX":this._z=Math.asin(ws(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(-z,F),this._y=Math.atan2(-X,E)):(this._x=0,this._y=Math.atan2(N,K));break;case"XZY":this._z=Math.asin(-ws(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(q,F),this._y=Math.atan2(N,E)):(this._x=Math.atan2(-z,K),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+h)}return this._order=h,A===!0&&this._onChangeCallback(),this}setFromQuaternion(a,h,A){return o9.makeRotationFromQuaternion(a),this.setFromRotationMatrix(o9,h,A)}setFromVector3(a,h=this._order){return this.set(a.x,a.y,a.z,h)}reorder(a){return l9.setFromEuler(this),this.setFromQuaternion(l9,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){return this._x=a[0],this._y=a[1],this._z=a[2],a[3]!==void 0&&(this._order=a[3]),this._onChangeCallback(),this}toArray(a=[],h=0){return a[h]=this._x,a[h+1]=this._y,a[h+2]=this._z,a[h+3]=this._order,a}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}xl.DEFAULT_ORDER="XYZ";class gE{constructor(){this.mask=1}set(a){this.mask=(1<<a|0)>>>0}enable(a){this.mask|=1<<a|0}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a|0}disable(a){this.mask&=~(1<<a|0)}disableAll(){this.mask=0}test(a){return(this.mask&a.mask)!==0}isEnabled(a){return(this.mask&(1<<a|0))!==0}}let H_e=0;const c9=new He,Kg=new jn,fh=new fr,AE=new He,iv=new He,W_e=new He,Q_e=new jn,u9=new He(1,0,0),h9=new He(0,1,0),d9=new He(0,0,1),p9={type:"added"},q_e={type:"removed"},Jg={type:"childadded",child:null},gB={type:"childremoved",child:null};class Vn extends Eo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:H_e++}),this.uuid=wo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Vn.DEFAULT_UP.clone();const a=new He,h=new xl,A=new jn,b=new He(1,1,1);function E(){A.setFromEuler(h,!1)}function M(){h.setFromQuaternion(A,void 0,!1)}h._onChange(E),A._onChange(M),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:h},quaternion:{configurable:!0,enumerable:!0,value:A},scale:{configurable:!0,enumerable:!0,value:b},modelViewMatrix:{value:new fr},normalMatrix:{value:new qr}}),this.matrix=new fr,this.matrixWorld=new fr,this.matrixAutoUpdate=Vn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Vn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new gE,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){return this.quaternion.premultiply(a),this}setRotationFromAxisAngle(a,h){this.quaternion.setFromAxisAngle(a,h)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,h){return Kg.setFromAxisAngle(a,h),this.quaternion.multiply(Kg),this}rotateOnWorldAxis(a,h){return Kg.setFromAxisAngle(a,h),this.quaternion.premultiply(Kg),this}rotateX(a){return this.rotateOnAxis(u9,a)}rotateY(a){return this.rotateOnAxis(h9,a)}rotateZ(a){return this.rotateOnAxis(d9,a)}translateOnAxis(a,h){return c9.copy(a).applyQuaternion(this.quaternion),this.position.add(c9.multiplyScalar(h)),this}translateX(a){return this.translateOnAxis(u9,a)}translateY(a){return this.translateOnAxis(h9,a)}translateZ(a){return this.translateOnAxis(d9,a)}localToWorld(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(this.matrixWorld)}worldToLocal(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(fh.copy(this.matrixWorld).invert())}lookAt(a,h,A){a.isVector3?AE.copy(a):AE.set(a,h,A);const b=this.parent;this.updateWorldMatrix(!0,!1),iv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fh.lookAt(iv,AE,this.up):fh.lookAt(AE,iv,this.up),this.quaternion.setFromRotationMatrix(fh),b&&(fh.extractRotation(b.matrixWorld),Kg.setFromRotationMatrix(fh),this.quaternion.premultiply(Kg.invert()))}add(a){if(arguments.length>1){for(let h=0;h<arguments.length;h++)this.add(arguments[h]);return this}return a===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a&&a.isObject3D?(a.removeFromParent(),a.parent=this,this.children.push(a),a.dispatchEvent(p9),Jg.child=a,this.dispatchEvent(Jg),Jg.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)}remove(a){if(arguments.length>1){for(let A=0;A<arguments.length;A++)this.remove(arguments[A]);return this}const h=this.children.indexOf(a);return h!==-1&&(a.parent=null,this.children.splice(h,1),a.dispatchEvent(q_e),gB.child=a,this.dispatchEvent(gB),gB.child=null),this}removeFromParent(){const a=this.parent;return a!==null&&a.remove(this),this}clear(){return this.remove(...this.children)}attach(a){return this.updateWorldMatrix(!0,!1),fh.copy(this.matrixWorld).invert(),a.parent!==null&&(a.parent.updateWorldMatrix(!0,!1),fh.multiply(a.parent.matrixWorld)),a.applyMatrix4(fh),a.removeFromParent(),a.parent=this,this.children.push(a),a.updateWorldMatrix(!1,!0),a.dispatchEvent(p9),Jg.child=a,this.dispatchEvent(Jg),Jg.child=null,this}getObjectById(a){return this.getObjectByProperty("id",a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,h){if(this[a]===h)return this;for(let A=0,b=this.children.length;A<b;A++){const E=this.children[A].getObjectByProperty(a,h);if(E!==void 0)return E}}getObjectsByProperty(a,h,A=[]){this[a]===h&&A.push(this);const b=this.children;for(let E=0,M=b.length;E<M;E++)b[E].getObjectsByProperty(a,h,A);return A}getWorldPosition(a){return this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(iv,a,W_e),a}getWorldScale(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(iv,Q_e,a),a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const h=this.matrixWorld.elements;return a.set(h[8],h[9],h[10]).normalize()}raycast(){}traverse(a){a(this);const h=this.children;for(let A=0,b=h.length;A<b;A++)h[A].traverse(a)}traverseVisible(a){if(this.visible===!1)return;a(this);const h=this.children;for(let A=0,b=h.length;A<b;A++)h[A].traverseVisible(a)}traverseAncestors(a){const h=this.parent;h!==null&&(a(h),h.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);const h=this.children;for(let A=0,b=h.length;A<b;A++){const E=h[A];(E.matrixWorldAutoUpdate===!0||a===!0)&&E.updateMatrixWorld(a)}}updateWorldMatrix(a,h){const A=this.parent;if(a===!0&&A!==null&&A.matrixWorldAutoUpdate===!0&&A.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),h===!0){const b=this.children;for(let E=0,M=b.length;E<M;E++){const N=b[E];N.matrixWorldAutoUpdate===!0&&N.updateWorldMatrix(!1,!0)}}}toJSON(a){const h=a===void 0||typeof a=="string",A={};h&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},A.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const b={};b.uuid=this.uuid,b.type=this.type,this.name!==""&&(b.name=this.name),this.castShadow===!0&&(b.castShadow=!0),this.receiveShadow===!0&&(b.receiveShadow=!0),this.visible===!1&&(b.visible=!1),this.frustumCulled===!1&&(b.frustumCulled=!1),this.renderOrder!==0&&(b.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(b.userData=this.userData),b.layers=this.layers.mask,b.matrix=this.matrix.toArray(),b.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(b.matrixAutoUpdate=!1),this.isInstancedMesh&&(b.type="InstancedMesh",b.count=this.count,b.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(b.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(b.type="BatchedMesh",b.perObjectFrustumCulled=this.perObjectFrustumCulled,b.sortObjects=this.sortObjects,b.drawRanges=this._drawRanges,b.reservedRanges=this._reservedRanges,b.visibility=this._visibility,b.active=this._active,b.bounds=this._bounds.map(N=>({boxInitialized:N.boxInitialized,boxMin:N.box.min.toArray(),boxMax:N.box.max.toArray(),sphereInitialized:N.sphereInitialized,sphereRadius:N.sphere.radius,sphereCenter:N.sphere.center.toArray()})),b.maxGeometryCount=this._maxGeometryCount,b.maxVertexCount=this._maxVertexCount,b.maxIndexCount=this._maxIndexCount,b.geometryInitialized=this._geometryInitialized,b.geometryCount=this._geometryCount,b.matricesTexture=this._matricesTexture.toJSON(a),this.boundingSphere!==null&&(b.boundingSphere={center:b.boundingSphere.center.toArray(),radius:b.boundingSphere.radius}),this.boundingBox!==null&&(b.boundingBox={min:b.boundingBox.min.toArray(),max:b.boundingBox.max.toArray()}));function E(N,P){return N[P.uuid]===void 0&&(N[P.uuid]=P.toJSON(a)),P.uuid}if(this.isScene)this.background&&(this.background.isColor?b.background=this.background.toJSON():this.background.isTexture&&(b.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(b.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){b.geometry=E(a.geometries,this.geometry);const N=this.geometry.parameters;if(N!==void 0&&N.shapes!==void 0){const P=N.shapes;if(Array.isArray(P))for(let F=0,z=P.length;F<z;F++){const X=P[F];E(a.shapes,X)}else E(a.shapes,P)}}if(this.isSkinnedMesh&&(b.bindMode=this.bindMode,b.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(E(a.skeletons,this.skeleton),b.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const N=[];for(let P=0,F=this.material.length;P<F;P++)N.push(E(a.materials,this.material[P]));b.material=N}else b.material=E(a.materials,this.material);if(this.children.length>0){b.children=[];for(let N=0;N<this.children.length;N++)b.children.push(this.children[N].toJSON(a).object)}if(this.animations.length>0){b.animations=[];for(let N=0;N<this.animations.length;N++){const P=this.animations[N];b.animations.push(E(a.animations,P))}}if(h){const N=M(a.geometries),P=M(a.materials),F=M(a.textures),z=M(a.images),X=M(a.shapes),q=M(a.skeletons),K=M(a.animations),te=M(a.nodes);N.length>0&&(A.geometries=N),P.length>0&&(A.materials=P),F.length>0&&(A.textures=F),z.length>0&&(A.images=z),X.length>0&&(A.shapes=X),q.length>0&&(A.skeletons=q),K.length>0&&(A.animations=K),te.length>0&&(A.nodes=te)}return A.object=b,A;function M(N){const P=[];for(const F in N){const z=N[F];delete z.metadata,P.push(z)}return P}}clone(a){return new this.constructor().copy(this,a)}copy(a,h=!0){if(this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.animations=a.animations.slice(),this.userData=JSON.parse(JSON.stringify(a.userData)),h===!0)for(let A=0;A<a.children.length;A++){const b=a.children[A];this.add(b.clone())}return this}}Vn.DEFAULT_UP=new He(0,1,0),Vn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Vn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const wc=new He,mh=new He,AB=new He,gh=new He,Zg=new He,$g=new He,f9=new He,yB=new He,vB=new He,xB=new He;class bl{constructor(a=new He,h=new He,A=new He){this.a=a,this.b=h,this.c=A}static getNormal(a,h,A,b){b.subVectors(A,h),wc.subVectors(a,h),b.cross(wc);const E=b.lengthSq();return E>0?b.multiplyScalar(1/Math.sqrt(E)):b.set(0,0,0)}static getBarycoord(a,h,A,b,E){wc.subVectors(b,h),mh.subVectors(A,h),AB.subVectors(a,h);const M=wc.dot(wc),N=wc.dot(mh),P=wc.dot(AB),F=mh.dot(mh),z=mh.dot(AB),X=M*F-N*N;if(X===0)return E.set(0,0,0),null;const q=1/X,K=(F*P-N*z)*q,te=(M*z-N*P)*q;return E.set(1-K-te,te,K)}static containsPoint(a,h,A,b){return this.getBarycoord(a,h,A,b,gh)===null?!1:gh.x>=0&&gh.y>=0&&gh.x+gh.y<=1}static getInterpolation(a,h,A,b,E,M,N,P){return this.getBarycoord(a,h,A,b,gh)===null?(P.x=0,P.y=0,"z"in P&&(P.z=0),"w"in P&&(P.w=0),null):(P.setScalar(0),P.addScaledVector(E,gh.x),P.addScaledVector(M,gh.y),P.addScaledVector(N,gh.z),P)}static isFrontFacing(a,h,A,b){return wc.subVectors(A,h),mh.subVectors(a,h),wc.cross(mh).dot(b)<0}set(a,h,A){return this.a.copy(a),this.b.copy(h),this.c.copy(A),this}setFromPointsAndIndices(a,h,A,b){return this.a.copy(a[h]),this.b.copy(a[A]),this.c.copy(a[b]),this}setFromAttributeAndIndices(a,h,A,b){return this.a.fromBufferAttribute(a,h),this.b.fromBufferAttribute(a,A),this.c.fromBufferAttribute(a,b),this}clone(){return new this.constructor().copy(this)}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}getArea(){return wc.subVectors(this.c,this.b),mh.subVectors(this.a,this.b),wc.cross(mh).length()*.5}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(.3333333333333333)}getNormal(a){return bl.getNormal(this.a,this.b,this.c,a)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(a,h){return bl.getBarycoord(a,this.a,this.b,this.c,h)}getInterpolation(a,h,A,b,E){return bl.getInterpolation(a,this.a,this.b,this.c,h,A,b,E)}containsPoint(a){return bl.containsPoint(a,this.a,this.b,this.c)}isFrontFacing(a){return bl.isFrontFacing(this.a,this.b,this.c,a)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,h){const A=this.a,b=this.b,E=this.c;let M,N;Zg.subVectors(b,A),$g.subVectors(E,A),yB.subVectors(a,A);const P=Zg.dot(yB),F=$g.dot(yB);if(P<=0&&F<=0)return h.copy(A);vB.subVectors(a,b);const z=Zg.dot(vB),X=$g.dot(vB);if(z>=0&&X<=z)return h.copy(b);const q=P*X-z*F;if(q<=0&&P>=0&&z<=0)return M=P/(P-z),h.copy(A).addScaledVector(Zg,M);xB.subVectors(a,E);const K=Zg.dot(xB),te=$g.dot(xB);if(te>=0&&K<=te)return h.copy(E);const oe=K*F-P*te;if(oe<=0&&F>=0&&te<=0)return N=F/(F-te),h.copy(A).addScaledVector($g,N);const ne=z*te-K*X;if(ne<=0&&X-z>=0&&K-te>=0)return f9.subVectors(E,b),N=(X-z)/(X-z+(K-te)),h.copy(b).addScaledVector(f9,N);const ee=1/(ne+oe+q);return M=oe*ee,N=q*ee,h.copy(A).addScaledVector(Zg,M).addScaledVector($g,N)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}}const m9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Id={h:0,s:0,l:0},yE={h:0,s:0,l:0};function bB(C,a,h){return h<0&&(h+=1),h>1&&(h-=1),h<.16666666666666666?C+(a-C)*6*h:h<.5?a:h<.6666666666666666?C+(a-C)*6*(.6666666666666666-h):C}class or{constructor(a,h,A){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(a,h,A)}set(a,h,A){if(h===void 0&&A===void 0){const b=a;b&&b.isColor?this.copy(b):typeof b=="number"?this.setHex(b):typeof b=="string"&&this.setStyle(b)}else this.setRGB(a,h,A);return this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,h=Ln){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(a&255)/255,Xn.toWorkingColorSpace(this,h),this}setRGB(a,h,A,b=Xn.workingColorSpace){return this.r=a,this.g=h,this.b=A,Xn.toWorkingColorSpace(this,b),this}setHSL(a,h,A,b=Xn.workingColorSpace){if(a=Jy(a,1),h=ws(h,0,1),A=ws(A,0,1),h===0)this.r=this.g=this.b=A;else{const E=A<=.5?A*(1+h):A+h-A*h,M=2*A-E;this.r=bB(M,E,a+.3333333333333333),this.g=bB(M,E,a),this.b=bB(M,E,a-.3333333333333333)}return Xn.toWorkingColorSpace(this,b),this}setStyle(a,h=Ln){function A(E){E!==void 0&&parseFloat(E)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}let b;if(b=/^(\w+)\(([^\)]*)\)/.exec(a)){let E;const M=b[1],N=b[2];switch(M){case"rgb":case"rgba":if(E=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(N))return A(E[4]),this.setRGB(Math.min(255,parseInt(E[1],10))/255,Math.min(255,parseInt(E[2],10))/255,Math.min(255,parseInt(E[3],10))/255,h);if(E=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(N))return A(E[4]),this.setRGB(Math.min(100,parseInt(E[1],10))/100,Math.min(100,parseInt(E[2],10))/100,Math.min(100,parseInt(E[3],10))/100,h);break;case"hsl":case"hsla":if(E=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(N))return A(E[4]),this.setHSL(parseFloat(E[1])/360,parseFloat(E[2])/100,parseFloat(E[3])/100,h);break;default:console.warn("THREE.Color: Unknown color model "+a)}}else if(b=/^\#([A-Fa-f\d]+)$/.exec(a)){const E=b[1],M=E.length;if(M===3)return this.setRGB(parseInt(E.charAt(0),16)/15,parseInt(E.charAt(1),16)/15,parseInt(E.charAt(2),16)/15,h);if(M===6)return this.setHex(parseInt(E,16),h);console.warn("THREE.Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,h);return this}setColorName(a,h=Ln){const A=m9[a.toLowerCase()];return A!==void 0?this.setHex(A,h):console.warn("THREE.Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=Sd(a.r),this.g=Sd(a.g),this.b=Sd(a.b),this}copyLinearToSRGB(a){return this.r=$y(a.r),this.g=$y(a.g),this.b=$y(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=Ln){return Xn.fromWorkingColorSpace(no.copy(this),a),Math.round(ws(no.r*255,0,255))*65536+Math.round(ws(no.g*255,0,255))*256+Math.round(ws(no.b*255,0,255))}getHexString(a=Ln){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,h=Xn.workingColorSpace){Xn.fromWorkingColorSpace(no.copy(this),h);const A=no.r,b=no.g,E=no.b,M=Math.max(A,b,E),N=Math.min(A,b,E);let P,F;const z=(N+M)/2;if(N===M)P=0,F=0;else{const X=M-N;switch(F=z<=.5?X/(M+N):X/(2-M-N),M){case A:P=(b-E)/X+(b<E?6:0);break;case b:P=(E-A)/X+2;break;case E:P=(A-b)/X+4;break}P/=6}return a.h=P,a.s=F,a.l=z,a}getRGB(a,h=Xn.workingColorSpace){return Xn.fromWorkingColorSpace(no.copy(this),h),a.r=no.r,a.g=no.g,a.b=no.b,a}getStyle(a=Ln){Xn.fromWorkingColorSpace(no.copy(this),a);const h=no.r,A=no.g,b=no.b;return a!==Ln?`color(${a} ${h.toFixed(3)} ${A.toFixed(3)} ${b.toFixed(3)})`:`rgb(${Math.round(h*255)},${Math.round(A*255)},${Math.round(b*255)})`}offsetHSL(a,h,A){return this.getHSL(Id),this.setHSL(Id.h+a,Id.s+h,Id.l+A)}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,h){return this.r=a.r+h.r,this.g=a.g+h.g,this.b=a.b+h.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,h){return this.r+=(a.r-this.r)*h,this.g+=(a.g-this.g)*h,this.b+=(a.b-this.b)*h,this}lerpColors(a,h,A){return this.r=a.r+(h.r-a.r)*A,this.g=a.g+(h.g-a.g)*A,this.b=a.b+(h.b-a.b)*A,this}lerpHSL(a,h){this.getHSL(Id),a.getHSL(yE);const A=rf(Id.h,yE.h,h),b=rf(Id.s,yE.s,h),E=rf(Id.l,yE.l,h);return this.setHSL(A,b,E),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){const h=this.r,A=this.g,b=this.b,E=a.elements;return this.r=E[0]*h+E[3]*A+E[6]*b,this.g=E[1]*h+E[4]*A+E[7]*b,this.b=E[2]*h+E[5]*A+E[8]*b,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,h=0){return this.r=a[h],this.g=a[h+1],this.b=a[h+2],this}toArray(a=[],h=0){return a[h]=this.r,a[h+1]=this.g,a[h+2]=this.b,a}fromBufferAttribute(a,h){return this.r=a.getX(h),this.g=a.getY(h),this.b=a.getZ(h),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const no=new or;or.NAMES=m9;let X_e=0;class so extends Eo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:X_e++}),this.uuid=wo(),this.name="",this.type="Material",this.blending=D,this.side=S,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=xe,this.blendDst=fe,this.blendEquation=H,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new or(0,0,0),this.blendAlpha=0,this.depthFunc=hi,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Xy,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ch,this.stencilZFail=ch,this.stencilZPass=ch,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(a){this._alphaTest>0!=a>0&&this.version++,this._alphaTest=a}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(a!==void 0)for(const h in a){const A=a[h];if(A===void 0){console.warn(`THREE.Material: parameter '${h}' has value of undefined.`);continue}const b=this[h];if(b===void 0){console.warn(`THREE.Material: '${h}' is not a property of THREE.${this.type}.`);continue}b&&b.isColor?b.set(A):b&&b.isVector3&&A&&A.isVector3?b.copy(A):this[h]=A}}toJSON(a){const h=a===void 0||typeof a=="string";h&&(a={textures:{},images:{}});const A={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};A.uuid=this.uuid,A.type=this.type,this.name!==""&&(A.name=this.name),this.color&&this.color.isColor&&(A.color=this.color.getHex()),this.roughness!==void 0&&(A.roughness=this.roughness),this.metalness!==void 0&&(A.metalness=this.metalness),this.sheen!==void 0&&(A.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(A.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(A.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(A.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(A.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(A.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(A.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(A.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(A.shininess=this.shininess),this.clearcoat!==void 0&&(A.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(A.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(A.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(A.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(A.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,A.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(A.dispersion=this.dispersion),this.iridescence!==void 0&&(A.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(A.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(A.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(A.iridescenceMap=this.iridescenceMap.toJSON(a).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(A.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid),this.anisotropy!==void 0&&(A.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(A.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(A.anisotropyMap=this.anisotropyMap.toJSON(a).uuid),this.map&&this.map.isTexture&&(A.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(A.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(A.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(A.lightMap=this.lightMap.toJSON(a).uuid,A.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(A.aoMap=this.aoMap.toJSON(a).uuid,A.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(A.bumpMap=this.bumpMap.toJSON(a).uuid,A.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(A.normalMap=this.normalMap.toJSON(a).uuid,A.normalMapType=this.normalMapType,A.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(A.displacementMap=this.displacementMap.toJSON(a).uuid,A.displacementScale=this.displacementScale,A.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(A.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(A.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(A.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(A.specularMap=this.specularMap.toJSON(a).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(A.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(A.specularColorMap=this.specularColorMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(A.envMap=this.envMap.toJSON(a).uuid,this.combine!==void 0&&(A.combine=this.combine)),this.envMapRotation!==void 0&&(A.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(A.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(A.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(A.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(A.gradientMap=this.gradientMap.toJSON(a).uuid),this.transmission!==void 0&&(A.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(A.transmissionMap=this.transmissionMap.toJSON(a).uuid),this.thickness!==void 0&&(A.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(A.thicknessMap=this.thicknessMap.toJSON(a).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(A.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(A.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(A.size=this.size),this.shadowSide!==null&&(A.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(A.sizeAttenuation=this.sizeAttenuation),this.blending!==D&&(A.blending=this.blending),this.side!==S&&(A.side=this.side),this.vertexColors===!0&&(A.vertexColors=!0),this.opacity<1&&(A.opacity=this.opacity),this.transparent===!0&&(A.transparent=!0),this.blendSrc!==xe&&(A.blendSrc=this.blendSrc),this.blendDst!==fe&&(A.blendDst=this.blendDst),this.blendEquation!==H&&(A.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(A.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(A.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(A.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(A.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(A.blendAlpha=this.blendAlpha),this.depthFunc!==hi&&(A.depthFunc=this.depthFunc),this.depthTest===!1&&(A.depthTest=this.depthTest),this.depthWrite===!1&&(A.depthWrite=this.depthWrite),this.colorWrite===!1&&(A.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(A.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Xy&&(A.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(A.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(A.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ch&&(A.stencilFail=this.stencilFail),this.stencilZFail!==ch&&(A.stencilZFail=this.stencilZFail),this.stencilZPass!==ch&&(A.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(A.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(A.rotation=this.rotation),this.polygonOffset===!0&&(A.polygonOffset=!0),this.polygonOffsetFactor!==0&&(A.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(A.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(A.linewidth=this.linewidth),this.dashSize!==void 0&&(A.dashSize=this.dashSize),this.gapSize!==void 0&&(A.gapSize=this.gapSize),this.scale!==void 0&&(A.scale=this.scale),this.dithering===!0&&(A.dithering=!0),this.alphaTest>0&&(A.alphaTest=this.alphaTest),this.alphaHash===!0&&(A.alphaHash=!0),this.alphaToCoverage===!0&&(A.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(A.premultipliedAlpha=!0),this.forceSinglePass===!0&&(A.forceSinglePass=!0),this.wireframe===!0&&(A.wireframe=!0),this.wireframeLinewidth>1&&(A.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(A.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(A.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(A.flatShading=!0),this.visible===!1&&(A.visible=!1),this.toneMapped===!1&&(A.toneMapped=!1),this.fog===!1&&(A.fog=!1),Object.keys(this.userData).length>0&&(A.userData=this.userData);function b(E){const M=[];for(const N in E){const P=E[N];delete P.metadata,M.push(P)}return M}if(h){const E=b(a.textures),M=b(a.images);E.length>0&&(A.textures=E),M.length>0&&(A.images=M)}return A}clone(){return new this.constructor().copy(this)}copy(a){this.name=a.name,this.blending=a.blending,this.side=a.side,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.blendColor.copy(a.blendColor),this.blendAlpha=a.blendAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;const h=a.clippingPlanes;let A=null;if(h!==null){const b=h.length;A=new Array(b);for(let E=0;E!==b;++E)A[E]=h[E].clone()}return this.clippingPlanes=A,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.alphaHash=a.alphaHash,this.alphaToCoverage=a.alphaToCoverage,this.premultipliedAlpha=a.premultipliedAlpha,this.forceSinglePass=a.forceSinglePass,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=JSON.parse(JSON.stringify(a.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){a===!0&&this.version++}}class Bd extends so{constructor(a){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new or(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new xl,this.combine=Qe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}const Ah=Y_e();function Y_e(){const C=new ArrayBuffer(4),a=new Float32Array(C),h=new Uint32Array(C),A=new Uint32Array(512),b=new Uint32Array(512);for(let P=0;P<256;++P){const F=P-127;F<-27?(A[P]=0,A[P|256]=32768,b[P]=24,b[P|256]=24):F<-14?(A[P]=1024>>-F-14,A[P|256]=1024>>-F-14|32768,b[P]=-F-1,b[P|256]=-F-1):F<=15?(A[P]=F+15<<10,A[P|256]=F+15<<10|32768,b[P]=13,b[P|256]=13):F<128?(A[P]=31744,A[P|256]=64512,b[P]=24,b[P|256]=24):(A[P]=31744,A[P|256]=64512,b[P]=13,b[P|256]=13)}const E=new Uint32Array(2048),M=new Uint32Array(64),N=new Uint32Array(64);for(let P=1;P<1024;++P){let F=P<<13,z=0;for(;!(F&8388608);)F<<=1,z-=8388608;F&=-8388609,z+=947912704,E[P]=F|z}for(let P=1024;P<2048;++P)E[P]=939524096+(P-1024<<13);for(let P=1;P<31;++P)M[P]=P<<23;M[31]=1199570944,M[32]=2147483648;for(let P=33;P<63;++P)M[P]=2147483648+(P-32<<23);M[63]=3347054592;for(let P=1;P<64;++P)P!==32&&(N[P]=1024);return{floatView:a,uint32View:h,baseTable:A,shiftTable:b,mantissaTable:E,exponentTable:M,offsetTable:N}}function Jo(C){Math.abs(C)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),C=ws(C,-65504,65504),Ah.floatView[0]=C;const a=Ah.uint32View[0],h=a>>23&511;return Ah.baseTable[h]+((a&8388607)>>Ah.shiftTable[h])}function rv(C){const a=C>>10;return Ah.uint32View[0]=Ah.mantissaTable[Ah.offsetTable[a]+(C&1023)]+Ah.exponentTable[a],Ah.floatView[0]}const K_e={toHalfFloat:Jo,fromHalfFloat:rv},na=new He,vE=new ni;class ns{constructor(a,h,A=!1){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=a,this.itemSize=h,this.count=a!==void 0?a.length/h:0,this.normalized=A,this.usage=ef,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=St,this.version=0}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}get updateRange(){return uE("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(a){return this.usage=a,this}addUpdateRange(a,h){this.updateRanges.push({start:a,count:h})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this.gpuType=a.gpuType,this}copyAt(a,h,A){a*=this.itemSize,A*=h.itemSize;for(let b=0,E=this.itemSize;b<E;b++)this.array[a+b]=h.array[A+b];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(this.itemSize===2)for(let h=0,A=this.count;h<A;h++)vE.fromBufferAttribute(this,h),vE.applyMatrix3(a),this.setXY(h,vE.x,vE.y);else if(this.itemSize===3)for(let h=0,A=this.count;h<A;h++)na.fromBufferAttribute(this,h),na.applyMatrix3(a),this.setXYZ(h,na.x,na.y,na.z);return this}applyMatrix4(a){for(let h=0,A=this.count;h<A;h++)na.fromBufferAttribute(this,h),na.applyMatrix4(a),this.setXYZ(h,na.x,na.y,na.z);return this}applyNormalMatrix(a){for(let h=0,A=this.count;h<A;h++)na.fromBufferAttribute(this,h),na.applyNormalMatrix(a),this.setXYZ(h,na.x,na.y,na.z);return this}transformDirection(a){for(let h=0,A=this.count;h<A;h++)na.fromBufferAttribute(this,h),na.transformDirection(a),this.setXYZ(h,na.x,na.y,na.z);return this}set(a,h=0){return this.array.set(a,h),this}getComponent(a,h){let A=this.array[a*this.itemSize+h];return this.normalized&&(A=Va(A,this.array)),A}setComponent(a,h,A){return this.normalized&&(A=Yr(A,this.array)),this.array[a*this.itemSize+h]=A,this}getX(a){let h=this.array[a*this.itemSize];return this.normalized&&(h=Va(h,this.array)),h}setX(a,h){return this.normalized&&(h=Yr(h,this.array)),this.array[a*this.itemSize]=h,this}getY(a){let h=this.array[a*this.itemSize+1];return this.normalized&&(h=Va(h,this.array)),h}setY(a,h){return this.normalized&&(h=Yr(h,this.array)),this.array[a*this.itemSize+1]=h,this}getZ(a){let h=this.array[a*this.itemSize+2];return this.normalized&&(h=Va(h,this.array)),h}setZ(a,h){return this.normalized&&(h=Yr(h,this.array)),this.array[a*this.itemSize+2]=h,this}getW(a){let h=this.array[a*this.itemSize+3];return this.normalized&&(h=Va(h,this.array)),h}setW(a,h){return this.normalized&&(h=Yr(h,this.array)),this.array[a*this.itemSize+3]=h,this}setXY(a,h,A){return a*=this.itemSize,this.normalized&&(h=Yr(h,this.array),A=Yr(A,this.array)),this.array[a+0]=h,this.array[a+1]=A,this}setXYZ(a,h,A,b){return a*=this.itemSize,this.normalized&&(h=Yr(h,this.array),A=Yr(A,this.array),b=Yr(b,this.array)),this.array[a+0]=h,this.array[a+1]=A,this.array[a+2]=b,this}setXYZW(a,h,A,b,E){return a*=this.itemSize,this.normalized&&(h=Yr(h,this.array),A=Yr(A,this.array),b=Yr(b,this.array),E=Yr(E,this.array)),this.array[a+0]=h,this.array[a+1]=A,this.array[a+2]=b,this.array[a+3]=E,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(a.name=this.name),this.usage!==ef&&(a.usage=this.usage),a}}class J_e extends ns{constructor(a,h,A){super(new Int8Array(a),h,A)}}class Z_e extends ns{constructor(a,h,A){super(new Uint8Array(a),h,A)}}class $_e extends ns{constructor(a,h,A){super(new Uint8ClampedArray(a),h,A)}}class eEe extends ns{constructor(a,h,A){super(new Int16Array(a),h,A)}}class _B extends ns{constructor(a,h,A){super(new Uint16Array(a),h,A)}}class tEe extends ns{constructor(a,h,A){super(new Int32Array(a),h,A)}}class EB extends ns{constructor(a,h,A){super(new Uint32Array(a),h,A)}}class iEe extends ns{constructor(a,h,A){super(new Uint16Array(a),h,A),this.isFloat16BufferAttribute=!0}getX(a){let h=rv(this.array[a*this.itemSize]);return this.normalized&&(h=Va(h,this.array)),h}setX(a,h){return this.normalized&&(h=Yr(h,this.array)),this.array[a*this.itemSize]=Jo(h),this}getY(a){let h=rv(this.array[a*this.itemSize+1]);return this.normalized&&(h=Va(h,this.array)),h}setY(a,h){return this.normalized&&(h=Yr(h,this.array)),this.array[a*this.itemSize+1]=Jo(h),this}getZ(a){let h=rv(this.array[a*this.itemSize+2]);return this.normalized&&(h=Va(h,this.array)),h}setZ(a,h){return this.normalized&&(h=Yr(h,this.array)),this.array[a*this.itemSize+2]=Jo(h),this}getW(a){let h=rv(this.array[a*this.itemSize+3]);return this.normalized&&(h=Va(h,this.array)),h}setW(a,h){return this.normalized&&(h=Yr(h,this.array)),this.array[a*this.itemSize+3]=Jo(h),this}setXY(a,h,A){return a*=this.itemSize,this.normalized&&(h=Yr(h,this.array),A=Yr(A,this.array)),this.array[a+0]=Jo(h),this.array[a+1]=Jo(A),this}setXYZ(a,h,A,b){return a*=this.itemSize,this.normalized&&(h=Yr(h,this.array),A=Yr(A,this.array),b=Yr(b,this.array)),this.array[a+0]=Jo(h),this.array[a+1]=Jo(A),this.array[a+2]=Jo(b),this}setXYZW(a,h,A,b,E){return a*=this.itemSize,this.normalized&&(h=Yr(h,this.array),A=Yr(A,this.array),b=Yr(b,this.array),E=Yr(E,this.array)),this.array[a+0]=Jo(h),this.array[a+1]=Jo(A),this.array[a+2]=Jo(b),this.array[a+3]=Jo(E),this}}class vr extends ns{constructor(a,h,A){super(new Float32Array(a),h,A)}}let rEe=0;const kl=new fr,wB=new Vn,e0=new He,_l=new Is,nv=new Is,Ra=new He;class hn extends Eo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:rEe++}),this.uuid=wo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(a){return Array.isArray(a)?this.index=new(oE(a)?EB:_B)(a,1):this.index=a,this}getAttribute(a){return this.attributes[a]}setAttribute(a,h){return this.attributes[a]=h,this}deleteAttribute(a){return delete this.attributes[a],this}hasAttribute(a){return this.attributes[a]!==void 0}addGroup(a,h,A=0){this.groups.push({start:a,count:h,materialIndex:A})}clearGroups(){this.groups=[]}setDrawRange(a,h){this.drawRange.start=a,this.drawRange.count=h}applyMatrix4(a){const h=this.attributes.position;h!==void 0&&(h.applyMatrix4(a),h.needsUpdate=!0);const A=this.attributes.normal;if(A!==void 0){const E=new qr().getNormalMatrix(a);A.applyNormalMatrix(E),A.needsUpdate=!0}const b=this.attributes.tangent;return b!==void 0&&(b.transformDirection(a),b.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(a){return kl.makeRotationFromQuaternion(a),this.applyMatrix4(kl),this}rotateX(a){return kl.makeRotationX(a),this.applyMatrix4(kl),this}rotateY(a){return kl.makeRotationY(a),this.applyMatrix4(kl),this}rotateZ(a){return kl.makeRotationZ(a),this.applyMatrix4(kl),this}translate(a,h,A){return kl.makeTranslation(a,h,A),this.applyMatrix4(kl),this}scale(a,h,A){return kl.makeScale(a,h,A),this.applyMatrix4(kl),this}lookAt(a){return wB.lookAt(a),wB.updateMatrix(),this.applyMatrix4(wB.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(e0).negate(),this.translate(e0.x,e0.y,e0.z),this}setFromPoints(a){const h=[];for(let A=0,b=a.length;A<b;A++){const E=a[A];h.push(E.x,E.y,E.z||0)}return this.setAttribute("position",new vr(h,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Is);const a=this.attributes.position,h=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new He(-1/0,-1/0,-1/0),new He(1/0,1/0,1/0));return}if(a!==void 0){if(this.boundingBox.setFromBufferAttribute(a),h)for(let A=0,b=h.length;A<b;A++){const E=h[A];_l.setFromBufferAttribute(E),this.morphTargetsRelative?(Ra.addVectors(this.boundingBox.min,_l.min),this.boundingBox.expandByPoint(Ra),Ra.addVectors(this.boundingBox.max,_l.max),this.boundingBox.expandByPoint(Ra)):(this.boundingBox.expandByPoint(_l.min),this.boundingBox.expandByPoint(_l.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new da);const a=this.attributes.position,h=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new He,1/0);return}if(a){const A=this.boundingSphere.center;if(_l.setFromBufferAttribute(a),h)for(let E=0,M=h.length;E<M;E++){const N=h[E];nv.setFromBufferAttribute(N),this.morphTargetsRelative?(Ra.addVectors(_l.min,nv.min),_l.expandByPoint(Ra),Ra.addVectors(_l.max,nv.max),_l.expandByPoint(Ra)):(_l.expandByPoint(nv.min),_l.expandByPoint(nv.max))}_l.getCenter(A);let b=0;for(let E=0,M=a.count;E<M;E++)Ra.fromBufferAttribute(a,E),b=Math.max(b,A.distanceToSquared(Ra));if(h)for(let E=0,M=h.length;E<M;E++){const N=h[E],P=this.morphTargetsRelative;for(let F=0,z=N.count;F<z;F++)Ra.fromBufferAttribute(N,F),P&&(e0.fromBufferAttribute(a,F),Ra.add(e0)),b=Math.max(b,A.distanceToSquared(Ra))}this.boundingSphere.radius=Math.sqrt(b),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const a=this.index,h=this.attributes;if(a===null||h.position===void 0||h.normal===void 0||h.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const A=h.position,b=h.normal,E=h.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ns(new Float32Array(4*A.count),4));const M=this.getAttribute("tangent"),N=[],P=[];for(let it=0;it<A.count;it++)N[it]=new He,P[it]=new He;const F=new He,z=new He,X=new He,q=new ni,K=new ni,te=new ni,oe=new He,ne=new He;function ee(it,ze,Oe){F.fromBufferAttribute(A,it),z.fromBufferAttribute(A,ze),X.fromBufferAttribute(A,Oe),q.fromBufferAttribute(E,it),K.fromBufferAttribute(E,ze),te.fromBufferAttribute(E,Oe),z.sub(F),X.sub(F),K.sub(q),te.sub(q);const rt=1/(K.x*te.y-te.x*K.y);isFinite(rt)&&(oe.copy(z).multiplyScalar(te.y).addScaledVector(X,-K.y).multiplyScalar(rt),ne.copy(X).multiplyScalar(K.x).addScaledVector(z,-te.x).multiplyScalar(rt),N[it].add(oe),N[ze].add(oe),N[Oe].add(oe),P[it].add(ne),P[ze].add(ne),P[Oe].add(ne))}let Me=this.groups;Me.length===0&&(Me=[{start:0,count:a.count}]);for(let it=0,ze=Me.length;it<ze;++it){const Oe=Me[it],rt=Oe.start,mt=Oe.count;for(let pt=rt,Tt=rt+mt;pt<Tt;pt+=3)ee(a.getX(pt+0),a.getX(pt+1),a.getX(pt+2))}const we=new He,_e=new He,nt=new He,qe=new He;function Je(it){nt.fromBufferAttribute(b,it),qe.copy(nt);const ze=N[it];we.copy(ze),we.sub(nt.multiplyScalar(nt.dot(ze))).normalize(),_e.crossVectors(qe,ze);const Oe=_e.dot(P[it])<0?-1:1;M.setXYZW(it,we.x,we.y,we.z,Oe)}for(let it=0,ze=Me.length;it<ze;++it){const Oe=Me[it],rt=Oe.start,mt=Oe.count;for(let pt=rt,Tt=rt+mt;pt<Tt;pt+=3)Je(a.getX(pt+0)),Je(a.getX(pt+1)),Je(a.getX(pt+2))}}computeVertexNormals(){const a=this.index,h=this.getAttribute("position");if(h!==void 0){let A=this.getAttribute("normal");if(A===void 0)A=new ns(new Float32Array(h.count*3),3),this.setAttribute("normal",A);else for(let q=0,K=A.count;q<K;q++)A.setXYZ(q,0,0,0);const b=new He,E=new He,M=new He,N=new He,P=new He,F=new He,z=new He,X=new He;if(a)for(let q=0,K=a.count;q<K;q+=3){const te=a.getX(q+0),oe=a.getX(q+1),ne=a.getX(q+2);b.fromBufferAttribute(h,te),E.fromBufferAttribute(h,oe),M.fromBufferAttribute(h,ne),z.subVectors(M,E),X.subVectors(b,E),z.cross(X),N.fromBufferAttribute(A,te),P.fromBufferAttribute(A,oe),F.fromBufferAttribute(A,ne),N.add(z),P.add(z),F.add(z),A.setXYZ(te,N.x,N.y,N.z),A.setXYZ(oe,P.x,P.y,P.z),A.setXYZ(ne,F.x,F.y,F.z)}else for(let q=0,K=h.count;q<K;q+=3)b.fromBufferAttribute(h,q+0),E.fromBufferAttribute(h,q+1),M.fromBufferAttribute(h,q+2),z.subVectors(M,E),X.subVectors(b,E),z.cross(X),A.setXYZ(q+0,z.x,z.y,z.z),A.setXYZ(q+1,z.x,z.y,z.z),A.setXYZ(q+2,z.x,z.y,z.z);this.normalizeNormals(),A.needsUpdate=!0}}normalizeNormals(){const a=this.attributes.normal;for(let h=0,A=a.count;h<A;h++)Ra.fromBufferAttribute(a,h),Ra.normalize(),a.setXYZ(h,Ra.x,Ra.y,Ra.z)}toNonIndexed(){function a(N,P){const F=N.array,z=N.itemSize,X=N.normalized,q=new F.constructor(P.length*z);let K=0,te=0;for(let oe=0,ne=P.length;oe<ne;oe++){N.isInterleavedBufferAttribute?K=P[oe]*N.data.stride+N.offset:K=P[oe]*z;for(let ee=0;ee<z;ee++)q[te++]=F[K++]}return new ns(q,z,X)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const h=new hn,A=this.index.array,b=this.attributes;for(const N in b){const P=b[N],F=a(P,A);h.setAttribute(N,F)}const E=this.morphAttributes;for(const N in E){const P=[],F=E[N];for(let z=0,X=F.length;z<X;z++){const q=F[z],K=a(q,A);P.push(K)}h.morphAttributes[N]=P}h.morphTargetsRelative=this.morphTargetsRelative;const M=this.groups;for(let N=0,P=M.length;N<P;N++){const F=M[N];h.addGroup(F.start,F.count,F.materialIndex)}return h}toJSON(){const a={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),this.parameters!==void 0){const P=this.parameters;for(const F in P)P[F]!==void 0&&(a[F]=P[F]);return a}a.data={attributes:{}};const h=this.index;h!==null&&(a.data.index={type:h.array.constructor.name,array:Array.prototype.slice.call(h.array)});const A=this.attributes;for(const P in A){const F=A[P];a.data.attributes[P]=F.toJSON(a.data)}const b={};let E=!1;for(const P in this.morphAttributes){const F=this.morphAttributes[P],z=[];for(let X=0,q=F.length;X<q;X++){const K=F[X];z.push(K.toJSON(a.data))}z.length>0&&(b[P]=z,E=!0)}E&&(a.data.morphAttributes=b,a.data.morphTargetsRelative=this.morphTargetsRelative);const M=this.groups;M.length>0&&(a.data.groups=JSON.parse(JSON.stringify(M)));const N=this.boundingSphere;return N!==null&&(a.data.boundingSphere={center:N.center.toArray(),radius:N.radius}),a}clone(){return new this.constructor().copy(this)}copy(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const h={};this.name=a.name;const A=a.index;A!==null&&this.setIndex(A.clone(h));const b=a.attributes;for(const F in b){const z=b[F];this.setAttribute(F,z.clone(h))}const E=a.morphAttributes;for(const F in E){const z=[],X=E[F];for(let q=0,K=X.length;q<K;q++)z.push(X[q].clone(h));this.morphAttributes[F]=z}this.morphTargetsRelative=a.morphTargetsRelative;const M=a.groups;for(let F=0,z=M.length;F<z;F++){const X=M[F];this.addGroup(X.start,X.count,X.materialIndex)}const N=a.boundingBox;N!==null&&(this.boundingBox=N.clone());const P=a.boundingSphere;return P!==null&&(this.boundingSphere=P.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const g9=new fr,sf=new pa,xE=new da,A9=new He,t0=new He,i0=new He,r0=new He,CB=new He,bE=new He,_E=new ni,EE=new ni,wE=new ni,y9=new He,v9=new He,x9=new He,CE=new He,SE=new He;class sa extends Vn{constructor(a=new hn,h=new Bd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=a,this.material=h,this.updateMorphTargets()}copy(a,h){return super.copy(a,h),a.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),a.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}updateMorphTargets(){const a=this.geometry.morphAttributes,h=Object.keys(a);if(h.length>0){const A=a[h[0]];if(A!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let b=0,E=A.length;b<E;b++){const M=A[b].name||String(b);this.morphTargetInfluences.push(0),this.morphTargetDictionary[M]=b}}}}getVertexPosition(a,h){const A=this.geometry,b=A.attributes.position,E=A.morphAttributes.position,M=A.morphTargetsRelative;h.fromBufferAttribute(b,a);const N=this.morphTargetInfluences;if(E&&N){bE.set(0,0,0);for(let P=0,F=E.length;P<F;P++){const z=N[P],X=E[P];z!==0&&(CB.fromBufferAttribute(X,a),M?bE.addScaledVector(CB,z):bE.addScaledVector(CB.sub(h),z))}h.add(bE)}return h}raycast(a,h){const A=this.geometry,b=this.material,E=this.matrixWorld;b!==void 0&&(A.boundingSphere===null&&A.computeBoundingSphere(),xE.copy(A.boundingSphere),xE.applyMatrix4(E),sf.copy(a.ray).recast(a.near),!(xE.containsPoint(sf.origin)===!1&&(sf.intersectSphere(xE,A9)===null||sf.origin.distanceToSquared(A9)>(a.far-a.near)**2))&&(g9.copy(E).invert(),sf.copy(a.ray).applyMatrix4(g9),!(A.boundingBox!==null&&sf.intersectsBox(A.boundingBox)===!1)&&this._computeIntersections(a,h,sf)))}_computeIntersections(a,h,A){let b;const E=this.geometry,M=this.material,N=E.index,P=E.attributes.position,F=E.attributes.uv,z=E.attributes.uv1,X=E.attributes.normal,q=E.groups,K=E.drawRange;if(N!==null)if(Array.isArray(M))for(let te=0,oe=q.length;te<oe;te++){const ne=q[te],ee=M[ne.materialIndex],Me=Math.max(ne.start,K.start),we=Math.min(N.count,Math.min(ne.start+ne.count,K.start+K.count));for(let _e=Me,nt=we;_e<nt;_e+=3){const qe=N.getX(_e),Je=N.getX(_e+1),it=N.getX(_e+2);b=TE(this,ee,a,A,F,z,X,qe,Je,it),b&&(b.faceIndex=Math.floor(_e/3),b.face.materialIndex=ne.materialIndex,h.push(b))}}else{const te=Math.max(0,K.start),oe=Math.min(N.count,K.start+K.count);for(let ne=te,ee=oe;ne<ee;ne+=3){const Me=N.getX(ne),we=N.getX(ne+1),_e=N.getX(ne+2);b=TE(this,M,a,A,F,z,X,Me,we,_e),b&&(b.faceIndex=Math.floor(ne/3),h.push(b))}}else if(P!==void 0)if(Array.isArray(M))for(let te=0,oe=q.length;te<oe;te++){const ne=q[te],ee=M[ne.materialIndex],Me=Math.max(ne.start,K.start),we=Math.min(P.count,Math.min(ne.start+ne.count,K.start+K.count));for(let _e=Me,nt=we;_e<nt;_e+=3){const qe=_e,Je=_e+1,it=_e+2;b=TE(this,ee,a,A,F,z,X,qe,Je,it),b&&(b.faceIndex=Math.floor(_e/3),b.face.materialIndex=ne.materialIndex,h.push(b))}}else{const te=Math.max(0,K.start),oe=Math.min(P.count,K.start+K.count);for(let ne=te,ee=oe;ne<ee;ne+=3){const Me=ne,we=ne+1,_e=ne+2;b=TE(this,M,a,A,F,z,X,Me,we,_e),b&&(b.faceIndex=Math.floor(ne/3),h.push(b))}}}}function nEe(C,a,h,A,b,E,M,N){let P;if(a.side===R?P=A.intersectTriangle(M,E,b,!0,N):P=A.intersectTriangle(b,E,M,a.side===S,N),P===null)return null;SE.copy(N),SE.applyMatrix4(C.matrixWorld);const F=h.ray.origin.distanceTo(SE);return F<h.near||F>h.far?null:{distance:F,point:SE.clone(),object:C}}function TE(C,a,h,A,b,E,M,N,P,F){C.getVertexPosition(N,t0),C.getVertexPosition(P,i0),C.getVertexPosition(F,r0);const z=nEe(C,a,h,A,t0,i0,r0,CE);if(z){b&&(_E.fromBufferAttribute(b,N),EE.fromBufferAttribute(b,P),wE.fromBufferAttribute(b,F),z.uv=bl.getInterpolation(CE,t0,i0,r0,_E,EE,wE,new ni)),E&&(_E.fromBufferAttribute(E,N),EE.fromBufferAttribute(E,P),wE.fromBufferAttribute(E,F),z.uv1=bl.getInterpolation(CE,t0,i0,r0,_E,EE,wE,new ni)),M&&(y9.fromBufferAttribute(M,N),v9.fromBufferAttribute(M,P),x9.fromBufferAttribute(M,F),z.normal=bl.getInterpolation(CE,t0,i0,r0,y9,v9,x9,new He),z.normal.dot(A.direction)>0&&z.normal.multiplyScalar(-1));const X={a:N,b:P,c:F,normal:new He,materialIndex:0};bl.getNormal(t0,i0,r0,X.normal),z.face=X}return z}class af extends hn{constructor(a=1,h=1,A=1,b=1,E=1,M=1){super(),this.type="BoxGeometry",this.parameters={width:a,height:h,depth:A,widthSegments:b,heightSegments:E,depthSegments:M};const N=this;b=Math.floor(b),E=Math.floor(E),M=Math.floor(M);const P=[],F=[],z=[],X=[];let q=0,K=0;te("z","y","x",-1,-1,A,h,a,M,E,0),te("z","y","x",1,-1,A,h,-a,M,E,1),te("x","z","y",1,1,a,A,h,b,M,2),te("x","z","y",1,-1,a,A,-h,b,M,3),te("x","y","z",1,-1,a,h,A,b,E,4),te("x","y","z",-1,-1,a,h,-A,b,E,5),this.setIndex(P),this.setAttribute("position",new vr(F,3)),this.setAttribute("normal",new vr(z,3)),this.setAttribute("uv",new vr(X,2));function te(oe,ne,ee,Me,we,_e,nt,qe,Je,it,ze){const Oe=_e/Je,rt=nt/it,mt=_e/2,pt=nt/2,Tt=qe/2,Pt=Je+1,ui=it+1;let Li=0,Ft=0;const gi=new He;for(let Di=0;Di<ui;Di++){const kr=Di*rt-pt;for(let xn=0;xn<Pt;xn++){const es=xn*Oe-mt;gi[oe]=es*Me,gi[ne]=kr*we,gi[ee]=Tt,F.push(gi.x,gi.y,gi.z),gi[oe]=0,gi[ne]=0,gi[ee]=qe>0?1:-1,z.push(gi.x,gi.y,gi.z),X.push(xn/Je),X.push(1-Di/it),Li+=1}}for(let Di=0;Di<it;Di++)for(let kr=0;kr<Je;kr++){const xn=q+kr+Pt*Di,es=q+kr+Pt*(Di+1),hs=q+(kr+1)+Pt*(Di+1),Un=q+(kr+1)+Pt*Di;P.push(xn,es,Un),P.push(es,hs,Un),Ft+=6}N.addGroup(K,Ft,ze),K+=Ft,q+=Li}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new af(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments)}}function n0(C){const a={};for(const h in C){a[h]={};for(const A in C[h]){const b=C[h][A];b&&(b.isColor||b.isMatrix3||b.isMatrix4||b.isVector2||b.isVector3||b.isVector4||b.isTexture||b.isQuaternion)?b.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),a[h][A]=null):a[h][A]=b.clone():Array.isArray(b)?a[h][A]=b.slice():a[h][A]=b}}return a}function So(C){const a={};for(let h=0;h<C.length;h++){const A=n0(C[h]);for(const b in A)a[b]=A[b]}return a}function sEe(C){const a=[];for(let h=0;h<C.length;h++)a.push(C[h].clone());return a}function b9(C){const a=C.getRenderTarget();return a===null?C.outputColorSpace:a.isXRRenderTarget===!0?a.texture.colorSpace:Xn.workingColorSpace}const _9={clone:n0,merge:So};var aEe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,oEe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Cc extends so{constructor(a){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=aEe,this.fragmentShader=oEe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,a!==void 0&&this.setValues(a)}copy(a){return super.copy(a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=n0(a.uniforms),this.uniformsGroups=sEe(a.uniformsGroups),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.fog=a.fog,this.lights=a.lights,this.clipping=a.clipping,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this}toJSON(a){const h=super.toJSON(a);h.glslVersion=this.glslVersion,h.uniforms={};for(const b in this.uniforms){const E=this.uniforms[b].value;E&&E.isTexture?h.uniforms[b]={type:"t",value:E.toJSON(a).uuid}:E&&E.isColor?h.uniforms[b]={type:"c",value:E.getHex()}:E&&E.isVector2?h.uniforms[b]={type:"v2",value:E.toArray()}:E&&E.isVector3?h.uniforms[b]={type:"v3",value:E.toArray()}:E&&E.isVector4?h.uniforms[b]={type:"v4",value:E.toArray()}:E&&E.isMatrix3?h.uniforms[b]={type:"m3",value:E.toArray()}:E&&E.isMatrix4?h.uniforms[b]={type:"m4",value:E.toArray()}:h.uniforms[b]={value:E}}Object.keys(this.defines).length>0&&(h.defines=this.defines),h.vertexShader=this.vertexShader,h.fragmentShader=this.fragmentShader,h.lights=this.lights,h.clipping=this.clipping;const A={};for(const b in this.extensions)this.extensions[b]===!0&&(A[b]=!0);return Object.keys(A).length>0&&(h.extensions=A),h}}class ME extends Vn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new fr,this.projectionMatrix=new fr,this.projectionMatrixInverse=new fr,this.coordinateSystem=Pl}copy(a,h){return super.copy(a,h),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this.coordinateSystem=a.coordinateSystem,this}getWorldDirection(a){return super.getWorldDirection(a).negate()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,h){super.updateWorldMatrix(a,h),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Nd=new He,E9=new ni,w9=new ni;class fa extends ME{constructor(a=50,h=1,A=.1,b=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=A,this.far=b,this.focus=10,this.aspect=h,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(a,h){return super.copy(a,h),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=a.view===null?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this}setFocalLength(a){const h=.5*this.getFilmHeight()/a;this.fov=wd*2*Math.atan(h),this.updateProjectionMatrix()}getFocalLength(){const a=Math.tan(uh*.5*this.fov);return .5*this.getFilmHeight()/a}getEffectiveFOV(){return wd*2*Math.atan(Math.tan(uh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(a,h,A){Nd.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),h.set(Nd.x,Nd.y).multiplyScalar(-a/Nd.z),Nd.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),A.set(Nd.x,Nd.y).multiplyScalar(-a/Nd.z)}getViewSize(a,h){return this.getViewBounds(a,E9,w9),h.subVectors(w9,E9)}setViewOffset(a,h,A,b,E,M){this.aspect=a/h,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=h,this.view.offsetX=A,this.view.offsetY=b,this.view.width=E,this.view.height=M,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=this.near;let h=a*Math.tan(uh*.5*this.fov)/this.zoom,A=2*h,b=this.aspect*A,E=-.5*b;const M=this.view;if(this.view!==null&&this.view.enabled){const P=M.fullWidth,F=M.fullHeight;E+=M.offsetX*b/P,h-=M.offsetY*A/F,b*=M.width/P,A*=M.height/F}const N=this.filmOffset;N!==0&&(E+=a*N/this.getFilmWidth()),this.projectionMatrix.makePerspective(E,E+b,h,h-A,a,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const h=super.toJSON(a);return h.object.fov=this.fov,h.object.zoom=this.zoom,h.object.near=this.near,h.object.far=this.far,h.object.focus=this.focus,h.object.aspect=this.aspect,this.view!==null&&(h.object.view=Object.assign({},this.view)),h.object.filmGauge=this.filmGauge,h.object.filmOffset=this.filmOffset,h}}const s0=-90,a0=1;class C9 extends Vn{constructor(a,h,A){super(),this.type="CubeCamera",this.renderTarget=A,this.coordinateSystem=null,this.activeMipmapLevel=0;const b=new fa(s0,a0,a,h);b.layers=this.layers,this.add(b);const E=new fa(s0,a0,a,h);E.layers=this.layers,this.add(E);const M=new fa(s0,a0,a,h);M.layers=this.layers,this.add(M);const N=new fa(s0,a0,a,h);N.layers=this.layers,this.add(N);const P=new fa(s0,a0,a,h);P.layers=this.layers,this.add(P);const F=new fa(s0,a0,a,h);F.layers=this.layers,this.add(F)}updateCoordinateSystem(){const a=this.coordinateSystem,h=this.children.concat(),[A,b,E,M,N,P]=h;for(const F of h)this.remove(F);if(a===Pl)A.up.set(0,1,0),A.lookAt(1,0,0),b.up.set(0,1,0),b.lookAt(-1,0,0),E.up.set(0,0,-1),E.lookAt(0,1,0),M.up.set(0,0,1),M.lookAt(0,-1,0),N.up.set(0,1,0),N.lookAt(0,0,1),P.up.set(0,1,0),P.lookAt(0,0,-1);else if(a===tf)A.up.set(0,-1,0),A.lookAt(-1,0,0),b.up.set(0,-1,0),b.lookAt(1,0,0),E.up.set(0,0,1),E.lookAt(0,1,0),M.up.set(0,0,-1),M.lookAt(0,-1,0),N.up.set(0,-1,0),N.lookAt(0,0,1),P.up.set(0,-1,0),P.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+a);for(const F of h)this.add(F),F.updateMatrixWorld()}update(a,h){this.parent===null&&this.updateMatrixWorld();const{renderTarget:A,activeMipmapLevel:b}=this;this.coordinateSystem!==a.coordinateSystem&&(this.coordinateSystem=a.coordinateSystem,this.updateCoordinateSystem());const[E,M,N,P,F,z]=this.children,X=a.getRenderTarget(),q=a.getActiveCubeFace(),K=a.getActiveMipmapLevel(),te=a.xr.enabled;a.xr.enabled=!1;const oe=A.texture.generateMipmaps;A.texture.generateMipmaps=!1,a.setRenderTarget(A,0,b),a.render(h,E),a.setRenderTarget(A,1,b),a.render(h,M),a.setRenderTarget(A,2,b),a.render(h,N),a.setRenderTarget(A,3,b),a.render(h,P),a.setRenderTarget(A,4,b),a.render(h,F),A.texture.generateMipmaps=oe,a.setRenderTarget(A,5,b),a.render(h,z),a.setRenderTarget(X,q,K),a.xr.enabled=te,A.texture.needsPMREMUpdate=!0}}class sv extends us{constructor(a,h,A,b,E,M,N,P,F,z){a=a!==void 0?a:[],h=h!==void 0?h:k,super(a,h,A,b,E,M,N,P,F,z),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(a){this.image=a}}class S9 extends Xo{constructor(a=1,h={}){super(a,a,h),this.isWebGLCubeRenderTarget=!0;const A={width:a,height:a,depth:1},b=[A,A,A,A,A,A];this.texture=new sv(b,h.mapping,h.wrapS,h.wrapT,h.magFilter,h.minFilter,h.format,h.type,h.anisotropy,h.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=h.generateMipmaps!==void 0?h.generateMipmaps:!1,this.texture.minFilter=h.minFilter!==void 0?h.minFilter:Pi}fromEquirectangularTexture(a,h){this.texture.type=h.type,this.texture.colorSpace=h.colorSpace,this.texture.generateMipmaps=h.generateMipmaps,this.texture.minFilter=h.minFilter,this.texture.magFilter=h.magFilter;const A={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},b=new af(5,5,5),E=new Cc({name:"CubemapFromEquirect",uniforms:n0(A.uniforms),vertexShader:A.vertexShader,fragmentShader:A.fragmentShader,side:R,blending:I});E.uniforms.tEquirect.value=h;const M=new sa(b,E),N=h.minFilter;return h.minFilter===tn&&(h.minFilter=Pi),new C9(1,10,this).update(a,M),h.minFilter=N,M.geometry.dispose(),M.material.dispose(),this}clear(a,h,A,b){const E=a.getRenderTarget();for(let M=0;M<6;M++)a.setRenderTarget(this,M),a.clear(h,A,b);a.setRenderTarget(E)}}const SB=new He,lEe=new He,cEe=new qr;class Ld{constructor(a=new He(1,0,0),h=0){this.isPlane=!0,this.normal=a,this.constant=h}set(a,h){return this.normal.copy(a),this.constant=h,this}setComponents(a,h,A,b){return this.normal.set(a,h,A),this.constant=b,this}setFromNormalAndCoplanarPoint(a,h){return this.normal.copy(a),this.constant=-h.dot(this.normal),this}setFromCoplanarPoints(a,h,A){const b=SB.subVectors(A,h).cross(lEe.subVectors(a,h)).normalize();return this.setFromNormalAndCoplanarPoint(b,a),this}copy(a){return this.normal.copy(a.normal),this.constant=a.constant,this}normalize(){const a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,h){return h.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,h){const A=a.delta(SB),b=this.normal.dot(A);if(b===0)return this.distanceToPoint(a.start)===0?h.copy(a.start):null;const E=-(a.start.dot(this.normal)+this.constant)/b;return E<0||E>1?null:h.copy(a.start).addScaledVector(A,E)}intersectsLine(a){const h=this.distanceToPoint(a.start),A=this.distanceToPoint(a.end);return h<0&&A>0||A<0&&h>0}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,h){const A=h||cEe.getNormalMatrix(a),b=this.coplanarPoint(SB).applyMatrix4(a),E=this.normal.applyMatrix3(A).normalize();return this.constant=-b.dot(E),this}translate(a){return this.constant-=a.dot(this.normal),this}equals(a){return a.normal.equals(this.normal)&&a.constant===this.constant}clone(){return new this.constructor().copy(this)}}const of=new da,RE=new He;class av{constructor(a=new Ld,h=new Ld,A=new Ld,b=new Ld,E=new Ld,M=new Ld){this.planes=[a,h,A,b,E,M]}set(a,h,A,b,E,M){const N=this.planes;return N[0].copy(a),N[1].copy(h),N[2].copy(A),N[3].copy(b),N[4].copy(E),N[5].copy(M),this}copy(a){const h=this.planes;for(let A=0;A<6;A++)h[A].copy(a.planes[A]);return this}setFromProjectionMatrix(a,h=Pl){const A=this.planes,b=a.elements,E=b[0],M=b[1],N=b[2],P=b[3],F=b[4],z=b[5],X=b[6],q=b[7],K=b[8],te=b[9],oe=b[10],ne=b[11],ee=b[12],Me=b[13],we=b[14],_e=b[15];if(A[0].setComponents(P-E,q-F,ne-K,_e-ee).normalize(),A[1].setComponents(P+E,q+F,ne+K,_e+ee).normalize(),A[2].setComponents(P+M,q+z,ne+te,_e+Me).normalize(),A[3].setComponents(P-M,q-z,ne-te,_e-Me).normalize(),A[4].setComponents(P-N,q-X,ne-oe,_e-we).normalize(),h===Pl)A[5].setComponents(P+N,q+X,ne+oe,_e+we).normalize();else if(h===tf)A[5].setComponents(N,X,oe,we).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+h);return this}intersectsObject(a){if(a.boundingSphere!==void 0)a.boundingSphere===null&&a.computeBoundingSphere(),of.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{const h=a.geometry;h.boundingSphere===null&&h.computeBoundingSphere(),of.copy(h.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(of)}intersectsSprite(a){return of.center.set(0,0,0),of.radius=.7071067811865476,of.applyMatrix4(a.matrixWorld),this.intersectsSphere(of)}intersectsSphere(a){const h=this.planes,A=a.center,b=-a.radius;for(let E=0;E<6;E++)if(h[E].distanceToPoint(A)<b)return!1;return!0}intersectsBox(a){const h=this.planes;for(let A=0;A<6;A++){const b=h[A];if(RE.x=b.normal.x>0?a.max.x:a.min.x,RE.y=b.normal.y>0?a.max.y:a.min.y,RE.z=b.normal.z>0?a.max.z:a.min.z,b.distanceToPoint(RE)<0)return!1}return!0}containsPoint(a){const h=this.planes;for(let A=0;A<6;A++)if(h[A].distanceToPoint(a)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function TB(){let C=null,a=!1,h=null,A=null;function b(E,M){h(E,M),A=C.requestAnimationFrame(b)}return{start:function(){a!==!0&&h!==null&&(A=C.requestAnimationFrame(b),a=!0)},stop:function(){C.cancelAnimationFrame(A),a=!1},setAnimationLoop:function(E){h=E},setContext:function(E){C=E}}}function uEe(C){const a=new WeakMap;function h(N,P){const F=N.array,z=N.usage,X=F.byteLength,q=C.createBuffer();C.bindBuffer(P,q),C.bufferData(P,F,z),N.onUploadCallback();let K;if(F instanceof Float32Array)K=C.FLOAT;else if(F instanceof Uint16Array)N.isFloat16BufferAttribute?K=C.HALF_FLOAT:K=C.UNSIGNED_SHORT;else if(F instanceof Int16Array)K=C.SHORT;else if(F instanceof Uint32Array)K=C.UNSIGNED_INT;else if(F instanceof Int32Array)K=C.INT;else if(F instanceof Int8Array)K=C.BYTE;else if(F instanceof Uint8Array)K=C.UNSIGNED_BYTE;else if(F instanceof Uint8ClampedArray)K=C.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+F);return{buffer:q,type:K,bytesPerElement:F.BYTES_PER_ELEMENT,version:N.version,size:X}}function A(N,P,F){const z=P.array,X=P._updateRange,q=P.updateRanges;if(C.bindBuffer(F,N),X.count===-1&&q.length===0&&C.bufferSubData(F,0,z),q.length!==0){for(let K=0,te=q.length;K<te;K++){const oe=q[K];C.bufferSubData(F,oe.start*z.BYTES_PER_ELEMENT,z,oe.start,oe.count)}P.clearUpdateRanges()}X.count!==-1&&(C.bufferSubData(F,X.offset*z.BYTES_PER_ELEMENT,z,X.offset,X.count),X.count=-1),P.onUploadCallback()}function b(N){return N.isInterleavedBufferAttribute&&(N=N.data),a.get(N)}function E(N){N.isInterleavedBufferAttribute&&(N=N.data);const P=a.get(N);P&&(C.deleteBuffer(P.buffer),a.delete(N))}function M(N,P){if(N.isGLBufferAttribute){const z=a.get(N);(!z||z.version<N.version)&&a.set(N,{buffer:N.buffer,type:N.type,bytesPerElement:N.elementSize,version:N.version});return}N.isInterleavedBufferAttribute&&(N=N.data);const F=a.get(N);if(F===void 0)a.set(N,h(N,P));else if(F.version<N.version){if(F.size!==N.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");A(F.buffer,N,P),F.version=N.version}}return{get:b,remove:E,update:M}}class o0 extends hn{constructor(a=1,h=1,A=1,b=1){super(),this.type="PlaneGeometry",this.parameters={width:a,height:h,widthSegments:A,heightSegments:b};const E=a/2,M=h/2,N=Math.floor(A),P=Math.floor(b),F=N+1,z=P+1,X=a/N,q=h/P,K=[],te=[],oe=[],ne=[];for(let ee=0;ee<z;ee++){const Me=ee*q-M;for(let we=0;we<F;we++){const _e=we*X-E;te.push(_e,-Me,0),oe.push(0,0,1),ne.push(we/N),ne.push(1-ee/P)}}for(let ee=0;ee<P;ee++)for(let Me=0;Me<N;Me++){const we=Me+F*ee,_e=Me+F*(ee+1),nt=Me+1+F*(ee+1),qe=Me+1+F*ee;K.push(we,_e,qe),K.push(_e,nt,qe)}this.setIndex(K),this.setAttribute("position",new vr(te,3)),this.setAttribute("normal",new vr(oe,3)),this.setAttribute("uv",new vr(ne,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new o0(a.width,a.height,a.widthSegments,a.heightSegments)}}var hEe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,dEe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,pEe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,fEe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,mEe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,gEe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,AEe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,yEe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,vEe=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,xEe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,bEe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,_Ee=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,EEe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,wEe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,CEe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,SEe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,TEe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,MEe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,REe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,IEe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,BEe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,NEe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,LEe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,DEe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,OEe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,PEe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,FEe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,kEe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,UEe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,zEe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,jEe="gl_FragColor = linearToOutputTexel( gl_FragColor );",VEe=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,GEe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,HEe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,WEe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,QEe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,qEe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,XEe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,YEe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,KEe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,JEe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,ZEe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,$Ee=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,ewe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,twe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,iwe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,rwe=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,nwe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,swe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,awe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,owe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lwe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,cwe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,uwe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,hwe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,dwe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,pwe=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,fwe=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,mwe=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,gwe=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Awe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,ywe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,vwe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,xwe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,bwe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,_we=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Ewe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,wwe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Cwe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Swe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Twe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Mwe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Rwe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Iwe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Bwe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Nwe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Lwe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Dwe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Owe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Pwe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Fwe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,kwe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Uwe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,zwe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,jwe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Vwe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Gwe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Hwe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Wwe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Qwe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,qwe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Xwe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Ywe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Kwe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Jwe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Zwe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,$we=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,e2e=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,t2e=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,i2e=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,r2e=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,n2e=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,s2e=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,a2e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,o2e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,l2e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,c2e=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const sn={alphahash_fragment:hEe,alphahash_pars_fragment:dEe,alphamap_fragment:pEe,alphamap_pars_fragment:fEe,alphatest_fragment:mEe,alphatest_pars_fragment:gEe,aomap_fragment:AEe,aomap_pars_fragment:yEe,batching_pars_vertex:vEe,batching_vertex:xEe,begin_vertex:bEe,beginnormal_vertex:_Ee,bsdfs:EEe,iridescence_fragment:wEe,bumpmap_pars_fragment:CEe,clipping_planes_fragment:SEe,clipping_planes_pars_fragment:TEe,clipping_planes_pars_vertex:MEe,clipping_planes_vertex:REe,color_fragment:IEe,color_pars_fragment:BEe,color_pars_vertex:NEe,color_vertex:LEe,common:DEe,cube_uv_reflection_fragment:OEe,defaultnormal_vertex:PEe,displacementmap_pars_vertex:FEe,displacementmap_vertex:kEe,emissivemap_fragment:UEe,emissivemap_pars_fragment:zEe,colorspace_fragment:jEe,colorspace_pars_fragment:VEe,envmap_fragment:GEe,envmap_common_pars_fragment:HEe,envmap_pars_fragment:WEe,envmap_pars_vertex:QEe,envmap_physical_pars_fragment:rwe,envmap_vertex:qEe,fog_vertex:XEe,fog_pars_vertex:YEe,fog_fragment:KEe,fog_pars_fragment:JEe,gradientmap_pars_fragment:ZEe,lightmap_pars_fragment:$Ee,lights_lambert_fragment:ewe,lights_lambert_pars_fragment:twe,lights_pars_begin:iwe,lights_toon_fragment:nwe,lights_toon_pars_fragment:swe,lights_phong_fragment:awe,lights_phong_pars_fragment:owe,lights_physical_fragment:lwe,lights_physical_pars_fragment:cwe,lights_fragment_begin:uwe,lights_fragment_maps:hwe,lights_fragment_end:dwe,logdepthbuf_fragment:pwe,logdepthbuf_pars_fragment:fwe,logdepthbuf_pars_vertex:mwe,logdepthbuf_vertex:gwe,map_fragment:Awe,map_pars_fragment:ywe,map_particle_fragment:vwe,map_particle_pars_fragment:xwe,metalnessmap_fragment:bwe,metalnessmap_pars_fragment:_we,morphinstance_vertex:Ewe,morphcolor_vertex:wwe,morphnormal_vertex:Cwe,morphtarget_pars_vertex:Swe,morphtarget_vertex:Twe,normal_fragment_begin:Mwe,normal_fragment_maps:Rwe,normal_pars_fragment:Iwe,normal_pars_vertex:Bwe,normal_vertex:Nwe,normalmap_pars_fragment:Lwe,clearcoat_normal_fragment_begin:Dwe,clearcoat_normal_fragment_maps:Owe,clearcoat_pars_fragment:Pwe,iridescence_pars_fragment:Fwe,opaque_fragment:kwe,packing:Uwe,premultiplied_alpha_fragment:zwe,project_vertex:jwe,dithering_fragment:Vwe,dithering_pars_fragment:Gwe,roughnessmap_fragment:Hwe,roughnessmap_pars_fragment:Wwe,shadowmap_pars_fragment:Qwe,shadowmap_pars_vertex:qwe,shadowmap_vertex:Xwe,shadowmask_pars_fragment:Ywe,skinbase_vertex:Kwe,skinning_pars_vertex:Jwe,skinning_vertex:Zwe,skinnormal_vertex:$we,specularmap_fragment:e2e,specularmap_pars_fragment:t2e,tonemapping_fragment:i2e,tonemapping_pars_fragment:r2e,transmission_fragment:n2e,transmission_pars_fragment:s2e,uv_pars_fragment:a2e,uv_pars_vertex:o2e,uv_vertex:l2e,worldpos_vertex:c2e,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},Wi={common:{diffuse:{value:new or(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new qr},alphaMap:{value:null},alphaMapTransform:{value:new qr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new qr}},envmap:{envMap:{value:null},envMapRotation:{value:new qr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new qr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new qr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new qr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new qr},normalScale:{value:new ni(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new qr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new qr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new qr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new qr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new or(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new or(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new qr},alphaTest:{value:0},uvTransform:{value:new qr}},sprite:{diffuse:{value:new or(16777215)},opacity:{value:1},center:{value:new ni(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new qr},alphaMap:{value:null},alphaMapTransform:{value:new qr},alphaTest:{value:0}}},Sc={basic:{uniforms:So([Wi.common,Wi.specularmap,Wi.envmap,Wi.aomap,Wi.lightmap,Wi.fog]),vertexShader:sn.meshbasic_vert,fragmentShader:sn.meshbasic_frag},lambert:{uniforms:So([Wi.common,Wi.specularmap,Wi.envmap,Wi.aomap,Wi.lightmap,Wi.emissivemap,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,Wi.fog,Wi.lights,{emissive:{value:new or(0)}}]),vertexShader:sn.meshlambert_vert,fragmentShader:sn.meshlambert_frag},phong:{uniforms:So([Wi.common,Wi.specularmap,Wi.envmap,Wi.aomap,Wi.lightmap,Wi.emissivemap,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,Wi.fog,Wi.lights,{emissive:{value:new or(0)},specular:{value:new or(1118481)},shininess:{value:30}}]),vertexShader:sn.meshphong_vert,fragmentShader:sn.meshphong_frag},standard:{uniforms:So([Wi.common,Wi.envmap,Wi.aomap,Wi.lightmap,Wi.emissivemap,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,Wi.roughnessmap,Wi.metalnessmap,Wi.fog,Wi.lights,{emissive:{value:new or(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:sn.meshphysical_vert,fragmentShader:sn.meshphysical_frag},toon:{uniforms:So([Wi.common,Wi.aomap,Wi.lightmap,Wi.emissivemap,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,Wi.gradientmap,Wi.fog,Wi.lights,{emissive:{value:new or(0)}}]),vertexShader:sn.meshtoon_vert,fragmentShader:sn.meshtoon_frag},matcap:{uniforms:So([Wi.common,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,Wi.fog,{matcap:{value:null}}]),vertexShader:sn.meshmatcap_vert,fragmentShader:sn.meshmatcap_frag},points:{uniforms:So([Wi.points,Wi.fog]),vertexShader:sn.points_vert,fragmentShader:sn.points_frag},dashed:{uniforms:So([Wi.common,Wi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:sn.linedashed_vert,fragmentShader:sn.linedashed_frag},depth:{uniforms:So([Wi.common,Wi.displacementmap]),vertexShader:sn.depth_vert,fragmentShader:sn.depth_frag},normal:{uniforms:So([Wi.common,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,{opacity:{value:1}}]),vertexShader:sn.meshnormal_vert,fragmentShader:sn.meshnormal_frag},sprite:{uniforms:So([Wi.sprite,Wi.fog]),vertexShader:sn.sprite_vert,fragmentShader:sn.sprite_frag},background:{uniforms:{uvTransform:{value:new qr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:sn.background_vert,fragmentShader:sn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new qr}},vertexShader:sn.backgroundCube_vert,fragmentShader:sn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:sn.cube_vert,fragmentShader:sn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:sn.equirect_vert,fragmentShader:sn.equirect_frag},distanceRGBA:{uniforms:So([Wi.common,Wi.displacementmap,{referencePosition:{value:new He},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:sn.distanceRGBA_vert,fragmentShader:sn.distanceRGBA_frag},shadow:{uniforms:So([Wi.lights,Wi.fog,{color:{value:new or(0)},opacity:{value:1}}]),vertexShader:sn.shadow_vert,fragmentShader:sn.shadow_frag}};Sc.physical={uniforms:So([Sc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new qr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new qr},clearcoatNormalScale:{value:new ni(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new qr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new qr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new qr},sheen:{value:0},sheenColor:{value:new or(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new qr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new qr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new qr},transmissionSamplerSize:{value:new ni},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new qr},attenuationDistance:{value:0},attenuationColor:{value:new or(0)},specularColor:{value:new or(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new qr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new qr},anisotropyVector:{value:new ni},anisotropyMap:{value:null},anisotropyMapTransform:{value:new qr}}]),vertexShader:sn.meshphysical_vert,fragmentShader:sn.meshphysical_frag};const IE={r:0,b:0,g:0},lf=new xl,u2e=new fr;function h2e(C,a,h,A,b,E,M){const N=new or(0);let P=E===!0?0:1,F,z,X=null,q=0,K=null;function te(Me){let we=Me.isScene===!0?Me.background:null;return we&&we.isTexture&&(we=(Me.backgroundBlurriness>0?h:a).get(we)),we}function oe(Me){let we=!1;const _e=te(Me);_e===null?ee(N,P):_e&&_e.isColor&&(ee(_e,1),we=!0);const nt=C.xr.getEnvironmentBlendMode();nt==="additive"?A.buffers.color.setClear(0,0,0,1,M):nt==="alpha-blend"&&A.buffers.color.setClear(0,0,0,0,M),(C.autoClear||we)&&C.clear(C.autoClearColor,C.autoClearDepth,C.autoClearStencil)}function ne(Me,we){const _e=te(we);_e&&(_e.isCubeTexture||_e.mapping===ce)?(z===void 0&&(z=new sa(new af(1e4,1e4,1e4),new Cc({name:"BackgroundCubeMaterial",uniforms:n0(Sc.backgroundCube.uniforms),vertexShader:Sc.backgroundCube.vertexShader,fragmentShader:Sc.backgroundCube.fragmentShader,side:R,depthTest:!1,depthWrite:!1,fog:!1})),z.geometry.deleteAttribute("normal"),z.geometry.deleteAttribute("uv"),z.onBeforeRender=function(nt,qe,Je){this.matrixWorld.copyPosition(Je.matrixWorld)},Object.defineProperty(z.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),b.update(z)),lf.copy(we.backgroundRotation),lf.x*=-1,lf.y*=-1,lf.z*=-1,_e.isCubeTexture&&_e.isRenderTargetTexture===!1&&(lf.y*=-1,lf.z*=-1),z.material.uniforms.envMap.value=_e,z.material.uniforms.flipEnvMap.value=_e.isCubeTexture&&_e.isRenderTargetTexture===!1?-1:1,z.material.uniforms.backgroundBlurriness.value=we.backgroundBlurriness,z.material.uniforms.backgroundIntensity.value=we.backgroundIntensity,z.material.uniforms.backgroundRotation.value.setFromMatrix4(u2e.makeRotationFromEuler(lf)),z.material.toneMapped=Xn.getTransfer(_e.colorSpace)!==os,(X!==_e||q!==_e.version||K!==C.toneMapping)&&(z.material.needsUpdate=!0,X=_e,q=_e.version,K=C.toneMapping),z.layers.enableAll(),Me.unshift(z,z.geometry,z.material,0,0,null)):_e&&_e.isTexture&&(F===void 0&&(F=new sa(new o0(2,2),new Cc({name:"BackgroundMaterial",uniforms:n0(Sc.background.uniforms),vertexShader:Sc.background.vertexShader,fragmentShader:Sc.background.fragmentShader,side:S,depthTest:!1,depthWrite:!1,fog:!1})),F.geometry.deleteAttribute("normal"),Object.defineProperty(F.material,"map",{get:function(){return this.uniforms.t2D.value}}),b.update(F)),F.material.uniforms.t2D.value=_e,F.material.uniforms.backgroundIntensity.value=we.backgroundIntensity,F.material.toneMapped=Xn.getTransfer(_e.colorSpace)!==os,_e.matrixAutoUpdate===!0&&_e.updateMatrix(),F.material.uniforms.uvTransform.value.copy(_e.matrix),(X!==_e||q!==_e.version||K!==C.toneMapping)&&(F.material.needsUpdate=!0,X=_e,q=_e.version,K=C.toneMapping),F.layers.enableAll(),Me.unshift(F,F.geometry,F.material,0,0,null))}function ee(Me,we){Me.getRGB(IE,b9(C)),A.buffers.color.setClear(IE.r,IE.g,IE.b,we,M)}return{getClearColor:function(){return N},setClearColor:function(Me,we=1){N.set(Me),P=we,ee(N,P)},getClearAlpha:function(){return P},setClearAlpha:function(Me){P=Me,ee(N,P)},render:oe,addToRenderList:ne}}function d2e(C,a){const h=C.getParameter(C.MAX_VERTEX_ATTRIBS),A={},b=q(null);let E=b,M=!1;function N(Oe,rt,mt,pt,Tt){let Pt=!1;const ui=X(pt,mt,rt);E!==ui&&(E=ui,F(E.object)),Pt=K(Oe,pt,mt,Tt),Pt&&te(Oe,pt,mt,Tt),Tt!==null&&a.update(Tt,C.ELEMENT_ARRAY_BUFFER),(Pt||M)&&(M=!1,_e(Oe,rt,mt,pt),Tt!==null&&C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,a.get(Tt).buffer))}function P(){return C.createVertexArray()}function F(Oe){return C.bindVertexArray(Oe)}function z(Oe){return C.deleteVertexArray(Oe)}function X(Oe,rt,mt){const pt=mt.wireframe===!0;let Tt=A[Oe.id];Tt===void 0&&(Tt={},A[Oe.id]=Tt);let Pt=Tt[rt.id];Pt===void 0&&(Pt={},Tt[rt.id]=Pt);let ui=Pt[pt];return ui===void 0&&(ui=q(P()),Pt[pt]=ui),ui}function q(Oe){const rt=[],mt=[],pt=[];for(let Tt=0;Tt<h;Tt++)rt[Tt]=0,mt[Tt]=0,pt[Tt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:rt,enabledAttributes:mt,attributeDivisors:pt,object:Oe,attributes:{},index:null}}function K(Oe,rt,mt,pt){const Tt=E.attributes,Pt=rt.attributes;let ui=0;const Li=mt.getAttributes();for(const Ft in Li)if(Li[Ft].location>=0){const gi=Tt[Ft];let Di=Pt[Ft];if(Di===void 0&&(Ft==="instanceMatrix"&&Oe.instanceMatrix&&(Di=Oe.instanceMatrix),Ft==="instanceColor"&&Oe.instanceColor&&(Di=Oe.instanceColor)),gi===void 0||gi.attribute!==Di||Di&&gi.data!==Di.data)return!0;ui++}return E.attributesNum!==ui||E.index!==pt}function te(Oe,rt,mt,pt){const Tt={},Pt=rt.attributes;let ui=0;const Li=mt.getAttributes();for(const Ft in Li)if(Li[Ft].location>=0){let gi=Pt[Ft];gi===void 0&&(Ft==="instanceMatrix"&&Oe.instanceMatrix&&(gi=Oe.instanceMatrix),Ft==="instanceColor"&&Oe.instanceColor&&(gi=Oe.instanceColor));const Di={};Di.attribute=gi,gi&&gi.data&&(Di.data=gi.data),Tt[Ft]=Di,ui++}E.attributes=Tt,E.attributesNum=ui,E.index=pt}function oe(){const Oe=E.newAttributes;for(let rt=0,mt=Oe.length;rt<mt;rt++)Oe[rt]=0}function ne(Oe){ee(Oe,0)}function ee(Oe,rt){const mt=E.newAttributes,pt=E.enabledAttributes,Tt=E.attributeDivisors;mt[Oe]=1,pt[Oe]===0&&(C.enableVertexAttribArray(Oe),pt[Oe]=1),Tt[Oe]!==rt&&(C.vertexAttribDivisor(Oe,rt),Tt[Oe]=rt)}function Me(){const Oe=E.newAttributes,rt=E.enabledAttributes;for(let mt=0,pt=rt.length;mt<pt;mt++)rt[mt]!==Oe[mt]&&(C.disableVertexAttribArray(mt),rt[mt]=0)}function we(Oe,rt,mt,pt,Tt,Pt,ui){ui===!0?C.vertexAttribIPointer(Oe,rt,mt,Tt,Pt):C.vertexAttribPointer(Oe,rt,mt,pt,Tt,Pt)}function _e(Oe,rt,mt,pt){oe();const Tt=pt.attributes,Pt=mt.getAttributes(),ui=rt.defaultAttributeValues;for(const Li in Pt){const Ft=Pt[Li];if(Ft.location>=0){let gi=Tt[Li];if(gi===void 0&&(Li==="instanceMatrix"&&Oe.instanceMatrix&&(gi=Oe.instanceMatrix),Li==="instanceColor"&&Oe.instanceColor&&(gi=Oe.instanceColor)),gi!==void 0){const Di=gi.normalized,kr=gi.itemSize,xn=a.get(gi);if(xn===void 0)continue;const es=xn.buffer,hs=xn.type,Un=xn.bytesPerElement,In=hs===C.INT||hs===C.UNSIGNED_INT||gi.gpuType===me;if(gi.isInterleavedBufferAttribute){const wr=gi.data,li=wr.stride,_i=gi.offset;if(wr.isInstancedInterleavedBuffer){for(let Qi=0;Qi<Ft.locationSize;Qi++)ee(Ft.location+Qi,wr.meshPerAttribute);Oe.isInstancedMesh!==!0&&pt._maxInstanceCount===void 0&&(pt._maxInstanceCount=wr.meshPerAttribute*wr.count)}else for(let Qi=0;Qi<Ft.locationSize;Qi++)ne(Ft.location+Qi);C.bindBuffer(C.ARRAY_BUFFER,es);for(let Qi=0;Qi<Ft.locationSize;Qi++)we(Ft.location+Qi,kr/Ft.locationSize,hs,Di,li*Un,(_i+kr/Ft.locationSize*Qi)*Un,In)}else{if(gi.isInstancedBufferAttribute){for(let wr=0;wr<Ft.locationSize;wr++)ee(Ft.location+wr,gi.meshPerAttribute);Oe.isInstancedMesh!==!0&&pt._maxInstanceCount===void 0&&(pt._maxInstanceCount=gi.meshPerAttribute*gi.count)}else for(let wr=0;wr<Ft.locationSize;wr++)ne(Ft.location+wr);C.bindBuffer(C.ARRAY_BUFFER,es);for(let wr=0;wr<Ft.locationSize;wr++)we(Ft.location+wr,kr/Ft.locationSize,hs,Di,kr*Un,kr/Ft.locationSize*wr*Un,In)}}else if(ui!==void 0){const Di=ui[Li];if(Di!==void 0)switch(Di.length){case 2:C.vertexAttrib2fv(Ft.location,Di);break;case 3:C.vertexAttrib3fv(Ft.location,Di);break;case 4:C.vertexAttrib4fv(Ft.location,Di);break;default:C.vertexAttrib1fv(Ft.location,Di)}}}}Me()}function nt(){it();for(const Oe in A){const rt=A[Oe];for(const mt in rt){const pt=rt[mt];for(const Tt in pt)z(pt[Tt].object),delete pt[Tt];delete rt[mt]}delete A[Oe]}}function qe(Oe){if(A[Oe.id]===void 0)return;const rt=A[Oe.id];for(const mt in rt){const pt=rt[mt];for(const Tt in pt)z(pt[Tt].object),delete pt[Tt];delete rt[mt]}delete A[Oe.id]}function Je(Oe){for(const rt in A){const mt=A[rt];if(mt[Oe.id]===void 0)continue;const pt=mt[Oe.id];for(const Tt in pt)z(pt[Tt].object),delete pt[Tt];delete mt[Oe.id]}}function it(){ze(),M=!0,E!==b&&(E=b,F(E.object))}function ze(){b.geometry=null,b.program=null,b.wireframe=!1}return{setup:N,reset:it,resetDefaultState:ze,dispose:nt,releaseStatesOfGeometry:qe,releaseStatesOfProgram:Je,initAttributes:oe,enableAttribute:ne,disableUnusedAttributes:Me}}function p2e(C,a,h){let A;function b(F){A=F}function E(F,z){C.drawArrays(A,F,z),h.update(z,A,1)}function M(F,z,X){X!==0&&(C.drawArraysInstanced(A,F,z,X),h.update(z,A,X))}function N(F,z,X){if(X===0)return;const q=a.get("WEBGL_multi_draw");if(q===null)for(let K=0;K<X;K++)this.render(F[K],z[K]);else{q.multiDrawArraysWEBGL(A,F,0,z,0,X);let K=0;for(let te=0;te<X;te++)K+=z[te];h.update(K,A,1)}}function P(F,z,X,q){if(X===0)return;const K=a.get("WEBGL_multi_draw");if(K===null)for(let te=0;te<F.length;te++)M(F[te],z[te],q[te]);else{K.multiDrawArraysInstancedWEBGL(A,F,0,z,0,q,0,X);let te=0;for(let oe=0;oe<X;oe++)te+=z[oe];for(let oe=0;oe<q.length;oe++)h.update(te,A,q[oe])}}this.setMode=b,this.render=E,this.renderInstances=M,this.renderMultiDraw=N,this.renderMultiDrawInstances=P}function f2e(C,a,h,A){let b;function E(){if(b!==void 0)return b;if(a.has("EXT_texture_filter_anisotropic")===!0){const qe=a.get("EXT_texture_filter_anisotropic");b=C.getParameter(qe.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else b=0;return b}function M(qe){return!(qe!==ge&&A.convert(qe)!==C.getParameter(C.IMPLEMENTATION_COLOR_READ_FORMAT))}function N(qe){const Je=qe===Xt&&(a.has("EXT_color_buffer_half_float")||a.has("EXT_color_buffer_float"));return!(qe!==mn&&A.convert(qe)!==C.getParameter(C.IMPLEMENTATION_COLOR_READ_TYPE)&&qe!==St&&!Je)}function P(qe){if(qe==="highp"){if(C.getShaderPrecisionFormat(C.VERTEX_SHADER,C.HIGH_FLOAT).precision>0&&C.getShaderPrecisionFormat(C.FRAGMENT_SHADER,C.HIGH_FLOAT).precision>0)return"highp";qe="mediump"}return qe==="mediump"&&C.getShaderPrecisionFormat(C.VERTEX_SHADER,C.MEDIUM_FLOAT).precision>0&&C.getShaderPrecisionFormat(C.FRAGMENT_SHADER,C.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let F=h.precision!==void 0?h.precision:"highp";const z=P(F);z!==F&&(console.warn("THREE.WebGLRenderer:",F,"not supported, using",z,"instead."),F=z);const X=h.logarithmicDepthBuffer===!0,q=C.getParameter(C.MAX_TEXTURE_IMAGE_UNITS),K=C.getParameter(C.MAX_VERTEX_TEXTURE_IMAGE_UNITS),te=C.getParameter(C.MAX_TEXTURE_SIZE),oe=C.getParameter(C.MAX_CUBE_MAP_TEXTURE_SIZE),ne=C.getParameter(C.MAX_VERTEX_ATTRIBS),ee=C.getParameter(C.MAX_VERTEX_UNIFORM_VECTORS),Me=C.getParameter(C.MAX_VARYING_VECTORS),we=C.getParameter(C.MAX_FRAGMENT_UNIFORM_VECTORS),_e=K>0,nt=C.getParameter(C.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:E,getMaxPrecision:P,textureFormatReadable:M,textureTypeReadable:N,precision:F,logarithmicDepthBuffer:X,maxTextures:q,maxVertexTextures:K,maxTextureSize:te,maxCubemapSize:oe,maxAttributes:ne,maxVertexUniforms:ee,maxVaryings:Me,maxFragmentUniforms:we,vertexTextures:_e,maxSamples:nt}}function m2e(C){const a=this;let h=null,A=0,b=!1,E=!1;const M=new Ld,N=new qr,P={value:null,needsUpdate:!1};this.uniform=P,this.numPlanes=0,this.numIntersection=0,this.init=function(X,q){const K=X.length!==0||q||A!==0||b;return b=q,A=X.length,K},this.beginShadows=function(){E=!0,z(null)},this.endShadows=function(){E=!1},this.setGlobalState=function(X,q){h=z(X,q,0)},this.setState=function(X,q,K){const te=X.clippingPlanes,oe=X.clipIntersection,ne=X.clipShadows,ee=C.get(X);if(!b||te===null||te.length===0||E&&!ne)E?z(null):F();else{const Me=E?0:A,we=Me*4;let _e=ee.clippingState||null;P.value=_e,_e=z(te,q,we,K);for(let nt=0;nt!==we;++nt)_e[nt]=h[nt];ee.clippingState=_e,this.numIntersection=oe?this.numPlanes:0,this.numPlanes+=Me}};function F(){P.value!==h&&(P.value=h,P.needsUpdate=A>0),a.numPlanes=A,a.numIntersection=0}function z(X,q,K,te){const oe=X!==null?X.length:0;let ne=null;if(oe!==0){if(ne=P.value,te!==!0||ne===null){const ee=K+oe*4,Me=q.matrixWorldInverse;N.getNormalMatrix(Me),(ne===null||ne.length<ee)&&(ne=new Float32Array(ee));for(let we=0,_e=K;we!==oe;++we,_e+=4)M.copy(X[we]).applyMatrix4(Me,N),M.normal.toArray(ne,_e),ne[_e+3]=M.constant}P.value=ne,P.needsUpdate=!0}return a.numPlanes=oe,a.numIntersection=0,ne}}function g2e(C){let a=new WeakMap;function h(M,N){return N===re?M.mapping=k:N===Re&&(M.mapping=Z),M}function A(M){if(M&&M.isTexture){const N=M.mapping;if(N===re||N===Re)if(a.has(M)){const P=a.get(M).texture;return h(P,M.mapping)}else{const P=M.image;if(P&&P.height>0){const F=new S9(P.height);return F.fromEquirectangularTexture(C,M),a.set(M,F),M.addEventListener("dispose",b),h(F.texture,M.mapping)}else return null}}return M}function b(M){const N=M.target;N.removeEventListener("dispose",b);const P=a.get(N);P!==void 0&&(a.delete(N),P.dispose())}function E(){a=new WeakMap}return{get:A,dispose:E}}class BE extends ME{constructor(a=-1,h=1,A=1,b=-1,E=.1,M=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=h,this.top=A,this.bottom=b,this.near=E,this.far=M,this.updateProjectionMatrix()}copy(a,h){return super.copy(a,h),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=a.view===null?null:Object.assign({},a.view),this}setViewOffset(a,h,A,b,E,M){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=h,this.view.offsetX=A,this.view.offsetY=b,this.view.width=E,this.view.height=M,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=(this.right-this.left)/(2*this.zoom),h=(this.top-this.bottom)/(2*this.zoom),A=(this.right+this.left)/2,b=(this.top+this.bottom)/2;let E=A-a,M=A+a,N=b+h,P=b-h;if(this.view!==null&&this.view.enabled){const F=(this.right-this.left)/this.view.fullWidth/this.zoom,z=(this.top-this.bottom)/this.view.fullHeight/this.zoom;E+=F*this.view.offsetX,M=E+F*this.view.width,N-=z*this.view.offsetY,P=N-z*this.view.height}this.projectionMatrix.makeOrthographic(E,M,N,P,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const h=super.toJSON(a);return h.object.zoom=this.zoom,h.object.left=this.left,h.object.right=this.right,h.object.top=this.top,h.object.bottom=this.bottom,h.object.near=this.near,h.object.far=this.far,this.view!==null&&(h.object.view=Object.assign({},this.view)),h}}const l0=4,T9=[.125,.215,.35,.446,.526,.582],cf=20,MB=new BE,M9=new or;let RB=null,IB=0,BB=0,NB=!1;const uf=(1+Math.sqrt(5))/2,c0=1/uf,R9=[new He(-uf,c0,0),new He(uf,c0,0),new He(-c0,0,uf),new He(c0,0,uf),new He(0,uf,-c0),new He(0,uf,c0),new He(-1,1,-1),new He(1,1,-1),new He(-1,1,1),new He(1,1,1)];class LB{constructor(a){this._renderer=a,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(a,h=0,A=.1,b=100){RB=this._renderer.getRenderTarget(),IB=this._renderer.getActiveCubeFace(),BB=this._renderer.getActiveMipmapLevel(),NB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const E=this._allocateTargets();return E.depthBuffer=!0,this._sceneToCubeUV(a,A,b,E),h>0&&this._blur(E,0,0,h),this._applyPMREM(E),this._cleanup(E),E}fromEquirectangular(a,h=null){return this._fromTexture(a,h)}fromCubemap(a,h=null){return this._fromTexture(a,h)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=N9(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=B9(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(a){this._lodMax=Math.floor(Math.log2(a)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodPlanes.length;a++)this._lodPlanes[a].dispose()}_cleanup(a){this._renderer.setRenderTarget(RB,IB,BB),this._renderer.xr.enabled=NB,a.scissorTest=!1,NE(a,0,0,a.width,a.height)}_fromTexture(a,h){a.mapping===k||a.mapping===Z?this._setSize(a.image.length===0?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4),RB=this._renderer.getRenderTarget(),IB=this._renderer.getActiveCubeFace(),BB=this._renderer.getActiveMipmapLevel(),NB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const A=h||this._allocateTargets();return this._textureToCubeUV(a,A),this._applyPMREM(A),this._cleanup(A),A}_allocateTargets(){const a=3*Math.max(this._cubeSize,112),h=4*this._cubeSize,A={magFilter:Pi,minFilter:Pi,generateMipmaps:!1,type:Xt,format:ge,colorSpace:Ec,depthBuffer:!1},b=I9(a,h,A);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==a||this._pingPongRenderTarget.height!==h){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=I9(a,h,A);const{_lodMax:E}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=A2e(E)),this._blurMaterial=y2e(E,a,h)}return b}_compileMaterial(a){const h=new sa(this._lodPlanes[0],a);this._renderer.compile(h,MB)}_sceneToCubeUV(a,h,A,b){const E=new fa(90,1,h,A),M=[1,-1,1,1,1,1],N=[1,1,1,-1,-1,-1],P=this._renderer,F=P.autoClear,z=P.toneMapping;P.getClearColor(M9),P.toneMapping=Ot,P.autoClear=!1;const X=new Bd({name:"PMREM.Background",side:R,depthWrite:!1,depthTest:!1}),q=new sa(new af,X);let K=!1;const te=a.background;te?te.isColor&&(X.color.copy(te),a.background=null,K=!0):(X.color.copy(M9),K=!0);for(let oe=0;oe<6;oe++){const ne=oe%3;ne===0?(E.up.set(0,M[oe],0),E.lookAt(N[oe],0,0)):ne===1?(E.up.set(0,0,M[oe]),E.lookAt(0,N[oe],0)):(E.up.set(0,M[oe],0),E.lookAt(0,0,N[oe]));const ee=this._cubeSize;NE(b,ne*ee,oe>2?ee:0,ee,ee),P.setRenderTarget(b),K&&P.render(q,E),P.render(a,E)}q.geometry.dispose(),q.material.dispose(),P.toneMapping=z,P.autoClear=F,a.background=te}_textureToCubeUV(a,h){const A=this._renderer,b=a.mapping===k||a.mapping===Z;b?(this._cubemapMaterial===null&&(this._cubemapMaterial=N9()),this._cubemapMaterial.uniforms.flipEnvMap.value=a.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=B9());const E=b?this._cubemapMaterial:this._equirectMaterial,M=new sa(this._lodPlanes[0],E),N=E.uniforms;N.envMap.value=a;const P=this._cubeSize;NE(h,0,0,3*P,2*P),A.setRenderTarget(h),A.render(M,MB)}_applyPMREM(a){const h=this._renderer,A=h.autoClear;h.autoClear=!1;const b=this._lodPlanes.length;for(let E=1;E<b;E++){const M=Math.sqrt(this._sigmas[E]*this._sigmas[E]-this._sigmas[E-1]*this._sigmas[E-1]),N=R9[(b-E-1)%R9.length];this._blur(a,E-1,E,M,N)}h.autoClear=A}_blur(a,h,A,b,E){const M=this._pingPongRenderTarget;this._halfBlur(a,M,h,A,b,"latitudinal",E),this._halfBlur(M,a,A,A,b,"longitudinal",E)}_halfBlur(a,h,A,b,E,M,N){const P=this._renderer,F=this._blurMaterial;M!=="latitudinal"&&M!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const z=3,X=new sa(this._lodPlanes[b],F),q=F.uniforms,K=this._sizeLods[A]-1,te=isFinite(E)?Math.PI/(2*K):2*Math.PI/(2*cf-1),oe=E/te,ne=isFinite(E)?1+Math.floor(z*oe):cf;ne>cf&&console.warn(`sigmaRadians, ${E}, is too large and will clip, as it requested ${ne} samples when the maximum is set to ${cf}`);const ee=[];let Me=0;for(let Je=0;Je<cf;++Je){const it=Je/oe,ze=Math.exp(-it*it/2);ee.push(ze),Je===0?Me+=ze:Je<ne&&(Me+=2*ze)}for(let Je=0;Je<ee.length;Je++)ee[Je]=ee[Je]/Me;q.envMap.value=a.texture,q.samples.value=ne,q.weights.value=ee,q.latitudinal.value=M==="latitudinal",N&&(q.poleAxis.value=N);const{_lodMax:we}=this;q.dTheta.value=te,q.mipInt.value=we-A;const _e=this._sizeLods[b],nt=3*_e*(b>we-l0?b-we+l0:0),qe=4*(this._cubeSize-_e);NE(h,nt,qe,3*_e,2*_e),P.setRenderTarget(h),P.render(X,MB)}}function A2e(C){const a=[],h=[],A=[];let b=C;const E=C-l0+1+T9.length;for(let M=0;M<E;M++){const N=Math.pow(2,b);h.push(N);let P=1/N;M>C-l0?P=T9[M-C+l0-1]:M===0&&(P=0),A.push(P);const F=1/(N-2),z=-F,X=1+F,q=[z,z,X,z,X,X,z,z,X,X,z,X],K=6,te=6,oe=3,ne=2,ee=1,Me=new Float32Array(oe*te*K),we=new Float32Array(ne*te*K),_e=new Float32Array(ee*te*K);for(let qe=0;qe<K;qe++){const Je=qe%3*2/3-1,it=qe>2?0:-1,ze=[Je,it,0,Je+2/3,it,0,Je+2/3,it+1,0,Je,it,0,Je+2/3,it+1,0,Je,it+1,0];Me.set(ze,oe*te*qe),we.set(q,ne*te*qe);const Oe=[qe,qe,qe,qe,qe,qe];_e.set(Oe,ee*te*qe)}const nt=new hn;nt.setAttribute("position",new ns(Me,oe)),nt.setAttribute("uv",new ns(we,ne)),nt.setAttribute("faceIndex",new ns(_e,ee)),a.push(nt),b>l0&&b--}return{lodPlanes:a,sizeLods:h,sigmas:A}}function I9(C,a,h){const A=new Xo(C,a,h);return A.texture.mapping=ce,A.texture.name="PMREM.cubeUv",A.scissorTest=!0,A}function NE(C,a,h,A,b){C.viewport.set(a,h,A,b),C.scissor.set(a,h,A,b)}function y2e(C,a,h){const A=new Float32Array(cf),b=new He(0,1,0);return new Cc({name:"SphericalGaussianBlur",defines:{n:cf,CUBEUV_TEXEL_WIDTH:1/a,CUBEUV_TEXEL_HEIGHT:1/h,CUBEUV_MAX_MIP:`${C}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:A},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:b}},vertexShader:DB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:I,depthTest:!1,depthWrite:!1})}function B9(){return new Cc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:DB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:I,depthTest:!1,depthWrite:!1})}function N9(){return new Cc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:DB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:I,depthTest:!1,depthWrite:!1})}function DB(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function v2e(C){let a=new WeakMap,h=null;function A(N){if(N&&N.isTexture){const P=N.mapping,F=P===re||P===Re,z=P===k||P===Z;if(F||z){let X=a.get(N);const q=X!==void 0?X.texture.pmremVersion:0;if(N.isRenderTargetTexture&&N.pmremVersion!==q)return h===null&&(h=new LB(C)),X=F?h.fromEquirectangular(N,X):h.fromCubemap(N,X),X.texture.pmremVersion=N.pmremVersion,a.set(N,X),X.texture;if(X!==void 0)return X.texture;{const K=N.image;return F&&K&&K.height>0||z&&K&&b(K)?(h===null&&(h=new LB(C)),X=F?h.fromEquirectangular(N):h.fromCubemap(N),X.texture.pmremVersion=N.pmremVersion,a.set(N,X),N.addEventListener("dispose",E),X.texture):null}}}return N}function b(N){let P=0;const F=6;for(let z=0;z<F;z++)N[z]!==void 0&&P++;return P===F}function E(N){const P=N.target;P.removeEventListener("dispose",E);const F=a.get(P);F!==void 0&&(a.delete(P),F.dispose())}function M(){a=new WeakMap,h!==null&&(h.dispose(),h=null)}return{get:A,dispose:M}}function x2e(C){const a={};function h(A){if(a[A]!==void 0)return a[A];let b;switch(A){case"WEBGL_depth_texture":b=C.getExtension("WEBGL_depth_texture")||C.getExtension("MOZ_WEBGL_depth_texture")||C.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":b=C.getExtension("EXT_texture_filter_anisotropic")||C.getExtension("MOZ_EXT_texture_filter_anisotropic")||C.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":b=C.getExtension("WEBGL_compressed_texture_s3tc")||C.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||C.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":b=C.getExtension("WEBGL_compressed_texture_pvrtc")||C.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:b=C.getExtension(A)}return a[A]=b,b}return{has:function(A){return h(A)!==null},init:function(){h("EXT_color_buffer_float"),h("WEBGL_clip_cull_distance"),h("OES_texture_float_linear"),h("EXT_color_buffer_half_float"),h("WEBGL_multisampled_render_to_texture"),h("WEBGL_render_shared_exponent")},get:function(A){const b=h(A);return b===null&&console.warn("THREE.WebGLRenderer: "+A+" extension not supported."),b}}}function b2e(C,a,h,A){const b={},E=new WeakMap;function M(X){const q=X.target;q.index!==null&&a.remove(q.index);for(const te in q.attributes)a.remove(q.attributes[te]);for(const te in q.morphAttributes){const oe=q.morphAttributes[te];for(let ne=0,ee=oe.length;ne<ee;ne++)a.remove(oe[ne])}q.removeEventListener("dispose",M),delete b[q.id];const K=E.get(q);K&&(a.remove(K),E.delete(q)),A.releaseStatesOfGeometry(q),q.isInstancedBufferGeometry===!0&&delete q._maxInstanceCount,h.memory.geometries--}function N(X,q){return b[q.id]===!0||(q.addEventListener("dispose",M),b[q.id]=!0,h.memory.geometries++),q}function P(X){const q=X.attributes;for(const te in q)a.update(q[te],C.ARRAY_BUFFER);const K=X.morphAttributes;for(const te in K){const oe=K[te];for(let ne=0,ee=oe.length;ne<ee;ne++)a.update(oe[ne],C.ARRAY_BUFFER)}}function F(X){const q=[],K=X.index,te=X.attributes.position;let oe=0;if(K!==null){const Me=K.array;oe=K.version;for(let we=0,_e=Me.length;we<_e;we+=3){const nt=Me[we+0],qe=Me[we+1],Je=Me[we+2];q.push(nt,qe,qe,Je,Je,nt)}}else if(te!==void 0){const Me=te.array;oe=te.version;for(let we=0,_e=Me.length/3-1;we<_e;we+=3){const nt=we+0,qe=we+1,Je=we+2;q.push(nt,qe,qe,Je,Je,nt)}}else return;const ne=new(oE(q)?EB:_B)(q,1);ne.version=oe;const ee=E.get(X);ee&&a.remove(ee),E.set(X,ne)}function z(X){const q=E.get(X);if(q){const K=X.index;K!==null&&q.version<K.version&&F(X)}else F(X);return E.get(X)}return{get:N,update:P,getWireframeAttribute:z}}function _2e(C,a,h){let A;function b(q){A=q}let E,M;function N(q){E=q.type,M=q.bytesPerElement}function P(q,K){C.drawElements(A,K,E,q*M),h.update(K,A,1)}function F(q,K,te){te!==0&&(C.drawElementsInstanced(A,K,E,q*M,te),h.update(K,A,te))}function z(q,K,te){if(te===0)return;const oe=a.get("WEBGL_multi_draw");if(oe===null)for(let ne=0;ne<te;ne++)this.render(q[ne]/M,K[ne]);else{oe.multiDrawElementsWEBGL(A,K,0,E,q,0,te);let ne=0;for(let ee=0;ee<te;ee++)ne+=K[ee];h.update(ne,A,1)}}function X(q,K,te,oe){if(te===0)return;const ne=a.get("WEBGL_multi_draw");if(ne===null)for(let ee=0;ee<q.length;ee++)F(q[ee]/M,K[ee],oe[ee]);else{ne.multiDrawElementsInstancedWEBGL(A,K,0,E,q,0,oe,0,te);let ee=0;for(let Me=0;Me<te;Me++)ee+=K[Me];for(let Me=0;Me<oe.length;Me++)h.update(ee,A,oe[Me])}}this.setMode=b,this.setIndex=N,this.render=P,this.renderInstances=F,this.renderMultiDraw=z,this.renderMultiDrawInstances=X}function E2e(C){const a={geometries:0,textures:0},h={frame:0,calls:0,triangles:0,points:0,lines:0};function A(E,M,N){switch(h.calls++,M){case C.TRIANGLES:h.triangles+=N*(E/3);break;case C.LINES:h.lines+=N*(E/2);break;case C.LINE_STRIP:h.lines+=N*(E-1);break;case C.LINE_LOOP:h.lines+=N*E;break;case C.POINTS:h.points+=N*E;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",M);break}}function b(){h.calls=0,h.triangles=0,h.points=0,h.lines=0}return{memory:a,render:h,programs:null,autoReset:!0,reset:b,update:A}}function w2e(C,a,h){const A=new WeakMap,b=new Fn;function E(M,N,P){const F=M.morphTargetInfluences,z=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,X=z!==void 0?z.length:0;let q=A.get(N);if(q===void 0||q.count!==X){let K=function(){it.dispose(),A.delete(N),N.removeEventListener("dispose",K)};q!==void 0&&q.texture.dispose();const te=N.morphAttributes.position!==void 0,oe=N.morphAttributes.normal!==void 0,ne=N.morphAttributes.color!==void 0,ee=N.morphAttributes.position||[],Me=N.morphAttributes.normal||[],we=N.morphAttributes.color||[];let _e=0;te===!0&&(_e=1),oe===!0&&(_e=2),ne===!0&&(_e=3);let nt=N.attributes.position.count*_e,qe=1;nt>a.maxTextureSize&&(qe=Math.ceil(nt/a.maxTextureSize),nt=a.maxTextureSize);const Je=new Float32Array(nt*qe*4*X),it=new Wg(Je,nt,qe,X);it.type=St,it.needsUpdate=!0;const ze=_e*4;for(let Oe=0;Oe<X;Oe++){const rt=ee[Oe],mt=Me[Oe],pt=we[Oe],Tt=nt*qe*4*Oe;for(let Pt=0;Pt<rt.count;Pt++){const ui=Pt*ze;te===!0&&(b.fromBufferAttribute(rt,Pt),Je[Tt+ui+0]=b.x,Je[Tt+ui+1]=b.y,Je[Tt+ui+2]=b.z,Je[Tt+ui+3]=0),oe===!0&&(b.fromBufferAttribute(mt,Pt),Je[Tt+ui+4]=b.x,Je[Tt+ui+5]=b.y,Je[Tt+ui+6]=b.z,Je[Tt+ui+7]=0),ne===!0&&(b.fromBufferAttribute(pt,Pt),Je[Tt+ui+8]=b.x,Je[Tt+ui+9]=b.y,Je[Tt+ui+10]=b.z,Je[Tt+ui+11]=pt.itemSize===4?b.w:1)}}q={count:X,texture:it,size:new ni(nt,qe)},A.set(N,q),N.addEventListener("dispose",K)}if(M.isInstancedMesh===!0&&M.morphTexture!==null)P.getUniforms().setValue(C,"morphTexture",M.morphTexture,h);else{let K=0;for(let oe=0;oe<F.length;oe++)K+=F[oe];const te=N.morphTargetsRelative?1:1-K;P.getUniforms().setValue(C,"morphTargetBaseInfluence",te),P.getUniforms().setValue(C,"morphTargetInfluences",F)}P.getUniforms().setValue(C,"morphTargetsTexture",q.texture,h),P.getUniforms().setValue(C,"morphTargetsTextureSize",q.size)}return{update:E}}class C2e{constructor(a,h,A){if(this.renderer=a,this.DEFAULT_NUMVIEWS=2,this.maxNumViews=0,this.gl=A,this.extensions=h,this.available=this.extensions.has("OCULUS_multiview"),this.available){const E=this.extensions.get("OCULUS_multiview");this.maxNumViews=this.gl.getParameter(E.MAX_VIEWS_OVR),this.mat4=[],this.mat3=[],this.cameraArray=[];for(var b=0;b<this.maxNumViews;b++)this.mat4[b]=new fr,this.mat3[b]=new qr}}getCameraArray(a){return a.isArrayCamera?a.cameras:(this.cameraArray[0]=a,this.cameraArray)}updateCameraProjectionMatricesUniform(a,h){for(var A=this.getCameraArray(a),b=0;b<A.length;b++)this.mat4[b].copy(A[b].projectionMatrix);h.setValue(this.gl,"projectionMatrices",this.mat4)}updateCameraViewMatricesUniform(a,h){for(var A=this.getCameraArray(a),b=0;b<A.length;b++)this.mat4[b].copy(A[b].matrixWorldInverse);h.setValue(this.gl,"viewMatrices",this.mat4)}updateObjectMatricesUniforms(a,h,A){for(var b=this.getCameraArray(h),E=0;E<b.length;E++)this.mat4[E].multiplyMatrices(b[E].matrixWorldInverse,a.matrixWorld),this.mat3[E].getNormalMatrix(this.mat4[E]);A.setValue(this.gl,"modelViewMatrices",this.mat4),A.setValue(this.gl,"normalMatrices",this.mat3)}}function S2e(C,a,h,A){let b=new WeakMap;function E(P){const F=A.render.frame,z=P.geometry,X=a.get(P,z);if(b.get(X)!==F&&(a.update(X),b.set(X,F)),P.isInstancedMesh&&(P.hasEventListener("dispose",N)===!1&&P.addEventListener("dispose",N),b.get(P)!==F&&(h.update(P.instanceMatrix,C.ARRAY_BUFFER),P.instanceColor!==null&&h.update(P.instanceColor,C.ARRAY_BUFFER),b.set(P,F))),P.isSkinnedMesh){const q=P.skeleton;b.get(q)!==F&&(q.update(),b.set(q,F))}return X}function M(){b=new WeakMap}function N(P){const F=P.target;F.removeEventListener("dispose",N),h.remove(F.instanceMatrix),F.instanceColor!==null&&h.remove(F.instanceColor)}return{update:E,dispose:M}}class OB extends us{constructor(a,h,A,b,E,M,N,P,F,z){if(z=z!==void 0?z:Ke,z!==Ke&&z!==ot)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");A===void 0&&z===Ke&&(A=ct),A===void 0&&z===ot&&(A=Ni),super(null,b,E,M,N,P,z,A,F),this.isDepthTexture=!0,this.image={width:a,height:h},this.magFilter=N!==void 0?N:Bt,this.minFilter=P!==void 0?P:Bt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(a){return super.copy(a),this.compareFunction=a.compareFunction,this}toJSON(a){const h=super.toJSON(a);return this.compareFunction!==null&&(h.compareFunction=this.compareFunction),h}}const L9=new us,D9=new OB(1,1);D9.compareFunction=Yy;const O9=new Wg,P9=new Xr,F9=new sv,k9=[],U9=[],z9=new Float32Array(16),j9=new Float32Array(9),V9=new Float32Array(4);function u0(C,a,h){const A=C[0];if(A<=0||A>0)return C;const b=a*h;let E=k9[b];if(E===void 0&&(E=new Float32Array(b),k9[b]=E),a!==0){A.toArray(E,0);for(let M=1,N=0;M!==a;++M)N+=h,C[M].toArray(E,N)}return E}function ma(C,a){if(C.length!==a.length)return!1;for(let h=0,A=C.length;h<A;h++)if(C[h]!==a[h])return!1;return!0}function ga(C,a){for(let h=0,A=a.length;h<A;h++)C[h]=a[h]}function LE(C,a){let h=U9[a];h===void 0&&(h=new Int32Array(a),U9[a]=h);for(let A=0;A!==a;++A)h[A]=C.allocateTextureUnit();return h}function T2e(C,a){const h=this.cache;h[0]!==a&&(C.uniform1f(this.addr,a),h[0]=a)}function M2e(C,a){const h=this.cache;if(a.x!==void 0)(h[0]!==a.x||h[1]!==a.y)&&(C.uniform2f(this.addr,a.x,a.y),h[0]=a.x,h[1]=a.y);else{if(ma(h,a))return;C.uniform2fv(this.addr,a),ga(h,a)}}function R2e(C,a){const h=this.cache;if(a.x!==void 0)(h[0]!==a.x||h[1]!==a.y||h[2]!==a.z)&&(C.uniform3f(this.addr,a.x,a.y,a.z),h[0]=a.x,h[1]=a.y,h[2]=a.z);else if(a.r!==void 0)(h[0]!==a.r||h[1]!==a.g||h[2]!==a.b)&&(C.uniform3f(this.addr,a.r,a.g,a.b),h[0]=a.r,h[1]=a.g,h[2]=a.b);else{if(ma(h,a))return;C.uniform3fv(this.addr,a),ga(h,a)}}function I2e(C,a){const h=this.cache;if(a.x!==void 0)(h[0]!==a.x||h[1]!==a.y||h[2]!==a.z||h[3]!==a.w)&&(C.uniform4f(this.addr,a.x,a.y,a.z,a.w),h[0]=a.x,h[1]=a.y,h[2]=a.z,h[3]=a.w);else{if(ma(h,a))return;C.uniform4fv(this.addr,a),ga(h,a)}}function B2e(C,a){const h=this.cache,A=a.elements;if(A===void 0){if(ma(h,a))return;C.uniformMatrix2fv(this.addr,!1,a),ga(h,a)}else{if(ma(h,A))return;V9.set(A),C.uniformMatrix2fv(this.addr,!1,V9),ga(h,A)}}function N2e(C,a){const h=this.cache,A=a.elements;if(A===void 0){if(ma(h,a))return;C.uniformMatrix3fv(this.addr,!1,a),ga(h,a)}else{if(ma(h,A))return;j9.set(A),C.uniformMatrix3fv(this.addr,!1,j9),ga(h,A)}}function L2e(C,a){const h=this.cache,A=a.elements;if(A===void 0){if(ma(h,a))return;C.uniformMatrix4fv(this.addr,!1,a),ga(h,a)}else{if(ma(h,A))return;z9.set(A),C.uniformMatrix4fv(this.addr,!1,z9),ga(h,A)}}function D2e(C,a){const h=this.cache;h[0]!==a&&(C.uniform1i(this.addr,a),h[0]=a)}function O2e(C,a){const h=this.cache;if(a.x!==void 0)(h[0]!==a.x||h[1]!==a.y)&&(C.uniform2i(this.addr,a.x,a.y),h[0]=a.x,h[1]=a.y);else{if(ma(h,a))return;C.uniform2iv(this.addr,a),ga(h,a)}}function P2e(C,a){const h=this.cache;if(a.x!==void 0)(h[0]!==a.x||h[1]!==a.y||h[2]!==a.z)&&(C.uniform3i(this.addr,a.x,a.y,a.z),h[0]=a.x,h[1]=a.y,h[2]=a.z);else{if(ma(h,a))return;C.uniform3iv(this.addr,a),ga(h,a)}}function F2e(C,a){const h=this.cache;if(a.x!==void 0)(h[0]!==a.x||h[1]!==a.y||h[2]!==a.z||h[3]!==a.w)&&(C.uniform4i(this.addr,a.x,a.y,a.z,a.w),h[0]=a.x,h[1]=a.y,h[2]=a.z,h[3]=a.w);else{if(ma(h,a))return;C.uniform4iv(this.addr,a),ga(h,a)}}function k2e(C,a){const h=this.cache;h[0]!==a&&(C.uniform1ui(this.addr,a),h[0]=a)}function U2e(C,a){const h=this.cache;if(a.x!==void 0)(h[0]!==a.x||h[1]!==a.y)&&(C.uniform2ui(this.addr,a.x,a.y),h[0]=a.x,h[1]=a.y);else{if(ma(h,a))return;C.uniform2uiv(this.addr,a),ga(h,a)}}function z2e(C,a){const h=this.cache;if(a.x!==void 0)(h[0]!==a.x||h[1]!==a.y||h[2]!==a.z)&&(C.uniform3ui(this.addr,a.x,a.y,a.z),h[0]=a.x,h[1]=a.y,h[2]=a.z);else{if(ma(h,a))return;C.uniform3uiv(this.addr,a),ga(h,a)}}function j2e(C,a){const h=this.cache;if(a.x!==void 0)(h[0]!==a.x||h[1]!==a.y||h[2]!==a.z||h[3]!==a.w)&&(C.uniform4ui(this.addr,a.x,a.y,a.z,a.w),h[0]=a.x,h[1]=a.y,h[2]=a.z,h[3]=a.w);else{if(ma(h,a))return;C.uniform4uiv(this.addr,a),ga(h,a)}}function V2e(C,a,h){const A=this.cache,b=h.allocateTextureUnit();A[0]!==b&&(C.uniform1i(this.addr,b),A[0]=b);const E=this.type===C.SAMPLER_2D_SHADOW?D9:L9;h.setTexture2D(a||E,b)}function G2e(C,a,h){const A=this.cache,b=h.allocateTextureUnit();A[0]!==b&&(C.uniform1i(this.addr,b),A[0]=b),h.setTexture3D(a||P9,b)}function H2e(C,a,h){const A=this.cache,b=h.allocateTextureUnit();A[0]!==b&&(C.uniform1i(this.addr,b),A[0]=b),h.setTextureCube(a||F9,b)}function W2e(C,a,h){const A=this.cache,b=h.allocateTextureUnit();A[0]!==b&&(C.uniform1i(this.addr,b),A[0]=b),h.setTexture2DArray(a||O9,b)}function Q2e(C){switch(C){case 5126:return T2e;case 35664:return M2e;case 35665:return R2e;case 35666:return I2e;case 35674:return B2e;case 35675:return N2e;case 35676:return L2e;case 5124:case 35670:return D2e;case 35667:case 35671:return O2e;case 35668:case 35672:return P2e;case 35669:case 35673:return F2e;case 5125:return k2e;case 36294:return U2e;case 36295:return z2e;case 36296:return j2e;case 35678:case 36198:case 36298:case 36306:case 35682:return V2e;case 35679:case 36299:case 36307:return G2e;case 35680:case 36300:case 36308:case 36293:return H2e;case 36289:case 36303:case 36311:case 36292:return W2e}}function q2e(C,a){C.uniform1fv(this.addr,a)}function X2e(C,a){const h=u0(a,this.size,2);C.uniform2fv(this.addr,h)}function Y2e(C,a){const h=u0(a,this.size,3);C.uniform3fv(this.addr,h)}function K2e(C,a){const h=u0(a,this.size,4);C.uniform4fv(this.addr,h)}function J2e(C,a){const h=u0(a,this.size,4);C.uniformMatrix2fv(this.addr,!1,h)}function Z2e(C,a){const h=u0(a,this.size,9);C.uniformMatrix3fv(this.addr,!1,h)}function $2e(C,a){const h=u0(a,this.size,16);C.uniformMatrix4fv(this.addr,!1,h)}function eCe(C,a){C.uniform1iv(this.addr,a)}function tCe(C,a){C.uniform2iv(this.addr,a)}function iCe(C,a){C.uniform3iv(this.addr,a)}function rCe(C,a){C.uniform4iv(this.addr,a)}function nCe(C,a){C.uniform1uiv(this.addr,a)}function sCe(C,a){C.uniform2uiv(this.addr,a)}function aCe(C,a){C.uniform3uiv(this.addr,a)}function oCe(C,a){C.uniform4uiv(this.addr,a)}function lCe(C,a,h){const A=this.cache,b=a.length,E=LE(h,b);ma(A,E)||(C.uniform1iv(this.addr,E),ga(A,E));for(let M=0;M!==b;++M)h.setTexture2D(a[M]||L9,E[M])}function cCe(C,a,h){const A=this.cache,b=a.length,E=LE(h,b);ma(A,E)||(C.uniform1iv(this.addr,E),ga(A,E));for(let M=0;M!==b;++M)h.setTexture3D(a[M]||P9,E[M])}function uCe(C,a,h){const A=this.cache,b=a.length,E=LE(h,b);ma(A,E)||(C.uniform1iv(this.addr,E),ga(A,E));for(let M=0;M!==b;++M)h.setTextureCube(a[M]||F9,E[M])}function hCe(C,a,h){const A=this.cache,b=a.length,E=LE(h,b);ma(A,E)||(C.uniform1iv(this.addr,E),ga(A,E));for(let M=0;M!==b;++M)h.setTexture2DArray(a[M]||O9,E[M])}function dCe(C){switch(C){case 5126:return q2e;case 35664:return X2e;case 35665:return Y2e;case 35666:return K2e;case 35674:return J2e;case 35675:return Z2e;case 35676:return $2e;case 5124:case 35670:return eCe;case 35667:case 35671:return tCe;case 35668:case 35672:return iCe;case 35669:case 35673:return rCe;case 5125:return nCe;case 36294:return sCe;case 36295:return aCe;case 36296:return oCe;case 35678:case 36198:case 36298:case 36306:case 35682:return lCe;case 35679:case 36299:case 36307:return cCe;case 35680:case 36300:case 36308:case 36293:return uCe;case 36289:case 36303:case 36311:case 36292:return hCe}}class pCe{constructor(a,h,A){this.id=a,this.addr=A,this.cache=[],this.type=h.type,this.setValue=Q2e(h.type)}}class fCe{constructor(a,h,A){this.id=a,this.addr=A,this.cache=[],this.type=h.type,this.size=h.size,this.setValue=dCe(h.type)}}class mCe{constructor(a){this.id=a,this.seq=[],this.map={}}setValue(a,h,A){const b=this.seq;for(let E=0,M=b.length;E!==M;++E){const N=b[E];N.setValue(a,h[N.id],A)}}}const PB=/(\w+)(\])?(\[|\.)?/g;function G9(C,a){C.seq.push(a),C.map[a.id]=a}function gCe(C,a,h){const A=C.name,b=A.length;for(PB.lastIndex=0;;){const E=PB.exec(A),M=PB.lastIndex;let N=E[1];const P=E[2]==="]",F=E[3];if(P&&(N=N|0),F===void 0||F==="["&&M+2===b){G9(h,F===void 0?new pCe(N,C,a):new fCe(N,C,a));break}else{let z=h.map[N];z===void 0&&(z=new mCe(N),G9(h,z)),h=z}}}class DE{constructor(a,h){this.seq=[],this.map={};const A=a.getProgramParameter(h,a.ACTIVE_UNIFORMS);for(let b=0;b<A;++b){const E=a.getActiveUniform(h,b),M=a.getUniformLocation(h,E.name);gCe(E,M,this)}}setValue(a,h,A,b){const E=this.map[h];E!==void 0&&E.setValue(a,A,b)}setOptional(a,h,A){const b=h[A];b!==void 0&&this.setValue(a,A,b)}static upload(a,h,A,b){for(let E=0,M=h.length;E!==M;++E){const N=h[E],P=A[N.id];P.needsUpdate!==!1&&N.setValue(a,P.value,b)}}static seqWithValue(a,h){const A=[];for(let b=0,E=a.length;b!==E;++b){const M=a[b];M.id in h&&A.push(M)}return A}}function H9(C,a,h){const A=C.createShader(a);return C.shaderSource(A,h),C.compileShader(A),A}const ACe=37297;let yCe=0;function vCe(C,a){const h=C.split(`
`),A=[],b=Math.max(a-6,0),E=Math.min(a+6,h.length);for(let M=b;M<E;M++){const N=M+1;A.push(`${N===a?">":" "} ${N}: ${h[M]}`)}return A.join(`
`)}function xCe(C){const a=Xn.getPrimaries(Xn.workingColorSpace),h=Xn.getPrimaries(C);let A;switch(a===h?A="":a===$p&&h===Zp?A="LinearDisplayP3ToLinearSRGB":a===Zp&&h===$p&&(A="LinearSRGBToLinearDisplayP3"),C){case Ec:case Kp:return[A,"LinearTransferOETF"];case Ln:case jg:return[A,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",C),[A,"LinearTransferOETF"]}}function W9(C,a,h){const A=C.getShaderParameter(a,C.COMPILE_STATUS),b=C.getShaderInfoLog(a).trim();if(A&&b==="")return"";const E=/ERROR: 0:(\d+)/.exec(b);if(E){const M=parseInt(E[1]);return h.toUpperCase()+`

`+b+`

`+vCe(C.getShaderSource(a),M)}else return b}function bCe(C,a){const h=xCe(a);return`vec4 ${C}( vec4 value ) { return ${h[0]}( ${h[1]}( value ) ); }`}function _Ce(C,a){let h;switch(a){case Jt:h="Linear";break;case zt:h="Reinhard";break;case xi:h="OptimizedCineon";break;case vt:h="ACESFilmic";break;case ve:h="AgX";break;case Le:h="Neutral";break;case ye:h="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",a),h="Linear"}return"vec3 "+C+"( vec3 color ) { return "+h+"ToneMapping( color ); }"}function ECe(C){return[C.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",C.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ov).join(`
`)}function wCe(C){const a=[];for(const h in C){const A=C[h];A!==!1&&a.push("#define "+h+" "+A)}return a.join(`
`)}function CCe(C,a){const h={},A=C.getProgramParameter(a,C.ACTIVE_ATTRIBUTES);for(let b=0;b<A;b++){const E=C.getActiveAttrib(a,b),M=E.name;let N=1;E.type===C.FLOAT_MAT2&&(N=2),E.type===C.FLOAT_MAT3&&(N=3),E.type===C.FLOAT_MAT4&&(N=4),h[M]={type:E.type,location:C.getAttribLocation(a,M),locationSize:N}}return h}function ov(C){return C!==""}function Q9(C,a){const h=a.numSpotLightShadows+a.numSpotLightMaps-a.numSpotLightShadowsWithMaps;return C.replace(/NUM_DIR_LIGHTS/g,a.numDirLights).replace(/NUM_SPOT_LIGHTS/g,a.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,a.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,h).replace(/NUM_RECT_AREA_LIGHTS/g,a.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,a.numPointLights).replace(/NUM_HEMI_LIGHTS/g,a.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,a.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,a.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,a.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,a.numPointLightShadows)}function q9(C,a){return C.replace(/NUM_CLIPPING_PLANES/g,a.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,a.numClippingPlanes-a.numClipIntersection)}const SCe=/^[ \t]*#include +<([\w\d./]+)>/gm;function FB(C){return C.replace(SCe,MCe)}const TCe=new Map;function MCe(C,a){let h=sn[a];if(h===void 0){const A=TCe.get(a);if(A!==void 0)h=sn[A],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',a,A);else throw new Error("Can not resolve #include <"+a+">")}return FB(h)}const RCe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function X9(C){return C.replace(RCe,ICe)}function ICe(C,a,h,A){let b="";for(let E=parseInt(a);E<parseInt(h);E++)b+=A.replace(/\[\s*i\s*\]/g,"[ "+E+" ]").replace(/UNROLLED_LOOP_INDEX/g,E);return b}function Y9(C){let a=`precision ${C.precision} float;
	precision ${C.precision} int;
	precision ${C.precision} sampler2D;
	precision ${C.precision} samplerCube;
	precision ${C.precision} sampler3D;
	precision ${C.precision} sampler2DArray;
	precision ${C.precision} sampler2DShadow;
	precision ${C.precision} samplerCubeShadow;
	precision ${C.precision} sampler2DArrayShadow;
	precision ${C.precision} isampler2D;
	precision ${C.precision} isampler3D;
	precision ${C.precision} isamplerCube;
	precision ${C.precision} isampler2DArray;
	precision ${C.precision} usampler2D;
	precision ${C.precision} usampler3D;
	precision ${C.precision} usamplerCube;
	precision ${C.precision} usampler2DArray;
	`;return C.precision==="highp"?a+=`
#define HIGH_PRECISION`:C.precision==="mediump"?a+=`
#define MEDIUM_PRECISION`:C.precision==="lowp"&&(a+=`
#define LOW_PRECISION`),a}function BCe(C){let a="SHADOWMAP_TYPE_BASIC";return C.shadowMapType===_?a="SHADOWMAP_TYPE_PCF":C.shadowMapType===T?a="SHADOWMAP_TYPE_PCF_SOFT":C.shadowMapType===w&&(a="SHADOWMAP_TYPE_VSM"),a}function NCe(C){let a="ENVMAP_TYPE_CUBE";if(C.envMap)switch(C.envMapMode){case k:case Z:a="ENVMAP_TYPE_CUBE";break;case ce:a="ENVMAP_TYPE_CUBE_UV";break}return a}function LCe(C){let a="ENVMAP_MODE_REFLECTION";if(C.envMap)switch(C.envMapMode){case Z:a="ENVMAP_MODE_REFRACTION";break}return a}function DCe(C){let a="ENVMAP_BLENDING_NONE";if(C.envMap)switch(C.combine){case Qe:a="ENVMAP_BLENDING_MULTIPLY";break;case Ce:a="ENVMAP_BLENDING_MIX";break;case yt:a="ENVMAP_BLENDING_ADD";break}return a}function OCe(C){const a=C.envMapCubeUVHeight;if(a===null)return null;const h=Math.log2(a)-2,A=1/a;return{texelWidth:1/(3*Math.max(Math.pow(2,h),112)),texelHeight:A,maxMip:h}}function PCe(C,a,h,A){const b=C.getContext(),E=h.defines;let M=h.vertexShader,N=h.fragmentShader;const P=BCe(h),F=NCe(h),z=LCe(h),X=DCe(h),q=OCe(h),K=ECe(h),te=wCe(E),oe=b.createProgram();let ne,ee,Me=h.glslVersion?"#version "+h.glslVersion+`
`:"";const we=h.numMultiviewViews;h.isRawShaderMaterial?(ne=["#define SHADER_TYPE "+h.shaderType,"#define SHADER_NAME "+h.shaderName,te].filter(ov).join(`
`),ne.length>0&&(ne+=`
`),ee=["#define SHADER_TYPE "+h.shaderType,"#define SHADER_NAME "+h.shaderName,te].filter(ov).join(`
`),ee.length>0&&(ee+=`
`)):(ne=[Y9(h),"#define SHADER_TYPE "+h.shaderType,"#define SHADER_NAME "+h.shaderName,te,h.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",h.batching?"#define USE_BATCHING":"",h.instancing?"#define USE_INSTANCING":"",h.instancingColor?"#define USE_INSTANCING_COLOR":"",h.instancingMorph?"#define USE_INSTANCING_MORPH":"",h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp2?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+z:"",h.lightMap?"#define USE_LIGHTMAP":"",h.aoMap?"#define USE_AOMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",h.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",h.displacementMap?"#define USE_DISPLACEMENTMAP":"",h.emissiveMap?"#define USE_EMISSIVEMAP":"",h.anisotropy?"#define USE_ANISOTROPY":"",h.anisotropyMap?"#define USE_ANISOTROPYMAP":"",h.clearcoatMap?"#define USE_CLEARCOATMAP":"",h.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",h.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",h.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",h.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",h.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",h.roughnessMap?"#define USE_ROUGHNESSMAP":"",h.metalnessMap?"#define USE_METALNESSMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.alphaHash?"#define USE_ALPHAHASH":"",h.transmission?"#define USE_TRANSMISSION":"",h.transmissionMap?"#define USE_TRANSMISSIONMAP":"",h.thicknessMap?"#define USE_THICKNESSMAP":"",h.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",h.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",h.mapUv?"#define MAP_UV "+h.mapUv:"",h.alphaMapUv?"#define ALPHAMAP_UV "+h.alphaMapUv:"",h.lightMapUv?"#define LIGHTMAP_UV "+h.lightMapUv:"",h.aoMapUv?"#define AOMAP_UV "+h.aoMapUv:"",h.emissiveMapUv?"#define EMISSIVEMAP_UV "+h.emissiveMapUv:"",h.bumpMapUv?"#define BUMPMAP_UV "+h.bumpMapUv:"",h.normalMapUv?"#define NORMALMAP_UV "+h.normalMapUv:"",h.displacementMapUv?"#define DISPLACEMENTMAP_UV "+h.displacementMapUv:"",h.metalnessMapUv?"#define METALNESSMAP_UV "+h.metalnessMapUv:"",h.roughnessMapUv?"#define ROUGHNESSMAP_UV "+h.roughnessMapUv:"",h.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+h.anisotropyMapUv:"",h.clearcoatMapUv?"#define CLEARCOATMAP_UV "+h.clearcoatMapUv:"",h.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+h.clearcoatNormalMapUv:"",h.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+h.clearcoatRoughnessMapUv:"",h.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+h.iridescenceMapUv:"",h.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+h.iridescenceThicknessMapUv:"",h.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+h.sheenColorMapUv:"",h.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+h.sheenRoughnessMapUv:"",h.specularMapUv?"#define SPECULARMAP_UV "+h.specularMapUv:"",h.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+h.specularColorMapUv:"",h.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+h.specularIntensityMapUv:"",h.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+h.transmissionMapUv:"",h.thicknessMapUv?"#define THICKNESSMAP_UV "+h.thicknessMapUv:"",h.vertexTangents&&h.flatShading===!1?"#define USE_TANGENT":"",h.vertexColors?"#define USE_COLOR":"",h.vertexAlphas?"#define USE_COLOR_ALPHA":"",h.vertexUv1s?"#define USE_UV1":"",h.vertexUv2s?"#define USE_UV2":"",h.vertexUv3s?"#define USE_UV3":"",h.pointsUvs?"#define USE_POINTS_UV":"",h.flatShading?"#define FLAT_SHADED":"",h.skinning?"#define USE_SKINNING":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals&&h.flatShading===!1?"#define USE_MORPHNORMALS":"",h.morphColors?"#define USE_MORPHCOLORS":"",h.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",h.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+h.morphTextureStride:"",h.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+h.morphTargetsCount:"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+P:"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"",h.numLightProbes>0?"#define USE_LIGHT_PROBES":"",h.useLegacyLights?"#define LEGACY_LIGHTS":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ov).join(`
`),ee=[Y9(h),"#define SHADER_TYPE "+h.shaderType,"#define SHADER_NAME "+h.shaderName,te,h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp2?"#define FOG_EXP2":"",h.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",h.map?"#define USE_MAP":"",h.matcap?"#define USE_MATCAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+F:"",h.envMap?"#define "+z:"",h.envMap?"#define "+X:"",q?"#define CUBEUV_TEXEL_WIDTH "+q.texelWidth:"",q?"#define CUBEUV_TEXEL_HEIGHT "+q.texelHeight:"",q?"#define CUBEUV_MAX_MIP "+q.maxMip+".0":"",h.lightMap?"#define USE_LIGHTMAP":"",h.aoMap?"#define USE_AOMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",h.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",h.emissiveMap?"#define USE_EMISSIVEMAP":"",h.anisotropy?"#define USE_ANISOTROPY":"",h.anisotropyMap?"#define USE_ANISOTROPYMAP":"",h.clearcoat?"#define USE_CLEARCOAT":"",h.clearcoatMap?"#define USE_CLEARCOATMAP":"",h.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",h.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",h.dispersion?"#define USE_DISPERSION":"",h.iridescence?"#define USE_IRIDESCENCE":"",h.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",h.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",h.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",h.roughnessMap?"#define USE_ROUGHNESSMAP":"",h.metalnessMap?"#define USE_METALNESSMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.alphaTest?"#define USE_ALPHATEST":"",h.alphaHash?"#define USE_ALPHAHASH":"",h.sheen?"#define USE_SHEEN":"",h.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",h.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",h.transmission?"#define USE_TRANSMISSION":"",h.transmissionMap?"#define USE_TRANSMISSIONMAP":"",h.thicknessMap?"#define USE_THICKNESSMAP":"",h.vertexTangents&&h.flatShading===!1?"#define USE_TANGENT":"",h.vertexColors||h.instancingColor?"#define USE_COLOR":"",h.vertexAlphas?"#define USE_COLOR_ALPHA":"",h.vertexUv1s?"#define USE_UV1":"",h.vertexUv2s?"#define USE_UV2":"",h.vertexUv3s?"#define USE_UV3":"",h.pointsUvs?"#define USE_POINTS_UV":"",h.gradientMap?"#define USE_GRADIENTMAP":"",h.flatShading?"#define FLAT_SHADED":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+P:"",h.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",h.numLightProbes>0?"#define USE_LIGHT_PROBES":"",h.useLegacyLights?"#define LEGACY_LIGHTS":"",h.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",h.toneMapping!==Ot?"#define TONE_MAPPING":"",h.toneMapping!==Ot?sn.tonemapping_pars_fragment:"",h.toneMapping!==Ot?_Ce("toneMapping",h.toneMapping):"",h.dithering?"#define DITHERING":"",h.opaque?"#define OPAQUE":"",sn.colorspace_pars_fragment,bCe("linearToOutputTexel",h.outputColorSpace),h.useDepthPacking?"#define DEPTH_PACKING "+h.depthPacking:"",`
`].filter(ov).join(`
`)),M=FB(M),M=Q9(M,h),M=q9(M,h),N=FB(N),N=Q9(N,h),N=q9(N,h),M=X9(M),N=X9(N),h.isRawShaderMaterial!==!0&&(Me=`#version 300 es
`,ne=[K,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ne,ee=["#define varying in",h.glslVersion===Ky?"":"layout(location = 0) out highp vec4 pc_fragColor;",h.glslVersion===Ky?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ee,we>0&&(ne=["#extension GL_OVR_multiview : require","layout(num_views = "+we+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+ne,ne=ne.replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+we+"];","uniform mat4 projectionMatrices["+we+"];","uniform mat4 viewMatrices["+we+"];","uniform mat3 normalMatrices["+we+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),ee=["#extension GL_OVR_multiview : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+ee,ee=ee.replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+we+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`))));const _e=Me+ne+M,nt=Me+ee+N,qe=H9(b,b.VERTEX_SHADER,_e),Je=H9(b,b.FRAGMENT_SHADER,nt);b.attachShader(oe,qe),b.attachShader(oe,Je),h.index0AttributeName!==void 0?b.bindAttribLocation(oe,0,h.index0AttributeName):h.morphTargets===!0&&b.bindAttribLocation(oe,0,"position"),b.linkProgram(oe);function it(mt){if(C.debug.checkShaderErrors){const pt=b.getProgramInfoLog(oe).trim(),Tt=b.getShaderInfoLog(qe).trim(),Pt=b.getShaderInfoLog(Je).trim();let ui=!0,Li=!0;if(b.getProgramParameter(oe,b.LINK_STATUS)===!1)if(ui=!1,typeof C.debug.onShaderError=="function")C.debug.onShaderError(b,oe,qe,Je);else{const Ft=W9(b,qe,"vertex"),gi=W9(b,Je,"fragment");console.error("THREE.WebGLProgram: Shader Error "+b.getError()+" - VALIDATE_STATUS "+b.getProgramParameter(oe,b.VALIDATE_STATUS)+`

Material Name: `+mt.name+`
Material Type: `+mt.type+`

Program Info Log: `+pt+`
`+Ft+`
`+gi)}else pt!==""?console.warn("THREE.WebGLProgram: Program Info Log:",pt):(Tt===""||Pt==="")&&(Li=!1);Li&&(mt.diagnostics={runnable:ui,programLog:pt,vertexShader:{log:Tt,prefix:ne},fragmentShader:{log:Pt,prefix:ee}})}b.deleteShader(qe),b.deleteShader(Je),ze=new DE(b,oe),Oe=CCe(b,oe)}let ze;this.getUniforms=function(){return ze===void 0&&it(this),ze};let Oe;this.getAttributes=function(){return Oe===void 0&&it(this),Oe};let rt=h.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return rt===!1&&(rt=b.getProgramParameter(oe,ACe)),rt},this.destroy=function(){A.releaseStatesOfProgram(this),b.deleteProgram(oe),this.program=void 0},this.type=h.shaderType,this.name=h.shaderName,this.id=yCe++,this.cacheKey=a,this.usedTimes=1,this.program=oe,this.vertexShader=qe,this.fragmentShader=Je,this.numMultiviewViews=we,this}let FCe=0;class kCe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(a){const h=a.vertexShader,A=a.fragmentShader,b=this._getShaderStage(h),E=this._getShaderStage(A),M=this._getShaderCacheForMaterial(a);return M.has(b)===!1&&(M.add(b),b.usedTimes++),M.has(E)===!1&&(M.add(E),E.usedTimes++),this}remove(a){const h=this.materialCache.get(a);for(const A of h)A.usedTimes--,A.usedTimes===0&&this.shaderCache.delete(A.code);return this.materialCache.delete(a),this}getVertexShaderID(a){return this._getShaderStage(a.vertexShader).id}getFragmentShaderID(a){return this._getShaderStage(a.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(a){const h=this.materialCache;let A=h.get(a);return A===void 0&&(A=new Set,h.set(a,A)),A}_getShaderStage(a){const h=this.shaderCache;let A=h.get(a);return A===void 0&&(A=new UCe(a),h.set(a,A)),A}}class UCe{constructor(a){this.id=FCe++,this.code=a,this.usedTimes=0}}function zCe(C,a,h,A,b,E,M){const N=new gE,P=new kCe,F=new Set,z=[],X=b.logarithmicDepthBuffer,q=b.vertexTextures;let K=b.precision;const te={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function oe(ze){return F.add(ze),ze===0?"uv":`uv${ze}`}function ne(ze,Oe,rt,mt,pt){const Tt=mt.fog,Pt=pt.geometry,ui=ze.isMeshStandardMaterial?mt.environment:null,Li=(ze.isMeshStandardMaterial?h:a).get(ze.envMap||ui),Ft=Li&&Li.mapping===ce?Li.image.height:null,gi=te[ze.type];ze.precision!==null&&(K=b.getMaxPrecision(ze.precision),K!==ze.precision&&console.warn("THREE.WebGLProgram.getParameters:",ze.precision,"not supported, using",K,"instead."));const Di=Pt.morphAttributes.position||Pt.morphAttributes.normal||Pt.morphAttributes.color,kr=Di!==void 0?Di.length:0;let xn=0;Pt.morphAttributes.position!==void 0&&(xn=1),Pt.morphAttributes.normal!==void 0&&(xn=2),Pt.morphAttributes.color!==void 0&&(xn=3);let es,hs,Un,In;if(gi){const Ul=Sc[gi];es=Ul.vertexShader,hs=Ul.fragmentShader}else es=ze.vertexShader,hs=ze.fragmentShader,P.update(ze),Un=P.getVertexShaderID(ze),In=P.getFragmentShaderID(ze);const wr=C.getRenderTarget(),li=wr&&wr.isWebGLMultiviewRenderTarget?wr.numViews:0,_i=pt.isInstancedMesh===!0,Qi=pt.isBatchedMesh===!0,tt=!!ze.map,pi=!!ze.matcap,$t=!!Li,Zi=!!ze.aoMap,ai=!!ze.lightMap,er=!!ze.bumpMap,$i=!!ze.normalMap,Ar=!!ze.displacementMap,gn=!!ze.emissiveMap,Hr=!!ze.metalnessMap,aa=!!ze.roughnessMap,Hs=ze.anisotropy>0,Gn=ze.clearcoat>0,et=ze.dispersion>0,De=ze.iridescence>0,kt=ze.sheen>0,ci=ze.transmission>0,fi=Hs&&!!ze.anisotropyMap,si=Gn&&!!ze.clearcoatMap,Mr=Gn&&!!ze.clearcoatNormalMap,Ui=Gn&&!!ze.clearcoatRoughnessMap,cr=De&&!!ze.iridescenceMap,Hn=De&&!!ze.iridescenceThicknessMap,lr=kt&&!!ze.sheenColorMap,_r=kt&&!!ze.sheenRoughnessMap,bn=!!ze.specularMap,Ur=!!ze.specularColorMap,ut=!!ze.specularIntensityMap,Ai=ci&&!!ze.transmissionMap,Ti=ci&&!!ze.thicknessMap,Tr=!!ze.gradientMap,rr=!!ze.alphaMap,an=ze.alphaTest>0,nr=!!ze.alphaHash,Ki=!!ze.extensions;let An=Ot;ze.toneMapped&&(wr===null||wr.isXRRenderTarget===!0)&&(An=C.toneMapping);const Rr={shaderID:gi,shaderType:ze.type,shaderName:ze.name,vertexShader:es,fragmentShader:hs,defines:ze.defines,customVertexShaderID:Un,customFragmentShaderID:In,isRawShaderMaterial:ze.isRawShaderMaterial===!0,glslVersion:ze.glslVersion,precision:K,batching:Qi,instancing:_i,instancingColor:_i&&pt.instanceColor!==null,instancingMorph:_i&&pt.morphTexture!==null,supportsVertexTextures:q,numMultiviewViews:li,outputColorSpace:wr===null?C.outputColorSpace:wr.isXRRenderTarget===!0?wr.texture.colorSpace:Ec,alphaToCoverage:!!ze.alphaToCoverage,map:tt,matcap:pi,envMap:$t,envMapMode:$t&&Li.mapping,envMapCubeUVHeight:Ft,aoMap:Zi,lightMap:ai,bumpMap:er,normalMap:$i,displacementMap:q&&Ar,emissiveMap:gn,normalMapObjectSpace:$i&&ze.normalMapType===Xc,normalMapTangentSpace:$i&&ze.normalMapType===io,metalnessMap:Hr,roughnessMap:aa,anisotropy:Hs,anisotropyMap:fi,clearcoat:Gn,clearcoatMap:si,clearcoatNormalMap:Mr,clearcoatRoughnessMap:Ui,dispersion:et,iridescence:De,iridescenceMap:cr,iridescenceThicknessMap:Hn,sheen:kt,sheenColorMap:lr,sheenRoughnessMap:_r,specularMap:bn,specularColorMap:Ur,specularIntensityMap:ut,transmission:ci,transmissionMap:Ai,thicknessMap:Ti,gradientMap:Tr,opaque:ze.transparent===!1&&ze.blending===D&&ze.alphaToCoverage===!1,alphaMap:rr,alphaTest:an,alphaHash:nr,combine:ze.combine,mapUv:tt&&oe(ze.map.channel),aoMapUv:Zi&&oe(ze.aoMap.channel),lightMapUv:ai&&oe(ze.lightMap.channel),bumpMapUv:er&&oe(ze.bumpMap.channel),normalMapUv:$i&&oe(ze.normalMap.channel),displacementMapUv:Ar&&oe(ze.displacementMap.channel),emissiveMapUv:gn&&oe(ze.emissiveMap.channel),metalnessMapUv:Hr&&oe(ze.metalnessMap.channel),roughnessMapUv:aa&&oe(ze.roughnessMap.channel),anisotropyMapUv:fi&&oe(ze.anisotropyMap.channel),clearcoatMapUv:si&&oe(ze.clearcoatMap.channel),clearcoatNormalMapUv:Mr&&oe(ze.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ui&&oe(ze.clearcoatRoughnessMap.channel),iridescenceMapUv:cr&&oe(ze.iridescenceMap.channel),iridescenceThicknessMapUv:Hn&&oe(ze.iridescenceThicknessMap.channel),sheenColorMapUv:lr&&oe(ze.sheenColorMap.channel),sheenRoughnessMapUv:_r&&oe(ze.sheenRoughnessMap.channel),specularMapUv:bn&&oe(ze.specularMap.channel),specularColorMapUv:Ur&&oe(ze.specularColorMap.channel),specularIntensityMapUv:ut&&oe(ze.specularIntensityMap.channel),transmissionMapUv:Ai&&oe(ze.transmissionMap.channel),thicknessMapUv:Ti&&oe(ze.thicknessMap.channel),alphaMapUv:rr&&oe(ze.alphaMap.channel),vertexTangents:!!Pt.attributes.tangent&&($i||Hs),vertexColors:ze.vertexColors,vertexAlphas:ze.vertexColors===!0&&!!Pt.attributes.color&&Pt.attributes.color.itemSize===4,pointsUvs:pt.isPoints===!0&&!!Pt.attributes.uv&&(tt||rr),fog:!!Tt,useFog:ze.fog===!0,fogExp2:!!Tt&&Tt.isFogExp2,flatShading:ze.flatShading===!0,sizeAttenuation:ze.sizeAttenuation===!0,logarithmicDepthBuffer:X,skinning:pt.isSkinnedMesh===!0,morphTargets:Pt.morphAttributes.position!==void 0,morphNormals:Pt.morphAttributes.normal!==void 0,morphColors:Pt.morphAttributes.color!==void 0,morphTargetsCount:kr,morphTextureStride:xn,numDirLights:Oe.directional.length,numPointLights:Oe.point.length,numSpotLights:Oe.spot.length,numSpotLightMaps:Oe.spotLightMap.length,numRectAreaLights:Oe.rectArea.length,numHemiLights:Oe.hemi.length,numDirLightShadows:Oe.directionalShadowMap.length,numPointLightShadows:Oe.pointShadowMap.length,numSpotLightShadows:Oe.spotShadowMap.length,numSpotLightShadowsWithMaps:Oe.numSpotLightShadowsWithMaps,numLightProbes:Oe.numLightProbes,numClippingPlanes:M.numPlanes,numClipIntersection:M.numIntersection,dithering:ze.dithering,shadowMapEnabled:C.shadowMap.enabled&&rt.length>0,shadowMapType:C.shadowMap.type,toneMapping:An,useLegacyLights:C._useLegacyLights,decodeVideoTexture:tt&&ze.map.isVideoTexture===!0&&Xn.getTransfer(ze.map.colorSpace)===os,premultipliedAlpha:ze.premultipliedAlpha,doubleSided:ze.side===B,flipSided:ze.side===R,useDepthPacking:ze.depthPacking>=0,depthPacking:ze.depthPacking||0,index0AttributeName:ze.index0AttributeName,extensionClipCullDistance:Ki&&ze.extensions.clipCullDistance===!0&&A.has("WEBGL_clip_cull_distance"),extensionMultiDraw:Ki&&ze.extensions.multiDraw===!0&&A.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:A.has("KHR_parallel_shader_compile"),customProgramCacheKey:ze.customProgramCacheKey()};return Rr.vertexUv1s=F.has(1),Rr.vertexUv2s=F.has(2),Rr.vertexUv3s=F.has(3),F.clear(),Rr}function ee(ze){const Oe=[];if(ze.shaderID?Oe.push(ze.shaderID):(Oe.push(ze.customVertexShaderID),Oe.push(ze.customFragmentShaderID)),ze.defines!==void 0)for(const rt in ze.defines)Oe.push(rt),Oe.push(ze.defines[rt]);return ze.isRawShaderMaterial===!1&&(Me(Oe,ze),we(Oe,ze),Oe.push(C.outputColorSpace)),Oe.push(ze.customProgramCacheKey),Oe.join()}function Me(ze,Oe){ze.push(Oe.precision),ze.push(Oe.outputColorSpace),ze.push(Oe.envMapMode),ze.push(Oe.envMapCubeUVHeight),ze.push(Oe.mapUv),ze.push(Oe.alphaMapUv),ze.push(Oe.lightMapUv),ze.push(Oe.aoMapUv),ze.push(Oe.bumpMapUv),ze.push(Oe.normalMapUv),ze.push(Oe.displacementMapUv),ze.push(Oe.emissiveMapUv),ze.push(Oe.metalnessMapUv),ze.push(Oe.roughnessMapUv),ze.push(Oe.anisotropyMapUv),ze.push(Oe.clearcoatMapUv),ze.push(Oe.clearcoatNormalMapUv),ze.push(Oe.clearcoatRoughnessMapUv),ze.push(Oe.iridescenceMapUv),ze.push(Oe.iridescenceThicknessMapUv),ze.push(Oe.sheenColorMapUv),ze.push(Oe.sheenRoughnessMapUv),ze.push(Oe.specularMapUv),ze.push(Oe.specularColorMapUv),ze.push(Oe.specularIntensityMapUv),ze.push(Oe.transmissionMapUv),ze.push(Oe.thicknessMapUv),ze.push(Oe.combine),ze.push(Oe.fogExp2),ze.push(Oe.sizeAttenuation),ze.push(Oe.morphTargetsCount),ze.push(Oe.morphAttributeCount),ze.push(Oe.numDirLights),ze.push(Oe.numPointLights),ze.push(Oe.numSpotLights),ze.push(Oe.numSpotLightMaps),ze.push(Oe.numHemiLights),ze.push(Oe.numRectAreaLights),ze.push(Oe.numDirLightShadows),ze.push(Oe.numPointLightShadows),ze.push(Oe.numSpotLightShadows),ze.push(Oe.numSpotLightShadowsWithMaps),ze.push(Oe.numLightProbes),ze.push(Oe.shadowMapType),ze.push(Oe.toneMapping),ze.push(Oe.numClippingPlanes),ze.push(Oe.numClipIntersection),ze.push(Oe.depthPacking)}function we(ze,Oe){N.disableAll(),Oe.supportsVertexTextures&&N.enable(0),Oe.instancing&&N.enable(1),Oe.instancingColor&&N.enable(2),Oe.instancingMorph&&N.enable(3),Oe.matcap&&N.enable(4),Oe.envMap&&N.enable(5),Oe.normalMapObjectSpace&&N.enable(6),Oe.normalMapTangentSpace&&N.enable(7),Oe.clearcoat&&N.enable(8),Oe.iridescence&&N.enable(9),Oe.alphaTest&&N.enable(10),Oe.vertexColors&&N.enable(11),Oe.vertexAlphas&&N.enable(12),Oe.vertexUv1s&&N.enable(13),Oe.vertexUv2s&&N.enable(14),Oe.vertexUv3s&&N.enable(15),Oe.vertexTangents&&N.enable(16),Oe.anisotropy&&N.enable(17),Oe.alphaHash&&N.enable(18),Oe.batching&&N.enable(19),Oe.dispersion&&N.enable(20),ze.push(N.mask),N.disableAll(),Oe.fog&&N.enable(0),Oe.useFog&&N.enable(1),Oe.flatShading&&N.enable(2),Oe.logarithmicDepthBuffer&&N.enable(3),Oe.skinning&&N.enable(4),Oe.morphTargets&&N.enable(5),Oe.morphNormals&&N.enable(6),Oe.morphColors&&N.enable(7),Oe.premultipliedAlpha&&N.enable(8),Oe.shadowMapEnabled&&N.enable(9),Oe.useLegacyLights&&N.enable(10),Oe.doubleSided&&N.enable(11),Oe.flipSided&&N.enable(12),Oe.useDepthPacking&&N.enable(13),Oe.dithering&&N.enable(14),Oe.transmission&&N.enable(15),Oe.sheen&&N.enable(16),Oe.opaque&&N.enable(17),Oe.pointsUvs&&N.enable(18),Oe.decodeVideoTexture&&N.enable(19),Oe.alphaToCoverage&&N.enable(20),Oe.numMultiviewViews&&N.enable(21),ze.push(N.mask)}function _e(ze){const Oe=te[ze.type];let rt;if(Oe){const mt=Sc[Oe];rt=_9.clone(mt.uniforms)}else rt=ze.uniforms;return rt}function nt(ze,Oe){let rt;for(let mt=0,pt=z.length;mt<pt;mt++){const Tt=z[mt];if(Tt.cacheKey===Oe){rt=Tt,++rt.usedTimes;break}}return rt===void 0&&(rt=new PCe(C,Oe,ze,E),z.push(rt)),rt}function qe(ze){if(--ze.usedTimes===0){const Oe=z.indexOf(ze);z[Oe]=z[z.length-1],z.pop(),ze.destroy()}}function Je(ze){P.remove(ze)}function it(){P.dispose()}return{getParameters:ne,getProgramCacheKey:ee,getUniforms:_e,acquireProgram:nt,releaseProgram:qe,releaseShaderCache:Je,programs:z,dispose:it}}function jCe(){let C=new WeakMap;function a(E){let M=C.get(E);return M===void 0&&(M={},C.set(E,M)),M}function h(E){C.delete(E)}function A(E,M,N){C.get(E)[M]=N}function b(){C=new WeakMap}return{get:a,remove:h,update:A,dispose:b}}function VCe(C,a){return C.groupOrder!==a.groupOrder?C.groupOrder-a.groupOrder:C.renderOrder!==a.renderOrder?C.renderOrder-a.renderOrder:C.material.id!==a.material.id?C.material.id-a.material.id:C.z!==a.z?C.z-a.z:C.id-a.id}function K9(C,a){return C.groupOrder!==a.groupOrder?C.groupOrder-a.groupOrder:C.renderOrder!==a.renderOrder?C.renderOrder-a.renderOrder:C.z!==a.z?a.z-C.z:C.id-a.id}function J9(){const C=[];let a=0;const h=[],A=[],b=[];function E(){a=0,h.length=0,A.length=0,b.length=0}function M(X,q,K,te,oe,ne){let ee=C[a];return ee===void 0?(ee={id:X.id,object:X,geometry:q,material:K,groupOrder:te,renderOrder:X.renderOrder,z:oe,group:ne},C[a]=ee):(ee.id=X.id,ee.object=X,ee.geometry=q,ee.material=K,ee.groupOrder=te,ee.renderOrder=X.renderOrder,ee.z=oe,ee.group=ne),a++,ee}function N(X,q,K,te,oe,ne){const ee=M(X,q,K,te,oe,ne);K.transmission>0?A.push(ee):K.transparent===!0?b.push(ee):h.push(ee)}function P(X,q,K,te,oe,ne){const ee=M(X,q,K,te,oe,ne);K.transmission>0?A.unshift(ee):K.transparent===!0?b.unshift(ee):h.unshift(ee)}function F(X,q){h.length>1&&h.sort(X||VCe),A.length>1&&A.sort(q||K9),b.length>1&&b.sort(q||K9)}function z(){for(let X=a,q=C.length;X<q;X++){const K=C[X];if(K.id===null)break;K.id=null,K.object=null,K.geometry=null,K.material=null,K.group=null}}return{opaque:h,transmissive:A,transparent:b,init:E,push:N,unshift:P,finish:z,sort:F}}function GCe(){let C=new WeakMap;function a(A,b){const E=C.get(A);let M;return E===void 0?(M=new J9,C.set(A,[M])):b>=E.length?(M=new J9,E.push(M)):M=E[b],M}function h(){C=new WeakMap}return{get:a,dispose:h}}function HCe(){const C={};return{get:function(a){if(C[a.id]!==void 0)return C[a.id];let h;switch(a.type){case"DirectionalLight":h={direction:new He,color:new or};break;case"SpotLight":h={position:new He,direction:new He,color:new or,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":h={position:new He,color:new or,distance:0,decay:0};break;case"HemisphereLight":h={direction:new He,skyColor:new or,groundColor:new or};break;case"RectAreaLight":h={color:new or,position:new He,halfWidth:new He,halfHeight:new He};break}return C[a.id]=h,h}}}function WCe(){const C={};return{get:function(a){if(C[a.id]!==void 0)return C[a.id];let h;switch(a.type){case"DirectionalLight":h={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ni};break;case"SpotLight":h={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ni};break;case"PointLight":h={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ni,shadowCameraNear:1,shadowCameraFar:1e3};break}return C[a.id]=h,h}}}let QCe=0;function qCe(C,a){return(a.castShadow?2:0)-(C.castShadow?2:0)+(a.map?1:0)-(C.map?1:0)}function XCe(C){const a=new HCe,h=WCe(),A={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let F=0;F<9;F++)A.probe.push(new He);const b=new He,E=new fr,M=new fr;function N(F,z){let X=0,q=0,K=0;for(let rt=0;rt<9;rt++)A.probe[rt].set(0,0,0);let te=0,oe=0,ne=0,ee=0,Me=0,we=0,_e=0,nt=0,qe=0,Je=0,it=0;F.sort(qCe);const ze=z===!0?Math.PI:1;for(let rt=0,mt=F.length;rt<mt;rt++){const pt=F[rt],Tt=pt.color,Pt=pt.intensity,ui=pt.distance,Li=pt.shadow&&pt.shadow.map?pt.shadow.map.texture:null;if(pt.isAmbientLight)X+=Tt.r*Pt*ze,q+=Tt.g*Pt*ze,K+=Tt.b*Pt*ze;else if(pt.isLightProbe){for(let Ft=0;Ft<9;Ft++)A.probe[Ft].addScaledVector(pt.sh.coefficients[Ft],Pt);it++}else if(pt.isDirectionalLight){const Ft=a.get(pt);if(Ft.color.copy(pt.color).multiplyScalar(pt.intensity*ze),pt.castShadow){const gi=pt.shadow,Di=h.get(pt);Di.shadowBias=gi.bias,Di.shadowNormalBias=gi.normalBias,Di.shadowRadius=gi.radius,Di.shadowMapSize=gi.mapSize,A.directionalShadow[te]=Di,A.directionalShadowMap[te]=Li,A.directionalShadowMatrix[te]=pt.shadow.matrix,we++}A.directional[te]=Ft,te++}else if(pt.isSpotLight){const Ft=a.get(pt);Ft.position.setFromMatrixPosition(pt.matrixWorld),Ft.color.copy(Tt).multiplyScalar(Pt*ze),Ft.distance=ui,Ft.coneCos=Math.cos(pt.angle),Ft.penumbraCos=Math.cos(pt.angle*(1-pt.penumbra)),Ft.decay=pt.decay,A.spot[ne]=Ft;const gi=pt.shadow;if(pt.map&&(A.spotLightMap[qe]=pt.map,qe++,gi.updateMatrices(pt),pt.castShadow&&Je++),A.spotLightMatrix[ne]=gi.matrix,pt.castShadow){const Di=h.get(pt);Di.shadowBias=gi.bias,Di.shadowNormalBias=gi.normalBias,Di.shadowRadius=gi.radius,Di.shadowMapSize=gi.mapSize,A.spotShadow[ne]=Di,A.spotShadowMap[ne]=Li,nt++}ne++}else if(pt.isRectAreaLight){const Ft=a.get(pt);Ft.color.copy(Tt).multiplyScalar(Pt),Ft.halfWidth.set(pt.width*.5,0,0),Ft.halfHeight.set(0,pt.height*.5,0),A.rectArea[ee]=Ft,ee++}else if(pt.isPointLight){const Ft=a.get(pt);if(Ft.color.copy(pt.color).multiplyScalar(pt.intensity*ze),Ft.distance=pt.distance,Ft.decay=pt.decay,pt.castShadow){const gi=pt.shadow,Di=h.get(pt);Di.shadowBias=gi.bias,Di.shadowNormalBias=gi.normalBias,Di.shadowRadius=gi.radius,Di.shadowMapSize=gi.mapSize,Di.shadowCameraNear=gi.camera.near,Di.shadowCameraFar=gi.camera.far,A.pointShadow[oe]=Di,A.pointShadowMap[oe]=Li,A.pointShadowMatrix[oe]=pt.shadow.matrix,_e++}A.point[oe]=Ft,oe++}else if(pt.isHemisphereLight){const Ft=a.get(pt);Ft.skyColor.copy(pt.color).multiplyScalar(Pt*ze),Ft.groundColor.copy(pt.groundColor).multiplyScalar(Pt*ze),A.hemi[Me]=Ft,Me++}}ee>0&&(C.has("OES_texture_float_linear")===!0?(A.rectAreaLTC1=Wi.LTC_FLOAT_1,A.rectAreaLTC2=Wi.LTC_FLOAT_2):(A.rectAreaLTC1=Wi.LTC_HALF_1,A.rectAreaLTC2=Wi.LTC_HALF_2)),A.ambient[0]=X,A.ambient[1]=q,A.ambient[2]=K;const Oe=A.hash;(Oe.directionalLength!==te||Oe.pointLength!==oe||Oe.spotLength!==ne||Oe.rectAreaLength!==ee||Oe.hemiLength!==Me||Oe.numDirectionalShadows!==we||Oe.numPointShadows!==_e||Oe.numSpotShadows!==nt||Oe.numSpotMaps!==qe||Oe.numLightProbes!==it)&&(A.directional.length=te,A.spot.length=ne,A.rectArea.length=ee,A.point.length=oe,A.hemi.length=Me,A.directionalShadow.length=we,A.directionalShadowMap.length=we,A.pointShadow.length=_e,A.pointShadowMap.length=_e,A.spotShadow.length=nt,A.spotShadowMap.length=nt,A.directionalShadowMatrix.length=we,A.pointShadowMatrix.length=_e,A.spotLightMatrix.length=nt+qe-Je,A.spotLightMap.length=qe,A.numSpotLightShadowsWithMaps=Je,A.numLightProbes=it,Oe.directionalLength=te,Oe.pointLength=oe,Oe.spotLength=ne,Oe.rectAreaLength=ee,Oe.hemiLength=Me,Oe.numDirectionalShadows=we,Oe.numPointShadows=_e,Oe.numSpotShadows=nt,Oe.numSpotMaps=qe,Oe.numLightProbes=it,A.version=QCe++)}function P(F,z){let X=0,q=0,K=0,te=0,oe=0;const ne=z.matrixWorldInverse;for(let ee=0,Me=F.length;ee<Me;ee++){const we=F[ee];if(we.isDirectionalLight){const _e=A.directional[X];_e.direction.setFromMatrixPosition(we.matrixWorld),b.setFromMatrixPosition(we.target.matrixWorld),_e.direction.sub(b),_e.direction.transformDirection(ne),X++}else if(we.isSpotLight){const _e=A.spot[K];_e.position.setFromMatrixPosition(we.matrixWorld),_e.position.applyMatrix4(ne),_e.direction.setFromMatrixPosition(we.matrixWorld),b.setFromMatrixPosition(we.target.matrixWorld),_e.direction.sub(b),_e.direction.transformDirection(ne),K++}else if(we.isRectAreaLight){const _e=A.rectArea[te];_e.position.setFromMatrixPosition(we.matrixWorld),_e.position.applyMatrix4(ne),M.identity(),E.copy(we.matrixWorld),E.premultiply(ne),M.extractRotation(E),_e.halfWidth.set(we.width*.5,0,0),_e.halfHeight.set(0,we.height*.5,0),_e.halfWidth.applyMatrix4(M),_e.halfHeight.applyMatrix4(M),te++}else if(we.isPointLight){const _e=A.point[q];_e.position.setFromMatrixPosition(we.matrixWorld),_e.position.applyMatrix4(ne),q++}else if(we.isHemisphereLight){const _e=A.hemi[oe];_e.direction.setFromMatrixPosition(we.matrixWorld),_e.direction.transformDirection(ne),oe++}}}return{setup:N,setupView:P,state:A}}function Z9(C){const a=new XCe(C),h=[],A=[];function b(z){F.camera=z,h.length=0,A.length=0}function E(z){h.push(z)}function M(z){A.push(z)}function N(z){a.setup(h,z)}function P(z){a.setupView(h,z)}const F={lightsArray:h,shadowsArray:A,camera:null,lights:a,transmissionRenderTarget:{}};return{init:b,state:F,setupLights:N,setupLightsView:P,pushLight:E,pushShadow:M}}function YCe(C){let a=new WeakMap;function h(b,E=0){const M=a.get(b);let N;return M===void 0?(N=new Z9(C),a.set(b,[N])):E>=M.length?(N=new Z9(C),M.push(N)):N=M[E],N}function A(){a=new WeakMap}return{get:h,dispose:A}}class kB extends so{constructor(a){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Qc,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)}copy(a){return super.copy(a),this.depthPacking=a.depthPacking,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this}}class UB extends so{constructor(a){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(a)}copy(a){return super.copy(a),this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this}}const KCe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,JCe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function ZCe(C,a,h){let A=new av;const b=new ni,E=new ni,M=new Fn,N=new kB({depthPacking:qc}),P=new UB,F={},z=h.maxTextureSize,X={[S]:R,[R]:S,[B]:B},q=new Cc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ni},radius:{value:4}},vertexShader:KCe,fragmentShader:JCe}),K=q.clone();K.defines.HORIZONTAL_PASS=1;const te=new hn;te.setAttribute("position",new ns(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const oe=new sa(te,q),ne=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_;let ee=this.type;this.render=function(qe,Je,it){if(ne.enabled===!1||ne.autoUpdate===!1&&ne.needsUpdate===!1||qe.length===0)return;const ze=C.getRenderTarget(),Oe=C.getActiveCubeFace(),rt=C.getActiveMipmapLevel(),mt=C.state;mt.setBlending(I),mt.buffers.color.setClear(1,1,1,1),mt.buffers.depth.setTest(!0),mt.setScissorTest(!1);const pt=ee!==w&&this.type===w,Tt=ee===w&&this.type!==w;for(let Pt=0,ui=qe.length;Pt<ui;Pt++){const Li=qe[Pt],Ft=Li.shadow;if(Ft===void 0){console.warn("THREE.WebGLShadowMap:",Li,"has no shadow.");continue}if(Ft.autoUpdate===!1&&Ft.needsUpdate===!1)continue;b.copy(Ft.mapSize);const gi=Ft.getFrameExtents();if(b.multiply(gi),E.copy(Ft.mapSize),(b.x>z||b.y>z)&&(b.x>z&&(E.x=Math.floor(z/gi.x),b.x=E.x*gi.x,Ft.mapSize.x=E.x),b.y>z&&(E.y=Math.floor(z/gi.y),b.y=E.y*gi.y,Ft.mapSize.y=E.y)),Ft.map===null||pt===!0||Tt===!0){const kr=this.type!==w?{minFilter:Bt,magFilter:Bt}:{};Ft.map!==null&&Ft.map.dispose(),Ft.map=new Xo(b.x,b.y,kr),Ft.map.texture.name=Li.name+".shadowMap",Ft.camera.updateProjectionMatrix()}C.setRenderTarget(Ft.map),C.clear();const Di=Ft.getViewportCount();for(let kr=0;kr<Di;kr++){const xn=Ft.getViewport(kr);M.set(E.x*xn.x,E.y*xn.y,E.x*xn.z,E.y*xn.w),mt.viewport(M),Ft.updateMatrices(Li,kr),A=Ft.getFrustum(),_e(Je,it,Ft.camera,Li,this.type)}Ft.isPointLightShadow!==!0&&this.type===w&&Me(Ft,it),Ft.needsUpdate=!1}ee=this.type,ne.needsUpdate=!1,C.setRenderTarget(ze,Oe,rt)};function Me(qe,Je){const it=a.update(oe);q.defines.VSM_SAMPLES!==qe.blurSamples&&(q.defines.VSM_SAMPLES=qe.blurSamples,K.defines.VSM_SAMPLES=qe.blurSamples,q.needsUpdate=!0,K.needsUpdate=!0),qe.mapPass===null&&(qe.mapPass=new Xo(b.x,b.y)),q.uniforms.shadow_pass.value=qe.map.texture,q.uniforms.resolution.value=qe.mapSize,q.uniforms.radius.value=qe.radius,C.setRenderTarget(qe.mapPass),C.clear(),C.renderBufferDirect(Je,null,it,q,oe,null),K.uniforms.shadow_pass.value=qe.mapPass.texture,K.uniforms.resolution.value=qe.mapSize,K.uniforms.radius.value=qe.radius,C.setRenderTarget(qe.map),C.clear(),C.renderBufferDirect(Je,null,it,K,oe,null)}function we(qe,Je,it,ze){let Oe=null;const rt=it.isPointLight===!0?qe.customDistanceMaterial:qe.customDepthMaterial;if(rt!==void 0)Oe=rt;else if(Oe=it.isPointLight===!0?P:N,C.localClippingEnabled&&Je.clipShadows===!0&&Array.isArray(Je.clippingPlanes)&&Je.clippingPlanes.length!==0||Je.displacementMap&&Je.displacementScale!==0||Je.alphaMap&&Je.alphaTest>0||Je.map&&Je.alphaTest>0){const mt=Oe.uuid,pt=Je.uuid;let Tt=F[mt];Tt===void 0&&(Tt={},F[mt]=Tt);let Pt=Tt[pt];Pt===void 0&&(Pt=Oe.clone(),Tt[pt]=Pt,Je.addEventListener("dispose",nt)),Oe=Pt}if(Oe.visible=Je.visible,Oe.wireframe=Je.wireframe,ze===w?Oe.side=Je.shadowSide!==null?Je.shadowSide:Je.side:Oe.side=Je.shadowSide!==null?Je.shadowSide:X[Je.side],Oe.alphaMap=Je.alphaMap,Oe.alphaTest=Je.alphaTest,Oe.map=Je.map,Oe.clipShadows=Je.clipShadows,Oe.clippingPlanes=Je.clippingPlanes,Oe.clipIntersection=Je.clipIntersection,Oe.displacementMap=Je.displacementMap,Oe.displacementScale=Je.displacementScale,Oe.displacementBias=Je.displacementBias,Oe.wireframeLinewidth=Je.wireframeLinewidth,Oe.linewidth=Je.linewidth,it.isPointLight===!0&&Oe.isMeshDistanceMaterial===!0){const mt=C.properties.get(Oe);mt.light=it}return Oe}function _e(qe,Je,it,ze,Oe){if(qe.visible===!1)return;if(qe.layers.test(Je.layers)&&(qe.isMesh||qe.isLine||qe.isPoints)&&(qe.castShadow||qe.receiveShadow&&Oe===w)&&(!qe.frustumCulled||A.intersectsObject(qe))){qe.modelViewMatrix.multiplyMatrices(it.matrixWorldInverse,qe.matrixWorld);const mt=a.update(qe),pt=qe.material;if(Array.isArray(pt)){const Tt=mt.groups;for(let Pt=0,ui=Tt.length;Pt<ui;Pt++){const Li=Tt[Pt],Ft=pt[Li.materialIndex];if(Ft&&Ft.visible){const gi=we(qe,Ft,ze,Oe);qe.onBeforeShadow(C,qe,Je,it,mt,gi,Li),C.renderBufferDirect(it,null,mt,gi,qe,Li),qe.onAfterShadow(C,qe,Je,it,mt,gi,Li)}}}else if(pt.visible){const Tt=we(qe,pt,ze,Oe);qe.onBeforeShadow(C,qe,Je,it,mt,Tt,null),C.renderBufferDirect(it,null,mt,Tt,qe,null),qe.onAfterShadow(C,qe,Je,it,mt,Tt,null)}}const rt=qe.children;for(let mt=0,pt=rt.length;mt<pt;mt++)_e(rt[mt],Je,it,ze,Oe)}function nt(qe){qe.target.removeEventListener("dispose",nt);for(const Je in F){const it=F[Je],ze=qe.target.uuid;ze in it&&(it[ze].dispose(),delete it[ze])}}}function $Ce(C){function a(){let ut=!1;const Ai=new Fn;let Ti=null;const Tr=new Fn(0,0,0,0);return{setMask:function(rr){Ti!==rr&&!ut&&(C.colorMask(rr,rr,rr,rr),Ti=rr)},setLocked:function(rr){ut=rr},setClear:function(rr,an,nr,Ki,An){An===!0&&(rr*=Ki,an*=Ki,nr*=Ki),Ai.set(rr,an,nr,Ki),Tr.equals(Ai)===!1&&(C.clearColor(rr,an,nr,Ki),Tr.copy(Ai))},reset:function(){ut=!1,Ti=null,Tr.set(-1,0,0,0)}}}function h(){let ut=!1,Ai=null,Ti=null,Tr=null;return{setTest:function(rr){rr?In(C.DEPTH_TEST):wr(C.DEPTH_TEST)},setMask:function(rr){Ai!==rr&&!ut&&(C.depthMask(rr),Ai=rr)},setFunc:function(rr){if(Ti!==rr){switch(rr){case yi:C.depthFunc(C.NEVER);break;case Ze:C.depthFunc(C.ALWAYS);break;case ki:C.depthFunc(C.LESS);break;case hi:C.depthFunc(C.LEQUAL);break;case Ri:C.depthFunc(C.EQUAL);break;case Si:C.depthFunc(C.GEQUAL);break;case tr:C.depthFunc(C.GREATER);break;case Vi:C.depthFunc(C.NOTEQUAL);break;default:C.depthFunc(C.LEQUAL)}Ti=rr}},setLocked:function(rr){ut=rr},setClear:function(rr){Tr!==rr&&(C.clearDepth(rr),Tr=rr)},reset:function(){ut=!1,Ai=null,Ti=null,Tr=null}}}function A(){let ut=!1,Ai=null,Ti=null,Tr=null,rr=null,an=null,nr=null,Ki=null,An=null;return{setTest:function(Rr){ut||(Rr?In(C.STENCIL_TEST):wr(C.STENCIL_TEST))},setMask:function(Rr){Ai!==Rr&&!ut&&(C.stencilMask(Rr),Ai=Rr)},setFunc:function(Rr,Ul,$c){(Ti!==Rr||Tr!==Ul||rr!==$c)&&(C.stencilFunc(Rr,Ul,$c),Ti=Rr,Tr=Ul,rr=$c)},setOp:function(Rr,Ul,$c){(an!==Rr||nr!==Ul||Ki!==$c)&&(C.stencilOp(Rr,Ul,$c),an=Rr,nr=Ul,Ki=$c)},setLocked:function(Rr){ut=Rr},setClear:function(Rr){An!==Rr&&(C.clearStencil(Rr),An=Rr)},reset:function(){ut=!1,Ai=null,Ti=null,Tr=null,rr=null,an=null,nr=null,Ki=null,An=null}}}const b=new a,E=new h,M=new A,N=new WeakMap,P=new WeakMap;let F={},z={},X=new WeakMap,q=[],K=null,te=!1,oe=null,ne=null,ee=null,Me=null,we=null,_e=null,nt=null,qe=new or(0,0,0),Je=0,it=!1,ze=null,Oe=null,rt=null,mt=null,pt=null;const Tt=C.getParameter(C.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Pt=!1,ui=0;const Li=C.getParameter(C.VERSION);Li.indexOf("WebGL")!==-1?(ui=parseFloat(/^WebGL (\d)/.exec(Li)[1]),Pt=ui>=1):Li.indexOf("OpenGL ES")!==-1&&(ui=parseFloat(/^OpenGL ES (\d)/.exec(Li)[1]),Pt=ui>=2);let Ft=null,gi={};const Di=C.getParameter(C.SCISSOR_BOX),kr=C.getParameter(C.VIEWPORT),xn=new Fn().fromArray(Di),es=new Fn().fromArray(kr);function hs(ut,Ai,Ti,Tr){const rr=new Uint8Array(4),an=C.createTexture();C.bindTexture(ut,an),C.texParameteri(ut,C.TEXTURE_MIN_FILTER,C.NEAREST),C.texParameteri(ut,C.TEXTURE_MAG_FILTER,C.NEAREST);for(let nr=0;nr<Ti;nr++)ut===C.TEXTURE_3D||ut===C.TEXTURE_2D_ARRAY?C.texImage3D(Ai,0,C.RGBA,1,1,Tr,0,C.RGBA,C.UNSIGNED_BYTE,rr):C.texImage2D(Ai+nr,0,C.RGBA,1,1,0,C.RGBA,C.UNSIGNED_BYTE,rr);return an}const Un={};Un[C.TEXTURE_2D]=hs(C.TEXTURE_2D,C.TEXTURE_2D,1),Un[C.TEXTURE_CUBE_MAP]=hs(C.TEXTURE_CUBE_MAP,C.TEXTURE_CUBE_MAP_POSITIVE_X,6),Un[C.TEXTURE_2D_ARRAY]=hs(C.TEXTURE_2D_ARRAY,C.TEXTURE_2D_ARRAY,1,1),Un[C.TEXTURE_3D]=hs(C.TEXTURE_3D,C.TEXTURE_3D,1,1),b.setClear(0,0,0,1),E.setClear(1),M.setClear(0),In(C.DEPTH_TEST),E.setFunc(hi),ai(!1),er(g),In(C.CULL_FACE),$t(I);function In(ut){F[ut]!==!0&&(C.enable(ut),F[ut]=!0)}function wr(ut){F[ut]!==!1&&(C.disable(ut),F[ut]=!1)}function li(ut,Ai){return z[ut]!==Ai?(C.bindFramebuffer(ut,Ai),z[ut]=Ai,ut===C.DRAW_FRAMEBUFFER&&(z[C.FRAMEBUFFER]=Ai),ut===C.FRAMEBUFFER&&(z[C.DRAW_FRAMEBUFFER]=Ai),!0):!1}function _i(ut,Ai){let Ti=q,Tr=!1;if(ut){Ti=X.get(Ai),Ti===void 0&&(Ti=[],X.set(Ai,Ti));const rr=ut.textures;if(Ti.length!==rr.length||Ti[0]!==C.COLOR_ATTACHMENT0){for(let an=0,nr=rr.length;an<nr;an++)Ti[an]=C.COLOR_ATTACHMENT0+an;Ti.length=rr.length,Tr=!0}}else Ti[0]!==C.BACK&&(Ti[0]=C.BACK,Tr=!0);Tr&&C.drawBuffers(Ti)}function Qi(ut){return K!==ut?(C.useProgram(ut),K=ut,!0):!1}const tt={[H]:C.FUNC_ADD,[V]:C.FUNC_SUBTRACT,[$]:C.FUNC_REVERSE_SUBTRACT};tt[Q]=C.MIN,tt[G]=C.MAX;const pi={[j]:C.ZERO,[ie]:C.ONE,[Y]:C.SRC_COLOR,[xe]:C.SRC_ALPHA,[$e]:C.SRC_ALPHA_SATURATE,[Ge]:C.DST_COLOR,[de]:C.DST_ALPHA,[ae]:C.ONE_MINUS_SRC_COLOR,[fe]:C.ONE_MINUS_SRC_ALPHA,[Xe]:C.ONE_MINUS_DST_COLOR,[Ie]:C.ONE_MINUS_DST_ALPHA,[lt]:C.CONSTANT_COLOR,[At]:C.ONE_MINUS_CONSTANT_COLOR,[Gt]:C.CONSTANT_ALPHA,[gt]:C.ONE_MINUS_CONSTANT_ALPHA};function $t(ut,Ai,Ti,Tr,rr,an,nr,Ki,An,Rr){if(ut===I){te===!0&&(wr(C.BLEND),te=!1);return}if(te===!1&&(In(C.BLEND),te=!0),ut!==J){if(ut!==oe||Rr!==it){if((ne!==H||we!==H)&&(C.blendEquation(C.FUNC_ADD),ne=H,we=H),Rr)switch(ut){case D:C.blendFuncSeparate(C.ONE,C.ONE_MINUS_SRC_ALPHA,C.ONE,C.ONE_MINUS_SRC_ALPHA);break;case L:C.blendFunc(C.ONE,C.ONE);break;case O:C.blendFuncSeparate(C.ZERO,C.ONE_MINUS_SRC_COLOR,C.ZERO,C.ONE);break;case U:C.blendFuncSeparate(C.ZERO,C.SRC_COLOR,C.ZERO,C.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ut);break}else switch(ut){case D:C.blendFuncSeparate(C.SRC_ALPHA,C.ONE_MINUS_SRC_ALPHA,C.ONE,C.ONE_MINUS_SRC_ALPHA);break;case L:C.blendFunc(C.SRC_ALPHA,C.ONE);break;case O:C.blendFuncSeparate(C.ZERO,C.ONE_MINUS_SRC_COLOR,C.ZERO,C.ONE);break;case U:C.blendFunc(C.ZERO,C.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ut);break}ee=null,Me=null,_e=null,nt=null,qe.set(0,0,0),Je=0,oe=ut,it=Rr}return}rr=rr||Ai,an=an||Ti,nr=nr||Tr,(Ai!==ne||rr!==we)&&(C.blendEquationSeparate(tt[Ai],tt[rr]),ne=Ai,we=rr),(Ti!==ee||Tr!==Me||an!==_e||nr!==nt)&&(C.blendFuncSeparate(pi[Ti],pi[Tr],pi[an],pi[nr]),ee=Ti,Me=Tr,_e=an,nt=nr),(Ki.equals(qe)===!1||An!==Je)&&(C.blendColor(Ki.r,Ki.g,Ki.b,An),qe.copy(Ki),Je=An),oe=ut,it=!1}function Zi(ut,Ai){ut.side===B?wr(C.CULL_FACE):In(C.CULL_FACE);let Ti=ut.side===R;Ai&&(Ti=!Ti),ai(Ti),ut.blending===D&&ut.transparent===!1?$t(I):$t(ut.blending,ut.blendEquation,ut.blendSrc,ut.blendDst,ut.blendEquationAlpha,ut.blendSrcAlpha,ut.blendDstAlpha,ut.blendColor,ut.blendAlpha,ut.premultipliedAlpha),E.setFunc(ut.depthFunc),E.setTest(ut.depthTest),E.setMask(ut.depthWrite),b.setMask(ut.colorWrite);const Tr=ut.stencilWrite;M.setTest(Tr),Tr&&(M.setMask(ut.stencilWriteMask),M.setFunc(ut.stencilFunc,ut.stencilRef,ut.stencilFuncMask),M.setOp(ut.stencilFail,ut.stencilZFail,ut.stencilZPass)),Ar(ut.polygonOffset,ut.polygonOffsetFactor,ut.polygonOffsetUnits),ut.alphaToCoverage===!0?In(C.SAMPLE_ALPHA_TO_COVERAGE):wr(C.SAMPLE_ALPHA_TO_COVERAGE)}function ai(ut){ze!==ut&&(ut?C.frontFace(C.CW):C.frontFace(C.CCW),ze=ut)}function er(ut){ut!==m?(In(C.CULL_FACE),ut!==Oe&&(ut===g?C.cullFace(C.BACK):ut===y?C.cullFace(C.FRONT):C.cullFace(C.FRONT_AND_BACK))):wr(C.CULL_FACE),Oe=ut}function $i(ut){ut!==rt&&(Pt&&C.lineWidth(ut),rt=ut)}function Ar(ut,Ai,Ti){ut?(In(C.POLYGON_OFFSET_FILL),(mt!==Ai||pt!==Ti)&&(C.polygonOffset(Ai,Ti),mt=Ai,pt=Ti)):wr(C.POLYGON_OFFSET_FILL)}function gn(ut){ut?In(C.SCISSOR_TEST):wr(C.SCISSOR_TEST)}function Hr(ut){ut===void 0&&(ut=C.TEXTURE0+Tt-1),Ft!==ut&&(C.activeTexture(ut),Ft=ut)}function aa(ut,Ai,Ti){Ti===void 0&&(Ft===null?Ti=C.TEXTURE0+Tt-1:Ti=Ft);let Tr=gi[Ti];Tr===void 0&&(Tr={type:void 0,texture:void 0},gi[Ti]=Tr),(Tr.type!==ut||Tr.texture!==Ai)&&(Ft!==Ti&&(C.activeTexture(Ti),Ft=Ti),C.bindTexture(ut,Ai||Un[ut]),Tr.type=ut,Tr.texture=Ai)}function Hs(){const ut=gi[Ft];ut!==void 0&&ut.type!==void 0&&(C.bindTexture(ut.type,null),ut.type=void 0,ut.texture=void 0)}function Gn(){try{C.compressedTexImage2D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function et(){try{C.compressedTexImage3D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function De(){try{C.texSubImage2D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function kt(){try{C.texSubImage3D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function ci(){try{C.compressedTexSubImage2D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function fi(){try{C.compressedTexSubImage3D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function si(){try{C.texStorage2D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Mr(){try{C.texStorage3D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Ui(){try{C.texImage2D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function cr(){try{C.texImage3D.apply(C,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Hn(ut){xn.equals(ut)===!1&&(C.scissor(ut.x,ut.y,ut.z,ut.w),xn.copy(ut))}function lr(ut){es.equals(ut)===!1&&(C.viewport(ut.x,ut.y,ut.z,ut.w),es.copy(ut))}function _r(ut,Ai){let Ti=P.get(Ai);Ti===void 0&&(Ti=new WeakMap,P.set(Ai,Ti));let Tr=Ti.get(ut);Tr===void 0&&(Tr=C.getUniformBlockIndex(Ai,ut.name),Ti.set(ut,Tr))}function bn(ut,Ai){const Ti=P.get(Ai).get(ut);N.get(Ai)!==Ti&&(C.uniformBlockBinding(Ai,Ti,ut.__bindingPointIndex),N.set(Ai,Ti))}function Ur(){C.disable(C.BLEND),C.disable(C.CULL_FACE),C.disable(C.DEPTH_TEST),C.disable(C.POLYGON_OFFSET_FILL),C.disable(C.SCISSOR_TEST),C.disable(C.STENCIL_TEST),C.disable(C.SAMPLE_ALPHA_TO_COVERAGE),C.blendEquation(C.FUNC_ADD),C.blendFunc(C.ONE,C.ZERO),C.blendFuncSeparate(C.ONE,C.ZERO,C.ONE,C.ZERO),C.blendColor(0,0,0,0),C.colorMask(!0,!0,!0,!0),C.clearColor(0,0,0,0),C.depthMask(!0),C.depthFunc(C.LESS),C.clearDepth(1),C.stencilMask(4294967295),C.stencilFunc(C.ALWAYS,0,4294967295),C.stencilOp(C.KEEP,C.KEEP,C.KEEP),C.clearStencil(0),C.cullFace(C.BACK),C.frontFace(C.CCW),C.polygonOffset(0,0),C.activeTexture(C.TEXTURE0),C.bindFramebuffer(C.FRAMEBUFFER,null),C.bindFramebuffer(C.DRAW_FRAMEBUFFER,null),C.bindFramebuffer(C.READ_FRAMEBUFFER,null),C.useProgram(null),C.lineWidth(1),C.scissor(0,0,C.canvas.width,C.canvas.height),C.viewport(0,0,C.canvas.width,C.canvas.height),F={},Ft=null,gi={},z={},X=new WeakMap,q=[],K=null,te=!1,oe=null,ne=null,ee=null,Me=null,we=null,_e=null,nt=null,qe=new or(0,0,0),Je=0,it=!1,ze=null,Oe=null,rt=null,mt=null,pt=null,xn.set(0,0,C.canvas.width,C.canvas.height),es.set(0,0,C.canvas.width,C.canvas.height),b.reset(),E.reset(),M.reset()}return{buffers:{color:b,depth:E,stencil:M},enable:In,disable:wr,bindFramebuffer:li,drawBuffers:_i,useProgram:Qi,setBlending:$t,setMaterial:Zi,setFlipSided:ai,setCullFace:er,setLineWidth:$i,setPolygonOffset:Ar,setScissorTest:gn,activeTexture:Hr,bindTexture:aa,unbindTexture:Hs,compressedTexImage2D:Gn,compressedTexImage3D:et,texImage2D:Ui,texImage3D:cr,updateUBOMapping:_r,uniformBlockBinding:bn,texStorage2D:si,texStorage3D:Mr,texSubImage2D:De,texSubImage3D:kt,compressedTexSubImage2D:ci,compressedTexSubImage3D:fi,scissor:Hn,viewport:lr,reset:Ur}}function eSe(C,a,h,A,b,E,M){const N=a.has("WEBGL_multisampled_render_to_texture")?a.get("WEBGL_multisampled_render_to_texture"):null,P=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),F=a.has("OCULUS_multiview")?a.get("OCULUS_multiview"):null,z=new ni,X=new WeakMap;let q;const K=new WeakMap;let te=[],oe=!1,ne=!1;try{ne=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function ee(et,De){return ne?new OffscreenCanvas(et,De):nf("canvas")}function Me(et,De,kt){let ci=1;const fi=Gn(et);if((fi.width>kt||fi.height>kt)&&(ci=kt/Math.max(fi.width,fi.height)),ci<1)if(typeof HTMLImageElement<"u"&&et instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&et instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&et instanceof ImageBitmap||typeof VideoFrame<"u"&&et instanceof VideoFrame){const si=Math.floor(ci*fi.width),Mr=Math.floor(ci*fi.height);q===void 0&&(q=ee(si,Mr));const Ui=De?ee(si,Mr):q;return Ui.width=si,Ui.height=Mr,Ui.getContext("2d").drawImage(et,0,0,si,Mr),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+fi.width+"x"+fi.height+") to ("+si+"x"+Mr+")."),Ui}else return"data"in et&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+fi.width+"x"+fi.height+")."),et;return et}function we(et){return et.generateMipmaps&&et.minFilter!==Bt&&et.minFilter!==Pi}function _e(et){C.generateMipmap(et)}function nt(et,De,kt,ci,fi=!1){if(et!==null){if(C[et]!==void 0)return C[et];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+et+"'")}let si=De;if(De===C.RED&&(kt===C.FLOAT&&(si=C.R32F),kt===C.HALF_FLOAT&&(si=C.R16F),kt===C.UNSIGNED_BYTE&&(si=C.R8)),De===C.RED_INTEGER&&(kt===C.UNSIGNED_BYTE&&(si=C.R8UI),kt===C.UNSIGNED_SHORT&&(si=C.R16UI),kt===C.UNSIGNED_INT&&(si=C.R32UI),kt===C.BYTE&&(si=C.R8I),kt===C.SHORT&&(si=C.R16I),kt===C.INT&&(si=C.R32I)),De===C.RG&&(kt===C.FLOAT&&(si=C.RG32F),kt===C.HALF_FLOAT&&(si=C.RG16F),kt===C.UNSIGNED_BYTE&&(si=C.RG8)),De===C.RG_INTEGER&&(kt===C.UNSIGNED_BYTE&&(si=C.RG8UI),kt===C.UNSIGNED_SHORT&&(si=C.RG16UI),kt===C.UNSIGNED_INT&&(si=C.RG32UI),kt===C.BYTE&&(si=C.RG8I),kt===C.SHORT&&(si=C.RG16I),kt===C.INT&&(si=C.RG32I)),De===C.RGB&&kt===C.UNSIGNED_INT_5_9_9_9_REV&&(si=C.RGB9_E5),De===C.RGBA){const Mr=fi?Jp:Xn.getTransfer(ci);kt===C.FLOAT&&(si=C.RGBA32F),kt===C.HALF_FLOAT&&(si=C.RGBA16F),kt===C.UNSIGNED_BYTE&&(si=Mr===os?C.SRGB8_ALPHA8:C.RGBA8),kt===C.UNSIGNED_SHORT_4_4_4_4&&(si=C.RGBA4),kt===C.UNSIGNED_SHORT_5_5_5_1&&(si=C.RGB5_A1)}return(si===C.R16F||si===C.R32F||si===C.RG16F||si===C.RG32F||si===C.RGBA16F||si===C.RGBA32F)&&a.get("EXT_color_buffer_float"),si}function qe(et,De){return we(et)===!0||et.isFramebufferTexture&&et.minFilter!==Bt&&et.minFilter!==Pi?Math.log2(Math.max(De.width,De.height))+1:et.mipmaps!==void 0&&et.mipmaps.length>0?et.mipmaps.length:et.isCompressedTexture&&Array.isArray(et.image)?De.mipmaps.length:1}function Je(et){const De=et.target;De.removeEventListener("dispose",Je),ze(De),De.isVideoTexture&&X.delete(De)}function it(et){const De=et.target;De.removeEventListener("dispose",it),rt(De)}function ze(et){const De=A.get(et);if(De.__webglInit===void 0)return;const kt=et.source,ci=K.get(kt);if(ci){const fi=ci[De.__cacheKey];fi.usedTimes--,fi.usedTimes===0&&Oe(et),Object.keys(ci).length===0&&K.delete(kt)}A.remove(et)}function Oe(et){const De=A.get(et);C.deleteTexture(De.__webglTexture);const kt=et.source,ci=K.get(kt);delete ci[De.__cacheKey],M.memory.textures--}function rt(et){const De=A.get(et);if(et.depthTexture&&et.depthTexture.dispose(),et.isWebGLCubeRenderTarget)for(let ci=0;ci<6;ci++){if(Array.isArray(De.__webglFramebuffer[ci]))for(let fi=0;fi<De.__webglFramebuffer[ci].length;fi++)C.deleteFramebuffer(De.__webglFramebuffer[ci][fi]);else C.deleteFramebuffer(De.__webglFramebuffer[ci]);De.__webglDepthbuffer&&C.deleteRenderbuffer(De.__webglDepthbuffer[ci])}else{if(Array.isArray(De.__webglFramebuffer))for(let ci=0;ci<De.__webglFramebuffer.length;ci++)C.deleteFramebuffer(De.__webglFramebuffer[ci]);else C.deleteFramebuffer(De.__webglFramebuffer);if(De.__webglDepthbuffer&&C.deleteRenderbuffer(De.__webglDepthbuffer),De.__webglMultisampledFramebuffer&&C.deleteFramebuffer(De.__webglMultisampledFramebuffer),De.__webglColorRenderbuffer)for(let ci=0;ci<De.__webglColorRenderbuffer.length;ci++)De.__webglColorRenderbuffer[ci]&&C.deleteRenderbuffer(De.__webglColorRenderbuffer[ci]);De.__webglDepthRenderbuffer&&C.deleteRenderbuffer(De.__webglDepthRenderbuffer)}const kt=et.textures;for(let ci=0,fi=kt.length;ci<fi;ci++){const si=A.get(kt[ci]);si.__webglTexture&&(C.deleteTexture(si.__webglTexture),M.memory.textures--),A.remove(kt[ci])}A.remove(et)}let mt=0;function pt(){mt=0}function Tt(){const et=mt;return et>=b.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+et+" texture units while this GPU supports only "+b.maxTextures),mt+=1,et}function Pt(et){const De=[];return De.push(et.wrapS),De.push(et.wrapT),De.push(et.wrapR||0),De.push(et.magFilter),De.push(et.minFilter),De.push(et.anisotropy),De.push(et.internalFormat),De.push(et.format),De.push(et.type),De.push(et.generateMipmaps),De.push(et.premultiplyAlpha),De.push(et.flipY),De.push(et.unpackAlignment),De.push(et.colorSpace),De.join()}function ui(et,De){const kt=A.get(et);if(et.isVideoTexture&&aa(et),et.isRenderTargetTexture===!1&&et.version>0&&kt.__version!==et.version){const ci=et.image;if(ci===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ci.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else if(wr(kt,et,De))return}h.bindTexture(C.TEXTURE_2D,kt.__webglTexture,C.TEXTURE0+De)}function Li(et,De){const kt=A.get(et);if(et.version>0&&kt.__version!==et.version){wr(kt,et,De);return}h.bindTexture(C.TEXTURE_2D_ARRAY,kt.__webglTexture,C.TEXTURE0+De)}function Ft(et,De){const kt=A.get(et);if(et.version>0&&kt.__version!==et.version){wr(kt,et,De);return}h.bindTexture(C.TEXTURE_3D,kt.__webglTexture,C.TEXTURE0+De)}function gi(et,De){const kt=A.get(et);if(et.version>0&&kt.__version!==et.version){li(kt,et,De);return}h.bindTexture(C.TEXTURE_CUBE_MAP,kt.__webglTexture,C.TEXTURE0+De)}const Di={[Ue]:C.REPEAT,[je]:C.CLAMP_TO_EDGE,[dt]:C.MIRRORED_REPEAT},kr={[Bt]:C.NEAREST,[bt]:C.NEAREST_MIPMAP_NEAREST,[di]:C.NEAREST_MIPMAP_LINEAR,[Pi]:C.LINEAR,[fn]:C.LINEAR_MIPMAP_NEAREST,[tn]:C.LINEAR_MIPMAP_LINEAR},xn={[$_]:C.NEVER,[sE]:C.ALWAYS,[eE]:C.LESS,[Yy]:C.LEQUAL,[tE]:C.EQUAL,[nE]:C.GEQUAL,[iE]:C.GREATER,[rE]:C.NOTEQUAL};function es(et,De){if(De.type===St&&a.has("OES_texture_float_linear")===!1&&(De.magFilter===Pi||De.magFilter===fn||De.magFilter===di||De.magFilter===tn||De.minFilter===Pi||De.minFilter===fn||De.minFilter===di||De.minFilter===tn)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),C.texParameteri(et,C.TEXTURE_WRAP_S,Di[De.wrapS]),C.texParameteri(et,C.TEXTURE_WRAP_T,Di[De.wrapT]),(et===C.TEXTURE_3D||et===C.TEXTURE_2D_ARRAY)&&C.texParameteri(et,C.TEXTURE_WRAP_R,Di[De.wrapR]),C.texParameteri(et,C.TEXTURE_MAG_FILTER,kr[De.magFilter]),C.texParameteri(et,C.TEXTURE_MIN_FILTER,kr[De.minFilter]),De.compareFunction&&(C.texParameteri(et,C.TEXTURE_COMPARE_MODE,C.COMPARE_REF_TO_TEXTURE),C.texParameteri(et,C.TEXTURE_COMPARE_FUNC,xn[De.compareFunction])),a.has("EXT_texture_filter_anisotropic")===!0){if(De.magFilter===Bt||De.minFilter!==di&&De.minFilter!==tn||De.type===St&&a.has("OES_texture_float_linear")===!1)return;if(De.anisotropy>1||A.get(De).__currentAnisotropy){const kt=a.get("EXT_texture_filter_anisotropic");C.texParameterf(et,kt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(De.anisotropy,b.getMaxAnisotropy())),A.get(De).__currentAnisotropy=De.anisotropy}}}function hs(et,De){let kt=!1;et.__webglInit===void 0&&(et.__webglInit=!0,De.addEventListener("dispose",Je));const ci=De.source;let fi=K.get(ci);fi===void 0&&(fi={},K.set(ci,fi));const si=Pt(De);if(si!==et.__cacheKey){fi[si]===void 0&&(fi[si]={texture:C.createTexture(),usedTimes:0},M.memory.textures++,kt=!0),fi[si].usedTimes++;const Mr=fi[et.__cacheKey];Mr!==void 0&&(fi[et.__cacheKey].usedTimes--,Mr.usedTimes===0&&Oe(De)),et.__cacheKey=si,et.__webglTexture=fi[si].texture}return kt}function Un(et){oe=et}function In(){const et=oe;oe=!1;for(const De of te)wr(De.textureProperties,De.texture,De.slot),De.texture.isPendingDeferredUpload=!1;te=[],oe=et}function wr(et,De,kt){if(oe)return De.isPendingDeferredUpload||(De.isPendingDeferredUpload=!0,te.push({textureProperties:et,texture:De,slot:kt})),!1;let ci=C.TEXTURE_2D;(De.isDataArrayTexture||De.isCompressedArrayTexture)&&(ci=C.TEXTURE_2D_ARRAY),De.isData3DTexture&&(ci=C.TEXTURE_3D);const fi=hs(et,De),si=De.source;h.bindTexture(ci,et.__webglTexture,C.TEXTURE0+kt);const Mr=A.get(si);if(si.version!==Mr.__version||fi===!0){h.activeTexture(C.TEXTURE0+kt);const Ui=Xn.getPrimaries(Xn.workingColorSpace),cr=De.colorSpace===ja?null:Xn.getPrimaries(De.colorSpace),Hn=De.colorSpace===ja||Ui===cr?C.NONE:C.BROWSER_DEFAULT_WEBGL;C.pixelStorei(C.UNPACK_FLIP_Y_WEBGL,De.flipY),C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,De.premultiplyAlpha),C.pixelStorei(C.UNPACK_ALIGNMENT,De.unpackAlignment),C.pixelStorei(C.UNPACK_COLORSPACE_CONVERSION_WEBGL,Hn);let lr=Me(De.image,!1,b.maxTextureSize);lr=Hs(De,lr);const _r=E.convert(De.format,De.colorSpace),bn=E.convert(De.type);let Ur=nt(De.internalFormat,_r,bn,De.colorSpace,De.isVideoTexture);es(ci,De);let ut;const Ai=De.mipmaps,Ti=De.isVideoTexture!==!0,Tr=Mr.__version===void 0||fi===!0,rr=si.dataReady,an=qe(De,lr);if(De.isDepthTexture)Ur=C.DEPTH_COMPONENT16,De.type===St?Ur=C.DEPTH_COMPONENT32F:De.type===ct?Ur=C.DEPTH_COMPONENT24:De.type===Ni&&(Ur=C.DEPTH24_STENCIL8),Tr&&(Ti?h.texStorage2D(C.TEXTURE_2D,1,Ur,lr.width,lr.height):h.texImage2D(C.TEXTURE_2D,0,Ur,lr.width,lr.height,0,_r,bn,null));else if(De.isDataTexture)if(Ai.length>0){Ti&&Tr&&h.texStorage2D(C.TEXTURE_2D,an,Ur,Ai[0].width,Ai[0].height);for(let nr=0,Ki=Ai.length;nr<Ki;nr++)ut=Ai[nr],Ti?rr&&h.texSubImage2D(C.TEXTURE_2D,nr,0,0,ut.width,ut.height,_r,bn,ut.data):h.texImage2D(C.TEXTURE_2D,nr,Ur,ut.width,ut.height,0,_r,bn,ut.data);De.generateMipmaps=!1}else Ti?(Tr&&h.texStorage2D(C.TEXTURE_2D,an,Ur,lr.width,lr.height),rr&&h.texSubImage2D(C.TEXTURE_2D,0,0,0,lr.width,lr.height,_r,bn,lr.data)):h.texImage2D(C.TEXTURE_2D,0,Ur,lr.width,lr.height,0,_r,bn,lr.data);else if(De.isCompressedTexture)if(De.isCompressedArrayTexture){Ti&&Tr&&h.texStorage3D(C.TEXTURE_2D_ARRAY,an,Ur,Ai[0].width,Ai[0].height,lr.depth);for(let nr=0,Ki=Ai.length;nr<Ki;nr++)ut=Ai[nr],De.format!==ge?_r!==null?Ti?rr&&h.compressedTexSubImage3D(C.TEXTURE_2D_ARRAY,nr,0,0,0,ut.width,ut.height,lr.depth,_r,ut.data,0,0):h.compressedTexImage3D(C.TEXTURE_2D_ARRAY,nr,Ur,ut.width,ut.height,lr.depth,0,ut.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ti?rr&&h.texSubImage3D(C.TEXTURE_2D_ARRAY,nr,0,0,0,ut.width,ut.height,lr.depth,_r,bn,ut.data):h.texImage3D(C.TEXTURE_2D_ARRAY,nr,Ur,ut.width,ut.height,lr.depth,0,_r,bn,ut.data)}else{Ti&&Tr&&h.texStorage2D(C.TEXTURE_2D,an,Ur,Ai[0].width,Ai[0].height);for(let nr=0,Ki=Ai.length;nr<Ki;nr++)ut=Ai[nr],De.format!==ge?_r!==null?Ti?rr&&h.compressedTexSubImage2D(C.TEXTURE_2D,nr,0,0,ut.width,ut.height,_r,ut.data):h.compressedTexImage2D(C.TEXTURE_2D,nr,Ur,ut.width,ut.height,0,ut.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ti?rr&&h.texSubImage2D(C.TEXTURE_2D,nr,0,0,ut.width,ut.height,_r,bn,ut.data):h.texImage2D(C.TEXTURE_2D,nr,Ur,ut.width,ut.height,0,_r,bn,ut.data)}else if(De.isDataArrayTexture)Ti?(Tr&&h.texStorage3D(C.TEXTURE_2D_ARRAY,an,Ur,lr.width,lr.height,lr.depth),rr&&h.texSubImage3D(C.TEXTURE_2D_ARRAY,0,0,0,0,lr.width,lr.height,lr.depth,_r,bn,lr.data)):h.texImage3D(C.TEXTURE_2D_ARRAY,0,Ur,lr.width,lr.height,lr.depth,0,_r,bn,lr.data);else if(De.isData3DTexture)Ti?(Tr&&h.texStorage3D(C.TEXTURE_3D,an,Ur,lr.width,lr.height,lr.depth),rr&&h.texSubImage3D(C.TEXTURE_3D,0,0,0,0,lr.width,lr.height,lr.depth,_r,bn,lr.data)):h.texImage3D(C.TEXTURE_3D,0,Ur,lr.width,lr.height,lr.depth,0,_r,bn,lr.data);else if(De.isFramebufferTexture){if(Tr)if(Ti)h.texStorage2D(C.TEXTURE_2D,an,Ur,lr.width,lr.height);else{let nr=lr.width,Ki=lr.height;for(let An=0;An<an;An++)h.texImage2D(C.TEXTURE_2D,An,Ur,nr,Ki,0,_r,bn,null),nr>>=1,Ki>>=1}}else if(Ai.length>0){if(Ti&&Tr){const nr=Gn(Ai[0]);h.texStorage2D(C.TEXTURE_2D,an,Ur,nr.width,nr.height)}for(let nr=0,Ki=Ai.length;nr<Ki;nr++)ut=Ai[nr],Ti?rr&&h.texSubImage2D(C.TEXTURE_2D,nr,0,0,_r,bn,ut):h.texImage2D(C.TEXTURE_2D,nr,Ur,_r,bn,ut);De.generateMipmaps=!1}else if(Ti){if(Tr){const nr=Gn(lr);h.texStorage2D(C.TEXTURE_2D,an,Ur,nr.width,nr.height)}rr&&h.texSubImage2D(C.TEXTURE_2D,0,0,0,_r,bn,lr)}else h.texImage2D(C.TEXTURE_2D,0,Ur,_r,bn,lr);we(De)&&_e(ci),Mr.__version=si.version,De.onUpdate&&De.onUpdate(De)}return et.__version=De.version,!0}function li(et,De,kt){if(De.image.length!==6)return;const ci=hs(et,De),fi=De.source;h.bindTexture(C.TEXTURE_CUBE_MAP,et.__webglTexture,C.TEXTURE0+kt);const si=A.get(fi);if(fi.version!==si.__version||ci===!0){h.activeTexture(C.TEXTURE0+kt);const Mr=Xn.getPrimaries(Xn.workingColorSpace),Ui=De.colorSpace===ja?null:Xn.getPrimaries(De.colorSpace),cr=De.colorSpace===ja||Mr===Ui?C.NONE:C.BROWSER_DEFAULT_WEBGL;C.pixelStorei(C.UNPACK_FLIP_Y_WEBGL,De.flipY),C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,De.premultiplyAlpha),C.pixelStorei(C.UNPACK_ALIGNMENT,De.unpackAlignment),C.pixelStorei(C.UNPACK_COLORSPACE_CONVERSION_WEBGL,cr);const Hn=De.isCompressedTexture||De.image[0].isCompressedTexture,lr=De.image[0]&&De.image[0].isDataTexture,_r=[];for(let Ki=0;Ki<6;Ki++)!Hn&&!lr?_r[Ki]=Me(De.image[Ki],!0,b.maxCubemapSize):_r[Ki]=lr?De.image[Ki].image:De.image[Ki],_r[Ki]=Hs(De,_r[Ki]);const bn=_r[0],Ur=E.convert(De.format,De.colorSpace),ut=E.convert(De.type),Ai=nt(De.internalFormat,Ur,ut,De.colorSpace),Ti=De.isVideoTexture!==!0,Tr=si.__version===void 0||ci===!0,rr=fi.dataReady;let an=qe(De,bn);es(C.TEXTURE_CUBE_MAP,De);let nr;if(Hn){Ti&&Tr&&h.texStorage2D(C.TEXTURE_CUBE_MAP,an,Ai,bn.width,bn.height);for(let Ki=0;Ki<6;Ki++){nr=_r[Ki].mipmaps;for(let An=0;An<nr.length;An++){const Rr=nr[An];De.format!==ge?Ur!==null?Ti?rr&&h.compressedTexSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,An,0,0,Rr.width,Rr.height,Ur,Rr.data):h.compressedTexImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,An,Ai,Rr.width,Rr.height,0,Rr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ti?rr&&h.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,An,0,0,Rr.width,Rr.height,Ur,ut,Rr.data):h.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,An,Ai,Rr.width,Rr.height,0,Ur,ut,Rr.data)}}}else{if(nr=De.mipmaps,Ti&&Tr){nr.length>0&&an++;const Ki=Gn(_r[0]);h.texStorage2D(C.TEXTURE_CUBE_MAP,an,Ai,Ki.width,Ki.height)}for(let Ki=0;Ki<6;Ki++)if(lr){Ti?rr&&h.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,0,0,0,_r[Ki].width,_r[Ki].height,Ur,ut,_r[Ki].data):h.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,0,Ai,_r[Ki].width,_r[Ki].height,0,Ur,ut,_r[Ki].data);for(let An=0;An<nr.length;An++){const Rr=nr[An].image[Ki].image;Ti?rr&&h.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,An+1,0,0,Rr.width,Rr.height,Ur,ut,Rr.data):h.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,An+1,Ai,Rr.width,Rr.height,0,Ur,ut,Rr.data)}}else{Ti?rr&&h.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,0,0,0,Ur,ut,_r[Ki]):h.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,0,Ai,Ur,ut,_r[Ki]);for(let An=0;An<nr.length;An++){const Rr=nr[An];Ti?rr&&h.texSubImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,An+1,0,0,Ur,ut,Rr.image[Ki]):h.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+Ki,An+1,Ai,Ur,ut,Rr.image[Ki])}}}we(De)&&_e(C.TEXTURE_CUBE_MAP),si.__version=fi.version,De.onUpdate&&De.onUpdate(De)}et.__version=De.version}function _i(et,De,kt,ci,fi,si){const Mr=E.convert(kt.format,kt.colorSpace),Ui=E.convert(kt.type),cr=nt(kt.internalFormat,Mr,Ui,kt.colorSpace);if(!A.get(De).__hasExternalTextures){const lr=Math.max(1,De.width>>si),_r=Math.max(1,De.height>>si);De.isWebGLMultiviewRenderTarget===!0?h.texStorage3D(C.TEXTURE_2D_ARRAY,0,cr,De.width,De.height,De.numViews):fi===C.TEXTURE_3D||fi===C.TEXTURE_2D_ARRAY?h.texImage3D(fi,si,cr,lr,_r,De.depth,0,Mr,Ui,null):h.texImage2D(fi,si,cr,lr,_r,0,Mr,Ui,null)}h.bindFramebuffer(C.FRAMEBUFFER,et);const Hn=Hr(De);De.isWebGLMultiviewRenderTarget===!0?Hn?F.framebufferTextureMultisampleMultiviewOVR(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,A.get(kt).__webglTexture,0,gn(De),0,De.numViews):F.framebufferTextureMultiviewOVR(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,A.get(kt).__webglTexture,0,0,De.numViews):(fi===C.TEXTURE_2D||fi>=C.TEXTURE_CUBE_MAP_POSITIVE_X&&fi<=C.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&(Hn?N.framebufferTexture2DMultisampleEXT(C.FRAMEBUFFER,ci,fi,A.get(kt).__webglTexture,0,gn(De)):C.framebufferTexture2D(C.FRAMEBUFFER,ci,fi,A.get(kt).__webglTexture,si)),h.bindFramebuffer(C.FRAMEBUFFER,null)}function Qi(et,De,kt){if(C.bindRenderbuffer(C.RENDERBUFFER,et),De.isWebGLMultiviewRenderTarget===!0){const ci=Hr(De),fi=De.numViews,si=De.depthTexture;let Mr=C.DEPTH_COMPONENT24,Ui=C.DEPTH_ATTACHMENT;si&&si.isDepthTexture&&(si.type===St?Mr=C.DEPTH_COMPONENT32F:si.type===Ni&&(Mr=C.DEPTH24_STENCIL8,Ui=C.DEPTH_STENCIL_ATTACHMENT));let cr=A.get(De.depthTexture).__webglTexture;cr===void 0&&(cr=C.createTexture(),C.bindTexture(C.TEXTURE_2D_ARRAY,cr),C.texStorage3D(C.TEXTURE_2D_ARRAY,1,Mr,De.width,De.height,fi)),ci?F.framebufferTextureMultisampleMultiviewOVR(C.FRAMEBUFFER,Ui,cr,0,gn(De),0,fi):F.framebufferTextureMultiviewOVR(C.FRAMEBUFFER,Ui,cr,0,0,fi)}else if(De.depthBuffer&&!De.stencilBuffer){let ci=C.DEPTH_COMPONENT24;if(kt||Hr(De)){const fi=De.depthTexture;fi&&fi.isDepthTexture&&(fi.type===St?ci=C.DEPTH_COMPONENT32F:fi.type===ct&&(ci=C.DEPTH_COMPONENT24));const si=gn(De);Hr(De)?N.renderbufferStorageMultisampleEXT(C.RENDERBUFFER,si,ci,De.width,De.height):C.renderbufferStorageMultisample(C.RENDERBUFFER,si,ci,De.width,De.height)}else C.renderbufferStorage(C.RENDERBUFFER,ci,De.width,De.height);C.framebufferRenderbuffer(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.RENDERBUFFER,et)}else if(De.depthBuffer&&De.stencilBuffer){const ci=gn(De);kt&&Hr(De)===!1?C.renderbufferStorageMultisample(C.RENDERBUFFER,ci,C.DEPTH24_STENCIL8,De.width,De.height):Hr(De)?N.renderbufferStorageMultisampleEXT(C.RENDERBUFFER,ci,C.DEPTH24_STENCIL8,De.width,De.height):C.renderbufferStorage(C.RENDERBUFFER,C.DEPTH_STENCIL,De.width,De.height),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.DEPTH_STENCIL_ATTACHMENT,C.RENDERBUFFER,et)}else{const ci=De.textures;for(let fi=0;fi<ci.length;fi++){const si=ci[fi],Mr=E.convert(si.format,si.colorSpace),Ui=E.convert(si.type),cr=nt(si.internalFormat,Mr,Ui,si.colorSpace),Hn=gn(De);kt&&Hr(De)===!1?C.renderbufferStorageMultisample(C.RENDERBUFFER,Hn,cr,De.width,De.height):Hr(De)?N.renderbufferStorageMultisampleEXT(C.RENDERBUFFER,Hn,cr,De.width,De.height):C.renderbufferStorage(C.RENDERBUFFER,cr,De.width,De.height)}}C.bindRenderbuffer(C.RENDERBUFFER,null)}function tt(et,De){if(De&&De.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(h.bindFramebuffer(C.FRAMEBUFFER,et),!(De.depthTexture&&De.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!A.get(De.depthTexture).__webglTexture||De.depthTexture.image.width!==De.width||De.depthTexture.image.height!==De.height)&&(De.depthTexture.image.width=De.width,De.depthTexture.image.height=De.height,De.depthTexture.needsUpdate=!0),ui(De.depthTexture,0),De.depthTexture.image.depth!=1?Li(De.depthTexture,0):ui(De.depthTexture,0);const kt=A.get(De.depthTexture).__webglTexture,ci=gn(De);if(De.isWebGLMultiviewRenderTarget===!0){const fi=Hr(De),si=De.numViews;if(De.depthTexture.format===Ke)fi?F.framebufferTextureMultisampleMultiviewOVR(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,kt,0,ci,0,si):F.framebufferTextureMultiviewOVR(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,kt,0,0,si);else if(De.depthTexture.format===ot)fi?F.framebufferTextureMultisampleMultiviewOVR(C.FRAMEBUFFER,C.DEPTH_STENCIL_ATTACHMENT,kt,0,ci,0,si):F.framebufferTextureMultiviewOVR(C.FRAMEBUFFER,C.DEPTH_STENCIL_ATTACHMENT,kt,0,0,si);else throw new Error("Unknown depthTexture format")}else if(De.depthTexture.format===Ke)Hr(De)?N.framebufferTexture2DMultisampleEXT(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.TEXTURE_2D,kt,0,ci):C.framebufferTexture2D(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.TEXTURE_2D,kt,0);else if(De.depthTexture.format===ot)Hr(De)?N.framebufferTexture2DMultisampleEXT(C.FRAMEBUFFER,C.DEPTH_STENCIL_ATTACHMENT,C.TEXTURE_2D,kt,0,ci):C.framebufferTexture2D(C.FRAMEBUFFER,C.DEPTH_STENCIL_ATTACHMENT,C.TEXTURE_2D,kt,0);else throw new Error("Unknown depthTexture format")}function pi(et){const De=A.get(et),kt=et.isWebGLCubeRenderTarget===!0;if(et.depthTexture&&!De.__autoAllocateDepthBuffer){if(kt)throw new Error("target.depthTexture not supported in Cube render targets");tt(De.__webglFramebuffer,et)}else if(kt){De.__webglDepthbuffer=[];for(let ci=0;ci<6;ci++)h.bindFramebuffer(C.FRAMEBUFFER,De.__webglFramebuffer[ci]),De.__webglDepthbuffer[ci]=C.createRenderbuffer(),Qi(De.__webglDepthbuffer[ci],et,!1)}else h.bindFramebuffer(C.FRAMEBUFFER,De.__webglFramebuffer),De.__webglDepthbuffer=C.createRenderbuffer(),Qi(De.__webglDepthbuffer,et,!1);h.bindFramebuffer(C.FRAMEBUFFER,null)}function $t(et,De,kt){const ci=A.get(et);De!==void 0&&_i(ci.__webglFramebuffer,et,et.texture,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,0),kt!==void 0&&pi(et)}function Zi(et){const De=et.texture,kt=A.get(et),ci=A.get(De);et.addEventListener("dispose",it);const fi=et.textures,si=et.isWebGLCubeRenderTarget===!0,Mr=fi.length>1;if(Mr||(ci.__webglTexture===void 0&&(ci.__webglTexture=C.createTexture()),ci.__version=De.version,M.memory.textures++),si){kt.__webglFramebuffer=[];for(let Ui=0;Ui<6;Ui++)if(De.mipmaps&&De.mipmaps.length>0){kt.__webglFramebuffer[Ui]=[];for(let cr=0;cr<De.mipmaps.length;cr++)kt.__webglFramebuffer[Ui][cr]=C.createFramebuffer()}else kt.__webglFramebuffer[Ui]=C.createFramebuffer()}else{if(De.mipmaps&&De.mipmaps.length>0){kt.__webglFramebuffer=[];for(let Ui=0;Ui<De.mipmaps.length;Ui++)kt.__webglFramebuffer[Ui]=C.createFramebuffer()}else kt.__webglFramebuffer=C.createFramebuffer();if(Mr)for(let Ui=0,cr=fi.length;Ui<cr;Ui++){const Hn=A.get(fi[Ui]);Hn.__webglTexture===void 0&&(Hn.__webglTexture=C.createTexture(),M.memory.textures++)}if(et.samples>0&&Hr(et)===!1){kt.__webglMultisampledFramebuffer=C.createFramebuffer(),kt.__webglColorRenderbuffer=[],h.bindFramebuffer(C.FRAMEBUFFER,kt.__webglMultisampledFramebuffer);for(let Ui=0;Ui<fi.length;Ui++){const cr=fi[Ui];kt.__webglColorRenderbuffer[Ui]=C.createRenderbuffer(),C.bindRenderbuffer(C.RENDERBUFFER,kt.__webglColorRenderbuffer[Ui]);const Hn=E.convert(cr.format,cr.colorSpace),lr=E.convert(cr.type),_r=nt(cr.internalFormat,Hn,lr,cr.colorSpace,et.isXRRenderTarget===!0),bn=gn(et);C.renderbufferStorageMultisample(C.RENDERBUFFER,bn,_r,et.width,et.height),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0+Ui,C.RENDERBUFFER,kt.__webglColorRenderbuffer[Ui])}C.bindRenderbuffer(C.RENDERBUFFER,null),et.depthBuffer&&(kt.__webglDepthRenderbuffer=C.createRenderbuffer(),Qi(kt.__webglDepthRenderbuffer,et,!0)),h.bindFramebuffer(C.FRAMEBUFFER,null)}}if(si){h.bindTexture(C.TEXTURE_CUBE_MAP,ci.__webglTexture),es(C.TEXTURE_CUBE_MAP,De);for(let Ui=0;Ui<6;Ui++)if(De.mipmaps&&De.mipmaps.length>0)for(let cr=0;cr<De.mipmaps.length;cr++)_i(kt.__webglFramebuffer[Ui][cr],et,De,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+Ui,cr);else _i(kt.__webglFramebuffer[Ui],et,De,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+Ui,0);we(De)&&_e(C.TEXTURE_CUBE_MAP),h.unbindTexture()}else if(Mr){for(let Ui=0,cr=fi.length;Ui<cr;Ui++){const Hn=fi[Ui],lr=A.get(Hn);h.bindTexture(C.TEXTURE_2D,lr.__webglTexture),es(C.TEXTURE_2D,Hn),_i(kt.__webglFramebuffer,et,Hn,C.COLOR_ATTACHMENT0+Ui,C.TEXTURE_2D,0),we(Hn)&&_e(C.TEXTURE_2D)}h.unbindTexture()}else{let Ui=C.TEXTURE_2D;if((et.isWebGL3DRenderTarget||et.isWebGLArrayRenderTarget)&&(Ui=et.isWebGL3DRenderTarget?C.TEXTURE_3D:C.TEXTURE_2D_ARRAY),et.isWebGLMultiviewRenderTarget===!0&&(Ui=C.TEXTURE_2D_ARRAY),h.bindTexture(Ui,ci.__webglTexture),es(Ui,De),De.mipmaps&&De.mipmaps.length>0)for(let cr=0;cr<De.mipmaps.length;cr++)_i(kt.__webglFramebuffer[cr],et,De,C.COLOR_ATTACHMENT0,Ui,cr);else _i(kt.__webglFramebuffer,et,De,C.COLOR_ATTACHMENT0,Ui,0);we(De)&&_e(Ui),h.unbindTexture()}(et.depthBuffer||et.isWebGLMultiviewRenderTarget===!0)&&this.setupDepthRenderbuffer(et)}function ai(et){const De=et.textures;for(let kt=0,ci=De.length;kt<ci;kt++){const fi=De[kt];if(we(fi)){const si=et.isWebGLCubeRenderTarget?C.TEXTURE_CUBE_MAP:C.TEXTURE_2D,Mr=A.get(fi).__webglTexture;h.bindTexture(si,Mr),_e(si),h.unbindTexture()}}}const er=[],$i=[];function Ar(et){if(et.samples>0){if(Hr(et)===!1){const De=et.textures,kt=et.width,ci=et.height;let fi=C.COLOR_BUFFER_BIT;const si=et.stencilBuffer?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT,Mr=A.get(et),Ui=De.length>1;if(Ui)for(let cr=0;cr<De.length;cr++)h.bindFramebuffer(C.FRAMEBUFFER,Mr.__webglMultisampledFramebuffer),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0+cr,C.RENDERBUFFER,null),h.bindFramebuffer(C.FRAMEBUFFER,Mr.__webglFramebuffer),C.framebufferTexture2D(C.DRAW_FRAMEBUFFER,C.COLOR_ATTACHMENT0+cr,C.TEXTURE_2D,null,0);h.bindFramebuffer(C.READ_FRAMEBUFFER,Mr.__webglMultisampledFramebuffer),h.bindFramebuffer(C.DRAW_FRAMEBUFFER,Mr.__webglFramebuffer);for(let cr=0;cr<De.length;cr++){if(et.resolveDepthBuffer&&(et.depthBuffer&&(fi|=C.DEPTH_BUFFER_BIT),et.stencilBuffer&&et.resolveStencilBuffer&&(fi|=C.STENCIL_BUFFER_BIT)),Ui){C.framebufferRenderbuffer(C.READ_FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.RENDERBUFFER,Mr.__webglColorRenderbuffer[cr]);const Hn=A.get(De[cr]).__webglTexture;C.framebufferTexture2D(C.DRAW_FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,Hn,0)}C.blitFramebuffer(0,0,kt,ci,0,0,kt,ci,fi,C.NEAREST),P===!0&&(er.length=0,$i.length=0,er.push(C.COLOR_ATTACHMENT0+cr),et.depthBuffer&&et.resolveDepthBuffer===!1&&(er.push(si),$i.push(si),C.invalidateFramebuffer(C.DRAW_FRAMEBUFFER,$i)),C.invalidateFramebuffer(C.READ_FRAMEBUFFER,er))}if(h.bindFramebuffer(C.READ_FRAMEBUFFER,null),h.bindFramebuffer(C.DRAW_FRAMEBUFFER,null),Ui)for(let cr=0;cr<De.length;cr++){h.bindFramebuffer(C.FRAMEBUFFER,Mr.__webglMultisampledFramebuffer),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0+cr,C.RENDERBUFFER,Mr.__webglColorRenderbuffer[cr]);const Hn=A.get(De[cr]).__webglTexture;h.bindFramebuffer(C.FRAMEBUFFER,Mr.__webglFramebuffer),C.framebufferTexture2D(C.DRAW_FRAMEBUFFER,C.COLOR_ATTACHMENT0+cr,C.TEXTURE_2D,Hn,0)}h.bindFramebuffer(C.DRAW_FRAMEBUFFER,Mr.__webglMultisampledFramebuffer)}else if(et.depthBuffer&&et.resolveDepthBuffer===!1&&P){const De=et.stencilBuffer?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT;C.invalidateFramebuffer(C.DRAW_FRAMEBUFFER,[De])}}}function gn(et){return Math.min(b.maxSamples,et.samples)}function Hr(et){const De=A.get(et);return et.samples>0&&a.has("WEBGL_multisampled_render_to_texture")===!0&&De.__useRenderToTexture!==!1}function aa(et){const De=M.render.frame;X.get(et)!==De&&(X.set(et,De),et.update())}function Hs(et,De){const kt=et.colorSpace,ci=et.format,fi=et.type;return et.isCompressedTexture===!0||et.isVideoTexture===!0||kt!==Ec&&kt!==ja&&(Xn.getTransfer(kt)===os?(ci!==ge||fi!==mn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",kt)),De}function Gn(et){return typeof HTMLImageElement<"u"&&et instanceof HTMLImageElement?(z.width=et.naturalWidth||et.width,z.height=et.naturalHeight||et.height):typeof VideoFrame<"u"&&et instanceof VideoFrame?(z.width=et.displayWidth,z.height=et.displayHeight):(z.width=et.width,z.height=et.height),z}this.allocateTextureUnit=Tt,this.resetTextureUnits=pt,this.setTexture2D=ui,this.setTexture2DArray=Li,this.setTexture3D=Ft,this.setTextureCube=gi,this.rebindTextures=$t,this.uploadTexture=wr,this.setupRenderTarget=Zi,this.updateRenderTargetMipmap=ai,this.updateMultisampleRenderTarget=Ar,this.setupDepthTexture=tt,this.setupDepthRenderbuffer=pi,this.setupFrameBufferTexture=_i,this.useMultisampledRTT=Hr,this.runDeferredUploads=In,this.setDeferTextureUploads=Un}function $9(C,a){function h(A,b=ja){let E;const M=Xn.getTransfer(b);if(A===mn)return C.UNSIGNED_BYTE;if(A===Ii)return C.UNSIGNED_SHORT_4_4_4_4;if(A===sr)return C.UNSIGNED_SHORT_5_5_5_1;if(A===Oi)return C.UNSIGNED_INT_5_9_9_9_REV;if(A===Rs)return C.BYTE;if(A===$n)return C.SHORT;if(A===As)return C.UNSIGNED_SHORT;if(A===me)return C.INT;if(A===ct)return C.UNSIGNED_INT;if(A===St)return C.FLOAT;if(A===Xt)return C.HALF_FLOAT;if(A===Be)return C.ALPHA;if(A===se)return C.RGB;if(A===ge)return C.RGBA;if(A===Ne)return C.LUMINANCE;if(A===ke)return C.LUMINANCE_ALPHA;if(A===Ke)return C.DEPTH_COMPONENT;if(A===ot)return C.DEPTH_STENCIL;if(A===wt)return C.RED;if(A===qt)return C.RED_INTEGER;if(A===Kt)return C.RG;if(A===Rt)return C.RG_INTEGER;if(A===ti)return C.RGBA_INTEGER;if(A===bi||A===Fi||A===Cr||A===ur)if(M===os)if(E=a.get("WEBGL_compressed_texture_s3tc_srgb"),E!==null){if(A===bi)return E.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(A===Fi)return E.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(A===Cr)return E.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(A===ur)return E.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(E=a.get("WEBGL_compressed_texture_s3tc"),E!==null){if(A===bi)return E.COMPRESSED_RGB_S3TC_DXT1_EXT;if(A===Fi)return E.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(A===Cr)return E.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(A===ur)return E.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(A===Ji||A===vi||A===Tn||A===qn)if(E=a.get("WEBGL_compressed_texture_pvrtc"),E!==null){if(A===Ji)return E.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(A===vi)return E.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(A===Tn)return E.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(A===qn)return E.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(A===Mi||A===ar||A===un)if(E=a.get("WEBGL_compressed_texture_etc"),E!==null){if(A===Mi||A===ar)return M===os?E.COMPRESSED_SRGB8_ETC2:E.COMPRESSED_RGB8_ETC2;if(A===un)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:E.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(A===Qr||A===W||A===ue||A===Ae||A===Se||A===We||A===Ye||A===ft||A===he||A===le||A===pe||A===be||A===Ee||A===st)if(E=a.get("WEBGL_compressed_texture_astc"),E!==null){if(A===Qr)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:E.COMPRESSED_RGBA_ASTC_4x4_KHR;if(A===W)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:E.COMPRESSED_RGBA_ASTC_5x4_KHR;if(A===ue)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:E.COMPRESSED_RGBA_ASTC_5x5_KHR;if(A===Ae)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:E.COMPRESSED_RGBA_ASTC_6x5_KHR;if(A===Se)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:E.COMPRESSED_RGBA_ASTC_6x6_KHR;if(A===We)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:E.COMPRESSED_RGBA_ASTC_8x5_KHR;if(A===Ye)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:E.COMPRESSED_RGBA_ASTC_8x6_KHR;if(A===ft)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:E.COMPRESSED_RGBA_ASTC_8x8_KHR;if(A===he)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:E.COMPRESSED_RGBA_ASTC_10x5_KHR;if(A===le)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:E.COMPRESSED_RGBA_ASTC_10x6_KHR;if(A===pe)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:E.COMPRESSED_RGBA_ASTC_10x8_KHR;if(A===be)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:E.COMPRESSED_RGBA_ASTC_10x10_KHR;if(A===Ee)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:E.COMPRESSED_RGBA_ASTC_12x10_KHR;if(A===st)return M===os?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:E.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(A===Ct||A===Ht||A===ii)if(E=a.get("EXT_texture_compression_bptc"),E!==null){if(A===Ct)return M===os?E.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:E.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(A===Ht)return E.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(A===ii)return E.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(A===mi||A===Wt||A===Bi||A===yr)if(E=a.get("EXT_texture_compression_rgtc"),E!==null){if(A===Ct)return E.COMPRESSED_RED_RGTC1_EXT;if(A===Wt)return E.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(A===Bi)return E.COMPRESSED_RED_GREEN_RGTC2_EXT;if(A===yr)return E.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return A===Ni?C.UNSIGNED_INT_24_8:C[A]!==void 0?C[A]:null}return{convert:h}}class hf extends Vn{constructor(){super(),this.isGroup=!0,this.type="Group"}}class zB extends fa{constructor(a=[]){super(),this.isArrayCamera=!0,this.cameras=a}}var ej=new He,tj=new He;function tSe(C,a,h){ej.setFromMatrixPosition(a.matrixWorld),tj.setFromMatrixPosition(h.matrixWorld);var A=ej.distanceTo(tj),b=a.projectionMatrix.elements,E=h.projectionMatrix.elements,M=b[14]/(b[10]-1),N=b[14]/(b[10]+1),P=(b[9]+1)/b[5],F=(b[9]-1)/b[5],z=(b[8]-1)/b[0],X=(E[8]+1)/E[0],q=M*z,K=M*X,te=A/(-z+X),oe=te*-z;a.matrixWorld.decompose(C.position,C.quaternion,C.scale),C.translateX(oe),C.translateZ(te),C.matrixWorld.compose(C.position,C.quaternion,C.scale),C.matrixWorldInverse.copy(C.matrixWorld).invert();var ne=M+te,ee=N+te,Me=q-oe,we=K+(A-oe),_e=P*N/ee*ne,nt=F*N/ee*ne;C.projectionMatrix.makePerspective(Me,we,_e,nt,ne,ee)}function ij(C){var a,h,A=this,b=null,E=null,M=null,N=[],P=new fr,F=new fr,z=1,X="local-floor";typeof window<"u"&&"VRFrameData"in window&&(E=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",_e,!1));var q=new fr,K=new jn,te=new He,oe=new fa;oe.viewport=new Fn,oe.layers.enable(1);var ne=new fa;ne.viewport=new Fn,ne.layers.enable(2);var ee=new zB([oe,ne]);ee.layers.enable(1),ee.layers.enable(2);var Me=new ni,we;function _e(){var rt=A.isPresenting=b!==null&&b.isPresenting===!0;if(rt){var mt=b.getEyeParameters("left");a=2*mt.renderWidth*z,h=mt.renderHeight*z,we=C.getPixelRatio(),C.getSize(Me),C.setDrawingBufferSize(a,h,1),oe.viewport.set(0,0,a/2,h),ne.viewport.set(a/2,0,a/2,h),Oe.start(),A.dispatchEvent({type:"sessionstart"})}else A.enabled&&C.setDrawingBufferSize(Me.width,Me.height,we),Oe.stop(),A.dispatchEvent({type:"sessionend"})}var nt=[],qe=[];function Je(rt){for(var mt=navigator.getGamepads&&navigator.getGamepads(),pt=0,Tt=mt.length;pt<Tt;pt++){var Pt=mt[pt];if(Pt&&(Pt.id==="Daydream Controller"||Pt.id==="Gear VR Controller"||Pt.id==="Oculus Go Controller"||Pt.id==="OpenVR Gamepad"||Pt.id.startsWith("Oculus Touch")||Pt.id.startsWith("HTC Vive Focus")||Pt.id.startsWith("Spatial Controller"))){var ui=Pt.hand;if(rt===0&&(ui===""||ui==="right")||rt===1&&ui==="left")return Pt}}}function it(){for(var rt=0;rt<N.length;rt++){var mt=N[rt],pt=Je(rt);if(pt!==void 0&&pt.pose!==void 0){if(pt.pose===null)return;var Tt=pt.pose;Tt.hasPosition===!1&&mt.position.set(.2,-.6,-.05),Tt.position!==null&&mt.position.fromArray(Tt.position),Tt.orientation!==null&&mt.quaternion.fromArray(Tt.orientation),mt.matrix.compose(mt.position,mt.quaternion,mt.scale),mt.matrix.premultiply(P),mt.matrix.decompose(mt.position,mt.quaternion,mt.scale),mt.matrixWorldNeedsUpdate=!0,mt.visible=!0;var Pt=pt.id==="Daydream Controller"?0:1;nt[rt]===void 0&&(nt[rt]=!1),nt[rt]!==pt.buttons[Pt].pressed&&(nt[rt]=pt.buttons[Pt].pressed,nt[rt]===!0?mt.dispatchEvent({type:"selectstart"}):(mt.dispatchEvent({type:"selectend"}),mt.dispatchEvent({type:"select"}))),Pt=2,qe[rt]===void 0&&(qe[rt]=!1),pt.buttons[Pt]!==void 0&&qe[rt]!==pt.buttons[Pt].pressed&&(qe[rt]=pt.buttons[Pt].pressed,qe[rt]===!0?mt.dispatchEvent({type:"squeezestart"}):(mt.dispatchEvent({type:"squeezeend"}),mt.dispatchEvent({type:"squeeze"})))}else mt.visible=!1}}function ze(rt,mt){mt!==null&&mt.length===4&&rt.set(mt[0]*a,mt[1]*h,mt[2]*a,mt[3]*h)}this.enabled=!1,this.getController=function(rt){var mt=N[rt];return mt===void 0&&(mt=new hf,mt.matrixAutoUpdate=!1,mt.visible=!1,N[rt]=mt),mt},this.getDevice=function(){return b},this.setDevice=function(rt){rt!==void 0&&(b=rt),Oe.setContext(rt)},this.setFramebufferScaleFactor=function(rt){z=rt},this.setReferenceSpaceType=function(rt){X=rt},this.setPoseTarget=function(rt){rt!==void 0&&(M=rt)},this.cameraAutoUpdate=!0,this.updateCamera=function(rt){var mt=X==="local-floor"?1.6:0;if(b.depthNear=rt.near,b.depthFar=rt.far,b.getFrameData(E),X==="local-floor"){var pt=b.stageParameters;pt?P.fromArray(pt.sittingToStandingTransform):P.makeTranslation(0,mt,0)}var Tt=E.pose,Pt=M!==null?M:rt;Pt.matrix.copy(P),Pt.matrix.decompose(Pt.position,Pt.quaternion,Pt.scale),Tt.orientation!==null&&(K.fromArray(Tt.orientation),Pt.quaternion.multiply(K)),Tt.position!==null&&(K.setFromRotationMatrix(P),te.fromArray(Tt.position),te.applyQuaternion(K),Pt.position.add(te)),Pt.updateMatrixWorld();for(var ui=Pt.children,Li=0,Ft=ui.length;Li<Ft;Li++)ui[Li].updateMatrixWorld(!0);oe.near=rt.near,ne.near=rt.near,oe.far=rt.far,ne.far=rt.far,oe.matrixWorldInverse.fromArray(E.leftViewMatrix),ne.matrixWorldInverse.fromArray(E.rightViewMatrix),F.copy(P).invert(),X==="local-floor"&&(oe.matrixWorldInverse.multiply(F),ne.matrixWorldInverse.multiply(F));var gi=Pt.parent;gi!==null&&(q.copy(gi.matrixWorld).invert(),oe.matrixWorldInverse.multiply(q),ne.matrixWorldInverse.multiply(q)),oe.matrixWorld.copy(oe.matrixWorldInverse).invert(),ne.matrixWorld.copy(ne.matrixWorldInverse).invert(),oe.projectionMatrix.fromArray(E.leftProjectionMatrix),ne.projectionMatrix.fromArray(E.rightProjectionMatrix),tSe(ee,oe,ne);var Di=b.getLayers();if(Di.length){var kr=Di[0];ze(oe.viewport,kr.leftBounds),ze(ne.viewport,kr.rightBounds)}return it(),ee},this.getCamera=function(){return ee},this.getFoveation=function(){return 1},this.setFoveation=function(rt){rt!==1&&console.warn("THREE.WebVRManager: setFoveation() not used in WebVR.")},this.getEnvironmentBlendMode=function(){if(A.isPresenting)return"opaque"},this.getStandingMatrix=function(){return P},this.isPresenting=!1;var Oe=new TB;this.setAnimationLoop=function(rt){Oe.setAnimationLoop(rt),this.isPresenting&&Oe.start()},this.submitFrame=function(){this.isPresenting&&b.submitFrame()},this.dispose=function(){typeof window<"u"&&window.removeEventListener("vrdisplaypresentchange",_e)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}Object.assign(ij.prototype,{addEventListener:Eo.prototype.addEventListener,hasEventListener:Eo.prototype.hasEventListener,removeEventListener:Eo.prototype.removeEventListener,dispatchEvent:Eo.prototype.dispatchEvent});class rj extends Xo{constructor(a,h,A,b={}){super(a,h,b),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=A}copy(a){return super.copy(a),this.numViews=a.numViews,this}}rj.prototype.isWebGLMultiviewRenderTarget=!0;const iSe={type:"move"};class jB{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new hf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new hf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new He,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new He),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new hf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new He,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new He),this._grip}dispatchEvent(a){return this._targetRay!==null&&this._targetRay.dispatchEvent(a),this._grip!==null&&this._grip.dispatchEvent(a),this._hand!==null&&this._hand.dispatchEvent(a),this}connect(a){if(a&&a.hand){const h=this._hand;if(h)for(const A of a.hand.values())this._getHandJoint(h,A)}return this.dispatchEvent({type:"connected",data:a}),this}disconnect(a){return this.dispatchEvent({type:"disconnected",data:a}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(a,h,A){let b=null,E=null,M=null;const N=this._targetRay,P=this._grip,F=this._hand;if(a&&h.session.visibilityState!=="visible-blurred"){if(F&&a.hand){M=!0;for(const oe of a.hand.values()){const ne=h.getJointPose(oe,A),ee=this._getHandJoint(F,oe);ne!==null&&(ee.matrix.fromArray(ne.transform.matrix),ee.matrix.decompose(ee.position,ee.rotation,ee.scale),ee.matrixWorldNeedsUpdate=!0,ee.jointRadius=ne.radius),ee.visible=ne!==null}const z=F.joints["index-finger-tip"],X=F.joints["thumb-tip"],q=z.position.distanceTo(X.position),K=.02,te=.005;F.inputState.pinching&&q>K+te?(F.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:a.handedness,target:this})):!F.inputState.pinching&&q<=K-te&&(F.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:a.handedness,target:this}))}else P!==null&&a.gripSpace&&(E=h.getPose(a.gripSpace,A),E!==null&&(P.matrix.fromArray(E.transform.matrix),P.matrix.decompose(P.position,P.rotation,P.scale),P.matrixWorldNeedsUpdate=!0,E.linearVelocity?(P.hasLinearVelocity=!0,P.linearVelocity.copy(E.linearVelocity)):P.hasLinearVelocity=!1,E.angularVelocity?(P.hasAngularVelocity=!0,P.angularVelocity.copy(E.angularVelocity)):P.hasAngularVelocity=!1));N!==null&&(b=h.getPose(a.targetRaySpace,A),b===null&&E!==null&&(b=E),b!==null&&(N.matrix.fromArray(b.transform.matrix),N.matrix.decompose(N.position,N.rotation,N.scale),N.matrixWorldNeedsUpdate=!0,b.linearVelocity?(N.hasLinearVelocity=!0,N.linearVelocity.copy(b.linearVelocity)):N.hasLinearVelocity=!1,b.angularVelocity?(N.hasAngularVelocity=!0,N.angularVelocity.copy(b.angularVelocity)):N.hasAngularVelocity=!1,this.dispatchEvent(iSe)))}return N!==null&&(N.visible=b!==null),P!==null&&(P.visible=E!==null),F!==null&&(F.visible=M!==null),this}_getHandJoint(a,h){if(a.joints[h.jointName]===void 0){const A=new hf;A.matrixAutoUpdate=!1,A.visible=!1,a.joints[h.jointName]=A,a.add(A)}return a.joints[h.jointName]}}const rSe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,nSe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class sSe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(a,h,A){if(this.texture===null){const b=new us,E=a.properties.get(b);E.__webglTexture=h.texture,(h.depthNear!=A.depthNear||h.depthFar!=A.depthFar)&&(this.depthNear=h.depthNear,this.depthFar=h.depthFar),this.texture=b}}render(a,h){if(this.texture!==null){if(this.mesh===null){const A=h.cameras[0].viewport,b=new Cc({vertexShader:rSe,fragmentShader:nSe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:A.z},depthHeight:{value:A.w}}});this.mesh=new sa(new o0(20,20),b)}a.render(this.mesh,h)}}reset(){this.texture=null,this.mesh=null}}class aSe extends Eo{constructor(a,h,A,b){super();const E=this;let M=null,N=1;var P=null;let F=null,z="local-floor",X=1,q=null,K=null;var te=[];let oe=null,ne=null,ee=null,Me=null;const we=new sSe,_e=h.getContextAttributes();let nt=null,qe=null;const Je=[],it=[],ze=new ni;let Oe=null;const rt=new fa;rt.layers.enable(1),rt.viewport=new Fn;const mt=new fa;mt.layers.enable(2),mt.viewport=new Fn;const pt=[rt,mt],Tt=new zB;Tt.layers.enable(1),Tt.layers.enable(2);let Pt=null,ui=null;this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.isMultiview=!1,this.getCameraPose=function(){return K},this.getController=function(li){let _i=Je[li];return _i===void 0&&(_i=new jB,Je[li]=_i),_i.getTargetRaySpace()},this.getControllerGrip=function(li){let _i=Je[li];return _i===void 0&&(_i=new jB,Je[li]=_i),_i.getGripSpace()},this.getHand=function(li){let _i=Je[li];return _i===void 0&&(_i=new jB,Je[li]=_i),_i.getHandSpace()};function Li(li){const _i=it.indexOf(li.inputSource);if(_i===-1)return;const Qi=Je[_i];Qi!==void 0&&(Qi.update(li.inputSource,li.frame,q||F),Qi.dispatchEvent({type:li.type,data:li.inputSource}))}function Ft(){M.removeEventListener("select",Li),M.removeEventListener("selectstart",Li),M.removeEventListener("selectend",Li),M.removeEventListener("squeeze",Li),M.removeEventListener("squeezestart",Li),M.removeEventListener("squeezeend",Li),M.removeEventListener("end",Ft),M.removeEventListener("inputsourceschange",gi);for(let li=0;li<Je.length;li++){const _i=it[li];_i!==null&&(it[li]=null,Je[li].disconnect(_i))}Pt=null,ui=null,we.reset(),a.setRenderTarget(nt),ee=null,ne=null,oe=null,M=null,qe=null,wr.stop(),E.isPresenting=!1,a.setPixelRatio(Oe),a.setSize(ze.width,ze.height,!1),E.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(li){N=li,E.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(li){z=li,E.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return q||F},this.setReferenceSpace=function(li){q=li},this.getBaseLayer=function(){return ne!==null?ne:ee},this.getBinding=function(){return oe},this.getFrame=function(){return Me},this.getSession=function(){return M},this.setSession=async function(li){if(M=li,M!==null){if(nt=a.getRenderTarget(),M.addEventListener("select",Li),M.addEventListener("selectstart",Li),M.addEventListener("selectend",Li),M.addEventListener("squeeze",Li),M.addEventListener("squeezestart",Li),M.addEventListener("squeezeend",Li),M.addEventListener("end",Ft),M.addEventListener("inputsourceschange",gi),_e.xrCompatible!==!0&&await h.makeXRCompatible(),Oe=a.getPixelRatio(),a.getSize(ze),M.renderState.layers===void 0){const _i={antialias:_e.antialias,alpha:!0,depth:_e.depth,stencil:_e.stencil,framebufferScaleFactor:N};ee=new XRWebGLLayer(M,h,_i),M.updateRenderState({baseLayer:ee}),a.setPixelRatio(1),a.setSize(ee.framebufferWidth,ee.framebufferHeight,!1),qe=new Xo(ee.framebufferWidth,ee.framebufferHeight,{format:ge,type:mn,colorSpace:a.outputColorSpace,stencilBuffer:_e.stencil})}else{let _i=null,Qi=null,tt=null;_e.depth&&(tt=_e.stencil?h.DEPTH24_STENCIL8:h.DEPTH_COMPONENT24,_i=_e.stencil?ot:Ke,Qi=_e.stencil?Ni:ct),E.isMultiview=b&&A.has("OCULUS_multiview");const pi={colorFormat:h.RGBA8,depthFormat:tt,scaleFactor:N};E.isMultiview&&(pi.textureType="texture-array"),oe=new XRWebGLBinding(M,h),ne=oe.createProjectionLayer(pi),M.updateRenderState({layers:[ne]}),a.setPixelRatio(1),a.setSize(ne.textureWidth,ne.textureHeight,!1);const $t={format:ge,type:mn,depthTexture:new OB(ne.textureWidth,ne.textureHeight,Qi,void 0,void 0,void 0,void 0,void 0,void 0,_i),stencilBuffer:_e.stencil,colorSpace:a.outputColorSpace,samples:_e.antialias?4:0,resolveDepthBuffer:ne.ignoreDepthValues===!1};if(E.isMultiview){const Zi=A.get("OCULUS_multiview");this.maxNumViews=h.getParameter(Zi.MAX_VIEWS_OVR),qe=new rj(ne.textureWidth,ne.textureHeight,2,$t)}else qe=new Xo(ne.textureWidth,ne.textureHeight,$t)}qe.isXRRenderTarget=!0,this.setFoveation(X),q=null,F=await M.requestReferenceSpace(z),wr.setContext(M),wr.start(),E.isPresenting=!0,E.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(M!==null)return M.environmentBlendMode},this.addLayer=function(li){!window.XRWebGLBinding||!this.layersEnabled||!M||(te.push(li),this.updateLayers())},this.removeLayer=function(li){te.splice(te.indexOf(li),1),!(!window.XRWebGLBinding||!this.layersEnabled||!M)&&this.updateLayers()},this.updateLayers=function(){var li=te.map(function(_i){return _i});li.unshift(M.renderState.layers[0]),M.updateRenderState({layers:li})};function gi(li){for(let _i=0;_i<li.removed.length;_i++){const Qi=li.removed[_i],tt=it.indexOf(Qi);tt>=0&&(it[tt]=null,Je[tt].disconnect(Qi))}for(let _i=0;_i<li.added.length;_i++){const Qi=li.added[_i];let tt=it.indexOf(Qi);if(tt===-1){for(let $t=0;$t<Je.length;$t++)if($t>=it.length){it.push(Qi),tt=$t;break}else if(it[$t]===null){it[$t]=Qi,tt=$t;break}if(tt===-1)break}const pi=Je[tt];pi&&pi.connect(Qi)}}const Di=new He,kr=new He;function xn(li,_i,Qi){Di.setFromMatrixPosition(_i.matrixWorld),kr.setFromMatrixPosition(Qi.matrixWorld);const tt=Di.distanceTo(kr),pi=_i.projectionMatrix.elements,$t=Qi.projectionMatrix.elements,Zi=pi[14]/(pi[10]-1),ai=pi[14]/(pi[10]+1),er=(pi[9]+1)/pi[5],$i=(pi[9]-1)/pi[5],Ar=(pi[8]-1)/pi[0],gn=($t[8]+1)/$t[0],Hr=Zi*Ar,aa=Zi*gn,Hs=tt/(-Ar+gn),Gn=Hs*-Ar;_i.matrixWorld.decompose(li.position,li.quaternion,li.scale),li.translateX(Gn),li.translateZ(Hs),li.matrixWorld.compose(li.position,li.quaternion,li.scale),li.matrixWorldInverse.copy(li.matrixWorld).invert();const et=Zi+Hs,De=ai+Hs,kt=Hr-Gn,ci=aa+(tt-Gn),fi=er*ai/De*et,si=$i*ai/De*et;li.projectionMatrix.makePerspective(kt,ci,fi,si,et,De),li.projectionMatrixInverse.copy(li.projectionMatrix).invert()}function es(li,_i){_i===null?li.matrixWorld.copy(li.matrix):li.matrixWorld.multiplyMatrices(_i.matrixWorld,li.matrix),li.matrixWorldInverse.copy(li.matrixWorld).invert()}this.setPoseTarget=function(li){li!==void 0&&(P=li)},this.updateCamera=function(li){if(M===null)return;we.texture!==null&&(li.near=we.depthNear,li.far=we.depthFar),Tt.near=mt.near=rt.near=li.near,Tt.far=mt.far=rt.far=li.far,(Pt!==Tt.near||ui!==Tt.far)&&(M.updateRenderState({depthNear:Tt.near,depthFar:Tt.far}),Pt=Tt.near,ui=Tt.far,rt.near=Pt,rt.far=ui,mt.near=Pt,mt.far=ui,rt.updateProjectionMatrix(),mt.updateProjectionMatrix(),li.updateProjectionMatrix());const _i=Tt.cameras;var Qi=P||li;const tt=Qi.parent;es(Tt,tt);for(let pi=0;pi<_i.length;pi++)es(_i[pi],tt);_i.length===2?xn(Tt,rt,mt):Tt.projectionMatrix.copy(rt.projectionMatrix),hs(li,Tt,Qi)};function hs(li,_i,Qi){_i.matrixWorld.decompose(_i.position,_i.quaternion,_i.scale),Qi.parent===null?Qi.matrix.copy(_i.matrixWorld):(Qi.matrix.copy(Qi.parent.matrixWorld),Qi.matrix.invert(),Qi.matrix.multiply(_i.matrixWorld)),Qi.matrix.decompose(Qi.position,Qi.quaternion,Qi.scale),Qi.updateMatrixWorld(!0),li.projectionMatrix.copy(_i.projectionMatrix),li.projectionMatrixInverse.copy(_i.projectionMatrixInverse),li.isPerspectiveCamera&&(li.fov=wd*2*Math.atan(1/li.projectionMatrix.elements[5]),li.zoom=1)}this.getCamera=function(){return Tt},this.getFoveation=function(){if(!(ne===null&&ee===null))return X},this.setFoveation=function(li){X=li,ne!==null&&(ne.fixedFoveation=li),ee!==null&&ee.fixedFoveation!==void 0&&(ee.fixedFoveation=li)},this.hasDepthSensing=function(){return we.texture!==null};let Un=null;function In(li,_i){if(K=_i.getViewerPose(q||F),Me=_i,K!==null){const Qi=K.views;ee!==null&&(a.setRenderTargetFramebuffer(qe,ee.framebuffer),a.setRenderTarget(qe));let tt=!1;Qi.length!==Tt.cameras.length&&(Tt.cameras.length=0,tt=!0);for(let $t=0;$t<Qi.length;$t++){const Zi=Qi[$t];let ai=null;if(ee!==null)ai=ee.getViewport(Zi);else{const $i=oe.getViewSubImage(ne,Zi);ai=$i.viewport,$t===0&&(a.setRenderTargetTextures(qe,$i.colorTexture,ne.ignoreDepthValues?void 0:$i.depthStencilTexture),a.setRenderTarget(qe))}let er=pt[$t];er===void 0&&(er=new fa,er.layers.enable($t),er.viewport=new Fn,pt[$t]=er),er.matrix.fromArray(Zi.transform.matrix),er.matrix.decompose(er.position,er.quaternion,er.scale),er.projectionMatrix.fromArray(Zi.projectionMatrix),er.projectionMatrixInverse.copy(er.projectionMatrix).invert(),er.viewport.set(ai.x,ai.y,ai.width,ai.height),$t===0&&(Tt.matrix.copy(er.matrix),Tt.matrix.decompose(Tt.position,Tt.quaternion,Tt.scale)),tt===!0&&Tt.cameras.push(er)}const pi=M.enabledFeatures;if(pi&&pi.includes("depth-sensing")){const $t=oe.getDepthInformation(Qi[0]);$t&&$t.isValid&&$t.texture&&we.init(a,$t,M.renderState)}}for(let Qi=0;Qi<Je.length;Qi++){const tt=it[Qi],pi=Je[Qi];tt!==null&&pi!==void 0&&pi.update(tt,_i,q||F)}we.render(a,Tt),Un&&Un(li,_i),_i.detectedPlanes&&E.dispatchEvent({type:"planesdetected",data:_i}),Me=null}const wr=new TB;wr.setAnimationLoop(In),this.setAnimationLoop=function(li){Un=li},this.dispose=function(){}}}const df=new xl,oSe=new fr;function lSe(C,a){function h(ne,ee){ne.matrixAutoUpdate===!0&&ne.updateMatrix(),ee.value.copy(ne.matrix)}function A(ne,ee){ee.color.getRGB(ne.fogColor.value,b9(C)),ee.isFog?(ne.fogNear.value=ee.near,ne.fogFar.value=ee.far):ee.isFogExp2&&(ne.fogDensity.value=ee.density)}function b(ne,ee,Me,we,_e){ee.isMeshBasicMaterial||ee.isMeshLambertMaterial?E(ne,ee):ee.isMeshToonMaterial?(E(ne,ee),X(ne,ee)):ee.isMeshPhongMaterial?(E(ne,ee),z(ne,ee)):ee.isMeshStandardMaterial?(E(ne,ee),q(ne,ee),ee.isMeshPhysicalMaterial&&K(ne,ee,_e)):ee.isMeshMatcapMaterial?(E(ne,ee),te(ne,ee)):ee.isMeshDepthMaterial?E(ne,ee):ee.isMeshDistanceMaterial?(E(ne,ee),oe(ne,ee)):ee.isMeshNormalMaterial?E(ne,ee):ee.isLineBasicMaterial?(M(ne,ee),ee.isLineDashedMaterial&&N(ne,ee)):ee.isPointsMaterial?P(ne,ee,Me,we):ee.isSpriteMaterial?F(ne,ee):ee.isShadowMaterial?(ne.color.value.copy(ee.color),ne.opacity.value=ee.opacity):ee.isShaderMaterial&&(ee.uniformsNeedUpdate=!1)}function E(ne,ee){ne.opacity.value=ee.opacity,ee.color&&ne.diffuse.value.copy(ee.color),ee.emissive&&ne.emissive.value.copy(ee.emissive).multiplyScalar(ee.emissiveIntensity),ee.map&&(ne.map.value=ee.map,h(ee.map,ne.mapTransform)),ee.alphaMap&&(ne.alphaMap.value=ee.alphaMap,h(ee.alphaMap,ne.alphaMapTransform)),ee.bumpMap&&(ne.bumpMap.value=ee.bumpMap,h(ee.bumpMap,ne.bumpMapTransform),ne.bumpScale.value=ee.bumpScale,ee.side===R&&(ne.bumpScale.value*=-1)),ee.normalMap&&(ne.normalMap.value=ee.normalMap,h(ee.normalMap,ne.normalMapTransform),ne.normalScale.value.copy(ee.normalScale),ee.side===R&&ne.normalScale.value.negate()),ee.displacementMap&&(ne.displacementMap.value=ee.displacementMap,h(ee.displacementMap,ne.displacementMapTransform),ne.displacementScale.value=ee.displacementScale,ne.displacementBias.value=ee.displacementBias),ee.emissiveMap&&(ne.emissiveMap.value=ee.emissiveMap,h(ee.emissiveMap,ne.emissiveMapTransform)),ee.specularMap&&(ne.specularMap.value=ee.specularMap,h(ee.specularMap,ne.specularMapTransform)),ee.alphaTest>0&&(ne.alphaTest.value=ee.alphaTest);const Me=a.get(ee),we=Me.envMap,_e=Me.envMapRotation;if(we&&(ne.envMap.value=we,df.copy(_e),df.x*=-1,df.y*=-1,df.z*=-1,we.isCubeTexture&&we.isRenderTargetTexture===!1&&(df.y*=-1,df.z*=-1),ne.envMapRotation.value.setFromMatrix4(oSe.makeRotationFromEuler(df)),ne.flipEnvMap.value=we.isCubeTexture&&we.isRenderTargetTexture===!1?-1:1,ne.reflectivity.value=ee.reflectivity,ne.ior.value=ee.ior,ne.refractionRatio.value=ee.refractionRatio),ee.lightMap){ne.lightMap.value=ee.lightMap;const nt=C._useLegacyLights===!0?Math.PI:1;ne.lightMapIntensity.value=ee.lightMapIntensity*nt,h(ee.lightMap,ne.lightMapTransform)}ee.aoMap&&(ne.aoMap.value=ee.aoMap,ne.aoMapIntensity.value=ee.aoMapIntensity,h(ee.aoMap,ne.aoMapTransform))}function M(ne,ee){ne.diffuse.value.copy(ee.color),ne.opacity.value=ee.opacity,ee.map&&(ne.map.value=ee.map,h(ee.map,ne.mapTransform))}function N(ne,ee){ne.dashSize.value=ee.dashSize,ne.totalSize.value=ee.dashSize+ee.gapSize,ne.scale.value=ee.scale}function P(ne,ee,Me,we){ne.diffuse.value.copy(ee.color),ne.opacity.value=ee.opacity,ne.size.value=ee.size*Me,ne.scale.value=we*.5,ee.map&&(ne.map.value=ee.map,h(ee.map,ne.uvTransform)),ee.alphaMap&&(ne.alphaMap.value=ee.alphaMap,h(ee.alphaMap,ne.alphaMapTransform)),ee.alphaTest>0&&(ne.alphaTest.value=ee.alphaTest)}function F(ne,ee){ne.diffuse.value.copy(ee.color),ne.opacity.value=ee.opacity,ne.rotation.value=ee.rotation,ee.map&&(ne.map.value=ee.map,h(ee.map,ne.mapTransform)),ee.alphaMap&&(ne.alphaMap.value=ee.alphaMap,h(ee.alphaMap,ne.alphaMapTransform)),ee.alphaTest>0&&(ne.alphaTest.value=ee.alphaTest)}function z(ne,ee){ne.specular.value.copy(ee.specular),ne.shininess.value=Math.max(ee.shininess,1e-4)}function X(ne,ee){ee.gradientMap&&(ne.gradientMap.value=ee.gradientMap)}function q(ne,ee){ne.metalness.value=ee.metalness,ee.metalnessMap&&(ne.metalnessMap.value=ee.metalnessMap,h(ee.metalnessMap,ne.metalnessMapTransform)),ne.roughness.value=ee.roughness,ee.roughnessMap&&(ne.roughnessMap.value=ee.roughnessMap,h(ee.roughnessMap,ne.roughnessMapTransform)),ee.envMap&&(ne.envMapIntensity.value=ee.envMapIntensity)}function K(ne,ee,Me){ne.ior.value=ee.ior,ee.sheen>0&&(ne.sheenColor.value.copy(ee.sheenColor).multiplyScalar(ee.sheen),ne.sheenRoughness.value=ee.sheenRoughness,ee.sheenColorMap&&(ne.sheenColorMap.value=ee.sheenColorMap,h(ee.sheenColorMap,ne.sheenColorMapTransform)),ee.sheenRoughnessMap&&(ne.sheenRoughnessMap.value=ee.sheenRoughnessMap,h(ee.sheenRoughnessMap,ne.sheenRoughnessMapTransform))),ee.clearcoat>0&&(ne.clearcoat.value=ee.clearcoat,ne.clearcoatRoughness.value=ee.clearcoatRoughness,ee.clearcoatMap&&(ne.clearcoatMap.value=ee.clearcoatMap,h(ee.clearcoatMap,ne.clearcoatMapTransform)),ee.clearcoatRoughnessMap&&(ne.clearcoatRoughnessMap.value=ee.clearcoatRoughnessMap,h(ee.clearcoatRoughnessMap,ne.clearcoatRoughnessMapTransform)),ee.clearcoatNormalMap&&(ne.clearcoatNormalMap.value=ee.clearcoatNormalMap,h(ee.clearcoatNormalMap,ne.clearcoatNormalMapTransform),ne.clearcoatNormalScale.value.copy(ee.clearcoatNormalScale),ee.side===R&&ne.clearcoatNormalScale.value.negate())),ee.dispersion>0&&(ne.dispersion.value=ee.dispersion),ee.iridescence>0&&(ne.iridescence.value=ee.iridescence,ne.iridescenceIOR.value=ee.iridescenceIOR,ne.iridescenceThicknessMinimum.value=ee.iridescenceThicknessRange[0],ne.iridescenceThicknessMaximum.value=ee.iridescenceThicknessRange[1],ee.iridescenceMap&&(ne.iridescenceMap.value=ee.iridescenceMap,h(ee.iridescenceMap,ne.iridescenceMapTransform)),ee.iridescenceThicknessMap&&(ne.iridescenceThicknessMap.value=ee.iridescenceThicknessMap,h(ee.iridescenceThicknessMap,ne.iridescenceThicknessMapTransform))),ee.transmission>0&&(ne.transmission.value=ee.transmission,ne.transmissionSamplerMap.value=Me.texture,ne.transmissionSamplerSize.value.set(Me.width,Me.height),ee.transmissionMap&&(ne.transmissionMap.value=ee.transmissionMap,h(ee.transmissionMap,ne.transmissionMapTransform)),ne.thickness.value=ee.thickness,ee.thicknessMap&&(ne.thicknessMap.value=ee.thicknessMap,h(ee.thicknessMap,ne.thicknessMapTransform)),ne.attenuationDistance.value=ee.attenuationDistance,ne.attenuationColor.value.copy(ee.attenuationColor)),ee.anisotropy>0&&(ne.anisotropyVector.value.set(ee.anisotropy*Math.cos(ee.anisotropyRotation),ee.anisotropy*Math.sin(ee.anisotropyRotation)),ee.anisotropyMap&&(ne.anisotropyMap.value=ee.anisotropyMap,h(ee.anisotropyMap,ne.anisotropyMapTransform))),ne.specularIntensity.value=ee.specularIntensity,ne.specularColor.value.copy(ee.specularColor),ee.specularColorMap&&(ne.specularColorMap.value=ee.specularColorMap,h(ee.specularColorMap,ne.specularColorMapTransform)),ee.specularIntensityMap&&(ne.specularIntensityMap.value=ee.specularIntensityMap,h(ee.specularIntensityMap,ne.specularIntensityMapTransform))}function te(ne,ee){ee.matcap&&(ne.matcap.value=ee.matcap)}function oe(ne,ee){const Me=a.get(ee).light;ne.referencePosition.value.setFromMatrixPosition(Me.matrixWorld),ne.nearDistance.value=Me.shadow.camera.near,ne.farDistance.value=Me.shadow.camera.far}return{refreshFogUniforms:A,refreshMaterialUniforms:b}}function cSe(C,a,h,A){let b={},E={},M=[];const N=C.getParameter(C.MAX_UNIFORM_BUFFER_BINDINGS);function P(Me,we){const _e=we.program;A.uniformBlockBinding(Me,_e)}function F(Me,we){let _e=b[Me.id];_e===void 0&&(te(Me),_e=z(Me),b[Me.id]=_e,Me.addEventListener("dispose",ne));const nt=we.program;A.updateUBOMapping(Me,nt);const qe=a.render.frame;E[Me.id]!==qe&&(q(Me),E[Me.id]=qe)}function z(Me){const we=X();Me.__bindingPointIndex=we;const _e=C.createBuffer(),nt=Me.__size,qe=Me.usage;return C.bindBuffer(C.UNIFORM_BUFFER,_e),C.bufferData(C.UNIFORM_BUFFER,nt,qe),C.bindBuffer(C.UNIFORM_BUFFER,null),C.bindBufferBase(C.UNIFORM_BUFFER,we,_e),_e}function X(){for(let Me=0;Me<N;Me++)if(M.indexOf(Me)===-1)return M.push(Me),Me;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function q(Me){const we=b[Me.id],_e=Me.uniforms,nt=Me.__cache;C.bindBuffer(C.UNIFORM_BUFFER,we);for(let qe=0,Je=_e.length;qe<Je;qe++){const it=Array.isArray(_e[qe])?_e[qe]:[_e[qe]];for(let ze=0,Oe=it.length;ze<Oe;ze++){const rt=it[ze];if(K(rt,qe,ze,nt)===!0){const mt=rt.__offset,pt=Array.isArray(rt.value)?rt.value:[rt.value];let Tt=0;for(let Pt=0;Pt<pt.length;Pt++){const ui=pt[Pt],Li=oe(ui);typeof ui=="number"||typeof ui=="boolean"?(rt.__data[0]=ui,C.bufferSubData(C.UNIFORM_BUFFER,mt+Tt,rt.__data)):ui.isMatrix3?(rt.__data[0]=ui.elements[0],rt.__data[1]=ui.elements[1],rt.__data[2]=ui.elements[2],rt.__data[3]=0,rt.__data[4]=ui.elements[3],rt.__data[5]=ui.elements[4],rt.__data[6]=ui.elements[5],rt.__data[7]=0,rt.__data[8]=ui.elements[6],rt.__data[9]=ui.elements[7],rt.__data[10]=ui.elements[8],rt.__data[11]=0):(ui.toArray(rt.__data,Tt),Tt+=Li.storage/Float32Array.BYTES_PER_ELEMENT)}C.bufferSubData(C.UNIFORM_BUFFER,mt,rt.__data)}}}C.bindBuffer(C.UNIFORM_BUFFER,null)}function K(Me,we,_e,nt){const qe=Me.value,Je=we+"_"+_e;if(nt[Je]===void 0)return typeof qe=="number"||typeof qe=="boolean"?nt[Je]=qe:nt[Je]=qe.clone(),!0;{const it=nt[Je];if(typeof qe=="number"||typeof qe=="boolean"){if(it!==qe)return nt[Je]=qe,!0}else if(it.equals(qe)===!1)return it.copy(qe),!0}return!1}function te(Me){const we=Me.uniforms;let _e=0;const nt=16;for(let Je=0,it=we.length;Je<it;Je++){const ze=Array.isArray(we[Je])?we[Je]:[we[Je]];for(let Oe=0,rt=ze.length;Oe<rt;Oe++){const mt=ze[Oe],pt=Array.isArray(mt.value)?mt.value:[mt.value];for(let Tt=0,Pt=pt.length;Tt<Pt;Tt++){const ui=pt[Tt],Li=oe(ui),Ft=_e%nt;Ft!==0&&nt-Ft<Li.boundary&&(_e+=nt-Ft),mt.__data=new Float32Array(Li.storage/Float32Array.BYTES_PER_ELEMENT),mt.__offset=_e,_e+=Li.storage}}}const qe=_e%nt;return qe>0&&(_e+=nt-qe),Me.__size=_e,Me.__cache={},this}function oe(Me){const we={boundary:0,storage:0};return typeof Me=="number"||typeof Me=="boolean"?(we.boundary=4,we.storage=4):Me.isVector2?(we.boundary=8,we.storage=8):Me.isVector3||Me.isColor?(we.boundary=16,we.storage=12):Me.isVector4?(we.boundary=16,we.storage=16):Me.isMatrix3?(we.boundary=48,we.storage=48):Me.isMatrix4?(we.boundary=64,we.storage=64):Me.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Me),we}function ne(Me){const we=Me.target;we.removeEventListener("dispose",ne);const _e=M.indexOf(we.__bindingPointIndex);M.splice(_e,1),C.deleteBuffer(b[we.id]),delete b[we.id],delete E[we.id]}function ee(){for(const Me in b)C.deleteBuffer(b[Me]);M=[],b={},E={}}return{bind:P,update:F,dispose:ee}}class uSe{constructor(a={}){const{canvas:h=lE(),context:A=null,depth:b=!0,stencil:E=!1,alpha:M=!1,antialias:N=!1,premultipliedAlpha:P=!0,preserveDrawingBuffer:F=!1,powerPreference:z="default",failIfMajorPerformanceCaveat:X=!1,multiviewStereo:q=!1}=a;this.isWebGLRenderer=!0;let K;if(A!==null){if(typeof WebGLRenderingContext<"u"&&A instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");K=A.getContextAttributes().alpha}else K=M;const te=new Uint32Array(4),oe=new Int32Array(4);let ne=null,ee=null;const Me=[],we=[];this.domElement=h,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ln,this._useLegacyLights=!1,this.toneMapping=Ot,this.toneMappingExposure=1;const _e=this;let nt=!1,qe=0,Je=0,it=null,ze=-1,Oe=null;const rt=new Fn,mt=new Fn;let pt=null;const Tt=new or(0);let Pt=0,ui=h.width,Li=h.height,Ft=1,gi=null,Di=null;const kr=new Fn(0,0,ui,Li),xn=new Fn(0,0,ui,Li);let es=!1;const hs=new av;let Un=!1,In=!1;const wr=new fr,li=new He,_i={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Qi(){return it===null?Ft:1}let tt=A;function pi(Ve,Et){return h.getContext(Ve,Et)}try{const Ve={alpha:!0,depth:b,stencil:E,antialias:N,premultipliedAlpha:P,preserveDrawingBuffer:F,powerPreference:z,failIfMajorPerformanceCaveat:X};if("setAttribute"in h&&h.setAttribute("data-engine",`three.js r${d}`),h.addEventListener("webglcontextlost",Ti,!1),h.addEventListener("webglcontextrestored",Tr,!1),h.addEventListener("webglcontextcreationerror",rr,!1),tt===null){const Et="webgl2";if(tt=pi(Et,Ve),tt===null)throw pi(Et)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Ve){throw console.error("THREE.WebGLRenderer: "+Ve.message),Ve}let $t,Zi,ai,er,$i,Ar,gn,Hr,aa,Hs,Gn,et,De,kt,ci,fi,si,Mr,Ui,cr,Hn,lr,_r,bn,Ur;function ut(){$t=new x2e(tt),$t.init(),_r=new $9(tt,$t),Zi=new f2e(tt,$t,a,_r),ai=new $Ce(tt),er=new E2e(tt),$i=new jCe,Ar=new eSe(tt,$t,ai,$i,Zi,_r,er),gn=new g2e(_e),Hr=new v2e(_e),aa=new uEe(tt),bn=new d2e(tt,aa),Hs=new b2e(tt,aa,er,bn),Gn=new S2e(tt,Hs,aa,er),cr=new w2e(tt,Zi,Ar),fi=new m2e($i),et=new zCe(_e,gn,Hr,$t,Zi,bn,fi),De=new lSe(_e,$i),kt=new GCe,ci=new YCe($t),Ui=new h2e(_e,gn,Hr,ai,Gn,K,P),Mr=new C2e(_e,$t,tt),si=new ZCe(_e,Gn,Zi),Ur=new cSe(tt,er,Zi,ai),Hn=new p2e(tt,$t,er),lr=new _2e(tt,$t,er),er.programs=et.programs,_e.capabilities=Zi,_e.extensions=$t,_e.properties=$i,_e.renderLists=kt,_e.shadowMap=si,_e.state=ai,_e.info=er}ut();const Ai=typeof navigator<"u"&&"xr"in navigator?new aSe(_e,tt,$t,q):new ij(_e);this.xr=Ai,this.getContext=function(){return tt},this.getContextAttributes=function(){return tt.getContextAttributes()},this.forceContextLoss=function(){const Ve=$t.get("WEBGL_lose_context");Ve&&Ve.loseContext()},this.forceContextRestore=function(){const Ve=$t.get("WEBGL_lose_context");Ve&&Ve.restoreContext()},this.getPixelRatio=function(){return Ft},this.setPixelRatio=function(Ve){Ve!==void 0&&(Ft=Ve,this.setSize(ui,Li,!1))},this.getSize=function(Ve){return Ve.set(ui,Li)},this.setSize=function(Ve,Et,jt=!0){if(Ai.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ui=Ve,Li=Et,h.width=Math.floor(Ve*Ft),h.height=Math.floor(Et*Ft),jt===!0&&(h.style.width=Ve+"px",h.style.height=Et+"px"),this.setViewport(0,0,Ve,Et)},this.getDrawingBufferSize=function(Ve){return Ve.set(ui*Ft,Li*Ft).floor()},this.setDrawingBufferSize=function(Ve,Et,jt){ui=Ve,Li=Et,Ft=jt,h.width=Math.floor(Ve*jt),h.height=Math.floor(Et*jt),this.setViewport(0,0,Ve,Et)},this.getCurrentViewport=function(Ve){return Ve.copy(rt)},this.getViewport=function(Ve){return Ve.copy(kr)},this.setViewport=function(Ve,Et,jt,Dt){Ve.isVector4?kr.set(Ve.x,Ve.y,Ve.z,Ve.w):kr.set(Ve,Et,jt,Dt),ai.viewport(rt.copy(kr).multiplyScalar(Ft).round())},this.getScissor=function(Ve){return Ve.copy(xn)},this.setScissor=function(Ve,Et,jt,Dt){Ve.isVector4?xn.set(Ve.x,Ve.y,Ve.z,Ve.w):xn.set(Ve,Et,jt,Dt),ai.scissor(mt.copy(xn).multiplyScalar(Ft).round())},this.getScissorTest=function(){return es},this.setScissorTest=function(Ve){ai.setScissorTest(es=Ve)},this.setOpaqueSort=function(Ve){gi=Ve},this.setTransparentSort=function(Ve){Di=Ve},this.getClearColor=function(Ve){return Ve.copy(Ui.getClearColor())},this.setClearColor=function(){Ui.setClearColor.apply(Ui,arguments)},this.getClearAlpha=function(){return Ui.getClearAlpha()},this.setClearAlpha=function(){Ui.setClearAlpha.apply(Ui,arguments)},this.clear=function(Ve=!0,Et=!0,jt=!0){let Dt=0;if(Ve){let Nt=!1;if(it!==null){const Gi=it.texture.format;Nt=Gi===ti||Gi===Rt||Gi===qt}if(Nt){const Gi=it.texture.type,Br=Gi===mn||Gi===ct||Gi===As||Gi===Ni||Gi===Ii||Gi===sr,Ir=Ui.getClearColor(),Vr=Ui.getClearAlpha(),on=Ir.r,Bn=Ir.g,Mn=Ir.b;Br?(te[0]=on,te[1]=Bn,te[2]=Mn,te[3]=Vr,tt.clearBufferuiv(tt.COLOR,0,te)):(oe[0]=on,oe[1]=Bn,oe[2]=Mn,oe[3]=Vr,tt.clearBufferiv(tt.COLOR,0,oe))}else Dt|=tt.COLOR_BUFFER_BIT}Et&&(Dt|=tt.DEPTH_BUFFER_BIT),jt&&(Dt|=tt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),tt.clear(Dt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){h.removeEventListener("webglcontextlost",Ti,!1),h.removeEventListener("webglcontextrestored",Tr,!1),h.removeEventListener("webglcontextcreationerror",rr,!1),kt.dispose(),ci.dispose(),$i.dispose(),gn.dispose(),Hr.dispose(),Gn.dispose(),bn.dispose(),Ur.dispose(),et.dispose(),Ai.dispose(),Ai.removeEventListener("sessionstart",$c),Ai.removeEventListener("sessionend",HV),Cf.stop()};function Ti(Ve){Ve.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),nt=!0}function Tr(){console.log("THREE.WebGLRenderer: Context Restored."),nt=!1;const Ve=er.autoReset,Et=si.enabled,jt=si.autoUpdate,Dt=si.needsUpdate,Nt=si.type;ut(),er.autoReset=Ve,si.enabled=Et,si.autoUpdate=jt,si.needsUpdate=Dt,si.type=Nt}function rr(Ve){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ve.statusMessage)}function an(Ve){const Et=Ve.target;Et.removeEventListener("dispose",an),nr(Et)}function nr(Ve){Ki(Ve),$i.remove(Ve)}function Ki(Ve){const Et=$i.get(Ve).programs;Et!==void 0&&(Et.forEach(function(jt){et.releaseProgram(jt)}),Ve.isShaderMaterial&&et.releaseShaderCache(Ve))}this.renderBufferDirect=function(Ve,Et,jt,Dt,Nt,Gi){Et===null&&(Et=_i);const Br=Nt.isMesh&&Nt.matrixWorld.determinant()<0,Ir=nMe(Ve,Et,jt,Dt,Nt);ai.setMaterial(Dt,Br);let Vr=jt.index,on=1;if(Dt.wireframe===!0){if(Vr=Hs.getWireframeAttribute(jt),Vr===void 0)return;on=2}const Bn=jt.drawRange,Mn=jt.attributes.position;let Aa=Bn.start*on,$o=(Bn.start+Bn.count)*on;Gi!==null&&(Aa=Math.max(Aa,Gi.start*on),$o=Math.min($o,(Gi.start+Gi.count)*on)),Vr!==null?(Aa=Math.max(Aa,0),$o=Math.min($o,Vr.count)):Mn!=null&&(Aa=Math.max(Aa,0),$o=Math.min($o,Mn.count));const zl=$o-Aa;if(zl<0||zl===1/0)return;bn.setup(Nt,Dt,Ir,jt,Vr);let el,vs=Hn;if(Vr!==null&&(el=aa.get(Vr),vs=lr,vs.setIndex(el)),Nt.isMesh)Dt.wireframe===!0?(ai.setLineWidth(Dt.wireframeLinewidth*Qi()),vs.setMode(tt.LINES)):vs.setMode(tt.TRIANGLES);else if(Nt.isLine){let bh=Dt.linewidth;bh===void 0&&(bh=1),ai.setLineWidth(bh*Qi()),Nt.isLineSegments?vs.setMode(tt.LINES):Nt.isLineLoop?vs.setMode(tt.LINE_LOOP):vs.setMode(tt.LINE_STRIP)}else Nt.isPoints?vs.setMode(tt.POINTS):Nt.isSprite&&vs.setMode(tt.TRIANGLES);if(Nt.isBatchedMesh)Nt._multiDrawInstances!==null?vs.renderMultiDrawInstances(Nt._multiDrawStarts,Nt._multiDrawCounts,Nt._multiDrawCount,Nt._multiDrawInstances):vs.renderMultiDraw(Nt._multiDrawStarts,Nt._multiDrawCounts,Nt._multiDrawCount);else if(Nt.isInstancedMesh)vs.renderInstances(Aa,zl,Nt.count);else if(jt.isInstancedBufferGeometry){const bh=jt._maxInstanceCount!==void 0?jt._maxInstanceCount:1/0,En=Math.min(jt.instanceCount,bh);vs.renderInstances(Aa,zl,En)}else vs.render(Aa,zl)};function An(Ve,Et,jt){Ve.transparent===!0&&Ve.side===B&&Ve.forceSinglePass===!1?(Ve.side=R,Ve.needsUpdate=!0,Iw(Ve,Et,jt),Ve.side=S,Ve.needsUpdate=!0,Iw(Ve,Et,jt),Ve.side=B):Iw(Ve,Et,jt)}this.compile=function(Ve,Et,jt=null){jt===null&&(jt=Ve),ee=ci.get(jt),ee.init(Et),we.push(ee),jt.traverseVisible(function(Nt){Nt.isLight&&Nt.layers.test(Et.layers)&&(ee.pushLight(Nt),Nt.castShadow&&ee.pushShadow(Nt))}),Ve!==jt&&Ve.traverseVisible(function(Nt){Nt.isLight&&Nt.layers.test(Et.layers)&&(ee.pushLight(Nt),Nt.castShadow&&ee.pushShadow(Nt))}),ee.setupLights(_e._useLegacyLights);const Dt=new Set;return Ve.traverse(function(Nt){const Gi=Nt.material;if(Gi)if(Array.isArray(Gi))for(let Br=0;Br<Gi.length;Br++){const Ir=Gi[Br];An(Ir,jt,Nt),Dt.add(Ir)}else An(Gi,jt,Nt),Dt.add(Gi)}),we.pop(),ee=null,Dt},this.compileAsync=function(Ve,Et,jt=null){const Dt=this.compile(Ve,Et,jt);return new Promise(Nt=>{function Gi(){if(Dt.forEach(function(Br){$i.get(Br).currentProgram.isReady()&&Dt.delete(Br)}),Dt.size===0){Nt(Ve);return}setTimeout(Gi,10)}$t.get("KHR_parallel_shader_compile")!==null?Gi():setTimeout(Gi,10)})};let Rr=null;function Ul(Ve){Rr&&Rr(Ve)}function $c(){Cf.stop()}function HV(){Cf.start()}const Cf=new TB;Cf.setAnimationLoop(Ul),typeof self<"u"&&Cf.setContext(self),this.setAnimationLoop=function(Ve){Rr=Ve,Ai.setAnimationLoop(Ve),Ve===null?Cf.stop():Cf.start()},Ai.addEventListener("sessionstart",$c),Ai.addEventListener("sessionend",HV),this.render=function(Ve,Et){if(Et!==void 0&&Et.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(nt===!0)return;Ve.matrixWorldAutoUpdate===!0&&Ve.updateMatrixWorld(),Et.parent===null&&Et.matrixWorldAutoUpdate===!0&&Et.updateMatrixWorld(),Ai.enabled===!0&&Ai.isPresenting===!0&&(Ai.cameraAutoUpdate===!0&&Ai.updateCamera(Et),Et=Ai.getCamera()),Ve.isScene===!0&&Ve.onBeforeRender(_e,Ve,Et,it),ee=ci.get(Ve,we.length),ee.init(Et),we.push(ee),wr.multiplyMatrices(Et.projectionMatrix,Et.matrixWorldInverse),hs.setFromProjectionMatrix(wr),In=this.localClippingEnabled,Un=fi.init(this.clippingPlanes,In),ne=kt.get(Ve,Me.length),ne.init(),Me.push(ne),WV(Ve,Et,0,_e.sortObjects),ne.finish(),_e.sortObjects===!0&&ne.sort(gi,Di);const jt=Ai.enabled===!1||Ai.isPresenting===!1||Ai.hasDepthSensing()===!1;jt&&Ui.addToRenderList(ne,Ve),this.info.render.frame++,Un===!0&&fi.beginShadows();const Dt=ee.state.shadowsArray;si.render(Dt,Ve,Et),Un===!0&&fi.endShadows(),this.info.autoReset===!0&&this.info.reset();const Nt=ne.opaque,Gi=ne.transmissive;if(ee.setupLights(_e._useLegacyLights),Et.isArrayCamera){const Br=Et.cameras;if(Gi.length>0)for(let Ir=0,Vr=Br.length;Ir<Vr;Ir++){const on=Br[Ir];QV(Nt,Gi,Ve,on)}if(jt&&Ui.render(Ve),Ai.enabled&&Ai.isMultiview)Ar.setDeferTextureUploads(!0),TN(ne,Ve,Et,Et.cameras[0].viewport);else for(let Ir=0,Vr=Br.length;Ir<Vr;Ir++){const on=Br[Ir];TN(ne,Ve,on,on.viewport)}}else Gi.length>0&&QV(Nt,Gi,Ve,Et),jt&&Ui.render(Ve),TN(ne,Ve,Et);it!==null&&(Ar.updateMultisampleRenderTarget(it),Ar.updateRenderTargetMipmap(it)),Ve.isScene===!0&&Ve.onAfterRender(_e,Ve,Et),Ar.runDeferredUploads(),Ai.enabled&&Ai.submitFrame&&Ai.submitFrame(),bn.resetDefaultState(),ze=-1,Oe=null,we.pop(),we.length>0?(ee=we[we.length-1],Un===!0&&fi.setGlobalState(_e.clippingPlanes,ee.state.camera)):ee=null,Me.pop(),Me.length>0?ne=Me[Me.length-1]:ne=null};function WV(Ve,Et,jt,Dt){if(Ve.visible===!1)return;if(Ve.layers.test(Et.layers)){if(Ve.isGroup)jt=Ve.renderOrder;else if(Ve.isLOD)Ve.autoUpdate===!0&&Ve.update(Et);else if(Ve.isLight)ee.pushLight(Ve),Ve.castShadow&&ee.pushShadow(Ve);else if(Ve.isSprite){if(!Ve.frustumCulled||hs.intersectsSprite(Ve)){Dt&&li.setFromMatrixPosition(Ve.matrixWorld).applyMatrix4(wr);const Gi=Gn.update(Ve),Br=Ve.material;Br.visible&&ne.push(Ve,Gi,Br,jt,li.z,null)}}else if((Ve.isMesh||Ve.isLine||Ve.isPoints)&&(!Ve.frustumCulled||hs.intersectsObject(Ve))){const Gi=Gn.update(Ve),Br=Ve.material;if(Dt&&(Ve.boundingSphere!==void 0?(Ve.boundingSphere===null&&Ve.computeBoundingSphere(),li.copy(Ve.boundingSphere.center)):(Gi.boundingSphere===null&&Gi.computeBoundingSphere(),li.copy(Gi.boundingSphere.center)),li.applyMatrix4(Ve.matrixWorld).applyMatrix4(wr)),Array.isArray(Br)){const Ir=Gi.groups;for(let Vr=0,on=Ir.length;Vr<on;Vr++){const Bn=Ir[Vr],Mn=Br[Bn.materialIndex];Mn&&Mn.visible&&ne.push(Ve,Gi,Mn,jt,li.z,Bn)}}else Br.visible&&ne.push(Ve,Gi,Br,jt,li.z,null)}}const Nt=Ve.children;for(let Gi=0,Br=Nt.length;Gi<Br;Gi++)WV(Nt[Gi],Et,jt,Dt)}function TN(Ve,Et,jt,Dt){const Nt=Ve.opaque,Gi=Ve.transmissive,Br=Ve.transparent;ee.setupLightsView(jt),Un===!0&&fi.setGlobalState(_e.clippingPlanes,jt),Dt&&ai.viewport(rt.copy(Dt)),Nt.length>0&&Rw(Nt,Et,jt),Gi.length>0&&Rw(Gi,Et,jt),Br.length>0&&Rw(Br,Et,jt),ai.buffers.depth.setTest(!0),ai.buffers.depth.setMask(!0),ai.buffers.color.setMask(!0),ai.setPolygonOffset(!1)}function QV(Ve,Et,jt,Dt){if((jt.isScene===!0?jt.overrideMaterial:null)!==null)return;ee.state.transmissionRenderTarget[Dt.id]===void 0&&(ee.state.transmissionRenderTarget[Dt.id]=new Xo(1,1,{generateMipmaps:!0,type:$t.has("EXT_color_buffer_half_float")||$t.has("EXT_color_buffer_float")?Xt:mn,minFilter:tn,samples:4,stencilBuffer:E,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));const Nt=ee.state.transmissionRenderTarget[Dt.id],Gi=Dt.viewport||rt;Nt.setSize(Gi.z,Gi.w);const Br=_e.getRenderTarget();_e.setRenderTarget(Nt),_e.getClearColor(Tt),Pt=_e.getClearAlpha(),Pt<1&&_e.setClearColor(16777215,.5),_e.clear();const Ir=_e.toneMapping;_e.toneMapping=Ot;const Vr=Dt.viewport;if(Dt.viewport!==void 0&&(Dt.viewport=void 0),ee.setupLightsView(Dt),Un===!0&&fi.setGlobalState(_e.clippingPlanes,Dt),Rw(Ve,jt,Dt),Ar.updateMultisampleRenderTarget(Nt),Ar.updateRenderTargetMipmap(Nt),$t.has("WEBGL_multisampled_render_to_texture")===!1){let on=!1;for(let Bn=0,Mn=Et.length;Bn<Mn;Bn++){const Aa=Et[Bn],$o=Aa.object,zl=Aa.geometry,el=Aa.material,vs=Aa.group;if(el.side===B&&$o.layers.test(Dt.layers)){const bh=el.side;el.side=R,el.needsUpdate=!0,qV($o,jt,Dt,zl,el,vs),el.side=bh,el.needsUpdate=!0,on=!0}}on===!0&&(Ar.updateMultisampleRenderTarget(Nt),Ar.updateRenderTargetMipmap(Nt))}_e.setRenderTarget(Br),_e.setClearColor(Tt,Pt),Vr!==void 0&&(Dt.viewport=Vr),_e.toneMapping=Ir}function Rw(Ve,Et,jt){const Dt=Et.isScene===!0?Et.overrideMaterial:null;for(let Nt=0,Gi=Ve.length;Nt<Gi;Nt++){const Br=Ve[Nt],Ir=Br.object,Vr=Br.geometry,on=Dt===null?Br.material:Dt,Bn=Br.group;Ir.layers.test(jt.layers)&&qV(Ir,Et,jt,Vr,on,Bn)}}function qV(Ve,Et,jt,Dt,Nt,Gi){Ve.onBeforeRender(_e,Et,jt,Dt,Nt,Gi),Ve.modelViewMatrix.multiplyMatrices(jt.matrixWorldInverse,Ve.matrixWorld),Ve.normalMatrix.getNormalMatrix(Ve.modelViewMatrix),Nt.onBeforeRender(_e,Et,jt,Dt,Ve,Gi),Nt.transparent===!0&&Nt.side===B&&Nt.forceSinglePass===!1?(Nt.side=R,Nt.needsUpdate=!0,_e.renderBufferDirect(jt,Et,Dt,Nt,Ve,Gi),Nt.side=S,Nt.needsUpdate=!0,_e.renderBufferDirect(jt,Et,Dt,Nt,Ve,Gi),Nt.side=B):_e.renderBufferDirect(jt,Et,Dt,Nt,Ve,Gi),Ve.onAfterRender(_e,Et,jt,Dt,Nt,Gi)}function Iw(Ve,Et,jt){Et.isScene!==!0&&(Et=_i);const Dt=$i.get(Ve),Nt=ee.state.lights,Gi=ee.state.shadowsArray,Br=Nt.state.version,Ir=et.getParameters(Ve,Nt.state,Gi,Et,jt),Vr=et.getProgramCacheKey(Ir);let on=Dt.programs;Dt.environment=Ve.isMeshStandardMaterial?Et.environment:null,Dt.fog=Et.fog,Dt.envMap=(Ve.isMeshStandardMaterial?Hr:gn).get(Ve.envMap||Dt.environment),Dt.envMapRotation=Dt.environment!==null&&Ve.envMap===null?Et.environmentRotation:Ve.envMapRotation,on===void 0&&(Ve.addEventListener("dispose",an),on=new Map,Dt.programs=on);let Bn=on.get(Vr);if(Bn!==void 0){if(Dt.currentProgram===Bn&&Dt.lightsStateVersion===Br)return YV(Ve,Ir),Bn}else Ir.uniforms=et.getUniforms(Ve),Ve.onBuild(jt,Ir,_e),Ve.onBeforeCompile(Ir,_e),Bn=et.acquireProgram(Ir,Vr),on.set(Vr,Bn),Dt.uniforms=Ir.uniforms;const Mn=Dt.uniforms;return(!Ve.isShaderMaterial&&!Ve.isRawShaderMaterial||Ve.clipping===!0)&&(Mn.clippingPlanes=fi.uniform),YV(Ve,Ir),Dt.needsLights=aMe(Ve),Dt.lightsStateVersion=Br,Dt.needsLights&&(Mn.ambientLightColor.value=Nt.state.ambient,Mn.lightProbe.value=Nt.state.probe,Mn.directionalLights.value=Nt.state.directional,Mn.directionalLightShadows.value=Nt.state.directionalShadow,Mn.spotLights.value=Nt.state.spot,Mn.spotLightShadows.value=Nt.state.spotShadow,Mn.rectAreaLights.value=Nt.state.rectArea,Mn.ltc_1.value=Nt.state.rectAreaLTC1,Mn.ltc_2.value=Nt.state.rectAreaLTC2,Mn.pointLights.value=Nt.state.point,Mn.pointLightShadows.value=Nt.state.pointShadow,Mn.hemisphereLights.value=Nt.state.hemi,Mn.directionalShadowMap.value=Nt.state.directionalShadowMap,Mn.directionalShadowMatrix.value=Nt.state.directionalShadowMatrix,Mn.spotShadowMap.value=Nt.state.spotShadowMap,Mn.spotLightMatrix.value=Nt.state.spotLightMatrix,Mn.spotLightMap.value=Nt.state.spotLightMap,Mn.pointShadowMap.value=Nt.state.pointShadowMap,Mn.pointShadowMatrix.value=Nt.state.pointShadowMatrix),Dt.currentProgram=Bn,Dt.uniformsList=null,Bn}function XV(Ve){if(Ve.uniformsList===null){const Et=Ve.currentProgram.getUniforms();Ve.uniformsList=DE.seqWithValue(Et.seq,Ve.uniforms)}return Ve.uniformsList}function YV(Ve,Et){const jt=$i.get(Ve);jt.outputColorSpace=Et.outputColorSpace,jt.batching=Et.batching,jt.instancing=Et.instancing,jt.instancingColor=Et.instancingColor,jt.instancingMorph=Et.instancingMorph,jt.skinning=Et.skinning,jt.morphTargets=Et.morphTargets,jt.morphNormals=Et.morphNormals,jt.morphColors=Et.morphColors,jt.morphTargetsCount=Et.morphTargetsCount,jt.numClippingPlanes=Et.numClippingPlanes,jt.numIntersection=Et.numClipIntersection,jt.vertexAlphas=Et.vertexAlphas,jt.vertexTangents=Et.vertexTangents,jt.toneMapping=Et.toneMapping,jt.numMultiviewViews=Et.numMultiviewViews}function nMe(Ve,Et,jt,Dt,Nt){Et.isScene!==!0&&(Et=_i),Ar.resetTextureUnits();const Gi=Et.fog,Br=Dt.isMeshStandardMaterial?Et.environment:null,Ir=it===null?_e.outputColorSpace:it.isXRRenderTarget===!0?it.texture.colorSpace:Ec,Vr=(Dt.isMeshStandardMaterial?Hr:gn).get(Dt.envMap||Br),on=Dt.vertexColors===!0&&!!jt.attributes.color&&jt.attributes.color.itemSize===4,Bn=!!jt.attributes.tangent&&(!!Dt.normalMap||Dt.anisotropy>0),Mn=!!jt.morphAttributes.position,Aa=!!jt.morphAttributes.normal,$o=!!jt.morphAttributes.color;let zl=Ot;Dt.toneMapped&&(it===null||it.isXRRenderTarget===!0)&&(zl=_e.toneMapping);const el=it&&it.isWebGLMultiviewRenderTarget?it.numViews:0,vs=jt.morphAttributes.position||jt.morphAttributes.normal||jt.morphAttributes.color,bh=vs!==void 0?vs.length:0,En=$i.get(Dt),oMe=ee.state.lights;if(Un===!0&&(In===!0||Ve!==Oe)){const jl=Ve===Oe&&Dt.id===ze;fi.setState(Dt,Ve,jl)}let MN=!1;Dt.version===En.__version?(En.needsLights&&En.lightsStateVersion!==oMe.state.version||En.outputColorSpace!==Ir||Nt.isBatchedMesh&&En.batching===!1||!Nt.isBatchedMesh&&En.batching===!0||Nt.isInstancedMesh&&En.instancing===!1||!Nt.isInstancedMesh&&En.instancing===!0||Nt.isSkinnedMesh&&En.skinning===!1||!Nt.isSkinnedMesh&&En.skinning===!0||Nt.isInstancedMesh&&En.instancingColor===!0&&Nt.instanceColor===null||Nt.isInstancedMesh&&En.instancingColor===!1&&Nt.instanceColor!==null||Nt.isInstancedMesh&&En.instancingMorph===!0&&Nt.morphTexture===null||Nt.isInstancedMesh&&En.instancingMorph===!1&&Nt.morphTexture!==null||En.envMap!==Vr||Dt.fog===!0&&En.fog!==Gi||En.numClippingPlanes!==void 0&&(En.numClippingPlanes!==fi.numPlanes||En.numIntersection!==fi.numIntersection)||En.vertexAlphas!==on||En.vertexTangents!==Bn||En.morphTargets!==Mn||En.morphNormals!==Aa||En.morphColors!==$o||En.toneMapping!==zl||En.morphTargetsCount!==bh||En.numMultiviewViews!==el)&&(MN=!0):(MN=!0,En.__version=Dt.version);let _h=En.currentProgram;MN===!0&&(_h=Iw(Dt,Et,Nt));let KV=!1,Iv=!1,RN=!1;const ya=_h.getUniforms(),zd=En.uniforms;if(ai.useProgram(_h.program)&&(KV=!0,Iv=!0,RN=!0),Dt.id!==ze&&(ze=Dt.id,Iv=!0),KV||Oe!==Ve){_h.numMultiviewViews>0?(Mr.updateCameraProjectionMatricesUniform(Ve,ya),Mr.updateCameraViewMatricesUniform(Ve,ya)):(ya.setValue(tt,"projectionMatrix",Ve.projectionMatrix),ya.setValue(tt,"viewMatrix",Ve.matrixWorldInverse));const jl=ya.map.cameraPosition;jl!==void 0&&jl.setValue(tt,li.setFromMatrixPosition(Ve.matrixWorld)),Zi.logarithmicDepthBuffer&&ya.setValue(tt,"logDepthBufFC",2/(Math.log(Ve.far+1)/Math.LN2)),(Dt.isMeshPhongMaterial||Dt.isMeshToonMaterial||Dt.isMeshLambertMaterial||Dt.isMeshBasicMaterial||Dt.isMeshStandardMaterial||Dt.isShaderMaterial)&&ya.setValue(tt,"isOrthographic",Ve.isOrthographicCamera===!0),Oe!==Ve&&(Oe=Ve,Iv=!0,RN=!0)}if(Nt.isSkinnedMesh){ya.setOptional(tt,Nt,"bindMatrix"),ya.setOptional(tt,Nt,"bindMatrixInverse");const jl=Nt.skeleton;jl&&(jl.boneTexture===null&&jl.computeBoneTexture(),ya.setValue(tt,"boneTexture",jl.boneTexture,Ar))}Nt.isBatchedMesh&&(ya.setOptional(tt,Nt,"batchingTexture"),ya.setValue(tt,"batchingTexture",Nt._matricesTexture,Ar));const IN=jt.morphAttributes;if((IN.position!==void 0||IN.normal!==void 0||IN.color!==void 0)&&cr.update(Nt,jt,_h),(Iv||En.receiveShadow!==Nt.receiveShadow)&&(En.receiveShadow=Nt.receiveShadow,ya.setValue(tt,"receiveShadow",Nt.receiveShadow)),Dt.isMeshGouraudMaterial&&Dt.envMap!==null&&(zd.envMap.value=Vr,zd.flipEnvMap.value=Vr.isCubeTexture&&Vr.isRenderTargetTexture===!1?-1:1),Dt.isMeshStandardMaterial&&Dt.envMap===null&&Et.environment!==null&&(zd.envMapIntensity.value=Et.environmentIntensity),Iv&&(ya.setValue(tt,"toneMappingExposure",_e.toneMappingExposure),En.needsLights&&sMe(zd,RN),Gi&&Dt.fog===!0&&De.refreshFogUniforms(zd,Gi),De.refreshMaterialUniforms(zd,Dt,Ft,Li,ee.state.transmissionRenderTarget[Ve.id]),DE.upload(tt,XV(En),zd,Ar)),Dt.isShaderMaterial&&Dt.uniformsNeedUpdate===!0&&(DE.upload(tt,XV(En),zd,Ar),Dt.uniformsNeedUpdate=!1),Dt.isSpriteMaterial&&ya.setValue(tt,"center",Nt.center),_h.numMultiviewViews>0?Mr.updateObjectMatricesUniforms(Nt,Ve,ya):(ya.setValue(tt,"modelViewMatrix",Nt.modelViewMatrix),ya.setValue(tt,"normalMatrix",Nt.normalMatrix)),ya.setValue(tt,"modelMatrix",Nt.matrixWorld),Dt.isShaderMaterial||Dt.isRawShaderMaterial){const jl=Dt.uniformsGroups;for(let BN=0,lMe=jl.length;BN<lMe;BN++){const JV=jl[BN];Ur.update(JV,_h),Ur.bind(JV,_h)}}return _h}function sMe(Ve,Et){Ve.ambientLightColor.needsUpdate=Et,Ve.lightProbe.needsUpdate=Et,Ve.directionalLights.needsUpdate=Et,Ve.directionalLightShadows.needsUpdate=Et,Ve.pointLights.needsUpdate=Et,Ve.pointLightShadows.needsUpdate=Et,Ve.spotLights.needsUpdate=Et,Ve.spotLightShadows.needsUpdate=Et,Ve.rectAreaLights.needsUpdate=Et,Ve.hemisphereLights.needsUpdate=Et}function aMe(Ve){return Ve.isMeshLambertMaterial||Ve.isMeshToonMaterial||Ve.isMeshPhongMaterial||Ve.isMeshStandardMaterial||Ve.isShadowMaterial||Ve.isShaderMaterial&&Ve.lights===!0}this.setTexture2D=function(){var Ve=!1;return function(Et,jt){Et&&Et.isWebGLRenderTarget&&(Ve||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),Ve=!0),Et=Et.texture),Ar.setTexture2D(Et,jt)}}(),this.getActiveCubeFace=function(){return qe},this.getActiveMipmapLevel=function(){return Je},this.getRenderTarget=function(){return it},this.setRenderTargetTextures=function(Ve,Et,jt){$i.get(Ve.texture).__webglTexture=Et,$i.get(Ve.depthTexture).__webglTexture=jt;const Dt=$i.get(Ve);Dt.__hasExternalTextures=!0,Dt.__autoAllocateDepthBuffer=jt===void 0,!Dt.__autoAllocateDepthBuffer&&(!it||!it.isWebGLMultiviewRenderTarget)&&$t.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Dt.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Ve,Et){const jt=$i.get(Ve);jt.__webglFramebuffer=Et,jt.__useDefaultFramebuffer=Et===void 0},this.setRenderTarget=function(Ve,Et=0,jt=0){it=Ve,qe=Et,Je=jt;let Dt=!0,Nt=null,Gi=!1,Br=!1;if(Ve){const Ir=$i.get(Ve);Ir.__useDefaultFramebuffer!==void 0?(ai.bindFramebuffer(tt.FRAMEBUFFER,null),Dt=!1):Ir.__webglFramebuffer===void 0?Ar.setupRenderTarget(Ve):Ir.__hasExternalTextures&&Ar.rebindTextures(Ve,$i.get(Ve.texture).__webglTexture,$i.get(Ve.depthTexture).__webglTexture);const Vr=Ve.texture;(Vr.isData3DTexture||Vr.isDataArrayTexture||Vr.isCompressedArrayTexture)&&(Br=!0);const on=$i.get(Ve).__webglFramebuffer;Ve.isWebGLCubeRenderTarget?(Array.isArray(on[Et])?Nt=on[Et][jt]:Nt=on[Et],Gi=!0):Ve.samples>0&&Ar.useMultisampledRTT(Ve)===!1?Nt=$i.get(Ve).__webglMultisampledFramebuffer:Array.isArray(on)?Nt=on[jt]:Nt=on,rt.copy(Ve.viewport),mt.copy(Ve.scissor),pt=Ve.scissorTest}else rt.copy(kr).multiplyScalar(Ft).floor(),mt.copy(xn).multiplyScalar(Ft).floor(),pt=es;if(ai.bindFramebuffer(tt.FRAMEBUFFER,Nt)&&Dt&&ai.drawBuffers(Ve,Nt),ai.viewport(rt),ai.scissor(mt),ai.setScissorTest(pt),Gi){const Ir=$i.get(Ve.texture);tt.framebufferTexture2D(tt.FRAMEBUFFER,tt.COLOR_ATTACHMENT0,tt.TEXTURE_CUBE_MAP_POSITIVE_X+Et,Ir.__webglTexture,jt)}else if(Br){const Ir=$i.get(Ve.texture),Vr=Et||0;tt.framebufferTextureLayer(tt.FRAMEBUFFER,tt.COLOR_ATTACHMENT0,Ir.__webglTexture,jt||0,Vr)}ze=-1},this.readRenderTargetPixels=function(Ve,Et,jt,Dt,Nt,Gi,Br){if(!(Ve&&Ve.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ir=$i.get(Ve).__webglFramebuffer;if(Ve.isWebGLCubeRenderTarget&&Br!==void 0&&(Ir=Ir[Br]),Ir){ai.bindFramebuffer(tt.FRAMEBUFFER,Ir);try{const Vr=Ve.texture,on=Vr.format,Bn=Vr.type;if(!Zi.textureFormatReadable(on)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Zi.textureTypeReadable(Bn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Et>=0&&Et<=Ve.width-Dt&&jt>=0&&jt<=Ve.height-Nt&&tt.readPixels(Et,jt,Dt,Nt,_r.convert(on),_r.convert(Bn),Gi)}finally{const Vr=it!==null?$i.get(it).__webglFramebuffer:null;ai.bindFramebuffer(tt.FRAMEBUFFER,Vr)}}},this.copyFramebufferToTexture=function(Ve,Et,jt=0){const Dt=Math.pow(2,-jt),Nt=Math.floor(Et.image.width*Dt),Gi=Math.floor(Et.image.height*Dt);Ar.setTexture2D(Et,0),tt.copyTexSubImage2D(tt.TEXTURE_2D,jt,0,0,Ve.x,Ve.y,Nt,Gi),ai.unbindTexture()},this.copyTextureToTexture=function(Ve,Et,jt,Dt=0){const Nt=Et.image.width,Gi=Et.image.height,Br=_r.convert(jt.format),Ir=_r.convert(jt.type);Ar.setTexture2D(jt,0),tt.pixelStorei(tt.UNPACK_FLIP_Y_WEBGL,jt.flipY),tt.pixelStorei(tt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,jt.premultiplyAlpha),tt.pixelStorei(tt.UNPACK_ALIGNMENT,jt.unpackAlignment),Et.isDataTexture?tt.texSubImage2D(tt.TEXTURE_2D,Dt,Ve.x,Ve.y,Nt,Gi,Br,Ir,Et.image.data):Et.isCompressedTexture?tt.compressedTexSubImage2D(tt.TEXTURE_2D,Dt,Ve.x,Ve.y,Et.mipmaps[0].width,Et.mipmaps[0].height,Br,Et.mipmaps[0].data):tt.texSubImage2D(tt.TEXTURE_2D,Dt,Ve.x,Ve.y,Br,Ir,Et.image),Dt===0&&jt.generateMipmaps&&tt.generateMipmap(tt.TEXTURE_2D),ai.unbindTexture()},this.copyTextureToTexture3D=function(Ve,Et,jt,Dt,Nt=0){const Gi=Ve.max.x-Ve.min.x,Br=Ve.max.y-Ve.min.y,Ir=Ve.max.z-Ve.min.z,Vr=_r.convert(Dt.format),on=_r.convert(Dt.type);let Bn;if(Dt.isData3DTexture)Ar.setTexture3D(Dt,0),Bn=tt.TEXTURE_3D;else if(Dt.isDataArrayTexture||Dt.isCompressedArrayTexture)Ar.setTexture2DArray(Dt,0),Bn=tt.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}tt.pixelStorei(tt.UNPACK_FLIP_Y_WEBGL,Dt.flipY),tt.pixelStorei(tt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Dt.premultiplyAlpha),tt.pixelStorei(tt.UNPACK_ALIGNMENT,Dt.unpackAlignment);const Mn=tt.getParameter(tt.UNPACK_ROW_LENGTH),Aa=tt.getParameter(tt.UNPACK_IMAGE_HEIGHT),$o=tt.getParameter(tt.UNPACK_SKIP_PIXELS),zl=tt.getParameter(tt.UNPACK_SKIP_ROWS),el=tt.getParameter(tt.UNPACK_SKIP_IMAGES),vs=jt.isCompressedTexture?jt.mipmaps[Nt]:jt.image;tt.pixelStorei(tt.UNPACK_ROW_LENGTH,vs.width),tt.pixelStorei(tt.UNPACK_IMAGE_HEIGHT,vs.height),tt.pixelStorei(tt.UNPACK_SKIP_PIXELS,Ve.min.x),tt.pixelStorei(tt.UNPACK_SKIP_ROWS,Ve.min.y),tt.pixelStorei(tt.UNPACK_SKIP_IMAGES,Ve.min.z),jt.isDataTexture||jt.isData3DTexture?tt.texSubImage3D(Bn,Nt,Et.x,Et.y,Et.z,Gi,Br,Ir,Vr,on,vs.data):Dt.isCompressedArrayTexture?tt.compressedTexSubImage3D(Bn,Nt,Et.x,Et.y,Et.z,Gi,Br,Ir,Vr,vs.data):tt.texSubImage3D(Bn,Nt,Et.x,Et.y,Et.z,Gi,Br,Ir,Vr,on,vs),tt.pixelStorei(tt.UNPACK_ROW_LENGTH,Mn),tt.pixelStorei(tt.UNPACK_IMAGE_HEIGHT,Aa),tt.pixelStorei(tt.UNPACK_SKIP_PIXELS,$o),tt.pixelStorei(tt.UNPACK_SKIP_ROWS,zl),tt.pixelStorei(tt.UNPACK_SKIP_IMAGES,el),Nt===0&&Dt.generateMipmaps&&tt.generateMipmap(Bn),ai.unbindTexture()},this.initTexture=function(Ve){Ve.isCubeTexture?Ar.setTextureCube(Ve,0):Ve.isData3DTexture?Ar.setTexture3D(Ve,0):Ve.isDataArrayTexture||Ve.isCompressedArrayTexture?Ar.setTexture2DArray(Ve,0):Ar.setTexture2D(Ve,0),ai.unbindTexture()},this.resetState=function(){qe=0,Je=0,it=null,ai.reset(),bn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Pl}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(a){this._outputColorSpace=a;const h=this.getContext();h.drawingBufferColorSpace=a===jg?"display-p3":"srgb",h.unpackColorSpace=Xn.workingColorSpace===Kp?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(a){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=a}}class OE{constructor(a,h=25e-5){this.isFogExp2=!0,this.name="",this.color=new or(a),this.density=h}clone(){return new OE(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class PE{constructor(a,h=1,A=1e3){this.isFog=!0,this.name="",this.color=new or(a),this.near=h,this.far=A}clone(){return new PE(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class nj extends Vn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new xl,this.environmentIntensity=1,this.environmentRotation=new xl,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(a,h){return super.copy(a,h),a.background!==null&&(this.background=a.background.clone()),a.environment!==null&&(this.environment=a.environment.clone()),a.fog!==null&&(this.fog=a.fog.clone()),this.backgroundBlurriness=a.backgroundBlurriness,this.backgroundIntensity=a.backgroundIntensity,this.backgroundRotation.copy(a.backgroundRotation),this.environmentIntensity=a.environmentIntensity,this.environmentRotation.copy(a.environmentRotation),a.overrideMaterial!==null&&(this.overrideMaterial=a.overrideMaterial.clone()),this.matrixAutoUpdate=a.matrixAutoUpdate,this}toJSON(a){const h=super.toJSON(a);return this.fog!==null&&(h.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(h.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(h.object.backgroundIntensity=this.backgroundIntensity),h.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(h.object.environmentIntensity=this.environmentIntensity),h.object.environmentRotation=this.environmentRotation.toArray(),h}}class FE{constructor(a,h){this.isInterleavedBuffer=!0,this.array=a,this.stride=h,this.count=a!==void 0?a.length/h:0,this.usage=ef,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=wo()}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}get updateRange(){return uE("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(a){return this.usage=a,this}addUpdateRange(a,h){this.updateRanges.push({start:a,count:h})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.array=new a.array.constructor(a.array),this.count=a.count,this.stride=a.stride,this.usage=a.usage,this}copyAt(a,h,A){a*=this.stride,A*=h.stride;for(let b=0,E=this.stride;b<E;b++)this.array[a+b]=h.array[A+b];return this}set(a,h=0){return this.array.set(a,h),this}clone(a){a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=wo()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const h=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]),A=new this.constructor(h,this.stride);return A.setUsage(this.usage),A}onUpload(a){return this.onUploadCallback=a,this}toJSON(a){return a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=wo()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const To=new He;class pf{constructor(a,h,A,b=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=a,this.itemSize=h,this.offset=A,this.normalized=b}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(a){this.data.needsUpdate=a}applyMatrix4(a){for(let h=0,A=this.data.count;h<A;h++)To.fromBufferAttribute(this,h),To.applyMatrix4(a),this.setXYZ(h,To.x,To.y,To.z);return this}applyNormalMatrix(a){for(let h=0,A=this.count;h<A;h++)To.fromBufferAttribute(this,h),To.applyNormalMatrix(a),this.setXYZ(h,To.x,To.y,To.z);return this}transformDirection(a){for(let h=0,A=this.count;h<A;h++)To.fromBufferAttribute(this,h),To.transformDirection(a),this.setXYZ(h,To.x,To.y,To.z);return this}getComponent(a,h){let A=this.array[a*this.data.stride+this.offset+h];return this.normalized&&(A=Va(A,this.array)),A}setComponent(a,h,A){return this.normalized&&(A=Yr(A,this.array)),this.data.array[a*this.data.stride+this.offset+h]=A,this}setX(a,h){return this.normalized&&(h=Yr(h,this.array)),this.data.array[a*this.data.stride+this.offset]=h,this}setY(a,h){return this.normalized&&(h=Yr(h,this.array)),this.data.array[a*this.data.stride+this.offset+1]=h,this}setZ(a,h){return this.normalized&&(h=Yr(h,this.array)),this.data.array[a*this.data.stride+this.offset+2]=h,this}setW(a,h){return this.normalized&&(h=Yr(h,this.array)),this.data.array[a*this.data.stride+this.offset+3]=h,this}getX(a){let h=this.data.array[a*this.data.stride+this.offset];return this.normalized&&(h=Va(h,this.array)),h}getY(a){let h=this.data.array[a*this.data.stride+this.offset+1];return this.normalized&&(h=Va(h,this.array)),h}getZ(a){let h=this.data.array[a*this.data.stride+this.offset+2];return this.normalized&&(h=Va(h,this.array)),h}getW(a){let h=this.data.array[a*this.data.stride+this.offset+3];return this.normalized&&(h=Va(h,this.array)),h}setXY(a,h,A){return a=a*this.data.stride+this.offset,this.normalized&&(h=Yr(h,this.array),A=Yr(A,this.array)),this.data.array[a+0]=h,this.data.array[a+1]=A,this}setXYZ(a,h,A,b){return a=a*this.data.stride+this.offset,this.normalized&&(h=Yr(h,this.array),A=Yr(A,this.array),b=Yr(b,this.array)),this.data.array[a+0]=h,this.data.array[a+1]=A,this.data.array[a+2]=b,this}setXYZW(a,h,A,b,E){return a=a*this.data.stride+this.offset,this.normalized&&(h=Yr(h,this.array),A=Yr(A,this.array),b=Yr(b,this.array),E=Yr(E,this.array)),this.data.array[a+0]=h,this.data.array[a+1]=A,this.data.array[a+2]=b,this.data.array[a+3]=E,this}clone(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const h=[];for(let A=0;A<this.count;A++){const b=A*this.data.stride+this.offset;for(let E=0;E<this.itemSize;E++)h.push(this.data.array[b+E])}return new ns(new this.array.constructor(h),this.itemSize,this.normalized)}else return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.clone(a)),new pf(a.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const h=[];for(let A=0;A<this.count;A++){const b=A*this.data.stride+this.offset;for(let E=0;E<this.itemSize;E++)h.push(this.data.array[b+E])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:h,normalized:this.normalized}}else return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class VB extends so{constructor(a){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new or(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.rotation=a.rotation,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}let h0;const lv=new He,d0=new He,p0=new He,f0=new ni,cv=new ni,sj=new fr,kE=new He,uv=new He,UE=new He,aj=new ni,GB=new ni,oj=new ni;class lj extends Vn{constructor(a=new VB){if(super(),this.isSprite=!0,this.type="Sprite",h0===void 0){h0=new hn;const h=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),A=new FE(h,5);h0.setIndex([0,1,2,0,2,3]),h0.setAttribute("position",new pf(A,3,0,!1)),h0.setAttribute("uv",new pf(A,2,3,!1))}this.geometry=h0,this.material=a,this.center=new ni(.5,.5)}raycast(a,h){a.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),d0.setFromMatrixScale(this.matrixWorld),sj.copy(a.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(a.camera.matrixWorldInverse,this.matrixWorld),p0.setFromMatrixPosition(this.modelViewMatrix),a.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&d0.multiplyScalar(-p0.z);const A=this.material.rotation;let b,E;A!==0&&(E=Math.cos(A),b=Math.sin(A));const M=this.center;zE(kE.set(-.5,-.5,0),p0,M,d0,b,E),zE(uv.set(.5,-.5,0),p0,M,d0,b,E),zE(UE.set(.5,.5,0),p0,M,d0,b,E),aj.set(0,0),GB.set(1,0),oj.set(1,1);let N=a.ray.intersectTriangle(kE,uv,UE,!1,lv);if(N===null&&(zE(uv.set(-.5,.5,0),p0,M,d0,b,E),GB.set(0,1),N=a.ray.intersectTriangle(kE,UE,uv,!1,lv),N===null))return;const P=a.ray.origin.distanceTo(lv);P<a.near||P>a.far||h.push({distance:P,point:lv.clone(),uv:bl.getInterpolation(lv,kE,uv,UE,aj,GB,oj,new ni),face:null,object:this})}copy(a,h){return super.copy(a,h),a.center!==void 0&&this.center.copy(a.center),this.material=a.material,this}}function zE(C,a,h,A,b,E){f0.subVectors(C,h).addScalar(.5).multiply(A),b!==void 0?(cv.x=E*f0.x-b*f0.y,cv.y=b*f0.x+E*f0.y):cv.copy(f0),C.copy(a),C.x+=cv.x,C.y+=cv.y,C.applyMatrix4(sj)}const jE=new He,cj=new He;class uj extends Vn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(a){super.copy(a,!1);const h=a.levels;for(let A=0,b=h.length;A<b;A++){const E=h[A];this.addLevel(E.object.clone(),E.distance,E.hysteresis)}return this.autoUpdate=a.autoUpdate,this}addLevel(a,h=0,A=0){h=Math.abs(h);const b=this.levels;let E;for(E=0;E<b.length&&!(h<b[E].distance);E++);return b.splice(E,0,{distance:h,hysteresis:A,object:a}),this.add(a),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(a){const h=this.levels;if(h.length>0){let A,b;for(A=1,b=h.length;A<b;A++){let E=h[A].distance;if(h[A].object.visible&&(E-=E*h[A].hysteresis),a<E)break}return h[A-1].object}return null}raycast(a,h){if(this.levels.length>0){jE.setFromMatrixPosition(this.matrixWorld);const A=a.ray.origin.distanceTo(jE);this.getObjectForDistance(A).raycast(a,h)}}update(a){const h=this.levels;if(h.length>1){jE.setFromMatrixPosition(a.matrixWorld),cj.setFromMatrixPosition(this.matrixWorld);const A=jE.distanceTo(cj)/a.zoom;h[0].object.visible=!0;let b,E;for(b=1,E=h.length;b<E;b++){let M=h[b].distance;if(h[b].object.visible&&(M-=M*h[b].hysteresis),A>=M)h[b-1].object.visible=!1,h[b].object.visible=!0;else break}for(this._currentLevel=b-1;b<E;b++)h[b].object.visible=!1}}toJSON(a){const h=super.toJSON(a);this.autoUpdate===!1&&(h.object.autoUpdate=!1),h.object.levels=[];const A=this.levels;for(let b=0,E=A.length;b<E;b++){const M=A[b];h.object.levels.push({object:M.object.uuid,distance:M.distance,hysteresis:M.hysteresis})}return h}}const hj=new He,dj=new Fn,pj=new Fn,hSe=new He,fj=new fr,VE=new He,HB=new da,mj=new fr,WB=new pa;class gj extends sa{constructor(a,h){super(a,h),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Te,this.bindMatrix=new fr,this.bindMatrixInverse=new fr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const a=this.geometry;this.boundingBox===null&&(this.boundingBox=new Is),this.boundingBox.makeEmpty();const h=a.getAttribute("position");for(let A=0;A<h.count;A++)this.getVertexPosition(A,VE),this.boundingBox.expandByPoint(VE)}computeBoundingSphere(){const a=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new da),this.boundingSphere.makeEmpty();const h=a.getAttribute("position");for(let A=0;A<h.count;A++)this.getVertexPosition(A,VE),this.boundingSphere.expandByPoint(VE)}copy(a,h){return super.copy(a,h),this.bindMode=a.bindMode,this.bindMatrix.copy(a.bindMatrix),this.bindMatrixInverse.copy(a.bindMatrixInverse),this.skeleton=a.skeleton,a.boundingBox!==null&&(this.boundingBox=a.boundingBox.clone()),a.boundingSphere!==null&&(this.boundingSphere=a.boundingSphere.clone()),this}raycast(a,h){const A=this.material,b=this.matrixWorld;A!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),HB.copy(this.boundingSphere),HB.applyMatrix4(b),a.ray.intersectsSphere(HB)!==!1&&(mj.copy(b).invert(),WB.copy(a.ray).applyMatrix4(mj),!(this.boundingBox!==null&&WB.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(a,h,WB)))}getVertexPosition(a,h){return super.getVertexPosition(a,h),this.applyBoneTransform(a,h),h}bind(a,h){this.skeleton=a,h===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),h=this.matrixWorld),this.bindMatrix.copy(h),this.bindMatrixInverse.copy(h).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const a=new Fn,h=this.geometry.attributes.skinWeight;for(let A=0,b=h.count;A<b;A++){a.fromBufferAttribute(h,A);const E=1/a.manhattanLength();E!==1/0?a.multiplyScalar(E):a.set(1,0,0,0),h.setXYZW(A,a.x,a.y,a.z,a.w)}}updateMatrixWorld(a){super.updateMatrixWorld(a),this.bindMode===Te?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Fe?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(a,h){const A=this.skeleton,b=this.geometry;dj.fromBufferAttribute(b.attributes.skinIndex,a),pj.fromBufferAttribute(b.attributes.skinWeight,a),hj.copy(h).applyMatrix4(this.bindMatrix),h.set(0,0,0);for(let E=0;E<4;E++){const M=pj.getComponent(E);if(M!==0){const N=dj.getComponent(E);fj.multiplyMatrices(A.bones[N].matrixWorld,A.boneInverses[N]),h.addScaledVector(hSe.copy(hj).applyMatrix4(fj),M)}}return h.applyMatrix4(this.bindMatrixInverse)}}class QB extends Vn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Dd extends us{constructor(a=null,h=1,A=1,b,E,M,N,P,F=Bt,z=Bt,X,q){super(null,M,N,P,F,z,b,E,X,q),this.isDataTexture=!0,this.image={data:a,width:h,height:A},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Aj=new fr,dSe=new fr;class GE{constructor(a=[],h=[]){this.uuid=wo(),this.bones=a.slice(0),this.boneInverses=h,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const a=this.bones,h=this.boneInverses;if(this.boneMatrices=new Float32Array(a.length*16),h.length===0)this.calculateInverses();else if(a.length!==h.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let A=0,b=this.bones.length;A<b;A++)this.boneInverses.push(new fr)}}calculateInverses(){this.boneInverses.length=0;for(let a=0,h=this.bones.length;a<h;a++){const A=new fr;this.bones[a]&&A.copy(this.bones[a].matrixWorld).invert(),this.boneInverses.push(A)}}pose(){for(let a=0,h=this.bones.length;a<h;a++){const A=this.bones[a];A&&A.matrixWorld.copy(this.boneInverses[a]).invert()}for(let a=0,h=this.bones.length;a<h;a++){const A=this.bones[a];A&&(A.parent&&A.parent.isBone?(A.matrix.copy(A.parent.matrixWorld).invert(),A.matrix.multiply(A.matrixWorld)):A.matrix.copy(A.matrixWorld),A.matrix.decompose(A.position,A.quaternion,A.scale))}}update(){const a=this.bones,h=this.boneInverses,A=this.boneMatrices,b=this.boneTexture;for(let E=0,M=a.length;E<M;E++){const N=a[E]?a[E].matrixWorld:dSe;Aj.multiplyMatrices(N,h[E]),Aj.toArray(A,E*16)}b!==null&&(b.needsUpdate=!0)}clone(){return new GE(this.bones,this.boneInverses)}computeBoneTexture(){let a=Math.sqrt(this.bones.length*4);a=Math.ceil(a/4)*4,a=Math.max(a,4);const h=new Float32Array(a*a*4);h.set(this.boneMatrices);const A=new Dd(h,a,a,ge,St);return A.needsUpdate=!0,this.boneMatrices=h,this.boneTexture=A,this}getBoneByName(a){for(let h=0,A=this.bones.length;h<A;h++){const b=this.bones[h];if(b.name===a)return b}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(a,h){this.uuid=a.uuid;for(let A=0,b=a.bones.length;A<b;A++){const E=a.bones[A];let M=h[E];M===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",E),M=new QB),this.bones.push(M),this.boneInverses.push(new fr().fromArray(a.boneInverses[A]))}return this.init(),this}toJSON(){const a={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};a.uuid=this.uuid;const h=this.bones,A=this.boneInverses;for(let b=0,E=h.length;b<E;b++){const M=h[b];a.bones.push(M.uuid);const N=A[b];a.boneInverses.push(N.toArray())}return a}}class m0 extends ns{constructor(a,h,A,b=1){super(a,h,A),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=b}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}toJSON(){const a=super.toJSON();return a.meshPerAttribute=this.meshPerAttribute,a.isInstancedBufferAttribute=!0,a}}const g0=new fr,yj=new fr,HE=[],vj=new Is,pSe=new fr,hv=new sa,dv=new da;class xj extends sa{constructor(a,h,A){super(a,h),this.isInstancedMesh=!0,this.instanceMatrix=new m0(new Float32Array(A*16),16),this.instanceColor=null,this.morphTexture=null,this.count=A,this.boundingBox=null,this.boundingSphere=null;for(let b=0;b<A;b++)this.setMatrixAt(b,pSe)}computeBoundingBox(){const a=this.geometry,h=this.count;this.boundingBox===null&&(this.boundingBox=new Is),a.boundingBox===null&&a.computeBoundingBox(),this.boundingBox.makeEmpty();for(let A=0;A<h;A++)this.getMatrixAt(A,g0),vj.copy(a.boundingBox).applyMatrix4(g0),this.boundingBox.union(vj)}computeBoundingSphere(){const a=this.geometry,h=this.count;this.boundingSphere===null&&(this.boundingSphere=new da),a.boundingSphere===null&&a.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let A=0;A<h;A++)this.getMatrixAt(A,g0),dv.copy(a.boundingSphere).applyMatrix4(g0),this.boundingSphere.union(dv)}copy(a,h){return super.copy(a,h),this.instanceMatrix.copy(a.instanceMatrix),a.morphTexture!==null&&(this.morphTexture=a.morphTexture.clone()),a.instanceColor!==null&&(this.instanceColor=a.instanceColor.clone()),this.count=a.count,a.boundingBox!==null&&(this.boundingBox=a.boundingBox.clone()),a.boundingSphere!==null&&(this.boundingSphere=a.boundingSphere.clone()),this}getColorAt(a,h){h.fromArray(this.instanceColor.array,a*3)}getMatrixAt(a,h){h.fromArray(this.instanceMatrix.array,a*16)}getMorphAt(a,h){const A=h.morphTargetInfluences,b=this.morphTexture.source.data.data,E=A.length+1,M=a*E+1;for(let N=0;N<A.length;N++)A[N]=b[M+N]}raycast(a,h){const A=this.matrixWorld,b=this.count;if(hv.geometry=this.geometry,hv.material=this.material,hv.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),dv.copy(this.boundingSphere),dv.applyMatrix4(A),a.ray.intersectsSphere(dv)!==!1))for(let E=0;E<b;E++){this.getMatrixAt(E,g0),yj.multiplyMatrices(A,g0),hv.matrixWorld=yj,hv.raycast(a,HE);for(let M=0,N=HE.length;M<N;M++){const P=HE[M];P.instanceId=E,P.object=this,h.push(P)}HE.length=0}}setColorAt(a,h){this.instanceColor===null&&(this.instanceColor=new m0(new Float32Array(this.instanceMatrix.count*3),3)),h.toArray(this.instanceColor.array,a*3)}setMatrixAt(a,h){h.toArray(this.instanceMatrix.array,a*16)}setMorphAt(a,h){const A=h.morphTargetInfluences,b=A.length+1;this.morphTexture===null&&(this.morphTexture=new Dd(new Float32Array(b*this.count),b,this.count,wt,St));const E=this.morphTexture.source.data.data;let M=0;for(let F=0;F<A.length;F++)M+=A[F];const N=this.geometry.morphTargetsRelative?1:1-M,P=b*a;E[P]=N,E.set(A,P+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function fSe(C,a){return C.z-a.z}function mSe(C,a){return a.z-C.z}class gSe{constructor(){this.index=0,this.pool=[],this.list=[]}push(a,h){const A=this.pool,b=this.list;this.index>=A.length&&A.push({start:-1,count:-1,z:-1});const E=A[this.index];b.push(E),this.index++,E.start=a.start,E.count=a.count,E.z=h}reset(){this.list.length=0,this.index=0}}const A0="batchId",Od=new fr,bj=new fr,ASe=new fr,_j=new fr,qB=new av,WE=new Is,ff=new da,pv=new He,XB=new gSe,ao=new sa,QE=[];function ySe(C,a,h=0){const A=a.itemSize;if(C.isInterleavedBufferAttribute||C.array.constructor!==a.array.constructor){const b=C.count;for(let E=0;E<b;E++)for(let M=0;M<A;M++)a.setComponent(E+h,M,C.getComponent(E,M))}else a.array.set(C.array,h*A);a.needsUpdate=!0}class Ej extends sa{get maxGeometryCount(){return this._maxGeometryCount}constructor(a,h,A=h*2,b){super(new hn,b),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=a,this._maxVertexCount=h,this._maxIndexCount=A,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(a),this._multiDrawStarts=new Int32Array(a),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let a=Math.sqrt(this._maxGeometryCount*4);a=Math.ceil(a/4)*4,a=Math.max(a,4);const h=new Float32Array(a*a*4),A=new Dd(h,a,a,ge,St);this._matricesTexture=A}_initializeGeometry(a){const h=this.geometry,A=this._maxVertexCount,b=this._maxGeometryCount,E=this._maxIndexCount;if(this._geometryInitialized===!1){for(const N in a.attributes){const P=a.getAttribute(N),{array:F,itemSize:z,normalized:X}=P,q=new F.constructor(A*z),K=new ns(q,z,X);h.setAttribute(N,K)}if(a.getIndex()!==null){const N=A>65536?new Uint32Array(E):new Uint16Array(E);h.setIndex(new ns(N,1))}const M=b>65536?new Uint32Array(A):new Uint16Array(A);h.setAttribute(A0,new ns(M,1)),this._geometryInitialized=!0}}_validateGeometry(a){if(a.getAttribute(A0))throw new Error(`BatchedMesh: Geometry cannot use attribute "${A0}"`);const h=this.geometry;if(!!a.getIndex()!=!!h.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const A in h.attributes){if(A===A0)continue;if(!a.hasAttribute(A))throw new Error(`BatchedMesh: Added geometry missing "${A}". All geometries must have consistent attributes.`);const b=a.getAttribute(A),E=h.getAttribute(A);if(b.itemSize!==E.itemSize||b.normalized!==E.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(a){return this.customSort=a,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Is);const a=this._geometryCount,h=this.boundingBox,A=this._active;h.makeEmpty();for(let b=0;b<a;b++)A[b]!==!1&&(this.getMatrixAt(b,Od),this.getBoundingBoxAt(b,WE).applyMatrix4(Od),h.union(WE))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new da);const a=this._geometryCount,h=this.boundingSphere,A=this._active;h.makeEmpty();for(let b=0;b<a;b++)A[b]!==!1&&(this.getMatrixAt(b,Od),this.getBoundingSphereAt(b,ff).applyMatrix4(Od),h.union(ff))}addGeometry(a,h=-1,A=-1){if(this._initializeGeometry(a),this._validateGeometry(a),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const b={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let E=null;const M=this._reservedRanges,N=this._drawRanges,P=this._bounds;this._geometryCount!==0&&(E=M[M.length-1]),h===-1?b.vertexCount=a.getAttribute("position").count:b.vertexCount=h,E===null?b.vertexStart=0:b.vertexStart=E.vertexStart+E.vertexCount;const F=a.getIndex(),z=F!==null;if(z&&(A===-1?b.indexCount=F.count:b.indexCount=A,E===null?b.indexStart=0:b.indexStart=E.indexStart+E.indexCount),b.indexStart!==-1&&b.indexStart+b.indexCount>this._maxIndexCount||b.vertexStart+b.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const X=this._visibility,q=this._active,K=this._matricesTexture,te=this._matricesTexture.image.data;X.push(!0),q.push(!0);const oe=this._geometryCount;this._geometryCount++,ASe.toArray(te,oe*16),K.needsUpdate=!0,M.push(b),N.push({start:z?b.indexStart:b.vertexStart,count:-1}),P.push({boxInitialized:!1,box:new Is,sphereInitialized:!1,sphere:new da});const ne=this.geometry.getAttribute(A0);for(let ee=0;ee<b.vertexCount;ee++)ne.setX(b.vertexStart+ee,oe);return ne.needsUpdate=!0,this.setGeometryAt(oe,a),oe}setGeometryAt(a,h){if(a>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(h);const A=this.geometry,b=A.getIndex()!==null,E=A.getIndex(),M=h.getIndex(),N=this._reservedRanges[a];if(b&&M.count>N.indexCount||h.attributes.position.count>N.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const P=N.vertexStart,F=N.vertexCount;for(const K in A.attributes){if(K===A0)continue;const te=h.getAttribute(K),oe=A.getAttribute(K);ySe(te,oe,P);const ne=te.itemSize;for(let ee=te.count,Me=F;ee<Me;ee++){const we=P+ee;for(let _e=0;_e<ne;_e++)oe.setComponent(we,_e,0)}oe.needsUpdate=!0,oe.addUpdateRange(P*ne,F*ne)}if(b){const K=N.indexStart;for(let te=0;te<M.count;te++)E.setX(K+te,P+M.getX(te));for(let te=M.count,oe=N.indexCount;te<oe;te++)E.setX(K+te,P);E.needsUpdate=!0,E.addUpdateRange(K,N.indexCount)}const z=this._bounds[a];h.boundingBox!==null?(z.box.copy(h.boundingBox),z.boxInitialized=!0):z.boxInitialized=!1,h.boundingSphere!==null?(z.sphere.copy(h.boundingSphere),z.sphereInitialized=!0):z.sphereInitialized=!1;const X=this._drawRanges[a],q=h.getAttribute("position");return X.count=b?M.count:q.count,this._visibilityChanged=!0,a}deleteGeometry(a){const h=this._active;return a>=h.length||h[a]===!1?this:(h[a]=!1,this._visibilityChanged=!0,this)}getInstanceCountAt(a){return this._multiDrawInstances===null?null:this._multiDrawInstances[a]}setInstanceCountAt(a,h){return this._multiDrawInstances===null&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[a]=h,a}getBoundingBoxAt(a,h){if(this._active[a]===!1)return null;const A=this._bounds[a],b=A.box,E=this.geometry;if(A.boxInitialized===!1){b.makeEmpty();const M=E.index,N=E.attributes.position,P=this._drawRanges[a];for(let F=P.start,z=P.start+P.count;F<z;F++){let X=F;M&&(X=M.getX(X)),b.expandByPoint(pv.fromBufferAttribute(N,X))}A.boxInitialized=!0}return h.copy(b),h}getBoundingSphereAt(a,h){if(this._active[a]===!1)return null;const A=this._bounds[a],b=A.sphere,E=this.geometry;if(A.sphereInitialized===!1){b.makeEmpty(),this.getBoundingBoxAt(a,WE),WE.getCenter(b.center);const M=E.index,N=E.attributes.position,P=this._drawRanges[a];let F=0;for(let z=P.start,X=P.start+P.count;z<X;z++){let q=z;M&&(q=M.getX(q)),pv.fromBufferAttribute(N,q),F=Math.max(F,b.center.distanceToSquared(pv))}b.radius=Math.sqrt(F),A.sphereInitialized=!0}return h.copy(b),h}setMatrixAt(a,h){const A=this._active,b=this._matricesTexture,E=this._matricesTexture.image.data,M=this._geometryCount;return a>=M||A[a]===!1?this:(h.toArray(E,a*16),b.needsUpdate=!0,this)}getMatrixAt(a,h){const A=this._active,b=this._matricesTexture.image.data,E=this._geometryCount;return a>=E||A[a]===!1?null:h.fromArray(b,a*16)}setVisibleAt(a,h){const A=this._visibility,b=this._active,E=this._geometryCount;return a>=E||b[a]===!1||A[a]===h?this:(A[a]=h,this._visibilityChanged=!0,this)}getVisibleAt(a){const h=this._visibility,A=this._active,b=this._geometryCount;return a>=b||A[a]===!1?!1:h[a]}raycast(a,h){const A=this._visibility,b=this._active,E=this._drawRanges,M=this._geometryCount,N=this.matrixWorld,P=this.geometry;ao.material=this.material,ao.geometry.index=P.index,ao.geometry.attributes=P.attributes,ao.geometry.boundingBox===null&&(ao.geometry.boundingBox=new Is),ao.geometry.boundingSphere===null&&(ao.geometry.boundingSphere=new da);for(let F=0;F<M;F++){if(!A[F]||!b[F])continue;const z=E[F];ao.geometry.setDrawRange(z.start,z.count),this.getMatrixAt(F,ao.matrixWorld).premultiply(N),this.getBoundingBoxAt(F,ao.geometry.boundingBox),this.getBoundingSphereAt(F,ao.geometry.boundingSphere),ao.raycast(a,QE);for(let X=0,q=QE.length;X<q;X++){const K=QE[X];K.object=this,K.batchId=F,h.push(K)}QE.length=0}ao.material=null,ao.geometry.index=null,ao.geometry.attributes={},ao.geometry.setDrawRange(0,1/0)}copy(a){return super.copy(a),this.geometry=a.geometry.clone(),this.perObjectFrustumCulled=a.perObjectFrustumCulled,this.sortObjects=a.sortObjects,this.boundingBox=a.boundingBox!==null?a.boundingBox.clone():null,this.boundingSphere=a.boundingSphere!==null?a.boundingSphere.clone():null,this._drawRanges=a._drawRanges.map(h=>({...h})),this._reservedRanges=a._reservedRanges.map(h=>({...h})),this._visibility=a._visibility.slice(),this._active=a._active.slice(),this._bounds=a._bounds.map(h=>({boxInitialized:h.boxInitialized,box:h.box.clone(),sphereInitialized:h.sphereInitialized,sphere:h.sphere.clone()})),this._maxGeometryCount=a._maxGeometryCount,this._maxVertexCount=a._maxVertexCount,this._maxIndexCount=a._maxIndexCount,this._geometryInitialized=a._geometryInitialized,this._geometryCount=a._geometryCount,this._multiDrawCounts=a._multiDrawCounts.slice(),this._multiDrawStarts=a._multiDrawStarts.slice(),this._matricesTexture=a._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(a,h,A,b,E){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const M=b.getIndex(),N=M===null?1:M.array.BYTES_PER_ELEMENT,P=this._active,F=this._visibility,z=this._multiDrawStarts,X=this._multiDrawCounts,q=this._drawRanges,K=this.perObjectFrustumCulled;K&&(_j.multiplyMatrices(A.projectionMatrix,A.matrixWorldInverse).multiply(this.matrixWorld),qB.setFromProjectionMatrix(_j,a.coordinateSystem));let te=0;if(this.sortObjects){bj.copy(this.matrixWorld).invert(),pv.setFromMatrixPosition(A.matrixWorld).applyMatrix4(bj);for(let ee=0,Me=F.length;ee<Me;ee++)if(F[ee]&&P[ee]){this.getMatrixAt(ee,Od),this.getBoundingSphereAt(ee,ff).applyMatrix4(Od);let we=!1;if(K&&(we=!qB.intersectsSphere(ff)),!we){const _e=pv.distanceTo(ff.center);XB.push(q[ee],_e)}}const oe=XB.list,ne=this.customSort;ne===null?oe.sort(E.transparent?mSe:fSe):ne.call(this,oe,A);for(let ee=0,Me=oe.length;ee<Me;ee++){const we=oe[ee];z[te]=we.start*N,X[te]=we.count,te++}XB.reset()}else for(let oe=0,ne=F.length;oe<ne;oe++)if(F[oe]&&P[oe]){let ee=!1;if(K&&(this.getMatrixAt(oe,Od),this.getBoundingSphereAt(oe,ff).applyMatrix4(Od),ee=!qB.intersectsSphere(ff)),!ee){const Me=q[oe];z[te]=Me.start*N,X[te]=Me.count,te++}}this._multiDrawCount=te,this._visibilityChanged=!1}onBeforeShadow(a,h,A,b,E,M){this.onBeforeRender(a,null,b,E,M)}}class Mo extends so{constructor(a){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new or(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.fog=a.fog,this}}const qE=new He,XE=new He,wj=new fr,fv=new pa,YE=new da,YB=new He,Cj=new He;class Pd extends Vn{constructor(a=new hn,h=new Mo){super(),this.isLine=!0,this.type="Line",this.geometry=a,this.material=h,this.updateMorphTargets()}copy(a,h){return super.copy(a,h),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}computeLineDistances(){const a=this.geometry;if(a.index===null){const h=a.attributes.position,A=[0];for(let b=1,E=h.count;b<E;b++)qE.fromBufferAttribute(h,b-1),XE.fromBufferAttribute(h,b),A[b]=A[b-1],A[b]+=qE.distanceTo(XE);a.setAttribute("lineDistance",new vr(A,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(a,h){const A=this.geometry,b=this.matrixWorld,E=a.params.Line.threshold,M=A.drawRange;if(A.boundingSphere===null&&A.computeBoundingSphere(),YE.copy(A.boundingSphere),YE.applyMatrix4(b),YE.radius+=E,a.ray.intersectsSphere(YE)===!1)return;wj.copy(b).invert(),fv.copy(a.ray).applyMatrix4(wj);const N=E/((this.scale.x+this.scale.y+this.scale.z)/3),P=N*N,F=this.isLineSegments?2:1,z=A.index,X=A.attributes.position;if(z!==null){const q=Math.max(0,M.start),K=Math.min(z.count,M.start+M.count);for(let te=q,oe=K-1;te<oe;te+=F){const ne=z.getX(te),ee=z.getX(te+1),Me=KE(this,a,fv,P,ne,ee);Me&&h.push(Me)}if(this.isLineLoop){const te=z.getX(K-1),oe=z.getX(q),ne=KE(this,a,fv,P,te,oe);ne&&h.push(ne)}}else{const q=Math.max(0,M.start),K=Math.min(X.count,M.start+M.count);for(let te=q,oe=K-1;te<oe;te+=F){const ne=KE(this,a,fv,P,te,te+1);ne&&h.push(ne)}if(this.isLineLoop){const te=KE(this,a,fv,P,K-1,q);te&&h.push(te)}}}updateMorphTargets(){const a=this.geometry.morphAttributes,h=Object.keys(a);if(h.length>0){const A=a[h[0]];if(A!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let b=0,E=A.length;b<E;b++){const M=A[b].name||String(b);this.morphTargetInfluences.push(0),this.morphTargetDictionary[M]=b}}}}}function KE(C,a,h,A,b,E){const M=C.geometry.attributes.position;if(qE.fromBufferAttribute(M,b),XE.fromBufferAttribute(M,E),h.distanceSqToSegment(qE,XE,YB,Cj)>A)return;YB.applyMatrix4(C.matrixWorld);const N=a.ray.origin.distanceTo(YB);if(!(N<a.near||N>a.far))return{distance:N,point:Cj.clone().applyMatrix4(C.matrixWorld),index:b,face:null,faceIndex:null,object:C}}const Sj=new He,Tj=new He;class Jc extends Pd{constructor(a,h){super(a,h),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const a=this.geometry;if(a.index===null){const h=a.attributes.position,A=[];for(let b=0,E=h.count;b<E;b+=2)Sj.fromBufferAttribute(h,b),Tj.fromBufferAttribute(h,b+1),A[b]=b===0?0:A[b-1],A[b+1]=A[b]+Sj.distanceTo(Tj);a.setAttribute("lineDistance",new vr(A,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Mj extends Pd{constructor(a,h){super(a,h),this.isLineLoop=!0,this.type="LineLoop"}}class KB extends so{constructor(a){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new or(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.size=a.size,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}const Rj=new fr,JB=new pa,JE=new da,ZE=new He;class Ij extends Vn{constructor(a=new hn,h=new KB){super(),this.isPoints=!0,this.type="Points",this.geometry=a,this.material=h,this.updateMorphTargets()}copy(a,h){return super.copy(a,h),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}raycast(a,h){const A=this.geometry,b=this.matrixWorld,E=a.params.Points.threshold,M=A.drawRange;if(A.boundingSphere===null&&A.computeBoundingSphere(),JE.copy(A.boundingSphere),JE.applyMatrix4(b),JE.radius+=E,a.ray.intersectsSphere(JE)===!1)return;Rj.copy(b).invert(),JB.copy(a.ray).applyMatrix4(Rj);const N=E/((this.scale.x+this.scale.y+this.scale.z)/3),P=N*N,F=A.index,z=A.attributes.position;if(F!==null){const X=Math.max(0,M.start),q=Math.min(F.count,M.start+M.count);for(let K=X,te=q;K<te;K++){const oe=F.getX(K);ZE.fromBufferAttribute(z,oe),Bj(ZE,oe,P,b,a,h,this)}}else{const X=Math.max(0,M.start),q=Math.min(z.count,M.start+M.count);for(let K=X,te=q;K<te;K++)ZE.fromBufferAttribute(z,K),Bj(ZE,K,P,b,a,h,this)}}updateMorphTargets(){const a=this.geometry.morphAttributes,h=Object.keys(a);if(h.length>0){const A=a[h[0]];if(A!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let b=0,E=A.length;b<E;b++){const M=A[b].name||String(b);this.morphTargetInfluences.push(0),this.morphTargetDictionary[M]=b}}}}}function Bj(C,a,h,A,b,E,M){const N=JB.distanceSqToPoint(C);if(N<h){const P=new He;JB.closestPointToPoint(C,P),P.applyMatrix4(A);const F=b.ray.origin.distanceTo(P);if(F<b.near||F>b.far)return;E.push({distance:F,distanceToRay:Math.sqrt(N),point:P,index:a,face:null,object:M})}}class vSe extends us{constructor(a,h,A,b,E,M,N,P,F){super(a,h,A,b,E,M,N,P,F),this.isVideoTexture=!0,this.minFilter=M!==void 0?M:Pi,this.magFilter=E!==void 0?E:Pi,this.generateMipmaps=!1;const z=this;function X(){z.needsUpdate=!0,a.requestVideoFrameCallback(X)}"requestVideoFrameCallback"in a&&a.requestVideoFrameCallback(X)}clone(){return new this.constructor(this.image).copy(this)}update(){const a=this.image;!("requestVideoFrameCallback"in a)&&a.readyState>=a.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class xSe extends us{constructor(a,h){super({width:a,height:h}),this.isFramebufferTexture=!0,this.magFilter=Bt,this.minFilter=Bt,this.generateMipmaps=!1,this.needsUpdate=!0}}class $E extends us{constructor(a,h,A,b,E,M,N,P,F,z,X,q){super(null,M,N,P,F,z,b,E,X,q),this.isCompressedTexture=!0,this.image={width:h,height:A},this.mipmaps=a,this.flipY=!1,this.generateMipmaps=!1}}class bSe extends $E{constructor(a,h,A,b,E,M){super(a,h,A,E,M),this.isCompressedArrayTexture=!0,this.image.depth=b,this.wrapR=je}}class _Se extends $E{constructor(a,h,A){super(void 0,a[0].width,a[0].height,h,A,k),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=a}}class ESe extends us{constructor(a,h,A,b,E,M,N,P,F){super(a,h,A,b,E,M,N,P,F),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Tc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(a,h){const A=this.getUtoTmapping(a);return this.getPoint(A,h)}getPoints(a=5){const h=[];for(let A=0;A<=a;A++)h.push(this.getPoint(A/a));return h}getSpacedPoints(a=5){const h=[];for(let A=0;A<=a;A++)h.push(this.getPointAt(A/a));return h}getLength(){const a=this.getLengths();return a[a.length-1]}getLengths(a=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const h=[];let A,b=this.getPoint(0),E=0;h.push(0);for(let M=1;M<=a;M++)A=this.getPoint(M/a),E+=A.distanceTo(b),h.push(E),b=A;return this.cacheArcLengths=h,h}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(a,h){const A=this.getLengths();let b=0;const E=A.length;let M;h?M=h:M=a*A[E-1];let N=0,P=E-1,F;for(;N<=P;)if(b=Math.floor(N+(P-N)/2),F=A[b]-M,F<0)N=b+1;else if(F>0)P=b-1;else{P=b;break}if(b=P,A[b]===M)return b/(E-1);const z=A[b],X=A[b+1]-z,q=(M-z)/X;return(b+q)/(E-1)}getTangent(a,h){let A=a-1e-4,b=a+1e-4;A<0&&(A=0),b>1&&(b=1);const E=this.getPoint(A),M=this.getPoint(b),N=h||(E.isVector2?new ni:new He);return N.copy(M).sub(E).normalize(),N}getTangentAt(a,h){const A=this.getUtoTmapping(a);return this.getTangent(A,h)}computeFrenetFrames(a,h){const A=new He,b=[],E=[],M=[],N=new He,P=new fr;for(let K=0;K<=a;K++){const te=K/a;b[K]=this.getTangentAt(te,new He)}E[0]=new He,M[0]=new He;let F=Number.MAX_VALUE;const z=Math.abs(b[0].x),X=Math.abs(b[0].y),q=Math.abs(b[0].z);z<=F&&(F=z,A.set(1,0,0)),X<=F&&(F=X,A.set(0,1,0)),q<=F&&A.set(0,0,1),N.crossVectors(b[0],A).normalize(),E[0].crossVectors(b[0],N),M[0].crossVectors(b[0],E[0]);for(let K=1;K<=a;K++){if(E[K]=E[K-1].clone(),M[K]=M[K-1].clone(),N.crossVectors(b[K-1],b[K]),N.length()>Number.EPSILON){N.normalize();const te=Math.acos(ws(b[K-1].dot(b[K]),-1,1));E[K].applyMatrix4(P.makeRotationAxis(N,te))}M[K].crossVectors(b[K],E[K])}if(h===!0){let K=Math.acos(ws(E[0].dot(E[a]),-1,1));K/=a,b[0].dot(N.crossVectors(E[0],E[a]))>0&&(K=-K);for(let te=1;te<=a;te++)E[te].applyMatrix4(P.makeRotationAxis(b[te],K*te)),M[te].crossVectors(b[te],E[te])}return{tangents:b,normals:E,binormals:M}}clone(){return new this.constructor().copy(this)}copy(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}toJSON(){const a={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return a.arcLengthDivisions=this.arcLengthDivisions,a.type=this.type,a}fromJSON(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}}class ew extends Tc{constructor(a=0,h=0,A=1,b=1,E=0,M=Math.PI*2,N=!1,P=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=a,this.aY=h,this.xRadius=A,this.yRadius=b,this.aStartAngle=E,this.aEndAngle=M,this.aClockwise=N,this.aRotation=P}getPoint(a,h=new ni){const A=h,b=Math.PI*2;let E=this.aEndAngle-this.aStartAngle;const M=Math.abs(E)<Number.EPSILON;for(;E<0;)E+=b;for(;E>b;)E-=b;E<Number.EPSILON&&(M?E=0:E=b),this.aClockwise===!0&&!M&&(E===b?E=-b:E=E-b);const N=this.aStartAngle+a*E;let P=this.aX+this.xRadius*Math.cos(N),F=this.aY+this.yRadius*Math.sin(N);if(this.aRotation!==0){const z=Math.cos(this.aRotation),X=Math.sin(this.aRotation),q=P-this.aX,K=F-this.aY;P=q*z-K*X+this.aX,F=q*X+K*z+this.aY}return A.set(P,F)}copy(a){return super.copy(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}toJSON(){const a=super.toJSON();return a.aX=this.aX,a.aY=this.aY,a.xRadius=this.xRadius,a.yRadius=this.yRadius,a.aStartAngle=this.aStartAngle,a.aEndAngle=this.aEndAngle,a.aClockwise=this.aClockwise,a.aRotation=this.aRotation,a}fromJSON(a){return super.fromJSON(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}}class Nj extends ew{constructor(a,h,A,b,E,M){super(a,h,A,A,b,E,M),this.isArcCurve=!0,this.type="ArcCurve"}}function ZB(){let C=0,a=0,h=0,A=0;function b(E,M,N,P){C=E,a=N,h=-3*E+3*M-2*N-P,A=2*E-2*M+N+P}return{initCatmullRom:function(E,M,N,P,F){b(M,N,F*(N-E),F*(P-M))},initNonuniformCatmullRom:function(E,M,N,P,F,z,X){let q=(M-E)/F-(N-E)/(F+z)+(N-M)/z,K=(N-M)/z-(P-M)/(z+X)+(P-N)/X;q*=z,K*=z,b(M,N,q,K)},calc:function(E){const M=E*E,N=M*E;return C+a*E+h*M+A*N}}}const tw=new He,$B=new ZB,eN=new ZB,tN=new ZB;class Lj extends Tc{constructor(a=[],h=!1,A="centripetal",b=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=a,this.closed=h,this.curveType=A,this.tension=b}getPoint(a,h=new He){const A=h,b=this.points,E=b.length,M=(E-(this.closed?0:1))*a;let N=Math.floor(M),P=M-N;this.closed?N+=N>0?0:(Math.floor(Math.abs(N)/E)+1)*E:P===0&&N===E-1&&(N=E-2,P=1);let F,z;this.closed||N>0?F=b[(N-1)%E]:(tw.subVectors(b[0],b[1]).add(b[0]),F=tw);const X=b[N%E],q=b[(N+1)%E];if(this.closed||N+2<E?z=b[(N+2)%E]:(tw.subVectors(b[E-1],b[E-2]).add(b[E-1]),z=tw),this.curveType==="centripetal"||this.curveType==="chordal"){const K=this.curveType==="chordal"?.5:.25;let te=Math.pow(F.distanceToSquared(X),K),oe=Math.pow(X.distanceToSquared(q),K),ne=Math.pow(q.distanceToSquared(z),K);oe<1e-4&&(oe=1),te<1e-4&&(te=oe),ne<1e-4&&(ne=oe),$B.initNonuniformCatmullRom(F.x,X.x,q.x,z.x,te,oe,ne),eN.initNonuniformCatmullRom(F.y,X.y,q.y,z.y,te,oe,ne),tN.initNonuniformCatmullRom(F.z,X.z,q.z,z.z,te,oe,ne)}else this.curveType==="catmullrom"&&($B.initCatmullRom(F.x,X.x,q.x,z.x,this.tension),eN.initCatmullRom(F.y,X.y,q.y,z.y,this.tension),tN.initCatmullRom(F.z,X.z,q.z,z.z,this.tension));return A.set($B.calc(P),eN.calc(P),tN.calc(P)),A}copy(a){super.copy(a),this.points=[];for(let h=0,A=a.points.length;h<A;h++){const b=a.points[h];this.points.push(b.clone())}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}toJSON(){const a=super.toJSON();a.points=[];for(let h=0,A=this.points.length;h<A;h++){const b=this.points[h];a.points.push(b.toArray())}return a.closed=this.closed,a.curveType=this.curveType,a.tension=this.tension,a}fromJSON(a){super.fromJSON(a),this.points=[];for(let h=0,A=a.points.length;h<A;h++){const b=a.points[h];this.points.push(new He().fromArray(b))}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}}function Dj(C,a,h,A,b){const E=(A-a)*.5,M=(b-h)*.5,N=C*C,P=C*N;return(2*h-2*A+E+M)*P+(-3*h+3*A-2*E-M)*N+E*C+h}function wSe(C,a){const h=1-C;return h*h*a}function CSe(C,a){return 2*(1-C)*C*a}function SSe(C,a){return C*C*a}function mv(C,a,h,A){return wSe(C,a)+CSe(C,h)+SSe(C,A)}function TSe(C,a){const h=1-C;return h*h*h*a}function MSe(C,a){const h=1-C;return 3*h*h*C*a}function RSe(C,a){return 3*(1-C)*C*C*a}function ISe(C,a){return C*C*C*a}function gv(C,a,h,A,b){return TSe(C,a)+MSe(C,h)+RSe(C,A)+ISe(C,b)}class iN extends Tc{constructor(a=new ni,h=new ni,A=new ni,b=new ni){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=a,this.v1=h,this.v2=A,this.v3=b}getPoint(a,h=new ni){const A=h,b=this.v0,E=this.v1,M=this.v2,N=this.v3;return A.set(gv(a,b.x,E.x,M.x,N.x),gv(a,b.y,E.y,M.y,N.y)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class Oj extends Tc{constructor(a=new He,h=new He,A=new He,b=new He){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=a,this.v1=h,this.v2=A,this.v3=b}getPoint(a,h=new He){const A=h,b=this.v0,E=this.v1,M=this.v2,N=this.v3;return A.set(gv(a,b.x,E.x,M.x,N.x),gv(a,b.y,E.y,M.y,N.y),gv(a,b.z,E.z,M.z,N.z)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class rN extends Tc{constructor(a=new ni,h=new ni){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=a,this.v2=h}getPoint(a,h=new ni){const A=h;return a===1?A.copy(this.v2):(A.copy(this.v2).sub(this.v1),A.multiplyScalar(a).add(this.v1)),A}getPointAt(a,h){return this.getPoint(a,h)}getTangent(a,h=new ni){return h.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,h){return this.getTangent(a,h)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class Pj extends Tc{constructor(a=new He,h=new He){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=a,this.v2=h}getPoint(a,h=new He){const A=h;return a===1?A.copy(this.v2):(A.copy(this.v2).sub(this.v1),A.multiplyScalar(a).add(this.v1)),A}getPointAt(a,h){return this.getPoint(a,h)}getTangent(a,h=new He){return h.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,h){return this.getTangent(a,h)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class nN extends Tc{constructor(a=new ni,h=new ni,A=new ni){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=a,this.v1=h,this.v2=A}getPoint(a,h=new ni){const A=h,b=this.v0,E=this.v1,M=this.v2;return A.set(mv(a,b.x,E.x,M.x),mv(a,b.y,E.y,M.y)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class sN extends Tc{constructor(a=new He,h=new He,A=new He){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=a,this.v1=h,this.v2=A}getPoint(a,h=new He){const A=h,b=this.v0,E=this.v1,M=this.v2;return A.set(mv(a,b.x,E.x,M.x),mv(a,b.y,E.y,M.y),mv(a,b.z,E.z,M.z)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class aN extends Tc{constructor(a=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=a}getPoint(a,h=new ni){const A=h,b=this.points,E=(b.length-1)*a,M=Math.floor(E),N=E-M,P=b[M===0?M:M-1],F=b[M],z=b[M>b.length-2?b.length-1:M+1],X=b[M>b.length-3?b.length-1:M+2];return A.set(Dj(N,P.x,F.x,z.x,X.x),Dj(N,P.y,F.y,z.y,X.y)),A}copy(a){super.copy(a),this.points=[];for(let h=0,A=a.points.length;h<A;h++){const b=a.points[h];this.points.push(b.clone())}return this}toJSON(){const a=super.toJSON();a.points=[];for(let h=0,A=this.points.length;h<A;h++){const b=this.points[h];a.points.push(b.toArray())}return a}fromJSON(a){super.fromJSON(a),this.points=[];for(let h=0,A=a.points.length;h<A;h++){const b=a.points[h];this.points.push(new ni().fromArray(b))}return this}}var iw=Object.freeze({__proto__:null,ArcCurve:Nj,CatmullRomCurve3:Lj,CubicBezierCurve:iN,CubicBezierCurve3:Oj,EllipseCurve:ew,LineCurve:rN,LineCurve3:Pj,QuadraticBezierCurve:nN,QuadraticBezierCurve3:sN,SplineCurve:aN});class Fj extends Tc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(a){this.curves.push(a)}closePath(){const a=this.curves[0].getPoint(0),h=this.curves[this.curves.length-1].getPoint(1);if(!a.equals(h)){const A=a.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new iw[A](h,a))}return this}getPoint(a,h){const A=a*this.getLength(),b=this.getCurveLengths();let E=0;for(;E<b.length;){if(b[E]>=A){const M=b[E]-A,N=this.curves[E],P=N.getLength(),F=P===0?0:1-M/P;return N.getPointAt(F,h)}E++}return null}getLength(){const a=this.getCurveLengths();return a[a.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const a=[];let h=0;for(let A=0,b=this.curves.length;A<b;A++)h+=this.curves[A].getLength(),a.push(h);return this.cacheLengths=a,a}getSpacedPoints(a=40){const h=[];for(let A=0;A<=a;A++)h.push(this.getPoint(A/a));return this.autoClose&&h.push(h[0]),h}getPoints(a=12){const h=[];let A;for(let b=0,E=this.curves;b<E.length;b++){const M=E[b],N=M.isEllipseCurve?a*2:M.isLineCurve||M.isLineCurve3?1:M.isSplineCurve?a*M.points.length:a,P=M.getPoints(N);for(let F=0;F<P.length;F++){const z=P[F];A&&A.equals(z)||(h.push(z),A=z)}}return this.autoClose&&h.length>1&&!h[h.length-1].equals(h[0])&&h.push(h[0]),h}copy(a){super.copy(a),this.curves=[];for(let h=0,A=a.curves.length;h<A;h++){const b=a.curves[h];this.curves.push(b.clone())}return this.autoClose=a.autoClose,this}toJSON(){const a=super.toJSON();a.autoClose=this.autoClose,a.curves=[];for(let h=0,A=this.curves.length;h<A;h++){const b=this.curves[h];a.curves.push(b.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.autoClose=a.autoClose,this.curves=[];for(let h=0,A=a.curves.length;h<A;h++){const b=a.curves[h];this.curves.push(new iw[b.type]().fromJSON(b))}return this}}class Av extends Fj{constructor(a){super(),this.type="Path",this.currentPoint=new ni,a&&this.setFromPoints(a)}setFromPoints(a){this.moveTo(a[0].x,a[0].y);for(let h=1,A=a.length;h<A;h++)this.lineTo(a[h].x,a[h].y);return this}moveTo(a,h){return this.currentPoint.set(a,h),this}lineTo(a,h){const A=new rN(this.currentPoint.clone(),new ni(a,h));return this.curves.push(A),this.currentPoint.set(a,h),this}quadraticCurveTo(a,h,A,b){const E=new nN(this.currentPoint.clone(),new ni(a,h),new ni(A,b));return this.curves.push(E),this.currentPoint.set(A,b),this}bezierCurveTo(a,h,A,b,E,M){const N=new iN(this.currentPoint.clone(),new ni(a,h),new ni(A,b),new ni(E,M));return this.curves.push(N),this.currentPoint.set(E,M),this}splineThru(a){const h=[this.currentPoint.clone()].concat(a),A=new aN(h);return this.curves.push(A),this.currentPoint.copy(a[a.length-1]),this}arc(a,h,A,b,E,M){const N=this.currentPoint.x,P=this.currentPoint.y;return this.absarc(a+N,h+P,A,b,E,M),this}absarc(a,h,A,b,E,M){return this.absellipse(a,h,A,A,b,E,M),this}ellipse(a,h,A,b,E,M,N,P){const F=this.currentPoint.x,z=this.currentPoint.y;return this.absellipse(a+F,h+z,A,b,E,M,N,P),this}absellipse(a,h,A,b,E,M,N,P){const F=new ew(a,h,A,b,E,M,N,P);if(this.curves.length>0){const X=F.getPoint(0);X.equals(this.currentPoint)||this.lineTo(X.x,X.y)}this.curves.push(F);const z=F.getPoint(1);return this.currentPoint.copy(z),this}copy(a){return super.copy(a),this.currentPoint.copy(a.currentPoint),this}toJSON(){const a=super.toJSON();return a.currentPoint=this.currentPoint.toArray(),a}fromJSON(a){return super.fromJSON(a),this.currentPoint.fromArray(a.currentPoint),this}}class yv extends hn{constructor(a=[new ni(0,-.5),new ni(.5,0),new ni(0,.5)],h=12,A=0,b=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:a,segments:h,phiStart:A,phiLength:b},h=Math.floor(h),b=ws(b,0,Math.PI*2);const E=[],M=[],N=[],P=[],F=[],z=1/h,X=new He,q=new ni,K=new He,te=new He,oe=new He;let ne=0,ee=0;for(let Me=0;Me<=a.length-1;Me++)switch(Me){case 0:ne=a[Me+1].x-a[Me].x,ee=a[Me+1].y-a[Me].y,K.x=ee*1,K.y=-ne,K.z=ee*0,oe.copy(K),K.normalize(),P.push(K.x,K.y,K.z);break;case a.length-1:P.push(oe.x,oe.y,oe.z);break;default:ne=a[Me+1].x-a[Me].x,ee=a[Me+1].y-a[Me].y,K.x=ee*1,K.y=-ne,K.z=ee*0,te.copy(K),K.x+=oe.x,K.y+=oe.y,K.z+=oe.z,K.normalize(),P.push(K.x,K.y,K.z),oe.copy(te)}for(let Me=0;Me<=h;Me++){const we=A+Me*z*b,_e=Math.sin(we),nt=Math.cos(we);for(let qe=0;qe<=a.length-1;qe++){X.x=a[qe].x*_e,X.y=a[qe].y,X.z=a[qe].x*nt,M.push(X.x,X.y,X.z),q.x=Me/h,q.y=qe/(a.length-1),N.push(q.x,q.y);const Je=P[3*qe+0]*_e,it=P[3*qe+1],ze=P[3*qe+0]*nt;F.push(Je,it,ze)}}for(let Me=0;Me<h;Me++)for(let we=0;we<a.length-1;we++){const _e=we+Me*a.length,nt=_e,qe=_e+a.length,Je=_e+a.length+1,it=_e+1;E.push(nt,qe,it),E.push(Je,it,qe)}this.setIndex(E),this.setAttribute("position",new vr(M,3)),this.setAttribute("uv",new vr(N,2)),this.setAttribute("normal",new vr(F,3))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new yv(a.points,a.segments,a.phiStart,a.phiLength)}}class rw extends yv{constructor(a=1,h=1,A=4,b=8){const E=new Av;E.absarc(0,-h/2,a,Math.PI*1.5,0),E.absarc(0,h/2,a,0,Math.PI*.5),super(E.getPoints(A),b),this.type="CapsuleGeometry",this.parameters={radius:a,length:h,capSegments:A,radialSegments:b}}static fromJSON(a){return new rw(a.radius,a.length,a.capSegments,a.radialSegments)}}class nw extends hn{constructor(a=1,h=32,A=0,b=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:a,segments:h,thetaStart:A,thetaLength:b},h=Math.max(3,h);const E=[],M=[],N=[],P=[],F=new He,z=new ni;M.push(0,0,0),N.push(0,0,1),P.push(.5,.5);for(let X=0,q=3;X<=h;X++,q+=3){const K=A+X/h*b;F.x=a*Math.cos(K),F.y=a*Math.sin(K),M.push(F.x,F.y,F.z),N.push(0,0,1),z.x=(M[q]/a+1)/2,z.y=(M[q+1]/a+1)/2,P.push(z.x,z.y)}for(let X=1;X<=h;X++)E.push(X,X+1,0);this.setIndex(E),this.setAttribute("position",new vr(M,3)),this.setAttribute("normal",new vr(N,3)),this.setAttribute("uv",new vr(P,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new nw(a.radius,a.segments,a.thetaStart,a.thetaLength)}}class y0 extends hn{constructor(a=1,h=1,A=1,b=32,E=1,M=!1,N=0,P=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:a,radiusBottom:h,height:A,radialSegments:b,heightSegments:E,openEnded:M,thetaStart:N,thetaLength:P};const F=this;b=Math.floor(b),E=Math.floor(E);const z=[],X=[],q=[],K=[];let te=0;const oe=[],ne=A/2;let ee=0;Me(),M===!1&&(a>0&&we(!0),h>0&&we(!1)),this.setIndex(z),this.setAttribute("position",new vr(X,3)),this.setAttribute("normal",new vr(q,3)),this.setAttribute("uv",new vr(K,2));function Me(){const _e=new He,nt=new He;let qe=0;const Je=(h-a)/A;for(let it=0;it<=E;it++){const ze=[],Oe=it/E,rt=Oe*(h-a)+a;for(let mt=0;mt<=b;mt++){const pt=mt/b,Tt=pt*P+N,Pt=Math.sin(Tt),ui=Math.cos(Tt);nt.x=rt*Pt,nt.y=-Oe*A+ne,nt.z=rt*ui,X.push(nt.x,nt.y,nt.z),_e.set(Pt,Je,ui).normalize(),q.push(_e.x,_e.y,_e.z),K.push(pt,1-Oe),ze.push(te++)}oe.push(ze)}for(let it=0;it<b;it++)for(let ze=0;ze<E;ze++){const Oe=oe[ze][it],rt=oe[ze+1][it],mt=oe[ze+1][it+1],pt=oe[ze][it+1];z.push(Oe,rt,pt),z.push(rt,mt,pt),qe+=6}F.addGroup(ee,qe,0),ee+=qe}function we(_e){const nt=te,qe=new ni,Je=new He;let it=0;const ze=_e===!0?a:h,Oe=_e===!0?1:-1;for(let mt=1;mt<=b;mt++)X.push(0,ne*Oe,0),q.push(0,Oe,0),K.push(.5,.5),te++;const rt=te;for(let mt=0;mt<=b;mt++){const pt=mt/b*P+N,Tt=Math.cos(pt),Pt=Math.sin(pt);Je.x=ze*Pt,Je.y=ne*Oe,Je.z=ze*Tt,X.push(Je.x,Je.y,Je.z),q.push(0,Oe,0),qe.x=Tt*.5+.5,qe.y=Pt*.5*Oe+.5,K.push(qe.x,qe.y),te++}for(let mt=0;mt<b;mt++){const pt=nt+mt,Tt=rt+mt;_e===!0?z.push(Tt,Tt+1,pt):z.push(Tt+1,Tt,pt),it+=3}F.addGroup(ee,it,_e===!0?1:2),ee+=it}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new y0(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class sw extends y0{constructor(a=1,h=1,A=32,b=1,E=!1,M=0,N=Math.PI*2){super(0,a,h,A,b,E,M,N),this.type="ConeGeometry",this.parameters={radius:a,height:h,radialSegments:A,heightSegments:b,openEnded:E,thetaStart:M,thetaLength:N}}static fromJSON(a){return new sw(a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class Fd extends hn{constructor(a=[],h=[],A=1,b=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:h,radius:A,detail:b};const E=[],M=[];N(b),F(A),z(),this.setAttribute("position",new vr(E,3)),this.setAttribute("normal",new vr(E.slice(),3)),this.setAttribute("uv",new vr(M,2)),b===0?this.computeVertexNormals():this.normalizeNormals();function N(Me){const we=new He,_e=new He,nt=new He;for(let qe=0;qe<h.length;qe+=3)K(h[qe+0],we),K(h[qe+1],_e),K(h[qe+2],nt),P(we,_e,nt,Me)}function P(Me,we,_e,nt){const qe=nt+1,Je=[];for(let it=0;it<=qe;it++){Je[it]=[];const ze=Me.clone().lerp(_e,it/qe),Oe=we.clone().lerp(_e,it/qe),rt=qe-it;for(let mt=0;mt<=rt;mt++)mt===0&&it===qe?Je[it][mt]=ze:Je[it][mt]=ze.clone().lerp(Oe,mt/rt)}for(let it=0;it<qe;it++)for(let ze=0;ze<2*(qe-it)-1;ze++){const Oe=Math.floor(ze/2);ze%2===0?(q(Je[it][Oe+1]),q(Je[it+1][Oe]),q(Je[it][Oe])):(q(Je[it][Oe+1]),q(Je[it+1][Oe+1]),q(Je[it+1][Oe]))}}function F(Me){const we=new He;for(let _e=0;_e<E.length;_e+=3)we.x=E[_e+0],we.y=E[_e+1],we.z=E[_e+2],we.normalize().multiplyScalar(Me),E[_e+0]=we.x,E[_e+1]=we.y,E[_e+2]=we.z}function z(){const Me=new He;for(let we=0;we<E.length;we+=3){Me.x=E[we+0],Me.y=E[we+1],Me.z=E[we+2];const _e=ne(Me)/2/Math.PI+.5,nt=ee(Me)/Math.PI+.5;M.push(_e,1-nt)}te(),X()}function X(){for(let Me=0;Me<M.length;Me+=6){const we=M[Me+0],_e=M[Me+2],nt=M[Me+4],qe=Math.max(we,_e,nt),Je=Math.min(we,_e,nt);qe>.9&&Je<.1&&(we<.2&&(M[Me+0]+=1),_e<.2&&(M[Me+2]+=1),nt<.2&&(M[Me+4]+=1))}}function q(Me){E.push(Me.x,Me.y,Me.z)}function K(Me,we){const _e=Me*3;we.x=a[_e+0],we.y=a[_e+1],we.z=a[_e+2]}function te(){const Me=new He,we=new He,_e=new He,nt=new He,qe=new ni,Je=new ni,it=new ni;for(let ze=0,Oe=0;ze<E.length;ze+=9,Oe+=6){Me.set(E[ze+0],E[ze+1],E[ze+2]),we.set(E[ze+3],E[ze+4],E[ze+5]),_e.set(E[ze+6],E[ze+7],E[ze+8]),qe.set(M[Oe+0],M[Oe+1]),Je.set(M[Oe+2],M[Oe+3]),it.set(M[Oe+4],M[Oe+5]),nt.copy(Me).add(we).add(_e).divideScalar(3);const rt=ne(nt);oe(qe,Oe+0,Me,rt),oe(Je,Oe+2,we,rt),oe(it,Oe+4,_e,rt)}}function oe(Me,we,_e,nt){nt<0&&Me.x===1&&(M[we]=Me.x-1),_e.x===0&&_e.z===0&&(M[we]=nt/2/Math.PI+.5)}function ne(Me){return Math.atan2(Me.z,-Me.x)}function ee(Me){return Math.atan2(-Me.y,Math.sqrt(Me.x*Me.x+Me.z*Me.z))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Fd(a.vertices,a.indices,a.radius,a.details)}}class aw extends Fd{constructor(a=1,h=0){const A=(1+Math.sqrt(5))/2,b=1/A,E=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-b,-A,0,-b,A,0,b,-A,0,b,A,-b,-A,0,-b,A,0,b,-A,0,b,A,0,-A,0,-b,A,0,-b,-A,0,b,A,0,b],M=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(E,M,a,h),this.type="DodecahedronGeometry",this.parameters={radius:a,detail:h}}static fromJSON(a){return new aw(a.radius,a.detail)}}const ow=new He,lw=new He,oN=new He,cw=new bl;class kj extends hn{constructor(a=null,h=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:a,thresholdAngle:h},a!==null){const A=Math.pow(10,4),b=Math.cos(uh*h),E=a.getIndex(),M=a.getAttribute("position"),N=E?E.count:M.count,P=[0,0,0],F=["a","b","c"],z=new Array(3),X={},q=[];for(let K=0;K<N;K+=3){E?(P[0]=E.getX(K),P[1]=E.getX(K+1),P[2]=E.getX(K+2)):(P[0]=K,P[1]=K+1,P[2]=K+2);const{a:te,b:oe,c:ne}=cw;if(te.fromBufferAttribute(M,P[0]),oe.fromBufferAttribute(M,P[1]),ne.fromBufferAttribute(M,P[2]),cw.getNormal(oN),z[0]=`${Math.round(te.x*A)},${Math.round(te.y*A)},${Math.round(te.z*A)}`,z[1]=`${Math.round(oe.x*A)},${Math.round(oe.y*A)},${Math.round(oe.z*A)}`,z[2]=`${Math.round(ne.x*A)},${Math.round(ne.y*A)},${Math.round(ne.z*A)}`,!(z[0]===z[1]||z[1]===z[2]||z[2]===z[0]))for(let ee=0;ee<3;ee++){const Me=(ee+1)%3,we=z[ee],_e=z[Me],nt=cw[F[ee]],qe=cw[F[Me]],Je=`${we}_${_e}`,it=`${_e}_${we}`;it in X&&X[it]?(oN.dot(X[it].normal)<=b&&(q.push(nt.x,nt.y,nt.z),q.push(qe.x,qe.y,qe.z)),X[it]=null):Je in X||(X[Je]={index0:P[ee],index1:P[Me],normal:oN.clone()})}}for(const K in X)if(X[K]){const{index0:te,index1:oe}=X[K];ow.fromBufferAttribute(M,te),lw.fromBufferAttribute(M,oe),q.push(ow.x,ow.y,ow.z),q.push(lw.x,lw.y,lw.z)}this.setAttribute("position",new vr(q,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}class mf extends Av{constructor(a){super(a),this.uuid=wo(),this.type="Shape",this.holes=[]}getPointsHoles(a){const h=[];for(let A=0,b=this.holes.length;A<b;A++)h[A]=this.holes[A].getPoints(a);return h}extractPoints(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}}copy(a){super.copy(a),this.holes=[];for(let h=0,A=a.holes.length;h<A;h++){const b=a.holes[h];this.holes.push(b.clone())}return this}toJSON(){const a=super.toJSON();a.uuid=this.uuid,a.holes=[];for(let h=0,A=this.holes.length;h<A;h++){const b=this.holes[h];a.holes.push(b.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.uuid=a.uuid,this.holes=[];for(let h=0,A=a.holes.length;h<A;h++){const b=a.holes[h];this.holes.push(new Av().fromJSON(b))}return this}}const BSe={triangulate:function(C,a,h=2){const A=a&&a.length,b=A?a[0]*h:C.length;let E=Uj(C,0,b,h,!0);const M=[];if(!E||E.next===E.prev)return M;let N,P,F,z,X,q,K;if(A&&(E=PSe(C,a,E,h)),C.length>80*h){N=F=C[0],P=z=C[1];for(let te=h;te<b;te+=h)X=C[te],q=C[te+1],X<N&&(N=X),q<P&&(P=q),X>F&&(F=X),q>z&&(z=q);K=Math.max(F-N,z-P),K=K!==0?32767/K:0}return vv(E,M,h,N,P,K,0),M}};function Uj(C,a,h,A,b){let E,M;if(b===qSe(C,a,h,A)>0)for(E=a;E<h;E+=A)M=Vj(E,C[E],C[E+1],M);else for(E=h-A;E>=a;E-=A)M=Vj(E,C[E],C[E+1],M);return M&&uw(M,M.next)&&(bv(M),M=M.next),M}function gf(C,a){if(!C)return C;a||(a=C);let h=C,A;do if(A=!1,!h.steiner&&(uw(h,h.next)||Bs(h.prev,h,h.next)===0)){if(bv(h),h=a=h.prev,h===h.next)break;A=!0}else h=h.next;while(A||h!==a);return a}function vv(C,a,h,A,b,E,M){if(!C)return;!M&&E&&jSe(C,A,b,E);let N=C,P,F;for(;C.prev!==C.next;){if(P=C.prev,F=C.next,E?LSe(C,A,b,E):NSe(C)){a.push(P.i/h|0),a.push(C.i/h|0),a.push(F.i/h|0),bv(C),C=F.next,N=F.next;continue}if(C=F,C===N){M?M===1?(C=DSe(gf(C),a,h),vv(C,a,h,A,b,E,2)):M===2&&OSe(C,a,h,A,b,E):vv(gf(C),a,h,A,b,E,1);break}}}function NSe(C){const a=C.prev,h=C,A=C.next;if(Bs(a,h,A)>=0)return!1;const b=a.x,E=h.x,M=A.x,N=a.y,P=h.y,F=A.y,z=b<E?b<M?b:M:E<M?E:M,X=N<P?N<F?N:F:P<F?P:F,q=b>E?b>M?b:M:E>M?E:M,K=N>P?N>F?N:F:P>F?P:F;let te=A.next;for(;te!==a;){if(te.x>=z&&te.x<=q&&te.y>=X&&te.y<=K&&v0(b,N,E,P,M,F,te.x,te.y)&&Bs(te.prev,te,te.next)>=0)return!1;te=te.next}return!0}function LSe(C,a,h,A){const b=C.prev,E=C,M=C.next;if(Bs(b,E,M)>=0)return!1;const N=b.x,P=E.x,F=M.x,z=b.y,X=E.y,q=M.y,K=N<P?N<F?N:F:P<F?P:F,te=z<X?z<q?z:q:X<q?X:q,oe=N>P?N>F?N:F:P>F?P:F,ne=z>X?z>q?z:q:X>q?X:q,ee=lN(K,te,a,h,A),Me=lN(oe,ne,a,h,A);let we=C.prevZ,_e=C.nextZ;for(;we&&we.z>=ee&&_e&&_e.z<=Me;){if(we.x>=K&&we.x<=oe&&we.y>=te&&we.y<=ne&&we!==b&&we!==M&&v0(N,z,P,X,F,q,we.x,we.y)&&Bs(we.prev,we,we.next)>=0||(we=we.prevZ,_e.x>=K&&_e.x<=oe&&_e.y>=te&&_e.y<=ne&&_e!==b&&_e!==M&&v0(N,z,P,X,F,q,_e.x,_e.y)&&Bs(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;we&&we.z>=ee;){if(we.x>=K&&we.x<=oe&&we.y>=te&&we.y<=ne&&we!==b&&we!==M&&v0(N,z,P,X,F,q,we.x,we.y)&&Bs(we.prev,we,we.next)>=0)return!1;we=we.prevZ}for(;_e&&_e.z<=Me;){if(_e.x>=K&&_e.x<=oe&&_e.y>=te&&_e.y<=ne&&_e!==b&&_e!==M&&v0(N,z,P,X,F,q,_e.x,_e.y)&&Bs(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function DSe(C,a,h){let A=C;do{const b=A.prev,E=A.next.next;!uw(b,E)&&zj(b,A,A.next,E)&&xv(b,E)&&xv(E,b)&&(a.push(b.i/h|0),a.push(A.i/h|0),a.push(E.i/h|0),bv(A),bv(A.next),A=C=E),A=A.next}while(A!==C);return gf(A)}function OSe(C,a,h,A,b,E){let M=C;do{let N=M.next.next;for(;N!==M.prev;){if(M.i!==N.i&&HSe(M,N)){let P=jj(M,N);M=gf(M,M.next),P=gf(P,P.next),vv(M,a,h,A,b,E,0),vv(P,a,h,A,b,E,0);return}N=N.next}M=M.next}while(M!==C)}function PSe(C,a,h,A){const b=[];let E,M,N,P,F;for(E=0,M=a.length;E<M;E++)N=a[E]*A,P=E<M-1?a[E+1]*A:C.length,F=Uj(C,N,P,A,!1),F===F.next&&(F.steiner=!0),b.push(GSe(F));for(b.sort(FSe),E=0;E<b.length;E++)h=kSe(b[E],h);return h}function FSe(C,a){return C.x-a.x}function kSe(C,a){const h=USe(C,a);if(!h)return a;const A=jj(h,C);return gf(A,A.next),gf(h,h.next)}function USe(C,a){let h=a,A=-1/0,b;const E=C.x,M=C.y;do{if(M<=h.y&&M>=h.next.y&&h.next.y!==h.y){const q=h.x+(M-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(q<=E&&q>A&&(A=q,b=h.x<h.next.x?h:h.next,q===E))return b}h=h.next}while(h!==a);if(!b)return null;const N=b,P=b.x,F=b.y;let z=1/0,X;h=b;do E>=h.x&&h.x>=P&&E!==h.x&&v0(M<F?E:A,M,P,F,M<F?A:E,M,h.x,h.y)&&(X=Math.abs(M-h.y)/(E-h.x),xv(h,C)&&(X<z||X===z&&(h.x>b.x||h.x===b.x&&zSe(b,h)))&&(b=h,z=X)),h=h.next;while(h!==N);return b}function zSe(C,a){return Bs(C.prev,C,a.prev)<0&&Bs(a.next,C,C.next)<0}function jSe(C,a,h,A){let b=C;do b.z===0&&(b.z=lN(b.x,b.y,a,h,A)),b.prevZ=b.prev,b.nextZ=b.next,b=b.next;while(b!==C);b.prevZ.nextZ=null,b.prevZ=null,VSe(b)}function VSe(C){let a,h,A,b,E,M,N,P,F=1;do{for(h=C,C=null,E=null,M=0;h;){for(M++,A=h,N=0,a=0;a<F&&(N++,A=A.nextZ,!!A);a++);for(P=F;N>0||P>0&&A;)N!==0&&(P===0||!A||h.z<=A.z)?(b=h,h=h.nextZ,N--):(b=A,A=A.nextZ,P--),E?E.nextZ=b:C=b,b.prevZ=E,E=b;h=A}E.nextZ=null,F*=2}while(M>1);return C}function lN(C,a,h,A,b){return C=(C-h)*b|0,a=(a-A)*b|0,C=(C|C<<8)&16711935,C=(C|C<<4)&252645135,C=(C|C<<2)&858993459,C=(C|C<<1)&1431655765,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,C|a<<1}function GSe(C){let a=C,h=C;do(a.x<h.x||a.x===h.x&&a.y<h.y)&&(h=a),a=a.next;while(a!==C);return h}function v0(C,a,h,A,b,E,M,N){return(b-M)*(a-N)>=(C-M)*(E-N)&&(C-M)*(A-N)>=(h-M)*(a-N)&&(h-M)*(E-N)>=(b-M)*(A-N)}function HSe(C,a){return C.next.i!==a.i&&C.prev.i!==a.i&&!WSe(C,a)&&(xv(C,a)&&xv(a,C)&&QSe(C,a)&&(Bs(C.prev,C,a.prev)||Bs(C,a.prev,a))||uw(C,a)&&Bs(C.prev,C,C.next)>0&&Bs(a.prev,a,a.next)>0)}function Bs(C,a,h){return(a.y-C.y)*(h.x-a.x)-(a.x-C.x)*(h.y-a.y)}function uw(C,a){return C.x===a.x&&C.y===a.y}function zj(C,a,h,A){const b=dw(Bs(C,a,h)),E=dw(Bs(C,a,A)),M=dw(Bs(h,A,C)),N=dw(Bs(h,A,a));return!!(b!==E&&M!==N||b===0&&hw(C,h,a)||E===0&&hw(C,A,a)||M===0&&hw(h,C,A)||N===0&&hw(h,a,A))}function hw(C,a,h){return a.x<=Math.max(C.x,h.x)&&a.x>=Math.min(C.x,h.x)&&a.y<=Math.max(C.y,h.y)&&a.y>=Math.min(C.y,h.y)}function dw(C){return C>0?1:C<0?-1:0}function WSe(C,a){let h=C;do{if(h.i!==C.i&&h.next.i!==C.i&&h.i!==a.i&&h.next.i!==a.i&&zj(h,h.next,C,a))return!0;h=h.next}while(h!==C);return!1}function xv(C,a){return Bs(C.prev,C,C.next)<0?Bs(C,a,C.next)>=0&&Bs(C,C.prev,a)>=0:Bs(C,a,C.prev)<0||Bs(C,C.next,a)<0}function QSe(C,a){let h=C,A=!1;const b=(C.x+a.x)/2,E=(C.y+a.y)/2;do h.y>E!=h.next.y>E&&h.next.y!==h.y&&b<(h.next.x-h.x)*(E-h.y)/(h.next.y-h.y)+h.x&&(A=!A),h=h.next;while(h!==C);return A}function jj(C,a){const h=new cN(C.i,C.x,C.y),A=new cN(a.i,a.x,a.y),b=C.next,E=a.prev;return C.next=a,a.prev=C,h.next=b,b.prev=h,A.next=h,h.prev=A,E.next=A,A.prev=E,A}function Vj(C,a,h,A){const b=new cN(C,a,h);return A?(b.next=A.next,b.prev=A,A.next.prev=b,A.next=b):(b.prev=b,b.next=b),b}function bv(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function cN(C,a,h){this.i=C,this.x=a,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qSe(C,a,h,A){let b=0;for(let E=a,M=h-A;E<h;E+=A)b+=(C[M]-C[E])*(C[E+1]+C[M+1]),M=E;return b}class Zc{static area(a){const h=a.length;let A=0;for(let b=h-1,E=0;E<h;b=E++)A+=a[b].x*a[E].y-a[E].x*a[b].y;return A*.5}static isClockWise(a){return Zc.area(a)<0}static triangulateShape(a,h){const A=[],b=[],E=[];Gj(a),Hj(A,a);let M=a.length;h.forEach(Gj);for(let P=0;P<h.length;P++)b.push(M),M+=h[P].length,Hj(A,h[P]);const N=BSe.triangulate(A,b);for(let P=0;P<N.length;P+=3)E.push(N.slice(P,P+3));return E}}function Gj(C){const a=C.length;a>2&&C[a-1].equals(C[0])&&C.pop()}function Hj(C,a){for(let h=0;h<a.length;h++)C.push(a[h].x),C.push(a[h].y)}class pw extends hn{constructor(a=new mf([new ni(.5,.5),new ni(-.5,.5),new ni(-.5,-.5),new ni(.5,-.5)]),h={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:a,options:h},a=Array.isArray(a)?a:[a];const A=this,b=[],E=[];for(let N=0,P=a.length;N<P;N++){const F=a[N];M(F)}this.setAttribute("position",new vr(b,3)),this.setAttribute("uv",new vr(E,2)),this.computeVertexNormals();function M(N){const P=[],F=h.curveSegments!==void 0?h.curveSegments:12,z=h.steps!==void 0?h.steps:1,X=h.depth!==void 0?h.depth:1;let q=h.bevelEnabled!==void 0?h.bevelEnabled:!0,K=h.bevelThickness!==void 0?h.bevelThickness:.2,te=h.bevelSize!==void 0?h.bevelSize:K-.1,oe=h.bevelOffset!==void 0?h.bevelOffset:0,ne=h.bevelSegments!==void 0?h.bevelSegments:3;const ee=h.extrudePath,Me=h.UVGenerator!==void 0?h.UVGenerator:XSe;let we,_e=!1,nt,qe,Je,it;ee&&(we=ee.getSpacedPoints(z),_e=!0,q=!1,nt=ee.computeFrenetFrames(z,!1),qe=new He,Je=new He,it=new He),q||(ne=0,K=0,te=0,oe=0);const ze=N.extractPoints(F);let Oe=ze.shape;const rt=ze.holes;if(!Zc.isClockWise(Oe)){Oe=Oe.reverse();for(let tt=0,pi=rt.length;tt<pi;tt++){const $t=rt[tt];Zc.isClockWise($t)&&(rt[tt]=$t.reverse())}}const mt=Zc.triangulateShape(Oe,rt),pt=Oe;for(let tt=0,pi=rt.length;tt<pi;tt++){const $t=rt[tt];Oe=Oe.concat($t)}function Tt(tt,pi,$t){return pi||console.error("THREE.ExtrudeGeometry: vec does not exist"),tt.clone().addScaledVector(pi,$t)}const Pt=Oe.length,ui=mt.length;function Li(tt,pi,$t){let Zi,ai,er;const $i=tt.x-pi.x,Ar=tt.y-pi.y,gn=$t.x-tt.x,Hr=$t.y-tt.y,aa=$i*$i+Ar*Ar,Hs=$i*Hr-Ar*gn;if(Math.abs(Hs)>Number.EPSILON){const Gn=Math.sqrt(aa),et=Math.sqrt(gn*gn+Hr*Hr),De=pi.x-Ar/Gn,kt=pi.y+$i/Gn,ci=$t.x-Hr/et,fi=$t.y+gn/et,si=((ci-De)*Hr-(fi-kt)*gn)/($i*Hr-Ar*gn);Zi=De+$i*si-tt.x,ai=kt+Ar*si-tt.y;const Mr=Zi*Zi+ai*ai;if(Mr<=2)return new ni(Zi,ai);er=Math.sqrt(Mr/2)}else{let Gn=!1;$i>Number.EPSILON?gn>Number.EPSILON&&(Gn=!0):$i<-Number.EPSILON?gn<-Number.EPSILON&&(Gn=!0):Math.sign(Ar)===Math.sign(Hr)&&(Gn=!0),Gn?(Zi=-Ar,ai=$i,er=Math.sqrt(aa)):(Zi=$i,ai=Ar,er=Math.sqrt(aa/2))}return new ni(Zi/er,ai/er)}const Ft=[];for(let tt=0,pi=pt.length,$t=pi-1,Zi=tt+1;tt<pi;tt++,$t++,Zi++)$t===pi&&($t=0),Zi===pi&&(Zi=0),Ft[tt]=Li(pt[tt],pt[$t],pt[Zi]);const gi=[];let Di,kr=Ft.concat();for(let tt=0,pi=rt.length;tt<pi;tt++){const $t=rt[tt];Di=[];for(let Zi=0,ai=$t.length,er=ai-1,$i=Zi+1;Zi<ai;Zi++,er++,$i++)er===ai&&(er=0),$i===ai&&($i=0),Di[Zi]=Li($t[Zi],$t[er],$t[$i]);gi.push(Di),kr=kr.concat(Di)}for(let tt=0;tt<ne;tt++){const pi=tt/ne,$t=K*Math.cos(pi*Math.PI/2),Zi=te*Math.sin(pi*Math.PI/2)+oe;for(let ai=0,er=pt.length;ai<er;ai++){const $i=Tt(pt[ai],Ft[ai],Zi);In($i.x,$i.y,-$t)}for(let ai=0,er=rt.length;ai<er;ai++){const $i=rt[ai];Di=gi[ai];for(let Ar=0,gn=$i.length;Ar<gn;Ar++){const Hr=Tt($i[Ar],Di[Ar],Zi);In(Hr.x,Hr.y,-$t)}}}const xn=te+oe;for(let tt=0;tt<Pt;tt++){const pi=q?Tt(Oe[tt],kr[tt],xn):Oe[tt];_e?(Je.copy(nt.normals[0]).multiplyScalar(pi.x),qe.copy(nt.binormals[0]).multiplyScalar(pi.y),it.copy(we[0]).add(Je).add(qe),In(it.x,it.y,it.z)):In(pi.x,pi.y,0)}for(let tt=1;tt<=z;tt++)for(let pi=0;pi<Pt;pi++){const $t=q?Tt(Oe[pi],kr[pi],xn):Oe[pi];_e?(Je.copy(nt.normals[tt]).multiplyScalar($t.x),qe.copy(nt.binormals[tt]).multiplyScalar($t.y),it.copy(we[tt]).add(Je).add(qe),In(it.x,it.y,it.z)):In($t.x,$t.y,X/z*tt)}for(let tt=ne-1;tt>=0;tt--){const pi=tt/ne,$t=K*Math.cos(pi*Math.PI/2),Zi=te*Math.sin(pi*Math.PI/2)+oe;for(let ai=0,er=pt.length;ai<er;ai++){const $i=Tt(pt[ai],Ft[ai],Zi);In($i.x,$i.y,X+$t)}for(let ai=0,er=rt.length;ai<er;ai++){const $i=rt[ai];Di=gi[ai];for(let Ar=0,gn=$i.length;Ar<gn;Ar++){const Hr=Tt($i[Ar],Di[Ar],Zi);_e?In(Hr.x,Hr.y+we[z-1].y,we[z-1].x+$t):In(Hr.x,Hr.y,X+$t)}}}es(),hs();function es(){const tt=b.length/3;if(q){let pi=0,$t=Pt*pi;for(let Zi=0;Zi<ui;Zi++){const ai=mt[Zi];wr(ai[2]+$t,ai[1]+$t,ai[0]+$t)}pi=z+ne*2,$t=Pt*pi;for(let Zi=0;Zi<ui;Zi++){const ai=mt[Zi];wr(ai[0]+$t,ai[1]+$t,ai[2]+$t)}}else{for(let pi=0;pi<ui;pi++){const $t=mt[pi];wr($t[2],$t[1],$t[0])}for(let pi=0;pi<ui;pi++){const $t=mt[pi];wr($t[0]+Pt*z,$t[1]+Pt*z,$t[2]+Pt*z)}}A.addGroup(tt,b.length/3-tt,0)}function hs(){const tt=b.length/3;let pi=0;Un(pt,pi),pi+=pt.length;for(let $t=0,Zi=rt.length;$t<Zi;$t++){const ai=rt[$t];Un(ai,pi),pi+=ai.length}A.addGroup(tt,b.length/3-tt,1)}function Un(tt,pi){let $t=tt.length;for(;--$t>=0;){const Zi=$t;let ai=$t-1;ai<0&&(ai=tt.length-1);for(let er=0,$i=z+ne*2;er<$i;er++){const Ar=Pt*er,gn=Pt*(er+1),Hr=pi+Zi+Ar,aa=pi+ai+Ar,Hs=pi+ai+gn,Gn=pi+Zi+gn;li(Hr,aa,Hs,Gn)}}}function In(tt,pi,$t){P.push(tt),P.push(pi),P.push($t)}function wr(tt,pi,$t){_i(tt),_i(pi),_i($t);const Zi=b.length/3,ai=Me.generateTopUV(A,b,Zi-3,Zi-2,Zi-1);Qi(ai[0]),Qi(ai[1]),Qi(ai[2])}function li(tt,pi,$t,Zi){_i(tt),_i(pi),_i(Zi),_i(pi),_i($t),_i(Zi);const ai=b.length/3,er=Me.generateSideWallUV(A,b,ai-6,ai-3,ai-2,ai-1);Qi(er[0]),Qi(er[1]),Qi(er[3]),Qi(er[1]),Qi(er[2]),Qi(er[3])}function _i(tt){b.push(P[tt*3+0]),b.push(P[tt*3+1]),b.push(P[tt*3+2])}function Qi(tt){E.push(tt.x),E.push(tt.y)}}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON(),h=this.parameters.shapes,A=this.parameters.options;return YSe(h,A,a)}static fromJSON(a,h){const A=[];for(let E=0,M=a.shapes.length;E<M;E++){const N=h[a.shapes[E]];A.push(N)}const b=a.options.extrudePath;return b!==void 0&&(a.options.extrudePath=new iw[b.type]().fromJSON(b)),new pw(A,a.options)}}const XSe={generateTopUV:function(C,a,h,A,b){const E=a[h*3],M=a[h*3+1],N=a[A*3],P=a[A*3+1],F=a[b*3],z=a[b*3+1];return[new ni(E,M),new ni(N,P),new ni(F,z)]},generateSideWallUV:function(C,a,h,A,b,E){const M=a[h*3],N=a[h*3+1],P=a[h*3+2],F=a[A*3],z=a[A*3+1],X=a[A*3+2],q=a[b*3],K=a[b*3+1],te=a[b*3+2],oe=a[E*3],ne=a[E*3+1],ee=a[E*3+2];return Math.abs(N-z)<Math.abs(M-F)?[new ni(M,1-P),new ni(F,1-X),new ni(q,1-te),new ni(oe,1-ee)]:[new ni(N,1-P),new ni(z,1-X),new ni(K,1-te),new ni(ne,1-ee)]}};function YSe(C,a,h){if(h.shapes=[],Array.isArray(C))for(let A=0,b=C.length;A<b;A++){const E=C[A];h.shapes.push(E.uuid)}else h.shapes.push(C.uuid);return h.options=Object.assign({},a),a.extrudePath!==void 0&&(h.options.extrudePath=a.extrudePath.toJSON()),h}class fw extends Fd{constructor(a=1,h=0){const A=(1+Math.sqrt(5))/2,b=[-1,A,0,1,A,0,-1,-A,0,1,-A,0,0,-1,A,0,1,A,0,-1,-A,0,1,-A,A,0,-1,A,0,1,-A,0,-1,-A,0,1],E=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(b,E,a,h),this.type="IcosahedronGeometry",this.parameters={radius:a,detail:h}}static fromJSON(a){return new fw(a.radius,a.detail)}}class _v extends Fd{constructor(a=1,h=0){const A=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],b=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(A,b,a,h),this.type="OctahedronGeometry",this.parameters={radius:a,detail:h}}static fromJSON(a){return new _v(a.radius,a.detail)}}class mw extends hn{constructor(a=.5,h=1,A=32,b=1,E=0,M=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:a,outerRadius:h,thetaSegments:A,phiSegments:b,thetaStart:E,thetaLength:M},A=Math.max(3,A),b=Math.max(1,b);const N=[],P=[],F=[],z=[];let X=a;const q=(h-a)/b,K=new He,te=new ni;for(let oe=0;oe<=b;oe++){for(let ne=0;ne<=A;ne++){const ee=E+ne/A*M;K.x=X*Math.cos(ee),K.y=X*Math.sin(ee),P.push(K.x,K.y,K.z),F.push(0,0,1),te.x=(K.x/h+1)/2,te.y=(K.y/h+1)/2,z.push(te.x,te.y)}X+=q}for(let oe=0;oe<b;oe++){const ne=oe*(A+1);for(let ee=0;ee<A;ee++){const Me=ee+ne,we=Me,_e=Me+A+1,nt=Me+A+2,qe=Me+1;N.push(we,_e,qe),N.push(_e,nt,qe)}}this.setIndex(N),this.setAttribute("position",new vr(P,3)),this.setAttribute("normal",new vr(F,3)),this.setAttribute("uv",new vr(z,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new mw(a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength)}}class gw extends hn{constructor(a=new mf([new ni(0,.5),new ni(-.5,-.5),new ni(.5,-.5)]),h=12){super(),this.type="ShapeGeometry",this.parameters={shapes:a,curveSegments:h};const A=[],b=[],E=[],M=[];let N=0,P=0;if(Array.isArray(a)===!1)F(a);else for(let z=0;z<a.length;z++)F(a[z]),this.addGroup(N,P,z),N+=P,P=0;this.setIndex(A),this.setAttribute("position",new vr(b,3)),this.setAttribute("normal",new vr(E,3)),this.setAttribute("uv",new vr(M,2));function F(z){const X=b.length/3,q=z.extractPoints(h);let K=q.shape;const te=q.holes;Zc.isClockWise(K)===!1&&(K=K.reverse());for(let ne=0,ee=te.length;ne<ee;ne++){const Me=te[ne];Zc.isClockWise(Me)===!0&&(te[ne]=Me.reverse())}const oe=Zc.triangulateShape(K,te);for(let ne=0,ee=te.length;ne<ee;ne++){const Me=te[ne];K=K.concat(Me)}for(let ne=0,ee=K.length;ne<ee;ne++){const Me=K[ne];b.push(Me.x,Me.y,0),E.push(0,0,1),M.push(Me.x,Me.y)}for(let ne=0,ee=oe.length;ne<ee;ne++){const Me=oe[ne],we=Me[0]+X,_e=Me[1]+X,nt=Me[2]+X;A.push(we,_e,nt),P+=3}}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON(),h=this.parameters.shapes;return KSe(h,a)}static fromJSON(a,h){const A=[];for(let b=0,E=a.shapes.length;b<E;b++){const M=h[a.shapes[b]];A.push(M)}return new gw(A,a.curveSegments)}}function KSe(C,a){if(a.shapes=[],Array.isArray(C))for(let h=0,A=C.length;h<A;h++){const b=C[h];a.shapes.push(b.uuid)}else a.shapes.push(C.uuid);return a}class Ev extends hn{constructor(a=1,h=32,A=16,b=0,E=Math.PI*2,M=0,N=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:a,widthSegments:h,heightSegments:A,phiStart:b,phiLength:E,thetaStart:M,thetaLength:N},h=Math.max(3,Math.floor(h)),A=Math.max(2,Math.floor(A));const P=Math.min(M+N,Math.PI);let F=0;const z=[],X=new He,q=new He,K=[],te=[],oe=[],ne=[];for(let ee=0;ee<=A;ee++){const Me=[],we=ee/A;let _e=0;ee===0&&M===0?_e=.5/h:ee===A&&P===Math.PI&&(_e=-.5/h);for(let nt=0;nt<=h;nt++){const qe=nt/h;X.x=-a*Math.cos(b+qe*E)*Math.sin(M+we*N),X.y=a*Math.cos(M+we*N),X.z=a*Math.sin(b+qe*E)*Math.sin(M+we*N),te.push(X.x,X.y,X.z),q.copy(X).normalize(),oe.push(q.x,q.y,q.z),ne.push(qe+_e,1-we),Me.push(F++)}z.push(Me)}for(let ee=0;ee<A;ee++)for(let Me=0;Me<h;Me++){const we=z[ee][Me+1],_e=z[ee][Me],nt=z[ee+1][Me],qe=z[ee+1][Me+1];(ee!==0||M>0)&&K.push(we,_e,qe),(ee!==A-1||P<Math.PI)&&K.push(_e,nt,qe)}this.setIndex(K),this.setAttribute("position",new vr(te,3)),this.setAttribute("normal",new vr(oe,3)),this.setAttribute("uv",new vr(ne,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Ev(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength)}}class Aw extends Fd{constructor(a=1,h=0){const A=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],b=[2,1,0,0,3,2,1,3,0,2,3,1];super(A,b,a,h),this.type="TetrahedronGeometry",this.parameters={radius:a,detail:h}}static fromJSON(a){return new Aw(a.radius,a.detail)}}class yw extends hn{constructor(a=1,h=.4,A=12,b=48,E=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:a,tube:h,radialSegments:A,tubularSegments:b,arc:E},A=Math.floor(A),b=Math.floor(b);const M=[],N=[],P=[],F=[],z=new He,X=new He,q=new He;for(let K=0;K<=A;K++)for(let te=0;te<=b;te++){const oe=te/b*E,ne=K/A*Math.PI*2;X.x=(a+h*Math.cos(ne))*Math.cos(oe),X.y=(a+h*Math.cos(ne))*Math.sin(oe),X.z=h*Math.sin(ne),N.push(X.x,X.y,X.z),z.x=a*Math.cos(oe),z.y=a*Math.sin(oe),q.subVectors(X,z).normalize(),P.push(q.x,q.y,q.z),F.push(te/b),F.push(K/A)}for(let K=1;K<=A;K++)for(let te=1;te<=b;te++){const oe=(b+1)*K+te-1,ne=(b+1)*(K-1)+te-1,ee=(b+1)*(K-1)+te,Me=(b+1)*K+te;M.push(oe,ne,Me),M.push(ne,ee,Me)}this.setIndex(M),this.setAttribute("position",new vr(N,3)),this.setAttribute("normal",new vr(P,3)),this.setAttribute("uv",new vr(F,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new yw(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc)}}class vw extends hn{constructor(a=1,h=.4,A=64,b=8,E=2,M=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:a,tube:h,tubularSegments:A,radialSegments:b,p:E,q:M},A=Math.floor(A),b=Math.floor(b);const N=[],P=[],F=[],z=[],X=new He,q=new He,K=new He,te=new He,oe=new He,ne=new He,ee=new He;for(let we=0;we<=A;++we){const _e=we/A*E*Math.PI*2;Me(_e,E,M,a,K),Me(_e+.01,E,M,a,te),ne.subVectors(te,K),ee.addVectors(te,K),oe.crossVectors(ne,ee),ee.crossVectors(oe,ne),oe.normalize(),ee.normalize();for(let nt=0;nt<=b;++nt){const qe=nt/b*Math.PI*2,Je=-h*Math.cos(qe),it=h*Math.sin(qe);X.x=K.x+(Je*ee.x+it*oe.x),X.y=K.y+(Je*ee.y+it*oe.y),X.z=K.z+(Je*ee.z+it*oe.z),P.push(X.x,X.y,X.z),q.subVectors(X,K).normalize(),F.push(q.x,q.y,q.z),z.push(we/A),z.push(nt/b)}}for(let we=1;we<=A;we++)for(let _e=1;_e<=b;_e++){const nt=(b+1)*(we-1)+(_e-1),qe=(b+1)*we+(_e-1),Je=(b+1)*we+_e,it=(b+1)*(we-1)+_e;N.push(nt,qe,it),N.push(qe,Je,it)}this.setIndex(N),this.setAttribute("position",new vr(P,3)),this.setAttribute("normal",new vr(F,3)),this.setAttribute("uv",new vr(z,2));function Me(we,_e,nt,qe,Je){const it=Math.cos(we),ze=Math.sin(we),Oe=nt/_e*we,rt=Math.cos(Oe);Je.x=qe*(2+rt)*.5*it,Je.y=qe*(2+rt)*ze*.5,Je.z=qe*Math.sin(Oe)*.5}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new vw(a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q)}}class xw extends hn{constructor(a=new sN(new He(-1,-1,0),new He(-1,1,0),new He(1,1,0)),h=64,A=1,b=8,E=!1){super(),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:h,radius:A,radialSegments:b,closed:E};const M=a.computeFrenetFrames(h,E);this.tangents=M.tangents,this.normals=M.normals,this.binormals=M.binormals;const N=new He,P=new He,F=new ni;let z=new He;const X=[],q=[],K=[],te=[];oe(),this.setIndex(te),this.setAttribute("position",new vr(X,3)),this.setAttribute("normal",new vr(q,3)),this.setAttribute("uv",new vr(K,2));function oe(){for(let we=0;we<h;we++)ne(we);ne(E===!1?h:0),Me(),ee()}function ne(we){z=a.getPointAt(we/h,z);const _e=M.normals[we],nt=M.binormals[we];for(let qe=0;qe<=b;qe++){const Je=qe/b*Math.PI*2,it=Math.sin(Je),ze=-Math.cos(Je);P.x=ze*_e.x+it*nt.x,P.y=ze*_e.y+it*nt.y,P.z=ze*_e.z+it*nt.z,P.normalize(),q.push(P.x,P.y,P.z),N.x=z.x+A*P.x,N.y=z.y+A*P.y,N.z=z.z+A*P.z,X.push(N.x,N.y,N.z)}}function ee(){for(let we=1;we<=h;we++)for(let _e=1;_e<=b;_e++){const nt=(b+1)*(we-1)+(_e-1),qe=(b+1)*we+(_e-1),Je=(b+1)*we+_e,it=(b+1)*(we-1)+_e;te.push(nt,qe,it),te.push(qe,Je,it)}}function Me(){for(let we=0;we<=h;we++)for(let _e=0;_e<=b;_e++)F.x=we/h,F.y=_e/b,K.push(F.x,F.y)}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON();return a.path=this.parameters.path.toJSON(),a}static fromJSON(a){return new xw(new iw[a.path.type]().fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed)}}class Wj extends hn{constructor(a=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:a},a!==null){const h=[],A=new Set,b=new He,E=new He;if(a.index!==null){const M=a.attributes.position,N=a.index;let P=a.groups;P.length===0&&(P=[{start:0,count:N.count,materialIndex:0}]);for(let F=0,z=P.length;F<z;++F){const X=P[F],q=X.start,K=X.count;for(let te=q,oe=q+K;te<oe;te+=3)for(let ne=0;ne<3;ne++){const ee=N.getX(te+ne),Me=N.getX(te+(ne+1)%3);b.fromBufferAttribute(M,ee),E.fromBufferAttribute(M,Me),Qj(b,E,A)===!0&&(h.push(b.x,b.y,b.z),h.push(E.x,E.y,E.z))}}}else{const M=a.attributes.position;for(let N=0,P=M.count/3;N<P;N++)for(let F=0;F<3;F++){const z=3*N+F,X=3*N+(F+1)%3;b.fromBufferAttribute(M,z),E.fromBufferAttribute(M,X),Qj(b,E,A)===!0&&(h.push(b.x,b.y,b.z),h.push(E.x,E.y,E.z))}}this.setAttribute("position",new vr(h,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}function Qj(C,a,h){const A=`${C.x},${C.y},${C.z}-${a.x},${a.y},${a.z}`,b=`${a.x},${a.y},${a.z}-${C.x},${C.y},${C.z}`;return h.has(A)===!0||h.has(b)===!0?!1:(h.add(A),h.add(b),!0)}var qj=Object.freeze({__proto__:null,BoxGeometry:af,CapsuleGeometry:rw,CircleGeometry:nw,ConeGeometry:sw,CylinderGeometry:y0,DodecahedronGeometry:aw,EdgesGeometry:kj,ExtrudeGeometry:pw,IcosahedronGeometry:fw,LatheGeometry:yv,OctahedronGeometry:_v,PlaneGeometry:o0,PolyhedronGeometry:Fd,RingGeometry:mw,ShapeGeometry:gw,SphereGeometry:Ev,TetrahedronGeometry:Aw,TorusGeometry:yw,TorusKnotGeometry:vw,TubeGeometry:xw,WireframeGeometry:Wj});class Xj extends so{constructor(a){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new or(0),this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.fog=a.fog,this}}class Yj extends Cc{constructor(a){super(a),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class uN extends so{constructor(a){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new or(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=io,this.normalScale=new ni(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new xl,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={STANDARD:""},this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.envMapIntensity=a.envMapIntensity,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class Kj extends uN{constructor(a){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ni(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ws(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(h){this.ior=(1+.4*h)/(1-.4*h)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new or(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new or(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new or(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(a)}get anisotropy(){return this._anisotropy}set anisotropy(a){this._anisotropy>0!=a>0&&this.version++,this._anisotropy=a}get clearcoat(){return this._clearcoat}set clearcoat(a){this._clearcoat>0!=a>0&&this.version++,this._clearcoat=a}get iridescence(){return this._iridescence}set iridescence(a){this._iridescence>0!=a>0&&this.version++,this._iridescence=a}get dispersion(){return this._dispersion}set dispersion(a){this._dispersion>0!=a>0&&this.version++,this._dispersion=a}get sheen(){return this._sheen}set sheen(a){this._sheen>0!=a>0&&this.version++,this._sheen=a}get transmission(){return this._transmission}set transmission(a){this._transmission>0!=a>0&&this.version++,this._transmission=a}copy(a){return super.copy(a),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=a.anisotropy,this.anisotropyRotation=a.anisotropyRotation,this.anisotropyMap=a.anisotropyMap,this.clearcoat=a.clearcoat,this.clearcoatMap=a.clearcoatMap,this.clearcoatRoughness=a.clearcoatRoughness,this.clearcoatRoughnessMap=a.clearcoatRoughnessMap,this.clearcoatNormalMap=a.clearcoatNormalMap,this.clearcoatNormalScale.copy(a.clearcoatNormalScale),this.dispersion=a.dispersion,this.ior=a.ior,this.iridescence=a.iridescence,this.iridescenceMap=a.iridescenceMap,this.iridescenceIOR=a.iridescenceIOR,this.iridescenceThicknessRange=[...a.iridescenceThicknessRange],this.iridescenceThicknessMap=a.iridescenceThicknessMap,this.sheen=a.sheen,this.sheenColor.copy(a.sheenColor),this.sheenColorMap=a.sheenColorMap,this.sheenRoughness=a.sheenRoughness,this.sheenRoughnessMap=a.sheenRoughnessMap,this.transmission=a.transmission,this.transmissionMap=a.transmissionMap,this.thickness=a.thickness,this.thicknessMap=a.thicknessMap,this.attenuationDistance=a.attenuationDistance,this.attenuationColor.copy(a.attenuationColor),this.specularIntensity=a.specularIntensity,this.specularIntensityMap=a.specularIntensityMap,this.specularColor.copy(a.specularColor),this.specularColorMap=a.specularColorMap,this}}class Jj extends so{constructor(a){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new or(16777215),this.specular=new or(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=io,this.normalScale=new ni(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new xl,this.combine=Qe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class Zj extends so{constructor(a){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new or(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=io,this.normalScale=new ni(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.gradientMap=a.gradientMap,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}class $j extends so{constructor(a){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=io,this.normalScale=new ni(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(a)}copy(a){return super.copy(a),this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.flatShading=a.flatShading,this}}class eV extends so{constructor(a){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new or(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=io,this.normalScale=new ni(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new xl,this.combine=Qe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class tV extends so{constructor(a){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new or(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=io,this.normalScale=new ni(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={MATCAP:""},this.color.copy(a.color),this.matcap=a.matcap,this.map=a.map,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.flatShading=a.flatShading,this.fog=a.fog,this}}class iV extends Mo{constructor(a){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(a)}copy(a){return super.copy(a),this.scale=a.scale,this.dashSize=a.dashSize,this.gapSize=a.gapSize,this}}function Af(C,a,h){return!C||!h&&C.constructor===a?C:typeof a.BYTES_PER_ELEMENT=="number"?new a(C):Array.prototype.slice.call(C)}function rV(C){return ArrayBuffer.isView(C)&&!(C instanceof DataView)}function nV(C){function a(b,E){return C[b]-C[E]}const h=C.length,A=new Array(h);for(let b=0;b!==h;++b)A[b]=b;return A.sort(a),A}function hN(C,a,h){const A=C.length,b=new C.constructor(A);for(let E=0,M=0;M!==A;++E){const N=h[E]*a;for(let P=0;P!==a;++P)b[M++]=C[N+P]}return b}function dN(C,a,h,A){let b=1,E=C[0];for(;E!==void 0&&E[A]===void 0;)E=C[b++];if(E===void 0)return;let M=E[A];if(M!==void 0)if(Array.isArray(M))do M=E[A],M!==void 0&&(a.push(E.time),h.push.apply(h,M)),E=C[b++];while(E!==void 0);else if(M.toArray!==void 0)do M=E[A],M!==void 0&&(a.push(E.time),M.toArray(h,h.length)),E=C[b++];while(E!==void 0);else do M=E[A],M!==void 0&&(a.push(E.time),h.push(M)),E=C[b++];while(E!==void 0)}function JSe(C,a,h,A,b=30){const E=C.clone();E.name=a;const M=[];for(let P=0;P<E.tracks.length;++P){const F=E.tracks[P],z=F.getValueSize(),X=[],q=[];for(let K=0;K<F.times.length;++K){const te=F.times[K]*b;if(!(te<h||te>=A)){X.push(F.times[K]);for(let oe=0;oe<z;++oe)q.push(F.values[K*z+oe])}}X.length!==0&&(F.times=Af(X,F.times.constructor),F.values=Af(q,F.values.constructor),M.push(F))}E.tracks=M;let N=1/0;for(let P=0;P<E.tracks.length;++P)N>E.tracks[P].times[0]&&(N=E.tracks[P].times[0]);for(let P=0;P<E.tracks.length;++P)E.tracks[P].shift(-1*N);return E.resetDuration(),E}function ZSe(C,a=0,h=C,A=30){A<=0&&(A=30);const b=h.tracks.length,E=a/A;for(let M=0;M<b;++M){const N=h.tracks[M],P=N.ValueTypeName;if(P==="bool"||P==="string")continue;const F=C.tracks.find(function(ee){return ee.name===N.name&&ee.ValueTypeName===P});if(F===void 0)continue;let z=0;const X=N.getValueSize();N.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(z=X/3);let q=0;const K=F.getValueSize();F.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(q=K/3);const te=N.times.length-1;let oe;if(E<=N.times[0]){const ee=z,Me=X-z;oe=N.values.slice(ee,Me)}else if(E>=N.times[te]){const ee=te*X+z,Me=ee+X-z;oe=N.values.slice(ee,Me)}else{const ee=N.createInterpolant(),Me=z,we=X-z;ee.evaluate(E),oe=ee.resultBuffer.slice(Me,we)}P==="quaternion"&&new jn().fromArray(oe).normalize().conjugate().toArray(oe);const ne=F.times.length;for(let ee=0;ee<ne;++ee){const Me=ee*K+q;if(P==="quaternion")jn.multiplyQuaternionsFlat(F.values,Me,oe,0,F.values,Me);else{const we=K-q*2;for(let _e=0;_e<we;++_e)F.values[Me+_e]-=oe[_e]}}}return C.blendMode=Lr,C}const $Se={convertArray:Af,isTypedArray:rV,getKeyframeOrder:nV,sortedArray:hN,flattenJSON:dN,subclip:JSe,makeClipAdditive:ZSe};class wv{constructor(a,h,A,b){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=b!==void 0?b:new h.constructor(A),this.sampleValues=h,this.valueSize=A,this.settings=null,this.DefaultSettings_={}}evaluate(a){const h=this.parameterPositions;let A=this._cachedIndex,b=h[A],E=h[A-1];i:{e:{let M;t:{r:if(!(a<b)){for(let N=A+2;;){if(b===void 0){if(a<E)break r;return A=h.length,this._cachedIndex=A,this.copySampleValue_(A-1)}if(A===N)break;if(E=b,b=h[++A],a<b)break e}M=h.length;break t}if(!(a>=E)){const N=h[1];a<N&&(A=2,E=N);for(let P=A-2;;){if(E===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(A===P)break;if(b=E,E=h[--A-1],a>=E)break e}M=A,A=0;break t}break i}for(;A<M;){const N=A+M>>>1;a<h[N]?M=N:A=N+1}if(b=h[A],E=h[A-1],E===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(b===void 0)return A=h.length,this._cachedIndex=A,this.copySampleValue_(A-1)}this._cachedIndex=A,this.intervalChanged_(A,E,b)}return this.interpolate_(A,E,a,b)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(a){const h=this.resultBuffer,A=this.sampleValues,b=this.valueSize,E=a*b;for(let M=0;M!==b;++M)h[M]=A[E+M];return h}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class sV extends wv{constructor(a,h,A,b){super(a,h,A,b),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:jr,endingEnd:jr}}intervalChanged_(a,h,A){const b=this.parameterPositions;let E=a-2,M=a+1,N=b[E],P=b[M];if(N===void 0)switch(this.getSettings_().endingStart){case vn:E=a,N=2*h-A;break;case zr:E=b.length-2,N=h+b[E]-b[E+1];break;default:E=a,N=A}if(P===void 0)switch(this.getSettings_().endingEnd){case vn:M=a,P=2*A-h;break;case zr:M=1,P=A+b[1]-b[0];break;default:M=a-1,P=h}const F=(A-h)*.5,z=this.valueSize;this._weightPrev=F/(h-N),this._weightNext=F/(P-A),this._offsetPrev=E*z,this._offsetNext=M*z}interpolate_(a,h,A,b){const E=this.resultBuffer,M=this.sampleValues,N=this.valueSize,P=a*N,F=P-N,z=this._offsetPrev,X=this._offsetNext,q=this._weightPrev,K=this._weightNext,te=(A-h)/(b-h),oe=te*te,ne=oe*te,ee=-q*ne+2*q*oe-q*te,Me=(1+q)*ne+(-1.5-2*q)*oe+(-.5+q)*te+1,we=(-1-K)*ne+(1.5+K)*oe+.5*te,_e=K*ne-K*oe;for(let nt=0;nt!==N;++nt)E[nt]=ee*M[z+nt]+Me*M[F+nt]+we*M[P+nt]+_e*M[X+nt];return E}}class pN extends wv{constructor(a,h,A,b){super(a,h,A,b)}interpolate_(a,h,A,b){const E=this.resultBuffer,M=this.sampleValues,N=this.valueSize,P=a*N,F=P-N,z=(A-h)/(b-h),X=1-z;for(let q=0;q!==N;++q)E[q]=M[F+q]*X+M[P+q]*z;return E}}class aV extends wv{constructor(a,h,A,b){super(a,h,A,b)}interpolate_(a){return this.copySampleValue_(a-1)}}class Mc{constructor(a,h,A,b){if(a===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(h===void 0||h.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a,this.times=Af(h,this.TimeBufferType),this.values=Af(A,this.ValueBufferType),this.setInterpolation(b||this.DefaultInterpolation)}static toJSON(a){const h=a.constructor;let A;if(h.toJSON!==this.toJSON)A=h.toJSON(a);else{A={name:a.name,times:Af(a.times,Array),values:Af(a.values,Array)};const b=a.getInterpolation();b!==a.DefaultInterpolation&&(A.interpolation=b)}return A.type=a.ValueTypeName,A}InterpolantFactoryMethodDiscrete(a){return new aV(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodLinear(a){return new pN(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodSmooth(a){return new sV(this.times,this.values,this.getValueSize(),a)}setInterpolation(a){let h;switch(a){case Er:h=this.InterpolantFactoryMethodDiscrete;break;case Sr:h=this.InterpolantFactoryMethodLinear;break;case Fr:h=this.InterpolantFactoryMethodSmooth;break}if(h===void 0){const A="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(A);return console.warn("THREE.KeyframeTrack:",A),this}return this.createInterpolant=h,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Er;case this.InterpolantFactoryMethodLinear:return Sr;case this.InterpolantFactoryMethodSmooth:return Fr}}getValueSize(){return this.values.length/this.times.length}shift(a){if(a!==0){const h=this.times;for(let A=0,b=h.length;A!==b;++A)h[A]+=a}return this}scale(a){if(a!==1){const h=this.times;for(let A=0,b=h.length;A!==b;++A)h[A]*=a}return this}trim(a,h){const A=this.times,b=A.length;let E=0,M=b-1;for(;E!==b&&A[E]<a;)++E;for(;M!==-1&&A[M]>h;)--M;if(++M,E!==0||M!==b){E>=M&&(M=Math.max(M,1),E=M-1);const N=this.getValueSize();this.times=A.slice(E,M),this.values=this.values.slice(E*N,M*N)}return this}validate(){let a=!0;const h=this.getValueSize();h-Math.floor(h)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);const A=this.times,b=this.values,E=A.length;E===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),a=!1);let M=null;for(let N=0;N!==E;N++){const P=A[N];if(typeof P=="number"&&isNaN(P)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,N,P),a=!1;break}if(M!==null&&M>P){console.error("THREE.KeyframeTrack: Out of order keys.",this,N,P,M),a=!1;break}M=P}if(b!==void 0&&rV(b))for(let N=0,P=b.length;N!==P;++N){const F=b[N];if(isNaN(F)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,N,F),a=!1;break}}return a}optimize(){const a=this.times.slice(),h=this.values.slice(),A=this.getValueSize(),b=this.getInterpolation()===Fr,E=a.length-1;let M=1;for(let N=1;N<E;++N){let P=!1;const F=a[N],z=a[N+1];if(F!==z&&(N!==1||F!==a[0]))if(b)P=!0;else{const X=N*A,q=X-A,K=X+A;for(let te=0;te!==A;++te){const oe=h[X+te];if(oe!==h[q+te]||oe!==h[K+te]){P=!0;break}}}if(P){if(N!==M){a[M]=a[N];const X=N*A,q=M*A;for(let K=0;K!==A;++K)h[q+K]=h[X+K]}++M}}if(E>0){a[M]=a[E];for(let N=E*A,P=M*A,F=0;F!==A;++F)h[P+F]=h[N+F];++M}return M!==a.length?(this.times=a.slice(0,M),this.values=h.slice(0,M*A)):(this.times=a,this.values=h),this}clone(){const a=this.times.slice(),h=this.values.slice(),A=this.constructor,b=new A(this.name,a,h);return b.createInterpolant=this.createInterpolant,b}}Mc.prototype.TimeBufferType=Float32Array,Mc.prototype.ValueBufferType=Float32Array,Mc.prototype.DefaultInterpolation=Sr;class yf extends Mc{}yf.prototype.ValueTypeName="bool",yf.prototype.ValueBufferType=Array,yf.prototype.DefaultInterpolation=Er,yf.prototype.InterpolantFactoryMethodLinear=void 0,yf.prototype.InterpolantFactoryMethodSmooth=void 0;class fN extends Mc{}fN.prototype.ValueTypeName="color";class Cv extends Mc{}Cv.prototype.ValueTypeName="number";class oV extends wv{constructor(a,h,A,b){super(a,h,A,b)}interpolate_(a,h,A,b){const E=this.resultBuffer,M=this.sampleValues,N=this.valueSize,P=(A-h)/(b-h);let F=a*N;for(let z=F+N;F!==z;F+=4)jn.slerpFlat(E,0,M,F-N,M,F,P);return E}}class x0 extends Mc{InterpolantFactoryMethodLinear(a){return new oV(this.times,this.values,this.getValueSize(),a)}}x0.prototype.ValueTypeName="quaternion",x0.prototype.DefaultInterpolation=Sr,x0.prototype.InterpolantFactoryMethodSmooth=void 0;class vf extends Mc{}vf.prototype.ValueTypeName="string",vf.prototype.ValueBufferType=Array,vf.prototype.DefaultInterpolation=Er,vf.prototype.InterpolantFactoryMethodLinear=void 0,vf.prototype.InterpolantFactoryMethodSmooth=void 0;class Sv extends Mc{}Sv.prototype.ValueTypeName="vector";class Tv{constructor(a="",h=-1,A=[],b=cs){this.name=a,this.tracks=A,this.duration=h,this.blendMode=b,this.uuid=wo(),this.duration<0&&this.resetDuration()}static parse(a){const h=[],A=a.tracks,b=1/(a.fps||1);for(let M=0,N=A.length;M!==N;++M)h.push(tTe(A[M]).scale(b));const E=new this(a.name,a.duration,h,a.blendMode);return E.uuid=a.uuid,E}static toJSON(a){const h=[],A=a.tracks,b={name:a.name,duration:a.duration,tracks:h,uuid:a.uuid,blendMode:a.blendMode};for(let E=0,M=A.length;E!==M;++E)h.push(Mc.toJSON(A[E]));return b}static CreateFromMorphTargetSequence(a,h,A,b){const E=h.length,M=[];for(let N=0;N<E;N++){let P=[],F=[];P.push((N+E-1)%E,N,(N+1)%E),F.push(0,1,0);const z=nV(P);P=hN(P,1,z),F=hN(F,1,z),!b&&P[0]===0&&(P.push(E),F.push(F[0])),M.push(new Cv(".morphTargetInfluences["+h[N].name+"]",P,F).scale(1/A))}return new this(a,-1,M)}static findByName(a,h){let A=a;if(!Array.isArray(a)){const b=a;A=b.geometry&&b.geometry.animations||b.animations}for(let b=0;b<A.length;b++)if(A[b].name===h)return A[b];return null}static CreateClipsFromMorphTargetSequences(a,h,A){const b={},E=/^([\w-]*?)([\d]+)$/;for(let N=0,P=a.length;N<P;N++){const F=a[N],z=F.name.match(E);if(z&&z.length>1){const X=z[1];let q=b[X];q||(b[X]=q=[]),q.push(F)}}const M=[];for(const N in b)M.push(this.CreateFromMorphTargetSequence(N,b[N],h,A));return M}static parseAnimation(a,h){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const A=function(z,X,q,K,te){if(q.length!==0){const oe=[],ne=[];dN(q,oe,ne,K),oe.length!==0&&te.push(new z(X,oe,ne))}},b=[],E=a.name||"default",M=a.fps||30,N=a.blendMode;let P=a.length||-1;const F=a.hierarchy||[];for(let z=0;z<F.length;z++){const X=F[z].keys;if(!(!X||X.length===0))if(X[0].morphTargets){const q={};let K;for(K=0;K<X.length;K++)if(X[K].morphTargets)for(let te=0;te<X[K].morphTargets.length;te++)q[X[K].morphTargets[te]]=-1;for(const te in q){const oe=[],ne=[];for(let ee=0;ee!==X[K].morphTargets.length;++ee){const Me=X[K];oe.push(Me.time),ne.push(Me.morphTarget===te?1:0)}b.push(new Cv(".morphTargetInfluence["+te+"]",oe,ne))}P=q.length*M}else{const q=".bones["+h[z].name+"]";A(Sv,q+".position",X,"pos",b),A(x0,q+".quaternion",X,"rot",b),A(Sv,q+".scale",X,"scl",b)}}return b.length===0?null:new this(E,P,b,N)}resetDuration(){const a=this.tracks;let h=0;for(let A=0,b=a.length;A!==b;++A){const E=this.tracks[A];h=Math.max(h,E.times[E.times.length-1])}return this.duration=h,this}trim(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this}validate(){let a=!0;for(let h=0;h<this.tracks.length;h++)a=a&&this.tracks[h].validate();return a}optimize(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}clone(){const a=[];for(let h=0;h<this.tracks.length;h++)a.push(this.tracks[h].clone());return new this.constructor(this.name,this.duration,a,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function eTe(C){switch(C.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Cv;case"vector":case"vector2":case"vector3":case"vector4":return Sv;case"color":return fN;case"quaternion":return x0;case"bool":case"boolean":return yf;case"string":return vf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+C)}function tTe(C){if(C.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const a=eTe(C.type);if(C.times===void 0){const h=[],A=[];dN(C.keys,h,A,"value"),C.times=h,C.values=A}return a.parse!==void 0?a.parse(C):new a(C.name,C.times,C.values,C.interpolation)}const yh={enabled:!1,files:{},add:function(C,a){this.enabled!==!1&&(this.files[C]=a)},get:function(C){if(this.enabled!==!1)return this.files[C]},remove:function(C){delete this.files[C]},clear:function(){this.files={}}};class mN{constructor(a,h,A){const b=this;let E=!1,M=0,N=0,P;const F=[];this.onStart=void 0,this.onLoad=a,this.onProgress=h,this.onError=A,this.itemStart=function(z){N++,E===!1&&b.onStart!==void 0&&b.onStart(z,M,N),E=!0},this.itemEnd=function(z){M++,b.onProgress!==void 0&&b.onProgress(z,M,N),M===N&&(E=!1,b.onLoad!==void 0&&b.onLoad())},this.itemError=function(z){b.onError!==void 0&&b.onError(z)},this.resolveURL=function(z){return P?P(z):z},this.setURLModifier=function(z){return P=z,this},this.addHandler=function(z,X){return F.push(z,X),this},this.removeHandler=function(z){const X=F.indexOf(z);return X!==-1&&F.splice(X,2),this},this.getHandler=function(z){for(let X=0,q=F.length;X<q;X+=2){const K=F[X],te=F[X+1];if(K.global&&(K.lastIndex=0),K.test(z))return te}return null}}}const lV=new mN;class Zo{constructor(a){this.manager=a!==void 0?a:lV,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(a,h){const A=this;return new Promise(function(b,E){A.load(a,b,h,E)})}parse(){}setCrossOrigin(a){return this.crossOrigin=a,this}setWithCredentials(a){return this.withCredentials=a,this}setPath(a){return this.path=a,this}setResourcePath(a){return this.resourcePath=a,this}setRequestHeader(a){return this.requestHeader=a,this}}Zo.DEFAULT_MATERIAL_NAME="__DEFAULT";const vh={};class iTe extends Error{constructor(a,h){super(a),this.response=h}}class xh extends Zo{constructor(a){super(a)}load(a,h,A,b){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const E=yh.get(a);if(E!==void 0)return this.manager.itemStart(a),setTimeout(()=>{h&&h(E),this.manager.itemEnd(a)},0),E;if(vh[a]!==void 0){vh[a].push({onLoad:h,onProgress:A,onError:b});return}vh[a]=[],vh[a].push({onLoad:h,onProgress:A,onError:b});const M=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),N=this.mimeType,P=this.responseType;fetch(M).then(F=>{if(F.status===200||F.status===0){if(F.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||F.body===void 0||F.body.getReader===void 0)return F;const z=vh[a],X=F.body.getReader(),q=F.headers.get("X-File-Size")||F.headers.get("Content-Length"),K=q?parseInt(q):0,te=K!==0;let oe=0;const ne=new ReadableStream({start(ee){Me();function Me(){X.read().then(({done:we,value:_e})=>{if(we)ee.close();else{oe+=_e.byteLength;const nt=new ProgressEvent("progress",{lengthComputable:te,loaded:oe,total:K});for(let qe=0,Je=z.length;qe<Je;qe++){const it=z[qe];it.onProgress&&it.onProgress(nt)}ee.enqueue(_e),Me()}})}}});return new Response(ne)}else throw new iTe(`fetch for "${F.url}" responded with ${F.status}: ${F.statusText}`,F)}).then(F=>{switch(P){case"arraybuffer":return F.arrayBuffer();case"blob":return F.blob();case"document":return F.text().then(z=>new DOMParser().parseFromString(z,N));case"json":return F.json();default:if(N===void 0)return F.text();{const z=/charset="?([^;"\s]*)"?/i.exec(N),X=z&&z[1]?z[1].toLowerCase():void 0,q=new TextDecoder(X);return F.arrayBuffer().then(K=>q.decode(K))}}}).then(F=>{yh.add(a,F);const z=vh[a];delete vh[a];for(let X=0,q=z.length;X<q;X++){const K=z[X];K.onLoad&&K.onLoad(F)}}).catch(F=>{const z=vh[a];if(z===void 0)throw this.manager.itemError(a),F;delete vh[a];for(let X=0,q=z.length;X<q;X++){const K=z[X];K.onError&&K.onError(F)}this.manager.itemError(a)}).finally(()=>{this.manager.itemEnd(a)}),this.manager.itemStart(a)}setResponseType(a){return this.responseType=a,this}setMimeType(a){return this.mimeType=a,this}}class rTe extends Zo{constructor(a){super(a)}load(a,h,A,b){const E=this,M=new xh(this.manager);M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(a,function(N){try{h(E.parse(JSON.parse(N)))}catch(P){b?b(P):console.error(P),E.manager.itemError(a)}},A,b)}parse(a){const h=[];for(let A=0;A<a.length;A++){const b=Tv.parse(a[A]);h.push(b)}return h}}class nTe extends Zo{constructor(a){super(a)}load(a,h,A,b){const E=this,M=[],N=new $E,P=new xh(this.manager);P.setPath(this.path),P.setResponseType("arraybuffer"),P.setRequestHeader(this.requestHeader),P.setWithCredentials(E.withCredentials);let F=0;function z(X){P.load(a[X],function(q){const K=E.parse(q,!0);M[X]={width:K.width,height:K.height,format:K.format,mipmaps:K.mipmaps},F+=1,F===6&&(K.mipmapCount===1&&(N.minFilter=Pi),N.image=M,N.format=K.format,N.needsUpdate=!0,h&&h(N))},A,b)}if(Array.isArray(a))for(let X=0,q=a.length;X<q;++X)z(X);else P.load(a,function(X){const q=E.parse(X,!0);if(q.isCubemap){const K=q.mipmaps.length/q.mipmapCount;for(let te=0;te<K;te++){M[te]={mipmaps:[]};for(let oe=0;oe<q.mipmapCount;oe++)M[te].mipmaps.push(q.mipmaps[te*q.mipmapCount+oe]),M[te].format=q.format,M[te].width=q.width,M[te].height=q.height}N.image=M}else N.image.width=q.width,N.image.height=q.height,N.mipmaps=q.mipmaps;q.mipmapCount===1&&(N.minFilter=Pi),N.format=q.format,N.needsUpdate=!0,h&&h(N)},A,b);return N}}class Mv extends Zo{constructor(a){super(a)}load(a,h,A,b){this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const E=this,M=yh.get(a);if(M!==void 0)return E.manager.itemStart(a),setTimeout(function(){h&&h(M),E.manager.itemEnd(a)},0),M;const N=nf("img");function P(){z(),yh.add(a,this),h&&h(this),E.manager.itemEnd(a)}function F(X){z(),b&&b(X),E.manager.itemError(a),E.manager.itemEnd(a)}function z(){N.removeEventListener("load",P,!1),N.removeEventListener("error",F,!1)}return N.addEventListener("load",P,!1),N.addEventListener("error",F,!1),a.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(N.crossOrigin=this.crossOrigin),E.manager.itemStart(a),N.src=a,N}}class sTe extends Zo{constructor(a){super(a)}load(a,h,A,b){const E=new sv;E.colorSpace=Ln;const M=new Mv(this.manager);M.setCrossOrigin(this.crossOrigin),M.setPath(this.path);let N=0;function P(F){M.load(a[F],function(z){E.images[F]=z,N++,N===6&&(E.needsUpdate=!0,h&&h(E))},void 0,b)}for(let F=0;F<a.length;++F)P(F);return E}}class aTe extends Zo{constructor(a){super(a)}load(a,h,A,b){const E=this,M=new Dd,N=new xh(this.manager);return N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(E.withCredentials),N.load(a,function(P){let F;try{F=E.parse(P)}catch(z){if(b!==void 0)b(z);else{console.error(z);return}}F.image!==void 0?M.image=F.image:F.data!==void 0&&(M.image.width=F.width,M.image.height=F.height,M.image.data=F.data),M.wrapS=F.wrapS!==void 0?F.wrapS:je,M.wrapT=F.wrapT!==void 0?F.wrapT:je,M.magFilter=F.magFilter!==void 0?F.magFilter:Pi,M.minFilter=F.minFilter!==void 0?F.minFilter:Pi,M.anisotropy=F.anisotropy!==void 0?F.anisotropy:1,F.colorSpace!==void 0&&(M.colorSpace=F.colorSpace),F.flipY!==void 0&&(M.flipY=F.flipY),F.format!==void 0&&(M.format=F.format),F.type!==void 0&&(M.type=F.type),F.mipmaps!==void 0&&(M.mipmaps=F.mipmaps,M.minFilter=tn),F.mipmapCount===1&&(M.minFilter=Pi),F.generateMipmaps!==void 0&&(M.generateMipmaps=F.generateMipmaps),M.needsUpdate=!0,h&&h(M,F)},A,b),M}}class oTe extends Zo{constructor(a){super(a)}load(a,h,A,b){const E=new us,M=new Mv(this.manager);return M.setCrossOrigin(this.crossOrigin),M.setPath(this.path),M.load(a,function(N){E.image=N,E.needsUpdate=!0,h!==void 0&&h(E)},A,b),E}}class kd extends Vn{constructor(a,h=1){super(),this.isLight=!0,this.type="Light",this.color=new or(a),this.intensity=h}dispose(){}copy(a,h){return super.copy(a,h),this.color.copy(a.color),this.intensity=a.intensity,this}toJSON(a){const h=super.toJSON(a);return h.object.color=this.color.getHex(),h.object.intensity=this.intensity,this.groundColor!==void 0&&(h.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(h.object.distance=this.distance),this.angle!==void 0&&(h.object.angle=this.angle),this.decay!==void 0&&(h.object.decay=this.decay),this.penumbra!==void 0&&(h.object.penumbra=this.penumbra),this.shadow!==void 0&&(h.object.shadow=this.shadow.toJSON()),h}}class cV extends kd{constructor(a,h,A){super(a,A),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Vn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new or(h)}copy(a,h){return super.copy(a,h),this.groundColor.copy(a.groundColor),this}}const gN=new fr,uV=new He,hV=new He;class AN{constructor(a){this.camera=a,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ni(512,512),this.map=null,this.mapPass=null,this.matrix=new fr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new av,this._frameExtents=new ni(1,1),this._viewportCount=1,this._viewports=[new Fn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(a){const h=this.camera,A=this.matrix;uV.setFromMatrixPosition(a.matrixWorld),h.position.copy(uV),hV.setFromMatrixPosition(a.target.matrixWorld),h.lookAt(hV),h.updateMatrixWorld(),gN.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gN),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(gN)}getViewport(a){return this._viewports[a]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(a){return this.camera=a.camera.clone(),this.bias=a.bias,this.radius=a.radius,this.mapSize.copy(a.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const a={};return this.bias!==0&&(a.bias=this.bias),this.normalBias!==0&&(a.normalBias=this.normalBias),this.radius!==1&&(a.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(a.mapSize=this.mapSize.toArray()),a.camera=this.camera.toJSON(!1).object,delete a.camera.matrix,a}}class lTe extends AN{constructor(){super(new fa(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(a){const h=this.camera,A=wd*2*a.angle*this.focus,b=this.mapSize.width/this.mapSize.height,E=a.distance||h.far;(A!==h.fov||b!==h.aspect||E!==h.far)&&(h.fov=A,h.aspect=b,h.far=E,h.updateProjectionMatrix()),super.updateMatrices(a)}copy(a){return super.copy(a),this.focus=a.focus,this}}class dV extends kd{constructor(a,h,A=0,b=Math.PI/3,E=0,M=2){super(a,h),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Vn.DEFAULT_UP),this.updateMatrix(),this.target=new Vn,this.distance=A,this.angle=b,this.penumbra=E,this.decay=M,this.map=null,this.shadow=new lTe}get power(){return this.intensity*Math.PI}set power(a){this.intensity=a/Math.PI}dispose(){this.shadow.dispose()}copy(a,h){return super.copy(a,h),this.distance=a.distance,this.angle=a.angle,this.penumbra=a.penumbra,this.decay=a.decay,this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}const pV=new fr,Rv=new He,yN=new He;class cTe extends AN{constructor(){super(new fa(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ni(4,2),this._viewportCount=6,this._viewports=[new Fn(2,1,1,1),new Fn(0,1,1,1),new Fn(3,1,1,1),new Fn(1,1,1,1),new Fn(3,0,1,1),new Fn(1,0,1,1)],this._cubeDirections=[new He(1,0,0),new He(-1,0,0),new He(0,0,1),new He(0,0,-1),new He(0,1,0),new He(0,-1,0)],this._cubeUps=[new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,0,1),new He(0,0,-1)]}updateMatrices(a,h=0){const A=this.camera,b=this.matrix,E=a.distance||A.far;E!==A.far&&(A.far=E,A.updateProjectionMatrix()),Rv.setFromMatrixPosition(a.matrixWorld),A.position.copy(Rv),yN.copy(A.position),yN.add(this._cubeDirections[h]),A.up.copy(this._cubeUps[h]),A.lookAt(yN),A.updateMatrixWorld(),b.makeTranslation(-Rv.x,-Rv.y,-Rv.z),pV.multiplyMatrices(A.projectionMatrix,A.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pV)}}class fV extends kd{constructor(a,h,A=0,b=2){super(a,h),this.isPointLight=!0,this.type="PointLight",this.distance=A,this.decay=b,this.shadow=new cTe}get power(){return this.intensity*4*Math.PI}set power(a){this.intensity=a/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(a,h){return super.copy(a,h),this.distance=a.distance,this.decay=a.decay,this.shadow=a.shadow.clone(),this}}class uTe extends AN{constructor(){super(new BE(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class mV extends kd{constructor(a,h){super(a,h),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Vn.DEFAULT_UP),this.updateMatrix(),this.target=new Vn,this.shadow=new uTe}dispose(){this.shadow.dispose()}copy(a){return super.copy(a),this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}class gV extends kd{constructor(a,h){super(a,h),this.isAmbientLight=!0,this.type="AmbientLight"}}class AV extends kd{constructor(a,h,A=10,b=10){super(a,h),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=A,this.height=b}get power(){return this.intensity*this.width*this.height*Math.PI}set power(a){this.intensity=a/(this.width*this.height*Math.PI)}copy(a){return super.copy(a),this.width=a.width,this.height=a.height,this}toJSON(a){const h=super.toJSON(a);return h.object.width=this.width,h.object.height=this.height,h}}class yV{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let a=0;a<9;a++)this.coefficients.push(new He)}set(a){for(let h=0;h<9;h++)this.coefficients[h].copy(a[h]);return this}zero(){for(let a=0;a<9;a++)this.coefficients[a].set(0,0,0);return this}getAt(a,h){const A=a.x,b=a.y,E=a.z,M=this.coefficients;return h.copy(M[0]).multiplyScalar(.282095),h.addScaledVector(M[1],.488603*b),h.addScaledVector(M[2],.488603*E),h.addScaledVector(M[3],.488603*A),h.addScaledVector(M[4],1.092548*(A*b)),h.addScaledVector(M[5],1.092548*(b*E)),h.addScaledVector(M[6],.315392*(3*E*E-1)),h.addScaledVector(M[7],1.092548*(A*E)),h.addScaledVector(M[8],.546274*(A*A-b*b)),h}getIrradianceAt(a,h){const A=a.x,b=a.y,E=a.z,M=this.coefficients;return h.copy(M[0]).multiplyScalar(.886227),h.addScaledVector(M[1],1.023328*b),h.addScaledVector(M[2],1.023328*E),h.addScaledVector(M[3],1.023328*A),h.addScaledVector(M[4],.858086*A*b),h.addScaledVector(M[5],.858086*b*E),h.addScaledVector(M[6],.743125*E*E-.247708),h.addScaledVector(M[7],.858086*A*E),h.addScaledVector(M[8],.429043*(A*A-b*b)),h}add(a){for(let h=0;h<9;h++)this.coefficients[h].add(a.coefficients[h]);return this}addScaledSH(a,h){for(let A=0;A<9;A++)this.coefficients[A].addScaledVector(a.coefficients[A],h);return this}scale(a){for(let h=0;h<9;h++)this.coefficients[h].multiplyScalar(a);return this}lerp(a,h){for(let A=0;A<9;A++)this.coefficients[A].lerp(a.coefficients[A],h);return this}equals(a){for(let h=0;h<9;h++)if(!this.coefficients[h].equals(a.coefficients[h]))return!1;return!0}copy(a){return this.set(a.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(a,h=0){const A=this.coefficients;for(let b=0;b<9;b++)A[b].fromArray(a,h+b*3);return this}toArray(a=[],h=0){const A=this.coefficients;for(let b=0;b<9;b++)A[b].toArray(a,h+b*3);return a}static getBasisAt(a,h){const A=a.x,b=a.y,E=a.z;h[0]=.282095,h[1]=.488603*b,h[2]=.488603*E,h[3]=.488603*A,h[4]=1.092548*A*b,h[5]=1.092548*b*E,h[6]=.315392*(3*E*E-1),h[7]=1.092548*A*E,h[8]=.546274*(A*A-b*b)}}class vV extends kd{constructor(a=new yV,h=1){super(void 0,h),this.isLightProbe=!0,this.sh=a}copy(a){return super.copy(a),this.sh.copy(a.sh),this}fromJSON(a){return this.intensity=a.intensity,this.sh.fromArray(a.sh),this}toJSON(a){const h=super.toJSON(a);return h.object.sh=this.sh.toArray(),h}}class bw extends Zo{constructor(a){super(a),this.textures={}}load(a,h,A,b){const E=this,M=new xh(E.manager);M.setPath(E.path),M.setRequestHeader(E.requestHeader),M.setWithCredentials(E.withCredentials),M.load(a,function(N){try{h(E.parse(JSON.parse(N)))}catch(P){b?b(P):console.error(P),E.manager.itemError(a)}},A,b)}parse(a){const h=this.textures;function A(E){return h[E]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",E),h[E]}const b=bw.createMaterialFromType(a.type);if(a.uuid!==void 0&&(b.uuid=a.uuid),a.name!==void 0&&(b.name=a.name),a.color!==void 0&&b.color!==void 0&&b.color.setHex(a.color),a.roughness!==void 0&&(b.roughness=a.roughness),a.metalness!==void 0&&(b.metalness=a.metalness),a.sheen!==void 0&&(b.sheen=a.sheen),a.sheenColor!==void 0&&(b.sheenColor=new or().setHex(a.sheenColor)),a.sheenRoughness!==void 0&&(b.sheenRoughness=a.sheenRoughness),a.emissive!==void 0&&b.emissive!==void 0&&b.emissive.setHex(a.emissive),a.specular!==void 0&&b.specular!==void 0&&b.specular.setHex(a.specular),a.specularIntensity!==void 0&&(b.specularIntensity=a.specularIntensity),a.specularColor!==void 0&&b.specularColor!==void 0&&b.specularColor.setHex(a.specularColor),a.shininess!==void 0&&(b.shininess=a.shininess),a.clearcoat!==void 0&&(b.clearcoat=a.clearcoat),a.clearcoatRoughness!==void 0&&(b.clearcoatRoughness=a.clearcoatRoughness),a.dispersion!==void 0&&(b.dispersion=a.dispersion),a.iridescence!==void 0&&(b.iridescence=a.iridescence),a.iridescenceIOR!==void 0&&(b.iridescenceIOR=a.iridescenceIOR),a.iridescenceThicknessRange!==void 0&&(b.iridescenceThicknessRange=a.iridescenceThicknessRange),a.transmission!==void 0&&(b.transmission=a.transmission),a.thickness!==void 0&&(b.thickness=a.thickness),a.attenuationDistance!==void 0&&(b.attenuationDistance=a.attenuationDistance),a.attenuationColor!==void 0&&b.attenuationColor!==void 0&&b.attenuationColor.setHex(a.attenuationColor),a.anisotropy!==void 0&&(b.anisotropy=a.anisotropy),a.anisotropyRotation!==void 0&&(b.anisotropyRotation=a.anisotropyRotation),a.fog!==void 0&&(b.fog=a.fog),a.flatShading!==void 0&&(b.flatShading=a.flatShading),a.blending!==void 0&&(b.blending=a.blending),a.combine!==void 0&&(b.combine=a.combine),a.side!==void 0&&(b.side=a.side),a.shadowSide!==void 0&&(b.shadowSide=a.shadowSide),a.opacity!==void 0&&(b.opacity=a.opacity),a.transparent!==void 0&&(b.transparent=a.transparent),a.alphaTest!==void 0&&(b.alphaTest=a.alphaTest),a.alphaHash!==void 0&&(b.alphaHash=a.alphaHash),a.depthFunc!==void 0&&(b.depthFunc=a.depthFunc),a.depthTest!==void 0&&(b.depthTest=a.depthTest),a.depthWrite!==void 0&&(b.depthWrite=a.depthWrite),a.colorWrite!==void 0&&(b.colorWrite=a.colorWrite),a.blendSrc!==void 0&&(b.blendSrc=a.blendSrc),a.blendDst!==void 0&&(b.blendDst=a.blendDst),a.blendEquation!==void 0&&(b.blendEquation=a.blendEquation),a.blendSrcAlpha!==void 0&&(b.blendSrcAlpha=a.blendSrcAlpha),a.blendDstAlpha!==void 0&&(b.blendDstAlpha=a.blendDstAlpha),a.blendEquationAlpha!==void 0&&(b.blendEquationAlpha=a.blendEquationAlpha),a.blendColor!==void 0&&b.blendColor!==void 0&&b.blendColor.setHex(a.blendColor),a.blendAlpha!==void 0&&(b.blendAlpha=a.blendAlpha),a.stencilWriteMask!==void 0&&(b.stencilWriteMask=a.stencilWriteMask),a.stencilFunc!==void 0&&(b.stencilFunc=a.stencilFunc),a.stencilRef!==void 0&&(b.stencilRef=a.stencilRef),a.stencilFuncMask!==void 0&&(b.stencilFuncMask=a.stencilFuncMask),a.stencilFail!==void 0&&(b.stencilFail=a.stencilFail),a.stencilZFail!==void 0&&(b.stencilZFail=a.stencilZFail),a.stencilZPass!==void 0&&(b.stencilZPass=a.stencilZPass),a.stencilWrite!==void 0&&(b.stencilWrite=a.stencilWrite),a.wireframe!==void 0&&(b.wireframe=a.wireframe),a.wireframeLinewidth!==void 0&&(b.wireframeLinewidth=a.wireframeLinewidth),a.wireframeLinecap!==void 0&&(b.wireframeLinecap=a.wireframeLinecap),a.wireframeLinejoin!==void 0&&(b.wireframeLinejoin=a.wireframeLinejoin),a.rotation!==void 0&&(b.rotation=a.rotation),a.linewidth!==void 0&&(b.linewidth=a.linewidth),a.dashSize!==void 0&&(b.dashSize=a.dashSize),a.gapSize!==void 0&&(b.gapSize=a.gapSize),a.scale!==void 0&&(b.scale=a.scale),a.polygonOffset!==void 0&&(b.polygonOffset=a.polygonOffset),a.polygonOffsetFactor!==void 0&&(b.polygonOffsetFactor=a.polygonOffsetFactor),a.polygonOffsetUnits!==void 0&&(b.polygonOffsetUnits=a.polygonOffsetUnits),a.dithering!==void 0&&(b.dithering=a.dithering),a.alphaToCoverage!==void 0&&(b.alphaToCoverage=a.alphaToCoverage),a.premultipliedAlpha!==void 0&&(b.premultipliedAlpha=a.premultipliedAlpha),a.forceSinglePass!==void 0&&(b.forceSinglePass=a.forceSinglePass),a.visible!==void 0&&(b.visible=a.visible),a.toneMapped!==void 0&&(b.toneMapped=a.toneMapped),a.userData!==void 0&&(b.userData=a.userData),a.vertexColors!==void 0&&(typeof a.vertexColors=="number"?b.vertexColors=a.vertexColors>0:b.vertexColors=a.vertexColors),a.uniforms!==void 0)for(const E in a.uniforms){const M=a.uniforms[E];switch(b.uniforms[E]={},M.type){case"t":b.uniforms[E].value=A(M.value);break;case"c":b.uniforms[E].value=new or().setHex(M.value);break;case"v2":b.uniforms[E].value=new ni().fromArray(M.value);break;case"v3":b.uniforms[E].value=new He().fromArray(M.value);break;case"v4":b.uniforms[E].value=new Fn().fromArray(M.value);break;case"m3":b.uniforms[E].value=new qr().fromArray(M.value);break;case"m4":b.uniforms[E].value=new fr().fromArray(M.value);break;default:b.uniforms[E].value=M.value}}if(a.defines!==void 0&&(b.defines=a.defines),a.vertexShader!==void 0&&(b.vertexShader=a.vertexShader),a.fragmentShader!==void 0&&(b.fragmentShader=a.fragmentShader),a.glslVersion!==void 0&&(b.glslVersion=a.glslVersion),a.extensions!==void 0)for(const E in a.extensions)b.extensions[E]=a.extensions[E];if(a.lights!==void 0&&(b.lights=a.lights),a.clipping!==void 0&&(b.clipping=a.clipping),a.size!==void 0&&(b.size=a.size),a.sizeAttenuation!==void 0&&(b.sizeAttenuation=a.sizeAttenuation),a.map!==void 0&&(b.map=A(a.map)),a.matcap!==void 0&&(b.matcap=A(a.matcap)),a.alphaMap!==void 0&&(b.alphaMap=A(a.alphaMap)),a.bumpMap!==void 0&&(b.bumpMap=A(a.bumpMap)),a.bumpScale!==void 0&&(b.bumpScale=a.bumpScale),a.normalMap!==void 0&&(b.normalMap=A(a.normalMap)),a.normalMapType!==void 0&&(b.normalMapType=a.normalMapType),a.normalScale!==void 0){let E=a.normalScale;Array.isArray(E)===!1&&(E=[E,E]),b.normalScale=new ni().fromArray(E)}return a.displacementMap!==void 0&&(b.displacementMap=A(a.displacementMap)),a.displacementScale!==void 0&&(b.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(b.displacementBias=a.displacementBias),a.roughnessMap!==void 0&&(b.roughnessMap=A(a.roughnessMap)),a.metalnessMap!==void 0&&(b.metalnessMap=A(a.metalnessMap)),a.emissiveMap!==void 0&&(b.emissiveMap=A(a.emissiveMap)),a.emissiveIntensity!==void 0&&(b.emissiveIntensity=a.emissiveIntensity),a.specularMap!==void 0&&(b.specularMap=A(a.specularMap)),a.specularIntensityMap!==void 0&&(b.specularIntensityMap=A(a.specularIntensityMap)),a.specularColorMap!==void 0&&(b.specularColorMap=A(a.specularColorMap)),a.envMap!==void 0&&(b.envMap=A(a.envMap)),a.envMapRotation!==void 0&&b.envMapRotation.fromArray(a.envMapRotation),a.envMapIntensity!==void 0&&(b.envMapIntensity=a.envMapIntensity),a.reflectivity!==void 0&&(b.reflectivity=a.reflectivity),a.refractionRatio!==void 0&&(b.refractionRatio=a.refractionRatio),a.lightMap!==void 0&&(b.lightMap=A(a.lightMap)),a.lightMapIntensity!==void 0&&(b.lightMapIntensity=a.lightMapIntensity),a.aoMap!==void 0&&(b.aoMap=A(a.aoMap)),a.aoMapIntensity!==void 0&&(b.aoMapIntensity=a.aoMapIntensity),a.gradientMap!==void 0&&(b.gradientMap=A(a.gradientMap)),a.clearcoatMap!==void 0&&(b.clearcoatMap=A(a.clearcoatMap)),a.clearcoatRoughnessMap!==void 0&&(b.clearcoatRoughnessMap=A(a.clearcoatRoughnessMap)),a.clearcoatNormalMap!==void 0&&(b.clearcoatNormalMap=A(a.clearcoatNormalMap)),a.clearcoatNormalScale!==void 0&&(b.clearcoatNormalScale=new ni().fromArray(a.clearcoatNormalScale)),a.iridescenceMap!==void 0&&(b.iridescenceMap=A(a.iridescenceMap)),a.iridescenceThicknessMap!==void 0&&(b.iridescenceThicknessMap=A(a.iridescenceThicknessMap)),a.transmissionMap!==void 0&&(b.transmissionMap=A(a.transmissionMap)),a.thicknessMap!==void 0&&(b.thicknessMap=A(a.thicknessMap)),a.anisotropyMap!==void 0&&(b.anisotropyMap=A(a.anisotropyMap)),a.sheenColorMap!==void 0&&(b.sheenColorMap=A(a.sheenColorMap)),a.sheenRoughnessMap!==void 0&&(b.sheenRoughnessMap=A(a.sheenRoughnessMap)),b}setTextures(a){return this.textures=a,this}static createMaterialFromType(a){const h={ShadowMaterial:Xj,SpriteMaterial:VB,RawShaderMaterial:Yj,ShaderMaterial:Cc,PointsMaterial:KB,MeshPhysicalMaterial:Kj,MeshStandardMaterial:uN,MeshPhongMaterial:Jj,MeshToonMaterial:Zj,MeshNormalMaterial:$j,MeshLambertMaterial:eV,MeshDepthMaterial:kB,MeshDistanceMaterial:UB,MeshBasicMaterial:Bd,MeshMatcapMaterial:tV,LineDashedMaterial:iV,LineBasicMaterial:Mo,Material:so};return new h[a]}}class vN{static decodeText(a){if(typeof TextDecoder<"u")return new TextDecoder().decode(a);let h="";for(let A=0,b=a.length;A<b;A++)h+=String.fromCharCode(a[A]);try{return decodeURIComponent(escape(h))}catch{return h}}static extractUrlBase(a){const h=a.lastIndexOf("/");return h===-1?"./":a.slice(0,h+1)}static resolveURL(a,h){return typeof a!="string"||a===""?"":(/^https?:\/\//i.test(h)&&/^\//.test(a)&&(h=h.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:h+a)}}class xV extends hn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(a){return super.copy(a),this.instanceCount=a.instanceCount,this}toJSON(){const a=super.toJSON();return a.instanceCount=this.instanceCount,a.isInstancedBufferGeometry=!0,a}}class bV extends Zo{constructor(a){super(a)}load(a,h,A,b){const E=this,M=new xh(E.manager);M.setPath(E.path),M.setRequestHeader(E.requestHeader),M.setWithCredentials(E.withCredentials),M.load(a,function(N){try{h(E.parse(JSON.parse(N)))}catch(P){b?b(P):console.error(P),E.manager.itemError(a)}},A,b)}parse(a){const h={},A={};function b(q,K){if(h[K]!==void 0)return h[K];const te=q.interleavedBuffers[K],oe=E(q,te.buffer),ne=Cd(te.type,oe),ee=new FE(ne,te.stride);return ee.uuid=te.uuid,h[K]=ee,ee}function E(q,K){if(A[K]!==void 0)return A[K];const te=q.arrayBuffers[K],oe=new Uint32Array(te).buffer;return A[K]=oe,oe}const M=a.isInstancedBufferGeometry?new xV:new hn,N=a.data.index;if(N!==void 0){const q=Cd(N.type,N.array);M.setIndex(new ns(q,1))}const P=a.data.attributes;for(const q in P){const K=P[q];let te;if(K.isInterleavedBufferAttribute){const oe=b(a.data,K.data);te=new pf(oe,K.itemSize,K.offset,K.normalized)}else{const oe=Cd(K.type,K.array),ne=K.isInstancedBufferAttribute?m0:ns;te=new ne(oe,K.itemSize,K.normalized)}K.name!==void 0&&(te.name=K.name),K.usage!==void 0&&te.setUsage(K.usage),M.setAttribute(q,te)}const F=a.data.morphAttributes;if(F)for(const q in F){const K=F[q],te=[];for(let oe=0,ne=K.length;oe<ne;oe++){const ee=K[oe];let Me;if(ee.isInterleavedBufferAttribute){const we=b(a.data,ee.data);Me=new pf(we,ee.itemSize,ee.offset,ee.normalized)}else{const we=Cd(ee.type,ee.array);Me=new ns(we,ee.itemSize,ee.normalized)}ee.name!==void 0&&(Me.name=ee.name),te.push(Me)}M.morphAttributes[q]=te}a.data.morphTargetsRelative&&(M.morphTargetsRelative=!0);const z=a.data.groups||a.data.drawcalls||a.data.offsets;if(z!==void 0)for(let q=0,K=z.length;q!==K;++q){const te=z[q];M.addGroup(te.start,te.count,te.materialIndex)}const X=a.data.boundingSphere;if(X!==void 0){const q=new He;X.center!==void 0&&q.fromArray(X.center),M.boundingSphere=new da(q,X.radius)}return a.name&&(M.name=a.name),a.userData&&(M.userData=a.userData),M}}class hTe extends Zo{constructor(a){super(a)}load(a,h,A,b){const E=this,M=this.path===""?vN.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||M;const N=new xh(this.manager);N.setPath(this.path),N.setRequestHeader(this.requestHeader),N.setWithCredentials(this.withCredentials),N.load(a,function(P){let F=null;try{F=JSON.parse(P)}catch(X){b!==void 0&&b(X),console.error("THREE:ObjectLoader: Can't parse "+a+".",X.message);return}const z=F.metadata;if(z===void 0||z.type===void 0||z.type.toLowerCase()==="geometry"){b!==void 0&&b(new Error("THREE.ObjectLoader: Can't load "+a)),console.error("THREE.ObjectLoader: Can't load "+a);return}E.parse(F,h)},A,b)}async loadAsync(a,h){const A=this,b=this.path===""?vN.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||b;const E=new xh(this.manager);E.setPath(this.path),E.setRequestHeader(this.requestHeader),E.setWithCredentials(this.withCredentials);const M=await E.loadAsync(a,h),N=JSON.parse(M),P=N.metadata;if(P===void 0||P.type===void 0||P.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+a);return await A.parseAsync(N)}parse(a,h){const A=this.parseAnimations(a.animations),b=this.parseShapes(a.shapes),E=this.parseGeometries(a.geometries,b),M=this.parseImages(a.images,function(){h!==void 0&&h(F)}),N=this.parseTextures(a.textures,M),P=this.parseMaterials(a.materials,N),F=this.parseObject(a.object,E,P,N,A),z=this.parseSkeletons(a.skeletons,F);if(this.bindSkeletons(F,z),h!==void 0){let X=!1;for(const q in M)if(M[q].data instanceof HTMLImageElement){X=!0;break}X===!1&&h(F)}return F}async parseAsync(a){const h=this.parseAnimations(a.animations),A=this.parseShapes(a.shapes),b=this.parseGeometries(a.geometries,A),E=await this.parseImagesAsync(a.images),M=this.parseTextures(a.textures,E),N=this.parseMaterials(a.materials,M),P=this.parseObject(a.object,b,N,M,h),F=this.parseSkeletons(a.skeletons,P);return this.bindSkeletons(P,F),P}parseShapes(a){const h={};if(a!==void 0)for(let A=0,b=a.length;A<b;A++){const E=new mf().fromJSON(a[A]);h[E.uuid]=E}return h}parseSkeletons(a,h){const A={},b={};if(h.traverse(function(E){E.isBone&&(b[E.uuid]=E)}),a!==void 0)for(let E=0,M=a.length;E<M;E++){const N=new GE().fromJSON(a[E],b);A[N.uuid]=N}return A}parseGeometries(a,h){const A={};if(a!==void 0){const E=new bV;for(let M=0,N=a.length;M<N;M++){let P;const F=a[M];switch(F.type){case"BufferGeometry":case"InstancedBufferGeometry":P=E.parse(F);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var b=new THREE.LegacyJSONLoader;P=b.parse(F,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:F.type in qj?P=qj[F.type].fromJSON(F,h):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${F.type}"`)}P.uuid=F.uuid,F.name!==void 0&&(P.name=F.name),F.userData!==void 0&&(P.userData=F.userData),A[F.uuid]=P}}return A}parseMaterials(a,h){const A={},b={};if(a!==void 0){const E=new bw;E.setTextures(h);for(let M=0,N=a.length;M<N;M++){const P=a[M];A[P.uuid]===void 0&&(A[P.uuid]=E.parse(P)),b[P.uuid]=A[P.uuid]}}return b}parseAnimations(a){const h={};if(a!==void 0)for(let A=0;A<a.length;A++){const b=a[A],E=Tv.parse(b);h[E.uuid]=E}return h}parseImages(a,h){const A=this,b={};let E;function M(P){return A.manager.itemStart(P),E.load(P,function(){A.manager.itemEnd(P)},void 0,function(){A.manager.itemError(P),A.manager.itemEnd(P)})}function N(P){if(typeof P=="string"){const F=P,z=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(F)?F:A.resourcePath+F;return M(z)}else return P.data?{data:Cd(P.type,P.data),width:P.width,height:P.height}:null}if(a!==void 0&&a.length>0){const P=new mN(h);E=new Mv(P),E.setCrossOrigin(this.crossOrigin);for(let F=0,z=a.length;F<z;F++){const X=a[F],q=X.url;if(Array.isArray(q)){const K=[];for(let te=0,oe=q.length;te<oe;te++){const ne=q[te],ee=N(ne);ee!==null&&(ee instanceof HTMLImageElement?K.push(ee):K.push(new Dd(ee.data,ee.width,ee.height)))}b[X.uuid]=new ys(K)}else{const K=N(X.url);b[X.uuid]=new ys(K)}}}return b}async parseImagesAsync(a){const h=this,A={};let b;async function E(M){if(typeof M=="string"){const N=M,P=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(N)?N:h.resourcePath+N;return await b.loadAsync(P)}else return M.data?{data:Cd(M.type,M.data),width:M.width,height:M.height}:null}if(a!==void 0&&a.length>0){b=new Mv(this.manager),b.setCrossOrigin(this.crossOrigin);for(let M=0,N=a.length;M<N;M++){const P=a[M],F=P.url;if(Array.isArray(F)){const z=[];for(let X=0,q=F.length;X<q;X++){const K=F[X],te=await E(K);te!==null&&(te instanceof HTMLImageElement?z.push(te):z.push(new Dd(te.data,te.width,te.height)))}A[P.uuid]=new ys(z)}else{const z=await E(P.url);A[P.uuid]=new ys(z)}}}return A}parseTextures(a,h){function A(E,M){return typeof E=="number"?E:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",E),M[E])}const b={};if(a!==void 0)for(let E=0,M=a.length;E<M;E++){const N=a[E];N.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',N.uuid),h[N.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",N.image);const P=h[N.image],F=P.data;let z;Array.isArray(F)?(z=new sv,F.length===6&&(z.needsUpdate=!0)):(F&&F.data?z=new Dd:z=new us,F&&(z.needsUpdate=!0)),z.source=P,z.uuid=N.uuid,N.name!==void 0&&(z.name=N.name),N.mapping!==void 0&&(z.mapping=A(N.mapping,dTe)),N.channel!==void 0&&(z.channel=N.channel),N.offset!==void 0&&z.offset.fromArray(N.offset),N.repeat!==void 0&&z.repeat.fromArray(N.repeat),N.center!==void 0&&z.center.fromArray(N.center),N.rotation!==void 0&&(z.rotation=N.rotation),N.wrap!==void 0&&(z.wrapS=A(N.wrap[0],_V),z.wrapT=A(N.wrap[1],_V)),N.format!==void 0&&(z.format=N.format),N.internalFormat!==void 0&&(z.internalFormat=N.internalFormat),N.type!==void 0&&(z.type=N.type),N.colorSpace!==void 0&&(z.colorSpace=N.colorSpace),N.minFilter!==void 0&&(z.minFilter=A(N.minFilter,EV)),N.magFilter!==void 0&&(z.magFilter=A(N.magFilter,EV)),N.anisotropy!==void 0&&(z.anisotropy=N.anisotropy),N.flipY!==void 0&&(z.flipY=N.flipY),N.generateMipmaps!==void 0&&(z.generateMipmaps=N.generateMipmaps),N.premultiplyAlpha!==void 0&&(z.premultiplyAlpha=N.premultiplyAlpha),N.unpackAlignment!==void 0&&(z.unpackAlignment=N.unpackAlignment),N.compareFunction!==void 0&&(z.compareFunction=N.compareFunction),N.userData!==void 0&&(z.userData=N.userData),b[N.uuid]=z}return b}parseObject(a,h,A,b,E){let M;function N(q){return h[q]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",q),h[q]}function P(q){if(q!==void 0){if(Array.isArray(q)){const K=[];for(let te=0,oe=q.length;te<oe;te++){const ne=q[te];A[ne]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ne),K.push(A[ne])}return K}return A[q]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",q),A[q]}}function F(q){return b[q]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",q),b[q]}let z,X;switch(a.type){case"Scene":M=new nj,a.background!==void 0&&(Number.isInteger(a.background)?M.background=new or(a.background):M.background=F(a.background)),a.environment!==void 0&&(M.environment=F(a.environment)),a.fog!==void 0&&(a.fog.type==="Fog"?M.fog=new PE(a.fog.color,a.fog.near,a.fog.far):a.fog.type==="FogExp2"&&(M.fog=new OE(a.fog.color,a.fog.density)),a.fog.name!==""&&(M.fog.name=a.fog.name)),a.backgroundBlurriness!==void 0&&(M.backgroundBlurriness=a.backgroundBlurriness),a.backgroundIntensity!==void 0&&(M.backgroundIntensity=a.backgroundIntensity),a.backgroundRotation!==void 0&&M.backgroundRotation.fromArray(a.backgroundRotation),a.environmentIntensity!==void 0&&(M.environmentIntensity=a.environmentIntensity),a.environmentRotation!==void 0&&M.environmentRotation.fromArray(a.environmentRotation);break;case"PerspectiveCamera":M=new fa(a.fov,a.aspect,a.near,a.far),a.focus!==void 0&&(M.focus=a.focus),a.zoom!==void 0&&(M.zoom=a.zoom),a.filmGauge!==void 0&&(M.filmGauge=a.filmGauge),a.filmOffset!==void 0&&(M.filmOffset=a.filmOffset),a.view!==void 0&&(M.view=Object.assign({},a.view));break;case"OrthographicCamera":M=new BE(a.left,a.right,a.top,a.bottom,a.near,a.far),a.zoom!==void 0&&(M.zoom=a.zoom),a.view!==void 0&&(M.view=Object.assign({},a.view));break;case"AmbientLight":M=new gV(a.color,a.intensity);break;case"DirectionalLight":M=new mV(a.color,a.intensity);break;case"PointLight":M=new fV(a.color,a.intensity,a.distance,a.decay);break;case"RectAreaLight":M=new AV(a.color,a.intensity,a.width,a.height);break;case"SpotLight":M=new dV(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case"HemisphereLight":M=new cV(a.color,a.groundColor,a.intensity);break;case"LightProbe":M=new vV().fromJSON(a);break;case"SkinnedMesh":z=N(a.geometry),X=P(a.material),M=new gj(z,X),a.bindMode!==void 0&&(M.bindMode=a.bindMode),a.bindMatrix!==void 0&&M.bindMatrix.fromArray(a.bindMatrix),a.skeleton!==void 0&&(M.skeleton=a.skeleton);break;case"Mesh":z=N(a.geometry),X=P(a.material),M=new sa(z,X);break;case"InstancedMesh":z=N(a.geometry),X=P(a.material);const q=a.count,K=a.instanceMatrix,te=a.instanceColor;M=new xj(z,X,q),M.instanceMatrix=new m0(new Float32Array(K.array),16),te!==void 0&&(M.instanceColor=new m0(new Float32Array(te.array),te.itemSize));break;case"BatchedMesh":z=N(a.geometry),X=P(a.material),M=new Ej(a.maxGeometryCount,a.maxVertexCount,a.maxIndexCount,X),M.geometry=z,M.perObjectFrustumCulled=a.perObjectFrustumCulled,M.sortObjects=a.sortObjects,M._drawRanges=a.drawRanges,M._reservedRanges=a.reservedRanges,M._visibility=a.visibility,M._active=a.active,M._bounds=a.bounds.map(oe=>{const ne=new Is;ne.min.fromArray(oe.boxMin),ne.max.fromArray(oe.boxMax);const ee=new da;return ee.radius=oe.sphereRadius,ee.center.fromArray(oe.sphereCenter),{boxInitialized:oe.boxInitialized,box:ne,sphereInitialized:oe.sphereInitialized,sphere:ee}}),M._maxGeometryCount=a.maxGeometryCount,M._maxVertexCount=a.maxVertexCount,M._maxIndexCount=a.maxIndexCount,M._geometryInitialized=a.geometryInitialized,M._geometryCount=a.geometryCount,M._matricesTexture=F(a.matricesTexture.uuid);break;case"LOD":M=new uj;break;case"Line":M=new Pd(N(a.geometry),P(a.material));break;case"LineLoop":M=new Mj(N(a.geometry),P(a.material));break;case"LineSegments":M=new Jc(N(a.geometry),P(a.material));break;case"PointCloud":case"Points":M=new Ij(N(a.geometry),P(a.material));break;case"Sprite":M=new lj(P(a.material));break;case"Group":M=new hf;break;case"Bone":M=new QB;break;default:M=new Vn}if(M.uuid=a.uuid,a.name!==void 0&&(M.name=a.name),a.matrix!==void 0?(M.matrix.fromArray(a.matrix),a.matrixAutoUpdate!==void 0&&(M.matrixAutoUpdate=a.matrixAutoUpdate),M.matrixAutoUpdate&&M.matrix.decompose(M.position,M.quaternion,M.scale)):(a.position!==void 0&&M.position.fromArray(a.position),a.rotation!==void 0&&M.rotation.fromArray(a.rotation),a.quaternion!==void 0&&M.quaternion.fromArray(a.quaternion),a.scale!==void 0&&M.scale.fromArray(a.scale)),a.up!==void 0&&M.up.fromArray(a.up),a.castShadow!==void 0&&(M.castShadow=a.castShadow),a.receiveShadow!==void 0&&(M.receiveShadow=a.receiveShadow),a.shadow&&(a.shadow.bias!==void 0&&(M.shadow.bias=a.shadow.bias),a.shadow.normalBias!==void 0&&(M.shadow.normalBias=a.shadow.normalBias),a.shadow.radius!==void 0&&(M.shadow.radius=a.shadow.radius),a.shadow.mapSize!==void 0&&M.shadow.mapSize.fromArray(a.shadow.mapSize),a.shadow.camera!==void 0&&(M.shadow.camera=this.parseObject(a.shadow.camera))),a.visible!==void 0&&(M.visible=a.visible),a.frustumCulled!==void 0&&(M.frustumCulled=a.frustumCulled),a.renderOrder!==void 0&&(M.renderOrder=a.renderOrder),a.userData!==void 0&&(M.userData=a.userData),a.layers!==void 0&&(M.layers.mask=a.layers),a.children!==void 0){const q=a.children;for(let K=0;K<q.length;K++)M.add(this.parseObject(q[K],h,A,b,E))}if(a.animations!==void 0){const q=a.animations;for(let K=0;K<q.length;K++){const te=q[K];M.animations.push(E[te])}}if(a.type==="LOD"){a.autoUpdate!==void 0&&(M.autoUpdate=a.autoUpdate);const q=a.levels;for(let K=0;K<q.length;K++){const te=q[K],oe=M.getObjectByProperty("uuid",te.object);oe!==void 0&&M.addLevel(oe,te.distance,te.hysteresis)}}return M}bindSkeletons(a,h){Object.keys(h).length!==0&&a.traverse(function(A){if(A.isSkinnedMesh===!0&&A.skeleton!==void 0){const b=h[A.skeleton];b===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",A.skeleton):A.bind(b,A.bindMatrix)}})}}const dTe={UVMapping:Pe,CubeReflectionMapping:k,CubeRefractionMapping:Z,EquirectangularReflectionMapping:re,EquirectangularRefractionMapping:Re,CubeUVReflectionMapping:ce},_V={RepeatWrapping:Ue,ClampToEdgeWrapping:je,MirroredRepeatWrapping:dt},EV={NearestFilter:Bt,NearestMipmapNearestFilter:bt,NearestMipmapLinearFilter:di,LinearFilter:Pi,LinearMipmapNearestFilter:fn,LinearMipmapLinearFilter:tn};class pTe extends Zo{constructor(a){super(a),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(a){return this.options=a,this}load(a,h,A,b){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const E=this,M=yh.get(a);if(M!==void 0){if(E.manager.itemStart(a),M.then){M.then(F=>{h&&h(F),E.manager.itemEnd(a)}).catch(F=>{b&&b(F)});return}return setTimeout(function(){h&&h(M),E.manager.itemEnd(a)},0),M}const N={};N.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",N.headers=this.requestHeader;const P=fetch(a,N).then(function(F){return F.blob()}).then(function(F){return createImageBitmap(F,Object.assign(E.options,{colorSpaceConversion:"none"}))}).then(function(F){return yh.add(a,F),h&&h(F),E.manager.itemEnd(a),F}).catch(function(F){b&&b(F),yh.remove(a),E.manager.itemError(a),E.manager.itemEnd(a)});yh.add(a,P),E.manager.itemStart(a)}}let _w;class xN{static getContext(){return _w===void 0&&(_w=new(window.AudioContext||window.webkitAudioContext)),_w}static setContext(a){_w=a}}class fTe extends Zo{constructor(a){super(a)}load(a,h,A,b){const E=this,M=new xh(this.manager);M.setResponseType("arraybuffer"),M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(a,function(P){try{const F=P.slice(0);xN.getContext().decodeAudioData(F,function(z){h(z)}).catch(N)}catch(F){N(F)}},A,b);function N(P){b?b(P):console.error(P),E.manager.itemError(a)}}}const wV=new fr,CV=new fr,xf=new fr;class mTe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new fa,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new fa,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(a){const h=this._cache;if(h.focus!==a.focus||h.fov!==a.fov||h.aspect!==a.aspect*this.aspect||h.near!==a.near||h.far!==a.far||h.zoom!==a.zoom||h.eyeSep!==this.eyeSep){h.focus=a.focus,h.fov=a.fov,h.aspect=a.aspect*this.aspect,h.near=a.near,h.far=a.far,h.zoom=a.zoom,h.eyeSep=this.eyeSep,xf.copy(a.projectionMatrix);const A=h.eyeSep/2,b=A*h.near/h.focus,E=h.near*Math.tan(uh*h.fov*.5)/h.zoom;let M,N;CV.elements[12]=-A,wV.elements[12]=A,M=-E*h.aspect+b,N=E*h.aspect+b,xf.elements[0]=2*h.near/(N-M),xf.elements[8]=(N+M)/(N-M),this.cameraL.projectionMatrix.copy(xf),M=-E*h.aspect-b,N=E*h.aspect-b,xf.elements[0]=2*h.near/(N-M),xf.elements[8]=(N+M)/(N-M),this.cameraR.projectionMatrix.copy(xf)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(CV),this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(wV)}}class SV{constructor(a=!0){this.autoStart=a,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=TV(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const h=TV();a=(h-this.oldTime)/1e3,this.oldTime=h,this.elapsedTime+=a}return a}}function TV(){return(typeof performance>"u"?Date:performance).now()}const bf=new He,MV=new jn,gTe=new He,_f=new He;class ATe extends Vn{constructor(){super(),this.type="AudioListener",this.context=xN.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new SV}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(a){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=a,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}updateMatrixWorld(a){super.updateMatrixWorld(a);const h=this.context.listener,A=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(bf,MV,gTe),_f.set(0,0,-1).applyQuaternion(MV),h.positionX){const b=this.context.currentTime+this.timeDelta;h.positionX.linearRampToValueAtTime(bf.x,b),h.positionY.linearRampToValueAtTime(bf.y,b),h.positionZ.linearRampToValueAtTime(bf.z,b),h.forwardX.linearRampToValueAtTime(_f.x,b),h.forwardY.linearRampToValueAtTime(_f.y,b),h.forwardZ.linearRampToValueAtTime(_f.z,b),h.upX.linearRampToValueAtTime(A.x,b),h.upY.linearRampToValueAtTime(A.y,b),h.upZ.linearRampToValueAtTime(A.z,b)}else h.setPosition(bf.x,bf.y,bf.z),h.setOrientation(_f.x,_f.y,_f.z,A.x,A.y,A.z)}}class RV extends Vn{constructor(a){super(),this.type="Audio",this.listener=a,this.context=a.context,this.gain=this.context.createGain(),this.gain.connect(a.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(a){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=a,this.connect(),this}setMediaElementSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(a),this.connect(),this}setMediaStreamSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(a),this.connect(),this}setBuffer(a){return this.buffer=a,this.sourceType="buffer",this.autoplay&&this.play(),this}play(a=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+a;const h=this.context.createBufferSource();return h.buffer=this.buffer,h.loop=this.loop,h.loopStart=this.loopStart,h.loopEnd=this.loopEnd,h.onended=this.onEnded.bind(this),h.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=h,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let a=1,h=this.filters.length;a<h;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let a=1,h=this.filters.length;a<h;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(a){return a||(a=[]),this._connected===!0?(this.disconnect(),this.filters=a.slice(),this.connect()):this.filters=a.slice(),this}setDetune(a){return this.detune=a,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(a){return this.setFilters(a?[a]:[])}setPlaybackRate(a){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=a,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(a){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=a,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(a){return this.loopStart=a,this}setLoopEnd(a){return this.loopEnd=a,this}getVolume(){return this.gain.gain.value}setVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}}const Ef=new He,IV=new jn,yTe=new He,wf=new He;class vTe extends RV{constructor(a){super(a),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(a){return this.panner.refDistance=a,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(a){return this.panner.rolloffFactor=a,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(a){return this.panner.distanceModel=a,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(a){return this.panner.maxDistance=a,this}setDirectionalCone(a,h,A){return this.panner.coneInnerAngle=a,this.panner.coneOuterAngle=h,this.panner.coneOuterGain=A,this}updateMatrixWorld(a){if(super.updateMatrixWorld(a),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Ef,IV,yTe),wf.set(0,0,1).applyQuaternion(IV);const h=this.panner;if(h.positionX){const A=this.context.currentTime+this.listener.timeDelta;h.positionX.linearRampToValueAtTime(Ef.x,A),h.positionY.linearRampToValueAtTime(Ef.y,A),h.positionZ.linearRampToValueAtTime(Ef.z,A),h.orientationX.linearRampToValueAtTime(wf.x,A),h.orientationY.linearRampToValueAtTime(wf.y,A),h.orientationZ.linearRampToValueAtTime(wf.z,A)}else h.setPosition(Ef.x,Ef.y,Ef.z),h.setOrientation(wf.x,wf.y,wf.z)}}class xTe{constructor(a,h=2048){this.analyser=a.context.createAnalyser(),this.analyser.fftSize=h,this.data=new Uint8Array(this.analyser.frequencyBinCount),a.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let a=0;const h=this.getFrequencyData();for(let A=0;A<h.length;A++)a+=h[A];return a/h.length}}class BV{constructor(a,h,A){this.binding=a,this.valueSize=A;let b,E,M;switch(h){case"quaternion":b=this._slerp,E=this._slerpAdditive,M=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(A*6),this._workIndex=5;break;case"string":case"bool":b=this._select,E=this._select,M=this._setAdditiveIdentityOther,this.buffer=new Array(A*5);break;default:b=this._lerp,E=this._lerpAdditive,M=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(A*5)}this._mixBufferRegion=b,this._mixBufferRegionAdditive=E,this._setIdentity=M,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(a,h){const A=this.buffer,b=this.valueSize,E=a*b+b;let M=this.cumulativeWeight;if(M===0){for(let N=0;N!==b;++N)A[E+N]=A[N];M=h}else{M+=h;const N=h/M;this._mixBufferRegion(A,E,0,N,b)}this.cumulativeWeight=M}accumulateAdditive(a){const h=this.buffer,A=this.valueSize,b=A*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(h,b,0,a,A),this.cumulativeWeightAdditive+=a}apply(a){const h=this.valueSize,A=this.buffer,b=a*h+h,E=this.cumulativeWeight,M=this.cumulativeWeightAdditive,N=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,E<1){const P=h*this._origIndex;this._mixBufferRegion(A,b,P,1-E,h)}M>0&&this._mixBufferRegionAdditive(A,b,this._addIndex*h,1,h);for(let P=h,F=h+h;P!==F;++P)if(A[P]!==A[P+h]){N.setValue(A,b);break}}saveOriginalState(){const a=this.binding,h=this.buffer,A=this.valueSize,b=A*this._origIndex;a.getValue(h,b);for(let E=A,M=b;E!==M;++E)h[E]=h[b+E%A];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const a=this.valueSize*3;this.binding.setValue(this.buffer,a)}_setAdditiveIdentityNumeric(){const a=this._addIndex*this.valueSize,h=a+this.valueSize;for(let A=a;A<h;A++)this.buffer[A]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const a=this._origIndex*this.valueSize,h=this._addIndex*this.valueSize;for(let A=0;A<this.valueSize;A++)this.buffer[h+A]=this.buffer[a+A]}_select(a,h,A,b,E){if(b>=.5)for(let M=0;M!==E;++M)a[h+M]=a[A+M]}_slerp(a,h,A,b){jn.slerpFlat(a,h,a,h,a,A,b)}_slerpAdditive(a,h,A,b,E){const M=this._workIndex*E;jn.multiplyQuaternionsFlat(a,M,a,h,a,A),jn.slerpFlat(a,h,a,h,a,M,b)}_lerp(a,h,A,b,E){const M=1-b;for(let N=0;N!==E;++N){const P=h+N;a[P]=a[P]*M+a[A+N]*b}}_lerpAdditive(a,h,A,b,E){for(let M=0;M!==E;++M){const N=h+M;a[N]=a[N]+a[A+M]*b}}}const bN="\\[\\]\\.:\\/",bTe=new RegExp("["+bN+"]","g"),_N="[^"+bN+"]",_Te="[^"+bN.replace("\\.","")+"]",ETe=/((?:WC+[\/:])*)/.source.replace("WC",_N),wTe=/(WCOD+)?/.source.replace("WCOD",_Te),CTe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_N),STe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_N),TTe=new RegExp("^"+ETe+wTe+CTe+STe+"$"),MTe=["material","materials","bones","map"];class RTe{constructor(a,h,A){const b=A||kn.parseTrackName(h);this._targetGroup=a,this._bindings=a.subscribe_(h,b)}getValue(a,h){this.bind();const A=this._targetGroup.nCachedObjects_,b=this._bindings[A];b!==void 0&&b.getValue(a,h)}setValue(a,h){const A=this._bindings;for(let b=this._targetGroup.nCachedObjects_,E=A.length;b!==E;++b)A[b].setValue(a,h)}bind(){const a=this._bindings;for(let h=this._targetGroup.nCachedObjects_,A=a.length;h!==A;++h)a[h].bind()}unbind(){const a=this._bindings;for(let h=this._targetGroup.nCachedObjects_,A=a.length;h!==A;++h)a[h].unbind()}}class kn{constructor(a,h,A){this.path=h,this.parsedPath=A||kn.parseTrackName(h),this.node=kn.findNode(a,this.parsedPath.nodeName),this.rootNode=a,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(a,h,A){return a&&a.isAnimationObjectGroup?new kn.Composite(a,h,A):new kn(a,h,A)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(bTe,"")}static parseTrackName(a){const h=TTe.exec(a);if(h===null)throw new Error("PropertyBinding: Cannot parse trackName: "+a);const A={nodeName:h[2],objectName:h[3],objectIndex:h[4],propertyName:h[5],propertyIndex:h[6]},b=A.nodeName&&A.nodeName.lastIndexOf(".");if(b!==void 0&&b!==-1){const E=A.nodeName.substring(b+1);MTe.indexOf(E)!==-1&&(A.nodeName=A.nodeName.substring(0,b),A.objectName=E)}if(A.propertyName===null||A.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+a);return A}static findNode(a,h){if(h===void 0||h===""||h==="."||h===-1||h===a.name||h===a.uuid)return a;if(a.skeleton){const A=a.skeleton.getBoneByName(h);if(A!==void 0)return A}if(a.children){const A=function(E){for(let M=0;M<E.length;M++){const N=E[M];if(N.name===h||N.uuid===h)return N;const P=A(N.children);if(P)return P}return null},b=A(a.children);if(b)return b}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,h){a[h]=this.targetObject[this.propertyName]}_getValue_array(a,h){const A=this.resolvedProperty;for(let b=0,E=A.length;b!==E;++b)a[h++]=A[b]}_getValue_arrayElement(a,h){a[h]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,h){this.resolvedProperty.toArray(a,h)}_setValue_direct(a,h){this.targetObject[this.propertyName]=a[h]}_setValue_direct_setNeedsUpdate(a,h){this.targetObject[this.propertyName]=a[h],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,h){this.targetObject[this.propertyName]=a[h],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(a,h){const A=this.resolvedProperty;for(let b=0,E=A.length;b!==E;++b)A[b]=a[h++]}_setValue_array_setNeedsUpdate(a,h){const A=this.resolvedProperty;for(let b=0,E=A.length;b!==E;++b)A[b]=a[h++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,h){const A=this.resolvedProperty;for(let b=0,E=A.length;b!==E;++b)A[b]=a[h++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,h){this.resolvedProperty[this.propertyIndex]=a[h]}_setValue_arrayElement_setNeedsUpdate(a,h){this.resolvedProperty[this.propertyIndex]=a[h],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,h){this.resolvedProperty[this.propertyIndex]=a[h],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,h){this.resolvedProperty.fromArray(a,h)}_setValue_fromArray_setNeedsUpdate(a,h){this.resolvedProperty.fromArray(a,h),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,h){this.resolvedProperty.fromArray(a,h),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(a,h){this.bind(),this.getValue(a,h)}_setValue_unbound(a,h){this.bind(),this.setValue(a,h)}bind(){let a=this.node;const h=this.parsedPath,A=h.objectName,b=h.propertyName;let E=h.propertyIndex;if(a||(a=kn.findNode(this.rootNode,h.nodeName),this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(A){let F=h.objectIndex;switch(A){case"materials":if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!a.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}a=a.material.materials;break;case"bones":if(!a.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}a=a.skeleton.bones;for(let z=0;z<a.length;z++)if(a[z].name===F){F=z;break}break;case"map":if("map"in a){a=a.map;break}if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!a.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}a=a.material.map;break;default:if(a[A]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}a=a[A]}if(F!==void 0){if(a[F]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);return}a=a[F]}}const M=a[b];if(M===void 0){const F=h.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+F+"."+b+" but it wasn't found.",a);return}let N=this.Versioning.None;this.targetObject=a,a.needsUpdate!==void 0?N=this.Versioning.NeedsUpdate:a.matrixWorldNeedsUpdate!==void 0&&(N=this.Versioning.MatrixWorldNeedsUpdate);let P=this.BindingType.Direct;if(E!==void 0){if(b==="morphTargetInfluences"){if(!a.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!a.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}a.morphTargetDictionary[E]!==void 0&&(E=a.morphTargetDictionary[E])}P=this.BindingType.ArrayElement,this.resolvedProperty=M,this.propertyIndex=E}else M.fromArray!==void 0&&M.toArray!==void 0?(P=this.BindingType.HasFromToArray,this.resolvedProperty=M):Array.isArray(M)?(P=this.BindingType.EntireArray,this.resolvedProperty=M):this.propertyName=b;this.getValue=this.GetterByBindingType[P],this.setValue=this.SetterByBindingTypeAndVersioning[P][N]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}kn.Composite=RTe,kn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},kn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},kn.prototype.GetterByBindingType=[kn.prototype._getValue_direct,kn.prototype._getValue_array,kn.prototype._getValue_arrayElement,kn.prototype._getValue_toArray],kn.prototype.SetterByBindingTypeAndVersioning=[[kn.prototype._setValue_direct,kn.prototype._setValue_direct_setNeedsUpdate,kn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[kn.prototype._setValue_array,kn.prototype._setValue_array_setNeedsUpdate,kn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[kn.prototype._setValue_arrayElement,kn.prototype._setValue_arrayElement_setNeedsUpdate,kn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[kn.prototype._setValue_fromArray,kn.prototype._setValue_fromArray_setNeedsUpdate,kn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class ITe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=wo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const a={};this._indicesByUUID=a;for(let A=0,b=arguments.length;A!==b;++A)a[arguments[A].uuid]=A;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const h=this;this.stats={objects:{get total(){return h._objects.length},get inUse(){return this.total-h.nCachedObjects_}},get bindingsPerObject(){return h._bindings.length}}}add(){const a=this._objects,h=this._indicesByUUID,A=this._paths,b=this._parsedPaths,E=this._bindings,M=E.length;let N,P=a.length,F=this.nCachedObjects_;for(let z=0,X=arguments.length;z!==X;++z){const q=arguments[z],K=q.uuid;let te=h[K];if(te===void 0){te=P++,h[K]=te,a.push(q);for(let oe=0,ne=M;oe!==ne;++oe)E[oe].push(new kn(q,A[oe],b[oe]))}else if(te<F){N=a[te];const oe=--F,ne=a[oe];h[ne.uuid]=te,a[te]=ne,h[K]=oe,a[oe]=q;for(let ee=0,Me=M;ee!==Me;++ee){const we=E[ee],_e=we[oe];let nt=we[te];we[te]=_e,nt===void 0&&(nt=new kn(q,A[ee],b[ee])),we[oe]=nt}}else a[te]!==N&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=F}remove(){const a=this._objects,h=this._indicesByUUID,A=this._bindings,b=A.length;let E=this.nCachedObjects_;for(let M=0,N=arguments.length;M!==N;++M){const P=arguments[M],F=P.uuid,z=h[F];if(z!==void 0&&z>=E){const X=E++,q=a[X];h[q.uuid]=z,a[z]=q,h[F]=X,a[X]=P;for(let K=0,te=b;K!==te;++K){const oe=A[K],ne=oe[X],ee=oe[z];oe[z]=ne,oe[X]=ee}}}this.nCachedObjects_=E}uncache(){const a=this._objects,h=this._indicesByUUID,A=this._bindings,b=A.length;let E=this.nCachedObjects_,M=a.length;for(let N=0,P=arguments.length;N!==P;++N){const F=arguments[N],z=F.uuid,X=h[z];if(X!==void 0)if(delete h[z],X<E){const q=--E,K=a[q],te=--M,oe=a[te];h[K.uuid]=X,a[X]=K,h[oe.uuid]=q,a[q]=oe,a.pop();for(let ne=0,ee=b;ne!==ee;++ne){const Me=A[ne],we=Me[q],_e=Me[te];Me[X]=we,Me[q]=_e,Me.pop()}}else{const q=--M,K=a[q];q>0&&(h[K.uuid]=X),a[X]=K,a.pop();for(let te=0,oe=b;te!==oe;++te){const ne=A[te];ne[X]=ne[q],ne.pop()}}}this.nCachedObjects_=E}subscribe_(a,h){const A=this._bindingsIndicesByPath;let b=A[a];const E=this._bindings;if(b!==void 0)return E[b];const M=this._paths,N=this._parsedPaths,P=this._objects,F=P.length,z=this.nCachedObjects_,X=new Array(F);b=E.length,A[a]=b,M.push(a),N.push(h),E.push(X);for(let q=z,K=P.length;q!==K;++q){const te=P[q];X[q]=new kn(te,a,h)}return X}unsubscribe_(a){const h=this._bindingsIndicesByPath,A=h[a];if(A!==void 0){const b=this._paths,E=this._parsedPaths,M=this._bindings,N=M.length-1,P=M[N],F=a[N];h[F]=A,M[A]=P,M.pop(),E[A]=E[N],E.pop(),b[A]=b[N],b.pop()}}}class NV{constructor(a,h,A=null,b=h.blendMode){this._mixer=a,this._clip=h,this._localRoot=A,this.blendMode=b;const E=h.tracks,M=E.length,N=new Array(M),P={endingStart:jr,endingEnd:jr};for(let F=0;F!==M;++F){const z=E[F].createInterpolant(null);N[F]=z,z.settings=P}this._interpolantSettings=P,this._interpolants=N,this._propertyBindings=new Array(M),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=pr,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(a){return this._startTime=a,this}setLoop(a,h){return this.loop=a,this.repetitions=h,this}setEffectiveWeight(a){return this.weight=a,this._effectiveWeight=this.enabled?a:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(a){return this._scheduleFading(a,0,1)}fadeOut(a){return this._scheduleFading(a,1,0)}crossFadeFrom(a,h,A){if(a.fadeOut(h),this.fadeIn(h),A){const b=this._clip.duration,E=a._clip.duration,M=E/b,N=b/E;a.warp(1,M,h),this.warp(N,1,h)}return this}crossFadeTo(a,h,A){return a.crossFadeFrom(this,h,A)}stopFading(){const a=this._weightInterpolant;return a!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}setEffectiveTimeScale(a){return this.timeScale=a,this._effectiveTimeScale=this.paused?0:a,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(a){return this.timeScale=this._clip.duration/a,this.stopWarping()}syncWith(a){return this.time=a.time,this.timeScale=a.timeScale,this.stopWarping()}halt(a){return this.warp(this._effectiveTimeScale,0,a)}warp(a,h,A){const b=this._mixer,E=b.time,M=this.timeScale;let N=this._timeScaleInterpolant;N===null&&(N=b._lendControlInterpolant(),this._timeScaleInterpolant=N);const P=N.parameterPositions,F=N.sampleValues;return P[0]=E,P[1]=E+A,F[0]=a/M,F[1]=h/M,this}stopWarping(){const a=this._timeScaleInterpolant;return a!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(a,h,A,b){if(!this.enabled){this._updateWeight(a);return}const E=this._startTime;if(E!==null){const P=(a-E)*A;P<0||A===0?h=0:(this._startTime=null,h=A*P)}h*=this._updateTimeScale(a);const M=this._updateTime(h),N=this._updateWeight(a);if(N>0){const P=this._interpolants,F=this._propertyBindings;switch(this.blendMode){case Lr:for(let z=0,X=P.length;z!==X;++z)P[z].evaluate(M),F[z].accumulateAdditive(N);break;case cs:default:for(let z=0,X=P.length;z!==X;++z)P[z].evaluate(M),F[z].accumulate(b,N)}}}_updateWeight(a){let h=0;if(this.enabled){h=this.weight;const A=this._weightInterpolant;if(A!==null){const b=A.evaluate(a)[0];h*=b,a>A.parameterPositions[1]&&(this.stopFading(),b===0&&(this.enabled=!1))}}return this._effectiveWeight=h,h}_updateTimeScale(a){let h=0;if(!this.paused){h=this.timeScale;const A=this._timeScaleInterpolant;if(A!==null){const b=A.evaluate(a)[0];h*=b,a>A.parameterPositions[1]&&(this.stopWarping(),h===0?this.paused=!0:this.timeScale=h)}}return this._effectiveTimeScale=h,h}_updateTime(a){const h=this._clip.duration,A=this.loop;let b=this.time+a,E=this._loopCount;const M=A===Hi;if(a===0)return E===-1?b:M&&(E&1)===1?h-b:b;if(A===dr){E===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));i:{if(b>=h)b=h;else if(b<0)b=0;else{this.time=b;break i}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=b,this._mixer.dispatchEvent({type:"finished",action:this,direction:a<0?-1:1})}}else{if(E===-1&&(a>=0?(E=0,this._setEndings(!0,this.repetitions===0,M)):this._setEndings(this.repetitions===0,!0,M)),b>=h||b<0){const N=Math.floor(b/h);b-=h*N,E+=Math.abs(N);const P=this.repetitions-E;if(P<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=a>0?h:0,this.time=b,this._mixer.dispatchEvent({type:"finished",action:this,direction:a>0?1:-1});else{if(P===1){const F=a<0;this._setEndings(F,!F,M)}else this._setEndings(!1,!1,M);this._loopCount=E,this.time=b,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:N})}}else this.time=b;if(M&&(E&1)===1)return h-b}return b}_setEndings(a,h,A){const b=this._interpolantSettings;A?(b.endingStart=vn,b.endingEnd=vn):(a?b.endingStart=this.zeroSlopeAtStart?vn:jr:b.endingStart=zr,h?b.endingEnd=this.zeroSlopeAtEnd?vn:jr:b.endingEnd=zr)}_scheduleFading(a,h,A){const b=this._mixer,E=b.time;let M=this._weightInterpolant;M===null&&(M=b._lendControlInterpolant(),this._weightInterpolant=M);const N=M.parameterPositions,P=M.sampleValues;return N[0]=E,P[0]=h,N[1]=E+a,P[1]=A,this}}const BTe=new Float32Array(1);class NTe extends Eo{constructor(a){super(),this._root=a,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(a,h){const A=a._localRoot||this._root,b=a._clip.tracks,E=b.length,M=a._propertyBindings,N=a._interpolants,P=A.uuid,F=this._bindingsByRootAndName;let z=F[P];z===void 0&&(z={},F[P]=z);for(let X=0;X!==E;++X){const q=b[X],K=q.name;let te=z[K];if(te!==void 0)++te.referenceCount,M[X]=te;else{if(te=M[X],te!==void 0){te._cacheIndex===null&&(++te.referenceCount,this._addInactiveBinding(te,P,K));continue}const oe=h&&h._propertyBindings[X].binding.parsedPath;te=new BV(kn.create(A,K,oe),q.ValueTypeName,q.getValueSize()),++te.referenceCount,this._addInactiveBinding(te,P,K),M[X]=te}N[X].resultBuffer=te.buffer}}_activateAction(a){if(!this._isActiveAction(a)){if(a._cacheIndex===null){const A=(a._localRoot||this._root).uuid,b=a._clip.uuid,E=this._actionsByClip[b];this._bindAction(a,E&&E.knownActions[0]),this._addInactiveAction(a,b,A)}const h=a._propertyBindings;for(let A=0,b=h.length;A!==b;++A){const E=h[A];E.useCount++===0&&(this._lendBinding(E),E.saveOriginalState())}this._lendAction(a)}}_deactivateAction(a){if(this._isActiveAction(a)){const h=a._propertyBindings;for(let A=0,b=h.length;A!==b;++A){const E=h[A];--E.useCount===0&&(E.restoreOriginalState(),this._takeBackBinding(E))}this._takeBackAction(a)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}}_isActiveAction(a){const h=a._cacheIndex;return h!==null&&h<this._nActiveActions}_addInactiveAction(a,h,A){const b=this._actions,E=this._actionsByClip;let M=E[h];if(M===void 0)M={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,E[h]=M;else{const N=M.knownActions;a._byClipCacheIndex=N.length,N.push(a)}a._cacheIndex=b.length,b.push(a),M.actionByRoot[A]=a}_removeInactiveAction(a){const h=this._actions,A=h[h.length-1],b=a._cacheIndex;A._cacheIndex=b,h[b]=A,h.pop(),a._cacheIndex=null;const E=a._clip.uuid,M=this._actionsByClip,N=M[E],P=N.knownActions,F=P[P.length-1],z=a._byClipCacheIndex;F._byClipCacheIndex=z,P[z]=F,P.pop(),a._byClipCacheIndex=null;const X=N.actionByRoot,q=(a._localRoot||this._root).uuid;delete X[q],P.length===0&&delete M[E],this._removeInactiveBindingsForAction(a)}_removeInactiveBindingsForAction(a){const h=a._propertyBindings;for(let A=0,b=h.length;A!==b;++A){const E=h[A];--E.referenceCount===0&&this._removeInactiveBinding(E)}}_lendAction(a){const h=this._actions,A=a._cacheIndex,b=this._nActiveActions++,E=h[b];a._cacheIndex=b,h[b]=a,E._cacheIndex=A,h[A]=E}_takeBackAction(a){const h=this._actions,A=a._cacheIndex,b=--this._nActiveActions,E=h[b];a._cacheIndex=b,h[b]=a,E._cacheIndex=A,h[A]=E}_addInactiveBinding(a,h,A){const b=this._bindingsByRootAndName,E=this._bindings;let M=b[h];M===void 0&&(M={},b[h]=M),M[A]=a,a._cacheIndex=E.length,E.push(a)}_removeInactiveBinding(a){const h=this._bindings,A=a.binding,b=A.rootNode.uuid,E=A.path,M=this._bindingsByRootAndName,N=M[b],P=h[h.length-1],F=a._cacheIndex;P._cacheIndex=F,h[F]=P,h.pop(),delete N[E],Object.keys(N).length===0&&delete M[b]}_lendBinding(a){const h=this._bindings,A=a._cacheIndex,b=this._nActiveBindings++,E=h[b];a._cacheIndex=b,h[b]=a,E._cacheIndex=A,h[A]=E}_takeBackBinding(a){const h=this._bindings,A=a._cacheIndex,b=--this._nActiveBindings,E=h[b];a._cacheIndex=b,h[b]=a,E._cacheIndex=A,h[A]=E}_lendControlInterpolant(){const a=this._controlInterpolants,h=this._nActiveControlInterpolants++;let A=a[h];return A===void 0&&(A=new pN(new Float32Array(2),new Float32Array(2),1,BTe),A.__cacheIndex=h,a[h]=A),A}_takeBackControlInterpolant(a){const h=this._controlInterpolants,A=a.__cacheIndex,b=--this._nActiveControlInterpolants,E=h[b];a.__cacheIndex=b,h[b]=a,E.__cacheIndex=A,h[A]=E}clipAction(a,h,A){const b=h||this._root,E=b.uuid;let M=typeof a=="string"?Tv.findByName(b,a):a;const N=M!==null?M.uuid:a,P=this._actionsByClip[N];let F=null;if(A===void 0&&(M!==null?A=M.blendMode:A=cs),P!==void 0){const X=P.actionByRoot[E];if(X!==void 0&&X.blendMode===A)return X;F=P.knownActions[0],M===null&&(M=F._clip)}if(M===null)return null;const z=new NV(this,M,h,A);return this._bindAction(z,F),this._addInactiveAction(z,N,E),z}existingAction(a,h){const A=h||this._root,b=A.uuid,E=typeof a=="string"?Tv.findByName(A,a):a,M=E?E.uuid:a,N=this._actionsByClip[M];return N!==void 0&&N.actionByRoot[b]||null}stopAllAction(){const a=this._actions,h=this._nActiveActions;for(let A=h-1;A>=0;--A)a[A].stop();return this}update(a){a*=this.timeScale;const h=this._actions,A=this._nActiveActions,b=this.time+=a,E=Math.sign(a),M=this._accuIndex^=1;for(let F=0;F!==A;++F)h[F]._update(b,a,E,M);const N=this._bindings,P=this._nActiveBindings;for(let F=0;F!==P;++F)N[F].apply(M);return this}setTime(a){this.time=0;for(let h=0;h<this._actions.length;h++)this._actions[h].time=0;return this.update(a)}getRoot(){return this._root}uncacheClip(a){const h=this._actions,A=a.uuid,b=this._actionsByClip,E=b[A];if(E!==void 0){const M=E.knownActions;for(let N=0,P=M.length;N!==P;++N){const F=M[N];this._deactivateAction(F);const z=F._cacheIndex,X=h[h.length-1];F._cacheIndex=null,F._byClipCacheIndex=null,X._cacheIndex=z,h[z]=X,h.pop(),this._removeInactiveBindingsForAction(F)}delete b[A]}}uncacheRoot(a){const h=a.uuid,A=this._actionsByClip;for(const M in A){const N=A[M].actionByRoot,P=N[h];P!==void 0&&(this._deactivateAction(P),this._removeInactiveAction(P))}const b=this._bindingsByRootAndName,E=b[h];if(E!==void 0)for(const M in E){const N=E[M];N.restoreOriginalState(),this._removeInactiveBinding(N)}}uncacheAction(a,h){const A=this.existingAction(a,h);A!==null&&(this._deactivateAction(A),this._removeInactiveAction(A))}}class EN{constructor(a){this.value=a}clone(){return new EN(this.value.clone===void 0?this.value:this.value.clone())}}let LTe=0;class DTe extends Eo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:LTe++}),this.name="",this.usage=ef,this.uniforms=[]}add(a){return this.uniforms.push(a),this}remove(a){const h=this.uniforms.indexOf(a);return h!==-1&&this.uniforms.splice(h,1),this}setName(a){return this.name=a,this}setUsage(a){return this.usage=a,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(a){this.name=a.name,this.usage=a.usage;const h=a.uniforms;this.uniforms.length=0;for(let A=0,b=h.length;A<b;A++){const E=Array.isArray(h[A])?h[A]:[h[A]];for(let M=0;M<E.length;M++)this.uniforms.push(E[M].clone())}return this}clone(){return new this.constructor().copy(this)}}class OTe extends FE{constructor(a,h,A=1){super(a,h),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=A}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}clone(a){const h=super.clone(a);return h.meshPerAttribute=this.meshPerAttribute,h}toJSON(a){const h=super.toJSON(a);return h.isInstancedInterleavedBuffer=!0,h.meshPerAttribute=this.meshPerAttribute,h}}class PTe{constructor(a,h,A,b,E){this.isGLBufferAttribute=!0,this.name="",this.buffer=a,this.type=h,this.itemSize=A,this.elementSize=b,this.count=E,this.version=0}set needsUpdate(a){a===!0&&this.version++}setBuffer(a){return this.buffer=a,this}setType(a,h){return this.type=a,this.elementSize=h,this}setItemSize(a){return this.itemSize=a,this}setCount(a){return this.count=a,this}}const LV=new fr;class FTe{constructor(a,h,A=0,b=1/0){this.ray=new pa(a,h),this.near=A,this.far=b,this.camera=null,this.layers=new gE,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(a,h){this.ray.set(a,h)}setFromCamera(a,h){h.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(h.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(h).sub(this.ray.origin).normalize(),this.camera=h):h.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(h.near+h.far)/(h.near-h.far)).unproject(h),this.ray.direction.set(0,0,-1).transformDirection(h.matrixWorld),this.camera=h):console.error("THREE.Raycaster: Unsupported camera type: "+h.type)}setFromXRController(a){return LV.identity().extractRotation(a.matrixWorld),this.ray.origin.setFromMatrixPosition(a.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(LV),this}intersectObject(a,h=!0,A=[]){return wN(a,this,A,h),A.sort(DV),A}intersectObjects(a,h=!0,A=[]){for(let b=0,E=a.length;b<E;b++)wN(a[b],this,A,h);return A.sort(DV),A}}function DV(C,a){return C.distance-a.distance}function wN(C,a,h,A){if(C.layers.test(a.layers)&&C.raycast(a,h),A===!0){const b=C.children;for(let E=0,M=b.length;E<M;E++)wN(b[E],a,h,!0)}}class kTe{constructor(a=1,h=0,A=0){return this.radius=a,this.phi=h,this.theta=A,this}set(a,h,A){return this.radius=a,this.phi=h,this.theta=A,this}copy(a){return this.radius=a.radius,this.phi=a.phi,this.theta=a.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,h,A){return this.radius=Math.sqrt(a*a+h*h+A*A),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(a,A),this.phi=Math.acos(ws(h/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class UTe{constructor(a=1,h=0,A=0){return this.radius=a,this.theta=h,this.y=A,this}set(a,h,A){return this.radius=a,this.theta=h,this.y=A,this}copy(a){return this.radius=a.radius,this.theta=a.theta,this.y=a.y,this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,h,A){return this.radius=Math.sqrt(a*a+A*A),this.theta=Math.atan2(a,A),this.y=h,this}clone(){return new this.constructor().copy(this)}}const OV=new ni;class zTe{constructor(a=new ni(1/0,1/0),h=new ni(-1/0,-1/0)){this.isBox2=!0,this.min=a,this.max=h}set(a,h){return this.min.copy(a),this.max.copy(h),this}setFromPoints(a){this.makeEmpty();for(let h=0,A=a.length;h<A;h++)this.expandByPoint(a[h]);return this}setFromCenterAndSize(a,h){const A=OV.copy(h).multiplyScalar(.5);return this.min.copy(a).sub(A),this.max.copy(a).add(A),this}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(a){return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y}getParameter(a,h){return h.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)}clampPoint(a,h){return h.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,OV).distanceTo(a)}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const PV=new He,Ew=new He;class jTe{constructor(a=new He,h=new He){this.start=a,this.end=h}set(a,h){return this.start.copy(a),this.end.copy(h),this}copy(a){return this.start.copy(a.start),this.end.copy(a.end),this}getCenter(a){return a.addVectors(this.start,this.end).multiplyScalar(.5)}delta(a){return a.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(a,h){return this.delta(h).multiplyScalar(a).add(this.start)}closestPointToPointParameter(a,h){PV.subVectors(a,this.start),Ew.subVectors(this.end,this.start);const A=Ew.dot(Ew);let b=Ew.dot(PV)/A;return h&&(b=ws(b,0,1)),b}closestPointToPoint(a,h,A){const b=this.closestPointToPointParameter(a,h);return this.delta(A).multiplyScalar(b).add(this.start)}applyMatrix4(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this}equals(a){return a.start.equals(this.start)&&a.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const FV=new He;class VTe extends Vn{constructor(a,h){super(),this.light=a,this.matrixAutoUpdate=!1,this.color=h,this.type="SpotLightHelper";const A=new hn,b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let M=0,N=1,P=32;M<P;M++,N++){const F=M/P*Math.PI*2,z=N/P*Math.PI*2;b.push(Math.cos(F),Math.sin(F),1,Math.cos(z),Math.sin(z),1)}A.setAttribute("position",new vr(b,3));const E=new Mo({fog:!1,toneMapped:!1});this.cone=new Jc(A,E),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const a=this.light.distance?this.light.distance:1e3,h=a*Math.tan(this.light.angle);this.cone.scale.set(h,h,a),FV.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(FV),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ud=new He,ww=new fr,CN=new fr;class GTe extends Jc{constructor(a){const h=kV(a),A=new hn,b=[],E=[],M=new or(0,0,1),N=new or(0,1,0);for(let F=0;F<h.length;F++){const z=h[F];z.parent&&z.parent.isBone&&(b.push(0,0,0),b.push(0,0,0),E.push(M.r,M.g,M.b),E.push(N.r,N.g,N.b))}A.setAttribute("position",new vr(b,3)),A.setAttribute("color",new vr(E,3));const P=new Mo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(A,P),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=a,this.bones=h,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(a){const h=this.bones,A=this.geometry,b=A.getAttribute("position");CN.copy(this.root.matrixWorld).invert();for(let E=0,M=0;E<h.length;E++){const N=h[E];N.parent&&N.parent.isBone&&(ww.multiplyMatrices(CN,N.matrixWorld),Ud.setFromMatrixPosition(ww),b.setXYZ(M,Ud.x,Ud.y,Ud.z),ww.multiplyMatrices(CN,N.parent.matrixWorld),Ud.setFromMatrixPosition(ww),b.setXYZ(M+1,Ud.x,Ud.y,Ud.z),M+=2)}A.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose()}}function kV(C){const a=[];C.isBone===!0&&a.push(C);for(let h=0;h<C.children.length;h++)a.push.apply(a,kV(C.children[h]));return a}class HTe extends sa{constructor(a,h,A){const b=new Ev(h,4,2),E=new Bd({wireframe:!0,fog:!1,toneMapped:!1});super(b,E),this.light=a,this.color=A,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const WTe=new He,UV=new or,zV=new or;class QTe extends Vn{constructor(a,h,A){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=A,this.type="HemisphereLightHelper";const b=new _v(h);b.rotateY(Math.PI*.5),this.material=new Bd({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const E=b.getAttribute("position"),M=new Float32Array(E.count*3);b.setAttribute("color",new ns(M,3)),this.add(new sa(b,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const a=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const h=a.geometry.getAttribute("color");UV.copy(this.light.color),zV.copy(this.light.groundColor);for(let A=0,b=h.count;A<b;A++){const E=A<b/2?UV:zV;h.setXYZ(A,E.r,E.g,E.b)}h.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),a.lookAt(WTe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class qTe extends Jc{constructor(a=10,h=10,A=4473924,b=8947848){A=new or(A),b=new or(b);const E=h/2,M=a/h,N=a/2,P=[],F=[];for(let q=0,K=0,te=-N;q<=h;q++,te+=M){P.push(-N,0,te,N,0,te),P.push(te,0,-N,te,0,N);const oe=q===E?A:b;oe.toArray(F,K),K+=3,oe.toArray(F,K),K+=3,oe.toArray(F,K),K+=3,oe.toArray(F,K),K+=3}const z=new hn;z.setAttribute("position",new vr(P,3)),z.setAttribute("color",new vr(F,3));const X=new Mo({vertexColors:!0,toneMapped:!1});super(z,X),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class XTe extends Jc{constructor(a=10,h=16,A=8,b=64,E=4473924,M=8947848){E=new or(E),M=new or(M);const N=[],P=[];if(h>1)for(let X=0;X<h;X++){const q=X/h*(Math.PI*2),K=Math.sin(q)*a,te=Math.cos(q)*a;N.push(0,0,0),N.push(K,0,te);const oe=X&1?E:M;P.push(oe.r,oe.g,oe.b),P.push(oe.r,oe.g,oe.b)}for(let X=0;X<A;X++){const q=X&1?E:M,K=a-a/A*X;for(let te=0;te<b;te++){let oe=te/b*(Math.PI*2),ne=Math.sin(oe)*K,ee=Math.cos(oe)*K;N.push(ne,0,ee),P.push(q.r,q.g,q.b),oe=(te+1)/b*(Math.PI*2),ne=Math.sin(oe)*K,ee=Math.cos(oe)*K,N.push(ne,0,ee),P.push(q.r,q.g,q.b)}}const F=new hn;F.setAttribute("position",new vr(N,3)),F.setAttribute("color",new vr(P,3));const z=new Mo({vertexColors:!0,toneMapped:!1});super(F,z),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const jV=new He,Cw=new He,VV=new He;class YTe extends Vn{constructor(a,h,A){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=A,this.type="DirectionalLightHelper",h===void 0&&(h=1);let b=new hn;b.setAttribute("position",new vr([-h,h,0,h,h,0,h,-h,0,-h,-h,0,-h,h,0],3));const E=new Mo({fog:!1,toneMapped:!1});this.lightPlane=new Pd(b,E),this.add(this.lightPlane),b=new hn,b.setAttribute("position",new vr([0,0,0,0,0,1],3)),this.targetLine=new Pd(b,E),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),jV.setFromMatrixPosition(this.light.matrixWorld),Cw.setFromMatrixPosition(this.light.target.matrixWorld),VV.subVectors(Cw,jV),this.lightPlane.lookAt(Cw),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Cw),this.targetLine.scale.z=VV.length()}}const Sw=new He,ks=new ME;class KTe extends Jc{constructor(a){const h=new hn,A=new Mo({color:16777215,vertexColors:!0,toneMapped:!1}),b=[],E=[],M={};N("n1","n2"),N("n2","n4"),N("n4","n3"),N("n3","n1"),N("f1","f2"),N("f2","f4"),N("f4","f3"),N("f3","f1"),N("n1","f1"),N("n2","f2"),N("n3","f3"),N("n4","f4"),N("p","n1"),N("p","n2"),N("p","n3"),N("p","n4"),N("u1","u2"),N("u2","u3"),N("u3","u1"),N("c","t"),N("p","c"),N("cn1","cn2"),N("cn3","cn4"),N("cf1","cf2"),N("cf3","cf4");function N(te,oe){P(te),P(oe)}function P(te){b.push(0,0,0),E.push(0,0,0),M[te]===void 0&&(M[te]=[]),M[te].push(b.length/3-1)}h.setAttribute("position",new vr(b,3)),h.setAttribute("color",new vr(E,3)),super(h,A),this.type="CameraHelper",this.camera=a,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=M,this.update();const F=new or(16755200),z=new or(16711680),X=new or(43775),q=new or(16777215),K=new or(3355443);this.setColors(F,z,X,q,K)}setColors(a,h,A,b,E){const M=this.geometry.getAttribute("color");M.setXYZ(0,a.r,a.g,a.b),M.setXYZ(1,a.r,a.g,a.b),M.setXYZ(2,a.r,a.g,a.b),M.setXYZ(3,a.r,a.g,a.b),M.setXYZ(4,a.r,a.g,a.b),M.setXYZ(5,a.r,a.g,a.b),M.setXYZ(6,a.r,a.g,a.b),M.setXYZ(7,a.r,a.g,a.b),M.setXYZ(8,a.r,a.g,a.b),M.setXYZ(9,a.r,a.g,a.b),M.setXYZ(10,a.r,a.g,a.b),M.setXYZ(11,a.r,a.g,a.b),M.setXYZ(12,a.r,a.g,a.b),M.setXYZ(13,a.r,a.g,a.b),M.setXYZ(14,a.r,a.g,a.b),M.setXYZ(15,a.r,a.g,a.b),M.setXYZ(16,a.r,a.g,a.b),M.setXYZ(17,a.r,a.g,a.b),M.setXYZ(18,a.r,a.g,a.b),M.setXYZ(19,a.r,a.g,a.b),M.setXYZ(20,a.r,a.g,a.b),M.setXYZ(21,a.r,a.g,a.b),M.setXYZ(22,a.r,a.g,a.b),M.setXYZ(23,a.r,a.g,a.b),M.setXYZ(24,h.r,h.g,h.b),M.setXYZ(25,h.r,h.g,h.b),M.setXYZ(26,h.r,h.g,h.b),M.setXYZ(27,h.r,h.g,h.b),M.setXYZ(28,h.r,h.g,h.b),M.setXYZ(29,h.r,h.g,h.b),M.setXYZ(30,h.r,h.g,h.b),M.setXYZ(31,h.r,h.g,h.b),M.setXYZ(32,A.r,A.g,A.b),M.setXYZ(33,A.r,A.g,A.b),M.setXYZ(34,A.r,A.g,A.b),M.setXYZ(35,A.r,A.g,A.b),M.setXYZ(36,A.r,A.g,A.b),M.setXYZ(37,A.r,A.g,A.b),M.setXYZ(38,b.r,b.g,b.b),M.setXYZ(39,b.r,b.g,b.b),M.setXYZ(40,E.r,E.g,E.b),M.setXYZ(41,E.r,E.g,E.b),M.setXYZ(42,E.r,E.g,E.b),M.setXYZ(43,E.r,E.g,E.b),M.setXYZ(44,E.r,E.g,E.b),M.setXYZ(45,E.r,E.g,E.b),M.setXYZ(46,E.r,E.g,E.b),M.setXYZ(47,E.r,E.g,E.b),M.setXYZ(48,E.r,E.g,E.b),M.setXYZ(49,E.r,E.g,E.b),M.needsUpdate=!0}update(){const a=this.geometry,h=this.pointMap,A=1,b=1;ks.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Gs("c",h,a,ks,0,0,-1),Gs("t",h,a,ks,0,0,1),Gs("n1",h,a,ks,-1,-1,-1),Gs("n2",h,a,ks,A,-1,-1),Gs("n3",h,a,ks,-1,b,-1),Gs("n4",h,a,ks,A,b,-1),Gs("f1",h,a,ks,-1,-1,1),Gs("f2",h,a,ks,A,-1,1),Gs("f3",h,a,ks,-1,b,1),Gs("f4",h,a,ks,A,b,1),Gs("u1",h,a,ks,A*.7,b*1.1,-1),Gs("u2",h,a,ks,-.7,b*1.1,-1),Gs("u3",h,a,ks,0,b*2,-1),Gs("cf1",h,a,ks,-1,0,1),Gs("cf2",h,a,ks,A,0,1),Gs("cf3",h,a,ks,0,-1,1),Gs("cf4",h,a,ks,0,b,1),Gs("cn1",h,a,ks,-1,0,-1),Gs("cn2",h,a,ks,A,0,-1),Gs("cn3",h,a,ks,0,-1,-1),Gs("cn4",h,a,ks,0,b,-1),a.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Gs(C,a,h,A,b,E,M){Sw.set(b,E,M).unproject(A);const N=a[C];if(N!==void 0){const P=h.getAttribute("position");for(let F=0,z=N.length;F<z;F++)P.setXYZ(N[F],Sw.x,Sw.y,Sw.z)}}const Tw=new Is;class JTe extends Jc{constructor(a,h=16776960){const A=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),b=new Float32Array(8*3),E=new hn;E.setIndex(new ns(A,1)),E.setAttribute("position",new ns(b,3)),super(E,new Mo({color:h,toneMapped:!1})),this.object=a,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(a){if(a!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Tw.setFromObject(this.object),Tw.isEmpty())return;const h=Tw.min,A=Tw.max,b=this.geometry.attributes.position,E=b.array;E[0]=A.x,E[1]=A.y,E[2]=A.z,E[3]=h.x,E[4]=A.y,E[5]=A.z,E[6]=h.x,E[7]=h.y,E[8]=A.z,E[9]=A.x,E[10]=h.y,E[11]=A.z,E[12]=A.x,E[13]=A.y,E[14]=h.z,E[15]=h.x,E[16]=A.y,E[17]=h.z,E[18]=h.x,E[19]=h.y,E[20]=h.z,E[21]=A.x,E[22]=h.y,E[23]=h.z,b.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(a){return this.object=a,this.update(),this}copy(a,h){return super.copy(a,h),this.object=a.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ZTe extends Jc{constructor(a,h=16776960){const A=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),b=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],E=new hn;E.setIndex(new ns(A,1)),E.setAttribute("position",new vr(b,3)),super(E,new Mo({color:h,toneMapped:!1})),this.box=a,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(a){const h=this.box;h.isEmpty()||(h.getCenter(this.position),h.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(a))}dispose(){this.geometry.dispose(),this.material.dispose()}}class $Te extends Pd{constructor(a,h=1,A=16776960){const b=A,E=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],M=new hn;M.setAttribute("position",new vr(E,3)),M.computeBoundingSphere(),super(M,new Mo({color:b,toneMapped:!1})),this.type="PlaneHelper",this.plane=a,this.size=h;const N=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],P=new hn;P.setAttribute("position",new vr(N,3)),P.computeBoundingSphere(),this.add(new sa(P,new Bd({color:b,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(a){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const GV=new He;let Mw,SN;class eMe extends Vn{constructor(a=new He(0,0,1),h=new He(0,0,0),A=1,b=16776960,E=A*.2,M=E*.2){super(),this.type="ArrowHelper",Mw===void 0&&(Mw=new hn,Mw.setAttribute("position",new vr([0,0,0,0,1,0],3)),SN=new y0(0,.5,1,5,1),SN.translate(0,-.5,0)),this.position.copy(h),this.line=new Pd(Mw,new Mo({color:b,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new sa(SN,new Bd({color:b,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(a),this.setLength(A,E,M)}setDirection(a){if(a.y>.99999)this.quaternion.set(0,0,0,1);else if(a.y<-.99999)this.quaternion.set(1,0,0,0);else{GV.set(a.z,0,-a.x).normalize();const h=Math.acos(a.y);this.quaternion.setFromAxisAngle(GV,h)}}setLength(a,h=a*.2,A=h*.2){this.line.scale.set(1,Math.max(1e-4,a-h),1),this.line.updateMatrix(),this.cone.scale.set(A,h,A),this.cone.position.y=a,this.cone.updateMatrix()}setColor(a){this.line.material.color.set(a),this.cone.material.color.set(a)}copy(a){return super.copy(a,!1),this.line.copy(a.line),this.cone.copy(a.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class tMe extends Jc{constructor(a=1){const h=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a],A=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],b=new hn;b.setAttribute("position",new vr(h,3)),b.setAttribute("color",new vr(A,3));const E=new Mo({vertexColors:!0,toneMapped:!1});super(b,E),this.type="AxesHelper"}setColors(a,h,A){const b=new or,E=this.geometry.attributes.color.array;return b.set(a),b.toArray(E,0),b.toArray(E,3),b.set(h),b.toArray(E,6),b.toArray(E,9),b.set(A),b.toArray(E,12),b.toArray(E,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class iMe{constructor(){this.type="ShapePath",this.color=new or,this.subPaths=[],this.currentPath=null}moveTo(a,h){return this.currentPath=new Av,this.subPaths.push(this.currentPath),this.currentPath.moveTo(a,h),this}lineTo(a,h){return this.currentPath.lineTo(a,h),this}quadraticCurveTo(a,h,A,b){return this.currentPath.quadraticCurveTo(a,h,A,b),this}bezierCurveTo(a,h,A,b,E,M){return this.currentPath.bezierCurveTo(a,h,A,b,E,M),this}splineThru(a){return this.currentPath.splineThru(a),this}toShapes(a){function h(ee){const Me=[];for(let we=0,_e=ee.length;we<_e;we++){const nt=ee[we],qe=new mf;qe.curves=nt.curves,Me.push(qe)}return Me}function A(ee,Me){const we=Me.length;let _e=!1;for(let nt=we-1,qe=0;qe<we;nt=qe++){let Je=Me[nt],it=Me[qe],ze=it.x-Je.x,Oe=it.y-Je.y;if(Math.abs(Oe)>Number.EPSILON){if(Oe<0&&(Je=Me[qe],ze=-ze,it=Me[nt],Oe=-Oe),ee.y<Je.y||ee.y>it.y)continue;if(ee.y===Je.y){if(ee.x===Je.x)return!0}else{const rt=Oe*(ee.x-Je.x)-ze*(ee.y-Je.y);if(rt===0)return!0;if(rt<0)continue;_e=!_e}}else{if(ee.y!==Je.y)continue;if(it.x<=ee.x&&ee.x<=Je.x||Je.x<=ee.x&&ee.x<=it.x)return!0}}return _e}const b=Zc.isClockWise,E=this.subPaths;if(E.length===0)return[];let M,N,P;const F=[];if(E.length===1)return N=E[0],P=new mf,P.curves=N.curves,F.push(P),F;let z=!b(E[0].getPoints());z=a?!z:z;const X=[],q=[];let K=[],te=0,oe;q[te]=void 0,K[te]=[];for(let ee=0,Me=E.length;ee<Me;ee++)N=E[ee],oe=N.getPoints(),M=b(oe),M=a?!M:M,M?(!z&&q[te]&&te++,q[te]={s:new mf,p:oe},q[te].s.curves=N.curves,z&&te++,K[te]=[]):K[te].push({h:N,p:oe[0]});if(!q[0])return h(E);if(q.length>1){let ee=!1,Me=0;for(let we=0,_e=q.length;we<_e;we++)X[we]=[];for(let we=0,_e=q.length;we<_e;we++){const nt=K[we];for(let qe=0;qe<nt.length;qe++){const Je=nt[qe];let it=!0;for(let ze=0;ze<q.length;ze++)A(Je.p,q[ze].p)&&(we!==ze&&Me++,it?(it=!1,X[ze].push(Je)):ee=!0);it&&X[we].push(Je)}}Me>0&&ee===!1&&(K=X)}let ne;for(let ee=0,Me=q.length;ee<Me;ee++){P=q[ee].s,F.push(P),ne=K[ee];for(let we=0,_e=ne.length;we<_e;we++)P.holes.push(ne[we].h)}return F}}class rMe extends Xo{constructor(a=1,h=1,A=1,b={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(a,h,{...b,count:A}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:d}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=d)},"./node_modules/three/examples/jsm/libs/ktx-parse.module.js":(l,u,c)=>{c.r(u),c.d(u,{KHR_DF_CHANNEL_RGBSDA_ALPHA:()=>Jt,KHR_DF_CHANNEL_RGBSDA_BLUE:()=>Ce,KHR_DF_CHANNEL_RGBSDA_DEPTH:()=>Ot,KHR_DF_CHANNEL_RGBSDA_GREEN:()=>Qe,KHR_DF_CHANNEL_RGBSDA_RED:()=>Vi,KHR_DF_CHANNEL_RGBSDA_STENCIL:()=>yt,KHR_DF_FLAG_ALPHA_PREMULTIPLIED:()=>D,KHR_DF_FLAG_ALPHA_STRAIGHT:()=>I,KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT:()=>y,KHR_DF_MODEL_ASTC:()=>R,KHR_DF_MODEL_ETC1:()=>w,KHR_DF_MODEL_ETC1S:()=>B,KHR_DF_MODEL_ETC2:()=>S,KHR_DF_MODEL_RGBSDA:()=>T,KHR_DF_MODEL_UNSPECIFIED:()=>_,KHR_DF_PRIMARIES_ACES:()=>Ze,KHR_DF_PRIMARIES_ACESCC:()=>ki,KHR_DF_PRIMARIES_ADOBERGB:()=>tr,KHR_DF_PRIMARIES_BT2020:()=>gt,KHR_DF_PRIMARIES_BT601_EBU:()=>At,KHR_DF_PRIMARIES_BT601_SMPTE:()=>Gt,KHR_DF_PRIMARIES_BT709:()=>lt,KHR_DF_PRIMARIES_CIEXYZ:()=>yi,KHR_DF_PRIMARIES_DISPLAYP3:()=>Si,KHR_DF_PRIMARIES_NTSC1953:()=>hi,KHR_DF_PRIMARIES_PAL525:()=>Ri,KHR_DF_PRIMARIES_UNSPECIFIED:()=>$e,KHR_DF_SAMPLE_DATATYPE_EXPONENT:()=>vt,KHR_DF_SAMPLE_DATATYPE_FLOAT:()=>zt,KHR_DF_SAMPLE_DATATYPE_LINEAR:()=>ye,KHR_DF_SAMPLE_DATATYPE_SIGNED:()=>xi,KHR_DF_TRANSFER_ACESCC:()=>Ie,KHR_DF_TRANSFER_ACESCCT:()=>Ge,KHR_DF_TRANSFER_ADOBERGB:()=>Xe,KHR_DF_TRANSFER_BT1886:()=>Q,KHR_DF_TRANSFER_DCIP3:()=>ae,KHR_DF_TRANSFER_HLG_EOTF:()=>j,KHR_DF_TRANSFER_HLG_OETF:()=>G,KHR_DF_TRANSFER_ITU:()=>J,KHR_DF_TRANSFER_LINEAR:()=>O,KHR_DF_TRANSFER_NTSC:()=>H,KHR_DF_TRANSFER_PAL625_EOTF:()=>fe,KHR_DF_TRANSFER_PAL_OETF:()=>xe,KHR_DF_TRANSFER_PQ_EOTF:()=>ie,KHR_DF_TRANSFER_PQ_OETF:()=>Y,KHR_DF_TRANSFER_SLOG:()=>V,KHR_DF_TRANSFER_SLOG2:()=>$,KHR_DF_TRANSFER_SRGB:()=>U,KHR_DF_TRANSFER_ST240:()=>de,KHR_DF_TRANSFER_UNSPECIFIED:()=>L,KHR_DF_VENDORID_KHRONOS:()=>x,KHR_DF_VERSION:()=>v,KHR_SUPERCOMPRESSION_BASISLZ:()=>f,KHR_SUPERCOMPRESSION_NONE:()=>p,KHR_SUPERCOMPRESSION_ZLIB:()=>g,KHR_SUPERCOMPRESSION_ZSTD:()=>m,KTX2Container:()=>hh,VK_FORMAT_A1R5G5B5_UNORM_PACK16:()=>Re,VK_FORMAT_A2B10G10R10_SINT_PACK32:()=>ti,VK_FORMAT_A2B10G10R10_SNORM_PACK32:()=>Kt,VK_FORMAT_A2B10G10R10_UINT_PACK32:()=>Rt,VK_FORMAT_A2B10G10R10_UNORM_PACK32:()=>qt,VK_FORMAT_A2R10G10B10_SINT_PACK32:()=>wt,VK_FORMAT_A2R10G10B10_SNORM_PACK32:()=>Ke,VK_FORMAT_A2R10G10B10_UINT_PACK32:()=>ot,VK_FORMAT_A2R10G10B10_UNORM_PACK32:()=>ke,VK_FORMAT_A4B4G4R4_UNORM_PACK16_EXT:()=>$y,VK_FORMAT_A4R4G4B4_UNORM_PACK16_EXT:()=>Sd,VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT:()=>Vg,VK_FORMAT_ASTC_10x10_SRGB_BLOCK:()=>ws,VK_FORMAT_ASTC_10x10_UNORM_BLOCK:()=>wo,VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT:()=>uE,VK_FORMAT_ASTC_10x5_SRGB_BLOCK:()=>Eo,VK_FORMAT_ASTC_10x5_UNORM_BLOCK:()=>tf,VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT:()=>hE,VK_FORMAT_ASTC_10x6_SRGB_BLOCK:()=>aE,VK_FORMAT_ASTC_10x6_UNORM_BLOCK:()=>Sa,VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT:()=>dE,VK_FORMAT_ASTC_10x8_SRGB_BLOCK:()=>wd,VK_FORMAT_ASTC_10x8_UNORM_BLOCK:()=>uh,VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT:()=>mB,VK_FORMAT_ASTC_12x10_SRGB_BLOCK:()=>JI,VK_FORMAT_ASTC_12x10_UNORM_BLOCK:()=>Jy,VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT:()=>Xn,VK_FORMAT_ASTC_12x12_SRGB_BLOCK:()=>rf,VK_FORMAT_ASTC_12x12_UNORM_BLOCK:()=>ZI,VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT:()=>qr,VK_FORMAT_ASTC_4x4_SRGB_BLOCK:()=>rE,VK_FORMAT_ASTC_4x4_UNORM_BLOCK:()=>iE,VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT:()=>Zy,VK_FORMAT_ASTC_5x4_SRGB_BLOCK:()=>sE,VK_FORMAT_ASTC_5x4_UNORM_BLOCK:()=>nE,VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT:()=>oE,VK_FORMAT_ASTC_5x5_SRGB_BLOCK:()=>VI,VK_FORMAT_ASTC_5x5_UNORM_BLOCK:()=>ef,VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT:()=>fB,VK_FORMAT_ASTC_6x5_SRGB_BLOCK:()=>HI,VK_FORMAT_ASTC_6x5_UNORM_BLOCK:()=>GI,VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT:()=>Cd,VK_FORMAT_ASTC_6x6_SRGB_BLOCK:()=>QI,VK_FORMAT_ASTC_6x6_UNORM_BLOCK:()=>WI,VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT:()=>nf,VK_FORMAT_ASTC_8x5_SRGB_BLOCK:()=>XI,VK_FORMAT_ASTC_8x5_UNORM_BLOCK:()=>qI,VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT:()=>lE,VK_FORMAT_ASTC_8x6_SRGB_BLOCK:()=>KI,VK_FORMAT_ASTC_8x6_UNORM_BLOCK:()=>YI,VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT:()=>cE,VK_FORMAT_ASTC_8x8_SRGB_BLOCK:()=>Pl,VK_FORMAT_ASTC_8x8_UNORM_BLOCK:()=>Ky,VK_FORMAT_B10G11R11_UFLOAT_PACK32:()=>qo,VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16:()=>rB,VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16:()=>lB,VK_FORMAT_B4G4R4A4_UNORM_PACK16:()=>Fe,VK_FORMAT_B5G5R5A1_UNORM_PACK16:()=>re,VK_FORMAT_B5G6R5_UNORM_PACK16:()=>k,VK_FORMAT_B8G8R8A8_SINT:()=>ge,VK_FORMAT_B8G8R8A8_SNORM:()=>Be,VK_FORMAT_B8G8R8A8_SRGB:()=>Ne,VK_FORMAT_B8G8R8A8_UINT:()=>se,VK_FORMAT_B8G8R8A8_UNORM:()=>Oi,VK_FORMAT_B8G8R8_SINT:()=>me,VK_FORMAT_B8G8R8_SNORM:()=>$n,VK_FORMAT_B8G8R8_SRGB:()=>ct,VK_FORMAT_B8G8R8_UINT:()=>As,VK_FORMAT_B8G8R8_UNORM:()=>Rs,VK_FORMAT_BC1_RGBA_SRGB_BLOCK:()=>os,VK_FORMAT_BC1_RGBA_UNORM_BLOCK:()=>Jp,VK_FORMAT_BC1_RGB_SRGB_BLOCK:()=>Kp,VK_FORMAT_BC1_RGB_UNORM_BLOCK:()=>jg,VK_FORMAT_BC2_SRGB_BLOCK:()=>$p,VK_FORMAT_BC2_UNORM_BLOCK:()=>Zp,VK_FORMAT_BC3_SRGB_BLOCK:()=>ch,VK_FORMAT_BC3_UNORM_BLOCK:()=>MI,VK_FORMAT_BC4_SNORM_BLOCK:()=>II,VK_FORMAT_BC4_UNORM_BLOCK:()=>RI,VK_FORMAT_BC5_SNORM_BLOCK:()=>NI,VK_FORMAT_BC5_UNORM_BLOCK:()=>BI,VK_FORMAT_BC6H_SFLOAT_BLOCK:()=>DI,VK_FORMAT_BC6H_UFLOAT_BLOCK:()=>LI,VK_FORMAT_BC7_SRGB_BLOCK:()=>PI,VK_FORMAT_BC7_UNORM_BLOCK:()=>OI,VK_FORMAT_D16_UNORM:()=>Qc,VK_FORMAT_D16_UNORM_S8_UINT:()=>ja,VK_FORMAT_D24_UNORM_S8_UINT:()=>Ln,VK_FORMAT_D32_SFLOAT:()=>io,VK_FORMAT_D32_SFLOAT_S8_UINT:()=>Ec,VK_FORMAT_E5B9G9R9_UFLOAT_PACK32:()=>_c,VK_FORMAT_EAC_R11G11_SNORM_BLOCK:()=>Yy,VK_FORMAT_EAC_R11G11_UNORM_BLOCK:()=>tE,VK_FORMAT_EAC_R11_SNORM_BLOCK:()=>eE,VK_FORMAT_EAC_R11_UNORM_BLOCK:()=>$_,VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK:()=>zI,VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK:()=>UI,VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK:()=>Xy,VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK:()=>jI,VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK:()=>kI,VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK:()=>FI,VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16:()=>iB,VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16:()=>oB,VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG:()=>Va,VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG:()=>cB,VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG:()=>Yr,VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG:()=>uB,VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG:()=>pB,VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG:()=>hB,VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG:()=>ni,VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG:()=>dB,VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16:()=>tB,VK_FORMAT_R10X6G10X6_UNORM_2PACK16:()=>eB,VK_FORMAT_R10X6_UNORM_PACK16:()=>$I,VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16:()=>aB,VK_FORMAT_R12X4G12X4_UNORM_2PACK16:()=>sB,VK_FORMAT_R12X4_UNORM_PACK16:()=>nB,VK_FORMAT_R16G16B16A16_SFLOAT:()=>he,VK_FORMAT_R16G16B16A16_SINT:()=>ft,VK_FORMAT_R16G16B16A16_SNORM:()=>We,VK_FORMAT_R16G16B16A16_UINT:()=>Ye,VK_FORMAT_R16G16B16A16_UNORM:()=>Se,VK_FORMAT_R16G16B16_SFLOAT:()=>Ae,VK_FORMAT_R16G16B16_SINT:()=>ue,VK_FORMAT_R16G16B16_SNORM:()=>Qr,VK_FORMAT_R16G16B16_UINT:()=>W,VK_FORMAT_R16G16B16_UNORM:()=>un,VK_FORMAT_R16G16_SFLOAT:()=>ar,VK_FORMAT_R16G16_SINT:()=>Mi,VK_FORMAT_R16G16_SNORM:()=>Tn,VK_FORMAT_R16G16_UINT:()=>qn,VK_FORMAT_R16G16_UNORM:()=>vi,VK_FORMAT_R16_SFLOAT:()=>Ji,VK_FORMAT_R16_SINT:()=>ur,VK_FORMAT_R16_SNORM:()=>Fi,VK_FORMAT_R16_UINT:()=>Cr,VK_FORMAT_R16_UNORM:()=>bi,VK_FORMAT_R32G32B32A32_SFLOAT:()=>yr,VK_FORMAT_R32G32B32A32_SINT:()=>Bi,VK_FORMAT_R32G32B32A32_UINT:()=>Wt,VK_FORMAT_R32G32B32_SFLOAT:()=>mi,VK_FORMAT_R32G32B32_SINT:()=>ii,VK_FORMAT_R32G32B32_UINT:()=>Ht,VK_FORMAT_R32G32_SFLOAT:()=>Ct,VK_FORMAT_R32G32_SINT:()=>st,VK_FORMAT_R32G32_UINT:()=>Ee,VK_FORMAT_R32_SFLOAT:()=>be,VK_FORMAT_R32_SINT:()=>pe,VK_FORMAT_R32_UINT:()=>le,VK_FORMAT_R4G4B4A4_UNORM_PACK16:()=>Te,VK_FORMAT_R4G4_UNORM_PACK8:()=>Le,VK_FORMAT_R5G5B5A1_UNORM_PACK16:()=>Z,VK_FORMAT_R5G6B5_UNORM_PACK16:()=>Pe,VK_FORMAT_R64G64B64A64_SFLOAT:()=>gl,VK_FORMAT_R64G64B64A64_SINT:()=>Lr,VK_FORMAT_R64G64B64A64_UINT:()=>cs,VK_FORMAT_R64G64B64_SFLOAT:()=>zr,VK_FORMAT_R64G64B64_SINT:()=>vn,VK_FORMAT_R64G64B64_UINT:()=>jr,VK_FORMAT_R64G64_SFLOAT:()=>Fr,VK_FORMAT_R64G64_SINT:()=>Sr,VK_FORMAT_R64G64_UINT:()=>Er,VK_FORMAT_R64_SFLOAT:()=>Hi,VK_FORMAT_R64_SINT:()=>pr,VK_FORMAT_R64_UINT:()=>dr,VK_FORMAT_R8G8B8A8_SINT:()=>sr,VK_FORMAT_R8G8B8A8_SNORM:()=>Xt,VK_FORMAT_R8G8B8A8_SRGB:()=>Ni,VK_FORMAT_R8G8B8A8_UINT:()=>Ii,VK_FORMAT_R8G8B8A8_UNORM:()=>St,VK_FORMAT_R8G8B8_SINT:()=>gs,VK_FORMAT_R8G8B8_SNORM:()=>Pr,VK_FORMAT_R8G8B8_SRGB:()=>mn,VK_FORMAT_R8G8B8_UINT:()=>tn,VK_FORMAT_R8G8B8_UNORM:()=>fn,VK_FORMAT_R8G8_SINT:()=>br,VK_FORMAT_R8G8_SNORM:()=>Ut,VK_FORMAT_R8G8_SRGB:()=>Pi,VK_FORMAT_R8G8_UINT:()=>di,VK_FORMAT_R8G8_UNORM:()=>bt,VK_FORMAT_R8_SINT:()=>dt,VK_FORMAT_R8_SNORM:()=>Ue,VK_FORMAT_R8_SRGB:()=>Bt,VK_FORMAT_R8_UINT:()=>je,VK_FORMAT_R8_UNORM:()=>ce,VK_FORMAT_S8_UINT:()=>Xc,VK_FORMAT_UNDEFINED:()=>ve,VK_FORMAT_X8_D24_UNORM_PACK32:()=>qc,read:()=>Fn,write:()=>Wg});var d=c("./node_modules/buffer/index.js").Buffer;const p=0,f=1,m=2,g=3,y=0,x=0,v=2,_=0,T=1,w=160,S=161,R=162,B=163,I=0,D=1,L=0,O=1,U=2,J=3,H=4,V=5,$=6,Q=7,G=8,j=9,ie=10,Y=11,ae=12,xe=13,fe=14,de=15,Ie=16,Ge=17,Xe=18,$e=0,lt=1,At=2,Gt=3,gt=4,yi=5,Ze=6,ki=7,hi=8,Ri=9,Si=10,tr=11,Vi=0,Qe=1,Ce=2,yt=13,Ot=14,Jt=15,zt=128,xi=64,vt=32,ye=16,ve=0,Le=1,Te=2,Fe=3,Pe=4,k=5,Z=6,re=7,Re=8,ce=9,Ue=10,je=13,dt=14,Bt=15,bt=16,Ut=17,di=20,br=21,Pi=22,fn=23,Pr=24,tn=27,gs=28,mn=29,Rs=30,$n=31,As=34,me=35,ct=36,St=37,Xt=38,Ii=41,sr=42,Ni=43,Oi=44,Be=45,se=48,ge=49,Ne=50,ke=58,Ke=59,ot=62,wt=63,qt=64,Kt=65,Rt=68,ti=69,bi=70,Fi=71,Cr=74,ur=75,Ji=76,vi=77,Tn=78,qn=81,Mi=82,ar=83,un=84,Qr=85,W=88,ue=89,Ae=90,Se=91,We=92,Ye=95,ft=96,he=97,le=98,pe=99,be=100,Ee=101,st=102,Ct=103,Ht=104,ii=105,mi=106,Wt=107,Bi=108,yr=109,dr=110,pr=111,Hi=112,Er=113,Sr=114,Fr=115,jr=116,vn=117,zr=118,cs=119,Lr=120,gl=121,qo=122,_c=123,Qc=124,qc=125,io=126,Xc=127,ja=128,Ln=129,Ec=130,jg=131,Kp=132,Jp=133,os=134,Zp=135,$p=136,MI=137,ch=138,RI=139,II=140,BI=141,NI=142,LI=143,DI=144,OI=145,PI=146,FI=147,kI=148,UI=149,zI=150,jI=151,Xy=152,$_=153,eE=154,tE=155,Yy=156,iE=157,rE=158,nE=159,sE=160,ef=161,VI=162,GI=163,HI=164,WI=165,QI=166,qI=167,XI=168,YI=169,KI=170,Ky=171,Pl=172,tf=173,Eo=174,Sa=175,aE=176,uh=177,wd=178,wo=179,ws=180,Jy=181,JI=182,ZI=183,rf=184,$I=1000156007,eB=1000156008,tB=1000156009,iB=1000156010,rB=1000156011,nB=1000156017,sB=1000156018,aB=1000156019,oB=1000156020,lB=1000156021,cB=1000054e3,uB=1000054001,hB=1000054002,dB=1000054003,Va=1000054004,Yr=1000054005,pB=1000054006,ni=1000054007,qr=1000066e3,Zy=1000066001,oE=1000066002,fB=1000066003,Cd=1000066004,nf=1000066005,lE=1000066006,cE=1000066007,uE=1000066008,hE=1000066009,dE=1000066010,Vg=1000066011,mB=1000066012,Xn=1000066013,Sd=100034e4,$y=1000340001;class hh{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Td{constructor(Xr,Rn,jn,He){this._dataView=new DataView(Xr.buffer,Xr.byteOffset+Rn,jn),this._littleEndian=He,this._offset=0}_nextUint8(){const Xr=this._dataView.getUint8(this._offset);return this._offset+=1,Xr}_nextUint16(){const Xr=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,Xr}_nextUint32(){const Xr=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,Xr}_nextUint64(){const Xr=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,Xr}_nextInt32(){const Xr=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,Xr}_skip(Xr){return this._offset+=Xr,this}_scan(Xr,Rn=0){const jn=this._offset;let He=0;for(;this._dataView.getUint8(this._offset)!==Rn&&He<Xr;)He++,this._offset++;return He<Xr&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+jn,He)}}const pE=new Uint8Array([0]),ys=[171,75,84,88,32,50,48,187,13,10,26,10];function Gg(hr){return typeof TextEncoder<"u"?new TextEncoder().encode(hr):d.from(hr)}function fE(hr){return typeof TextDecoder<"u"?new TextDecoder().decode(hr):d.from(hr).toString("utf8")}function us(hr){let Xr=0;for(const He of hr)Xr+=He.byteLength;const Rn=new Uint8Array(Xr);let jn=0;for(const He of hr)Rn.set(new Uint8Array(He),jn),jn+=He.byteLength;return Rn}function Fn(hr){const Xr=new Uint8Array(hr.buffer,hr.byteOffset,ys.length);if(Xr[0]!==ys[0]||Xr[1]!==ys[1]||Xr[2]!==ys[2]||Xr[3]!==ys[3]||Xr[4]!==ys[4]||Xr[5]!==ys[5]||Xr[6]!==ys[6]||Xr[7]!==ys[7]||Xr[8]!==ys[8]||Xr[9]!==ys[9]||Xr[10]!==ys[10]||Xr[11]!==ys[11])throw new Error("Missing KTX 2.0 identifier.");const Rn=new hh,jn=17*Uint32Array.BYTES_PER_ELEMENT,He=new Td(hr,ys.length,jn,!0);Rn.vkFormat=He._nextUint32(),Rn.typeSize=He._nextUint32(),Rn.pixelWidth=He._nextUint32(),Rn.pixelHeight=He._nextUint32(),Rn.pixelDepth=He._nextUint32(),Rn.layerCount=He._nextUint32(),Rn.faceCount=He._nextUint32();const Al=He._nextUint32();Rn.supercompressionScheme=He._nextUint32();const Fs=He._nextUint32(),Is=He._nextUint32(),_n=He._nextUint32(),ro=He._nextUint32(),Yc=He._nextUint64(),Yo=He._nextUint64(),Ta=new Td(hr,ys.length+jn,3*Al*8,!0);for(let pa=0;pa<Al;pa++)Rn.levels.push({levelData:new Uint8Array(hr.buffer,hr.byteOffset+Ta._nextUint64(),Ta._nextUint64()),uncompressedByteLength:Ta._nextUint64()});const rn=new Td(hr,Fs,Is,!0),Ga={vendorId:rn._skip(4)._nextUint16(),descriptorType:rn._nextUint16(),versionNumber:rn._nextUint16(),descriptorBlockSize:rn._nextUint16(),colorModel:rn._nextUint8(),colorPrimaries:rn._nextUint8(),transferFunction:rn._nextUint8(),flags:rn._nextUint8(),texelBlockDimension:[rn._nextUint8(),rn._nextUint8(),rn._nextUint8(),rn._nextUint8()],bytesPlane:[rn._nextUint8(),rn._nextUint8(),rn._nextUint8(),rn._nextUint8(),rn._nextUint8(),rn._nextUint8(),rn._nextUint8(),rn._nextUint8()],samples:[]},yl=(Ga.descriptorBlockSize/4-6)/4;for(let pa=0;pa<yl;pa++){const fr={bitOffset:rn._nextUint16(),bitLength:rn._nextUint8(),channelType:rn._nextUint8(),samplePosition:[rn._nextUint8(),rn._nextUint8(),rn._nextUint8(),rn._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&fr.channelType?(fr.sampleLower=rn._nextInt32(),fr.sampleUpper=rn._nextInt32()):(fr.sampleLower=rn._nextUint32(),fr.sampleUpper=rn._nextUint32()),Ga.samples[pa]=fr}Rn.dataFormatDescriptor.length=0,Rn.dataFormatDescriptor.push(Ga);const Ma=new Td(hr,_n,ro,!0);for(;Ma._offset<ro;){const pa=Ma._nextUint32(),fr=Ma._scan(pa),ph=fE(fr),Ko=Ma._scan(pa-fr.byteLength);Rn.keyValue[ph]=ph.match(/^ktx/i)?fE(Ko):Ko,Ma._offset%4&&Ma._skip(4-Ma._offset%4)}if(Yo<=0)return Rn;const Dn=new Td(hr,Yc,Yo,!0),rs=Dn._nextUint16(),nn=Dn._nextUint16(),On=Dn._nextUint32(),Co=Dn._nextUint32(),Md=Dn._nextUint32(),dh=Dn._nextUint32(),Qg=[];for(let pa=0;pa<Al;pa++)Qg.push({imageFlags:Dn._nextUint32(),rgbSliceByteOffset:Dn._nextUint32(),rgbSliceByteLength:Dn._nextUint32(),alphaSliceByteOffset:Dn._nextUint32(),alphaSliceByteLength:Dn._nextUint32()});const da=Yc+Dn._offset,Fl=da+On,qg=Fl+Co,Xg=qg+Md,Kc=new Uint8Array(hr.buffer,hr.byteOffset+da,On),ev=new Uint8Array(hr.buffer,hr.byteOffset+Fl,Co),Yg=new Uint8Array(hr.buffer,hr.byteOffset+qg,Md),tv=new Uint8Array(hr.buffer,hr.byteOffset+Xg,dh);return Rn.globalData={endpointCount:rs,selectorCount:nn,imageDescs:Qg,endpointsData:Kc,selectorsData:ev,tablesData:Yg,extendedData:tv},Rn}function Hg(){return(Hg=Object.assign||function(hr){for(var Xr=1;Xr<arguments.length;Xr++){var Rn=arguments[Xr];for(var jn in Rn)Object.prototype.hasOwnProperty.call(Rn,jn)&&(hr[jn]=Rn[jn])}return hr}).apply(this,arguments)}const Xo={keepWriter:!1};function Wg(hr,Xr={}){Xr=Hg({},Xo,Xr);let Rn=new ArrayBuffer(0);if(hr.globalData){const rs=new ArrayBuffer(20+5*hr.globalData.imageDescs.length*4),nn=new DataView(rs);nn.setUint16(0,hr.globalData.endpointCount,!0),nn.setUint16(2,hr.globalData.selectorCount,!0),nn.setUint32(4,hr.globalData.endpointsData.byteLength,!0),nn.setUint32(8,hr.globalData.selectorsData.byteLength,!0),nn.setUint32(12,hr.globalData.tablesData.byteLength,!0),nn.setUint32(16,hr.globalData.extendedData.byteLength,!0);for(let On=0;On<hr.globalData.imageDescs.length;On++){const Co=hr.globalData.imageDescs[On];nn.setUint32(20+5*On*4+0,Co.imageFlags,!0),nn.setUint32(20+5*On*4+4,Co.rgbSliceByteOffset,!0),nn.setUint32(20+5*On*4+8,Co.rgbSliceByteLength,!0),nn.setUint32(20+5*On*4+12,Co.alphaSliceByteOffset,!0),nn.setUint32(20+5*On*4+16,Co.alphaSliceByteLength,!0)}Rn=us([rs,hr.globalData.endpointsData,hr.globalData.selectorsData,hr.globalData.tablesData,hr.globalData.extendedData])}const jn=[];let He=hr.keyValue;Xr.keepWriter||(He=Hg({},hr.keyValue,{KTXwriter:"KTX-Parse v0.3.1"}));for(const rs in He){const nn=He[rs],On=Gg(rs),Co=typeof nn=="string"?Gg(nn):nn,Md=On.byteLength+1+Co.byteLength+1,dh=Md%4?4-Md%4:0;jn.push(us([new Uint32Array([Md]),On,pE,Co,pE,new Uint8Array(dh).fill(0)]))}const Al=us(jn);if(hr.dataFormatDescriptor.length!==1||hr.dataFormatDescriptor[0].descriptorType!==0)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");const Fs=hr.dataFormatDescriptor[0],Is=new ArrayBuffer(28+16*Fs.samples.length),_n=new DataView(Is),ro=24+16*Fs.samples.length;if(_n.setUint32(0,Is.byteLength,!0),_n.setUint16(4,Fs.vendorId,!0),_n.setUint16(6,Fs.descriptorType,!0),_n.setUint16(8,Fs.versionNumber,!0),_n.setUint16(10,ro,!0),_n.setUint8(12,Fs.colorModel),_n.setUint8(13,Fs.colorPrimaries),_n.setUint8(14,Fs.transferFunction),_n.setUint8(15,Fs.flags),!Array.isArray(Fs.texelBlockDimension))throw new Error("texelBlockDimension is now an array. For dimensionality `d`, set `d - 1`.");_n.setUint8(16,Fs.texelBlockDimension[0]),_n.setUint8(17,Fs.texelBlockDimension[1]),_n.setUint8(18,Fs.texelBlockDimension[2]),_n.setUint8(19,Fs.texelBlockDimension[3]);for(let rs=0;rs<8;rs++)_n.setUint8(20+rs,Fs.bytesPlane[rs]);for(let rs=0;rs<Fs.samples.length;rs++){const nn=Fs.samples[rs],On=28+16*rs;if(nn.channelID)throw new Error("channelID has been renamed to channelType.");_n.setUint16(On+0,nn.bitOffset,!0),_n.setUint8(On+2,nn.bitLength),_n.setUint8(On+3,nn.channelType),_n.setUint8(On+4,nn.samplePosition[0]),_n.setUint8(On+5,nn.samplePosition[1]),_n.setUint8(On+6,nn.samplePosition[2]),_n.setUint8(On+7,nn.samplePosition[3]),64&nn.channelType?(_n.setInt32(On+8,nn.sampleLower,!0),_n.setInt32(On+12,nn.sampleUpper,!0)):(_n.setUint32(On+8,nn.sampleLower,!0),_n.setUint32(On+12,nn.sampleUpper,!0))}const Yc=ys.length+68+3*hr.levels.length*8,Yo=Yc+Is.byteLength;let Ta=Rn.byteLength>0?Yo+Al.byteLength:0;Ta%8&&(Ta+=8-Ta%8);const rn=[],Ga=new DataView(new ArrayBuffer(3*hr.levels.length*8));let yl=(Ta||Yo+Al.byteLength)+Rn.byteLength;for(let rs=0;rs<hr.levels.length;rs++){const nn=hr.levels[rs];rn.push(nn.levelData),Ga.setBigUint64(24*rs+0,BigInt(yl),!0),Ga.setBigUint64(24*rs+8,BigInt(nn.levelData.byteLength),!0),Ga.setBigUint64(24*rs+16,BigInt(nn.uncompressedByteLength),!0),yl+=nn.levelData.byteLength}const Ma=new ArrayBuffer(68),Dn=new DataView(Ma);return Dn.setUint32(0,hr.vkFormat,!0),Dn.setUint32(4,hr.typeSize,!0),Dn.setUint32(8,hr.pixelWidth,!0),Dn.setUint32(12,hr.pixelHeight,!0),Dn.setUint32(16,hr.pixelDepth,!0),Dn.setUint32(20,hr.layerCount,!0),Dn.setUint32(24,hr.faceCount,!0),Dn.setUint32(28,hr.levels.length,!0),Dn.setUint32(32,hr.supercompressionScheme,!0),Dn.setUint32(36,Yc,!0),Dn.setUint32(40,Is.byteLength,!0),Dn.setUint32(44,Yo,!0),Dn.setUint32(48,Al.byteLength,!0),Dn.setBigUint64(52,BigInt(Rn.byteLength>0?Ta:0),!0),Dn.setBigUint64(60,BigInt(Rn.byteLength),!0),new Uint8Array(us([new Uint8Array(ys).buffer,Ma,Ga.buffer,Is,Al,Ta>0?new ArrayBuffer(Ta-(Yo+Al.byteLength)):new ArrayBuffer(0),Rn,...rn]))}},"./node_modules/three/examples/jsm/libs/zstddec.module.js":(l,u,c)=>{c.r(u),c.d(u,{ZSTDDecoder:()=>y});var d=c("./node_modules/buffer/index.js").Buffer;let p,f,m;const g={env:{emscripten_notify_memory_growth:function(v){m=new Uint8Array(f.exports.memory.buffer)}}};class y{init(){return p||(p=typeof fetch<"u"?fetch("data:application/wasm;base64,"+x).then(_=>_.arrayBuffer()).then(_=>WebAssembly.instantiate(_,g)).then(this._init):WebAssembly.instantiate(d.from(x,"base64"),g).then(this._init),p)}_init(_){f=_.instance,g.env.emscripten_notify_memory_growth(0)}decode(_,T=0){if(!f)throw new Error("ZSTDDecoder: Await .init() before decoding.");const w=_.byteLength,S=f.exports.malloc(w);m.set(_,S),T=T||Number(f.exports.ZSTD_findDecompressedSize(S,w));const R=f.exports.malloc(T),B=f.exports.ZSTD_decompress(R,T,S,w),I=m.slice(R,R+B);return f.exports.free(S),f.exports.free(R),I}}const x="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ"},"./node_modules/three/examples/jsm/lights/LightProbeGenerator.js":(l,u,c)=>{c.r(u),c.d(u,{LightProbeGenerator:()=>p});var d=c("./node_modules/three/build/three.module.js");class p{static fromCubeTexture(g){let y=0;const x=new d.Vector3,v=new d.Vector3,_=new d.Color,T=[0,0,0,0,0,0,0,0,0],w=new d.SphericalHarmonics3,S=w.coefficients;for(let B=0;B<6;B++){const I=g.image[B],D=I.width,L=I.height,O=document.createElement("canvas");O.width=D,O.height=L;const U=O.getContext("2d");U.drawImage(I,0,0,D,L);const J=U.getImageData(0,0,D,L),H=J.data,V=J.width,$=2/V;for(let Q=0,G=H.length;Q<G;Q+=4){_.setRGB(H[Q]/255,H[Q+1]/255,H[Q+2]/255),f(_,g.colorSpace);const j=Q/4,ie=-1+(j%V+.5)*$,Y=1-(Math.floor(j/V)+.5)*$;switch(B){case 0:x.set(-1,Y,-ie);break;case 1:x.set(1,Y,ie);break;case 2:x.set(-ie,1,-Y);break;case 3:x.set(-ie,-1,Y);break;case 4:x.set(-ie,Y,1);break;case 5:x.set(ie,Y,-1);break}const ae=x.lengthSq(),xe=4/(Math.sqrt(ae)*ae);y+=xe,v.copy(x).normalize(),d.SphericalHarmonics3.getBasisAt(v,T);for(let fe=0;fe<9;fe++)S[fe].x+=T[fe]*_.r*xe,S[fe].y+=T[fe]*_.g*xe,S[fe].z+=T[fe]*_.b*xe}}const R=4*Math.PI/y;for(let B=0;B<9;B++)S[B].x*=R,S[B].y*=R,S[B].z*=R;return new d.LightProbe(w)}static fromCubeRenderTarget(g,y){let x=0;const v=new d.Vector3,_=new d.Vector3,T=new d.Color,w=[0,0,0,0,0,0,0,0,0],S=new d.SphericalHarmonics3,R=S.coefficients,B=y.texture.type;for(let D=0;D<6;D++){const L=y.width;let O;B===d.HalfFloatType?O=new Uint16Array(L*L*4):O=new Uint8Array(L*L*4),g.readRenderTargetPixels(y,0,0,L,L,O,D);const U=2/L;for(let J=0,H=O.length;J<H;J+=4){let V,$,Q;B===d.HalfFloatType?(V=d.DataUtils.fromHalfFloat(O[J]),$=d.DataUtils.fromHalfFloat(O[J+1]),Q=d.DataUtils.fromHalfFloat(O[J+2])):(V=O[J]/255,$=O[J+1]/255,Q=O[J+2]/255),T.setRGB(V,$,Q),f(T,y.texture.colorSpace);const G=J/4,j=-1+(G%L+.5)*U,ie=1-(Math.floor(G/L)+.5)*U;switch(D){case 0:v.set(1,ie,-j);break;case 1:v.set(-1,ie,j);break;case 2:v.set(j,1,-ie);break;case 3:v.set(j,-1,ie);break;case 4:v.set(j,ie,1);break;case 5:v.set(-j,ie,-1);break}const Y=v.lengthSq(),ae=4/(Math.sqrt(Y)*Y);x+=ae,_.copy(v).normalize(),d.SphericalHarmonics3.getBasisAt(_,w);for(let xe=0;xe<9;xe++)R[xe].x+=w[xe]*T.r*ae,R[xe].y+=w[xe]*T.g*ae,R[xe].z+=w[xe]*T.b*ae}}const I=4*Math.PI/x;for(let D=0;D<9;D++)R[D].x*=I,R[D].y*=I,R[D].z*=I;return new d.LightProbe(S)}}function f(m,g){switch(g){case d.SRGBColorSpace:m.convertSRGBToLinear();break;case d.LinearSRGBColorSpace:case d.NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.");break}return m}},"./node_modules/three/examples/jsm/loaders/DRACOLoader.js":(l,u,c)=>{c.r(u),c.d(u,{DRACOLoader:()=>f});var d=c("./node_modules/three/build/three.module.js");const p=new WeakMap;class f extends d.Loader{constructor(y){super(y),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(y){return this.decoderPath=y,this}setDecoderConfig(y){return this.decoderConfig=y,this}setWorkerLimit(y){return this.workerLimit=y,this}load(y,x,v,_){const T=new d.FileLoader(this.manager);T.setPath(this.path),T.setResponseType("arraybuffer"),T.setRequestHeader(this.requestHeader),T.setWithCredentials(this.withCredentials),T.load(y,w=>{this.parse(w,x,_)},v,_)}parse(y,x,v=()=>{}){this.decodeDracoFile(y,x,null,null,d.SRGBColorSpace).catch(v)}decodeDracoFile(y,x,v,_,T=d.LinearSRGBColorSpace,w=()=>{}){const S={attributeIDs:v||this.defaultAttributeIDs,attributeTypes:_||this.defaultAttributeTypes,useUniqueIDs:!!v,vertexColorSpace:T};return this.decodeGeometry(y,S).then(x).catch(w)}decodeGeometry(y,x){const v=JSON.stringify(x);if(p.has(y)){const R=p.get(y);if(R.key===v)return R.promise;if(y.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let _;const T=this.workerNextTaskID++,w=y.byteLength,S=this._getWorker(T,w).then(R=>(_=R,new Promise((B,I)=>{_._callbacks[T]={resolve:B,reject:I},_.postMessage({type:"decode",id:T,taskConfig:x,buffer:y},[y])}))).then(R=>this._createGeometry(R.geometry));return S.catch(()=>!0).then(()=>{_&&T&&this._releaseTask(_,T)}),p.set(y,{key:v,promise:S}),S}_createGeometry(y){const x=new d.BufferGeometry;y.index&&x.setIndex(new d.BufferAttribute(y.index.array,1));for(let v=0;v<y.attributes.length;v++){const _=y.attributes[v],T=_.name,w=_.array,S=_.itemSize,R=new d.BufferAttribute(w,S);T==="color"&&(this._assignVertexColorSpace(R,_.vertexColorSpace),R.normalized=!(w instanceof Float32Array)),x.setAttribute(T,R)}return x}_assignVertexColorSpace(y,x){if(x!==d.SRGBColorSpace)return;const v=new d.Color;for(let _=0,T=y.count;_<T;_++)v.fromBufferAttribute(y,_).convertSRGBToLinear(),y.setXYZ(_,v.r,v.g,v.b)}_loadLibrary(y,x){const v=new d.FileLoader(this.manager);return v.setPath(this.decoderPath),v.setResponseType(x),v.setWithCredentials(this.withCredentials),new Promise((_,T)=>{v.load(y,_,void 0,T)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const y=typeof WebAssembly!="object"||this.decoderConfig.type==="js",x=[];return y?x.push(this._loadLibrary("draco_decoder.js","text")):(x.push(this._loadLibrary("draco_wasm_wrapper.js","text")),x.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(x).then(v=>{const _=v[0];y||(this.decoderConfig.wasmBinary=v[1]);const T=m.toString(),w=["/* draco decoder */",_,"","/* worker */",T.substring(T.indexOf("{")+1,T.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([w]))}),this.decoderPending}_getWorker(y,x){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const _=new Worker(this.workerSourceURL);_._callbacks={},_._taskCosts={},_._taskLoad=0,_.postMessage({type:"init",decoderConfig:this.decoderConfig}),_.onmessage=function(T){const w=T.data;switch(w.type){case"decode":_._callbacks[w.id].resolve(w);break;case"error":_._callbacks[w.id].reject(w);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+w.type+'"')}},this.workerPool.push(_)}else this.workerPool.sort(function(_,T){return _._taskLoad>T._taskLoad?-1:1});const v=this.workerPool[this.workerPool.length-1];return v._taskCosts[y]=x,v._taskLoad+=x,v})}_releaseTask(y,x){y._taskLoad-=y._taskCosts[x],delete y._callbacks[x],delete y._taskCosts[x]}debug(){console.log("Task load: ",this.workerPool.map(y=>y._taskLoad))}dispose(){for(let y=0;y<this.workerPool.length;++y)this.workerPool[y].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function m(){let g,y;onmessage=function(w){const S=w.data;switch(S.type){case"init":g=S.decoderConfig,y=new Promise(function(I){g.onModuleLoaded=function(D){I({draco:D})},DracoDecoderModule(g)});break;case"decode":const R=S.buffer,B=S.taskConfig;y.then(I=>{const D=I.draco,L=new D.Decoder;try{const O=x(D,L,new Int8Array(R),B),U=O.attributes.map(J=>J.array.buffer);O.index&&U.push(O.index.array.buffer),self.postMessage({type:"decode",id:S.id,geometry:O},U)}catch(O){console.error(O),self.postMessage({type:"error",id:S.id,error:O.message})}finally{D.destroy(L)}});break}};function x(w,S,R,B){const I=B.attributeIDs,D=B.attributeTypes;let L,O;const U=S.GetEncodedGeometryType(R);if(U===w.TRIANGULAR_MESH)L=new w.Mesh,O=S.DecodeArrayToMesh(R,R.byteLength,L);else if(U===w.POINT_CLOUD)L=new w.PointCloud,O=S.DecodeArrayToPointCloud(R,R.byteLength,L);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!O.ok()||L.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+O.error_msg());const J={index:null,attributes:[]};for(const H in I){const V=self[D[H]];let $,Q;if(B.useUniqueIDs)Q=I[H],$=S.GetAttributeByUniqueId(L,Q);else{if(Q=S.GetAttributeId(L,w[I[H]]),Q===-1)continue;$=S.GetAttribute(L,Q)}const G=_(w,S,L,H,V,$);H==="color"&&(G.vertexColorSpace=B.vertexColorSpace),J.attributes.push(G)}return U===w.TRIANGULAR_MESH&&(J.index=v(w,S,L)),w.destroy(L),J}function v(w,S,R){const B=R.num_faces()*3,I=B*4,D=w._malloc(I);S.GetTrianglesUInt32Array(R,I,D);const L=new Uint32Array(w.HEAPF32.buffer,D,B).slice();return w._free(D),{array:L,itemSize:1}}function _(w,S,R,B,I,D){const L=D.num_components(),O=R.num_points()*L,U=O*I.BYTES_PER_ELEMENT,J=T(w,I),H=w._malloc(U);S.GetAttributeDataArrayForAllPoints(R,D,J,U,H);const V=new I(w.HEAPF32.buffer,H,O).slice();return w._free(H),{name:B,array:V,itemSize:L}}function T(w,S){switch(S){case Float32Array:return w.DT_FLOAT32;case Int8Array:return w.DT_INT8;case Int16Array:return w.DT_INT16;case Int32Array:return w.DT_INT32;case Uint8Array:return w.DT_UINT8;case Uint16Array:return w.DT_UINT16;case Uint32Array:return w.DT_UINT32}}}},"./node_modules/three/examples/jsm/loaders/GLTFLoader.js":(l,u,c)=>{c.r(u),c.d(u,{GLTFLoader:()=>f});var d=c("./node_modules/three/build/three.module.js"),p=c("./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js");class f extends d.Loader{constructor(ye){super(ye),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(ve){return new _(ve)}),this.register(function(ve){return new T(ve)}),this.register(function(ve){return new U(ve)}),this.register(function(ve){return new J(ve)}),this.register(function(ve){return new H(ve)}),this.register(function(ve){return new S(ve)}),this.register(function(ve){return new R(ve)}),this.register(function(ve){return new B(ve)}),this.register(function(ve){return new I(ve)}),this.register(function(ve){return new v(ve)}),this.register(function(ve){return new D(ve)}),this.register(function(ve){return new w(ve)}),this.register(function(ve){return new O(ve)}),this.register(function(ve){return new L(ve)}),this.register(function(ve){return new y(ve)}),this.register(function(ve){return new V(ve)}),this.register(function(ve){return new $(ve)})}load(ye,ve,Le,Te){const Fe=this;let Pe;if(this.resourcePath!=="")Pe=this.resourcePath;else if(this.path!==""){const re=d.LoaderUtils.extractUrlBase(ye);Pe=d.LoaderUtils.resolveURL(re,this.path)}else Pe=d.LoaderUtils.extractUrlBase(ye);this.manager.itemStart(ye);const k=function(re){Te?Te(re):console.error(re),Fe.manager.itemError(ye),Fe.manager.itemEnd(ye)},Z=new d.FileLoader(this.manager);Z.setPath(this.path),Z.setResponseType("arraybuffer"),Z.setRequestHeader(this.requestHeader),Z.setWithCredentials(this.withCredentials),Z.load(ye,function(re){try{Fe.parse(re,Pe,function(Re){ve(Re),Fe.manager.itemEnd(ye)},k)}catch(Re){k(Re)}},Le,k)}setDRACOLoader(ye){return this.dracoLoader=ye,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(ye){return this.ktx2Loader=ye,this}setMeshoptDecoder(ye){return this.meshoptDecoder=ye,this}register(ye){return this.pluginCallbacks.indexOf(ye)===-1&&this.pluginCallbacks.push(ye),this}unregister(ye){return this.pluginCallbacks.indexOf(ye)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(ye),1),this}parse(ye,ve,Le,Te){let Fe;const Pe={},k={},Z=new TextDecoder;if(typeof ye=="string")Fe=JSON.parse(ye);else if(ye instanceof ArrayBuffer)if(Z.decode(new Uint8Array(ye,0,4))===Q){try{Pe[g.KHR_BINARY_GLTF]=new ie(ye)}catch(Re){Te&&Te(Re);return}Fe=JSON.parse(Pe[g.KHR_BINARY_GLTF].content)}else Fe=JSON.parse(Z.decode(ye));else Fe=ye;if(Fe.asset===void 0||Fe.asset.version[0]<2){Te&&Te(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const re=new Jt(Fe,{path:ve||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});re.fileLoader.setRequestHeader(this.requestHeader);for(let Re=0;Re<this.pluginCallbacks.length;Re++){const ce=this.pluginCallbacks[Re](re);ce.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),k[ce.name]=ce,Pe[ce.name]=!0}if(Fe.extensionsUsed)for(let Re=0;Re<Fe.extensionsUsed.length;++Re){const ce=Fe.extensionsUsed[Re],Ue=Fe.extensionsRequired||[];switch(ce){case g.KHR_MATERIALS_UNLIT:Pe[ce]=new x;break;case g.KHR_DRACO_MESH_COMPRESSION:Pe[ce]=new Y(Fe,this.dracoLoader);break;case g.KHR_TEXTURE_TRANSFORM:Pe[ce]=new ae;break;case g.KHR_MESH_QUANTIZATION:Pe[ce]=new xe;break;default:Ue.indexOf(ce)>=0&&k[ce]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ce+'".')}}re.setExtensions(Pe),re.setPlugins(k),re.parse(Le,Te)}parseAsync(ye,ve){const Le=this;return new Promise(function(Te,Fe){Le.parse(ye,ve,Te,Fe)})}}function m(){let vt={};return{get:function(ye){return vt[ye]},add:function(ye,ve){vt[ye]=ve},remove:function(ye){delete vt[ye]},removeAll:function(){vt={}}}}const g={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class y{constructor(ye){this.parser=ye,this.name=g.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const ye=this.parser,ve=this.parser.json.nodes||[];for(let Le=0,Te=ve.length;Le<Te;Le++){const Fe=ve[Le];Fe.extensions&&Fe.extensions[this.name]&&Fe.extensions[this.name].light!==void 0&&ye._addNodeRef(this.cache,Fe.extensions[this.name].light)}}_loadLight(ye){const ve=this.parser,Le="light:"+ye;let Te=ve.cache.get(Le);if(Te)return Te;const Fe=ve.json,Pe=((Fe.extensions&&Fe.extensions[this.name]||{}).lights||[])[ye];let k;const Z=new d.Color(16777215);Pe.color!==void 0&&Z.setRGB(Pe.color[0],Pe.color[1],Pe.color[2],d.LinearSRGBColorSpace);const re=Pe.range!==void 0?Pe.range:0;switch(Pe.type){case"directional":k=new d.DirectionalLight(Z),k.target.position.set(0,0,-1),k.add(k.target);break;case"point":k=new d.PointLight(Z),k.distance=re;break;case"spot":k=new d.SpotLight(Z),k.distance=re,Pe.spot=Pe.spot||{},Pe.spot.innerConeAngle=Pe.spot.innerConeAngle!==void 0?Pe.spot.innerConeAngle:0,Pe.spot.outerConeAngle=Pe.spot.outerConeAngle!==void 0?Pe.spot.outerConeAngle:Math.PI/4,k.angle=Pe.spot.outerConeAngle,k.penumbra=1-Pe.spot.innerConeAngle/Pe.spot.outerConeAngle,k.target.position.set(0,0,-1),k.add(k.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+Pe.type)}return k.position.set(0,0,0),k.decay=2,Ri(k,Pe),Pe.intensity!==void 0&&(k.intensity=Pe.intensity),k.name=ve.createUniqueName(Pe.name||"light_"+ye),Te=Promise.resolve(k),ve.cache.add(Le,Te),Te}getDependency(ye,ve){if(ye==="light")return this._loadLight(ve)}createNodeAttachment(ye){const ve=this,Le=this.parser,Te=Le.json.nodes[ye],Fe=(Te.extensions&&Te.extensions[this.name]||{}).light;return Fe===void 0?null:this._loadLight(Fe).then(function(Pe){return Le._getNodeRef(ve.cache,Fe,Pe)})}}class x{constructor(){this.name=g.KHR_MATERIALS_UNLIT}getMaterialType(){return d.MeshBasicMaterial}extendParams(ye,ve,Le){const Te=[];ye.color=new d.Color(1,1,1),ye.opacity=1;const Fe=ve.pbrMetallicRoughness;if(Fe){if(Array.isArray(Fe.baseColorFactor)){const Pe=Fe.baseColorFactor;ye.color.setRGB(Pe[0],Pe[1],Pe[2],d.LinearSRGBColorSpace),ye.opacity=Pe[3]}Fe.baseColorTexture!==void 0&&Te.push(Le.assignTexture(ye,"map",Fe.baseColorTexture,d.SRGBColorSpace))}return Promise.all(Te)}}class v{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(ye,ve){const Le=this.parser.json.materials[ye];if(!Le.extensions||!Le.extensions[this.name])return Promise.resolve();const Te=Le.extensions[this.name].emissiveStrength;return Te!==void 0&&(ve.emissiveIntensity=Te),Promise.resolve()}}class _{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_CLEARCOAT}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser,Te=Le.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const Fe=[],Pe=Te.extensions[this.name];if(Pe.clearcoatFactor!==void 0&&(ve.clearcoat=Pe.clearcoatFactor),Pe.clearcoatTexture!==void 0&&Fe.push(Le.assignTexture(ve,"clearcoatMap",Pe.clearcoatTexture)),Pe.clearcoatRoughnessFactor!==void 0&&(ve.clearcoatRoughness=Pe.clearcoatRoughnessFactor),Pe.clearcoatRoughnessTexture!==void 0&&Fe.push(Le.assignTexture(ve,"clearcoatRoughnessMap",Pe.clearcoatRoughnessTexture)),Pe.clearcoatNormalTexture!==void 0&&(Fe.push(Le.assignTexture(ve,"clearcoatNormalMap",Pe.clearcoatNormalTexture)),Pe.clearcoatNormalTexture.scale!==void 0)){const k=Pe.clearcoatNormalTexture.scale;ve.clearcoatNormalScale=new d.Vector2(k,k)}return Promise.all(Fe)}}class T{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_DISPERSION}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser.json.materials[ye];if(!Le.extensions||!Le.extensions[this.name])return Promise.resolve();const Te=Le.extensions[this.name];return ve.dispersion=Te.dispersion!==void 0?Te.dispersion:0,Promise.resolve()}}class w{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_IRIDESCENCE}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser,Te=Le.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const Fe=[],Pe=Te.extensions[this.name];return Pe.iridescenceFactor!==void 0&&(ve.iridescence=Pe.iridescenceFactor),Pe.iridescenceTexture!==void 0&&Fe.push(Le.assignTexture(ve,"iridescenceMap",Pe.iridescenceTexture)),Pe.iridescenceIor!==void 0&&(ve.iridescenceIOR=Pe.iridescenceIor),ve.iridescenceThicknessRange===void 0&&(ve.iridescenceThicknessRange=[100,400]),Pe.iridescenceThicknessMinimum!==void 0&&(ve.iridescenceThicknessRange[0]=Pe.iridescenceThicknessMinimum),Pe.iridescenceThicknessMaximum!==void 0&&(ve.iridescenceThicknessRange[1]=Pe.iridescenceThicknessMaximum),Pe.iridescenceThicknessTexture!==void 0&&Fe.push(Le.assignTexture(ve,"iridescenceThicknessMap",Pe.iridescenceThicknessTexture)),Promise.all(Fe)}}class S{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_SHEEN}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser,Te=Le.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const Fe=[];ve.sheenColor=new d.Color(0,0,0),ve.sheenRoughness=0,ve.sheen=1;const Pe=Te.extensions[this.name];if(Pe.sheenColorFactor!==void 0){const k=Pe.sheenColorFactor;ve.sheenColor.setRGB(k[0],k[1],k[2],d.LinearSRGBColorSpace)}return Pe.sheenRoughnessFactor!==void 0&&(ve.sheenRoughness=Pe.sheenRoughnessFactor),Pe.sheenColorTexture!==void 0&&Fe.push(Le.assignTexture(ve,"sheenColorMap",Pe.sheenColorTexture,d.SRGBColorSpace)),Pe.sheenRoughnessTexture!==void 0&&Fe.push(Le.assignTexture(ve,"sheenRoughnessMap",Pe.sheenRoughnessTexture)),Promise.all(Fe)}}class R{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_TRANSMISSION}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser,Te=Le.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const Fe=[],Pe=Te.extensions[this.name];return Pe.transmissionFactor!==void 0&&(ve.transmission=Pe.transmissionFactor),Pe.transmissionTexture!==void 0&&Fe.push(Le.assignTexture(ve,"transmissionMap",Pe.transmissionTexture)),Promise.all(Fe)}}class B{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_VOLUME}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser,Te=Le.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const Fe=[],Pe=Te.extensions[this.name];ve.thickness=Pe.thicknessFactor!==void 0?Pe.thicknessFactor:0,Pe.thicknessTexture!==void 0&&Fe.push(Le.assignTexture(ve,"thicknessMap",Pe.thicknessTexture)),ve.attenuationDistance=Pe.attenuationDistance||1/0;const k=Pe.attenuationColor||[1,1,1];return ve.attenuationColor=new d.Color().setRGB(k[0],k[1],k[2],d.LinearSRGBColorSpace),Promise.all(Fe)}}class I{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_IOR}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser.json.materials[ye];if(!Le.extensions||!Le.extensions[this.name])return Promise.resolve();const Te=Le.extensions[this.name];return ve.ior=Te.ior!==void 0?Te.ior:1.5,Promise.resolve()}}class D{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_SPECULAR}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser,Te=Le.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const Fe=[],Pe=Te.extensions[this.name];ve.specularIntensity=Pe.specularFactor!==void 0?Pe.specularFactor:1,Pe.specularTexture!==void 0&&Fe.push(Le.assignTexture(ve,"specularIntensityMap",Pe.specularTexture));const k=Pe.specularColorFactor||[1,1,1];return ve.specularColor=new d.Color().setRGB(k[0],k[1],k[2],d.LinearSRGBColorSpace),Pe.specularColorTexture!==void 0&&Fe.push(Le.assignTexture(ve,"specularColorMap",Pe.specularColorTexture,d.SRGBColorSpace)),Promise.all(Fe)}}class L{constructor(ye){this.parser=ye,this.name=g.EXT_MATERIALS_BUMP}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser,Te=Le.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const Fe=[],Pe=Te.extensions[this.name];return ve.bumpScale=Pe.bumpFactor!==void 0?Pe.bumpFactor:1,Pe.bumpTexture!==void 0&&Fe.push(Le.assignTexture(ve,"bumpMap",Pe.bumpTexture)),Promise.all(Fe)}}class O{constructor(ye){this.parser=ye,this.name=g.KHR_MATERIALS_ANISOTROPY}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:d.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Le=this.parser,Te=Le.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const Fe=[],Pe=Te.extensions[this.name];return Pe.anisotropyStrength!==void 0&&(ve.anisotropy=Pe.anisotropyStrength),Pe.anisotropyRotation!==void 0&&(ve.anisotropyRotation=Pe.anisotropyRotation),Pe.anisotropyTexture!==void 0&&Fe.push(Le.assignTexture(ve,"anisotropyMap",Pe.anisotropyTexture)),Promise.all(Fe)}}class U{constructor(ye){this.parser=ye,this.name=g.KHR_TEXTURE_BASISU}loadTexture(ye){const ve=this.parser,Le=ve.json,Te=Le.textures[ye];if(!Te.extensions||!Te.extensions[this.name])return null;const Fe=Te.extensions[this.name],Pe=ve.options.ktx2Loader;if(!Pe){if(Le.extensionsRequired&&Le.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return ve.loadTextureImage(ye,Fe.source,Pe)}}class J{constructor(ye){this.parser=ye,this.name=g.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(ye){const ve=this.name,Le=this.parser,Te=Le.json,Fe=Te.textures[ye];if(!Fe.extensions||!Fe.extensions[ve])return null;const Pe=Fe.extensions[ve],k=Te.images[Pe.source];let Z=Le.textureLoader;if(k.uri){const re=Le.options.manager.getHandler(k.uri);re!==null&&(Z=re)}return this.detectSupport().then(function(re){if(re)return Le.loadTextureImage(ye,Pe.source,Z);if(Te.extensionsRequired&&Te.extensionsRequired.indexOf(ve)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return Le.loadTexture(ye)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(ye){const ve=new Image;ve.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",ve.onload=ve.onerror=function(){ye(ve.height===1)}})),this.isSupported}}class H{constructor(ye){this.parser=ye,this.name=g.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(ye){const ve=this.name,Le=this.parser,Te=Le.json,Fe=Te.textures[ye];if(!Fe.extensions||!Fe.extensions[ve])return null;const Pe=Fe.extensions[ve],k=Te.images[Pe.source];let Z=Le.textureLoader;if(k.uri){const re=Le.options.manager.getHandler(k.uri);re!==null&&(Z=re)}return this.detectSupport().then(function(re){if(re)return Le.loadTextureImage(ye,Pe.source,Z);if(Te.extensionsRequired&&Te.extensionsRequired.indexOf(ve)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return Le.loadTexture(ye)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(ye){const ve=new Image;ve.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",ve.onload=ve.onerror=function(){ye(ve.height===1)}})),this.isSupported}}class V{constructor(ye){this.name=g.EXT_MESHOPT_COMPRESSION,this.parser=ye}loadBufferView(ye){const ve=this.parser.json,Le=ve.bufferViews[ye];if(Le.extensions&&Le.extensions[this.name]){const Te=Le.extensions[this.name],Fe=this.parser.getDependency("buffer",Te.buffer),Pe=this.parser.options.meshoptDecoder;if(!Pe||!Pe.supported){if(ve.extensionsRequired&&ve.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Fe.then(function(k){const Z=Te.byteOffset||0,re=Te.byteLength||0,Re=Te.count,ce=Te.byteStride,Ue=new Uint8Array(k,Z,re);return Pe.decodeGltfBufferAsync?Pe.decodeGltfBufferAsync(Re,ce,Ue,Te.mode,Te.filter).then(function(je){return je.buffer}):Pe.ready.then(function(){const je=new ArrayBuffer(Re*ce);return Pe.decodeGltfBuffer(new Uint8Array(je),Re,ce,Ue,Te.mode,Te.filter),je})})}else return null}}class ${constructor(ye){this.name=g.EXT_MESH_GPU_INSTANCING,this.parser=ye}createNodeMesh(ye){const ve=this.parser.json,Le=ve.nodes[ye];if(!Le.extensions||!Le.extensions[this.name]||Le.mesh===void 0)return null;const Te=ve.meshes[Le.mesh];for(const Z of Te.primitives)if(Z.mode!==Ge.TRIANGLES&&Z.mode!==Ge.TRIANGLE_STRIP&&Z.mode!==Ge.TRIANGLE_FAN&&Z.mode!==void 0)return null;const Fe=Le.extensions[this.name].attributes,Pe=[],k={};for(const Z in Fe)Pe.push(this.parser.getDependency("accessor",Fe[Z]).then(re=>(k[Z]=re,k[Z])));return Pe.length<1?null:(Pe.push(this.parser.createNodeMesh(ye)),Promise.all(Pe).then(Z=>{const re=Z.pop(),Re=re.isGroup?re.children:[re],ce=Z[0].count,Ue=[];for(const je of Re){const dt=new d.Matrix4,Bt=new d.Vector3,bt=new d.Quaternion,Ut=new d.Vector3(1,1,1),di=new d.InstancedMesh(je.geometry,je.material,ce);for(let br=0;br<ce;br++)k.TRANSLATION&&Bt.fromBufferAttribute(k.TRANSLATION,br),k.ROTATION&&bt.fromBufferAttribute(k.ROTATION,br),k.SCALE&&Ut.fromBufferAttribute(k.SCALE,br),di.setMatrixAt(br,dt.compose(Bt,bt,Ut));for(const br in k)if(br==="_COLOR_0"){const Pi=k[br];di.instanceColor=new d.InstancedBufferAttribute(Pi.array,Pi.itemSize,Pi.normalized)}else br!=="TRANSLATION"&&br!=="ROTATION"&&br!=="SCALE"&&je.geometry.setAttribute(br,k[br]);d.Object3D.prototype.copy.call(di,je),this.parser.assignFinalMaterial(di),Ue.push(di)}return re.isGroup?(re.clear(),re.add(...Ue),re):Ue[0]}))}}const Q="glTF",G=12,j={JSON:1313821514,BIN:5130562};class ie{constructor(ye){this.name=g.KHR_BINARY_GLTF,this.content=null,this.body=null;const ve=new DataView(ye,0,G),Le=new TextDecoder;if(this.header={magic:Le.decode(new Uint8Array(ye.slice(0,4))),version:ve.getUint32(4,!0),length:ve.getUint32(8,!0)},this.header.magic!==Q)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const Te=this.header.length-G,Fe=new DataView(ye,G);let Pe=0;for(;Pe<Te;){const k=Fe.getUint32(Pe,!0);Pe+=4;const Z=Fe.getUint32(Pe,!0);if(Pe+=4,Z===j.JSON){const re=new Uint8Array(ye,G+Pe,k);this.content=Le.decode(re)}else if(Z===j.BIN){const re=G+Pe;this.body=ye.slice(re,re+k)}Pe+=k}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Y{constructor(ye,ve){if(!ve)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=g.KHR_DRACO_MESH_COMPRESSION,this.json=ye,this.dracoLoader=ve,this.dracoLoader.preload()}decodePrimitive(ye,ve){const Le=this.json,Te=this.dracoLoader,Fe=ye.extensions[this.name].bufferView,Pe=ye.extensions[this.name].attributes,k={},Z={},re={};for(const Re in Pe){const ce=Gt[Re]||Re.toLowerCase();k[ce]=Pe[Re]}for(const Re in ye.attributes){const ce=Gt[Re]||Re.toLowerCase();if(Pe[Re]!==void 0){const Ue=Le.accessors[ye.attributes[Re]],je=Xe[Ue.componentType];re[ce]=je.name,Z[ce]=Ue.normalized===!0}}return ve.getDependency("bufferView",Fe).then(function(Re){return new Promise(function(ce,Ue){Te.decodeDracoFile(Re,function(je){for(const dt in je.attributes){const Bt=je.attributes[dt],bt=Z[dt];bt!==void 0&&(Bt.normalized=bt)}ce(je)},k,re,d.LinearSRGBColorSpace,Ue)})})}}class ae{constructor(){this.name=g.KHR_TEXTURE_TRANSFORM}extendTexture(ye,ve){return(ve.texCoord===void 0||ve.texCoord===ye.channel)&&ve.offset===void 0&&ve.rotation===void 0&&ve.scale===void 0||(ye=ye.clone(),ve.texCoord!==void 0&&(ye.channel=ve.texCoord),ve.offset!==void 0&&ye.offset.fromArray(ve.offset),ve.rotation!==void 0&&(ye.rotation=ve.rotation),ve.scale!==void 0&&ye.repeat.fromArray(ve.scale),ye.needsUpdate=!0),ye}}class xe{constructor(){this.name=g.KHR_MESH_QUANTIZATION}}class fe extends d.Interpolant{constructor(ye,ve,Le,Te){super(ye,ve,Le,Te)}copySampleValue_(ye){const ve=this.resultBuffer,Le=this.sampleValues,Te=this.valueSize,Fe=ye*Te*3+Te;for(let Pe=0;Pe!==Te;Pe++)ve[Pe]=Le[Fe+Pe];return ve}interpolate_(ye,ve,Le,Te){const Fe=this.resultBuffer,Pe=this.sampleValues,k=this.valueSize,Z=k*2,re=k*3,Re=Te-ve,ce=(Le-ve)/Re,Ue=ce*ce,je=Ue*ce,dt=ye*re,Bt=dt-re,bt=-2*je+3*Ue,Ut=je-Ue,di=1-bt,br=Ut-Ue+ce;for(let Pi=0;Pi!==k;Pi++){const fn=Pe[Bt+Pi+k],Pr=Pe[Bt+Pi+Z]*Re,tn=Pe[dt+Pi+k],gs=Pe[dt+Pi]*Re;Fe[Pi]=di*fn+br*Pr+bt*tn+Ut*gs}return Fe}}const de=new d.Quaternion;class Ie extends fe{interpolate_(ye,ve,Le,Te){const Fe=super.interpolate_(ye,ve,Le,Te);return de.fromArray(Fe).normalize().toArray(Fe),Fe}}const Ge={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Xe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$e={9728:d.NearestFilter,9729:d.LinearFilter,9984:d.NearestMipmapNearestFilter,9985:d.LinearMipmapNearestFilter,9986:d.NearestMipmapLinearFilter,9987:d.LinearMipmapLinearFilter},lt={33071:d.ClampToEdgeWrapping,33648:d.MirroredRepeatWrapping,10497:d.RepeatWrapping},At={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},gt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},yi={CUBICSPLINE:void 0,LINEAR:d.InterpolateLinear,STEP:d.InterpolateDiscrete},Ze={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ki(vt){return vt.DefaultMaterial===void 0&&(vt.DefaultMaterial=new d.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:d.FrontSide})),vt.DefaultMaterial}function hi(vt,ye,ve){for(const Le in ve.extensions)vt[Le]===void 0&&(ye.userData.gltfExtensions=ye.userData.gltfExtensions||{},ye.userData.gltfExtensions[Le]=ve.extensions[Le])}function Ri(vt,ye){ye.extras!==void 0&&(typeof ye.extras=="object"?Object.assign(vt.userData,ye.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+ye.extras))}function Si(vt,ye,ve){let Le=!1,Te=!1,Fe=!1;for(let re=0,Re=ye.length;re<Re;re++){const ce=ye[re];if(ce.POSITION!==void 0&&(Le=!0),ce.NORMAL!==void 0&&(Te=!0),ce.COLOR_0!==void 0&&(Fe=!0),Le&&Te&&Fe)break}if(!Le&&!Te&&!Fe)return Promise.resolve(vt);const Pe=[],k=[],Z=[];for(let re=0,Re=ye.length;re<Re;re++){const ce=ye[re];if(Le){const Ue=ce.POSITION!==void 0?ve.getDependency("accessor",ce.POSITION):vt.attributes.position;Pe.push(Ue)}if(Te){const Ue=ce.NORMAL!==void 0?ve.getDependency("accessor",ce.NORMAL):vt.attributes.normal;k.push(Ue)}if(Fe){const Ue=ce.COLOR_0!==void 0?ve.getDependency("accessor",ce.COLOR_0):vt.attributes.color;Z.push(Ue)}}return Promise.all([Promise.all(Pe),Promise.all(k),Promise.all(Z)]).then(function(re){const Re=re[0],ce=re[1],Ue=re[2];return Le&&(vt.morphAttributes.position=Re),Te&&(vt.morphAttributes.normal=ce),Fe&&(vt.morphAttributes.color=Ue),vt.morphTargetsRelative=!0,vt})}function tr(vt,ye){if(vt.updateMorphTargets(),ye.weights!==void 0)for(let ve=0,Le=ye.weights.length;ve<Le;ve++)vt.morphTargetInfluences[ve]=ye.weights[ve];if(ye.extras&&Array.isArray(ye.extras.targetNames)){const ve=ye.extras.targetNames;if(vt.morphTargetInfluences.length===ve.length){vt.morphTargetDictionary={};for(let Le=0,Te=ve.length;Le<Te;Le++)vt.morphTargetDictionary[ve[Le]]=Le}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Vi(vt){let ye;const ve=vt.extensions&&vt.extensions[g.KHR_DRACO_MESH_COMPRESSION];if(ve?ye="draco:"+ve.bufferView+":"+ve.indices+":"+Qe(ve.attributes):ye=vt.indices+":"+Qe(vt.attributes)+":"+vt.mode,vt.targets!==void 0)for(let Le=0,Te=vt.targets.length;Le<Te;Le++)ye+=":"+Qe(vt.targets[Le]);return ye}function Qe(vt){let ye="";const ve=Object.keys(vt).sort();for(let Le=0,Te=ve.length;Le<Te;Le++)ye+=ve[Le]+":"+vt[ve[Le]]+";";return ye}function Ce(vt){switch(vt){case Int8Array:return .007874015748031496;case Uint8Array:return .00392156862745098;case Int16Array:return 3051850947599719e-20;case Uint16Array:return 15259021896696422e-21;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function yt(vt){return vt.search(/\.jpe?g($|\?)/i)>0||vt.search(/^data\:image\/jpeg/)===0?"image/jpeg":vt.search(/\.webp($|\?)/i)>0||vt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Ot=new d.Matrix4;class Jt{constructor(ye={},ve={}){this.json=ye,this.extensions={},this.plugins={},this.options=ve,this.cache=new m,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let Le=!1,Te=!1,Fe=-1;typeof navigator<"u"&&(Le=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,Te=navigator.userAgent.indexOf("Firefox")>-1,Fe=Te?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||Le||Te&&Fe<98?this.textureLoader=new d.TextureLoader(this.options.manager):this.textureLoader=new d.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new d.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(ye){this.extensions=ye}setPlugins(ye){this.plugins=ye}parse(ye,ve){const Le=this,Te=this.json,Fe=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(Pe){return Pe._markDefs&&Pe._markDefs()}),Promise.all(this._invokeAll(function(Pe){return Pe.beforeRoot&&Pe.beforeRoot()})).then(function(){return Promise.all([Le.getDependencies("scene"),Le.getDependencies("animation"),Le.getDependencies("camera")])}).then(function(Pe){const k={scene:Pe[0][Te.scene||0],scenes:Pe[0],animations:Pe[1],cameras:Pe[2],asset:Te.asset,parser:Le,userData:{}};return hi(Fe,k,Te),Ri(k,Te),Promise.all(Le._invokeAll(function(Z){return Z.afterRoot&&Z.afterRoot(k)})).then(function(){for(const Z of k.scenes)Z.updateMatrixWorld();ye(k)})}).catch(ve)}_markDefs(){const ye=this.json.nodes||[],ve=this.json.skins||[],Le=this.json.meshes||[];for(let Te=0,Fe=ve.length;Te<Fe;Te++){const Pe=ve[Te].joints;for(let k=0,Z=Pe.length;k<Z;k++)ye[Pe[k]].isBone=!0}for(let Te=0,Fe=ye.length;Te<Fe;Te++){const Pe=ye[Te];Pe.mesh!==void 0&&(this._addNodeRef(this.meshCache,Pe.mesh),Pe.skin!==void 0&&(Le[Pe.mesh].isSkinnedMesh=!0)),Pe.camera!==void 0&&this._addNodeRef(this.cameraCache,Pe.camera)}}_addNodeRef(ye,ve){ve!==void 0&&(ye.refs[ve]===void 0&&(ye.refs[ve]=ye.uses[ve]=0),ye.refs[ve]++)}_getNodeRef(ye,ve,Le){if(ye.refs[ve]<=1)return Le;const Te=Le.clone(),Fe=(Pe,k)=>{const Z=this.associations.get(Pe);Z!=null&&this.associations.set(k,Z);for(const[re,Re]of Pe.children.entries())Fe(Re,k.children[re])};return Fe(Le,Te),Te.name+="_instance_"+ye.uses[ve]++,Te}_invokeOne(ye){const ve=Object.values(this.plugins);ve.push(this);for(let Le=0;Le<ve.length;Le++){const Te=ye(ve[Le]);if(Te)return Te}return null}_invokeAll(ye){const ve=Object.values(this.plugins);ve.unshift(this);const Le=[];for(let Te=0;Te<ve.length;Te++){const Fe=ye(ve[Te]);Fe&&Le.push(Fe)}return Le}getDependency(ye,ve){const Le=ye+":"+ve;let Te=this.cache.get(Le);if(!Te){switch(ye){case"scene":Te=this.loadScene(ve);break;case"node":Te=this._invokeOne(function(Fe){return Fe.loadNode&&Fe.loadNode(ve)});break;case"mesh":Te=this._invokeOne(function(Fe){return Fe.loadMesh&&Fe.loadMesh(ve)});break;case"accessor":Te=this.loadAccessor(ve);break;case"bufferView":Te=this._invokeOne(function(Fe){return Fe.loadBufferView&&Fe.loadBufferView(ve)});break;case"buffer":Te=this.loadBuffer(ve);break;case"material":Te=this._invokeOne(function(Fe){return Fe.loadMaterial&&Fe.loadMaterial(ve)});break;case"texture":Te=this._invokeOne(function(Fe){return Fe.loadTexture&&Fe.loadTexture(ve)});break;case"skin":Te=this.loadSkin(ve);break;case"animation":Te=this._invokeOne(function(Fe){return Fe.loadAnimation&&Fe.loadAnimation(ve)});break;case"camera":Te=this.loadCamera(ve);break;default:if(Te=this._invokeOne(function(Fe){return Fe!=this&&Fe.getDependency&&Fe.getDependency(ye,ve)}),!Te)throw new Error("Unknown type: "+ye);break}this.cache.add(Le,Te)}return Te}getDependencies(ye){let ve=this.cache.get(ye);if(!ve){const Le=this,Te=this.json[ye+(ye==="mesh"?"es":"s")]||[];ve=Promise.all(Te.map(function(Fe,Pe){return Le.getDependency(ye,Pe)})),this.cache.add(ye,ve)}return ve}loadBuffer(ye){const ve=this.json.buffers[ye],Le=this.fileLoader;if(ve.type&&ve.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+ve.type+" buffer type is not supported.");if(ve.uri===void 0&&ye===0)return Promise.resolve(this.extensions[g.KHR_BINARY_GLTF].body);const Te=this.options;return new Promise(function(Fe,Pe){Le.load(d.LoaderUtils.resolveURL(ve.uri,Te.path),Fe,void 0,function(){Pe(new Error('THREE.GLTFLoader: Failed to load buffer "'+ve.uri+'".'))})})}loadBufferView(ye){const ve=this.json.bufferViews[ye];return this.getDependency("buffer",ve.buffer).then(function(Le){const Te=ve.byteLength||0,Fe=ve.byteOffset||0;return Le.slice(Fe,Fe+Te)})}loadAccessor(ye){const ve=this,Le=this.json,Te=this.json.accessors[ye];if(Te.bufferView===void 0&&Te.sparse===void 0){const Pe=At[Te.type],k=Xe[Te.componentType],Z=Te.normalized===!0,re=new k(Te.count*Pe);return Promise.resolve(new d.BufferAttribute(re,Pe,Z))}const Fe=[];return Te.bufferView!==void 0?Fe.push(this.getDependency("bufferView",Te.bufferView)):Fe.push(null),Te.sparse!==void 0&&(Fe.push(this.getDependency("bufferView",Te.sparse.indices.bufferView)),Fe.push(this.getDependency("bufferView",Te.sparse.values.bufferView))),Promise.all(Fe).then(function(Pe){const k=Pe[0],Z=At[Te.type],re=Xe[Te.componentType],Re=re.BYTES_PER_ELEMENT,ce=Re*Z,Ue=Te.byteOffset||0,je=Te.bufferView!==void 0?Le.bufferViews[Te.bufferView].byteStride:void 0,dt=Te.normalized===!0;let Bt,bt;if(je&&je!==ce){const Ut=Math.floor(Ue/je),di="InterleavedBuffer:"+Te.bufferView+":"+Te.componentType+":"+Ut+":"+Te.count;let br=ve.cache.get(di);br||(Bt=new re(k,Ut*je,Te.count*je/Re),br=new d.InterleavedBuffer(Bt,je/Re),ve.cache.add(di,br)),bt=new d.InterleavedBufferAttribute(br,Z,Ue%je/Re,dt)}else k===null?Bt=new re(Te.count*Z):Bt=new re(k,Ue,Te.count*Z),bt=new d.BufferAttribute(Bt,Z,dt);if(Te.sparse!==void 0){const Ut=At.SCALAR,di=Xe[Te.sparse.indices.componentType],br=Te.sparse.indices.byteOffset||0,Pi=Te.sparse.values.byteOffset||0,fn=new di(Pe[1],br,Te.sparse.count*Ut),Pr=new re(Pe[2],Pi,Te.sparse.count*Z);k!==null&&(bt=new d.BufferAttribute(bt.array.slice(),bt.itemSize,bt.normalized));for(let tn=0,gs=fn.length;tn<gs;tn++){const mn=fn[tn];if(bt.setX(mn,Pr[tn*Z]),Z>=2&&bt.setY(mn,Pr[tn*Z+1]),Z>=3&&bt.setZ(mn,Pr[tn*Z+2]),Z>=4&&bt.setW(mn,Pr[tn*Z+3]),Z>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return bt})}loadTexture(ye){const ve=this.json,Le=this.options,Te=ve.textures[ye].source,Fe=ve.images[Te];let Pe=this.textureLoader;if(Fe.uri){const k=Le.manager.getHandler(Fe.uri);k!==null&&(Pe=k)}return this.loadTextureImage(ye,Te,Pe)}loadTextureImage(ye,ve,Le){const Te=this,Fe=this.json,Pe=Fe.textures[ye],k=Fe.images[ve],Z=(k.uri||k.bufferView)+":"+Pe.sampler;if(this.textureCache[Z])return this.textureCache[Z];const re=this.loadImageSource(ve,Le).then(function(Re){Re.flipY=!1,Re.name=Pe.name||k.name||"",Re.name===""&&typeof k.uri=="string"&&k.uri.startsWith("data:image/")===!1&&(Re.name=k.uri);const ce=(Fe.samplers||{})[Pe.sampler]||{};return Re.magFilter=$e[ce.magFilter]||d.LinearFilter,Re.minFilter=$e[ce.minFilter]||d.LinearMipmapLinearFilter,Re.wrapS=lt[ce.wrapS]||d.RepeatWrapping,Re.wrapT=lt[ce.wrapT]||d.RepeatWrapping,Te.associations.set(Re,{textures:ye}),Re}).catch(function(){return null});return this.textureCache[Z]=re,re}loadImageSource(ye,ve){const Le=this,Te=this.json,Fe=this.options;if(this.sourceCache[ye]!==void 0)return this.sourceCache[ye].then(ce=>ce.clone());const Pe=Te.images[ye],k=self.URL||self.webkitURL;let Z=Pe.uri||"",re=!1;if(Pe.bufferView!==void 0)Z=Le.getDependency("bufferView",Pe.bufferView).then(function(ce){re=!0;const Ue=new Blob([ce],{type:Pe.mimeType});return Z=k.createObjectURL(Ue),Z});else if(Pe.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+ye+" is missing URI and bufferView");const Re=Promise.resolve(Z).then(function(ce){return new Promise(function(Ue,je){let dt=Ue;ve.isImageBitmapLoader===!0&&(dt=function(Bt){const bt=new d.Texture(Bt);bt.needsUpdate=!0,Ue(bt)}),ve.load(d.LoaderUtils.resolveURL(ce,Fe.path),dt,void 0,je)})}).then(function(ce){return re===!0&&k.revokeObjectURL(Z),ce.userData.mimeType=Pe.mimeType||yt(Pe.uri),ce}).catch(function(ce){throw console.error("THREE.GLTFLoader: Couldn't load texture",Z),ce});return this.sourceCache[ye]=Re,Re}assignTexture(ye,ve,Le,Te){const Fe=this;return this.getDependency("texture",Le.index).then(function(Pe){if(!Pe)return null;if(Le.texCoord!==void 0&&Le.texCoord>0&&(Pe=Pe.clone(),Pe.channel=Le.texCoord),Fe.extensions[g.KHR_TEXTURE_TRANSFORM]){const k=Le.extensions!==void 0?Le.extensions[g.KHR_TEXTURE_TRANSFORM]:void 0;if(k){const Z=Fe.associations.get(Pe);Pe=Fe.extensions[g.KHR_TEXTURE_TRANSFORM].extendTexture(Pe,k),Fe.associations.set(Pe,Z)}}return Te!==void 0&&(Pe.colorSpace=Te),ye[ve]=Pe,Pe})}assignFinalMaterial(ye){const ve=ye.geometry;let Le=ye.material;const Te=ve.attributes.tangent===void 0,Fe=ve.attributes.color!==void 0,Pe=ve.attributes.normal===void 0;if(ye.isPoints){const k="PointsMaterial:"+Le.uuid;let Z=this.cache.get(k);Z||(Z=new d.PointsMaterial,d.Material.prototype.copy.call(Z,Le),Z.color.copy(Le.color),Z.map=Le.map,Z.sizeAttenuation=!1,this.cache.add(k,Z)),Le=Z}else if(ye.isLine){const k="LineBasicMaterial:"+Le.uuid;let Z=this.cache.get(k);Z||(Z=new d.LineBasicMaterial,d.Material.prototype.copy.call(Z,Le),Z.color.copy(Le.color),Z.map=Le.map,this.cache.add(k,Z)),Le=Z}if(Te||Fe||Pe){let k="ClonedMaterial:"+Le.uuid+":";Te&&(k+="derivative-tangents:"),Fe&&(k+="vertex-colors:"),Pe&&(k+="flat-shading:");let Z=this.cache.get(k);Z||(Z=Le.clone(),Fe&&(Z.vertexColors=!0),Pe&&(Z.flatShading=!0),Te&&(Z.normalScale&&(Z.normalScale.y*=-1),Z.clearcoatNormalScale&&(Z.clearcoatNormalScale.y*=-1)),this.cache.add(k,Z),this.associations.set(Z,this.associations.get(Le))),Le=Z}ye.material=Le}getMaterialType(){return d.MeshStandardMaterial}loadMaterial(ye){const ve=this,Le=this.json,Te=this.extensions,Fe=Le.materials[ye];let Pe;const k={},Z=Fe.extensions||{},re=[];if(Z[g.KHR_MATERIALS_UNLIT]){const ce=Te[g.KHR_MATERIALS_UNLIT];Pe=ce.getMaterialType(),re.push(ce.extendParams(k,Fe,ve))}else{const ce=Fe.pbrMetallicRoughness||{};if(k.color=new d.Color(1,1,1),k.opacity=1,Array.isArray(ce.baseColorFactor)){const Ue=ce.baseColorFactor;k.color.setRGB(Ue[0],Ue[1],Ue[2],d.LinearSRGBColorSpace),k.opacity=Ue[3]}ce.baseColorTexture!==void 0&&re.push(ve.assignTexture(k,"map",ce.baseColorTexture,d.SRGBColorSpace)),k.metalness=ce.metallicFactor!==void 0?ce.metallicFactor:1,k.roughness=ce.roughnessFactor!==void 0?ce.roughnessFactor:1,ce.metallicRoughnessTexture!==void 0&&(re.push(ve.assignTexture(k,"metalnessMap",ce.metallicRoughnessTexture)),re.push(ve.assignTexture(k,"roughnessMap",ce.metallicRoughnessTexture))),Pe=this._invokeOne(function(Ue){return Ue.getMaterialType&&Ue.getMaterialType(ye)}),re.push(Promise.all(this._invokeAll(function(Ue){return Ue.extendMaterialParams&&Ue.extendMaterialParams(ye,k)})))}Fe.doubleSided===!0&&(k.side=d.DoubleSide);const Re=Fe.alphaMode||Ze.OPAQUE;if(Re===Ze.BLEND?(k.transparent=!0,k.depthWrite=!1):(k.transparent=!1,Re===Ze.MASK&&(k.alphaTest=Fe.alphaCutoff!==void 0?Fe.alphaCutoff:.5)),Fe.normalTexture!==void 0&&Pe!==d.MeshBasicMaterial&&(re.push(ve.assignTexture(k,"normalMap",Fe.normalTexture)),k.normalScale=new d.Vector2(1,1),Fe.normalTexture.scale!==void 0)){const ce=Fe.normalTexture.scale;k.normalScale.set(ce,ce)}if(Fe.occlusionTexture!==void 0&&Pe!==d.MeshBasicMaterial&&(re.push(ve.assignTexture(k,"aoMap",Fe.occlusionTexture)),Fe.occlusionTexture.strength!==void 0&&(k.aoMapIntensity=Fe.occlusionTexture.strength)),Fe.emissiveFactor!==void 0&&Pe!==d.MeshBasicMaterial){const ce=Fe.emissiveFactor;k.emissive=new d.Color().setRGB(ce[0],ce[1],ce[2],d.LinearSRGBColorSpace)}return Fe.emissiveTexture!==void 0&&Pe!==d.MeshBasicMaterial&&re.push(ve.assignTexture(k,"emissiveMap",Fe.emissiveTexture,d.SRGBColorSpace)),Promise.all(re).then(function(){const ce=new Pe(k);return Fe.name&&(ce.name=Fe.name),Ri(ce,Fe),ve.associations.set(ce,{materials:ye}),Fe.extensions&&hi(Te,ce,Fe),ce})}createUniqueName(ye){const ve=d.PropertyBinding.sanitizeNodeName(ye||"");return ve in this.nodeNamesUsed?ve+"_"+ ++this.nodeNamesUsed[ve]:(this.nodeNamesUsed[ve]=0,ve)}loadGeometries(ye){const ve=this,Le=this.extensions,Te=this.primitiveCache;function Fe(k){return Le[g.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(k,ve).then(function(Z){return xi(Z,k,ve)})}const Pe=[];for(let k=0,Z=ye.length;k<Z;k++){const re=ye[k],Re=Vi(re),ce=Te[Re];if(ce)Pe.push(ce.promise);else{let Ue;re.extensions&&re.extensions[g.KHR_DRACO_MESH_COMPRESSION]?Ue=Fe(re):Ue=xi(new d.BufferGeometry,re,ve),Te[Re]={primitive:re,promise:Ue},Pe.push(Ue)}}return Promise.all(Pe)}loadMesh(ye){const ve=this,Le=this.json,Te=this.extensions,Fe=Le.meshes[ye],Pe=Fe.primitives,k=[];for(let Z=0,re=Pe.length;Z<re;Z++){const Re=Pe[Z].material===void 0?ki(this.cache):this.getDependency("material",Pe[Z].material);k.push(Re)}return k.push(ve.loadGeometries(Pe)),Promise.all(k).then(function(Z){const re=Z.slice(0,Z.length-1),Re=Z[Z.length-1],ce=[];for(let je=0,dt=Re.length;je<dt;je++){const Bt=Re[je],bt=Pe[je];let Ut;const di=re[je];if(bt.mode===Ge.TRIANGLES||bt.mode===Ge.TRIANGLE_STRIP||bt.mode===Ge.TRIANGLE_FAN||bt.mode===void 0)Ut=Fe.isSkinnedMesh===!0?new d.SkinnedMesh(Bt,di):new d.Mesh(Bt,di),Ut.isSkinnedMesh===!0&&Ut.normalizeSkinWeights(),bt.mode===Ge.TRIANGLE_STRIP?Ut.geometry=(0,p.toTrianglesDrawMode)(Ut.geometry,d.TriangleStripDrawMode):bt.mode===Ge.TRIANGLE_FAN&&(Ut.geometry=(0,p.toTrianglesDrawMode)(Ut.geometry,d.TriangleFanDrawMode));else if(bt.mode===Ge.LINES)Ut=new d.LineSegments(Bt,di);else if(bt.mode===Ge.LINE_STRIP)Ut=new d.Line(Bt,di);else if(bt.mode===Ge.LINE_LOOP)Ut=new d.LineLoop(Bt,di);else if(bt.mode===Ge.POINTS)Ut=new d.Points(Bt,di);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+bt.mode);Object.keys(Ut.geometry.morphAttributes).length>0&&tr(Ut,Fe),Ut.name=ve.createUniqueName(Fe.name||"mesh_"+ye),Ri(Ut,Fe),bt.extensions&&hi(Te,Ut,bt),ve.assignFinalMaterial(Ut),ce.push(Ut)}for(let je=0,dt=ce.length;je<dt;je++)ve.associations.set(ce[je],{meshes:ye,primitives:je});if(ce.length===1)return Fe.extensions&&hi(Te,ce[0],Fe),ce[0];const Ue=new d.Group;Fe.extensions&&hi(Te,Ue,Fe),ve.associations.set(Ue,{meshes:ye});for(let je=0,dt=ce.length;je<dt;je++)Ue.add(ce[je]);return Ue})}loadCamera(ye){let ve;const Le=this.json.cameras[ye],Te=Le[Le.type];if(!Te){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return Le.type==="perspective"?ve=new d.PerspectiveCamera(d.MathUtils.radToDeg(Te.yfov),Te.aspectRatio||1,Te.znear||1,Te.zfar||2e6):Le.type==="orthographic"&&(ve=new d.OrthographicCamera(-Te.xmag,Te.xmag,Te.ymag,-Te.ymag,Te.znear,Te.zfar)),Le.name&&(ve.name=this.createUniqueName(Le.name)),Ri(ve,Le),Promise.resolve(ve)}loadSkin(ye){const ve=this.json.skins[ye],Le=[];for(let Te=0,Fe=ve.joints.length;Te<Fe;Te++)Le.push(this._loadNodeShallow(ve.joints[Te]));return ve.inverseBindMatrices!==void 0?Le.push(this.getDependency("accessor",ve.inverseBindMatrices)):Le.push(null),Promise.all(Le).then(function(Te){const Fe=Te.pop(),Pe=Te,k=[],Z=[];for(let re=0,Re=Pe.length;re<Re;re++){const ce=Pe[re];if(ce){k.push(ce);const Ue=new d.Matrix4;Fe!==null&&Ue.fromArray(Fe.array,re*16),Z.push(Ue)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',ve.joints[re])}return new d.Skeleton(k,Z)})}loadAnimation(ye){const ve=this.json,Le=this,Te=ve.animations[ye],Fe=Te.name?Te.name:"animation_"+ye,Pe=[],k=[],Z=[],re=[],Re=[];for(let ce=0,Ue=Te.channels.length;ce<Ue;ce++){const je=Te.channels[ce],dt=Te.samplers[je.sampler],Bt=je.target,bt=Bt.node,Ut=Te.parameters!==void 0?Te.parameters[dt.input]:dt.input,di=Te.parameters!==void 0?Te.parameters[dt.output]:dt.output;Bt.node!==void 0&&(Pe.push(this.getDependency("node",bt)),k.push(this.getDependency("accessor",Ut)),Z.push(this.getDependency("accessor",di)),re.push(dt),Re.push(Bt))}return Promise.all([Promise.all(Pe),Promise.all(k),Promise.all(Z),Promise.all(re),Promise.all(Re)]).then(function(ce){const Ue=ce[0],je=ce[1],dt=ce[2],Bt=ce[3],bt=ce[4],Ut=[];for(let di=0,br=Ue.length;di<br;di++){const Pi=Ue[di],fn=je[di],Pr=dt[di],tn=Bt[di],gs=bt[di];if(Pi===void 0)continue;Pi.updateMatrix&&Pi.updateMatrix();const mn=Le._createAnimationTracks(Pi,fn,Pr,tn,gs);if(mn)for(let Rs=0;Rs<mn.length;Rs++)Ut.push(mn[Rs])}return new d.AnimationClip(Fe,void 0,Ut)})}createNodeMesh(ye){const ve=this.json,Le=this,Te=ve.nodes[ye];return Te.mesh===void 0?null:Le.getDependency("mesh",Te.mesh).then(function(Fe){const Pe=Le._getNodeRef(Le.meshCache,Te.mesh,Fe);return Te.weights!==void 0&&Pe.traverse(function(k){if(k.isMesh)for(let Z=0,re=Te.weights.length;Z<re;Z++)k.morphTargetInfluences[Z]=Te.weights[Z]}),Pe})}loadNode(ye){const ve=this.json,Le=this,Te=ve.nodes[ye],Fe=Le._loadNodeShallow(ye),Pe=[],k=Te.children||[];for(let re=0,Re=k.length;re<Re;re++)Pe.push(Le.getDependency("node",k[re]));const Z=Te.skin===void 0?Promise.resolve(null):Le.getDependency("skin",Te.skin);return Promise.all([Fe,Promise.all(Pe),Z]).then(function(re){const Re=re[0],ce=re[1],Ue=re[2];Ue!==null&&Re.traverse(function(je){je.isSkinnedMesh&&je.bind(Ue,Ot)});for(let je=0,dt=ce.length;je<dt;je++)Re.add(ce[je]);return Re})}_loadNodeShallow(ye){const ve=this.json,Le=this.extensions,Te=this;if(this.nodeCache[ye]!==void 0)return this.nodeCache[ye];const Fe=ve.nodes[ye],Pe=Fe.name?Te.createUniqueName(Fe.name):"",k=[],Z=Te._invokeOne(function(re){return re.createNodeMesh&&re.createNodeMesh(ye)});return Z&&k.push(Z),Fe.camera!==void 0&&k.push(Te.getDependency("camera",Fe.camera).then(function(re){return Te._getNodeRef(Te.cameraCache,Fe.camera,re)})),Te._invokeAll(function(re){return re.createNodeAttachment&&re.createNodeAttachment(ye)}).forEach(function(re){k.push(re)}),this.nodeCache[ye]=Promise.all(k).then(function(re){let Re;if(Fe.isBone===!0?Re=new d.Bone:re.length>1?Re=new d.Group:re.length===1?Re=re[0]:Re=new d.Object3D,Re!==re[0])for(let ce=0,Ue=re.length;ce<Ue;ce++)Re.add(re[ce]);if(Fe.name&&(Re.userData.name=Fe.name,Re.name=Pe),Ri(Re,Fe),Fe.extensions&&hi(Le,Re,Fe),Fe.matrix!==void 0){const ce=new d.Matrix4;ce.fromArray(Fe.matrix),Re.applyMatrix4(ce)}else Fe.translation!==void 0&&Re.position.fromArray(Fe.translation),Fe.rotation!==void 0&&Re.quaternion.fromArray(Fe.rotation),Fe.scale!==void 0&&Re.scale.fromArray(Fe.scale);return Te.associations.has(Re)||Te.associations.set(Re,{}),Te.associations.get(Re).nodes=ye,Re}),this.nodeCache[ye]}loadScene(ye){const ve=this.extensions,Le=this.json.scenes[ye],Te=this,Fe=new d.Group;Le.name&&(Fe.name=Te.createUniqueName(Le.name)),Ri(Fe,Le),Le.extensions&&hi(ve,Fe,Le);const Pe=Le.nodes||[],k=[];for(let Z=0,re=Pe.length;Z<re;Z++)k.push(Te.getDependency("node",Pe[Z]));return Promise.all(k).then(function(Z){for(let Re=0,ce=Z.length;Re<ce;Re++)Fe.add(Z[Re]);const re=Re=>{const ce=new Map;for(const[Ue,je]of Te.associations)(Ue instanceof d.Material||Ue instanceof d.Texture)&&ce.set(Ue,je);return Re.traverse(Ue=>{const je=Te.associations.get(Ue);je!=null&&ce.set(Ue,je)}),ce};return Te.associations=re(Fe),Fe})}_createAnimationTracks(ye,ve,Le,Te,Fe){const Pe=[],k=ye.name?ye.name:ye.uuid,Z=[];gt[Fe.path]===gt.weights?ye.traverse(function(Ue){Ue.morphTargetInfluences&&Z.push(Ue.name?Ue.name:Ue.uuid)}):Z.push(k);let re;switch(gt[Fe.path]){case gt.weights:re=d.NumberKeyframeTrack;break;case gt.rotation:re=d.QuaternionKeyframeTrack;break;case gt.position:case gt.scale:re=d.VectorKeyframeTrack;break;default:switch(Le.itemSize){case 1:re=d.NumberKeyframeTrack;break;case 2:case 3:default:re=d.VectorKeyframeTrack;break}break}const Re=Te.interpolation!==void 0?yi[Te.interpolation]:d.InterpolateLinear,ce=this._getArrayFromAccessor(Le);for(let Ue=0,je=Z.length;Ue<je;Ue++){const dt=new re(Z[Ue]+"."+gt[Fe.path],ve.array,ce,Re);Te.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(dt),Pe.push(dt)}return Pe}_getArrayFromAccessor(ye){let ve=ye.array;if(ye.normalized){const Le=Ce(ve.constructor),Te=new Float32Array(ve.length);for(let Fe=0,Pe=ve.length;Fe<Pe;Fe++)Te[Fe]=ve[Fe]*Le;ve=Te}return ve}_createCubicSplineTrackInterpolant(ye){ye.createInterpolant=function(ve){const Le=this instanceof d.QuaternionKeyframeTrack?Ie:fe;return new Le(this.times,this.values,this.getValueSize()/3,ve)},ye.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function zt(vt,ye,ve){const Le=ye.attributes,Te=new d.Box3;if(Le.POSITION!==void 0){const k=ve.json.accessors[Le.POSITION],Z=k.min,re=k.max;if(Z!==void 0&&re!==void 0){if(Te.set(new d.Vector3(Z[0],Z[1],Z[2]),new d.Vector3(re[0],re[1],re[2])),k.normalized){const Re=Ce(Xe[k.componentType]);Te.min.multiplyScalar(Re),Te.max.multiplyScalar(Re)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const Fe=ye.targets;if(Fe!==void 0){const k=new d.Vector3,Z=new d.Vector3;for(let re=0,Re=Fe.length;re<Re;re++){const ce=Fe[re];if(ce.POSITION!==void 0){const Ue=ve.json.accessors[ce.POSITION],je=Ue.min,dt=Ue.max;if(je!==void 0&&dt!==void 0){if(Z.setX(Math.max(Math.abs(je[0]),Math.abs(dt[0]))),Z.setY(Math.max(Math.abs(je[1]),Math.abs(dt[1]))),Z.setZ(Math.max(Math.abs(je[2]),Math.abs(dt[2]))),Ue.normalized){const Bt=Ce(Xe[Ue.componentType]);Z.multiplyScalar(Bt)}k.max(Z)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Te.expandByVector(k)}vt.boundingBox=Te;const Pe=new d.Sphere;Te.getCenter(Pe.center),Pe.radius=Te.min.distanceTo(Te.max)/2,vt.boundingSphere=Pe}function xi(vt,ye,ve){const Le=ye.attributes,Te=[];function Fe(Pe,k){return ve.getDependency("accessor",Pe).then(function(Z){vt.setAttribute(k,Z)})}for(const Pe in Le){const k=Gt[Pe]||Pe.toLowerCase();k in vt.attributes||Te.push(Fe(Le[Pe],k))}if(ye.indices!==void 0&&!vt.index){const Pe=ve.getDependency("accessor",ye.indices).then(function(k){vt.setIndex(k)});Te.push(Pe)}return d.ColorManagement.workingColorSpace!==d.LinearSRGBColorSpace&&"COLOR_0"in Le&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${d.ColorManagement.workingColorSpace}" not supported.`),Ri(vt,ye),zt(vt,ye,ve),Promise.all(Te).then(function(){return ye.targets!==void 0?Si(vt,ye.targets,ve):vt})}},"./node_modules/three/examples/jsm/loaders/KTX2Loader.js":(l,u,c)=>{c.r(u),c.d(u,{KTX2Loader:()=>v});var d=c("./node_modules/three/build/three.module.js"),p=c("./node_modules/three/examples/jsm/utils/WorkerPool.js"),f=c("./node_modules/three/examples/jsm/libs/ktx-parse.module.js"),m=c("./node_modules/three/examples/jsm/libs/zstddec.module.js");const g=new WeakMap;let y=0,x;class v extends d.Loader{constructor(I){super(I),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new p.WorkerPool,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(I){return this.transcoderPath=I,this}setWorkerLimit(I){return this.workerPool.setWorkerLimit(I),this}async detectSupportAsync(I){return this.workerConfig={astcSupported:await I.hasFeatureAsync("texture-compression-astc"),etc1Supported:await I.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await I.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await I.hasFeatureAsync("texture-compression-bc"),bptcSupported:await I.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await I.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(I){return I.isWebGPURenderer===!0?this.workerConfig={astcSupported:I.hasFeature("texture-compression-astc"),etc1Supported:I.hasFeature("texture-compression-etc1"),etc2Supported:I.hasFeature("texture-compression-etc2"),dxtSupported:I.hasFeature("texture-compression-bc"),bptcSupported:I.hasFeature("texture-compression-bptc"),pvrtcSupported:I.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:I.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:I.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:I.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:I.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:I.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:I.extensions.has("WEBGL_compressed_texture_pvrtc")||I.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const I=new d.FileLoader(this.manager);I.setPath(this.transcoderPath),I.setWithCredentials(this.withCredentials);const D=I.loadAsync("basis_transcoder.js"),L=new d.FileLoader(this.manager);L.setPath(this.transcoderPath),L.setResponseType("arraybuffer"),L.setWithCredentials(this.withCredentials);const O=L.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([D,O]).then(([U,J])=>{const H=v.BasisWorker.toString(),V=["/* constants */","let _EngineFormat = "+JSON.stringify(v.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(v.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(v.BasisFormat),"/* basis_transcoder.js */",U,"/* worker */",H.substring(H.indexOf("{")+1,H.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([V])),this.transcoderBinary=J,this.workerPool.setWorkerCreator(()=>{const $=new Worker(this.workerSourceURL),Q=this.transcoderBinary.slice(0);return $.postMessage({type:"init",config:this.workerConfig,transcoderBinary:Q},[Q]),$})}),y>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),y++}return this.transcoderPending}load(I,D,L,O){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const U=new d.FileLoader(this.manager);U.setResponseType("arraybuffer"),U.setWithCredentials(this.withCredentials),U.load(I,J=>{if(g.has(J))return g.get(J).promise.then(D).catch(O);this._createTexture(J).then(H=>D?D(H):null).catch(O)},L,O)}_createTextureFrom(I,D){const{faces:L,width:O,height:U,format:J,type:H,error:V,dfdFlags:$}=I;if(H==="error")return Promise.reject(V);let Q;if(D.faceCount===6)Q=new d.CompressedCubeTexture(L,J,d.UnsignedByteType);else{const G=L[0].mipmaps;Q=D.layerCount>1?new d.CompressedArrayTexture(G,O,U,D.layerCount,J,d.UnsignedByteType):new d.CompressedTexture(G,O,U,J,d.UnsignedByteType)}return Q.minFilter=L[0].mipmaps.length===1?d.LinearFilter:d.LinearMipmapLinearFilter,Q.magFilter=d.LinearFilter,Q.generateMipmaps=!1,Q.needsUpdate=!0,Q.colorSpace=R(D),Q.premultiplyAlpha=!!($&f.KHR_DF_FLAG_ALPHA_PREMULTIPLIED),Q}async _createTexture(I,D={}){const L=(0,f.read)(new Uint8Array(I));if(L.vkFormat!==f.VK_FORMAT_UNDEFINED)return S(L);const O=D,U=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:I,taskConfig:O},[I])).then(J=>this._createTextureFrom(J.data,L));return g.set(I,{promise:U}),U}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),y--,this}}v.BasisFormat={ETC1S:0,UASTC_4x4:1},v.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},v.EngineFormat={RGBAFormat:d.RGBAFormat,RGBA_ASTC_4x4_Format:d.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:d.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:d.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:d.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:d.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:d.RGB_ETC1_Format,RGB_ETC2_Format:d.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:d.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:d.RGBA_S3TC_DXT1_Format},v.BasisWorker=function(){let B,I,D;const L=_EngineFormat,O=_TranscoderFormat,U=_BasisFormat;self.addEventListener("message",function(Y){const ae=Y.data;switch(ae.type){case"init":B=ae.config,J(ae.transcoderBinary);break;case"transcode":I.then(()=>{try{const{faces:xe,buffers:fe,width:de,height:Ie,hasAlpha:Ge,format:Xe,dfdFlags:$e}=H(ae.buffer);self.postMessage({type:"transcode",id:ae.id,faces:xe,width:de,height:Ie,hasAlpha:Ge,format:Xe,dfdFlags:$e},fe)}catch(xe){console.error(xe),self.postMessage({type:"error",id:ae.id,error:xe.message})}});break}});function J(Y){I=new Promise(ae=>{D={wasmBinary:Y,onRuntimeInitialized:ae},BASIS(D)}).then(()=>{D.initializeBasis(),D.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function H(Y){const ae=new D.KTX2File(new Uint8Array(Y));function xe(){ae.close(),ae.delete()}if(!ae.isValid())throw xe(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const fe=ae.isUASTC()?U.UASTC_4x4:U.ETC1S,de=ae.getWidth(),Ie=ae.getHeight(),Ge=ae.getLayers()||1,Xe=ae.getLevels(),$e=ae.getFaces(),lt=ae.getHasAlpha(),At=ae.getDFDFlags(),{transcoderFormat:Gt,engineFormat:gt}=G(fe,de,Ie,lt);if(!de||!Ie||!Xe)throw xe(),new Error("THREE.KTX2Loader:	Invalid texture");if(!ae.startTranscoding())throw xe(),new Error("THREE.KTX2Loader: .startTranscoding failed");const yi=[],Ze=[];for(let ki=0;ki<$e;ki++){const hi=[];for(let Ri=0;Ri<Xe;Ri++){const Si=[];let tr,Vi;for(let Ce=0;Ce<Ge;Ce++){const yt=ae.getImageLevelInfo(Ri,Ce,ki);ki===0&&Ri===0&&Ce===0&&(yt.origWidth%4!==0||yt.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),Xe>1?(tr=yt.origWidth,Vi=yt.origHeight):(tr=yt.width,Vi=yt.height);const Ot=new Uint8Array(ae.getImageTranscodedSizeInBytes(Ri,Ce,0,Gt));if(!ae.transcodeImage(Ot,Ri,Ce,ki,Gt,0,-1,-1))throw xe(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Si.push(Ot)}const Qe=ie(Si);hi.push({data:Qe,width:tr,height:Vi}),Ze.push(Qe.buffer)}yi.push({mipmaps:hi,width:de,height:Ie,format:gt})}return xe(),{faces:yi,buffers:Ze,width:de,height:Ie,hasAlpha:lt,format:gt,dfdFlags:At}}const V=[{if:"astcSupported",basisFormat:[U.UASTC_4x4],transcoderFormat:[O.ASTC_4x4,O.ASTC_4x4],engineFormat:[L.RGBA_ASTC_4x4_Format,L.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[U.ETC1S,U.UASTC_4x4],transcoderFormat:[O.BC7_M5,O.BC7_M5],engineFormat:[L.RGBA_BPTC_Format,L.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[U.ETC1S,U.UASTC_4x4],transcoderFormat:[O.BC1,O.BC3],engineFormat:[L.RGBA_S3TC_DXT1_Format,L.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[U.ETC1S,U.UASTC_4x4],transcoderFormat:[O.ETC1,O.ETC2],engineFormat:[L.RGB_ETC2_Format,L.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[U.ETC1S,U.UASTC_4x4],transcoderFormat:[O.ETC1],engineFormat:[L.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[U.ETC1S,U.UASTC_4x4],transcoderFormat:[O.PVRTC1_4_RGB,O.PVRTC1_4_RGBA],engineFormat:[L.RGB_PVRTC_4BPPV1_Format,L.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],$=V.sort(function(Y,ae){return Y.priorityETC1S-ae.priorityETC1S}),Q=V.sort(function(Y,ae){return Y.priorityUASTC-ae.priorityUASTC});function G(Y,ae,xe,fe){let de,Ie;const Ge=Y===U.ETC1S?$:Q;for(let Xe=0;Xe<Ge.length;Xe++){const $e=Ge[Xe];if(B[$e.if]&&$e.basisFormat.includes(Y)&&!(fe&&$e.transcoderFormat.length<2)&&!($e.needsPowerOfTwo&&!(j(ae)&&j(xe))))return de=$e.transcoderFormat[fe?1:0],Ie=$e.engineFormat[fe?1:0],{transcoderFormat:de,engineFormat:Ie}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),de=O.RGBA32,Ie=L.RGBAFormat,{transcoderFormat:de,engineFormat:Ie}}function j(Y){return Y<=2?!0:(Y&Y-1)===0&&Y!==0}function ie(Y){if(Y.length===1)return Y[0];let ae=0;for(let de=0;de<Y.length;de++){const Ie=Y[de];ae+=Ie.byteLength}const xe=new Uint8Array(ae);let fe=0;for(let de=0;de<Y.length;de++){const Ie=Y[de];xe.set(Ie,fe),fe+=Ie.byteLength}return xe}};const _=new Set([d.RGBAFormat,d.RGFormat,d.RedFormat]),T={[f.VK_FORMAT_R32G32B32A32_SFLOAT]:d.RGBAFormat,[f.VK_FORMAT_R16G16B16A16_SFLOAT]:d.RGBAFormat,[f.VK_FORMAT_R8G8B8A8_UNORM]:d.RGBAFormat,[f.VK_FORMAT_R8G8B8A8_SRGB]:d.RGBAFormat,[f.VK_FORMAT_R32G32_SFLOAT]:d.RGFormat,[f.VK_FORMAT_R16G16_SFLOAT]:d.RGFormat,[f.VK_FORMAT_R8G8_UNORM]:d.RGFormat,[f.VK_FORMAT_R8G8_SRGB]:d.RGFormat,[f.VK_FORMAT_R32_SFLOAT]:d.RedFormat,[f.VK_FORMAT_R16_SFLOAT]:d.RedFormat,[f.VK_FORMAT_R8_SRGB]:d.RedFormat,[f.VK_FORMAT_R8_UNORM]:d.RedFormat,[f.VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:d.RGBA_ASTC_6x6_Format,[f.VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:d.RGBA_ASTC_6x6_Format},w={[f.VK_FORMAT_R32G32B32A32_SFLOAT]:d.FloatType,[f.VK_FORMAT_R16G16B16A16_SFLOAT]:d.HalfFloatType,[f.VK_FORMAT_R8G8B8A8_UNORM]:d.UnsignedByteType,[f.VK_FORMAT_R8G8B8A8_SRGB]:d.UnsignedByteType,[f.VK_FORMAT_R32G32_SFLOAT]:d.FloatType,[f.VK_FORMAT_R16G16_SFLOAT]:d.HalfFloatType,[f.VK_FORMAT_R8G8_UNORM]:d.UnsignedByteType,[f.VK_FORMAT_R8G8_SRGB]:d.UnsignedByteType,[f.VK_FORMAT_R32_SFLOAT]:d.FloatType,[f.VK_FORMAT_R16_SFLOAT]:d.HalfFloatType,[f.VK_FORMAT_R8_SRGB]:d.UnsignedByteType,[f.VK_FORMAT_R8_UNORM]:d.UnsignedByteType,[f.VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:d.UnsignedByteType,[f.VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:d.UnsignedByteType};async function S(B){const{vkFormat:I}=B;if(T[I]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let D;B.supercompressionScheme===f.KHR_SUPERCOMPRESSION_ZSTD&&(x||(x=new Promise(async U=>{const J=new m.ZSTDDecoder;await J.init(),U(J)})),D=await x);const L=[];for(let U=0;U<B.levels.length;U++){const J=Math.max(1,B.pixelWidth>>U),H=Math.max(1,B.pixelHeight>>U),V=B.pixelDepth?Math.max(1,B.pixelDepth>>U):0,$=B.levels[U];let Q;if(B.supercompressionScheme===f.KHR_SUPERCOMPRESSION_NONE)Q=$.levelData;else if(B.supercompressionScheme===f.KHR_SUPERCOMPRESSION_ZSTD)Q=D.decode($.levelData,$.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let G;w[I]===d.FloatType?G=new Float32Array(Q.buffer,Q.byteOffset,Q.byteLength/Float32Array.BYTES_PER_ELEMENT):w[I]===d.HalfFloatType?G=new Uint16Array(Q.buffer,Q.byteOffset,Q.byteLength/Uint16Array.BYTES_PER_ELEMENT):G=Q,L.push({data:G,width:J,height:H,depth:V})}let O;if(_.has(T[I]))O=B.pixelDepth===0?new d.DataTexture(L[0].data,B.pixelWidth,B.pixelHeight):new d.Data3DTexture(L[0].data,B.pixelWidth,B.pixelHeight,B.pixelDepth);else{if(B.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");O=new d.CompressedTexture(L,B.pixelWidth,B.pixelHeight)}return O.mipmaps=L,O.type=w[I],O.format=T[I],O.colorSpace=R(B),O.needsUpdate=!0,Promise.resolve(O)}function R(B){const I=B.dataFormatDescriptor[0];return I.colorPrimaries===f.KHR_DF_PRIMARIES_BT709?I.transferFunction===f.KHR_DF_TRANSFER_SRGB?d.SRGBColorSpace:d.LinearSRGBColorSpace:I.colorPrimaries===f.KHR_DF_PRIMARIES_DISPLAYP3?I.transferFunction===f.KHR_DF_TRANSFER_SRGB?d.DisplayP3ColorSpace:d.LinearDisplayP3ColorSpace:(I.colorPrimaries===f.KHR_DF_PRIMARIES_UNSPECIFIED||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${I.colorPrimaries}"`),d.NoColorSpace)}},"./node_modules/three/examples/jsm/loaders/MTLLoader.js":(l,u,c)=>{c.r(u),c.d(u,{MTLLoader:()=>p});var d=c("./node_modules/three/build/three.module.js");class p extends d.Loader{constructor(g){super(g)}load(g,y,x,v){const _=this,T=this.path===""?d.LoaderUtils.extractUrlBase(g):this.path,w=new d.FileLoader(this.manager);w.setPath(this.path),w.setRequestHeader(this.requestHeader),w.setWithCredentials(this.withCredentials),w.load(g,function(S){try{y(_.parse(S,T))}catch(R){v?v(R):console.error(R),_.manager.itemError(g)}},x,v)}setMaterialOptions(g){return this.materialOptions=g,this}parse(g,y){const x=g.split(`
`);let v={};const _=/\s+/,T={};for(let S=0;S<x.length;S++){let R=x[S];if(R=R.trim(),R.length===0||R.charAt(0)==="#")continue;const B=R.indexOf(" ");let I=B>=0?R.substring(0,B):R;I=I.toLowerCase();let D=B>=0?R.substring(B+1):"";if(D=D.trim(),I==="newmtl")v={name:D},T[D]=v;else if(I==="ka"||I==="kd"||I==="ks"||I==="ke"){const L=D.split(_,3);v[I]=[parseFloat(L[0]),parseFloat(L[1]),parseFloat(L[2])]}else v[I]=D}const w=new f(this.resourcePath||y,this.materialOptions);return w.setCrossOrigin(this.crossOrigin),w.setManager(this.manager),w.setMaterials(T),w}}class f{constructor(g="",y={}){this.baseUrl=g,this.options=y,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:d.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:d.RepeatWrapping}setCrossOrigin(g){return this.crossOrigin=g,this}setManager(g){this.manager=g}setMaterials(g){this.materialsInfo=this.convert(g),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(g){if(!this.options)return g;const y={};for(const x in g){const v=g[x],_={};y[x]=_;for(const T in v){let w=!0,S=v[T];const R=T.toLowerCase();switch(R){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(S=[S[0]/255,S[1]/255,S[2]/255]),this.options&&this.options.ignoreZeroRGBs&&S[0]===0&&S[1]===0&&S[2]===0&&(w=!1);break}w&&(_[R]=S)}}return y}preload(){for(const g in this.materialsInfo)this.create(g)}getIndex(g){return this.nameLookup[g]}getAsArray(){let g=0;for(const y in this.materialsInfo)this.materialsArray[g]=this.create(y),this.nameLookup[y]=g,g++;return this.materialsArray}create(g){return this.materials[g]===void 0&&this.createMaterial_(g),this.materials[g]}createMaterial_(g){const y=this,x=this.materialsInfo[g],v={name:g,side:this.side};function _(w,S){return typeof S!="string"||S===""?"":/^https?:\/\//i.test(S)?S:w+S}function T(w,S){if(v[w])return;const R=y.getTextureParams(S,v),B=y.loadTexture(_(y.baseUrl,R.url));B.repeat.copy(R.scale),B.offset.copy(R.offset),B.wrapS=y.wrap,B.wrapT=y.wrap,(w==="map"||w==="emissiveMap")&&(B.colorSpace=d.SRGBColorSpace),v[w]=B}for(const w in x){const S=x[w];let R;if(S!=="")switch(w.toLowerCase()){case"kd":v.color=new d.Color().fromArray(S).convertSRGBToLinear();break;case"ks":v.specular=new d.Color().fromArray(S).convertSRGBToLinear();break;case"ke":v.emissive=new d.Color().fromArray(S).convertSRGBToLinear();break;case"map_kd":T("map",S);break;case"map_ks":T("specularMap",S);break;case"map_ke":T("emissiveMap",S);break;case"norm":T("normalMap",S);break;case"map_bump":case"bump":T("bumpMap",S);break;case"map_d":T("alphaMap",S),v.transparent=!0;break;case"ns":v.shininess=parseFloat(S);break;case"d":R=parseFloat(S),R<1&&(v.opacity=R,v.transparent=!0);break;case"tr":R=parseFloat(S),this.options&&this.options.invertTrProperty&&(R=1-R),R>0&&(v.opacity=1-R,v.transparent=!0);break}}return this.materials[g]=new d.MeshPhongMaterial(v),this.materials[g]}getTextureParams(g,y){const x={scale:new d.Vector2(1,1),offset:new d.Vector2(0,0)},v=g.split(/\s+/);let _;return _=v.indexOf("-bm"),_>=0&&(y.bumpScale=parseFloat(v[_+1]),v.splice(_,2)),_=v.indexOf("-s"),_>=0&&(x.scale.set(parseFloat(v[_+1]),parseFloat(v[_+2])),v.splice(_,4)),_=v.indexOf("-o"),_>=0&&(x.offset.set(parseFloat(v[_+1]),parseFloat(v[_+2])),v.splice(_,4)),x.url=v.join(" ").trim(),x}loadTexture(g,y,x,v,_){const T=this.manager!==void 0?this.manager:d.DefaultLoadingManager;let w=T.getHandler(g);w===null&&(w=new d.TextureLoader(T)),w.setCrossOrigin&&w.setCrossOrigin(this.crossOrigin);const S=w.load(g,x,v,_);return y!==void 0&&(S.mapping=y),S}}},"./node_modules/three/examples/jsm/loaders/OBJLoader.js":(l,u,c)=>{c.r(u),c.d(u,{OBJLoader:()=>B});var d=c("./node_modules/three/build/three.module.js");const p=/^[og]\s*(.+)?/,f=/^mtllib /,m=/^usemtl /,g=/^usemap /,y=/\s+/,x=new d.Vector3,v=new d.Vector3,_=new d.Vector3,T=new d.Vector3,w=new d.Vector3,S=new d.Color;function R(){const I={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(D,L){if(this.object&&this.object.fromDeclaration===!1){this.object.name=D,this.object.fromDeclaration=L!==!1;return}const O=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:D||"",fromDeclaration:L!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(U,J){const H=this._finalize(!1);H&&(H.inherited||H.groupCount<=0)&&this.materials.splice(H.index,1);const V={index:this.materials.length,name:U||"",mtllib:Array.isArray(J)&&J.length>0?J[J.length-1]:"",smooth:H!==void 0?H.smooth:this.smooth,groupStart:H!==void 0?H.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function($){const Q={index:typeof $=="number"?$:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return Q.clone=this.clone.bind(Q),Q}};return this.materials.push(V),V},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(U){const J=this.currentMaterial();if(J&&J.groupEnd===-1&&(J.groupEnd=this.geometry.vertices.length/3,J.groupCount=J.groupEnd-J.groupStart,J.inherited=!1),U&&this.materials.length>1)for(let H=this.materials.length-1;H>=0;H--)this.materials[H].groupCount<=0&&this.materials.splice(H,1);return U&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),J}},O&&O.name&&typeof O.clone=="function"){const U=O.clone(0);U.inherited=!0,this.object.materials.push(U)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(D,L){const O=parseInt(D,10);return(O>=0?O-1:O+L/3)*3},parseNormalIndex:function(D,L){const O=parseInt(D,10);return(O>=0?O-1:O+L/3)*3},parseUVIndex:function(D,L){const O=parseInt(D,10);return(O>=0?O-1:O+L/2)*2},addVertex:function(D,L,O){const U=this.vertices,J=this.object.geometry.vertices;J.push(U[D+0],U[D+1],U[D+2]),J.push(U[L+0],U[L+1],U[L+2]),J.push(U[O+0],U[O+1],U[O+2])},addVertexPoint:function(D){const L=this.vertices;this.object.geometry.vertices.push(L[D+0],L[D+1],L[D+2])},addVertexLine:function(D){const L=this.vertices;this.object.geometry.vertices.push(L[D+0],L[D+1],L[D+2])},addNormal:function(D,L,O){const U=this.normals,J=this.object.geometry.normals;J.push(U[D+0],U[D+1],U[D+2]),J.push(U[L+0],U[L+1],U[L+2]),J.push(U[O+0],U[O+1],U[O+2])},addFaceNormal:function(D,L,O){const U=this.vertices,J=this.object.geometry.normals;x.fromArray(U,D),v.fromArray(U,L),_.fromArray(U,O),w.subVectors(_,v),T.subVectors(x,v),w.cross(T),w.normalize(),J.push(w.x,w.y,w.z),J.push(w.x,w.y,w.z),J.push(w.x,w.y,w.z)},addColor:function(D,L,O){const U=this.colors,J=this.object.geometry.colors;U[D]!==void 0&&J.push(U[D+0],U[D+1],U[D+2]),U[L]!==void 0&&J.push(U[L+0],U[L+1],U[L+2]),U[O]!==void 0&&J.push(U[O+0],U[O+1],U[O+2])},addUV:function(D,L,O){const U=this.uvs,J=this.object.geometry.uvs;J.push(U[D+0],U[D+1]),J.push(U[L+0],U[L+1]),J.push(U[O+0],U[O+1])},addDefaultUV:function(){const D=this.object.geometry.uvs;D.push(0,0),D.push(0,0),D.push(0,0)},addUVLine:function(D){const L=this.uvs;this.object.geometry.uvs.push(L[D+0],L[D+1])},addFace:function(D,L,O,U,J,H,V,$,Q){const G=this.vertices.length;let j=this.parseVertexIndex(D,G),ie=this.parseVertexIndex(L,G),Y=this.parseVertexIndex(O,G);if(this.addVertex(j,ie,Y),this.addColor(j,ie,Y),V!==void 0&&V!==""){const ae=this.normals.length;j=this.parseNormalIndex(V,ae),ie=this.parseNormalIndex($,ae),Y=this.parseNormalIndex(Q,ae),this.addNormal(j,ie,Y)}else this.addFaceNormal(j,ie,Y);if(U!==void 0&&U!==""){const ae=this.uvs.length;j=this.parseUVIndex(U,ae),ie=this.parseUVIndex(J,ae),Y=this.parseUVIndex(H,ae),this.addUV(j,ie,Y),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(D){this.object.geometry.type="Points";const L=this.vertices.length;for(let O=0,U=D.length;O<U;O++){const J=this.parseVertexIndex(D[O],L);this.addVertexPoint(J),this.addColor(J)}},addLineGeometry:function(D,L){this.object.geometry.type="Line";const O=this.vertices.length,U=this.uvs.length;for(let J=0,H=D.length;J<H;J++)this.addVertexLine(this.parseVertexIndex(D[J],O));for(let J=0,H=L.length;J<H;J++)this.addUVLine(this.parseUVIndex(L[J],U))}};return I.startObject("",!1),I}class B extends d.Loader{constructor(D){super(D),this.materials=null}load(D,L,O,U){const J=this,H=new d.FileLoader(this.manager);H.setPath(this.path),H.setRequestHeader(this.requestHeader),H.setWithCredentials(this.withCredentials),H.load(D,function(V){try{L(J.parse(V))}catch($){U?U($):console.error($),J.manager.itemError(D)}},O,U)}setMaterials(D){return this.materials=D,this}parse(D){const L=new R;D.indexOf(`\r
`)!==-1&&(D=D.replace(/\r\n/g,`
`)),D.indexOf(`\\
`)!==-1&&(D=D.replace(/\\\n/g,""));const O=D.split(`
`);let U=[];for(let H=0,V=O.length;H<V;H++){const $=O[H].trimStart();if($.length===0)continue;const Q=$.charAt(0);if(Q!=="#")if(Q==="v"){const G=$.split(y);switch(G[0]){case"v":L.vertices.push(parseFloat(G[1]),parseFloat(G[2]),parseFloat(G[3])),G.length>=7?(S.setRGB(parseFloat(G[4]),parseFloat(G[5]),parseFloat(G[6])).convertSRGBToLinear(),L.colors.push(S.r,S.g,S.b)):L.colors.push(void 0,void 0,void 0);break;case"vn":L.normals.push(parseFloat(G[1]),parseFloat(G[2]),parseFloat(G[3]));break;case"vt":L.uvs.push(parseFloat(G[1]),parseFloat(G[2]));break}}else if(Q==="f"){const G=$.slice(1).trim().split(y),j=[];for(let Y=0,ae=G.length;Y<ae;Y++){const xe=G[Y];if(xe.length>0){const fe=xe.split("/");j.push(fe)}}const ie=j[0];for(let Y=1,ae=j.length-1;Y<ae;Y++){const xe=j[Y],fe=j[Y+1];L.addFace(ie[0],xe[0],fe[0],ie[1],xe[1],fe[1],ie[2],xe[2],fe[2])}}else if(Q==="l"){const G=$.substring(1).trim().split(" ");let j=[];const ie=[];if($.indexOf("/")===-1)j=G;else for(let Y=0,ae=G.length;Y<ae;Y++){const xe=G[Y].split("/");xe[0]!==""&&j.push(xe[0]),xe[1]!==""&&ie.push(xe[1])}L.addLineGeometry(j,ie)}else if(Q==="p"){const G=$.slice(1).trim().split(" ");L.addPointGeometry(G)}else if((U=p.exec($))!==null){const G=(" "+U[0].slice(1).trim()).slice(1);L.startObject(G)}else if(m.test($))L.object.startMaterial($.substring(7).trim(),L.materialLibraries);else if(f.test($))L.materialLibraries.push($.substring(7).trim());else if(g.test($))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(Q==="s"){if(U=$.split(" "),U.length>1){const j=U[1].trim().toLowerCase();L.object.smooth=j!=="0"&&j!=="off"}else L.object.smooth=!0;const G=L.object.currentMaterial();G&&(G.smooth=L.object.smooth)}else{if($==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+$+'"')}}L.finalize();const J=new d.Group;if(J.materialLibraries=[].concat(L.materialLibraries),!(L.objects.length===1&&L.objects[0].geometry.vertices.length===0))for(let H=0,V=L.objects.length;H<V;H++){const $=L.objects[H],Q=$.geometry,G=$.materials,j=Q.type==="Line",ie=Q.type==="Points";let Y=!1;if(Q.vertices.length===0)continue;const ae=new d.BufferGeometry;ae.setAttribute("position",new d.Float32BufferAttribute(Q.vertices,3)),Q.normals.length>0&&ae.setAttribute("normal",new d.Float32BufferAttribute(Q.normals,3)),Q.colors.length>0&&(Y=!0,ae.setAttribute("color",new d.Float32BufferAttribute(Q.colors,3))),Q.hasUVIndices===!0&&ae.setAttribute("uv",new d.Float32BufferAttribute(Q.uvs,2));const xe=[];for(let de=0,Ie=G.length;de<Ie;de++){const Ge=G[de],Xe=Ge.name+"_"+Ge.smooth+"_"+Y;let $e=L.materials[Xe];if(this.materials!==null){if($e=this.materials.create(Ge.name),j&&$e&&!($e instanceof d.LineBasicMaterial)){const lt=new d.LineBasicMaterial;d.Material.prototype.copy.call(lt,$e),lt.color.copy($e.color),$e=lt}else if(ie&&$e&&!($e instanceof d.PointsMaterial)){const lt=new d.PointsMaterial({size:10,sizeAttenuation:!1});d.Material.prototype.copy.call(lt,$e),lt.color.copy($e.color),lt.map=$e.map,$e=lt}}$e===void 0&&(j?$e=new d.LineBasicMaterial:ie?$e=new d.PointsMaterial({size:1,sizeAttenuation:!1}):$e=new d.MeshPhongMaterial,$e.name=Ge.name,$e.flatShading=!Ge.smooth,$e.vertexColors=Y,L.materials[Xe]=$e),xe.push($e)}let fe;if(xe.length>1){for(let de=0,Ie=G.length;de<Ie;de++){const Ge=G[de];ae.addGroup(Ge.groupStart,Ge.groupCount,de)}j?fe=new d.LineSegments(ae,xe):ie?fe=new d.Points(ae,xe):fe=new d.Mesh(ae,xe)}else j?fe=new d.LineSegments(ae,xe[0]):ie?fe=new d.Points(ae,xe[0]):fe=new d.Mesh(ae,xe[0]);fe.name=$.name,J.add(fe)}else if(L.vertices.length>0){const H=new d.PointsMaterial({size:1,sizeAttenuation:!1}),V=new d.BufferGeometry;V.setAttribute("position",new d.Float32BufferAttribute(L.vertices,3)),L.colors.length>0&&L.colors[0]!==void 0&&(V.setAttribute("color",new d.Float32BufferAttribute(L.colors,3)),H.vertexColors=!0);const $=new d.Points(V,H);J.add($)}return J}}},"./node_modules/three/examples/jsm/math/OBB.js":(l,u,c)=>{c.r(u),c.d(u,{OBB:()=>O});var d=c("./node_modules/three/build/three.module.js");const p={c:null,u:[new d.Vector3,new d.Vector3,new d.Vector3],e:[]},f={c:null,u:[new d.Vector3,new d.Vector3,new d.Vector3],e:[]},m=[[],[],[]],g=[[],[],[]],y=[],x=new d.Vector3,v=new d.Vector3,_=new d.Vector3,T=new d.Vector3,w=new d.Vector3,S=new d.Vector3,R=new d.Matrix3,B=new d.Box3,I=new d.Matrix4,D=new d.Matrix4,L=new d.Ray;class O{constructor(H=new d.Vector3,V=new d.Vector3,$=new d.Matrix3){this.center=H,this.halfSize=V,this.rotation=$}set(H,V,$){return this.center=H,this.halfSize=V,this.rotation=$,this}copy(H){return this.center.copy(H.center),this.halfSize.copy(H.halfSize),this.rotation.copy(H.rotation),this}clone(){return new this.constructor().copy(this)}getSize(H){return H.copy(this.halfSize).multiplyScalar(2)}clampPoint(H,V){const $=this.halfSize;T.subVectors(H,this.center),this.rotation.extractBasis(x,v,_),V.copy(this.center);const Q=d.MathUtils.clamp(T.dot(x),-$.x,$.x);V.add(x.multiplyScalar(Q));const G=d.MathUtils.clamp(T.dot(v),-$.y,$.y);V.add(v.multiplyScalar(G));const j=d.MathUtils.clamp(T.dot(_),-$.z,$.z);return V.add(_.multiplyScalar(j)),V}containsPoint(H){return T.subVectors(H,this.center),this.rotation.extractBasis(x,v,_),Math.abs(T.dot(x))<=this.halfSize.x&&Math.abs(T.dot(v))<=this.halfSize.y&&Math.abs(T.dot(_))<=this.halfSize.z}intersectsBox3(H){return this.intersectsOBB(U.fromBox3(H))}intersectsSphere(H){return this.clampPoint(H.center,S),S.distanceToSquared(H.center)<=H.radius*H.radius}intersectsOBB(H,V=Number.EPSILON){p.c=this.center,p.e[0]=this.halfSize.x,p.e[1]=this.halfSize.y,p.e[2]=this.halfSize.z,this.rotation.extractBasis(p.u[0],p.u[1],p.u[2]),f.c=H.center,f.e[0]=H.halfSize.x,f.e[1]=H.halfSize.y,f.e[2]=H.halfSize.z,H.rotation.extractBasis(f.u[0],f.u[1],f.u[2]);for(let G=0;G<3;G++)for(let j=0;j<3;j++)m[G][j]=p.u[G].dot(f.u[j]);T.subVectors(f.c,p.c),y[0]=T.dot(p.u[0]),y[1]=T.dot(p.u[1]),y[2]=T.dot(p.u[2]);for(let G=0;G<3;G++)for(let j=0;j<3;j++)g[G][j]=Math.abs(m[G][j])+V;let $,Q;for(let G=0;G<3;G++)if($=p.e[G],Q=f.e[0]*g[G][0]+f.e[1]*g[G][1]+f.e[2]*g[G][2],Math.abs(y[G])>$+Q)return!1;for(let G=0;G<3;G++)if($=p.e[0]*g[0][G]+p.e[1]*g[1][G]+p.e[2]*g[2][G],Q=f.e[G],Math.abs(y[0]*m[0][G]+y[1]*m[1][G]+y[2]*m[2][G])>$+Q)return!1;return $=p.e[1]*g[2][0]+p.e[2]*g[1][0],Q=f.e[1]*g[0][2]+f.e[2]*g[0][1],!(Math.abs(y[2]*m[1][0]-y[1]*m[2][0])>$+Q||($=p.e[1]*g[2][1]+p.e[2]*g[1][1],Q=f.e[0]*g[0][2]+f.e[2]*g[0][0],Math.abs(y[2]*m[1][1]-y[1]*m[2][1])>$+Q)||($=p.e[1]*g[2][2]+p.e[2]*g[1][2],Q=f.e[0]*g[0][1]+f.e[1]*g[0][0],Math.abs(y[2]*m[1][2]-y[1]*m[2][2])>$+Q)||($=p.e[0]*g[2][0]+p.e[2]*g[0][0],Q=f.e[1]*g[1][2]+f.e[2]*g[1][1],Math.abs(y[0]*m[2][0]-y[2]*m[0][0])>$+Q)||($=p.e[0]*g[2][1]+p.e[2]*g[0][1],Q=f.e[0]*g[1][2]+f.e[2]*g[1][0],Math.abs(y[0]*m[2][1]-y[2]*m[0][1])>$+Q)||($=p.e[0]*g[2][2]+p.e[2]*g[0][2],Q=f.e[0]*g[1][1]+f.e[1]*g[1][0],Math.abs(y[0]*m[2][2]-y[2]*m[0][2])>$+Q)||($=p.e[0]*g[1][0]+p.e[1]*g[0][0],Q=f.e[1]*g[2][2]+f.e[2]*g[2][1],Math.abs(y[1]*m[0][0]-y[0]*m[1][0])>$+Q)||($=p.e[0]*g[1][1]+p.e[1]*g[0][1],Q=f.e[0]*g[2][2]+f.e[2]*g[2][0],Math.abs(y[1]*m[0][1]-y[0]*m[1][1])>$+Q)||($=p.e[0]*g[1][2]+p.e[1]*g[0][2],Q=f.e[0]*g[2][1]+f.e[1]*g[2][0],Math.abs(y[1]*m[0][2]-y[0]*m[1][2])>$+Q))}intersectsPlane(H){this.rotation.extractBasis(x,v,_);const V=this.halfSize.x*Math.abs(H.normal.dot(x))+this.halfSize.y*Math.abs(H.normal.dot(v))+this.halfSize.z*Math.abs(H.normal.dot(_)),$=H.normal.dot(this.center)-H.constant;return Math.abs($)<=V}intersectRay(H,V){return this.getSize(w),B.setFromCenterAndSize(T.set(0,0,0),w),I.setFromMatrix3(this.rotation),I.setPosition(this.center),D.copy(I).invert(),L.copy(H).applyMatrix4(D),L.intersectBox(B,V)?V.applyMatrix4(I):null}intersectsRay(H){return this.intersectRay(H,T)!==null}fromBox3(H){return H.getCenter(this.center),H.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(H){return H.center.equals(this.center)&&H.halfSize.equals(this.halfSize)&&H.rotation.equals(this.rotation)}applyMatrix4(H){const V=H.elements;let $=T.set(V[0],V[1],V[2]).length();const Q=T.set(V[4],V[5],V[6]).length(),G=T.set(V[8],V[9],V[10]).length();H.determinant()<0&&($=-$),R.setFromMatrix4(H);const j=1/$,ie=1/Q,Y=1/G;return R.elements[0]*=j,R.elements[1]*=j,R.elements[2]*=j,R.elements[3]*=ie,R.elements[4]*=ie,R.elements[5]*=ie,R.elements[6]*=Y,R.elements[7]*=Y,R.elements[8]*=Y,this.rotation.multiply(R),this.halfSize.x*=$,this.halfSize.y*=Q,this.halfSize.z*=G,T.setFromMatrixPosition(H),this.center.add(T),this}}const U=new O},"./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js":(l,u,c)=>{c.r(u),c.d(u,{computeMikkTSpaceTangents:()=>p,computeMorphedAttributes:()=>S,deepCloneAttribute:()=>g,deinterleaveAttribute:()=>x,deinterleaveGeometry:()=>v,estimateBytesUsed:()=>_,interleaveAttributes:()=>y,mergeAttributes:()=>m,mergeGeometries:()=>f,mergeGroups:()=>R,mergeVertices:()=>T,toCreasedNormals:()=>B,toTrianglesDrawMode:()=>w});var d=c("./node_modules/three/build/three.module.js");function p(I,D,L=!0){if(!D||!D.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!I.hasAttribute("position")||!I.hasAttribute("normal")||!I.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function O(H){if(H.normalized||H.isInterleavedBufferAttribute){const V=new Float32Array(H.count*H.itemSize);for(let $=0,Q=0;$<H.count;$++)V[Q++]=H.getX($),V[Q++]=H.getY($),H.itemSize>2&&(V[Q++]=H.getZ($));return V}return H.array instanceof Float32Array?H.array:new Float32Array(H.array)}const U=I.index?I.toNonIndexed():I,J=D.generateTangents(O(U.attributes.position),O(U.attributes.normal),O(U.attributes.uv));if(L)for(let H=3;H<J.length;H+=4)J[H]*=-1;return U.setAttribute("tangent",new d.BufferAttribute(J,4)),I!==U&&I.copy(U),I}function f(I,D=!1){const L=I[0].index!==null,O=new Set(Object.keys(I[0].attributes)),U=new Set(Object.keys(I[0].morphAttributes)),J={},H={},V=I[0].morphTargetsRelative,$=new d.BufferGeometry;let Q=0;for(let G=0;G<I.length;++G){const j=I[G];let ie=0;if(L!==(j.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const Y in j.attributes){if(!O.has(Y))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+'. All geometries must have compatible attributes; make sure "'+Y+'" attribute exists among all geometries, or in none of them.'),null;J[Y]===void 0&&(J[Y]=[]),J[Y].push(j.attributes[Y]),ie++}if(ie!==O.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+". Make sure all geometries have the same number of attributes."),null;if(V!==j.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const Y in j.morphAttributes){if(!U.has(Y))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+".  .morphAttributes must be consistent throughout all geometries."),null;H[Y]===void 0&&(H[Y]=[]),H[Y].push(j.morphAttributes[Y])}if(D){let Y;if(L)Y=j.index.count;else if(j.attributes.position!==void 0)Y=j.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+". The geometry must have either an index or a position attribute"),null;$.addGroup(Q,Y,G),Q+=Y}}if(L){let G=0;const j=[];for(let ie=0;ie<I.length;++ie){const Y=I[ie].index;for(let ae=0;ae<Y.count;++ae)j.push(Y.getX(ae)+G);G+=I[ie].attributes.position.count}$.setIndex(j)}for(const G in J){const j=m(J[G]);if(!j)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+G+" attribute."),null;$.setAttribute(G,j)}for(const G in H){const j=H[G][0].length;if(j===0)break;$.morphAttributes=$.morphAttributes||{},$.morphAttributes[G]=[];for(let ie=0;ie<j;++ie){const Y=[];for(let xe=0;xe<H[G].length;++xe)Y.push(H[G][xe][ie]);const ae=m(Y);if(!ae)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+G+" morphAttribute."),null;$.morphAttributes[G].push(ae)}}return $}function m(I){let D,L,O,U=-1,J=0;for(let Q=0;Q<I.length;++Q){const G=I[Q];if(D===void 0&&(D=G.array.constructor),D!==G.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(L===void 0&&(L=G.itemSize),L!==G.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(O===void 0&&(O=G.normalized),O!==G.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(U===-1&&(U=G.gpuType),U!==G.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;J+=G.count*L}const H=new D(J),V=new d.BufferAttribute(H,L,O);let $=0;for(let Q=0;Q<I.length;++Q){const G=I[Q];if(G.isInterleavedBufferAttribute){const j=$/L;for(let ie=0,Y=G.count;ie<Y;ie++)for(let ae=0;ae<L;ae++){const xe=G.getComponent(ie,ae);V.setComponent(ie+j,ae,xe)}}else H.set(G.array,$);$+=G.count*L}return U!==void 0&&(V.gpuType=U),V}function g(I){return I.isInstancedInterleavedBufferAttribute||I.isInterleavedBufferAttribute?x(I):I.isInstancedBufferAttribute?new d.InstancedBufferAttribute().copy(I):new d.BufferAttribute().copy(I)}function y(I){let D,L=0,O=0;for(let Q=0,G=I.length;Q<G;++Q){const j=I[Q];if(D===void 0&&(D=j.array.constructor),D!==j.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;L+=j.array.length,O+=j.itemSize}const U=new d.InterleavedBuffer(new D(L),O);let J=0;const H=[],V=["getX","getY","getZ","getW"],$=["setX","setY","setZ","setW"];for(let Q=0,G=I.length;Q<G;Q++){const j=I[Q],ie=j.itemSize,Y=j.count,ae=new d.InterleavedBufferAttribute(U,ie,J,j.normalized);H.push(ae),J+=ie;for(let xe=0;xe<Y;xe++)for(let fe=0;fe<ie;fe++)ae[$[fe]](xe,j[V[fe]](xe))}return H}function x(I){const D=I.data.array.constructor,L=I.count,O=I.itemSize,U=I.normalized,J=new D(L*O);let H;I.isInstancedInterleavedBufferAttribute?H=new d.InstancedBufferAttribute(J,O,U,I.meshPerAttribute):H=new d.BufferAttribute(J,O,U);for(let V=0;V<L;V++)H.setX(V,I.getX(V)),O>=2&&H.setY(V,I.getY(V)),O>=3&&H.setZ(V,I.getZ(V)),O>=4&&H.setW(V,I.getW(V));return H}function v(I){const D=I.attributes,L=I.morphTargets,O=new Map;for(const U in D){const J=D[U];J.isInterleavedBufferAttribute&&(O.has(J)||O.set(J,x(J)),D[U]=O.get(J))}for(const U in L){const J=L[U];J.isInterleavedBufferAttribute&&(O.has(J)||O.set(J,x(J)),L[U]=O.get(J))}}function _(I){let D=0;for(const O in I.attributes){const U=I.getAttribute(O);D+=U.count*U.itemSize*U.array.BYTES_PER_ELEMENT}const L=I.getIndex();return D+=L?L.count*L.itemSize*L.array.BYTES_PER_ELEMENT:0,D}function T(I,D=1e-4){D=Math.max(D,Number.EPSILON);const L={},O=I.getIndex(),U=I.getAttribute("position"),J=O?O.count:U.count;let H=0;const V=Object.keys(I.attributes),$={},Q={},G=[],j=["getX","getY","getZ","getW"],ie=["setX","setY","setZ","setW"];for(let Ie=0,Ge=V.length;Ie<Ge;Ie++){const Xe=V[Ie],$e=I.attributes[Xe];$[Xe]=new d.BufferAttribute(new $e.array.constructor($e.count*$e.itemSize),$e.itemSize,$e.normalized);const lt=I.morphAttributes[Xe];lt&&(Q[Xe]=new d.BufferAttribute(new lt.array.constructor(lt.count*lt.itemSize),lt.itemSize,lt.normalized))}const Y=D*.5,ae=Math.log10(1/D),xe=Math.pow(10,ae),fe=Y*xe;for(let Ie=0;Ie<J;Ie++){const Ge=O?O.getX(Ie):Ie;let Xe="";for(let $e=0,lt=V.length;$e<lt;$e++){const At=V[$e],Gt=I.getAttribute(At),gt=Gt.itemSize;for(let yi=0;yi<gt;yi++)Xe+=`${~~(Gt[j[yi]](Ge)*xe+fe)},`}if(Xe in L)G.push(L[Xe]);else{for(let $e=0,lt=V.length;$e<lt;$e++){const At=V[$e],Gt=I.getAttribute(At),gt=I.morphAttributes[At],yi=Gt.itemSize,Ze=$[At],ki=Q[At];for(let hi=0;hi<yi;hi++){const Ri=j[hi],Si=ie[hi];if(Ze[Si](H,Gt[Ri](Ge)),gt)for(let tr=0,Vi=gt.length;tr<Vi;tr++)ki[tr][Si](H,gt[tr][Ri](Ge))}}L[Xe]=H,G.push(H),H++}}const de=I.clone();for(const Ie in I.attributes){const Ge=$[Ie];if(de.setAttribute(Ie,new d.BufferAttribute(Ge.array.slice(0,H*Ge.itemSize),Ge.itemSize,Ge.normalized)),Ie in Q)for(let Xe=0;Xe<Q[Ie].length;Xe++){const $e=Q[Ie][Xe];de.morphAttributes[Ie][Xe]=new d.BufferAttribute($e.array.slice(0,H*$e.itemSize),$e.itemSize,$e.normalized)}}return de.setIndex(G),de}function w(I,D){if(D===d.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),I;if(D===d.TriangleFanDrawMode||D===d.TriangleStripDrawMode){let L=I.getIndex();if(L===null){const H=[],V=I.getAttribute("position");if(V!==void 0){for(let $=0;$<V.count;$++)H.push($);I.setIndex(H),L=I.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),I}const O=L.count-2,U=[];if(D===d.TriangleFanDrawMode)for(let H=1;H<=O;H++)U.push(L.getX(0)),U.push(L.getX(H)),U.push(L.getX(H+1));else for(let H=0;H<O;H++)H%2===0?(U.push(L.getX(H)),U.push(L.getX(H+1)),U.push(L.getX(H+2))):(U.push(L.getX(H+2)),U.push(L.getX(H+1)),U.push(L.getX(H)));U.length/3!==O&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const J=I.clone();return J.setIndex(U),J.clearGroups(),J}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",D),I}function S(I){const D=new d.Vector3,L=new d.Vector3,O=new d.Vector3,U=new d.Vector3,J=new d.Vector3,H=new d.Vector3,V=new d.Vector3,$=new d.Vector3,Q=new d.Vector3;function G(Ce,yt,Ot,Jt,zt,xi,vt,ye){D.fromBufferAttribute(yt,zt),L.fromBufferAttribute(yt,xi),O.fromBufferAttribute(yt,vt);const ve=Ce.morphTargetInfluences;if(Ot&&ve){V.set(0,0,0),$.set(0,0,0),Q.set(0,0,0);for(let Le=0,Te=Ot.length;Le<Te;Le++){const Fe=ve[Le],Pe=Ot[Le];Fe!==0&&(U.fromBufferAttribute(Pe,zt),J.fromBufferAttribute(Pe,xi),H.fromBufferAttribute(Pe,vt),Jt?(V.addScaledVector(U,Fe),$.addScaledVector(J,Fe),Q.addScaledVector(H,Fe)):(V.addScaledVector(U.sub(D),Fe),$.addScaledVector(J.sub(L),Fe),Q.addScaledVector(H.sub(O),Fe)))}D.add(V),L.add($),O.add(Q)}Ce.isSkinnedMesh&&(Ce.applyBoneTransform(zt,D),Ce.applyBoneTransform(xi,L),Ce.applyBoneTransform(vt,O)),ye[zt*3+0]=D.x,ye[zt*3+1]=D.y,ye[zt*3+2]=D.z,ye[xi*3+0]=L.x,ye[xi*3+1]=L.y,ye[xi*3+2]=L.z,ye[vt*3+0]=O.x,ye[vt*3+1]=O.y,ye[vt*3+2]=O.z}const j=I.geometry,ie=I.material;let Y,ae,xe;const fe=j.index,de=j.attributes.position,Ie=j.morphAttributes.position,Ge=j.morphTargetsRelative,Xe=j.attributes.normal,$e=j.morphAttributes.position,lt=j.groups,At=j.drawRange;let Gt,gt,yi,Ze,ki,hi,Ri;const Si=new Float32Array(de.count*de.itemSize),tr=new Float32Array(Xe.count*Xe.itemSize);if(fe!==null)if(Array.isArray(ie))for(Gt=0,yi=lt.length;Gt<yi;Gt++)for(ki=lt[Gt],hi=Math.max(ki.start,At.start),Ri=Math.min(ki.start+ki.count,At.start+At.count),gt=hi,Ze=Ri;gt<Ze;gt+=3)Y=fe.getX(gt),ae=fe.getX(gt+1),xe=fe.getX(gt+2),G(I,de,Ie,Ge,Y,ae,xe,Si),G(I,Xe,$e,Ge,Y,ae,xe,tr);else for(hi=Math.max(0,At.start),Ri=Math.min(fe.count,At.start+At.count),Gt=hi,yi=Ri;Gt<yi;Gt+=3)Y=fe.getX(Gt),ae=fe.getX(Gt+1),xe=fe.getX(Gt+2),G(I,de,Ie,Ge,Y,ae,xe,Si),G(I,Xe,$e,Ge,Y,ae,xe,tr);else if(Array.isArray(ie))for(Gt=0,yi=lt.length;Gt<yi;Gt++)for(ki=lt[Gt],hi=Math.max(ki.start,At.start),Ri=Math.min(ki.start+ki.count,At.start+At.count),gt=hi,Ze=Ri;gt<Ze;gt+=3)Y=gt,ae=gt+1,xe=gt+2,G(I,de,Ie,Ge,Y,ae,xe,Si),G(I,Xe,$e,Ge,Y,ae,xe,tr);else for(hi=Math.max(0,At.start),Ri=Math.min(de.count,At.start+At.count),Gt=hi,yi=Ri;Gt<yi;Gt+=3)Y=Gt,ae=Gt+1,xe=Gt+2,G(I,de,Ie,Ge,Y,ae,xe,Si),G(I,Xe,$e,Ge,Y,ae,xe,tr);const Vi=new d.Float32BufferAttribute(Si,3),Qe=new d.Float32BufferAttribute(tr,3);return{positionAttribute:de,normalAttribute:Xe,morphedPositionAttribute:Vi,morphedNormalAttribute:Qe}}function R(I){if(I.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),I;let D=I.groups;if(D=D.sort((H,V)=>H.materialIndex!==V.materialIndex?H.materialIndex-V.materialIndex:H.start-V.start),I.getIndex()===null){const H=I.getAttribute("position"),V=[];for(let $=0;$<H.count;$+=3)V.push($,$+1,$+2);I.setIndex(V)}const L=I.getIndex(),O=[];for(let H=0;H<D.length;H++){const V=D[H],$=V.start,Q=$+V.count;for(let G=$;G<Q;G++)O.push(L.getX(G))}I.dispose(),I.setIndex(O);let U=0;for(let H=0;H<D.length;H++){const V=D[H];V.start=U,U+=V.count}let J=D[0];I.groups=[J];for(let H=1;H<D.length;H++){const V=D[H];J.materialIndex===V.materialIndex?J.count+=V.count:(J=V,I.groups.push(J))}return I}function B(I,D=Math.PI/3){const L=Math.cos(D),O=(1+1e-10)*100,U=[new d.Vector3,new d.Vector3,new d.Vector3],J=new d.Vector3,H=new d.Vector3,V=new d.Vector3,$=new d.Vector3;function Q(xe){const fe=~~(xe.x*O),de=~~(xe.y*O),Ie=~~(xe.z*O);return`${fe},${de},${Ie}`}const G=I.index?I.toNonIndexed():I,j=G.attributes.position,ie={};for(let xe=0,fe=j.count/3;xe<fe;xe++){const de=3*xe,Ie=U[0].fromBufferAttribute(j,de+0),Ge=U[1].fromBufferAttribute(j,de+1),Xe=U[2].fromBufferAttribute(j,de+2);J.subVectors(Xe,Ge),H.subVectors(Ie,Ge);const $e=new d.Vector3().crossVectors(J,H).normalize();for(let lt=0;lt<3;lt++){const At=U[lt],Gt=Q(At);Gt in ie||(ie[Gt]=[]),ie[Gt].push($e)}}const Y=new Float32Array(j.count*3),ae=new d.BufferAttribute(Y,3,!1);for(let xe=0,fe=j.count/3;xe<fe;xe++){const de=3*xe,Ie=U[0].fromBufferAttribute(j,de+0),Ge=U[1].fromBufferAttribute(j,de+1),Xe=U[2].fromBufferAttribute(j,de+2);J.subVectors(Xe,Ge),H.subVectors(Ie,Ge),V.crossVectors(J,H).normalize();for(let $e=0;$e<3;$e++){const lt=U[$e],At=Q(lt),Gt=ie[At];$.set(0,0,0);for(let gt=0,yi=Gt.length;gt<yi;gt++){const Ze=Gt[gt];V.dot(Ze)>L&&$.add(Ze)}$.normalize(),ae.setXYZ(de+$e,$.x,$.y,$.z)}}return G.setAttribute("normal",ae),G}},"./node_modules/three/examples/jsm/utils/WorkerPool.js":(l,u,c)=>{c.r(u),c.d(u,{WorkerPool:()=>d});class d{constructor(f=4){this.pool=f,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(f){if(!this.workers[f]){const m=this.workerCreator();m.addEventListener("message",this._onMessage.bind(this,f)),this.workers[f]=m}}_getIdleWorker(){for(let f=0;f<this.pool;f++)if(!(this.workerStatus&1<<f))return f;return-1}_onMessage(f,m){const g=this.workersResolve[f];if(g&&g(m),this.queue.length){const{resolve:y,msg:x,transfer:v}=this.queue.shift();this.workersResolve[f]=y,this.workers[f].postMessage(x,v)}else this.workerStatus^=1<<f}setWorkerCreator(f){this.workerCreator=f}setWorkerLimit(f){this.pool=f}postMessage(f,m){return new Promise(g=>{const y=this._getIdleWorker();y!==-1?(this._initWorker(y),this.workerStatus|=1<<y,this.workersResolve[y]=g,this.workers[y].postMessage(f,m)):this.queue.push({resolve:g,msg:f,transfer:m})})}dispose(){this.workers.forEach(f=>f.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}},"./src/lib/three.mjs":(l,u,c)=>{c.r(u),c.d(u,{default:()=>w});var d=c("./node_modules/three/build/three.module.js"),p=c("./node_modules/three/examples/jsm/loaders/DRACOLoader.js"),f=c("./node_modules/three/examples/jsm/loaders/GLTFLoader.js"),m=c("./node_modules/three/examples/jsm/loaders/KTX2Loader.js"),g=c("./node_modules/three/examples/jsm/math/OBB.js"),y=c("./node_modules/three/examples/jsm/loaders/OBJLoader.js"),x=c("./node_modules/three/examples/jsm/loaders/MTLLoader.js"),v=c("./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js"),_=c("./node_modules/three/examples/jsm/lights/LightProbeGenerator.js"),T={...d};T.DRACOLoader=p.DRACOLoader,T.GLTFLoader=f.GLTFLoader,T.KTX2Loader=m.KTX2Loader,T.OBJLoader=y.OBJLoader,T.MTLLoader=x.MTLLoader,T.OBB=g.OBB,T.BufferGeometryUtils=v,T.LightProbeGenerator=_.LightProbeGenerator;const w=T},"./package.json":l=>{l.exports=JSON.parse('{"name":"aframe","version":"1.6.0","description":"A web framework for building virtual reality experiences.","homepage":"https://aframe.io/","main":"dist/aframe-master.js","scripts":{"dev":"cross-env INSPECTOR_VERSION=dev webpack serve --port 8080","dist":"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"webpack --config webpack.config.js","dist:min":"webpack --config webpack.prod.config.js","docs":"markserv --dir docs --port 9001","preghpages":"node ./scripts/preghpages.js","ghpages":"ghpages -p gh-pages/","lint":"standardx -v | snazzy","lint:fix":"standardx --fix","precommit":"npm run lint","prepush":"node scripts/testOnlyCheck.js","prerelease":"node scripts/release.js 1.5.0 1.6.0","start":"npm run dev","start:https":"npm run dev -- --server-type https","test":"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:nobrowser":"NO_BROWSER=true npm test","test:node":"node --experimental-require-module ./node_modules/mocha/bin/mocha --ui tdd tests/node"},"repository":"aframevr/aframe","license":"MIT","files":["dist/*","docs/**/*","src/**/*","vendor/**/*"],"dependencies":{"buffer":"^6.0.3","debug":"^4.3.4","deep-assign":"^2.0.0","load-bmfont":"^1.2.3","super-animejs":"^3.1.0","three":"npm:super-three@0.164.0","three-bmfont-text":"dmarcos/three-bmfont-text#eed4878795be9b3e38cf6aec6b903f56acd1f695","webvr-polyfill":"^0.10.12"},"devDependencies":{"@babel/core":"^7.17.10","babel-loader":"^8.2.5","babel-plugin-istanbul":"^6.1.1","chai":"^4.3.6","chai-shallow-deep-equal":"^1.4.0","chalk":"^1.1.3","cross-env":"^7.0.3","css-loader":"^6.7.1","eslint":"^8.45.0","eslint-config-semistandard":"^17.0.0","eslint-config-standard-jsx":"^11.0.0","ghpages":"0.0.8","git-rev":"^0.2.1","glob":"^8.0.3","husky":"^0.11.7","jsdom":"^24.0.0","jsdom-global":"^3.0.2","karma":"^6.4.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^3.1.1","karma-coverage":"^2.2.0","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-sinon-chai":"^2.0.2","karma-webpack":"^5.0.0","markserv":"github:sukima/markserv#feature/fix-broken-websoketio-link","mocha":"^10.0.0","replace-in-file":"^2.5.3","shelljs":"^0.7.7","shx":"^0.2.2","sinon":"<12.0.0","sinon-chai":"^3.7.0","snazzy":"^5.0.0","standardx":"^7.0.0","style-loader":"^3.3.1","too-wordy":"ngokevin/too-wordy","webpack":"^5.73.0","webpack-cli":"^4.10.0","webpack-dev-server":"^4.11.0","webpack-merge":"^5.8.0","write-good":"^1.0.8"},"link":true,"standardx":{"ignore":["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},"keywords":["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","quest","meta","web-components","webvr","webxr"],"engines":{"node":">= 4.6.0","npm":">= 2.15.9"}}')}},n={};function s(l){var u=n[l];if(u!==void 0)return u.exports;var c=n[l]={id:l,exports:{}};return i[l].call(c.exports,c,c.exports,s),c.exports}s.m=i,s.n=l=>{var u=l&&l.__esModule?()=>l.default:()=>l;return s.d(u,{a:u}),u},s.d=(l,u)=>{for(var c in u)s.o(u,c)&&!s.o(l,c)&&Object.defineProperty(l,c,{enumerable:!0,get:u[c]})},s.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(l,u)=>Object.prototype.hasOwnProperty.call(l,u),s.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},s.b=document.baseURI||self.location.href,s.nc=void 0;var o=s("./src/index.js");return o})())})(qW);const eD=.1;AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(r){const e=this.el;if(this.active&&this.checkpoint!==r){if(this.checkpoint&&e.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=r,this.sync(),this.position.distanceTo(this.targetPosition)<eD){this.checkpoint=null;return}e.emit("navigation-start",{checkpoint:r}),this.data.mode==="teleport"&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,e.emit("navigation-end",{checkpoint:r}),e.components["movement-controls"].updateNavLocation())}},isVelocityActive:function(){return!!(this.active&&this.checkpoint)},getVelocity:function(){if(!this.active)return;const r=this.data,e=this.offset,i=this.position,n=this.targetPosition,s=this.checkpoint;return this.sync(),i.distanceTo(n)<eD?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:s}),e.set(0,0,0)):(e.setLength(r.animateSpeed),e)},sync:function(){const r=this.offset,e=this.position,i=this.targetPosition;e.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(i),i.add(this.checkpoint.components.checkpoint.getOffset()),r.copy(i).sub(e)}});var XW=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16});function YW(r,e,i){this.type=r,this.index=e,this.pressed=i.pressed,this.value=i.value}var KW=YW;const Rf=XW,a2=KW,Eh=.2,iu={LEFT:"left",RIGHT:"right"},ru={MOVEMENT:1,ROTATION:2};AFRAME.registerComponent("gamepad-controls",{GamepadButton:Rf,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){const r=this.el.sceneEl;this.system=r.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};const e=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=e.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=e.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,r.addBehavior(this)},update:function(){this.tick()},tick:function(r,e){this.updateButtonState(),this.updateRotation(e)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const r=this._dpadVector,e=this._moveVector;this.getDpad(r),this.getJoystick(ru.MOVEMENT,e);const i=r.x||e.x,n=r.y||e.y;return Math.abs(i)>Eh||Math.abs(n)>Eh},getVelocityDelta:function(){const r=this._dpadVector,e=this._moveVector;this.getDpad(r),this.getJoystick(ru.MOVEMENT,e);const i=r.x||e.x,n=r.y||e.y,s=new THREE.Vector3;return Math.abs(i)>Eh&&(s.x+=i),Math.abs(n)>Eh&&(s.z+=n),s},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const r=this._lookVector;return this.getJoystick(ru.ROTATION,r),Math.abs(r.x)>Eh||Math.abs(r.y)>Eh},updateRotation:function(r){if(!this.isRotationActive())return;const e=this.data,i=this.yaw,n=this.pitch;i.rotation.y=this.el.object3D.rotation.y,n.rotation.x=this.el.object3D.rotation.x;const s=this._lookVector;this.getJoystick(ru.ROTATION,s),Math.abs(s.x)<=Eh&&(s.x=0),Math.abs(s.y)<=Eh&&(s.y=0),s.multiplyScalar(e.rotationSensitivity*r/1e3),i.rotation.y-=s.x,n.rotation.x-=s.y,n.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,n.rotation.x)),this.el.object3D.rotation.set(n.rotation.x,i.rotation.y,0)},updateButtonState:function(){const r=this.getGamepad(iu.RIGHT);if(this.data.enabled&&r)for(var e=0;e<r.buttons.length;e++)r.buttons[e].pressed&&!this.buttons[e]?this.emit(new a2("gamepadbuttondown",e,r.buttons[e])):!r.buttons[e].pressed&&this.buttons[e]&&this.emit(new a2("gamepadbuttonup",e,r.buttons[e])),this.buttons[e]=r.buttons[e].pressed;else for(const i in this.buttons)this.buttons[i]=!1},emit:function(r){this.el.emit(r.type,r),this.el.emit(r.type+":"+r.index,new a2(r.type,r.index,r))},getGamepad:function(){const r=[],e=[];return function(i){const n=this.el.sceneEl.components["proxy-controls"],s=n&&n.isConnected()&&n.getGamepad(0);if(s)return s;r.length=0;for(let l=0;l<this.system.controllers.length;l++){const u=this.system.controllers[l],c=u?u.gamepad:null;if(r.push(c),c&&u.handedness===i)return c}const o=navigator.getGamepads?navigator.getGamepads():e;for(let l=0;l<o.length;l++){const u=o[l];if(u&&u.hand===i)return u}return r[0]||o[0]}}(),getButton:function(r){return this.getGamepad(iu.RIGHT).buttons[r]},getAxis:function(r){return this.getGamepad(r>1?iu.RIGHT:iu.LEFT).axes[r]},getJoystick:function(r,e){const i=this.getGamepad(r===ru.MOVEMENT?iu.LEFT:iu.RIGHT);if(!i)return e.set(0,0);if(i.mapping==="xr-standard")switch(r){case ru.MOVEMENT:return e.set(i.axes[2],i.axes[3]);case ru.ROTATION:return e.set(i.axes[2],0)}else switch(r){case ru.MOVEMENT:return e.set(i.axes[0],i.axes[1]);case ru.ROTATION:return e.set(i.axes[2],i.axes[3])}throw new Error('Unexpected joystick index "%d".',r)},getDpad:function(r){const e=this.getGamepad(iu.LEFT);return!e||!e.buttons[Rf.DPAD_RIGHT]?r.set(0,0):r.set((e.buttons[Rf.DPAD_RIGHT].pressed?1:0)+(e.buttons[Rf.DPAD_LEFT].pressed?-1:0),(e.buttons[Rf.DPAD_UP].pressed?-1:0)+(e.buttons[Rf.DPAD_DOWN].pressed?1:0))},isConnected:function(){const r=this.getGamepad(iu.LEFT);return!!(r&&r.connected)},getID:function(){return this.getGamepad(iu.LEFT).id}}),function(r){var e="KeyboardEvent"in r;e||(r.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var i=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,n=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,s=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,o=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function l(R,B){return String(R).indexOf(B)!==-1}var u=function(){return l(navigator.platform,"Win")?"win":l(navigator.platform,"Mac")?"mac":l(navigator.platform,"CrOS")?"cros":l(navigator.platform,"Linux")?"linux":l(navigator.userAgent,"iPad")||l(navigator.platform,"iPod")||l(navigator.platform,"iPhone")?"ios":""}(),c=function(){return l(navigator.userAgent,"Chrome/")?"chrome":l(navigator.vendor,"Apple")?"safari":l(navigator.userAgent,"MSIE")?"ie":l(navigator.userAgent,"Gecko/")?"moz":l(navigator.userAgent,"Opera/")?"opera":""}(),d=c+"-"+u;function p(R,B,I){(d===B||c===B||u===B)&&Object.keys(I).forEach(function(D){R[D]=I[D]})}function f(R,B){var I={};return Object.keys(R).forEach(function(D){var L=R[D];B in L&&(I[L[B]]=L)}),I}var m={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:n},92:{code:"OSRight",location:s},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:o},97:{code:"Numpad1",keyCap:"1",location:o},98:{code:"Numpad2",keyCap:"2",location:o},99:{code:"Numpad3",keyCap:"3",location:o},100:{code:"Numpad4",keyCap:"4",location:o},101:{code:"Numpad5",keyCap:"5",location:o},102:{code:"Numpad6",keyCap:"6",location:o},103:{code:"Numpad7",keyCap:"7",location:o},104:{code:"Numpad8",keyCap:"8",location:o},105:{code:"Numpad9",keyCap:"9",location:o},106:{code:"NumpadMultiply",keyCap:"*",location:o},107:{code:"NumpadAdd",keyCap:"+",location:o},108:{code:"NumpadComma",keyCap:",",location:o},109:{code:"NumpadSubtract",keyCap:"-",location:o},110:{code:"NumpadDecimal",keyCap:".",location:o},111:{code:"NumpadDivide",keyCap:"/",location:o},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:o},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:n},161:{code:"ShiftRight",location:s},162:{code:"ControlLeft",location:n},163:{code:"ControlRight",location:s},164:{code:"AltLeft",location:n},165:{code:"AltRight",location:s},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};p(m,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:o},189:{code:"NumpadSubtract",keyCap:"-",location:o}}),p(m,"moz-mac",{12:{code:"NumLock",location:o},173:{code:"Minus",keyCap:"-"}}),p(m,"moz-win",{173:{code:"Minus",keyCap:"-"}}),p(m,"chrome-mac",{93:{code:"OSRight",location:s}}),p(m,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),p(m,"ios",{10:{code:"Enter",location:i}}),p(m,"safari-mac",{91:{code:"OSLeft",location:n},93:{code:"OSRight",location:s},229:{code:"KeyQ",keyCap:"Q"}});var g={};u==="cros"&&(g["U+00A0"]={code:"ShiftLeft",location:n},g["U+00A1"]={code:"ShiftRight",location:s},g["U+00A2"]={code:"ControlLeft",location:n},g["U+00A3"]={code:"ControlRight",location:s},g["U+00A4"]={code:"AltLeft",location:n},g["U+00A5"]={code:"AltRight",location:s}),d==="chrome-mac"&&(g["U+0010"]={code:"ContextMenu"}),d==="safari-mac"&&(g["U+0010"]={code:"ContextMenu"}),u==="ios"&&(g["U+0010"]={code:"Function"},g["U+001C"]={code:"ArrowLeft"},g["U+001D"]={code:"ArrowRight"},g["U+001E"]={code:"ArrowUp"},g["U+001F"]={code:"ArrowDown"},g["U+0001"]={code:"Home"},g["U+0004"]={code:"End"},g["U+000B"]={code:"PageUp"},g["U+000C"]={code:"PageDown"});var y=[];y[n]={16:{code:"ShiftLeft",location:n},17:{code:"ControlLeft",location:n},18:{code:"AltLeft",location:n}},y[s]={16:{code:"ShiftRight",location:s},17:{code:"ControlRight",location:s},18:{code:"AltRight",location:s}},y[o]={13:{code:"NumpadEnter",location:o}},p(y[o],"moz",{109:{code:"NumpadSubtract",location:o},107:{code:"NumpadAdd",location:o}}),p(y[n],"moz-mac",{224:{code:"OSLeft",location:n}}),p(y[s],"moz-mac",{224:{code:"OSRight",location:s}}),p(y[s],"moz-win",{91:{code:"OSRight",location:s}}),p(y[s],"mac",{93:{code:"OSRight",location:s}}),p(y[o],"chrome-mac",{12:{code:"NumLock",location:o}}),p(y[o],"safari-mac",{12:{code:"NumLock",location:o},187:{code:"NumpadAdd",location:o},189:{code:"NumpadSubtract",location:o},190:{code:"NumpadDecimal",location:o},191:{code:"NumpadDivide",location:o}});var x={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};p(x,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var v={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},_=f(m,"code");try{var T=e&&"location"in new KeyboardEvent("")}catch{}function w(R){var B="keyCode"in R?R.keyCode:"which"in R?R.which:0,I=function(){if(T||"keyLocation"in R){var L=T?R.location:R.keyLocation;if(L&&B in y[L])return y[L][B]}return"keyIdentifier"in R&&R.keyIdentifier in g?g[R.keyIdentifier]:B in m?m[B]:null}();if(!I)return null;var D=function(){var L=x[I.code];return L?R.shiftKey&&"shiftKey"in L?L.shiftKey:L.key:I.code}();return{code:I.code,key:D,location:I.location,keyCap:I.keyCap}}function S(R,B){if(R=String(R),!_.hasOwnProperty(R))return"Undefined";if(B&&String(B).toLowerCase()!=="en-us")throw Error("Unsupported locale");var I=_[R];return I.keyCap||I.code||"Undefined"}"KeyboardEvent"in r&&"defineProperty"in Object&&function(){function R(I,D,L){D in I||Object.defineProperty(I,D,L)}if(R(KeyboardEvent.prototype,"code",{get:function(){var I=w(this);return I?I.code:""}}),"key"in KeyboardEvent.prototype){var B=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var I=B.get.call(this);return v.hasOwnProperty(I)?v[I]:I}})}R(KeyboardEvent.prototype,"key",{get:function(){var I=w(this);return I&&"key"in I?I.key:"Unidentified"}}),R(KeyboardEvent.prototype,"location",{get:function(){var I=w(this);return I&&"location"in I?I.location:i}}),R(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in r.KeyboardEvent||(r.KeyboardEvent.queryKeyCap=S),r.identifyKey=function(R){if(!("code"in R)){var B=w(R);R.code=B?B.code:"",R.key=B&&"key"in B?B.key:"Unidentified",R.location="location"in R?R.location:"keyLocation"in R?R.keyLocation:B&&"location"in B?B.location:i,R.locale=""}}}(window);const JW="__keyboard-controls-proxy",ZW=window.KeyboardEvent;AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){const r=this.data,e=this.getKeys();return this.dVelocity.set(0,0,0),r.enabled&&((e.KeyW||e.ArrowUp)&&(this.dVelocity.z-=1),(e.KeyA||e.ArrowLeft)&&(this.dVelocity.x-=1),(e.KeyS||e.ArrowDown)&&(this.dVelocity.z+=1),(e.KeyD||e.ArrowRight)&&(this.dVelocity.x+=1),e.ShiftLeft&&(this.dVelocity=this.dVelocity.multiplyScalar(2))),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(const r in this.localKeys)this.localKeys.hasOwnProperty(r)&&delete this.localKeys[r]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(r){AFRAME.utils.shouldCaptureKeyEvent(r)&&(this.localKeys[r.code]=!0,this.emit(r))},onKeyUp:function(r){AFRAME.utils.shouldCaptureKeyEvent(r)&&(delete this.localKeys[r.code],this.emit(r))},onBlur:function(){for(const r in this.localKeys)this.localKeys.hasOwnProperty(r)&&delete this.localKeys[r]},emit:function(r){JW in r&&this.el.emit(r.type,r),this.el.emit(r.type+":"+r.code,new ZW(r.type,r)),this.data.debug&&console.log(r.type+":"+r.code)},isPressed:function(r){return r in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){const r=this.el.sceneEl.components["proxy-controls"];return r&&r.isConnected()}}),AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const r=this.el.sceneEl,e=r.canvas;if(!e){r.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}e.addEventListener("touchstart",this.onTouchStart,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd,{passive:!0});const i=r.getAttribute("vr-mode-ui");i&&i.cardboardModeEnabled&&r.addEventListener("enter-vr",this.onEnterVR)},removeEventListeners:function(){const r=this.el.sceneEl&&this.el.sceneEl.canvas;r&&(r.removeEventListener("touchstart",this.onTouchStart),r.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(r){this.direction=-1,this.data.reverseEnabled&&r.touches&&r.touches.length===2&&(this.direction=1),r.preventDefault()},onTouchEnd:function(r){this.direction=0,r.preventDefault()},onEnterVR:function(){const r=this.el.sceneEl.xrSession;r&&(r.addEventListener("selectstart",this.onTouchStart),r.addEventListener("selectend",this.onTouchEnd))}});const o2="-controls",$W=.2,eQ=1e-5,tQ="moved";AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){const r=this.el;this.data.camera||(this.data.camera=r.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.eventDetail={},this.navGroup=null,this.navNode=null,r.sceneEl.hasLoaded?this.injectControls():r.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(r){const e=this.el,i=this.data,n=e.sceneEl.systems.nav;if(e.sceneEl.hasLoaded&&this.injectControls(),n&&i.constrainToNavMesh!==r.constrainToNavMesh&&(i.constrainToNavMesh?n.addAgent(this):n.removeAgent(this)),i.enabled!==r.enabled)for(let s=0;s<i.controls.length;s++){const o=i.controls[s]+o2;this.el.setAttribute(o,{enabled:this.data.enabled})}},injectControls:function(){const r=this.data;for(let e=0;e<r.controls.length;e++){const i=r.controls[e]+o2;this.el.setAttribute(i,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){const r=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3;return function(n,s){if(!s)return;const o=this.el,l=this.data;if(!l.enabled)return;this.updateVelocityCtrl();const u=this.velocityCtrl,c=this.velocity;if(u)if(s/1e3>$W?c.set(0,0,0):this.updateVelocity(s),l.constrainToNavMesh&&u.isNavMeshConstrained!==!1){if(c.lengthSq()<eQ)return;r.copy(o.object3D.position),e.copy(c).multiplyScalar(s/1e3).add(r);const d=o.sceneEl.systems.nav;this.navGroup=this.navGroup===null?d.getGroup(r):this.navGroup,this.navNode=this.navNode||d.getNode(r,this.navGroup),this.navNode=d.clampStep(r,e,this.navGroup,this.navNode,i),o.object3D.position.copy(i)}else o.hasAttribute("velocity")?o.setAttribute("velocity",c):(o.object3D.position.x+=c.x*s/1e3,o.object3D.position.y+=c.y*s/1e3,o.object3D.position.z+=c.z*s/1e3)}}(),updateVelocityCtrl:function(){const r=this.data;if(r.enabled){for(let e=0,i=r.controls.length;e<i;e++){const n=this.el.components[r.controls[e]+o2];if(n&&n.isVelocityActive()){this.velocityCtrl=n;return}}this.velocityCtrl=null}},updateVelocity:function(){const r=new THREE.Vector2,e=new THREE.Quaternion;return function(i){let n;const s=this.el,o=this.velocityCtrl,l=this.velocity,u=this.data;if(o)if(o.getVelocityDelta)n=o.getVelocityDelta(i);else if(o.getVelocity){l.copy(o.getVelocity());return}else if(o.getPositionDelta){l.copy(o.getPositionDelta(i).multiplyScalar(1e3/i));return}else throw new Error("Incompatible movement controls: ",o);if(s.hasAttribute("velocity")&&!u.constrainToNavMesh&&l.copy(this.el.getAttribute("velocity")),n&&u.enabled){const c=u.camera;e.copy(c.object3D.quaternion),e.premultiply(s.object3D.quaternion),n.applyQuaternion(e);const d=n.length();u.fly?(l.copy(n),l.multiplyScalar(this.data.speed*16.66667)):(r.set(n.x,n.z),r.setLength(d*this.data.speed*16.66667),l.x=r.x,l.y=0,l.z=r.y),(l.x!==0||l.y!==0||l.z!==0)&&(this.eventDetail.velocity=l,this.el.emit(tQ,this.eventDetail))}}}()}),AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const r=this.data,e=this.el.sceneEl;switch(e.addEventListener("axismove",this.onAxisMove),r.mode){case"swipe":case"touch":e.addEventListener("trackpadtouchstart",this.onTouchStart),e.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":e.addEventListener("trackpaddown",this.onTouchStart),e.addEventListener("trackpadup",this.onTouchEnd);break}},removeEventListeners:function(){const r=this.el.sceneEl;r.removeEventListener("axismove",this.onAxisMove),r.removeEventListener("trackpadtouchstart",this.onTouchStart),r.removeEventListener("trackpadtouchend",this.onTouchEnd),r.removeEventListener("trackpaddown",this.onTouchStart),r.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(r){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":this.isMoving=!0;break;case"press":this.isMoving=!0;break}r.preventDefault()},onTouchEnd:function(r){this.data.mode=="swipe"&&(this.startingAxisData=[]),this.isMoving=!1,r.preventDefault()},onAxisMove:function(r){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(r);case"touch":case"press":return this.handleTouchAxis(r)}},handleSwipeAxis:function(r){const e=this.data,i=r.detail.axis;if(this.startingAxisData.length===0&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=i[0],this.startingAxisData[1]=i[1]),this.startingAxisData.length>0){let n=0,s=0;e.enableNegX&&i[0]<this.startingAxisData[0]&&(n=-1),e.enablePosX&&i[0]>this.startingAxisData[0]&&(n=1),e.enablePosZ&&i[1]>this.startingAxisData[1]&&(s=-1),e.enableNegZ&&i[1]<this.startingAxisData[1]&&(s=1);const o=Math.abs(this.startingAxisData[1]-i[1]);Math.abs(this.startingAxisData[0]-i[0])>o?(this.zVel=0,this.xVel=n,this.isMoving=!0):(this.xVel=0,this.zVel=s,this.isMoving=!0)}},handleTouchAxis:function(r){const e=this.data,i=r.detail.axis;let n=0,s=0;e.enableNegX&&i[0]<0&&(n=-1),e.enablePosX&&i[0]>0&&(n=1),e.enablePosZ&&i[1]>0&&(s=-1),e.enableNegZ&&i[1]<0&&(s=1),Math.abs(i[0])>Math.abs(i[1])?(this.zVel=0,this.xVel=n):(this.xVel=0,this.zVel=s)}});const Kv=(r,e)=>{const i=e.x-r.x,n=e.y-r.y;return Math.sqrt(i*i+n*n)},iQ=(r,e)=>{const i=e.x-r.x,n=e.y-r.y;return nQ(Math.atan2(n,i))},rQ=(r,e,i)=>{const n={x:0,y:0};return i=l2(i),n.x=r.x-e*Math.cos(i),n.y=r.y-e*Math.sin(i),n},l2=r=>r*(Math.PI/180),nQ=r=>r*(180/Math.PI),sQ=r=>isNaN(r.buttons)?r.pressure!==0:r.buttons!==0,c2=new Map,tD=r=>{c2.has(r)&&clearTimeout(c2.get(r)),c2.set(r,setTimeout(r,100))},Jv=(r,e,i)=>{const n=e.split(/[ ,]+/g);let s;for(let o=0;o<n.length;o+=1)s=n[o],r.addEventListener?r.addEventListener(s,i,!1):r.attachEvent&&r.attachEvent(s,i)},iD=(r,e,i)=>{const n=e.split(/[ ,]+/g);let s;for(let o=0;o<n.length;o+=1)s=n[o],r.removeEventListener?r.removeEventListener(s,i):r.detachEvent&&r.detachEvent(s,i)},rD=r=>(r.preventDefault(),r.type.match(/^touch/)?r.changedTouches:r),nD=()=>{const r=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:r,y:e}},sD=(r,e)=>{e.top||e.right||e.bottom||e.left?(r.style.top=e.top,r.style.right=e.right,r.style.bottom=e.bottom,r.style.left=e.left):(r.style.left=e.x+"px",r.style.top=e.y+"px")},u2=(r,e,i)=>{const n=aD(r);for(let s in n)if(n.hasOwnProperty(s))if(typeof e=="string")n[s]=e+" "+i;else{let o="";for(let l=0,u=e.length;l<u;l+=1)o+=e[l]+" "+i+", ";n[s]=o.slice(0,-2)}return n},aQ=(r,e)=>{const i=aD(r);for(let n in i)i.hasOwnProperty(n)&&(i[n]=e);return i},aD=r=>{const e={};return e[r]="",["webkit","Moz","o"].forEach(function(i){e[i+r.charAt(0).toUpperCase()+r.slice(1)]=""}),e},h2=(r,e)=>{for(let i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);return r},oQ=(r,e)=>{const i={};for(let n in r)r.hasOwnProperty(n)&&e.hasOwnProperty(n)?i[n]=e[n]:r.hasOwnProperty(n)&&(i[n]=r[n]);return i},d2=(r,e)=>{if(r.length)for(let i=0,n=r.length;i<n;i+=1)e(r[i]);else e(r)},lQ=(r,e,i)=>({x:Math.min(Math.max(r.x,e.x-i),e.x+i),y:Math.min(Math.max(r.y,e.y-i),e.y+i)});var cQ="ontouchstart"in window,uQ=!!window.PointerEvent,hQ=!!window.MSPointerEvent,D0={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},If,O0={};uQ?If=D0.pointer:hQ?If=D0.MSPointer:cQ?(If=D0.touch,O0=D0.mouse):If=D0.mouse;function nu(){}nu.prototype.on=function(r,e){var i=this,n=r.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)s=n[o],i._handlers_[s]=i._handlers_[s]||[],i._handlers_[s].push(e);return i},nu.prototype.off=function(r,e){var i=this;return i._handlers_=i._handlers_||{},r===void 0?i._handlers_={}:e===void 0?i._handlers_[r]=null:i._handlers_[r]&&i._handlers_[r].indexOf(e)>=0&&i._handlers_[r].splice(i._handlers_[r].indexOf(e),1),i},nu.prototype.trigger=function(r,e){var i=this,n=r.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)s=n[o],i._handlers_[s]&&i._handlers_[s].length&&i._handlers_[s].forEach(function(l){l.call(i,{type:s,target:i},e)})},nu.prototype.config=function(r){var e=this;e.options=e.defaults||{},r&&(e.options=oQ(e.options,r))},nu.prototype.bindEvt=function(r,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},Jv(r,If[e],i._domHandlers_[e]),O0[e]&&Jv(r,O0[e],i._domHandlers_[e]),i},nu.prototype.unbindEvt=function(r,e){var i=this;return i._domHandlers_=i._domHandlers_||{},iD(r,If[e],i._domHandlers_[e]),O0[e]&&iD(r,O0[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};function oa(r,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=r,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=oa.id,oa.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}oa.prototype=new nu,oa.constructor=oa,oa.id=0,oa.prototype.buildEl=function(r){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)},oa.prototype.stylize=function(){if(this.options.dataOnly)return this;var r=this.options.fadeTime+"ms",e=aQ("borderRadius","50%"),i=u2("transition","opacity",r),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},h2(n.el,i),this.options.shape==="circle"&&h2(n.back,e),h2(n.front,e),this.applyStyles(n),this},oa.prototype.applyStyles=function(r){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in r[e])this.ui[e].style[i]=r[e][i];return this},oa.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)},oa.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)},oa.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},oa.prototype.show=function(r){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof r=="function"&&r.call(this)},e.options.fadeTime)),e},oa.prototype.hide=function(r){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof r=="function"&&r.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){const i=e.options.restJoystick,n={};n.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,n.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(r,n)}return e},oa.prototype.setPosition=function(r,e){var i=this;i.frontPosition={x:e.x,y:e.y};var n=i.options.fadeTime+"ms",s={};s.front=u2("transition",["transform"],n);var o={front:{}};o.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(s),i.applyStyles(o),i.restTimeout=setTimeout(function(){typeof r=="function"&&r.call(i),i.restCallback()},i.options.fadeTime)},oa.prototype.restCallback=function(){var r=this,e={};e.front=u2("transition","none",""),r.applyStyles(e),r.trigger("rested",r.instance)},oa.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},oa.prototype.computeDirection=function(r){var e=r.angle.radian,i=Math.PI/4,n=Math.PI/2,s,o,l;if(e>i&&e<i*3&&!r.lockX?s="up":e>-i&&e<=i&&!r.lockY?s="left":e>-i*3&&e<=-i&&!r.lockX?s="down":r.lockY||(s="right"),r.lockY||(e>-n&&e<n?o="left":o="right"),r.lockX||(e>0?l="up":l="down"),r.force>this.options.threshold){var u={},c;for(c in this.direction)this.direction.hasOwnProperty(c)&&(u[c]=this.direction[c]);var d={};this.direction={x:o,y:l,angle:s},r.direction=this.direction;for(c in u)u[c]===this.direction[c]&&(d[c]=!0);if(d.x&&d.y&&d.angle)return r;(!d.x||!d.y)&&this.trigger("plain",r),d.x||this.trigger("plain:"+o,r),d.y||this.trigger("plain:"+l,r),d.angle||this.trigger("dir dir:"+s,r)}else this.resetDirection();return r};function Us(r,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=r,i.id=Us.id,Us.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const n=getComputedStyle(i.options.zone.parentElement);return n&&n.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}Us.prototype=new nu,Us.constructor=Us,Us.id=0,Us.prototype.prepareNipples=function(){var r=this,e=r.nipples;e.on=r.on.bind(r),e.off=r.off.bind(r),e.options=r.options,e.destroy=r.destroy.bind(r),e.ids=r.ids,e.id=r.id,e.processOnMove=r.processOnMove.bind(r),e.processOnEnd=r.processOnEnd.bind(r),e.get=function(i){if(i===void 0)return e[0];for(var n=0,s=e.length;n<s;n+=1)if(e[n].identifier===i)return e[n];return!1}},Us.prototype.bindings=function(){var r=this;r.bindEvt(r.options.zone,"start"),r.options.zone.style.touchAction="none",r.options.zone.style.msTouchAction="none"},Us.prototype.begin=function(){var r=this,e=r.options;if(e.mode==="static"){var i=r.createNipple(e.position,r.manager.getIdentifier());i.add(),r.idles.push(i)}},Us.prototype.createNipple=function(r,e){var i=this,n=i.manager.scroll,s={},o=i.options,l={x:i.parentIsFlex?n.x:n.x+i.box.left,y:i.parentIsFlex?n.y:n.y+i.box.top};if(r.x&&r.y)s={x:r.x-l.x,y:r.y-l.y};else if(r.top||r.right||r.bottom||r.left){var u=document.createElement("DIV");u.style.display="hidden",u.style.top=r.top,u.style.right=r.right,u.style.bottom=r.bottom,u.style.left=r.left,u.style.position="absolute",o.zone.appendChild(u);var c=u.getBoundingClientRect();o.zone.removeChild(u),s=r,r={x:c.left+n.x,y:c.top+n.y}}var d=new oa(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:e,position:r,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(sD(d.ui.el,s),sD(d.ui.front,d.frontPosition)),i.nipples.push(d),i.trigger("added "+d.identifier+":added",d),i.manager.trigger("added "+d.identifier+":added",d),i.bindNipple(d),d},Us.prototype.updateBox=function(){var r=this;r.box=r.options.zone.getBoundingClientRect()},Us.prototype.bindNipple=function(r){var e=this,i,n=function(s,o){i=s.type+" "+o.id+":"+s.type,e.trigger(i,o)};r.on("destroyed",e.onDestroyed.bind(e)),r.on("shown hidden rested dir plain",n),r.on("dir:up dir:right dir:down dir:left",n),r.on("plain:up plain:right plain:down plain:left",n)},Us.prototype.pressureFn=function(r,e,i){var n=this,s=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var o=r.force||r.pressure||r.webkitForce||0;o!==s&&(e.trigger("pressure",o),n.trigger("pressure "+e.identifier+":pressure",o),s=o)}).bind(n),100)},Us.prototype.onstart=function(r){var e=this,i=e.options,n=r;r=rD(r),e.updateBox();var s=function(o){e.actives.length<i.maxNumberOfNipples?e.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(l){if(Object.values(n.touches).findIndex(function(c){return c.identifier===l})<0){var u=[r[0]];u.identifier=l,e.processOnEnd(u)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(o))};return d2(r,s),e.manager.bindDocument(),!1},Us.prototype.processOnStart=function(r){var e=this,i=e.options,n,s=e.manager.getIdentifier(r),o=r.force||r.pressure||r.webkitForce||0,l={x:r.pageX,y:r.pageY},u=e.getOrCreate(s,l);u.identifier!==s&&e.manager.removeIdentifier(u.identifier),u.identifier=s;var c=function(p){p.trigger("start",p),e.trigger("start "+p.id+":start",p),p.show(),o>0&&e.pressureFn(r,p,p.identifier),e.processOnMove(r)};if((n=e.idles.indexOf(u))>=0&&e.idles.splice(n,1),e.actives.push(u),e.ids.push(u.identifier),i.mode!=="semi")c(u);else{var d=Kv(l,u.position);if(d<=i.catchDistance)c(u);else{u.destroy(),e.processOnStart(r);return}}return u},Us.prototype.getOrCreate=function(r,e){var i=this,n=i.options,s;return/(semi|static)/.test(n.mode)?(s=i.idles[0],s?(i.idles.splice(0,1),s):n.mode==="semi"?i.createNipple(e,r):(console.warn("Coudln't find the needed nipple."),!1)):(s=i.createNipple(e,r),s)},Us.prototype.processOnMove=function(r){var e=this,i=e.options,n=e.manager.getIdentifier(r),s=e.nipples.get(n),o=e.manager.scroll;if(!sQ(r)){this.processOnEnd(r);return}if(!s){console.error("Found zombie joystick with ID "+n),e.manager.removeIdentifier(n);return}if(i.dynamicPage){var l=s.el.getBoundingClientRect();s.position={x:o.x+l.left,y:o.y+l.top}}s.identifier=n;var u=s.options.size/2,c={x:r.pageX,y:r.pageY};i.lockX&&(c.y=s.position.y),i.lockY&&(c.x=s.position.x);var d=Kv(c,s.position),p=iQ(c,s.position),f=l2(p),m=d/u,g={distance:d,position:c},y,x;if(s.options.shape==="circle"?(y=Math.min(d,u),x=rQ(s.position,y,p)):(x=lQ(c,s.position,u),y=Kv(x,s.position)),i.follow){if(d>u){let w=c.x-x.x,S=c.y-x.y;s.position.x+=w,s.position.y+=S,s.el.style.top=s.position.y-(e.box.top+o.y)+"px",s.el.style.left=s.position.x-(e.box.left+o.x)+"px",d=Kv(c,s.position)}}else c=x,d=y;var v=c.x-s.position.x,_=c.y-s.position.y;s.frontPosition={x:v,y:_},i.dataOnly||(s.ui.front.style.transform="translate("+v+"px,"+_+"px)");var T={identifier:s.identifier,position:c,force:m,pressure:r.force||r.pressure||r.webkitForce||0,distance:d,angle:{radian:f,degree:p},vector:{x:v/u,y:-_/u},raw:g,instance:s,lockX:i.lockX,lockY:i.lockY};T=s.computeDirection(T),T.angle={radian:l2(180-p),degree:180-p},s.trigger("move",T),e.trigger("move "+s.id+":move",T)},Us.prototype.processOnEnd=function(r){var e=this,i=e.options,n=e.manager.getIdentifier(r),s=e.nipples.get(n),o=e.manager.removeIdentifier(s.identifier);s&&(i.dataOnly||s.hide(function(){i.mode==="dynamic"&&(s.trigger("removed",s),e.trigger("removed "+s.id+":removed",s),e.manager.trigger("removed "+s.id+":removed",s),s.destroy())}),clearInterval(e.pressureIntervals[s.identifier]),s.resetDirection(),s.trigger("end",s),e.trigger("end "+s.id+":end",s),e.ids.indexOf(s.identifier)>=0&&e.ids.splice(e.ids.indexOf(s.identifier),1),e.actives.indexOf(s)>=0&&e.actives.splice(e.actives.indexOf(s),1),/(semi|static)/.test(i.mode)?e.idles.push(s):e.nipples.indexOf(s)>=0&&e.nipples.splice(e.nipples.indexOf(s),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[o.id]=o.identifier))},Us.prototype.onDestroyed=function(r,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()},Us.prototype.destroy=function(){var r=this;r.unbindEvt(r.options.zone,"start"),r.nipples.forEach(function(i){i.destroy()});for(var e in r.pressureIntervals)r.pressureIntervals.hasOwnProperty(e)&&clearInterval(r.pressureIntervals[e]);r.trigger("destroyed",r.nipples),r.manager.unbindDocument(),r.off()};function va(r){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=nD(),e.config(r),e.prepareCollections();var i=function(){var s;e.collections.forEach(function(o){o.forEach(function(l){s=l.el.getBoundingClientRect(),l.position={x:e.scroll.x+s.left,y:e.scroll.y+s.top}})})};Jv(window,"resize",function(){tD(i)});var n=function(){e.scroll=nD()};return Jv(window,"scroll",function(){tD(n)}),e.collections}va.prototype=new nu,va.constructor=va,va.prototype.prepareCollections=function(){var r=this;r.collections.create=r.create.bind(r),r.collections.on=r.on.bind(r),r.collections.off=r.off.bind(r),r.collections.destroy=r.destroy.bind(r),r.collections.get=function(e){var i;return r.collections.every(function(n){return i=n.get(e),!i}),i}},va.prototype.create=function(r){return this.createCollection(r)},va.prototype.createCollection=function(r){var e=this,i=new Us(e,r);return e.bindCollection(i),e.collections.push(i),i},va.prototype.bindCollection=function(r){var e=this,i,n=function(s,o){i=s.type+" "+o.id+":"+s.type,e.trigger(i,o)};r.on("destroyed",e.onDestroyed.bind(e)),r.on("shown hidden rested dir plain",n),r.on("dir:up dir:right dir:down dir:left",n),r.on("plain:up plain:right plain:down plain:left",n)},va.prototype.bindDocument=function(){var r=this;r.binded||(r.bindEvt(document,"move").bindEvt(document,"end"),r.binded=!0)},va.prototype.unbindDocument=function(r){var e=this;(!Object.keys(e.ids).length||r===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)},va.prototype.getIdentifier=function(r){var e;return r?(e=r.identifier===void 0?r.pointerId:r.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},va.prototype.removeIdentifier=function(r){var e={};for(var i in this.ids)if(this.ids[i]===r){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e},va.prototype.onmove=function(r){var e=this;return e.onAny("move",r),!1},va.prototype.onend=function(r){var e=this;return e.onAny("end",r),!1},va.prototype.oncancel=function(r){var e=this;return e.onAny("end",r),!1},va.prototype.onAny=function(r,e){var i=this,n,s="processOn"+r.charAt(0).toUpperCase()+r.slice(1);e=rD(e);var o=function(u,c,d){d.ids.indexOf(c)>=0&&(d[s](u),u._found_=!0)},l=function(u){n=i.getIdentifier(u),d2(i.collections,o.bind(null,u,n)),u._found_||i.removeIdentifier(n)};return d2(e,l),!1},va.prototype.destroy=function(){var r=this;r.unbindDocument(!0),r.ids={},r.index=0,r.collections.forEach(function(e){e.destroy()}),r.off()},va.prototype.onDestroyed=function(r,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};const oD=new va,lD={create:function(r){return oD.create(r)},factory:oD};AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;const r=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=r.pitchObject,this.yawObject=r.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update(r){(this.data.moveJoystickPosition!==r.moveJoystickPosition||this.data.sideMargin!==r.sideMargin||this.data.bottomMargin!==r.bottomMargin||this.data.mode!==r.mode)&&this.removeMoveJoystick(),(this.data.lookJoystickPosition!==r.lookJoystickPosition||this.data.sideMargin!==r.sideMargin||this.data.bottomMargin!==r.bottomMargin||this.data.mode!==r.mode)&&this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause(){this.moving=!1,this.rotating=!1},remove(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive(){return this.data.enabled&&this.moving},getVelocityDelta(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){const r=this.moveData.force<1?this.moveData.force:1,e=this.moveData.angle.radian,i=Math.cos(e)*r,n=-Math.sin(e)*r;this.dVelocity.set(i,0,n)}return this.dVelocity},isRotationActive(){return this.data.enabled&&this.rotating},updateRotation(r){if(!this.isRotationActive())return;const e=this.lookData.force<1?this.lookData.force:1,i=this.lookData.angle.radian,n=this.lookVector;n.x=Math.cos(i)*e,n.y=Math.sin(i)*e,n.multiplyScalar(this.data.rotationSensitivity*r/1e3),this.yawObject.rotation.y-=n.x;let s=this.pitchObject.rotation.x+n.y;s=Math.max(-Math.PI/2,Math.min(Math.PI/2,s)),this.pitchObject.rotation.x=s},tick:function(r,e){this.updateRotation(e)},initLeftZone(){const r=document.createElement("div");r.setAttribute("id","joystickLeftZone"),r.setAttribute("style",`position:absolute;${this.data.moveJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(r),this.leftZone=r},initRightZone(){const r=document.createElement("div");r.setAttribute("id","joystickRightZone"),r.setAttribute("style",`position:absolute;${this.data.lookJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(r),this.rightZone=r},createMoveJoystick(){if(this.moveJoystick)return;this.initLeftZone();const r={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px",this.data.mode==="static"?(this.leftZone.style.height="100px",r.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=lD.create(r),this.moveJoystick.on("move",(e,i)=>{this.moveData=i,this.moving=!0}),this.moveJoystick.on("end",(e,i)=>{this.moving=!1})},createLookJoystick(){if(this.lookJoystick)return;this.initRightZone();const r={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px",this.data.mode==="static"?(this.rightZone.style.height="100px",r.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=lD.create(r),this.lookJoystick.on("move",(e,i)=>{this.lookData=i,this.rotating=!0}),this.lookJoystick.on("end",(e,i)=>{this.rotating=!1})},removeMoveJoystick(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}});const p2={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(p2)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const r=this.el.getObject3D("mesh");r?this.load(r):this.el.addEventListener("model-loaded",e=>{this.load(e.detail.model)})},load:function(r){const e=this.el;this.model=r,this.mixer=new THREE.AnimationMixer(r),this.mixer.addEventListener("loop",i=>{e.emit("animation-loop",{action:i.action,loopDelta:i.loopDelta})}),this.mixer.addEventListener("finished",i=>{e.emit("animation-finished",{action:i.action,direction:i.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(r){if(!r)return;const e=this.data,i=AFRAME.utils.diff(e,r);if("clip"in i){this.stopAction(),e.clip&&this.playAction();return}this.activeActions.forEach(n=>{"duration"in i&&e.duration&&n.setDuration(e.duration),"clampWhenFinished"in i&&(n.clampWhenFinished=e.clampWhenFinished),("loop"in i||"repetitions"in i)&&n.setLoop(p2[e.loop],e.repetitions),"timeScale"in i&&n.setEffectiveTimeScale(e.timeScale)})},stopAction:function(){const r=this.data;for(let e=0;e<this.activeActions.length;e++)r.crossFadeDuration?this.activeActions[e].fadeOut(r.crossFadeDuration):this.activeActions[e].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const r=this.model,e=this.data,i=r.animations||(r.geometry||{}).animations||[];if(!i.length)return;const n=e.useRegExp?e.clip:dQ(e.clip);for(let s,o=0;s=i[o];o++)if(s.name.match(n)){const l=this.mixer.clipAction(s,r);l.enabled=!0,l.clampWhenFinished=e.clampWhenFinished,e.duration&&l.setDuration(e.duration),e.timeScale!==1&&l.setEffectiveTimeScale(e.timeScale),l.startAt(this.mixer.time-e.startAt/1e3),l.setLoop(p2[e.loop],e.repetitions).fadeIn(e.crossFadeDuration).play(),this.activeActions.push(l)}},tick:function(r,e){this.mixer&&!isNaN(e)&&this.mixer.update(e/1e3)}});function dQ(r){return new RegExp("^"+r.split(/\*+/).map(pQ).join(".*")+"$")}function pQ(r){return r.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}var fQ=THREE.ColladaLoader=function(r){this.manager=r!==void 0?r:THREE.DefaultLoadingManager};THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(r,e,i,n){var s=this,o=s.path===void 0?THREE.LoaderUtils.extractUrlBase(r):s.path,l=new THREE.FileLoader(s.manager);l.setPath(s.path),l.load(r,function(u){e(s.parse(u,o))},i,n)},setPath:function(r){return this.path=r,this},setResourcePath:function(r){return this.resourcePath=r,this},options:{set convertUpAxis(r){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(r){return this.crossOrigin=r,this},parse:function(r,e){function i(he,le){for(var pe=[],be=he.childNodes,Ee=0,st=be.length;Ee<st;Ee++){var Ct=be[Ee];Ct.nodeName===le&&pe.push(Ct)}return pe}function n(he){if(he.length===0)return[];for(var le=he.trim().split(/\s+/),pe=new Array(le.length),be=0,Ee=le.length;be<Ee;be++)pe[be]=le[be];return pe}function s(he){if(he.length===0)return[];for(var le=he.trim().split(/\s+/),pe=new Array(le.length),be=0,Ee=le.length;be<Ee;be++)pe[be]=parseFloat(le[be]);return pe}function o(he){if(he.length===0)return[];for(var le=he.trim().split(/\s+/),pe=new Array(le.length),be=0,Ee=le.length;be<Ee;be++)pe[be]=parseInt(le[be]);return pe}function l(he){return he.substring(1)}function u(){return"three_default_"+We++}function c(he){return Object.keys(he).length===0}function d(he){return{unit:p(i(he,"unit")[0]),upAxis:f(i(he,"up_axis")[0])}}function p(he){return he!==void 0&&he.hasAttribute("meter")===!0?parseFloat(he.getAttribute("meter")):1}function f(he){return he!==void 0?he.textContent:"Y_UP"}function m(he,le,pe,be){var Ee=i(he,le)[0];if(Ee!==void 0)for(var st=i(Ee,pe),Ct=0;Ct<st.length;Ct++)be(st[Ct])}function g(he,le){for(var pe in he){var be=he[pe];be.build=le(he[pe])}}function y(he,le){return he.build!==void 0||(he.build=le(he)),he.build}function x(he){for(var le={sources:{},samplers:{},channels:{}},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1){var st;switch(Ee.nodeName){case"source":st=Ee.getAttribute("id"),le.sources[st]=ce(Ee);break;case"sampler":st=Ee.getAttribute("id"),le.samplers[st]=v(Ee);break;case"channel":st=Ee.getAttribute("target"),le.channels[st]=_(Ee);break;default:console.log(Ee)}}}Ye.animations[he.getAttribute("id")]=le}function v(he){for(var le={inputs:{}},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var st=l(Ee.getAttribute("source")),Ct=Ee.getAttribute("semantic");le.inputs[Ct]=st;break}}return le}function _(he){var le={},pe=he.getAttribute("target"),be=pe.split("/"),Ee=be.shift(),st=be.shift(),Ct=st.indexOf("(")!==-1,Ht=st.indexOf(".")!==-1;if(Ht)be=st.split("."),st=be.shift(),le.member=be.shift();else if(Ct){var ii=st.split("(");st=ii.shift();for(var mi=0;mi<ii.length;mi++)ii[mi]=parseInt(ii[mi].replace(/\)/,""));le.indices=ii}return le.id=Ee,le.sid=st,le.arraySyntax=Ct,le.memberSyntax=Ht,le.sampler=l(he.getAttribute("source")),le}function T(he){var le=[],pe=he.channels,be=he.samplers,Ee=he.sources;for(var st in pe)if(pe.hasOwnProperty(st)){var Ct=pe[st],Ht=be[Ct.sampler],ii=Ht.inputs.INPUT,mi=Ht.inputs.OUTPUT,Wt=Ee[ii],Bi=Ee[mi],yr=S(Ct,Wt,Bi);L(yr,le)}return le}function w(he){return y(Ye.animations[he],T)}function S(he,le,pe){var be=Ye.nodes[he.id],Ee=Fi(be.id),st=be.transforms[he.sid],Ct=be.matrix.clone().transpose(),Ht,ii,mi,Wt,Bi,yr,dr={};switch(st){case"matrix":for(mi=0,Wt=le.array.length;mi<Wt;mi++)if(Ht=le.array[mi],ii=mi*pe.stride,dr[Ht]===void 0&&(dr[Ht]={}),he.arraySyntax===!0){var pr=pe.array[ii],Hi=he.indices[0]+4*he.indices[1];dr[Ht][Hi]=pr}else for(Bi=0,yr=pe.stride;Bi<yr;Bi++)dr[Ht][Bi]=pe.array[ii+Bi];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',st);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',st);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',st);break}var Er=R(dr,Ct),Sr={name:Ee.uuid,keyframes:Er};return Sr}function R(he,le){var pe=[];for(var be in he)pe.push({time:parseFloat(be),value:he[be]});pe.sort(st);for(var Ee=0;Ee<16;Ee++)O(pe,Ee,le.elements[Ee]);return pe;function st(Ct,Ht){return Ct.time-Ht.time}}var B=new THREE.Vector3,I=new THREE.Vector3,D=new THREE.Quaternion;function L(he,le){for(var pe=he.keyframes,be=he.name,Ee=[],st=[],Ct=[],Ht=[],ii=0,mi=pe.length;ii<mi;ii++){var Wt=pe[ii],Bi=Wt.time,yr=Wt.value;ge.fromArray(yr).transpose(),ge.decompose(B,D,I),Ee.push(Bi),st.push(B.x,B.y,B.z),Ct.push(D.x,D.y,D.z,D.w),Ht.push(I.x,I.y,I.z)}return st.length>0&&le.push(new THREE.VectorKeyframeTrack(be+".position",Ee,st)),Ct.length>0&&le.push(new THREE.QuaternionKeyframeTrack(be+".quaternion",Ee,Ct)),Ht.length>0&&le.push(new THREE.VectorKeyframeTrack(be+".scale",Ee,Ht)),le}function O(he,le,pe){var be,Ee=!0,st,Ct;for(st=0,Ct=he.length;st<Ct;st++)be=he[st],be.value[le]===void 0?be.value[le]=null:Ee=!1;if(Ee===!0)for(st=0,Ct=he.length;st<Ct;st++)be=he[st],be.value[le]=pe;else U(he,le)}function U(he,le){for(var pe,be,Ee=0,st=he.length;Ee<st;Ee++){var Ct=he[Ee];if(Ct.value[le]===null){if(pe=J(he,Ee,le),be=H(he,Ee,le),pe===null){Ct.value[le]=be.value[le];continue}if(be===null){Ct.value[le]=pe.value[le];continue}V(Ct,pe,be,le)}}}function J(he,le,pe){for(;le>=0;){var be=he[le];if(be.value[pe]!==null)return be;le--}return null}function H(he,le,pe){for(;le<he.length;){var be=he[le];if(be.value[pe]!==null)return be;le++}return null}function V(he,le,pe,be){if(pe.time-le.time===0){he.value[be]=le.value[be];return}he.value[be]=(he.time-le.time)*(pe.value[be]-le.value[be])/(pe.time-le.time)+le.value[be]}function $(he){for(var le={name:he.getAttribute("id")||"default",start:parseFloat(he.getAttribute("start")||0),end:parseFloat(he.getAttribute("end")||0),animations:[]},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"instance_animation":le.animations.push(l(Ee.getAttribute("url")));break}}Ye.clips[he.getAttribute("id")]=le}function Q(he){for(var le=[],pe=he.name,be=he.end-he.start||-1,Ee=he.animations,st=0,Ct=Ee.length;st<Ct;st++)for(var Ht=w(Ee[st]),ii=0,mi=Ht.length;ii<mi;ii++)le.push(Ht[ii]);return new THREE.AnimationClip(pe,be,le)}function G(he){return y(Ye.clips[he],Q)}function j(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"skin":le.id=l(Ee.getAttribute("source")),le.skin=ie(Ee);break;case"morph":le.id=l(Ee.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}Ye.controllers[he.getAttribute("id")]=le}function ie(he){for(var le={sources:{}},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"bind_shape_matrix":le.bindShapeMatrix=s(Ee.textContent);break;case"source":var st=Ee.getAttribute("id");le.sources[st]=ce(Ee);break;case"joints":le.joints=Y(Ee);break;case"vertex_weights":le.vertexWeights=ae(Ee);break}}return le}function Y(he){for(var le={inputs:{}},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var st=Ee.getAttribute("semantic"),Ct=l(Ee.getAttribute("source"));le.inputs[st]=Ct;break}}return le}function ae(he){for(var le={inputs:{}},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var st=Ee.getAttribute("semantic"),Ct=l(Ee.getAttribute("source")),Ht=parseInt(Ee.getAttribute("offset"));le.inputs[st]={id:Ct,offset:Ht};break;case"vcount":le.vcount=o(Ee.textContent);break;case"v":le.v=o(Ee.textContent);break}}return le}function xe(he){var le={id:he.id},pe=Ye.geometries[le.id];return he.skin!==void 0&&(le.skin=fe(he.skin),pe.sources.skinIndices=le.skin.indices,pe.sources.skinWeights=le.skin.weights),le}function fe(he){var le=4,pe={joints:[],indices:{array:[],stride:le},weights:{array:[],stride:le}},be=he.sources,Ee=he.vertexWeights,st=Ee.vcount,Ct=Ee.v,Ht=Ee.inputs.JOINT.offset,ii=Ee.inputs.WEIGHT.offset,mi=he.sources[he.joints.inputs.JOINT],Wt=he.sources[he.joints.inputs.INV_BIND_MATRIX],Bi=be[Ee.inputs.WEIGHT.id].array,yr=0,dr,pr,Hi;for(dr=0,Hi=st.length;dr<Hi;dr++){var Er=st[dr],Sr=[];for(pr=0;pr<Er;pr++){var Fr=Ct[yr+Ht],jr=Ct[yr+ii],vn=Bi[jr];Sr.push({index:Fr,weight:vn}),yr+=2}for(Sr.sort(gl),pr=0;pr<le;pr++){var zr=Sr[pr];zr!==void 0?(pe.indices.array.push(zr.index),pe.weights.array.push(zr.weight)):(pe.indices.array.push(0),pe.weights.array.push(0))}}for(he.bindShapeMatrix?pe.bindMatrix=new THREE.Matrix4().fromArray(he.bindShapeMatrix).transpose():pe.bindMatrix=new THREE.Matrix4().identity(),dr=0,Hi=mi.array.length;dr<Hi;dr++){var cs=mi.array[dr],Lr=new THREE.Matrix4().fromArray(Wt.array,dr*Wt.stride).transpose();pe.joints.push({name:cs,boneInverse:Lr})}return pe;function gl(qo,_c){return _c.weight-qo.weight}}function de(he){return y(Ye.controllers[he],xe)}function Ie(he){var le={init_from:i(he,"init_from")[0].textContent};Ye.images[he.getAttribute("id")]=le}function Ge(he){return he.build!==void 0?he.build:he.init_from}function Xe(he){var le=Ye.images[he];return le!==void 0?y(le,Ge):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",he),null)}function $e(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"profile_COMMON":le.profile=lt(Ee);break}}Ye.effects[he.getAttribute("id")]=le}function lt(he){for(var le={surfaces:{},samplers:{}},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"newparam":At(Ee,le);break;case"technique":le.technique=yi(Ee);break;case"extra":le.extra=tr(Ee);break}}return le}function At(he,le){for(var pe=he.getAttribute("sid"),be=0,Ee=he.childNodes.length;be<Ee;be++){var st=he.childNodes[be];if(st.nodeType===1)switch(st.nodeName){case"surface":le.surfaces[pe]=Gt(st);break;case"sampler2D":le.samplers[pe]=gt(st);break}}}function Gt(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"init_from":le.init_from=Ee.textContent;break}}return le}function gt(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"source":le.source=Ee.textContent;break}}return le}function yi(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"constant":case"lambert":case"blinn":case"phong":le.type=Ee.nodeName,le.parameters=Ze(Ee);break}}return le}function Ze(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":le[Ee.nodeName]=ki(Ee);break;case"transparent":le[Ee.nodeName]={opaque:Ee.getAttribute("opaque"),data:ki(Ee)};break}}return le}function ki(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"color":le[Ee.nodeName]=s(Ee.textContent);break;case"float":le[Ee.nodeName]=parseFloat(Ee.textContent);break;case"texture":le[Ee.nodeName]={id:Ee.getAttribute("texture"),extra:hi(Ee)};break}}return le}function hi(he){for(var le={technique:{}},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"extra":Ri(Ee,le);break}}return le}function Ri(he,le){for(var pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique":Si(Ee,le);break}}}function Si(he,le){for(var pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":le.technique[Ee.nodeName]=parseFloat(Ee.textContent);break;case"wrapU":case"wrapV":Ee.textContent.toUpperCase()==="TRUE"?le.technique[Ee.nodeName]=1:Ee.textContent.toUpperCase()==="FALSE"?le.technique[Ee.nodeName]=0:le.technique[Ee.nodeName]=parseInt(Ee.textContent);break}}}function tr(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique":le.technique=Vi(Ee);break}}return le}function Vi(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"double_sided":le[Ee.nodeName]=parseInt(Ee.textContent);break}}return le}function Qe(he){return he}function Ce(he){return y(Ye.effects[he],Qe)}function yt(he){for(var le={name:he.getAttribute("name")},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"instance_effect":le.url=l(Ee.getAttribute("url"));break}}Ye.materials[he.getAttribute("id")]=le}function Ot(he){var le,pe=he.slice((he.lastIndexOf(".")-1>>>0)+2);switch(pe=pe.toLowerCase(),pe){case"tga":le=ue;break;default:le=W}return le}function Jt(he){var le=Ce(he.url),pe=le.profile.technique,be=le.profile.extra,Ee;switch(pe.type){case"phong":case"blinn":Ee=new THREE.MeshPhongMaterial;break;case"lambert":Ee=new THREE.MeshLambertMaterial;break;default:Ee=new THREE.MeshBasicMaterial;break}Ee.name=he.name;function st(yr){var dr=le.profile.samplers[yr.id],pr=null;if(dr!==void 0){var Hi=le.profile.surfaces[dr.source];pr=Xe(Hi.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),pr=Xe(yr.id);if(pr!==null){var Er=Ot(pr);if(Er!==void 0){var Sr=Er.load(pr),Fr=yr.extra;if(Fr!==void 0&&Fr.technique!==void 0&&c(Fr.technique)===!1){var jr=Fr.technique;Sr.wrapS=jr.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,Sr.wrapT=jr.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,Sr.offset.set(jr.offsetU||0,jr.offsetV||0),Sr.repeat.set(jr.repeatU||1,jr.repeatV||1)}else Sr.wrapS=THREE.RepeatWrapping,Sr.wrapT=THREE.RepeatWrapping;return Sr}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",pr),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",yr.id),null}var Ct=pe.parameters;for(var Ht in Ct){var ii=Ct[Ht];switch(Ht){case"diffuse":ii.color&&Ee.color.fromArray(ii.color),ii.texture&&(Ee.map=st(ii.texture));break;case"specular":ii.color&&Ee.specular&&Ee.specular.fromArray(ii.color),ii.texture&&(Ee.specularMap=st(ii.texture));break;case"bump":ii.texture&&(Ee.normalMap=st(ii.texture));break;case"ambient":ii.texture&&(Ee.lightMap=st(ii.texture));break;case"shininess":ii.float&&Ee.shininess&&(Ee.shininess=ii.float);break;case"emission":ii.color&&Ee.emissive&&Ee.emissive.fromArray(ii.color),ii.texture&&(Ee.emissiveMap=st(ii.texture));break}}var mi=Ct.transparent,Wt=Ct.transparency;if(Wt===void 0&&mi&&(Wt={float:1}),mi===void 0&&Wt&&(mi={opaque:"A_ONE",data:{color:[1,1,1,1]}}),mi&&Wt)if(mi.data.texture)Ee.transparent=!0;else{var Bi=mi.data.color;switch(mi.opaque){case"A_ONE":Ee.opacity=Bi[3]*Wt.float;break;case"RGB_ZERO":Ee.opacity=1-Bi[0]*Wt.float;break;case"A_ZERO":Ee.opacity=1-Bi[3]*Wt.float;break;case"RGB_ONE":Ee.opacity=Bi[0]*Wt.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',mi.opaque)}Ee.opacity<1&&(Ee.transparent=!0)}return be!==void 0&&be.technique!==void 0&&be.technique.double_sided===1&&(Ee.side=THREE.DoubleSide),Ee}function zt(he){return y(Ye.materials[he],Jt)}function xi(he){for(var le={name:he.getAttribute("name")},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"optics":le.optics=vt(Ee);break}}Ye.cameras[he.getAttribute("id")]=le}function vt(he){for(var le=0;le<he.childNodes.length;le++){var pe=he.childNodes[le];switch(pe.nodeName){case"technique_common":return ye(pe)}}return{}}function ye(he){for(var le={},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];switch(be.nodeName){case"perspective":case"orthographic":le.technique=be.nodeName,le.parameters=ve(be);break}}return le}function ve(he){for(var le={},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];switch(be.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":le[be.nodeName]=parseFloat(be.textContent);break}}return le}function Le(he){var le;switch(he.optics.technique){case"perspective":le=new THREE.PerspectiveCamera(he.optics.parameters.yfov,he.optics.parameters.aspect_ratio,he.optics.parameters.znear,he.optics.parameters.zfar);break;case"orthographic":var pe=he.optics.parameters.ymag,be=he.optics.parameters.xmag,Ee=he.optics.parameters.aspect_ratio;be=be===void 0?pe*Ee:be,pe=pe===void 0?be/Ee:pe,be*=.5,pe*=.5,le=new THREE.OrthographicCamera(-be,be,pe,-pe,he.optics.parameters.znear,he.optics.parameters.zfar);break;default:le=new THREE.PerspectiveCamera;break}return le.name=he.name,le}function Te(he){var le=Ye.cameras[he];return le!==void 0?y(le,Le):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",he),null)}function Fe(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique_common":le=Pe(Ee);break}}Ye.lights[he.getAttribute("id")]=le}function Pe(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"directional":case"point":case"spot":case"ambient":le.technique=Ee.nodeName,le.parameters=k(Ee)}}return le}function k(he){for(var le={},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"color":var st=s(Ee.textContent);le.color=new THREE.Color().fromArray(st);break;case"falloff_angle":le.falloffAngle=parseFloat(Ee.textContent);break;case"quadratic_attenuation":var Ct=parseFloat(Ee.textContent);le.distance=Ct?Math.sqrt(1/Ct):0;break}}return le}function Z(he){var le;switch(he.technique){case"directional":le=new THREE.DirectionalLight;break;case"point":le=new THREE.PointLight;break;case"spot":le=new THREE.SpotLight;break;case"ambient":le=new THREE.AmbientLight;break}return he.parameters.color&&le.color.copy(he.parameters.color),he.parameters.distance&&(le.distance=he.parameters.distance),le}function re(he){var le=Ye.lights[he];return le!==void 0?y(le,Z):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",he),null)}function Re(he){var le={name:he.getAttribute("name"),sources:{},vertices:{},primitives:[]},pe=i(he,"mesh")[0];if(pe!==void 0){for(var be=0;be<pe.childNodes.length;be++){var Ee=pe.childNodes[be];if(Ee.nodeType===1){var st=Ee.getAttribute("id");switch(Ee.nodeName){case"source":le.sources[st]=ce(Ee);break;case"vertices":le.vertices=Ue(Ee);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",Ee.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":le.primitives.push(je(Ee));break;default:console.log(Ee)}}}Ye.geometries[he.getAttribute("id")]=le}}function ce(he){for(var le={array:[],stride:3},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"float_array":le.array=s(be.textContent);break;case"Name_array":le.array=n(be.textContent);break;case"technique_common":var Ee=i(be,"accessor")[0];Ee!==void 0&&(le.stride=parseInt(Ee.getAttribute("stride")));break}}return le}function Ue(he){for(var le={},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];be.nodeType===1&&(le[be.getAttribute("semantic")]=l(be.getAttribute("source")))}return le}function je(he){for(var le={type:he.nodeName,material:he.getAttribute("material"),count:parseInt(he.getAttribute("count")),inputs:{},stride:0,hasUV:!1},pe=0,be=he.childNodes.length;pe<be;pe++){var Ee=he.childNodes[pe];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var st=l(Ee.getAttribute("source")),Ct=Ee.getAttribute("semantic"),Ht=parseInt(Ee.getAttribute("offset")),ii=parseInt(Ee.getAttribute("set")),mi=ii>0?Ct+ii:Ct;le.inputs[mi]={id:st,offset:Ht},le.stride=Math.max(le.stride,Ht+1),Ct==="TEXCOORD"&&(le.hasUV=!0);break;case"vcount":le.vcount=o(Ee.textContent);break;case"p":le.p=o(Ee.textContent);break}}return le}function dt(he){for(var le={},pe=0;pe<he.length;pe++){var be=he[pe];le[be.type]===void 0&&(le[be.type]=[]),le[be.type].push(be)}return le}function Bt(he){for(var le=0,pe=0,be=he.length;pe<be;pe++){var Ee=he[pe];Ee.hasUV===!0&&le++}le>0&&le<he.length&&(he.uvsNeedsFix=!0)}function bt(he){var le={},pe=he.sources,be=he.vertices,Ee=he.primitives;if(Ee.length===0)return{};var st=dt(Ee);for(var Ct in st){var Ht=st[Ct];Bt(Ht),le[Ct]=Ut(Ht,pe,be)}return le}function Ut(he,le,pe){for(var be={},Ee={array:[],stride:0},st={array:[],stride:0},Ct={array:[],stride:0},Ht={array:[],stride:0},ii={array:[],stride:0},mi={array:[],stride:4},Wt={array:[],stride:4},Bi=new THREE.BufferGeometry,yr=[],dr=0,pr=0;pr<he.length;pr++){var Hi=he[pr],Er=Hi.inputs,Sr=0;switch(Hi.type){case"lines":case"linestrips":Sr=Hi.count*2;break;case"triangles":Sr=Hi.count*3;break;case"polylist":for(var Fr=0;Fr<Hi.count;Fr++){var jr=Hi.vcount[Fr];switch(jr){case 3:Sr+=3;break;case 4:Sr+=6;break;default:Sr+=(jr-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",Hi.type)}Bi.addGroup(dr,Sr,pr),dr+=Sr,Hi.material&&yr.push(Hi.material);for(var vn in Er){var zr=Er[vn];switch(vn){case"VERTEX":for(var cs in pe){var Lr=pe[cs];switch(cs){case"POSITION":var gl=Ee.array.length;if(di(Hi,le[Lr],zr.offset,Ee.array),Ee.stride=le[Lr].stride,le.skinWeights&&le.skinIndices&&(di(Hi,le.skinIndices,zr.offset,mi.array),di(Hi,le.skinWeights,zr.offset,Wt.array)),Hi.hasUV===!1&&he.uvsNeedsFix===!0)for(var Sr=(Ee.array.length-gl)/Ee.stride,qo=0;qo<Sr;qo++)Ct.array.push(0,0);break;case"NORMAL":di(Hi,le[Lr],zr.offset,st.array),st.stride=le[Lr].stride;break;case"COLOR":di(Hi,le[Lr],zr.offset,ii.array),ii.stride=le[Lr].stride;break;case"TEXCOORD":di(Hi,le[Lr],zr.offset,Ct.array),Ct.stride=le[Lr].stride;break;case"TEXCOORD1":di(Hi,le[Lr],zr.offset,Ht.array),Ct.stride=le[Lr].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',cs)}}break;case"NORMAL":di(Hi,le[zr.id],zr.offset,st.array),st.stride=le[zr.id].stride;break;case"COLOR":di(Hi,le[zr.id],zr.offset,ii.array),ii.stride=le[zr.id].stride;break;case"TEXCOORD":di(Hi,le[zr.id],zr.offset,Ct.array),Ct.stride=le[zr.id].stride;break;case"TEXCOORD1":di(Hi,le[zr.id],zr.offset,Ht.array),Ht.stride=le[zr.id].stride;break}}}return Ee.array.length>0&&Bi.addAttribute("position",new THREE.Float32BufferAttribute(Ee.array,Ee.stride)),st.array.length>0&&Bi.addAttribute("normal",new THREE.Float32BufferAttribute(st.array,st.stride)),ii.array.length>0&&Bi.addAttribute("color",new THREE.Float32BufferAttribute(ii.array,ii.stride)),Ct.array.length>0&&Bi.addAttribute("uv",new THREE.Float32BufferAttribute(Ct.array,Ct.stride)),Ht.array.length>0&&Bi.addAttribute("uv2",new THREE.Float32BufferAttribute(Ht.array,Ht.stride)),mi.array.length>0&&Bi.addAttribute("skinIndex",new THREE.Float32BufferAttribute(mi.array,mi.stride)),Wt.array.length>0&&Bi.addAttribute("skinWeight",new THREE.Float32BufferAttribute(Wt.array,Wt.stride)),be.data=Bi,be.type=he[0].type,be.materialKeys=yr,be}function di(he,le,pe,be){var Ee=he.p,st=he.stride,Ct=he.vcount;function Ht(vn){for(var zr=Ee[vn+pe]*mi,cs=zr+mi;zr<cs;zr++)be.push(ii[zr])}var ii=le.array,mi=le.stride;if(he.vcount!==void 0)for(var Wt=0,Bi=0,yr=Ct.length;Bi<yr;Bi++){var dr=Ct[Bi];if(dr===4){var pr=Wt+st*0,Hi=Wt+st*1,Er=Wt+st*2,Sr=Wt+st*3;Ht(pr),Ht(Hi),Ht(Sr),Ht(Hi),Ht(Er),Ht(Sr)}else if(dr===3){var pr=Wt+st*0,Hi=Wt+st*1,Er=Wt+st*2;Ht(pr),Ht(Hi),Ht(Er)}else if(dr>4)for(var Fr=1,jr=dr-2;Fr<=jr;Fr++){var pr=Wt+st*0,Hi=Wt+st*Fr,Er=Wt+st*(Fr+1);Ht(pr),Ht(Hi),Ht(Er)}Wt+=st*dr}else for(var Bi=0,yr=Ee.length;Bi<yr;Bi+=st)Ht(Bi)}function br(he){return y(Ye.geometries[he],bt)}function Pi(he){for(var le={name:he.getAttribute("name")||"",joints:{},links:[]},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"technique_common":tn(be,le);break}}Ye.kinematicsModels[he.getAttribute("id")]=le}function fn(he){return he.build!==void 0?he.build:he}function Pr(he){return y(Ye.kinematicsModels[he],fn)}function tn(he,le){for(var pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"joint":le.joints[be.getAttribute("sid")]=gs(be);break;case"link":le.links.push(Rs(be));break}}}function gs(he){for(var le,pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"prismatic":case"revolute":le=mn(be);break}}return le}function mn(he,le){for(var le={sid:he.getAttribute("sid"),name:he.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:he.nodeName,static:!1,zeroPosition:0,middlePosition:0},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"axis":var Ee=s(be.textContent);le.axis.fromArray(Ee);break;case"limits":var st=be.getElementsByTagName("max")[0],Ct=be.getElementsByTagName("min")[0];le.limits.max=parseFloat(st.textContent),le.limits.min=parseFloat(Ct.textContent);break}}return le.limits.min>=le.limits.max&&(le.static=!0),le.middlePosition=(le.limits.min+le.limits.max)/2,le}function Rs(he){for(var le={sid:he.getAttribute("sid"),name:he.getAttribute("name")||"",attachments:[],transforms:[]},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"attachment_full":le.attachments.push($n(be));break;case"matrix":case"translate":case"rotate":le.transforms.push(As(be));break}}return le}function $n(he){for(var le={joint:he.getAttribute("joint").split("/").pop(),transforms:[],links:[]},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"link":le.links.push(Rs(be));break;case"matrix":case"translate":case"rotate":le.transforms.push(As(be));break}}return le}function As(he){var le={type:he.nodeName},pe=s(he.textContent);switch(le.type){case"matrix":le.obj=new THREE.Matrix4,le.obj.fromArray(pe).transpose();break;case"translate":le.obj=new THREE.Vector3,le.obj.fromArray(pe);break;case"rotate":le.obj=new THREE.Vector3,le.obj.fromArray(pe),le.angle=THREE.MathUtils.degToRad(pe[3]);break}return le}function me(he){for(var le={name:he.getAttribute("name")||"",rigidBodies:{}},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"rigid_body":le.rigidBodies[be.getAttribute("name")]={},ct(be,le.rigidBodies[be.getAttribute("name")]);break}}Ye.physicsModels[he.getAttribute("id")]=le}function ct(he,le){for(var pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"technique_common":St(be,le);break}}}function St(he,le){for(var pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"inertia":le.inertia=s(be.textContent);break;case"mass":le.mass=s(be.textContent)[0];break}}}function Xt(he){for(var le={bindJointAxis:[]},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"bind_joint_axis":le.bindJointAxis.push(Ii(be));break}}Ye.kinematicsScenes[l(he.getAttribute("url"))]=le}function Ii(he){for(var le={target:he.getAttribute("target").split("/").pop()},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"axis":var Ee=be.getElementsByTagName("param")[0];le.axis=Ee.textContent;var st=le.axis.split("inst_").pop().split("axis")[0];le.jointIndex=st.substr(0,st.length-1);break}}return le}function sr(he){return he.build!==void 0?he.build:he}function Ni(he){return y(Ye.kinematicsScenes[he],sr)}function Oi(){var he=Object.keys(Ye.kinematicsModels)[0],le=Object.keys(Ye.kinematicsScenes)[0],pe=Object.keys(Ye.visualScenes)[0];if(he===void 0||le===void 0)return;for(var be=Pr(he),Ee=Ni(le),st=vi(pe),Ct=Ee.bindJointAxis,Ht={},ii=0,mi=Ct.length;ii<mi;ii++){var Wt=Ct[ii],Bi=ar.querySelector('[sid="'+Wt.target+'"]');if(Bi){var yr=Bi.parentElement;dr(Wt.jointIndex,yr)}}function dr(Hi,Er){var Sr=Er.getAttribute("name"),Fr=be.joints[Hi];st.traverse(function(jr){jr.name===Sr&&(Ht[Hi]={object:jr,transforms:Be(Er),joint:Fr,position:Fr.zeroPosition})})}var pr=new THREE.Matrix4;Se={joints:be&&be.joints,getJointValue:function(Hi){var Er=Ht[Hi];if(Er)return Er.position;console.warn("THREE.ColladaLoader: Joint "+Hi+" doesn't exist.")},setJointValue:function(Hi,Er){var Sr=Ht[Hi];if(Sr){var Fr=Sr.joint;if(Er>Fr.limits.max||Er<Fr.limits.min)console.warn("THREE.ColladaLoader: Joint "+Hi+" value "+Er+" outside of limits (min: "+Fr.limits.min+", max: "+Fr.limits.max+").");else if(Fr.static)console.warn("THREE.ColladaLoader: Joint "+Hi+" is static.");else{var jr=Sr.object,vn=Fr.axis,zr=Sr.transforms;ge.identity();for(var cs=0;cs<zr.length;cs++){var Lr=zr[cs];if(Lr.sid&&Lr.sid.indexOf(Hi)!==-1)switch(Fr.type){case"revolute":ge.multiply(pr.makeRotationAxis(vn,THREE.MathUtils.degToRad(Er)));break;case"prismatic":ge.multiply(pr.makeTranslation(vn.x*Er,vn.y*Er,vn.z*Er));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+Fr.type);break}else switch(Lr.type){case"matrix":ge.multiply(Lr.obj);break;case"translate":ge.multiply(pr.makeTranslation(Lr.obj.x,Lr.obj.y,Lr.obj.z));break;case"scale":ge.scale(Lr.obj);break;case"rotate":ge.multiply(pr.makeRotationAxis(Lr.obj,Lr.angle));break}}jr.matrix.copy(ge),jr.matrix.decompose(jr.position,jr.quaternion,jr.scale),Ht[Hi].position=Er}}else console.log("THREE.ColladaLoader: "+Hi+" does not exist.")}}}function Be(he){for(var le=[],pe=ar.querySelector('[id="'+he.id+'"]'),be=0;be<pe.childNodes.length;be++){var Ee=pe.childNodes[be];if(Ee.nodeType===1)switch(Ee.nodeName){case"matrix":var Ct=s(Ee.textContent),st=new THREE.Matrix4().fromArray(Ct).transpose();le.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:st});break;case"translate":case"scale":var Ct=s(Ee.textContent),Ht=new THREE.Vector3().fromArray(Ct);le.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:Ht});break;case"rotate":var Ct=s(Ee.textContent),Ht=new THREE.Vector3().fromArray(Ct),ii=THREE.MathUtils.degToRad(Ct[3]);le.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:Ht,angle:ii});break}}return le}function se(he){for(var le=he.getElementsByTagName("node"),pe=0;pe<le.length;pe++){var be=le[pe];be.hasAttribute("id")===!1&&be.setAttribute("id",u())}}var ge=new THREE.Matrix4,Ne=new THREE.Vector3;function ke(he){for(var le={name:he.getAttribute("name")||"",type:he.getAttribute("type"),id:he.getAttribute("id"),sid:he.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];if(be.nodeType===1)switch(be.nodeName){case"node":le.nodes.push(be.getAttribute("id")),ke(be);break;case"instance_camera":le.instanceCameras.push(l(be.getAttribute("url")));break;case"instance_controller":le.instanceControllers.push(Ke(be));break;case"instance_light":le.instanceLights.push(l(be.getAttribute("url")));break;case"instance_geometry":le.instanceGeometries.push(Ke(be));break;case"instance_node":le.instanceNodes.push(l(be.getAttribute("url")));break;case"matrix":var st=s(be.textContent);le.matrix.multiply(ge.fromArray(st).transpose()),le.transforms[be.getAttribute("sid")]=be.nodeName;break;case"translate":var st=s(be.textContent);Ne.fromArray(st),le.matrix.multiply(ge.makeTranslation(Ne.x,Ne.y,Ne.z)),le.transforms[be.getAttribute("sid")]=be.nodeName;break;case"rotate":var st=s(be.textContent),Ee=THREE.MathUtils.degToRad(st[3]);le.matrix.multiply(ge.makeRotationAxis(Ne.fromArray(st),Ee)),le.transforms[be.getAttribute("sid")]=be.nodeName;break;case"scale":var st=s(be.textContent);le.matrix.scale(Ne.fromArray(st)),le.transforms[be.getAttribute("sid")]=be.nodeName;break;case"extra":break;default:console.log(be)}}return bi(le.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",le.id):Ye.nodes[le.id]=le,le}function Ke(he){for(var le={id:l(he.getAttribute("url")),materials:{},skeletons:[]},pe=0;pe<he.childNodes.length;pe++){var be=he.childNodes[pe];switch(be.nodeName){case"bind_material":for(var Ee=be.getElementsByTagName("instance_material"),st=0;st<Ee.length;st++){var Ct=Ee[st],Ht=Ct.getAttribute("symbol"),ii=Ct.getAttribute("target");le.materials[Ht]=l(ii)}break;case"skeleton":le.skeletons.push(l(be.textContent));break}}return le}function ot(he,le){var pe=[],be=[],Ee,st,Ct;for(Ee=0;Ee<he.length;Ee++){var Ht=he[Ee],ii;if(bi(Ht))ii=Fi(Ht),wt(ii,le,pe);else if(Ji(Ht))for(var mi=Ye.visualScenes[Ht],Wt=mi.children,st=0;st<Wt.length;st++){var Bi=Wt[st];if(Bi.type==="JOINT"){var ii=Fi(Bi.id);wt(ii,le,pe)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",Ht)}for(Ee=0;Ee<le.length;Ee++)for(st=0;st<pe.length;st++)if(Ct=pe[st],Ct.bone.name===le[Ee].name){be[Ee]=Ct,Ct.processed=!0;break}for(Ee=0;Ee<pe.length;Ee++)Ct=pe[Ee],Ct.processed===!1&&(be.push(Ct),Ct.processed=!0);var yr=[],dr=[];for(Ee=0;Ee<be.length;Ee++)Ct=be[Ee],yr.push(Ct.bone),dr.push(Ct.boneInverse);return new THREE.Skeleton(yr,dr)}function wt(he,le,pe){he.traverse(function(be){if(be.isBone===!0){for(var Ee,st=0;st<le.length;st++){var Ct=le[st];if(Ct.name===be.name){Ee=Ct.boneInverse;break}}Ee===void 0&&(Ee=new THREE.Matrix4),pe.push({bone:be,boneInverse:Ee,processed:!1})}})}function qt(he){for(var le=[],pe=he.matrix,be=he.nodes,Ee=he.type,st=he.instanceCameras,Ct=he.instanceControllers,Ht=he.instanceLights,ii=he.instanceGeometries,mi=he.instanceNodes,Wt=0,Bi=be.length;Wt<Bi;Wt++)le.push(Fi(be[Wt]));for(var Wt=0,Bi=st.length;Wt<Bi;Wt++){var yr=Te(st[Wt]);yr!==null&&le.push(yr.clone())}for(var Wt=0,Bi=Ct.length;Wt<Bi;Wt++)for(var dr=Ct[Wt],pr=de(dr.id),Hi=br(pr.id),Er=ti(Hi,dr.materials),Sr=dr.skeletons,Fr=pr.skin.joints,jr=ot(Sr,Fr),vn=0,zr=Er.length;vn<zr;vn++){var Lr=Er[vn];Lr.isSkinnedMesh&&(Lr.bind(jr,pr.skin.bindMatrix),Lr.normalizeSkinWeights()),le.push(Lr)}for(var Wt=0,Bi=Ht.length;Wt<Bi;Wt++){var cs=re(Ht[Wt]);cs!==null&&le.push(cs.clone())}for(var Wt=0,Bi=ii.length;Wt<Bi;Wt++)for(var dr=ii[Wt],Hi=br(dr.id),Er=ti(Hi,dr.materials),vn=0,zr=Er.length;vn<zr;vn++)le.push(Er[vn]);for(var Wt=0,Bi=mi.length;Wt<Bi;Wt++)le.push(Fi(mi[Wt]).clone());var Lr;if(be.length===0&&le.length===1)Lr=le[0];else{Lr=Ee==="JOINT"?new THREE.Bone:new THREE.Group;for(var Wt=0;Wt<le.length;Wt++)Lr.add(le[Wt])}return Lr.name===""&&(Lr.name=Ee==="JOINT"?he.sid:he.name),Lr.matrix.copy(pe),Lr.matrix.decompose(Lr.position,Lr.quaternion,Lr.scale),Lr}var Kt=new THREE.MeshBasicMaterial({color:16711935});function Rt(he,le){for(var pe=[],be=0,Ee=he.length;be<Ee;be++){var st=le[he[be]];st===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",he[be]),pe.push(Kt)):pe.push(zt(st))}return pe}function ti(he,le){var pe=[];for(var be in he){var Ee=he[be],st=Rt(Ee.materialKeys,le);st.length===0&&(be==="lines"||be==="linestrips"?st.push(new THREE.LineBasicMaterial):st.push(new THREE.MeshPhongMaterial));var Ct=Ee.data.attributes.skinIndex!==void 0;if(Ct)for(var Ht=0,ii=st.length;Ht<ii;Ht++)st[Ht].skinning=!0;var mi=st.length===1?st[0]:st,Wt;switch(be){case"lines":Wt=new THREE.LineSegments(Ee.data,mi);break;case"linestrips":Wt=new THREE.Line(Ee.data,mi);break;case"triangles":case"polylist":Ct?Wt=new THREE.SkinnedMesh(Ee.data,mi):Wt=new THREE.Mesh(Ee.data,mi);break}pe.push(Wt)}return pe}function bi(he){return Ye.nodes[he]!==void 0}function Fi(he){return y(Ye.nodes[he],qt)}function Cr(he){var le={name:he.getAttribute("name"),children:[]};se(he);for(var pe=i(he,"node"),be=0;be<pe.length;be++)le.children.push(ke(pe[be]));Ye.visualScenes[he.getAttribute("id")]=le}function ur(he){var le=new THREE.Group;le.name=he.name;for(var pe=he.children,be=0;be<pe.length;be++){var Ee=pe[be];le.add(Fi(Ee.id))}return le}function Ji(he){return Ye.visualScenes[he]!==void 0}function vi(he){return y(Ye.visualScenes[he],ur)}function Tn(he){var le=i(he,"instance_visual_scene")[0];return vi(l(le.getAttribute("url")))}function qn(){var he=Ye.clips;if(c(he)===!0){if(c(Ye.animations)===!1){var le=[];for(var pe in Ye.animations)for(var be=w(pe),Ee=0,st=be.length;Ee<st;Ee++)le.push(be[Ee]);Ae.push(new THREE.AnimationClip("default",-1,le))}}else for(var pe in he)Ae.push(G(pe))}if(r.length===0)return{scene:new THREE.Scene};var Mi=new DOMParser().parseFromString(r,"application/xml"),ar=i(Mi,"COLLADA")[0],un=ar.getAttribute("version");console.log("THREE.ColladaLoader: File version",un);var Qr=d(i(ar,"asset")[0]),W=new THREE.TextureLoader(this.manager);W.setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);var ue;THREE.TGALoader&&(ue=new THREE.TGALoader(this.manager),ue.setPath(this.resourcePath||e));var Ae=[],Se={},We=0,Ye={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};m(ar,"library_animations","animation",x),m(ar,"library_animation_clips","animation_clip",$),m(ar,"library_controllers","controller",j),m(ar,"library_images","image",Ie),m(ar,"library_effects","effect",$e),m(ar,"library_materials","material",yt),m(ar,"library_cameras","camera",xi),m(ar,"library_lights","light",Fe),m(ar,"library_geometries","geometry",Re),m(ar,"library_nodes","node",ke),m(ar,"library_visual_scenes","visual_scene",Cr),m(ar,"library_kinematics_models","kinematics_model",Pi),m(ar,"library_physics_models","physics_model",me),m(ar,"scene","instance_kinematics_scene",Xt),g(Ye.animations,T),g(Ye.clips,Q),g(Ye.controllers,xe),g(Ye.images,Ge),g(Ye.effects,Qe),g(Ye.materials,Jt),g(Ye.cameras,Le),g(Ye.lights,Z),g(Ye.geometries,bt),g(Ye.visualScenes,ur),qn(),Oi();var ft=Tn(i(ar,"scene")[0]);return Qr.upAxis==="Z_UP"&&ft.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),ft.scale.multiplyScalar(Qr.unit),{animations:Ae,kinematics:Se,library:Ye,scene:ft}}},THREE.ColladaLoader=fQ,AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var r=this,e=this.el,i=this.data,n=this.el.sceneEl.systems.renderer;i&&(this.remove(),this.loader.load(i,function(s){r.model=s.scene,r.model.traverse(function(o){if(o.isMesh){var l=o.material;l.color&&n.applyColorCorrection(l.color),l.map&&n.applyColorCorrection(l.map),l.emissive&&n.applyColorCorrection(l.emissive),l.emissiveMap&&n.applyColorCorrection(l.emissiveMap)}}),e.setObject3D("mesh",r.model),e.emit("model-loaded",{format:"collada",model:r.model})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const cD="164",f2=0,mQ=1,uD=1,hD=100,dD=204,pD=205,fD=3,m2=0,mD="attached",gQ="detached",gD=300,AQ=303,Zv=1e3,Bf=1001,AD=1002,$v=1003,yQ=1006,vQ=1008,xQ=1009,bQ=1014,yD=1015,_Q=1020,vD=1023,g2=1026,xD=1027,ex=2300,tx=2301,A2=2302,bD=2400,_D=2401,ED=2402,EQ=2500,wD=0,CD="",El="srgb",y2="srgb-linear",wQ="display-p3",SD="display-p3-linear",v2="linear",TD="srgb",MD="rec709",RD="p3",Nf=7680,ID=519,CQ=515,BD=35044,Wd=2e3,x2=2001;let ix=class{addEventListener(r,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[r]===void 0&&(i[r]=[]),i[r].indexOf(e)===-1&&i[r].push(e)}hasEventListener(r,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[r]!==void 0&&i[r].indexOf(e)!==-1}removeEventListener(r,e){if(this._listeners===void 0)return;const i=this._listeners[r];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const e=this._listeners[r.type];if(e!==void 0){r.target=this;const i=e.slice(0);for(let n=0,s=i.length;n<s;n++)i[n].call(this,r);r.target=null}}};const Wa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ND=1234567;const P0=Math.PI/180,F0=180/Math.PI;function wh(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Wa[r&255]+Wa[r>>8&255]+Wa[r>>16&255]+Wa[r>>24&255]+"-"+Wa[e&255]+Wa[e>>8&255]+"-"+Wa[e>>16&15|64]+Wa[e>>24&255]+"-"+Wa[i&63|128]+Wa[i>>8&255]+"-"+Wa[i>>16&255]+Wa[i>>24&255]+Wa[n&255]+Wa[n>>8&255]+Wa[n>>16&255]+Wa[n>>24&255]).toLowerCase()}function Ia(r,e,i){return Math.max(e,Math.min(i,r))}function b2(r,e){return(r%e+e)%e}function SQ(r,e,i,n,s){return n+(r-e)*(s-n)/(i-e)}function TQ(r,e,i){return r!==e?(i-r)/(e-r):0}function k0(r,e,i){return(1-i)*r+i*e}function MQ(r,e,i,n){return k0(r,e,1-Math.exp(-i*n))}function RQ(r,e=1){return e-Math.abs(b2(r,e*2)-e)}function IQ(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*(3-2*r))}function BQ(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*r*(r*(r*6-15)+10))}function NQ(r,e){return r+Math.floor(Math.random()*(e-r+1))}function LQ(r,e){return r+Math.random()*(e-r)}function DQ(r){return r*(.5-Math.random())}function OQ(r){r!==void 0&&(ND=r);let e=ND+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function PQ(r){return r*P0}function FQ(r){return r*F0}function kQ(r){return(r&r-1)===0&&r!==0}function UQ(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function zQ(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function jQ(r,e,i,n,s){const o=Math.cos,l=Math.sin,u=o(i/2),c=l(i/2),d=o((e+n)/2),p=l((e+n)/2),f=o((e-n)/2),m=l((e-n)/2),g=o((n-e)/2),y=l((n-e)/2);switch(s){case"XYX":r.set(u*p,c*f,c*m,u*d);break;case"YZY":r.set(c*m,u*p,c*f,u*d);break;case"ZXZ":r.set(c*f,c*m,u*p,u*d);break;case"XZX":r.set(u*p,c*y,c*g,u*d);break;case"YXY":r.set(c*g,u*p,c*y,u*d);break;case"ZYZ":r.set(c*y,c*g,u*p,u*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Lf(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function oo(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const lo={DEG2RAD:P0,RAD2DEG:F0,generateUUID:wh,clamp:Ia,euclideanModulo:b2,mapLinear:SQ,inverseLerp:TQ,lerp:k0,damp:MQ,pingpong:RQ,smoothstep:IQ,smootherstep:BQ,randInt:NQ,randFloat:LQ,randFloatSpread:DQ,seededRandom:OQ,degToRad:PQ,radToDeg:FQ,isPowerOfTwo:kQ,ceilPowerOfTwo:UQ,floorPowerOfTwo:zQ,setQuaternionFromProperEuler:jQ,normalize:oo,denormalize:Lf};let zs=class $V{constructor(e=0,i=0){$V.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Ia(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),s=Math.sin(i),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*s+e.x,this.y=o*s+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Ch=class eG{constructor(e,i,n,s,o,l,u,c,d){eG.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,d)}set(e,i,n,s,o,l,u,c,d){const p=this.elements;return p[0]=e,p[1]=s,p[2]=u,p[3]=i,p[4]=o,p[5]=c,p[6]=n,p[7]=l,p[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[3],c=n[6],d=n[1],p=n[4],f=n[7],m=n[2],g=n[5],y=n[8],x=s[0],v=s[3],_=s[6],T=s[1],w=s[4],S=s[7],R=s[2],B=s[5],I=s[8];return o[0]=l*x+u*T+c*R,o[3]=l*v+u*w+c*B,o[6]=l*_+u*S+c*I,o[1]=d*x+p*T+f*R,o[4]=d*v+p*w+f*B,o[7]=d*_+p*S+f*I,o[2]=m*x+g*T+y*R,o[5]=m*v+g*w+y*B,o[8]=m*_+g*S+y*I,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8];return i*l*p-i*u*d-n*o*p+n*u*c+s*o*d-s*l*c}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8],f=p*l-u*d,m=u*c-p*o,g=d*o-l*c,y=i*f+n*m+s*g;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/y;return e[0]=f*x,e[1]=(s*d-p*n)*x,e[2]=(u*n-s*l)*x,e[3]=m*x,e[4]=(p*i-s*c)*x,e[5]=(s*o-u*i)*x,e[6]=g*x,e[7]=(n*c-d*i)*x,e[8]=(l*i-n*o)*x,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,s,o,l,u){const c=Math.cos(o),d=Math.sin(o);return this.set(n*c,n*d,-n*(c*l+d*u)+l+e,-s*d,s*c,-s*(-d*l+c*u)+u+i,0,0,1),this}scale(e,i){return this.premultiply(_2.makeScale(e,i)),this}rotate(e){return this.premultiply(_2.makeRotation(-e)),this}translate(e,i){return this.premultiply(_2.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const _2=new Ch;function VQ(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function E2(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}const LD={};function GQ(r){r in LD||(LD[r]=!0,console.warn(r))}const DD=new Ch().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),OD=new Ch().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),rx={[y2]:{transfer:v2,primaries:MD,toReference:r=>r,fromReference:r=>r},[El]:{transfer:TD,primaries:MD,toReference:r=>r.convertSRGBToLinear(),fromReference:r=>r.convertLinearToSRGB()},[SD]:{transfer:v2,primaries:RD,toReference:r=>r.applyMatrix3(OD),fromReference:r=>r.applyMatrix3(DD)},[wQ]:{transfer:TD,primaries:RD,toReference:r=>r.convertSRGBToLinear().applyMatrix3(OD),fromReference:r=>r.applyMatrix3(DD).convertLinearToSRGB()}},HQ=new Set([y2,SD]),Hl={enabled:!0,_workingColorSpace:y2,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(r){if(!HQ.has(r))throw new Error(`Unsupported working color space, "${r}".`);this._workingColorSpace=r},convert:function(r,e,i){if(this.enabled===!1||e===i||!e||!i)return r;const n=rx[e].toReference,s=rx[i].fromReference;return s(n(r))},fromWorkingColorSpace:function(r,e){return this.convert(r,this._workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this._workingColorSpace)},getPrimaries:function(r){return rx[r].primaries},getTransfer:function(r){return r===CD?v2:rx[r].transfer}};function Df(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function w2(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Of,WQ=class{static getDataURL(r){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let e;if(r instanceof HTMLCanvasElement)e=r;else{Of===void 0&&(Of=E2("canvas")),Of.width=r.width,Of.height=r.height;const i=Of.getContext("2d");r instanceof ImageData?i.putImageData(r,0,0):i.drawImage(r,0,0,r.width,r.height),e=Of}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const e=E2("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height);const n=i.getImageData(0,0,r.width,r.height),s=n.data;for(let o=0;o<s.length;o++)s[o]=Df(s[o]/255)*255;return i.putImageData(n,0,0),e}else if(r.data){const e=r.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Df(e[i]/255)*255):e[i]=Df(e[i]);return{data:e,width:r.width,height:r.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}},QQ=0,qQ=class{constructor(r=null){this.isSource=!0,Object.defineProperty(this,"id",{value:QQ++}),this.uuid=wh(),this.data=r,this.dataReady=!0,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const e=r===void 0||typeof r=="string";if(!e&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let o=0,l=n.length;o<l;o++)n[o].isDataTexture?s.push(C2(n[o].image)):s.push(C2(n[o]))}else s=C2(n);i.url=s}return e||(r.images[this.uuid]=i),i}};function C2(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?WQ.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let XQ=0,su=class Bw extends ix{constructor(e=Bw.DEFAULT_IMAGE,i=Bw.DEFAULT_MAPPING,n=Bf,s=Bf,o=yQ,l=vQ,u=vD,c=xQ,d=Bw.DEFAULT_ANISOTROPY,p=CD){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:XQ++}),this.uuid=wh(),this.name="",this.source=new qQ(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=l,this.anisotropy=d,this.format=u,this.internalFormat=null,this.type=c,this.offset=new zs(0,0),this.repeat=new zs(1,1),this.center=new zs(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ch,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==gD)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Zv:e.x=e.x-Math.floor(e.x);break;case Bf:e.x=e.x<0?0:1;break;case AD:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Zv:e.y=e.y-Math.floor(e.y);break;case Bf:e.y=e.y<0?0:1;break;case AD:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};su.DEFAULT_IMAGE=null,su.DEFAULT_MAPPING=gD,su.DEFAULT_ANISOTROPY=1;let No=class tG{constructor(e=0,i=0,n=0,s=1){tG.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,s){return this.x=e,this.y=i,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*i+l[4]*n+l[8]*s+l[12]*o,this.y=l[1]*i+l[5]*n+l[9]*s+l[13]*o,this.z=l[2]*i+l[6]*n+l[10]*s+l[14]*o,this.w=l[3]*i+l[7]*n+l[11]*s+l[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,s,o;const l=e.elements,u=l[0],c=l[4],d=l[8],p=l[1],f=l[5],m=l[9],g=l[2],y=l[6],x=l[10];if(Math.abs(c-p)<.01&&Math.abs(d-g)<.01&&Math.abs(m-y)<.01){if(Math.abs(c+p)<.1&&Math.abs(d+g)<.1&&Math.abs(m+y)<.1&&Math.abs(u+f+x-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,T=(f+1)/2,w=(x+1)/2,S=(c+p)/4,R=(d+g)/4,B=(m+y)/4;return _>T&&_>w?_<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(_),s=S/n,o=R/n):T>w?T<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(T),n=S/s,o=B/s):w<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(w),n=R/o,s=B/o),this.set(n,s,o,i),this}let v=Math.sqrt((y-m)*(y-m)+(d-g)*(d-g)+(p-c)*(p-c));return Math.abs(v)<.001&&(v=1),this.x=(y-m)/v,this.y=(d-g)/v,this.z=(p-c)/v,this.w=Math.acos((u+f+x-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Lo=class{constructor(r=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=r,this._y=e,this._z=i,this._w=n}static slerpFlat(r,e,i,n,s,o,l){let u=i[n+0],c=i[n+1],d=i[n+2],p=i[n+3];const f=s[o+0],m=s[o+1],g=s[o+2],y=s[o+3];if(l===0){r[e+0]=u,r[e+1]=c,r[e+2]=d,r[e+3]=p;return}if(l===1){r[e+0]=f,r[e+1]=m,r[e+2]=g,r[e+3]=y;return}if(p!==y||u!==f||c!==m||d!==g){let x=1-l;const v=u*f+c*m+d*g+p*y,_=v>=0?1:-1,T=1-v*v;if(T>Number.EPSILON){const S=Math.sqrt(T),R=Math.atan2(S,v*_);x=Math.sin(x*R)/S,l=Math.sin(l*R)/S}const w=l*_;if(u=u*x+f*w,c=c*x+m*w,d=d*x+g*w,p=p*x+y*w,x===1-l){const S=1/Math.sqrt(u*u+c*c+d*d+p*p);u*=S,c*=S,d*=S,p*=S}}r[e]=u,r[e+1]=c,r[e+2]=d,r[e+3]=p}static multiplyQuaternionsFlat(r,e,i,n,s,o){const l=i[n],u=i[n+1],c=i[n+2],d=i[n+3],p=s[o],f=s[o+1],m=s[o+2],g=s[o+3];return r[e]=l*g+d*p+u*m-c*f,r[e+1]=u*g+d*f+c*p-l*m,r[e+2]=c*g+d*m+l*f-u*p,r[e+3]=d*g-l*p-u*f-c*m,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,e,i,n){return this._x=r,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,e=!0){const i=r._x,n=r._y,s=r._z,o=r._order,l=Math.cos,u=Math.sin,c=l(i/2),d=l(n/2),p=l(s/2),f=u(i/2),m=u(n/2),g=u(s/2);switch(o){case"XYZ":this._x=f*d*p+c*m*g,this._y=c*m*p-f*d*g,this._z=c*d*g+f*m*p,this._w=c*d*p-f*m*g;break;case"YXZ":this._x=f*d*p+c*m*g,this._y=c*m*p-f*d*g,this._z=c*d*g-f*m*p,this._w=c*d*p+f*m*g;break;case"ZXY":this._x=f*d*p-c*m*g,this._y=c*m*p+f*d*g,this._z=c*d*g+f*m*p,this._w=c*d*p-f*m*g;break;case"ZYX":this._x=f*d*p-c*m*g,this._y=c*m*p+f*d*g,this._z=c*d*g-f*m*p,this._w=c*d*p+f*m*g;break;case"YZX":this._x=f*d*p+c*m*g,this._y=c*m*p+f*d*g,this._z=c*d*g-f*m*p,this._w=c*d*p-f*m*g;break;case"XZY":this._x=f*d*p-c*m*g,this._y=c*m*p-f*d*g,this._z=c*d*g+f*m*p,this._w=c*d*p+f*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(r,e){const i=e/2,n=Math.sin(i);return this._x=r.x*n,this._y=r.y*n,this._z=r.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(r){const e=r.elements,i=e[0],n=e[4],s=e[8],o=e[1],l=e[5],u=e[9],c=e[2],d=e[6],p=e[10],f=i+l+p;if(f>0){const m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(d-u)*m,this._y=(s-c)*m,this._z=(o-n)*m}else if(i>l&&i>p){const m=2*Math.sqrt(1+i-l-p);this._w=(d-u)/m,this._x=.25*m,this._y=(n+o)/m,this._z=(s+c)/m}else if(l>p){const m=2*Math.sqrt(1+l-i-p);this._w=(s-c)/m,this._x=(n+o)/m,this._y=.25*m,this._z=(u+d)/m}else{const m=2*Math.sqrt(1+p-i-l);this._w=(o-n)/m,this._x=(s+c)/m,this._y=(u+d)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(r,e){let i=r.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=i):(this._x=0,this._y=-r.z,this._z=r.y,this._w=i)):(this._x=r.y*e.z-r.z*e.y,this._y=r.z*e.x-r.x*e.z,this._z=r.x*e.y-r.y*e.x,this._w=i),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(Ia(this.dot(r),-1,1)))}rotateTowards(r,e){const i=this.angleTo(r);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(r,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,e){const i=r._x,n=r._y,s=r._z,o=r._w,l=e._x,u=e._y,c=e._z,d=e._w;return this._x=i*d+o*l+n*c-s*u,this._y=n*d+o*u+s*l-i*c,this._z=s*d+o*c+i*u-n*l,this._w=o*d-i*l-n*u-s*c,this._onChangeCallback(),this}slerp(r,e){if(e===0)return this;if(e===1)return this.copy(r);const i=this._x,n=this._y,s=this._z,o=this._w;let l=o*r._w+i*r._x+n*r._y+s*r._z;if(l<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,l=-l):this.copy(r),l>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const u=1-l*l;if(u<=Number.EPSILON){const m=1-e;return this._w=m*o+e*this._w,this._x=m*i+e*this._x,this._y=m*n+e*this._y,this._z=m*s+e*this._z,this.normalize(),this}const c=Math.sqrt(u),d=Math.atan2(c,l),p=Math.sin((1-e)*d)/c,f=Math.sin(e*d)/c;return this._w=o*p+this._w*f,this._x=i*p+this._x*f,this._y=n*p+this._y*f,this._z=s*p+this._z*f,this._onChangeCallback(),this}slerpQuaternions(r,e,i){return this.copy(r).slerp(e,i)}random(){const r=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(n*Math.sin(r),n*Math.cos(r),s*Math.sin(e),s*Math.cos(e))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,e=0){return this._x=r[e],this._y=r[e+1],this._z=r[e+2],this._w=r[e+3],this._onChangeCallback(),this}toArray(r=[],e=0){return r[e]=this._x,r[e+1]=this._y,r[e+2]=this._z,r[e+3]=this._w,r}fromBufferAttribute(r,e){return this._x=r.getX(e),this._y=r.getY(e),this._z=r.getZ(e),this._w=r.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Lt=class iG{constructor(e=0,i=0,n=0){iG.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(PD.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(PD.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*n+o[6]*s,this.y=o[1]*i+o[4]*n+o[7]*s,this.z=o[2]*i+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=e.elements,l=1/(o[3]*i+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*n+o[8]*s+o[12])*l,this.y=(o[1]*i+o[5]*n+o[9]*s+o[13])*l,this.z=(o[2]*i+o[6]*n+o[10]*s+o[14])*l,this}applyQuaternion(e){const i=this.x,n=this.y,s=this.z,o=e.x,l=e.y,u=e.z,c=e.w,d=2*(l*s-u*n),p=2*(u*i-o*s),f=2*(o*n-l*i);return this.x=i+c*d+l*f-u*p,this.y=n+c*p+u*d-o*f,this.z=s+c*f+o*p-l*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*s,this.y=o[1]*i+o[5]*n+o[9]*s,this.z=o[2]*i+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,s=e.y,o=e.z,l=i.x,u=i.y,c=i.z;return this.x=s*c-o*u,this.y=o*l-n*c,this.z=n*u-s*l,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return S2.copy(this).projectOnVector(e),this.sub(S2)}reflect(e){return this.sub(S2.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Ia(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return i*i+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const s=Math.sin(i)*e;return this.x=s*Math.sin(n),this.y=Math.cos(i)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const S2=new Lt,PD=new Lo;let Pf=class{constructor(r=new Lt(1/0,1/0,1/0),e=new Lt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=e}set(r,e){return this.min.copy(r),this.max.copy(e),this}setFromArray(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e+=3)this.expandByPoint(Wl.fromArray(r,e));return this}setFromBufferAttribute(r){this.makeEmpty();for(let e=0,i=r.count;e<i;e++)this.expandByPoint(Wl.fromBufferAttribute(r,e));return this}setFromPoints(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(r,e){const i=Wl.copy(e).multiplyScalar(.5);return this.min.copy(r).sub(i),this.max.copy(r).add(i),this}setFromObject(r,e=!1){return this.makeEmpty(),this.expandByObject(r,e)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,e=!1){r.updateWorldMatrix(!1,!1);const i=r.geometry;if(i!==void 0){const s=i.getAttribute("position");if(e===!0&&s!==void 0&&r.isInstancedMesh!==!0)for(let o=0,l=s.count;o<l;o++)r.isMesh===!0?r.getVertexPosition(o,Wl):Wl.fromBufferAttribute(s,o),Wl.applyMatrix4(r.matrixWorld),this.expandByPoint(Wl);else r.boundingBox!==void 0?(r.boundingBox===null&&r.computeBoundingBox(),nx.copy(r.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),nx.copy(i.boundingBox)),nx.applyMatrix4(r.matrixWorld),this.union(nx)}const n=r.children;for(let s=0,o=n.length;s<o;s++)this.expandByObject(n[s],e);return this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y||r.z<this.min.z||r.z>this.max.z)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,e){return e.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y||r.max.z<this.min.z||r.min.z>this.max.z)}intersectsSphere(r){return this.clampPoint(r.center,Wl),Wl.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let e,i;return r.normal.x>0?(e=r.normal.x*this.min.x,i=r.normal.x*this.max.x):(e=r.normal.x*this.max.x,i=r.normal.x*this.min.x),r.normal.y>0?(e+=r.normal.y*this.min.y,i+=r.normal.y*this.max.y):(e+=r.normal.y*this.max.y,i+=r.normal.y*this.min.y),r.normal.z>0?(e+=r.normal.z*this.min.z,i+=r.normal.z*this.max.z):(e+=r.normal.z*this.max.z,i+=r.normal.z*this.min.z),e<=-r.constant&&i>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(U0),sx.subVectors(this.max,U0),Ff.subVectors(r.a,U0),kf.subVectors(r.b,U0),Uf.subVectors(r.c,U0),Sh.subVectors(kf,Ff),Th.subVectors(Uf,kf),Qd.subVectors(Ff,Uf);let e=[0,-Sh.z,Sh.y,0,-Th.z,Th.y,0,-Qd.z,Qd.y,Sh.z,0,-Sh.x,Th.z,0,-Th.x,Qd.z,0,-Qd.x,-Sh.y,Sh.x,0,-Th.y,Th.x,0,-Qd.y,Qd.x,0];return!T2(e,Ff,kf,Uf,sx)||(e=[1,0,0,0,1,0,0,0,1],!T2(e,Ff,kf,Uf,sx))?!1:(ax.crossVectors(Sh,Th),e=[ax.x,ax.y,ax.z],T2(e,Ff,kf,Uf,sx))}clampPoint(r,e){return e.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,Wl).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=this.getSize(Wl).length()*.5),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()?this:(au[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),au[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),au[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),au[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),au[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),au[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),au[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),au[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(au),this)}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}};const au=[new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt],Wl=new Lt,nx=new Pf,Ff=new Lt,kf=new Lt,Uf=new Lt,Sh=new Lt,Th=new Lt,Qd=new Lt,U0=new Lt,sx=new Lt,ax=new Lt,qd=new Lt;function T2(r,e,i,n,s){for(let o=0,l=r.length-3;o<=l;o+=3){qd.fromArray(r,o);const u=s.x*Math.abs(qd.x)+s.y*Math.abs(qd.y)+s.z*Math.abs(qd.z),c=e.dot(qd),d=i.dot(qd),p=n.dot(qd);if(Math.max(-Math.max(c,d,p),Math.min(c,d,p))>u)return!1}return!0}const YQ=new Pf,z0=new Lt,M2=new Lt;let zf=class{constructor(r=new Lt,e=-1){this.isSphere=!0,this.center=r,this.radius=e}set(r,e){return this.center.copy(r),this.radius=e,this}setFromPoints(r,e){const i=this.center;e!==void 0?i.copy(e):YQ.setFromPoints(r).getCenter(i);let n=0;for(let s=0,o=r.length;s<o;s++)n=Math.max(n,i.distanceToSquared(r[s]));return this.radius=Math.sqrt(n),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const e=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=e*e}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,e){const i=this.center.distanceToSquared(r);return e.copy(r),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;z0.subVectors(r,this.center);const e=z0.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.addScaledVector(z0,n/i),this.radius+=n}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(M2.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(z0.copy(r.center).add(M2)),this.expandByPoint(z0.copy(r.center).sub(M2))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}};const ou=new Lt,R2=new Lt,ox=new Lt,Mh=new Lt,I2=new Lt,lx=new Lt,B2=new Lt;let N2=class{constructor(r=new Lt,e=new Lt(0,0,-1)){this.origin=r,this.direction=e}set(r,e){return this.origin.copy(r),this.direction.copy(e),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,e){return e.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,ou)),this}closestPointToPoint(r,e){e.subVectors(r,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const e=ou.subVectors(r,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(r):(ou.copy(this.origin).addScaledVector(this.direction,e),ou.distanceToSquared(r))}distanceSqToSegment(r,e,i,n){R2.copy(r).add(e).multiplyScalar(.5),ox.copy(e).sub(r).normalize(),Mh.copy(this.origin).sub(R2);const s=r.distanceTo(e)*.5,o=-this.direction.dot(ox),l=Mh.dot(this.direction),u=-Mh.dot(ox),c=Mh.lengthSq(),d=Math.abs(1-o*o);let p,f,m,g;if(d>0)if(p=o*u-l,f=o*l-u,g=s*d,p>=0)if(f>=-g)if(f<=g){const y=1/d;p*=y,f*=y,m=p*(p+o*f+2*l)+f*(o*p+f+2*u)+c}else f=s,p=Math.max(0,-(o*f+l)),m=-p*p+f*(f+2*u)+c;else f=-s,p=Math.max(0,-(o*f+l)),m=-p*p+f*(f+2*u)+c;else f<=-g?(p=Math.max(0,-(-o*s+l)),f=p>0?-s:Math.min(Math.max(-s,-u),s),m=-p*p+f*(f+2*u)+c):f<=g?(p=0,f=Math.min(Math.max(-s,-u),s),m=f*(f+2*u)+c):(p=Math.max(0,-(o*s+l)),f=p>0?s:Math.min(Math.max(-s,-u),s),m=-p*p+f*(f+2*u)+c);else f=o>0?-s:s,p=Math.max(0,-(o*f+l)),m=-p*p+f*(f+2*u)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,p),n&&n.copy(R2).addScaledVector(ox,f),m}intersectSphere(r,e){ou.subVectors(r.center,this.origin);const i=ou.dot(this.direction),n=ou.dot(ou)-i*i,s=r.radius*r.radius;if(n>s)return null;const o=Math.sqrt(s-n),l=i-o,u=i+o;return u<0?null:l<0?this.at(u,e):this.at(l,e)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const e=r.normal.dot(this.direction);if(e===0)return r.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(r.normal)+r.constant)/e;return i>=0?i:null}intersectPlane(r,e){const i=this.distanceToPlane(r);return i===null?null:this.at(i,e)}intersectsPlane(r){const e=r.distanceToPoint(this.origin);return e===0||r.normal.dot(this.direction)*e<0}intersectBox(r,e){let i,n,s,o,l,u;const c=1/this.direction.x,d=1/this.direction.y,p=1/this.direction.z,f=this.origin;return c>=0?(i=(r.min.x-f.x)*c,n=(r.max.x-f.x)*c):(i=(r.max.x-f.x)*c,n=(r.min.x-f.x)*c),d>=0?(s=(r.min.y-f.y)*d,o=(r.max.y-f.y)*d):(s=(r.max.y-f.y)*d,o=(r.min.y-f.y)*d),i>o||s>n||((s>i||isNaN(i))&&(i=s),(o<n||isNaN(n))&&(n=o),p>=0?(l=(r.min.z-f.z)*p,u=(r.max.z-f.z)*p):(l=(r.max.z-f.z)*p,u=(r.min.z-f.z)*p),i>u||l>n)||((l>i||i!==i)&&(i=l),(u<n||n!==n)&&(n=u),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(r){return this.intersectBox(r,ou)!==null}intersectTriangle(r,e,i,n,s){I2.subVectors(e,r),lx.subVectors(i,r),B2.crossVectors(I2,lx);let o=this.direction.dot(B2),l;if(o>0){if(n)return null;l=1}else if(o<0)l=-1,o=-o;else return null;Mh.subVectors(this.origin,r);const u=l*this.direction.dot(lx.crossVectors(Mh,lx));if(u<0)return null;const c=l*this.direction.dot(I2.cross(Mh));if(c<0||u+c>o)return null;const d=-l*Mh.dot(B2);return d<0?null:this.at(d/o,s)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Gr=class NN{constructor(e,i,n,s,o,l,u,c,d,p,f,m,g,y,x,v){NN.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,d,p,f,m,g,y,x,v)}set(e,i,n,s,o,l,u,c,d,p,f,m,g,y,x,v){const _=this.elements;return _[0]=e,_[4]=i,_[8]=n,_[12]=s,_[1]=o,_[5]=l,_[9]=u,_[13]=c,_[2]=d,_[6]=p,_[10]=f,_[14]=m,_[3]=g,_[7]=y,_[11]=x,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new NN().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,s=1/jf.setFromMatrixColumn(e,0).length(),o=1/jf.setFromMatrixColumn(e,1).length(),l=1/jf.setFromMatrixColumn(e,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*l,i[9]=n[9]*l,i[10]=n[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,s=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),d=Math.sin(s),p=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){const m=l*p,g=l*f,y=u*p,x=u*f;i[0]=c*p,i[4]=-c*f,i[8]=d,i[1]=g+y*d,i[5]=m-x*d,i[9]=-u*c,i[2]=x-m*d,i[6]=y+g*d,i[10]=l*c}else if(e.order==="YXZ"){const m=c*p,g=c*f,y=d*p,x=d*f;i[0]=m+x*u,i[4]=y*u-g,i[8]=l*d,i[1]=l*f,i[5]=l*p,i[9]=-u,i[2]=g*u-y,i[6]=x+m*u,i[10]=l*c}else if(e.order==="ZXY"){const m=c*p,g=c*f,y=d*p,x=d*f;i[0]=m-x*u,i[4]=-l*f,i[8]=y+g*u,i[1]=g+y*u,i[5]=l*p,i[9]=x-m*u,i[2]=-l*d,i[6]=u,i[10]=l*c}else if(e.order==="ZYX"){const m=l*p,g=l*f,y=u*p,x=u*f;i[0]=c*p,i[4]=y*d-g,i[8]=m*d+x,i[1]=c*f,i[5]=x*d+m,i[9]=g*d-y,i[2]=-d,i[6]=u*c,i[10]=l*c}else if(e.order==="YZX"){const m=l*c,g=l*d,y=u*c,x=u*d;i[0]=c*p,i[4]=x-m*f,i[8]=y*f+g,i[1]=f,i[5]=l*p,i[9]=-u*p,i[2]=-d*p,i[6]=g*f+y,i[10]=m-x*f}else if(e.order==="XZY"){const m=l*c,g=l*d,y=u*c,x=u*d;i[0]=c*p,i[4]=-f,i[8]=d*p,i[1]=m*f+x,i[5]=l*p,i[9]=g*f-y,i[2]=y*f-g,i[6]=u*p,i[10]=x*f+m}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(KQ,e,JQ)}lookAt(e,i,n){const s=this.elements;return tl.subVectors(e,i),tl.lengthSq()===0&&(tl.z=1),tl.normalize(),Rh.crossVectors(n,tl),Rh.lengthSq()===0&&(Math.abs(n.z)===1?tl.x+=1e-4:tl.z+=1e-4,tl.normalize(),Rh.crossVectors(n,tl)),Rh.normalize(),cx.crossVectors(tl,Rh),s[0]=Rh.x,s[4]=cx.x,s[8]=tl.x,s[1]=Rh.y,s[5]=cx.y,s[9]=tl.y,s[2]=Rh.z,s[6]=cx.z,s[10]=tl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[4],c=n[8],d=n[12],p=n[1],f=n[5],m=n[9],g=n[13],y=n[2],x=n[6],v=n[10],_=n[14],T=n[3],w=n[7],S=n[11],R=n[15],B=s[0],I=s[4],D=s[8],L=s[12],O=s[1],U=s[5],J=s[9],H=s[13],V=s[2],$=s[6],Q=s[10],G=s[14],j=s[3],ie=s[7],Y=s[11],ae=s[15];return o[0]=l*B+u*O+c*V+d*j,o[4]=l*I+u*U+c*$+d*ie,o[8]=l*D+u*J+c*Q+d*Y,o[12]=l*L+u*H+c*G+d*ae,o[1]=p*B+f*O+m*V+g*j,o[5]=p*I+f*U+m*$+g*ie,o[9]=p*D+f*J+m*Q+g*Y,o[13]=p*L+f*H+m*G+g*ae,o[2]=y*B+x*O+v*V+_*j,o[6]=y*I+x*U+v*$+_*ie,o[10]=y*D+x*J+v*Q+_*Y,o[14]=y*L+x*H+v*G+_*ae,o[3]=T*B+w*O+S*V+R*j,o[7]=T*I+w*U+S*$+R*ie,o[11]=T*D+w*J+S*Q+R*Y,o[15]=T*L+w*H+S*G+R*ae,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],s=e[8],o=e[12],l=e[1],u=e[5],c=e[9],d=e[13],p=e[2],f=e[6],m=e[10],g=e[14],y=e[3],x=e[7],v=e[11],_=e[15];return y*(+o*c*f-s*d*f-o*u*m+n*d*m+s*u*g-n*c*g)+x*(+i*c*g-i*d*m+o*l*m-s*l*g+s*d*p-o*c*p)+v*(+i*d*f-i*u*g-o*l*f+n*l*g+o*u*p-n*d*p)+_*(-s*u*p-i*c*f+i*u*m+s*l*f-n*l*m+n*c*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8],f=e[9],m=e[10],g=e[11],y=e[12],x=e[13],v=e[14],_=e[15],T=f*v*d-x*m*d+x*c*g-u*v*g-f*c*_+u*m*_,w=y*m*d-p*v*d-y*c*g+l*v*g+p*c*_-l*m*_,S=p*x*d-y*f*d+y*u*g-l*x*g-p*u*_+l*f*_,R=y*f*c-p*x*c-y*u*m+l*x*m+p*u*v-l*f*v,B=i*T+n*w+s*S+o*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/B;return e[0]=T*I,e[1]=(x*m*o-f*v*o-x*s*g+n*v*g+f*s*_-n*m*_)*I,e[2]=(u*v*o-x*c*o+x*s*d-n*v*d-u*s*_+n*c*_)*I,e[3]=(f*c*o-u*m*o-f*s*d+n*m*d+u*s*g-n*c*g)*I,e[4]=w*I,e[5]=(p*v*o-y*m*o+y*s*g-i*v*g-p*s*_+i*m*_)*I,e[6]=(y*c*o-l*v*o-y*s*d+i*v*d+l*s*_-i*c*_)*I,e[7]=(l*m*o-p*c*o+p*s*d-i*m*d-l*s*g+i*c*g)*I,e[8]=S*I,e[9]=(y*f*o-p*x*o-y*n*g+i*x*g+p*n*_-i*f*_)*I,e[10]=(l*x*o-y*u*o+y*n*d-i*x*d-l*n*_+i*u*_)*I,e[11]=(p*u*o-l*f*o-p*n*d+i*f*d+l*n*g-i*u*g)*I,e[12]=R*I,e[13]=(p*x*s-y*f*s+y*n*m-i*x*m-p*n*v+i*f*v)*I,e[14]=(y*u*s-l*x*s-y*n*c+i*x*c+l*n*v-i*u*v)*I,e[15]=(l*f*s-p*u*s+p*n*c-i*f*c-l*n*m+i*u*m)*I,this}scale(e){const i=this.elements,n=e.x,s=e.y,o=e.z;return i[0]*=n,i[4]*=s,i[8]*=o,i[1]*=n,i[5]*=s,i[9]*=o,i[2]*=n,i[6]*=s,i[10]*=o,i[3]*=n,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,s))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),s=Math.sin(i),o=1-n,l=e.x,u=e.y,c=e.z,d=o*l,p=o*u;return this.set(d*l+n,d*u-s*c,d*c+s*u,0,d*u+s*c,p*u+n,p*c-s*l,0,d*c-s*u,p*c+s*l,o*c*c+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,s,o,l){return this.set(1,n,o,0,e,1,l,0,i,s,1,0,0,0,0,1),this}compose(e,i,n){const s=this.elements,o=i._x,l=i._y,u=i._z,c=i._w,d=o+o,p=l+l,f=u+u,m=o*d,g=o*p,y=o*f,x=l*p,v=l*f,_=u*f,T=c*d,w=c*p,S=c*f,R=n.x,B=n.y,I=n.z;return s[0]=(1-(x+_))*R,s[1]=(g+S)*R,s[2]=(y-w)*R,s[3]=0,s[4]=(g-S)*B,s[5]=(1-(m+_))*B,s[6]=(v+T)*B,s[7]=0,s[8]=(y+w)*I,s[9]=(v-T)*I,s[10]=(1-(m+x))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,n){const s=this.elements;let o=jf.set(s[0],s[1],s[2]).length();const l=jf.set(s[4],s[5],s[6]).length(),u=jf.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],Ql.copy(this);const c=1/o,d=1/l,p=1/u;return Ql.elements[0]*=c,Ql.elements[1]*=c,Ql.elements[2]*=c,Ql.elements[4]*=d,Ql.elements[5]*=d,Ql.elements[6]*=d,Ql.elements[8]*=p,Ql.elements[9]*=p,Ql.elements[10]*=p,i.setFromRotationMatrix(Ql),n.x=o,n.y=l,n.z=u,this}makePerspective(e,i,n,s,o,l,u=Wd){const c=this.elements,d=2*o/(i-e),p=2*o/(n-s),f=(i+e)/(i-e),m=(n+s)/(n-s);let g,y;if(u===Wd)g=-(l+o)/(l-o),y=-2*l*o/(l-o);else if(u===x2)g=-l/(l-o),y=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=d,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,n,s,o,l,u=Wd){const c=this.elements,d=1/(i-e),p=1/(n-s),f=1/(l-o),m=(i+e)*d,g=(n+s)*p;let y,x;if(u===Wd)y=(l+o)*f,x=-2*f;else if(u===x2)y=o*f,x=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*d,c[4]=0,c[8]=0,c[12]=-m,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-g,c[2]=0,c[6]=0,c[10]=x,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}};const jf=new Lt,Ql=new Gr,KQ=new Lt(0,0,0),JQ=new Lt(1,1,1),Rh=new Lt,cx=new Lt,tl=new Lt,FD=new Gr,kD=new Lo;let co=class rG{constructor(e=0,i=0,n=0,s=rG.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,s=this._order){return this._x=e,this._y=i,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],c=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];switch(i){case"XYZ":this._y=Math.asin(Ia(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-p,g),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(m,d),this._z=0);break;case"YXZ":this._x=Math.asin(-Ia(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(u,g),this._z=Math.atan2(c,d)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(Ia(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-f,g),this._z=Math.atan2(-l,d)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Ia(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(m,g),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-l,d));break;case"YZX":this._z=Math.asin(Ia(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,d),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,g));break;case"XZY":this._z=Math.asin(-Ia(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(m,d),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-p,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return FD.makeRotationFromQuaternion(e),this.setFromRotationMatrix(FD,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return kD.setFromEuler(this),this.setFromQuaternion(kD,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};co.DEFAULT_ORDER="XYZ";let ZQ=class{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!==0}isEnabled(r){return(this.mask&(1<<r|0))!==0}},$Q=0;const UD=new Lt,Vf=new Lo,lu=new Gr,ux=new Lt,j0=new Lt,eq=new Lt,tq=new Lo,zD=new Lt(1,0,0),jD=new Lt(0,1,0),VD=new Lt(0,0,1),GD={type:"added"},iq={type:"removed"},Gf={type:"childadded",child:null},L2={type:"childremoved",child:null};let Ba=class Nw extends ix{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:$Q++}),this.uuid=wh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Nw.DEFAULT_UP.clone();const e=new Lt,i=new co,n=new Lo,s=new Lt(1,1,1);function o(){n.setFromEuler(i,!1)}function l(){i.setFromQuaternion(n,void 0,!1)}i._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Gr},normalMatrix:{value:new Ch}}),this.matrix=new Gr,this.matrixWorld=new Gr,this.matrixAutoUpdate=Nw.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Nw.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ZQ,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Vf.setFromAxisAngle(e,i),this.quaternion.multiply(Vf),this}rotateOnWorldAxis(e,i){return Vf.setFromAxisAngle(e,i),this.quaternion.premultiply(Vf),this}rotateX(e){return this.rotateOnAxis(zD,e)}rotateY(e){return this.rotateOnAxis(jD,e)}rotateZ(e){return this.rotateOnAxis(VD,e)}translateOnAxis(e,i){return UD.copy(e).applyQuaternion(this.quaternion),this.position.add(UD.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(zD,e)}translateY(e){return this.translateOnAxis(jD,e)}translateZ(e){return this.translateOnAxis(VD,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(lu.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?ux.copy(e):ux.set(e,i,n);const s=this.parent;this.updateWorldMatrix(!0,!1),j0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?lu.lookAt(j0,ux,this.up):lu.lookAt(ux,j0,this.up),this.quaternion.setFromRotationMatrix(lu),s&&(lu.extractRotation(s.matrixWorld),Vf.setFromRotationMatrix(lu),this.quaternion.premultiply(Vf.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(GD),Gf.child=e,this.dispatchEvent(Gf),Gf.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(iq),L2.child=e,this.dispatchEvent(L2),L2.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),lu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),lu.multiply(e.parent.matrixWorld)),e.applyMatrix4(lu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(GD),Gf.child=e,this.dispatchEvent(Gf),Gf.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(j0,e,eq),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(j0,tq,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,s=i.length;n<s;n++){const o=i[n];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const s=this.children;for(let o=0,l=s.length;o<l;o++){const u=s[o];u.matrixWorldAutoUpdate===!0&&u.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let d=0,p=c.length;d<p;d++){const f=c[d];o(e.shapes,f)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,d=this.material.length;c<d;c++)u.push(o(e.materials,this.material[c]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];s.animations.push(o(e.animations,c))}}if(i){const u=l(e.geometries),c=l(e.materials),d=l(e.textures),p=l(e.images),f=l(e.shapes),m=l(e.skeletons),g=l(e.animations),y=l(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),d.length>0&&(n.textures=d),p.length>0&&(n.images=p),f.length>0&&(n.shapes=f),m.length>0&&(n.skeletons=m),g.length>0&&(n.animations=g),y.length>0&&(n.nodes=y)}return n.object=s,n;function l(u){const c=[];for(const d in u){const p=u[d];delete p.metadata,c.push(p)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}};Ba.DEFAULT_UP=new Lt(0,1,0),Ba.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ba.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ql=new Lt,cu=new Lt,D2=new Lt,uu=new Lt,Hf=new Lt,Wf=new Lt,HD=new Lt,O2=new Lt,P2=new Lt,F2=new Lt;let hx=class b0{constructor(e=new Lt,i=new Lt,n=new Lt){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,s){s.subVectors(n,i),ql.subVectors(e,i),s.cross(ql);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,n,s,o){ql.subVectors(s,i),cu.subVectors(n,i),D2.subVectors(e,i);const l=ql.dot(ql),u=ql.dot(cu),c=ql.dot(D2),d=cu.dot(cu),p=cu.dot(D2),f=l*d-u*u;if(f===0)return o.set(0,0,0),null;const m=1/f,g=(d*c-u*p)*m,y=(l*p-u*c)*m;return o.set(1-g-y,y,g)}static containsPoint(e,i,n,s){return this.getBarycoord(e,i,n,s,uu)===null?!1:uu.x>=0&&uu.y>=0&&uu.x+uu.y<=1}static getInterpolation(e,i,n,s,o,l,u,c){return this.getBarycoord(e,i,n,s,uu)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,uu.x),c.addScaledVector(l,uu.y),c.addScaledVector(u,uu.z),c)}static isFrontFacing(e,i,n,s){return ql.subVectors(n,i),cu.subVectors(e,i),ql.cross(cu).dot(s)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,s){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,n,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ql.subVectors(this.c,this.b),cu.subVectors(this.a,this.b),ql.cross(cu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return b0.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return b0.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,s,o){return b0.getInterpolation(e,this.a,this.b,this.c,i,n,s,o)}containsPoint(e){return b0.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return b0.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,s=this.b,o=this.c;let l,u;Hf.subVectors(s,n),Wf.subVectors(o,n),O2.subVectors(e,n);const c=Hf.dot(O2),d=Wf.dot(O2);if(c<=0&&d<=0)return i.copy(n);P2.subVectors(e,s);const p=Hf.dot(P2),f=Wf.dot(P2);if(p>=0&&f<=p)return i.copy(s);const m=c*f-p*d;if(m<=0&&c>=0&&p<=0)return l=c/(c-p),i.copy(n).addScaledVector(Hf,l);F2.subVectors(e,o);const g=Hf.dot(F2),y=Wf.dot(F2);if(y>=0&&g<=y)return i.copy(o);const x=g*d-c*y;if(x<=0&&d>=0&&y<=0)return u=d/(d-y),i.copy(n).addScaledVector(Wf,u);const v=p*y-g*f;if(v<=0&&f-p>=0&&g-y>=0)return HD.subVectors(o,s),u=(f-p)/(f-p+(g-y)),i.copy(s).addScaledVector(HD,u);const _=1/(v+x+m);return l=x*_,u=m*_,i.copy(n).addScaledVector(Hf,l).addScaledVector(Wf,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const WD={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ih={h:0,s:0,l:0},dx={h:0,s:0,l:0};function k2(r,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(e-r)*6*i:i<1/2?e:i<2/3?r+(e-r)*6*(2/3-i):r}let Ws=class{constructor(r,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(r,e,i)}set(r,e,i){if(e===void 0&&i===void 0){const n=r;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(r,e,i);return this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,e=El){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(r&255)/255,Hl.toWorkingColorSpace(this,e),this}setRGB(r,e,i,n=Hl.workingColorSpace){return this.r=r,this.g=e,this.b=i,Hl.toWorkingColorSpace(this,n),this}setHSL(r,e,i,n=Hl.workingColorSpace){if(r=b2(r,1),e=Ia(e,0,1),i=Ia(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,o=2*i-s;this.r=k2(o,s,r+1/3),this.g=k2(o,s,r),this.b=k2(o,s,r-1/3)}return Hl.toWorkingColorSpace(this,n),this}setStyle(r,e=El){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(r)){let s;const o=n[1],l=n[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(r)){const s=n[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,e);return this}setColorName(r,e=El){const i=WD[r.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=Df(r.r),this.g=Df(r.g),this.b=Df(r.b),this}copyLinearToSRGB(r){return this.r=w2(r.r),this.g=w2(r.g),this.b=w2(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=El){return Hl.fromWorkingColorSpace(Qa.copy(this),r),Math.round(Ia(Qa.r*255,0,255))*65536+Math.round(Ia(Qa.g*255,0,255))*256+Math.round(Ia(Qa.b*255,0,255))}getHexString(r=El){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,e=Hl.workingColorSpace){Hl.fromWorkingColorSpace(Qa.copy(this),e);const i=Qa.r,n=Qa.g,s=Qa.b,o=Math.max(i,n,s),l=Math.min(i,n,s);let u,c;const d=(l+o)/2;if(l===o)u=0,c=0;else{const p=o-l;switch(c=d<=.5?p/(o+l):p/(2-o-l),o){case i:u=(n-s)/p+(n<s?6:0);break;case n:u=(s-i)/p+2;break;case s:u=(i-n)/p+4;break}u/=6}return r.h=u,r.s=c,r.l=d,r}getRGB(r,e=Hl.workingColorSpace){return Hl.fromWorkingColorSpace(Qa.copy(this),e),r.r=Qa.r,r.g=Qa.g,r.b=Qa.b,r}getStyle(r=El){Hl.fromWorkingColorSpace(Qa.copy(this),r);const e=Qa.r,i=Qa.g,n=Qa.b;return r!==El?`color(${r} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(r,e,i){return this.getHSL(Ih),this.setHSL(Ih.h+r,Ih.s+e,Ih.l+i)}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,e){return this.r=r.r+e.r,this.g=r.g+e.g,this.b=r.b+e.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,e){return this.r+=(r.r-this.r)*e,this.g+=(r.g-this.g)*e,this.b+=(r.b-this.b)*e,this}lerpColors(r,e,i){return this.r=r.r+(e.r-r.r)*i,this.g=r.g+(e.g-r.g)*i,this.b=r.b+(e.b-r.b)*i,this}lerpHSL(r,e){this.getHSL(Ih),r.getHSL(dx);const i=k0(Ih.h,dx.h,e),n=k0(Ih.s,dx.s,e),s=k0(Ih.l,dx.l,e);return this.setHSL(i,n,s),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const e=this.r,i=this.g,n=this.b,s=r.elements;return this.r=s[0]*e+s[3]*i+s[6]*n,this.g=s[1]*e+s[4]*i+s[7]*n,this.b=s[2]*e+s[5]*i+s[8]*n,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,e=0){return this.r=r[e],this.g=r[e+1],this.b=r[e+2],this}toArray(r=[],e=0){return r[e]=this.r,r[e+1]=this.g,r[e+2]=this.b,r}fromBufferAttribute(r,e){return this.r=r.getX(e),this.g=r.getY(e),this.b=r.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Qa=new Ws;Ws.NAMES=WD;let rq=0,px=class extends ix{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:rq++}),this.uuid=wh(),this.name="",this.type="Material",this.blending=uD,this.side=f2,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=dD,this.blendDst=pD,this.blendEquation=hD,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ws(0,0,0),this.blendAlpha=0,this.depthFunc=fD,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ID,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Nf,this.stencilZFail=Nf,this.stencilZPass=Nf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const e in r){const i=r[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];if(n===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}}toJSON(r){const e=r===void 0||typeof r=="string";e&&(r={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(r).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(r).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(r).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(r).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(r).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==uD&&(i.blending=this.blending),this.side!==f2&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==dD&&(i.blendSrc=this.blendSrc),this.blendDst!==pD&&(i.blendDst=this.blendDst),this.blendEquation!==hD&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==fD&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==ID&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Nf&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Nf&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Nf&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(s){const o=[];for(const l in s){const u=s[l];delete u.metadata,o.push(u)}return o}if(e){const s=n(r.textures),o=n(r.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.blendColor.copy(r.blendColor),this.blendAlpha=r.blendAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const e=r.clippingPlanes;let i=null;if(e!==null){const n=e.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaHash=r.alphaHash,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=JSON.parse(JSON.stringify(r.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}},nq=class extends px{constructor(r){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ws(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new co,this.combine=m2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}};const Qs=new Lt,fx=new zs;let Qf=class{constructor(r,e,i=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=e,this.count=r!==void 0?r.length/e:0,this.normalized=i,this.usage=BD,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=yD,this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}get updateRange(){return GQ("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(r){return this.usage=r,this}addUpdateRange(r,e){this.updateRanges.push({start:r,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this.gpuType=r.gpuType,this}copyAt(r,e,i){r*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[r+n]=e.array[i+n];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)fx.fromBufferAttribute(this,e),fx.applyMatrix3(r),this.setXY(e,fx.x,fx.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Qs.fromBufferAttribute(this,e),Qs.applyMatrix3(r),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this}applyMatrix4(r){for(let e=0,i=this.count;e<i;e++)Qs.fromBufferAttribute(this,e),Qs.applyMatrix4(r),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this}applyNormalMatrix(r){for(let e=0,i=this.count;e<i;e++)Qs.fromBufferAttribute(this,e),Qs.applyNormalMatrix(r),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this}transformDirection(r){for(let e=0,i=this.count;e<i;e++)Qs.fromBufferAttribute(this,e),Qs.transformDirection(r),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this}set(r,e=0){return this.array.set(r,e),this}getComponent(r,e){let i=this.array[r*this.itemSize+e];return this.normalized&&(i=Lf(i,this.array)),i}setComponent(r,e,i){return this.normalized&&(i=oo(i,this.array)),this.array[r*this.itemSize+e]=i,this}getX(r){let e=this.array[r*this.itemSize];return this.normalized&&(e=Lf(e,this.array)),e}setX(r,e){return this.normalized&&(e=oo(e,this.array)),this.array[r*this.itemSize]=e,this}getY(r){let e=this.array[r*this.itemSize+1];return this.normalized&&(e=Lf(e,this.array)),e}setY(r,e){return this.normalized&&(e=oo(e,this.array)),this.array[r*this.itemSize+1]=e,this}getZ(r){let e=this.array[r*this.itemSize+2];return this.normalized&&(e=Lf(e,this.array)),e}setZ(r,e){return this.normalized&&(e=oo(e,this.array)),this.array[r*this.itemSize+2]=e,this}getW(r){let e=this.array[r*this.itemSize+3];return this.normalized&&(e=Lf(e,this.array)),e}setW(r,e){return this.normalized&&(e=oo(e,this.array)),this.array[r*this.itemSize+3]=e,this}setXY(r,e,i){return r*=this.itemSize,this.normalized&&(e=oo(e,this.array),i=oo(i,this.array)),this.array[r+0]=e,this.array[r+1]=i,this}setXYZ(r,e,i,n){return r*=this.itemSize,this.normalized&&(e=oo(e,this.array),i=oo(i,this.array),n=oo(n,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this}setXYZW(r,e,i,n,s){return r*=this.itemSize,this.normalized&&(e=oo(e,this.array),i=oo(i,this.array),n=oo(n,this.array),s=oo(s,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this.array[r+3]=s,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==BD&&(r.usage=this.usage),r}},QD=class extends Qf{constructor(r,e,i){super(new Uint16Array(r),e,i)}},sq=class extends Qf{constructor(r,e,i){super(new Uint32Array(r),e,i)}},Bh=class extends Qf{constructor(r,e,i){super(new Float32Array(r),e,i)}},aq=0;const wl=new Gr,U2=new Ba,qf=new Lt,il=new Pf,V0=new Pf,xa=new Lt;let G0=class nG extends ix{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:aq++}),this.uuid=wh(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(VQ(e)?sq:QD)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new Ch().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return wl.makeRotationFromQuaternion(e),this.applyMatrix4(wl),this}rotateX(e){return wl.makeRotationX(e),this.applyMatrix4(wl),this}rotateY(e){return wl.makeRotationY(e),this.applyMatrix4(wl),this}rotateZ(e){return wl.makeRotationZ(e),this.applyMatrix4(wl),this}translate(e,i,n){return wl.makeTranslation(e,i,n),this.applyMatrix4(wl),this}scale(e,i,n){return wl.makeScale(e,i,n),this.applyMatrix4(wl),this}lookAt(e){return U2.lookAt(e),U2.updateMatrix(),this.applyMatrix4(U2.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(qf).negate(),this.translate(qf.x,qf.y,qf.z),this}setFromPoints(e){const i=[];for(let n=0,s=e.length;n<s;n++){const o=e[n];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Bh(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Pf);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Lt(-1/0,-1/0,-1/0),new Lt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,s=i.length;n<s;n++){const o=i[n];il.setFromBufferAttribute(o),this.morphTargetsRelative?(xa.addVectors(this.boundingBox.min,il.min),this.boundingBox.expandByPoint(xa),xa.addVectors(this.boundingBox.max,il.max),this.boundingBox.expandByPoint(xa)):(this.boundingBox.expandByPoint(il.min),this.boundingBox.expandByPoint(il.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new zf);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Lt,1/0);return}if(e){const n=this.boundingSphere.center;if(il.setFromBufferAttribute(e),i)for(let o=0,l=i.length;o<l;o++){const u=i[o];V0.setFromBufferAttribute(u),this.morphTargetsRelative?(xa.addVectors(il.min,V0.min),il.expandByPoint(xa),xa.addVectors(il.max,V0.max),il.expandByPoint(xa)):(il.expandByPoint(V0.min),il.expandByPoint(V0.max))}il.getCenter(n);let s=0;for(let o=0,l=e.count;o<l;o++)xa.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(xa));if(i)for(let o=0,l=i.length;o<l;o++){const u=i[o],c=this.morphTargetsRelative;for(let d=0,p=u.count;d<p;d++)xa.fromBufferAttribute(u,d),c&&(qf.fromBufferAttribute(e,d),xa.add(qf)),s=Math.max(s,n.distanceToSquared(xa))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Qf(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],c=[];for(let D=0;D<n.count;D++)u[D]=new Lt,c[D]=new Lt;const d=new Lt,p=new Lt,f=new Lt,m=new zs,g=new zs,y=new zs,x=new Lt,v=new Lt;function _(D,L,O){d.fromBufferAttribute(n,D),p.fromBufferAttribute(n,L),f.fromBufferAttribute(n,O),m.fromBufferAttribute(o,D),g.fromBufferAttribute(o,L),y.fromBufferAttribute(o,O),p.sub(d),f.sub(d),g.sub(m),y.sub(m);const U=1/(g.x*y.y-y.x*g.y);isFinite(U)&&(x.copy(p).multiplyScalar(y.y).addScaledVector(f,-g.y).multiplyScalar(U),v.copy(f).multiplyScalar(g.x).addScaledVector(p,-y.x).multiplyScalar(U),u[D].add(x),u[L].add(x),u[O].add(x),c[D].add(v),c[L].add(v),c[O].add(v))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let D=0,L=T.length;D<L;++D){const O=T[D],U=O.start,J=O.count;for(let H=U,V=U+J;H<V;H+=3)_(e.getX(H+0),e.getX(H+1),e.getX(H+2))}const w=new Lt,S=new Lt,R=new Lt,B=new Lt;function I(D){R.fromBufferAttribute(s,D),B.copy(R);const L=u[D];w.copy(L),w.sub(R.multiplyScalar(R.dot(L))).normalize(),S.crossVectors(B,L);const O=S.dot(c[D])<0?-1:1;l.setXYZW(D,w.x,w.y,w.z,O)}for(let D=0,L=T.length;D<L;++D){const O=T[D],U=O.start,J=O.count;for(let H=U,V=U+J;H<V;H+=3)I(e.getX(H+0)),I(e.getX(H+1)),I(e.getX(H+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Qf(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let m=0,g=n.count;m<g;m++)n.setXYZ(m,0,0,0);const s=new Lt,o=new Lt,l=new Lt,u=new Lt,c=new Lt,d=new Lt,p=new Lt,f=new Lt;if(e)for(let m=0,g=e.count;m<g;m+=3){const y=e.getX(m+0),x=e.getX(m+1),v=e.getX(m+2);s.fromBufferAttribute(i,y),o.fromBufferAttribute(i,x),l.fromBufferAttribute(i,v),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),u.fromBufferAttribute(n,y),c.fromBufferAttribute(n,x),d.fromBufferAttribute(n,v),u.add(p),c.add(p),d.add(p),n.setXYZ(y,u.x,u.y,u.z),n.setXYZ(x,c.x,c.y,c.z),n.setXYZ(v,d.x,d.y,d.z)}else for(let m=0,g=i.count;m<g;m+=3)s.fromBufferAttribute(i,m+0),o.fromBufferAttribute(i,m+1),l.fromBufferAttribute(i,m+2),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),n.setXYZ(m+0,p.x,p.y,p.z),n.setXYZ(m+1,p.x,p.y,p.z),n.setXYZ(m+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)xa.fromBufferAttribute(e,i),xa.normalize(),e.setXYZ(i,xa.x,xa.y,xa.z)}toNonIndexed(){function e(u,c){const d=u.array,p=u.itemSize,f=u.normalized,m=new d.constructor(c.length*p);let g=0,y=0;for(let x=0,v=c.length;x<v;x++){u.isInterleavedBufferAttribute?g=c[x]*u.data.stride+u.offset:g=c[x]*p;for(let _=0;_<p;_++)m[y++]=d[g++]}return new Qf(m,p,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new nG,n=this.index.array,s=this.attributes;for(const u in s){const c=s[u],d=e(c,n);i.setAttribute(u,d)}const o=this.morphAttributes;for(const u in o){const c=[],d=o[u];for(let p=0,f=d.length;p<f;p++){const m=d[p],g=e(m,n);c.push(g)}i.morphAttributes[u]=c}i.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,c=l.length;u<c;u++){const d=l[u];i.addGroup(d.start,d.count,d.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const d in c)c[d]!==void 0&&(e[d]=c[d]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const c in n){const d=n[c];e.data.attributes[c]=d.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const d=this.morphAttributes[c],p=[];for(let f=0,m=d.length;f<m;f++){const g=d[f];p.push(g.toJSON(e.data))}p.length>0&&(s[c]=p,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const s=e.attributes;for(const d in s){const p=s[d];this.setAttribute(d,p.clone(i))}const o=e.morphAttributes;for(const d in o){const p=[],f=o[d];for(let m=0,g=f.length;m<g;m++)p.push(f[m].clone(i));this.morphAttributes[d]=p}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let d=0,p=l.length;d<p;d++){const f=l[d];this.addGroup(f.start,f.count,f.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const qD=new Gr,Xd=new N2,mx=new zf,XD=new Lt,Xf=new Lt,Yf=new Lt,Kf=new Lt,z2=new Lt,gx=new Lt,Ax=new zs,yx=new zs,vx=new zs,YD=new Lt,KD=new Lt,JD=new Lt,xx=new Lt,bx=new Lt;let ZD=class extends Ba{constructor(r=new G0,e=new nq){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=e,this.updateMorphTargets()}copy(r,e){return super.copy(r,e),r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}updateMorphTargets(){const r=this.geometry.morphAttributes,e=Object.keys(r);if(e.length>0){const i=r[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(r,e){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(n,r);const l=this.morphTargetInfluences;if(s&&l){gx.set(0,0,0);for(let u=0,c=s.length;u<c;u++){const d=l[u],p=s[u];d!==0&&(z2.fromBufferAttribute(p,r),o?gx.addScaledVector(z2,d):gx.addScaledVector(z2.sub(e),d))}e.add(gx)}return e}raycast(r,e){const i=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),mx.copy(i.boundingSphere),mx.applyMatrix4(s),Xd.copy(r.ray).recast(r.near),!(mx.containsPoint(Xd.origin)===!1&&(Xd.intersectSphere(mx,XD)===null||Xd.origin.distanceToSquared(XD)>(r.far-r.near)**2))&&(qD.copy(s).invert(),Xd.copy(r.ray).applyMatrix4(qD),!(i.boundingBox!==null&&Xd.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(r,e,Xd)))}_computeIntersections(r,e,i){let n;const s=this.geometry,o=this.material,l=s.index,u=s.attributes.position,c=s.attributes.uv,d=s.attributes.uv1,p=s.attributes.normal,f=s.groups,m=s.drawRange;if(l!==null)if(Array.isArray(o))for(let g=0,y=f.length;g<y;g++){const x=f[g],v=o[x.materialIndex],_=Math.max(x.start,m.start),T=Math.min(l.count,Math.min(x.start+x.count,m.start+m.count));for(let w=_,S=T;w<S;w+=3){const R=l.getX(w),B=l.getX(w+1),I=l.getX(w+2);n=_x(this,v,r,i,c,d,p,R,B,I),n&&(n.faceIndex=Math.floor(w/3),n.face.materialIndex=x.materialIndex,e.push(n))}}else{const g=Math.max(0,m.start),y=Math.min(l.count,m.start+m.count);for(let x=g,v=y;x<v;x+=3){const _=l.getX(x),T=l.getX(x+1),w=l.getX(x+2);n=_x(this,o,r,i,c,d,p,_,T,w),n&&(n.faceIndex=Math.floor(x/3),e.push(n))}}else if(u!==void 0)if(Array.isArray(o))for(let g=0,y=f.length;g<y;g++){const x=f[g],v=o[x.materialIndex],_=Math.max(x.start,m.start),T=Math.min(u.count,Math.min(x.start+x.count,m.start+m.count));for(let w=_,S=T;w<S;w+=3){const R=w,B=w+1,I=w+2;n=_x(this,v,r,i,c,d,p,R,B,I),n&&(n.faceIndex=Math.floor(w/3),n.face.materialIndex=x.materialIndex,e.push(n))}}else{const g=Math.max(0,m.start),y=Math.min(u.count,m.start+m.count);for(let x=g,v=y;x<v;x+=3){const _=x,T=x+1,w=x+2;n=_x(this,o,r,i,c,d,p,_,T,w),n&&(n.faceIndex=Math.floor(x/3),e.push(n))}}}};function oq(r,e,i,n,s,o,l,u){let c;if(e.side===mQ?c=n.intersectTriangle(l,o,s,!0,u):c=n.intersectTriangle(s,o,l,e.side===f2,u),c===null)return null;bx.copy(u),bx.applyMatrix4(r.matrixWorld);const d=i.ray.origin.distanceTo(bx);return d<i.near||d>i.far?null:{distance:d,point:bx.clone(),object:r}}function _x(r,e,i,n,s,o,l,u,c,d){r.getVertexPosition(u,Xf),r.getVertexPosition(c,Yf),r.getVertexPosition(d,Kf);const p=oq(r,e,i,n,Xf,Yf,Kf,xx);if(p){s&&(Ax.fromBufferAttribute(s,u),yx.fromBufferAttribute(s,c),vx.fromBufferAttribute(s,d),p.uv=hx.getInterpolation(xx,Xf,Yf,Kf,Ax,yx,vx,new zs)),o&&(Ax.fromBufferAttribute(o,u),yx.fromBufferAttribute(o,c),vx.fromBufferAttribute(o,d),p.uv1=hx.getInterpolation(xx,Xf,Yf,Kf,Ax,yx,vx,new zs)),l&&(YD.fromBufferAttribute(l,u),KD.fromBufferAttribute(l,c),JD.fromBufferAttribute(l,d),p.normal=hx.getInterpolation(xx,Xf,Yf,Kf,YD,KD,JD,new Lt),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const f={a:u,b:c,c:d,normal:new Lt,materialIndex:0};hx.getNormal(Xf,Yf,Kf,f.normal),p.face=f}return p}let $D=class extends Ba{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Gr,this.projectionMatrix=new Gr,this.projectionMatrixInverse=new Gr,this.coordinateSystem=Wd}copy(r,e){return super.copy(r,e),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this.coordinateSystem=r.coordinateSystem,this}getWorldDirection(r){return super.getWorldDirection(r).negate()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,e){super.updateWorldMatrix(r,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Nh=new Lt,eO=new zs,tO=new zs;let j2=class extends $D{constructor(r=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const e=.5*this.getFilmHeight()/r;this.fov=F0*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(P0*.5*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return F0*2*Math.atan(Math.tan(P0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(r,e,i){Nh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Nh.x,Nh.y).multiplyScalar(-r/Nh.z),Nh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Nh.x,Nh.y).multiplyScalar(-r/Nh.z)}getViewSize(r,e){return this.getViewBounds(r,eO,tO),e.subVectors(tO,eO)}setViewOffset(r,e,i,n,s,o){this.aspect=r/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let e=r*Math.tan(P0*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const u=o.fullWidth,c=o.fullHeight;s+=o.offsetX*n/u,e-=o.offsetY*i/c,n*=o.width/u,i*=o.height/c}const l=this.filmOffset;l!==0&&(s+=r*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,r,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const V2=new Lt,lq=new Lt,cq=new Ch;let Jf=class{constructor(r=new Lt(1,0,0),e=0){this.isPlane=!0,this.normal=r,this.constant=e}set(r,e){return this.normal.copy(r),this.constant=e,this}setComponents(r,e,i,n){return this.normal.set(r,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(r,e){return this.normal.copy(r),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(r,e,i){const n=V2.subVectors(i,e).cross(lq.subVectors(r,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,e){return e.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,e){const i=r.delta(V2),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(r.start)===0?e.copy(r.start):null;const s=-(r.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(r.start).addScaledVector(i,s)}intersectsLine(r){const e=this.distanceToPoint(r.start),i=this.distanceToPoint(r.end);return e<0&&i>0||i<0&&e>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,e){const i=e||cq.getNormalMatrix(r),n=this.coplanarPoint(V2).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}};const Yd=new zf,Ex=new Lt;let uq=class{constructor(r=new Jf,e=new Jf,i=new Jf,n=new Jf,s=new Jf,o=new Jf){this.planes=[r,e,i,n,s,o]}set(r,e,i,n,s,o){const l=this.planes;return l[0].copy(r),l[1].copy(e),l[2].copy(i),l[3].copy(n),l[4].copy(s),l[5].copy(o),this}copy(r){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(r.planes[i]);return this}setFromProjectionMatrix(r,e=Wd){const i=this.planes,n=r.elements,s=n[0],o=n[1],l=n[2],u=n[3],c=n[4],d=n[5],p=n[6],f=n[7],m=n[8],g=n[9],y=n[10],x=n[11],v=n[12],_=n[13],T=n[14],w=n[15];if(i[0].setComponents(u-s,f-c,x-m,w-v).normalize(),i[1].setComponents(u+s,f+c,x+m,w+v).normalize(),i[2].setComponents(u+o,f+d,x+g,w+_).normalize(),i[3].setComponents(u-o,f-d,x-g,w-_).normalize(),i[4].setComponents(u-l,f-p,x-y,w-T).normalize(),e===Wd)i[5].setComponents(u+l,f+p,x+y,w+T).normalize();else if(e===x2)i[5].setComponents(l,p,y,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),Yd.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const e=r.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Yd.copy(e.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(Yd)}intersectsSprite(r){return Yd.center.set(0,0,0),Yd.radius=.7071067811865476,Yd.applyMatrix4(r.matrixWorld),this.intersectsSphere(Yd)}intersectsSphere(r){const e=this.planes,i=r.center,n=-r.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(r){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Ex.x=n.normal.x>0?r.max.x:r.min.x,Ex.y=n.normal.y>0?r.max.y:r.min.y,Ex.z=n.normal.z>0?r.max.z:r.min.z,n.distanceToPoint(Ex)<0)return!1}return!0}containsPoint(r){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}},iO=class extends $D{constructor(r=-1,e=1,i=1,n=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,e,i,n,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-r,o=i+r,l=n+e,u=n-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,l-=d*this.view.offsetY,u=l-d*this.view.height}this.projectionMatrix.makeOrthographic(s,o,l,u,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}},hq=class extends su{constructor(r,e,i,n,s,o,l,u,c,d){if(d=d!==void 0?d:g2,d!==g2&&d!==xD)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&d===g2&&(i=bQ),i===void 0&&d===xD&&(i=_Q),super(null,n,s,o,l,u,d,i,c),this.isDepthTexture=!0,this.image={width:r,height:e},this.magFilter=l!==void 0?l:$v,this.minFilter=u!==void 0?u:$v,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(r){return super.copy(r),this.compareFunction=r.compareFunction,this}toJSON(r){const e=super.toJSON(r);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}};const dq=new hq(1,1);dq.compareFunction=CQ;let rO=class extends Ba{constructor(){super(),this.isGroup=!0,this.type="Group"}};const nO=new Lt,sO=new No,aO=new No,pq=new Lt,oO=new Gr,wx=new Lt,G2=new zf,lO=new Gr,H2=new N2;class fq extends ZD{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=mD,this.bindMatrix=new Gr,this.bindMatrixInverse=new Gr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Pf),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,wx),this.boundingBox.expandByPoint(wx)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new zf),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,wx),this.boundingSphere.expandByPoint(wx)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const n=this.material,s=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),G2.copy(this.boundingSphere),G2.applyMatrix4(s),e.ray.intersectsSphere(G2)!==!1&&(lO.copy(s).invert(),H2.copy(e.ray).applyMatrix4(lO),!(this.boundingBox!==null&&H2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,H2)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new No,i=this.geometry.attributes.skinWeight;for(let n=0,s=i.count;n<s;n++){e.fromBufferAttribute(i,n);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),i.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===mD?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===gQ?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const n=this.skeleton,s=this.geometry;sO.fromBufferAttribute(s.attributes.skinIndex,e),aO.fromBufferAttribute(s.attributes.skinWeight,e),nO.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let o=0;o<4;o++){const l=aO.getComponent(o);if(l!==0){const u=sO.getComponent(o);oO.multiplyMatrices(n.bones[u].matrixWorld,n.boneInverses[u]),i.addScaledVector(pq.copy(nO).applyMatrix4(oO),l)}}return i.applyMatrix4(this.bindMatrixInverse)}}class W2 extends Ba{constructor(){super(),this.isBone=!0,this.type="Bone"}}let mq=class extends su{constructor(r=null,e=1,i=1,n,s,o,l,u,c=$v,d=$v,p,f){super(null,o,l,u,c,d,n,s,p,f),this.isDataTexture=!0,this.image={data:r,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const cO=new Gr,gq=new Gr;class Q2{constructor(e=[],i=[]){this.uuid=wh(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new Gr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const n=new Gr;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,i=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let o=0,l=e.length;o<l;o++){const u=e[o]?e[o].matrixWorld:gq;cO.multiplyMatrices(u,i[o]),cO.toArray(n,o*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Q2(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const n=new mq(i,e,e,vD,yD);return n.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=n,this}getBoneByName(e){for(let i=0,n=this.bones.length;i<n;i++){const s=this.bones[i];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const o=e.bones[n];let l=i[o];l===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),l=new W2),this.bones.push(l),this.boneInverses.push(new Gr().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,n=this.boneInverses;for(let s=0,o=i.length;s<o;s++){const l=i[s];e.bones.push(l.uuid);const u=n[s];e.boneInverses.push(u.toArray())}return e}}let uO=class extends px{constructor(r){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ws(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}};const Cx=new Lt,Sx=new Lt,hO=new Gr,H0=new N2,Tx=new zf,q2=new Lt,dO=new Lt;let Aq=class extends Ba{constructor(r=new G0,e=new uO){super(),this.isLine=!0,this.type="Line",this.geometry=r,this.material=e,this.updateMorphTargets()}copy(r,e){return super.copy(r,e),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}computeLineDistances(){const r=this.geometry;if(r.index===null){const e=r.attributes.position,i=[0];for(let n=1,s=e.count;n<s;n++)Cx.fromBufferAttribute(e,n-1),Sx.fromBufferAttribute(e,n),i[n]=i[n-1],i[n]+=Cx.distanceTo(Sx);r.setAttribute("lineDistance",new Bh(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(r,e){const i=this.geometry,n=this.matrixWorld,s=r.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Tx.copy(i.boundingSphere),Tx.applyMatrix4(n),Tx.radius+=s,r.ray.intersectsSphere(Tx)===!1)return;hO.copy(n).invert(),H0.copy(r.ray).applyMatrix4(hO);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,c=this.isLineSegments?2:1,d=i.index,p=i.attributes.position;if(d!==null){const f=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count);for(let g=f,y=m-1;g<y;g+=c){const x=d.getX(g),v=d.getX(g+1),_=Mx(this,r,H0,u,x,v);_&&e.push(_)}if(this.isLineLoop){const g=d.getX(m-1),y=d.getX(f),x=Mx(this,r,H0,u,g,y);x&&e.push(x)}}else{const f=Math.max(0,o.start),m=Math.min(p.count,o.start+o.count);for(let g=f,y=m-1;g<y;g+=c){const x=Mx(this,r,H0,u,g,g+1);x&&e.push(x)}if(this.isLineLoop){const g=Mx(this,r,H0,u,m-1,f);g&&e.push(g)}}}updateMorphTargets(){const r=this.geometry.morphAttributes,e=Object.keys(r);if(e.length>0){const i=r[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}};function Mx(r,e,i,n,s,o){const l=r.geometry.attributes.position;if(Cx.fromBufferAttribute(l,s),Sx.fromBufferAttribute(l,o),i.distanceSqToSegment(Cx,Sx,q2,dO)>n)return;q2.applyMatrix4(r.matrixWorld);const u=e.ray.origin.distanceTo(q2);if(!(u<e.near||u>e.far))return{distance:u,point:dO.clone().applyMatrix4(r.matrixWorld),index:s,face:null,faceIndex:null,object:r}}let yq=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(r,e){const i=this.getUtoTmapping(r);return this.getPoint(i,e)}getPoints(r=5){const e=[];for(let i=0;i<=r;i++)e.push(this.getPoint(i/r));return e}getSpacedPoints(r=5){const e=[];for(let i=0;i<=r;i++)e.push(this.getPointAt(i/r));return e}getLength(){const r=this.getLengths();return r[r.length-1]}getLengths(r=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===r+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),s=0;e.push(0);for(let o=1;o<=r;o++)i=this.getPoint(o/r),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(r,e){const i=this.getLengths();let n=0;const s=i.length;let o;e?o=e:o=r*i[s-1];let l=0,u=s-1,c;for(;l<=u;)if(n=Math.floor(l+(u-l)/2),c=i[n]-o,c<0)l=n+1;else if(c>0)u=n-1;else{u=n;break}if(n=u,i[n]===o)return n/(s-1);const d=i[n],p=i[n+1]-d,f=(o-d)/p;return(n+f)/(s-1)}getTangent(r,e){let i=r-1e-4,n=r+1e-4;i<0&&(i=0),n>1&&(n=1);const s=this.getPoint(i),o=this.getPoint(n),l=e||(s.isVector2?new zs:new Lt);return l.copy(o).sub(s).normalize(),l}getTangentAt(r,e){const i=this.getUtoTmapping(r);return this.getTangent(i,e)}computeFrenetFrames(r,e){const i=new Lt,n=[],s=[],o=[],l=new Lt,u=new Gr;for(let m=0;m<=r;m++){const g=m/r;n[m]=this.getTangentAt(g,new Lt)}s[0]=new Lt,o[0]=new Lt;let c=Number.MAX_VALUE;const d=Math.abs(n[0].x),p=Math.abs(n[0].y),f=Math.abs(n[0].z);d<=c&&(c=d,i.set(1,0,0)),p<=c&&(c=p,i.set(0,1,0)),f<=c&&i.set(0,0,1),l.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],l),o[0].crossVectors(n[0],s[0]);for(let m=1;m<=r;m++){if(s[m]=s[m-1].clone(),o[m]=o[m-1].clone(),l.crossVectors(n[m-1],n[m]),l.length()>Number.EPSILON){l.normalize();const g=Math.acos(Ia(n[m-1].dot(n[m]),-1,1));s[m].applyMatrix4(u.makeRotationAxis(l,g))}o[m].crossVectors(n[m],s[m])}if(e===!0){let m=Math.acos(Ia(s[0].dot(s[r]),-1,1));m/=r,n[0].dot(l.crossVectors(s[0],s[r]))>0&&(m=-m);for(let g=1;g<=r;g++)s[g].applyMatrix4(u.makeRotationAxis(n[g],m*g)),o[g].crossVectors(n[g],s[g])}return{tangents:n,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}toJSON(){const r={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return r.arcLengthDivisions=this.arcLengthDivisions,r.type=this.type,r}fromJSON(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}};const vq={triangulate:function(r,e,i=2){const n=e&&e.length,s=n?e[0]*i:r.length;let o=pO(r,0,s,i,!0);const l=[];if(!o||o.next===o.prev)return l;let u,c,d,p,f,m,g;if(n&&(o=wq(r,e,o,i)),r.length>80*i){u=d=r[0],c=p=r[1];for(let y=i;y<s;y+=i)f=r[y],m=r[y+1],f<u&&(u=f),m<c&&(c=m),f>d&&(d=f),m>p&&(p=m);g=Math.max(d-u,p-c),g=g!==0?32767/g:0}return W0(o,l,i,u,c,g,0),l}};function pO(r,e,i,n,s){let o,l;if(s===Oq(r,e,i,n)>0)for(o=e;o<i;o+=n)l=gO(o,r[o],r[o+1],l);else for(o=i-n;o>=e;o-=n)l=gO(o,r[o],r[o+1],l);return l&&Rx(l,l.next)&&(q0(l),l=l.next),l}function Kd(r,e){if(!r)return r;e||(e=r);let i=r,n;do if(n=!1,!i.steiner&&(Rx(i,i.next)||Ss(i.prev,i,i.next)===0)){if(q0(i),i=e=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==e);return e}function W0(r,e,i,n,s,o,l){if(!r)return;!l&&o&&Rq(r,n,s,o);let u=r,c,d;for(;r.prev!==r.next;){if(c=r.prev,d=r.next,o?bq(r,n,s,o):xq(r)){e.push(c.i/i|0),e.push(r.i/i|0),e.push(d.i/i|0),q0(r),r=d.next,u=d.next;continue}if(r=d,r===u){l?l===1?(r=_q(Kd(r),e,i),W0(r,e,i,n,s,o,2)):l===2&&Eq(r,e,i,n,s,o):W0(Kd(r),e,i,n,s,o,1);break}}}function xq(r){const e=r.prev,i=r,n=r.next;if(Ss(e,i,n)>=0)return!1;const s=e.x,o=i.x,l=n.x,u=e.y,c=i.y,d=n.y,p=s<o?s<l?s:l:o<l?o:l,f=u<c?u<d?u:d:c<d?c:d,m=s>o?s>l?s:l:o>l?o:l,g=u>c?u>d?u:d:c>d?c:d;let y=n.next;for(;y!==e;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&Zf(s,u,o,c,l,d,y.x,y.y)&&Ss(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function bq(r,e,i,n){const s=r.prev,o=r,l=r.next;if(Ss(s,o,l)>=0)return!1;const u=s.x,c=o.x,d=l.x,p=s.y,f=o.y,m=l.y,g=u<c?u<d?u:d:c<d?c:d,y=p<f?p<m?p:m:f<m?f:m,x=u>c?u>d?u:d:c>d?c:d,v=p>f?p>m?p:m:f>m?f:m,_=X2(g,y,e,i,n),T=X2(x,v,e,i,n);let w=r.prevZ,S=r.nextZ;for(;w&&w.z>=_&&S&&S.z<=T;){if(w.x>=g&&w.x<=x&&w.y>=y&&w.y<=v&&w!==s&&w!==l&&Zf(u,p,c,f,d,m,w.x,w.y)&&Ss(w.prev,w,w.next)>=0||(w=w.prevZ,S.x>=g&&S.x<=x&&S.y>=y&&S.y<=v&&S!==s&&S!==l&&Zf(u,p,c,f,d,m,S.x,S.y)&&Ss(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;w&&w.z>=_;){if(w.x>=g&&w.x<=x&&w.y>=y&&w.y<=v&&w!==s&&w!==l&&Zf(u,p,c,f,d,m,w.x,w.y)&&Ss(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;S&&S.z<=T;){if(S.x>=g&&S.x<=x&&S.y>=y&&S.y<=v&&S!==s&&S!==l&&Zf(u,p,c,f,d,m,S.x,S.y)&&Ss(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function _q(r,e,i){let n=r;do{const s=n.prev,o=n.next.next;!Rx(s,o)&&fO(s,n,n.next,o)&&Q0(s,o)&&Q0(o,s)&&(e.push(s.i/i|0),e.push(n.i/i|0),e.push(o.i/i|0),q0(n),q0(n.next),n=r=o),n=n.next}while(n!==r);return Kd(n)}function Eq(r,e,i,n,s,o){let l=r;do{let u=l.next.next;for(;u!==l.prev;){if(l.i!==u.i&&Nq(l,u)){let c=mO(l,u);l=Kd(l,l.next),c=Kd(c,c.next),W0(l,e,i,n,s,o,0),W0(c,e,i,n,s,o,0);return}u=u.next}l=l.next}while(l!==r)}function wq(r,e,i,n){const s=[];let o,l,u,c,d;for(o=0,l=e.length;o<l;o++)u=e[o]*n,c=o<l-1?e[o+1]*n:r.length,d=pO(r,u,c,n,!1),d===d.next&&(d.steiner=!0),s.push(Bq(d));for(s.sort(Cq),o=0;o<s.length;o++)i=Sq(s[o],i);return i}function Cq(r,e){return r.x-e.x}function Sq(r,e){const i=Tq(r,e);if(!i)return e;const n=mO(i,r);return Kd(n,n.next),Kd(i,i.next)}function Tq(r,e){let i=e,n=-1/0,s;const o=r.x,l=r.y;do{if(l<=i.y&&l>=i.next.y&&i.next.y!==i.y){const m=i.x+(l-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(m<=o&&m>n&&(n=m,s=i.x<i.next.x?i:i.next,m===o))return s}i=i.next}while(i!==e);if(!s)return null;const u=s,c=s.x,d=s.y;let p=1/0,f;i=s;do o>=i.x&&i.x>=c&&o!==i.x&&Zf(l<d?o:n,l,c,d,l<d?n:o,l,i.x,i.y)&&(f=Math.abs(l-i.y)/(o-i.x),Q0(i,r)&&(f<p||f===p&&(i.x>s.x||i.x===s.x&&Mq(s,i)))&&(s=i,p=f)),i=i.next;while(i!==u);return s}function Mq(r,e){return Ss(r.prev,r,e.prev)<0&&Ss(e.next,r,r.next)<0}function Rq(r,e,i,n){let s=r;do s.z===0&&(s.z=X2(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,Iq(s)}function Iq(r){let e,i,n,s,o,l,u,c,d=1;do{for(i=r,r=null,o=null,l=0;i;){for(l++,n=i,u=0,e=0;e<d&&(u++,n=n.nextZ,!!n);e++);for(c=d;u>0||c>0&&n;)u!==0&&(c===0||!n||i.z<=n.z)?(s=i,i=i.nextZ,u--):(s=n,n=n.nextZ,c--),o?o.nextZ=s:r=s,s.prevZ=o,o=s;i=n}o.nextZ=null,d*=2}while(l>1);return r}function X2(r,e,i,n,s){return r=(r-i)*s|0,e=(e-n)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function Bq(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Zf(r,e,i,n,s,o,l,u){return(s-l)*(e-u)>=(r-l)*(o-u)&&(r-l)*(n-u)>=(i-l)*(e-u)&&(i-l)*(o-u)>=(s-l)*(n-u)}function Nq(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!Lq(r,e)&&(Q0(r,e)&&Q0(e,r)&&Dq(r,e)&&(Ss(r.prev,r,e.prev)||Ss(r,e.prev,e))||Rx(r,e)&&Ss(r.prev,r,r.next)>0&&Ss(e.prev,e,e.next)>0)}function Ss(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Rx(r,e){return r.x===e.x&&r.y===e.y}function fO(r,e,i,n){const s=Bx(Ss(r,e,i)),o=Bx(Ss(r,e,n)),l=Bx(Ss(i,n,r)),u=Bx(Ss(i,n,e));return!!(s!==o&&l!==u||s===0&&Ix(r,i,e)||o===0&&Ix(r,n,e)||l===0&&Ix(i,r,n)||u===0&&Ix(i,e,n))}function Ix(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Bx(r){return r>0?1:r<0?-1:0}function Lq(r,e){let i=r;do{if(i.i!==r.i&&i.next.i!==r.i&&i.i!==e.i&&i.next.i!==e.i&&fO(i,i.next,r,e))return!0;i=i.next}while(i!==r);return!1}function Q0(r,e){return Ss(r.prev,r,r.next)<0?Ss(r,e,r.next)>=0&&Ss(r,r.prev,e)>=0:Ss(r,e,r.prev)<0||Ss(r,r.next,e)<0}function Dq(r,e){let i=r,n=!1;const s=(r.x+e.x)/2,o=(r.y+e.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&s<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==r);return n}function mO(r,e){const i=new Y2(r.i,r.x,r.y),n=new Y2(e.i,e.x,e.y),s=r.next,o=e.prev;return r.next=e,e.prev=r,i.next=s,s.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function gO(r,e,i,n){const s=new Y2(r,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function q0(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Y2(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Oq(r,e,i,n){let s=0;for(let o=e,l=i-n;o<i;o+=n)s+=(r[l]-r[o])*(r[o+1]+r[l+1]),l=o;return s}class K2{static area(e){const i=e.length;let n=0;for(let s=i-1,o=0;o<i;s=o++)n+=e[s].x*e[o].y-e[o].x*e[s].y;return n*.5}static isClockWise(e){return K2.area(e)<0}static triangulateShape(e,i){const n=[],s=[],o=[];AO(e),yO(n,e);let l=e.length;i.forEach(AO);for(let c=0;c<i.length;c++)s.push(l),l+=i[c].length,yO(n,i[c]);const u=vq.triangulate(n,s);for(let c=0;c<u.length;c+=3)o.push(u.slice(c,c+3));return o}}function AO(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function yO(r,e){for(let i=0;i<e.length;i++)r.push(e[i].x),r.push(e[i].y)}let J2=class extends px{constructor(r){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ws(16777215),this.specular=new Ws(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ws(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wD,this.normalScale=new zs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new co,this.combine=m2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.specular.copy(r.specular),this.shininess=r.shininess,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}},Pq=class extends px{constructor(r){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ws(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ws(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wD,this.normalScale=new zs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new co,this.combine=m2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}};function Nx(r,e,i){return!r||r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)}function Fq(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function kq(r){function e(s,o){return r[s]-r[o]}const i=r.length,n=new Array(i);for(let s=0;s!==i;++s)n[s]=s;return n.sort(e),n}function vO(r,e,i){const n=r.length,s=new r.constructor(n);for(let o=0,l=0;l!==n;++o){const u=i[o]*e;for(let c=0;c!==e;++c)s[l++]=r[u+c]}return s}function xO(r,e,i,n){let s=1,o=r[0];for(;o!==void 0&&o[n]===void 0;)o=r[s++];if(o===void 0)return;let l=o[n];if(l!==void 0)if(Array.isArray(l))do l=o[n],l!==void 0&&(e.push(o.time),i.push.apply(i,l)),o=r[s++];while(o!==void 0);else if(l.toArray!==void 0)do l=o[n],l!==void 0&&(e.push(o.time),l.toArray(i,i.length)),o=r[s++];while(o!==void 0);else do l=o[n],l!==void 0&&(e.push(o.time),i.push(l)),o=r[s++];while(o!==void 0)}class Lx{constructor(e,i,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new i.constructor(n),this.sampleValues=i,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let n=this._cachedIndex,s=i[n],o=i[n-1];i:{e:{let l;t:{r:if(!(e<s)){for(let u=n+2;;){if(s===void 0){if(e<o)break r;return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===u)break;if(o=s,s=i[++n],e<s)break e}l=i.length;break t}if(!(e>=o)){const u=i[1];e<u&&(n=2,o=u);for(let c=n-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(s=o,o=i[--n-1],e>=o)break e}l=n,n=0;break t}break i}for(;n<l;){const u=n+l>>>1;e<i[u]?l=u:n=u+1}if(s=i[n],o=i[n-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,o,s)}return this.interpolate_(n,o,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,n=this.sampleValues,s=this.valueSize,o=e*s;for(let l=0;l!==s;++l)i[l]=n[o+l];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Uq extends Lx{constructor(e,i,n,s){super(e,i,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:bD,endingEnd:bD}}intervalChanged_(e,i,n){const s=this.parameterPositions;let o=e-2,l=e+1,u=s[o],c=s[l];if(u===void 0)switch(this.getSettings_().endingStart){case _D:o=e,u=2*i-n;break;case ED:o=s.length-2,u=i+s[o]-s[o+1];break;default:o=e,u=n}if(c===void 0)switch(this.getSettings_().endingEnd){case _D:l=e,c=2*n-i;break;case ED:l=1,c=n+s[1]-s[0];break;default:l=e-1,c=i}const d=(n-i)*.5,p=this.valueSize;this._weightPrev=d/(i-u),this._weightNext=d/(c-n),this._offsetPrev=o*p,this._offsetNext=l*p}interpolate_(e,i,n,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,c=e*u,d=c-u,p=this._offsetPrev,f=this._offsetNext,m=this._weightPrev,g=this._weightNext,y=(n-i)/(s-i),x=y*y,v=x*y,_=-m*v+2*m*x-m*y,T=(1+m)*v+(-1.5-2*m)*x+(-.5+m)*y+1,w=(-1-g)*v+(1.5+g)*x+.5*y,S=g*v-g*x;for(let R=0;R!==u;++R)o[R]=_*l[p+R]+T*l[d+R]+w*l[c+R]+S*l[f+R];return o}}class zq extends Lx{constructor(e,i,n,s){super(e,i,n,s)}interpolate_(e,i,n,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,c=e*u,d=c-u,p=(n-i)/(s-i),f=1-p;for(let m=0;m!==u;++m)o[m]=l[d+m]*f+l[c+m]*p;return o}}class jq extends Lx{constructor(e,i,n,s){super(e,i,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ic{constructor(e,i,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Nx(i,this.TimeBufferType),this.values=Nx(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let n;if(i.toJSON!==this.toJSON)n=i.toJSON(e);else{n={name:e.name,times:Nx(e.times,Array),values:Nx(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new jq(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new zq(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Uq(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case ex:i=this.InterpolantFactoryMethodDiscrete;break;case tx:i=this.InterpolantFactoryMethodLinear;break;case A2:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ex;case this.InterpolantFactoryMethodLinear:return tx;case this.InterpolantFactoryMethodSmooth:return A2}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let n=0,s=i.length;n!==s;++n)i[n]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let n=0,s=i.length;n!==s;++n)i[n]*=e}return this}trim(e,i){const n=this.times,s=n.length;let o=0,l=s-1;for(;o!==s&&n[o]<e;)++o;for(;l!==-1&&n[l]>i;)--l;if(++l,o!==0||l!==s){o>=l&&(l=Math.max(l,1),o=l-1);const u=this.getValueSize();this.times=n.slice(o,l),this.values=this.values.slice(o*u,l*u)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,o=n.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let l=null;for(let u=0;u!==o;u++){const c=n[u];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,u,c),e=!1;break}if(l!==null&&l>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,u,c,l),e=!1;break}l=c}if(s!==void 0&&Fq(s))for(let u=0,c=s.length;u!==c;++u){const d=s[u];if(isNaN(d)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,d),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),n=this.getValueSize(),s=this.getInterpolation()===A2,o=e.length-1;let l=1;for(let u=1;u<o;++u){let c=!1;const d=e[u],p=e[u+1];if(d!==p&&(u!==1||d!==e[0]))if(s)c=!0;else{const f=u*n,m=f-n,g=f+n;for(let y=0;y!==n;++y){const x=i[f+y];if(x!==i[m+y]||x!==i[g+y]){c=!0;break}}}if(c){if(u!==l){e[l]=e[u];const f=u*n,m=l*n;for(let g=0;g!==n;++g)i[m+g]=i[f+g]}++l}}if(o>0){e[l]=e[o];for(let u=o*n,c=l*n,d=0;d!==n;++d)i[c+d]=i[u+d];++l}return l!==e.length?(this.times=e.slice(0,l),this.values=i.slice(0,l*n)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),n=this.constructor,s=new n(this.name,e,i);return s.createInterpolant=this.createInterpolant,s}}Ic.prototype.TimeBufferType=Float32Array,Ic.prototype.ValueBufferType=Float32Array,Ic.prototype.DefaultInterpolation=tx;class $f extends Ic{}$f.prototype.ValueTypeName="bool",$f.prototype.ValueBufferType=Array,$f.prototype.DefaultInterpolation=ex,$f.prototype.InterpolantFactoryMethodLinear=void 0,$f.prototype.InterpolantFactoryMethodSmooth=void 0;class bO extends Ic{}bO.prototype.ValueTypeName="color";class X0 extends Ic{}X0.prototype.ValueTypeName="number";class Vq extends Lx{constructor(e,i,n,s){super(e,i,n,s)}interpolate_(e,i,n,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,c=(n-i)/(s-i);let d=e*u;for(let p=d+u;d!==p;d+=4)Lo.slerpFlat(o,0,l,d-u,l,d,c);return o}}class Jd extends Ic{InterpolantFactoryMethodLinear(e){return new Vq(this.times,this.values,this.getValueSize(),e)}}Jd.prototype.ValueTypeName="quaternion",Jd.prototype.DefaultInterpolation=tx,Jd.prototype.InterpolantFactoryMethodSmooth=void 0;class em extends Ic{}em.prototype.ValueTypeName="string",em.prototype.ValueBufferType=Array,em.prototype.DefaultInterpolation=ex,em.prototype.InterpolantFactoryMethodLinear=void 0,em.prototype.InterpolantFactoryMethodSmooth=void 0;class Y0 extends Ic{}Y0.prototype.ValueTypeName="vector";class Gq{constructor(e="",i=-1,n=[],s=EQ){this.name=e,this.tracks=n,this.duration=i,this.blendMode=s,this.uuid=wh(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],n=e.tracks,s=1/(e.fps||1);for(let l=0,u=n.length;l!==u;++l)i.push(Wq(n[l]).scale(s));const o=new this(e.name,e.duration,i,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const i=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,l=n.length;o!==l;++o)i.push(Ic.toJSON(n[o]));return s}static CreateFromMorphTargetSequence(e,i,n,s){const o=i.length,l=[];for(let u=0;u<o;u++){let c=[],d=[];c.push((u+o-1)%o,u,(u+1)%o),d.push(0,1,0);const p=kq(c);c=vO(c,1,p),d=vO(d,1,p),!s&&c[0]===0&&(c.push(o),d.push(d[0])),l.push(new X0(".morphTargetInfluences["+i[u].name+"]",c,d).scale(1/n))}return new this(e,-1,l)}static findByName(e,i){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===i)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,i,n){const s={},o=/^([\w-]*?)([\d]+)$/;for(let u=0,c=e.length;u<c;u++){const d=e[u],p=d.name.match(o);if(p&&p.length>1){const f=p[1];let m=s[f];m||(s[f]=m=[]),m.push(d)}}const l=[];for(const u in s)l.push(this.CreateFromMorphTargetSequence(u,s[u],i,n));return l}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(p,f,m,g,y){if(m.length!==0){const x=[],v=[];xO(m,x,v,g),x.length!==0&&y.push(new p(f,x,v))}},s=[],o=e.name||"default",l=e.fps||30,u=e.blendMode;let c=e.length||-1;const d=e.hierarchy||[];for(let p=0;p<d.length;p++){const f=d[p].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const m={};let g;for(g=0;g<f.length;g++)if(f[g].morphTargets)for(let y=0;y<f[g].morphTargets.length;y++)m[f[g].morphTargets[y]]=-1;for(const y in m){const x=[],v=[];for(let _=0;_!==f[g].morphTargets.length;++_){const T=f[g];x.push(T.time),v.push(T.morphTarget===y?1:0)}s.push(new X0(".morphTargetInfluence["+y+"]",x,v))}c=m.length*l}else{const m=".bones["+i[p].name+"]";n(Y0,m+".position",f,"pos",s),n(Jd,m+".quaternion",f,"rot",s),n(Y0,m+".scale",f,"scl",s)}}return s.length===0?null:new this(o,c,s,u)}resetDuration(){const e=this.tracks;let i=0;for(let n=0,s=e.length;n!==s;++n){const o=this.tracks[n];i=Math.max(i,o.times[o.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Hq(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return X0;case"vector":case"vector2":case"vector3":case"vector4":return Y0;case"color":return bO;case"quaternion":return Jd;case"bool":case"boolean":return $f;case"string":return em}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function Wq(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Hq(r.type);if(r.times===void 0){const i=[],n=[];xO(r.keys,i,n,"value"),r.times=i,r.values=n}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const Dx={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};let Qq=class{constructor(r,e,i){const n=this;let s=!1,o=0,l=0,u;const c=[];this.onStart=void 0,this.onLoad=r,this.onProgress=e,this.onError=i,this.itemStart=function(d){l++,s===!1&&n.onStart!==void 0&&n.onStart(d,o,l),s=!0},this.itemEnd=function(d){o++,n.onProgress!==void 0&&n.onProgress(d,o,l),o===l&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(d){n.onError!==void 0&&n.onError(d)},this.resolveURL=function(d){return u?u(d):d},this.setURLModifier=function(d){return u=d,this},this.addHandler=function(d,p){return c.push(d,p),this},this.removeHandler=function(d){const p=c.indexOf(d);return p!==-1&&c.splice(p,2),this},this.getHandler=function(d){for(let p=0,f=c.length;p<f;p+=2){const m=c[p],g=c[p+1];if(m.global&&(m.lastIndex=0),m.test(d))return g}return null}}};const qq=new Qq;let Zd=class{constructor(r){this.manager=r!==void 0?r:qq,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,e){const i=this;return new Promise(function(n,s){i.load(r,n,e,s)})}parse(){}setCrossOrigin(r){return this.crossOrigin=r,this}setWithCredentials(r){return this.withCredentials=r,this}setPath(r){return this.path=r,this}setResourcePath(r){return this.resourcePath=r,this}setRequestHeader(r){return this.requestHeader=r,this}};Zd.DEFAULT_MATERIAL_NAME="__DEFAULT";const hu={};class Xq extends Error{constructor(e,i){super(e),this.response=i}}class Yq extends Zd{constructor(e){super(e)}load(e,i,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=Dx.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(o),this.manager.itemEnd(e)},0),o;if(hu[e]!==void 0){hu[e].push({onLoad:i,onProgress:n,onError:s});return}hu[e]=[],hu[e].push({onLoad:i,onProgress:n,onError:s});const l=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),u=this.mimeType,c=this.responseType;fetch(l).then(d=>{if(d.status===200||d.status===0){if(d.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||d.body===void 0||d.body.getReader===void 0)return d;const p=hu[e],f=d.body.getReader(),m=d.headers.get("X-File-Size")||d.headers.get("Content-Length"),g=m?parseInt(m):0,y=g!==0;let x=0;const v=new ReadableStream({start(_){T();function T(){f.read().then(({done:w,value:S})=>{if(w)_.close();else{x+=S.byteLength;const R=new ProgressEvent("progress",{lengthComputable:y,loaded:x,total:g});for(let B=0,I=p.length;B<I;B++){const D=p[B];D.onProgress&&D.onProgress(R)}_.enqueue(S),T()}})}}});return new Response(v)}else throw new Xq(`fetch for "${d.url}" responded with ${d.status}: ${d.statusText}`,d)}).then(d=>{switch(c){case"arraybuffer":return d.arrayBuffer();case"blob":return d.blob();case"document":return d.text().then(p=>new DOMParser().parseFromString(p,u));case"json":return d.json();default:if(u===void 0)return d.text();{const p=/charset="?([^;"\s]*)"?/i.exec(u),f=p&&p[1]?p[1].toLowerCase():void 0,m=new TextDecoder(f);return d.arrayBuffer().then(g=>m.decode(g))}}}).then(d=>{Dx.add(e,d);const p=hu[e];delete hu[e];for(let f=0,m=p.length;f<m;f++){const g=p[f];g.onLoad&&g.onLoad(d)}}).catch(d=>{const p=hu[e];if(p===void 0)throw this.manager.itemError(e),d;delete hu[e];for(let f=0,m=p.length;f<m;f++){const g=p[f];g.onError&&g.onError(d)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}let Kq=class extends Zd{constructor(r){super(r)}load(r,e,i,n){this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const s=this,o=Dx.get(r);if(o!==void 0)return s.manager.itemStart(r),setTimeout(function(){e&&e(o),s.manager.itemEnd(r)},0),o;const l=E2("img");function u(){d(),Dx.add(r,this),e&&e(this),s.manager.itemEnd(r)}function c(p){d(),n&&n(p),s.manager.itemError(r),s.manager.itemEnd(r)}function d(){l.removeEventListener("load",u,!1),l.removeEventListener("error",c,!1)}return l.addEventListener("load",u,!1),l.addEventListener("error",c,!1),r.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),s.manager.itemStart(r),l.src=r,l}},Jq=class extends Zd{constructor(r){super(r)}load(r,e,i,n){const s=new su,o=new Kq(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(r,function(l){s.image=l,s.needsUpdate=!0,e!==void 0&&e(s)},i,n),s}},Ox=class extends Ba{constructor(r,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Ws(r),this.intensity=e}dispose(){}copy(r,e){return super.copy(r,e),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const e=super.toJSON(r);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}};const Z2=new Gr,_O=new Lt,EO=new Lt;let $2=class{constructor(r){this.camera=r,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new zs(512,512),this.map=null,this.mapPass=null,this.matrix=new Gr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new uq,this._frameExtents=new zs(1,1),this._viewportCount=1,this._viewports=[new No(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const e=this.camera,i=this.matrix;_O.setFromMatrixPosition(r.matrixWorld),e.position.copy(_O),EO.setFromMatrixPosition(r.target.matrixWorld),e.lookAt(EO),e.updateMatrixWorld(),Z2.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Z2),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Z2)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.bias=r.bias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}},Zq=class extends $2{constructor(){super(new j2(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(r){const e=this.camera,i=F0*2*r.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=r.distance||e.far;(i!==e.fov||n!==e.aspect||s!==e.far)&&(e.fov=i,e.aspect=n,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(r)}copy(r){return super.copy(r),this.focus=r.focus,this}},$q=class extends Ox{constructor(r,e,i=0,n=Math.PI/3,s=0,o=2){super(r,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ba.DEFAULT_UP),this.updateMatrix(),this.target=new Ba,this.distance=i,this.angle=n,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new Zq}get power(){return this.intensity*Math.PI}set power(r){this.intensity=r/Math.PI}dispose(){this.shadow.dispose()}copy(r,e){return super.copy(r,e),this.distance=r.distance,this.angle=r.angle,this.penumbra=r.penumbra,this.decay=r.decay,this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}};const wO=new Gr,K0=new Lt,eC=new Lt;let eX=class extends $2{constructor(){super(new j2(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new zs(4,2),this._viewportCount=6,this._viewports=[new No(2,1,1,1),new No(0,1,1,1),new No(3,1,1,1),new No(1,1,1,1),new No(3,0,1,1),new No(1,0,1,1)],this._cubeDirections=[new Lt(1,0,0),new Lt(-1,0,0),new Lt(0,0,1),new Lt(0,0,-1),new Lt(0,1,0),new Lt(0,-1,0)],this._cubeUps=[new Lt(0,1,0),new Lt(0,1,0),new Lt(0,1,0),new Lt(0,1,0),new Lt(0,0,1),new Lt(0,0,-1)]}updateMatrices(r,e=0){const i=this.camera,n=this.matrix,s=r.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),K0.setFromMatrixPosition(r.matrixWorld),i.position.copy(K0),eC.copy(i.position),eC.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(eC),i.updateMatrixWorld(),n.makeTranslation(-K0.x,-K0.y,-K0.z),wO.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(wO)}},CO=class extends Ox{constructor(r,e,i=0,n=2){super(r,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new eX}get power(){return this.intensity*4*Math.PI}set power(r){this.intensity=r/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(r,e){return super.copy(r,e),this.distance=r.distance,this.decay=r.decay,this.shadow=r.shadow.clone(),this}},tX=class extends $2{constructor(){super(new iO(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},iX=class extends Ox{constructor(r,e){super(r,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ba.DEFAULT_UP),this.updateMatrix(),this.target=new Ba,this.shadow=new tX}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}},rX=class extends Ox{constructor(r,e){super(r,e),this.isAmbientLight=!0,this.type="AmbientLight"}};class nX{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let i="";for(let n=0,s=e.length;n<s;n++)i+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}const tC="\\[\\]\\.:\\/",sX=new RegExp("["+tC+"]","g"),iC="[^"+tC+"]",aX="[^"+tC.replace("\\.","")+"]",oX=/((?:WC+[\/:])*)/.source.replace("WC",iC),lX=/(WCOD+)?/.source.replace("WCOD",aX),cX=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",iC),uX=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",iC),hX=new RegExp("^"+oX+lX+cX+uX+"$"),dX=["material","materials","bones","map"];class pX{constructor(e,i,n){const s=n||zn.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,s)}getValue(e,i){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,i)}setValue(e,i){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,o=n.length;s!==o;++s)n[s].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].unbind()}}class zn{constructor(e,i,n){this.path=i,this.parsedPath=n||zn.parseTrackName(i),this.node=zn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,n){return e&&e.isAnimationObjectGroup?new zn.Composite(e,i,n):new zn(e,i,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(sX,"")}static parseTrackName(e){const i=hX.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const o=n.nodeName.substring(s+1);dX.indexOf(o)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=o)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(i);if(n!==void 0)return n}if(e.children){const n=function(o){for(let l=0;l<o.length;l++){const u=o[l];if(u.name===i||u.uuid===i)return u;const c=n(u.children);if(c)return c}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)e[i++]=n[s]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,n=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(e||(e=zn.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let d=i.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let p=0;p<e.length;p++)if(e[p].name===d){d=p;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(d!==void 0){if(e[d]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[d]}}const l=e[s];if(l===void 0){const d=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+d+"."+s+" but it wasn't found.",e);return}let u=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?u=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(u=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(o!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=o}else l.fromArray!==void 0&&l.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(c=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}zn.Composite=pX,zn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},zn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},zn.prototype.GetterByBindingType=[zn.prototype._getValue_direct,zn.prototype._getValue_array,zn.prototype._getValue_arrayElement,zn.prototype._getValue_toArray],zn.prototype.SetterByBindingTypeAndVersioning=[[zn.prototype._setValue_direct,zn.prototype._setValue_direct_setNeedsUpdate,zn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[zn.prototype._setValue_array,zn.prototype._setValue_array_setNeedsUpdate,zn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[zn.prototype._setValue_arrayElement,zn.prototype._setValue_arrayElement_setNeedsUpdate,zn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[zn.prototype._setValue_fromArray,zn.prototype._setValue_fromArray_setNeedsUpdate,zn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:cD}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=cD);/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Cl=Uint8Array,J0=Uint16Array,fX=Int32Array,SO=new Cl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),TO=new Cl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),mX=new Cl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),MO=function(r,e){for(var i=new J0(31),n=0;n<31;++n)i[n]=e+=1<<r[n-1];for(var s=new fX(i[30]),n=1;n<30;++n)for(var o=i[n];o<i[n+1];++o)s[o]=o-i[n]<<5|n;return{b:i,r:s}},RO=MO(SO,2),IO=RO.b,gX=RO.r;IO[28]=258,gX[258]=28;for(var AX=MO(TO,0),yX=AX.b,BO=new J0(32768),ds=0;ds<32768;++ds){var Lh=(ds&43690)>>1|(ds&21845)<<1;Lh=(Lh&52428)>>2|(Lh&13107)<<2,Lh=(Lh&61680)>>4|(Lh&3855)<<4,BO[ds]=((Lh&65280)>>8|(Lh&255)<<8)>>1}for(var Z0=function(r,e,i){for(var n=r.length,s=0,o=new J0(e);s<n;++s)r[s]&&++o[r[s]-1];var l=new J0(e);for(s=1;s<e;++s)l[s]=l[s-1]+o[s-1]<<1;var u;{u=new J0(1<<e);var c=15-e;for(s=0;s<n;++s)if(r[s])for(var d=s<<4|r[s],p=e-r[s],f=l[r[s]-1]++<<p,m=f|(1<<p)-1;f<=m;++f)u[BO[f]>>c]=d}return u},$0=new Cl(288),ds=0;ds<144;++ds)$0[ds]=8;for(var ds=144;ds<256;++ds)$0[ds]=9;for(var ds=256;ds<280;++ds)$0[ds]=7;for(var ds=280;ds<288;++ds)$0[ds]=8;for(var NO=new Cl(32),ds=0;ds<32;++ds)NO[ds]=5;var vX=Z0($0,9),xX=Z0(NO,5),rC=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},Xl=function(r,e,i){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&i},nC=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(e&7)},bX=function(r){return(r+7)/8|0},_X=function(r,e,i){return(i==null||i>r.length)&&(i=r.length),new Cl(r.subarray(e,i))},EX=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Yl=function(r,e,i){var n=new Error(e||EX[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Yl),!i)throw n;return n},wX=function(r,e,i,n){var s=r.length,o=0;if(!s||e.f&&!e.l)return i||new Cl(0);var l=!i,u=l||e.i!=2,c=e.i;l&&(i=new Cl(s*3));var d=function(Gt){var gt=i.length;if(Gt>gt){var yi=new Cl(Math.max(gt*2,Gt));yi.set(i),i=yi}},p=e.f||0,f=e.p||0,m=e.b||0,g=e.l,y=e.d,x=e.m,v=e.n,_=s*8;do{if(!g){p=Xl(r,f,1);var T=Xl(r,f+1,3);if(f+=3,T)if(T==1)g=vX,y=xX,x=9,v=5;else if(T==2){var w=Xl(r,f,31)+257,S=Xl(r,f+10,15)+4,R=w+Xl(r,f+5,31)+1;f+=14;for(var B=new Cl(R),I=new Cl(19),D=0;D<S;++D)I[mX[D]]=Xl(r,f+D*3,7);f+=S*3;for(var L=rC(I),O=(1<<L)-1,U=Z0(I,L),D=0;D<R;){var J=U[Xl(r,f,O)];f+=J&15;var H=J>>4;if(H<16)B[D++]=H;else{var V=0,$=0;for(H==16?($=3+Xl(r,f,3),f+=2,V=B[D-1]):H==17?($=3+Xl(r,f,7),f+=3):H==18&&($=11+Xl(r,f,127),f+=7);$--;)B[D++]=V}}var Q=B.subarray(0,w),G=B.subarray(w);x=rC(Q),v=rC(G),g=Z0(Q,x),y=Z0(G,v)}else Yl(1);else{var H=bX(f)+4,j=r[H-4]|r[H-3]<<8,ie=H+j;if(ie>s){c&&Yl(0);break}u&&d(m+j),i.set(r.subarray(H,ie),m),e.b=m+=j,e.p=f=ie*8,e.f=p;continue}if(f>_){c&&Yl(0);break}}u&&d(m+131072);for(var Y=(1<<x)-1,ae=(1<<v)-1,xe=f;;xe=f){var V=g[nC(r,f)&Y],fe=V>>4;if(f+=V&15,f>_){c&&Yl(0);break}if(V||Yl(2),fe<256)i[m++]=fe;else if(fe==256){xe=f,g=null;break}else{var de=fe-254;if(fe>264){var D=fe-257,Ie=SO[D];de=Xl(r,f,(1<<Ie)-1)+IO[D],f+=Ie}var Ge=y[nC(r,f)&ae],Xe=Ge>>4;Ge||Yl(3),f+=Ge&15;var G=yX[Xe];if(Xe>3){var Ie=TO[Xe];G+=nC(r,f)&(1<<Ie)-1,f+=Ie}if(f>_){c&&Yl(0);break}u&&d(m+131072);var $e=m+de;if(m<G){var lt=o-G,At=Math.min(G,$e);for(lt+m<0&&Yl(3);m<At;++m)i[m]=n[lt+m]}for(;m<$e;++m)i[m]=i[m-G]}}e.l=g,e.p=xe,e.b=m,e.f=p,g&&(p=1,e.m=x,e.d=y,e.n=v)}while(!p);return m!=i.length&&l?_X(i,0,m):i.subarray(0,m)},CX=new Cl(0),SX=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Yl(6,"invalid zlib data"),(r[1]>>5&1)==1&&Yl(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function TX(r,e){return wX(r.subarray(SX(r),-4),{i:2},e,e)}var MX=typeof TextDecoder<"u"&&new TextDecoder,RX=0;try{MX.decode(CX,{stream:!0}),RX=1}catch{}function LO(r,e,i){const n=i.length-r-1;if(e>=i[n])return n-1;if(e<=i[r])return r;let s=r,o=n,l=Math.floor((s+o)/2);for(;e<i[l]||e>=i[l+1];)e<i[l]?o=l:s=l,l=Math.floor((s+o)/2);return l}function IX(r,e,i,n){const s=[],o=[],l=[];s[0]=1;for(let u=1;u<=i;++u){o[u]=e-n[r+1-u],l[u]=n[r+u]-e;let c=0;for(let d=0;d<u;++d){const p=l[d+1],f=o[u-d],m=s[d]/(p+f);s[d]=c+p*m,c=f*m}s[u]=c}return s}function BX(r,e,i,n){const s=LO(r,n,e),o=IX(s,n,r,e),l=new No(0,0,0,0);for(let u=0;u<=r;++u){const c=i[s-r+u],d=o[u],p=c.w*d;l.x+=c.x*p,l.y+=c.y*p,l.z+=c.z*p,l.w+=c.w*d}return l}function NX(r,e,i,n,s){const o=[];for(let f=0;f<=i;++f)o[f]=0;const l=[];for(let f=0;f<=n;++f)l[f]=o.slice(0);const u=[];for(let f=0;f<=i;++f)u[f]=o.slice(0);u[0][0]=1;const c=o.slice(0),d=o.slice(0);for(let f=1;f<=i;++f){c[f]=e-s[r+1-f],d[f]=s[r+f]-e;let m=0;for(let g=0;g<f;++g){const y=d[g+1],x=c[f-g];u[f][g]=y+x;const v=u[g][f-1]/u[f][g];u[g][f]=m+y*v,m=x*v}u[f][f]=m}for(let f=0;f<=i;++f)l[0][f]=u[f][i];for(let f=0;f<=i;++f){let m=0,g=1;const y=[];for(let x=0;x<=i;++x)y[x]=o.slice(0);y[0][0]=1;for(let x=1;x<=n;++x){let v=0;const _=f-x,T=i-x;f>=x&&(y[g][0]=y[m][0]/u[T+1][_],v=y[g][0]*u[_][T]);const w=_>=-1?1:-_,S=f-1<=T?x-1:i-f;for(let B=w;B<=S;++B)y[g][B]=(y[m][B]-y[m][B-1])/u[T+1][_+B],v+=y[g][B]*u[_+B][T];f<=T&&(y[g][x]=-y[m][x-1]/u[T+1][f],v+=y[g][x]*u[f][T]),l[x][f]=v;const R=m;m=g,g=R}}let p=i;for(let f=1;f<=n;++f){for(let m=0;m<=i;++m)l[f][m]*=p;p*=i-f}return l}function LX(r,e,i,n,s){const o=s<r?s:r,l=[],u=LO(r,n,e),c=NX(u,n,r,o,e),d=[];for(let p=0;p<i.length;++p){const f=i[p].clone(),m=f.w;f.x*=m,f.y*=m,f.z*=m,d[p]=f}for(let p=0;p<=o;++p){const f=d[u-r].clone().multiplyScalar(c[p][0]);for(let m=1;m<=r;++m)f.add(d[u-r+m].clone().multiplyScalar(c[p][m]));l[p]=f}for(let p=o+1;p<=s+1;++p)l[p]=new No(0,0,0);return l}function DX(r,e){let i=1;for(let s=2;s<=r;++s)i*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=r-e;++s)n*=s;return i/n}function OX(r){const e=r.length,i=[],n=[];for(let o=0;o<e;++o){const l=r[o];i[o]=new Lt(l.x,l.y,l.z),n[o]=l.w}const s=[];for(let o=0;o<e;++o){const l=i[o].clone();for(let u=1;u<=o;++u)l.sub(s[o-u].clone().multiplyScalar(DX(o,u)*n[u]));s[o]=l.divideScalar(n[0])}return s}function PX(r,e,i,n,s){const o=LX(r,e,i,n,s);return OX(o)}class FX extends yq{constructor(e,i,n,s,o){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=s||0,this.endKnot=o||this.knots.length-1;for(let l=0;l<n.length;++l){const u=n[l];this.controlPoints[l]=new No(u.x,u.y,u.z,u.w)}}getPoint(e,i=new Lt){const n=i,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=BX(this.degree,this.knots,this.controlPoints,s);return o.w!==1&&o.divideScalar(o.w),n.set(o.x,o.y,o.z)}getTangent(e,i=new Lt){const n=i,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=PX(this.degree,this.knots,this.controlPoints,s,1);return n.copy(o[1]).normalize(),n}}let dn,js,uo;class kX extends Zd{constructor(e){super(e)}load(e,i,n,s){const o=this,l=o.path===""?nX.extractUrlBase(e):o.path,u=new Yq(this.manager);u.setPath(o.path),u.setResponseType("arraybuffer"),u.setRequestHeader(o.requestHeader),u.setWithCredentials(o.withCredentials),u.load(e,function(c){try{i(o.parse(c,l))}catch(d){s?s(d):console.error(d),o.manager.itemError(e)}},n,s)}parse(e,i){if(HX(e))dn=new GX().parse(e);else{const s=UO(e);if(!WX(s))throw new Error("THREE.FBXLoader: Unknown format.");if(PO(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+PO(s));dn=new VX().parse(s)}const n=new Jq(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new UX(n,this.manager).parse(dn)}}class UX{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){js=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),n=this.parseMaterials(i),s=this.parseDeformers(),o=new zX().parse(s);return this.parseScene(s,o,n),uo}parseConnections(){const e=new Map;return"Connections"in dn&&dn.Connections.connections.forEach(function(i){const n=i[0],s=i[1],o=i[2];e.has(n)||e.set(n,{parents:[],children:[]});const l={ID:s,relationship:o};e.get(n).parents.push(l),e.has(s)||e.set(s,{parents:[],children:[]});const u={ID:n,relationship:o};e.get(s).children.push(u)}),e}parseImages(){const e={},i={};if("Video"in dn.Objects){const n=dn.Objects.Video;for(const s in n){const o=n[s],l=parseInt(s);if(e[l]=o.RelativeFilename||o.Filename,"Content"in o){const u=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(u||c){const d=this.parseImage(n[s]);i[o.RelativeFilename||o.Filename]=d}}}}for(const n in e){const s=e[n];i[s]!==void 0?e[n]=i[s]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const i=e.Content,n=e.RelativeFilename||e.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(s){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof i=="string")return"data:"+o+";base64,"+i;{const l=new Uint8Array(i);return window.URL.createObjectURL(new Blob([l],{type:o}))}}parseTextures(e){const i=new Map;if("Texture"in dn.Objects){const n=dn.Objects.Texture;for(const s in n){const o=this.parseTexture(n[s],e);i.set(parseInt(s),o)}}return i}parseTexture(e,i){const n=this.loadTexture(e,i);n.ID=e.id,n.name=e.attrName;const s=e.WrapModeU,o=e.WrapModeV,l=s!==void 0?s.value:0,u=o!==void 0?o.value:0;if(n.wrapS=l===0?Zv:Bf,n.wrapT=u===0?Zv:Bf,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(e,i){let n;const s=this.textureLoader.path,o=js.get(e.id).children;o!==void 0&&o.length>0&&i[o[0].ID]!==void 0&&(n=i[o[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let l;const u=e.FileName.slice(-3).toLowerCase();if(u==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),l=new su):(c.setPath(this.textureLoader.path),l=c.load(n))}else if(u==="dds"){const c=this.manager.getHandler(".dds");c===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),l=new su):(c.setPath(this.textureLoader.path),l=c.load(n))}else u==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),l=new su):l=this.textureLoader.load(n);return this.textureLoader.setPath(s),l}parseMaterials(e){const i=new Map;if("Material"in dn.Objects){const n=dn.Objects.Material;for(const s in n){const o=this.parseMaterial(n[s],e);o!==null&&i.set(parseInt(s),o)}}return i}parseMaterial(e,i){const n=e.id,s=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!js.has(n))return null;const l=this.parseParameters(e,i,n);let u;switch(o.toLowerCase()){case"phong":u=new J2;break;case"lambert":u=new Pq;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),u=new J2;break}return u.setValues(l),u.name=s,u}parseParameters(e,i,n){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new Ws().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new Ws().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new Ws().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new Ws().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new Ws().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new Ws().fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return js.get(n).children.forEach(function(l){const u=l.relationship;switch(u){case"Bump":s.bumpMap=o.getTexture(i,l.ID);break;case"Maya|TEX_ao_map":s.aoMap=o.getTexture(i,l.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=o.getTexture(i,l.ID),s.map!==void 0&&(s.map.colorSpace=El);break;case"DisplacementColor":s.displacementMap=o.getTexture(i,l.ID);break;case"EmissiveColor":s.emissiveMap=o.getTexture(i,l.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=El);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=o.getTexture(i,l.ID);break;case"ReflectionColor":s.envMap=o.getTexture(i,l.ID),s.envMap!==void 0&&(s.envMap.mapping=AQ,s.envMap.colorSpace=El);break;case"SpecularColor":s.specularMap=o.getTexture(i,l.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=El);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=o.getTexture(i,l.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",u);break}}),s}getTexture(e,i){return"LayeredTexture"in dn.Objects&&i in dn.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=js.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in dn.Objects){const n=dn.Objects.Deformer;for(const s in n){const o=n[s],l=js.get(parseInt(s));if(o.attrType==="Skin"){const u=this.parseSkeleton(l,n);u.ID=s,l.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=l.parents[0].ID,e[s]=u}else if(o.attrType==="BlendShape"){const u={id:s};u.rawTargets=this.parseMorphTargets(l,n),u.id=s,l.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[s]=u}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const n=[];return e.children.forEach(function(s){const o=i[s.ID];if(o.attrType!=="Cluster")return;const l={ID:s.ID,indices:[],weights:[],transformLink:new Gr().fromArray(o.TransformLink.a)};"Indexes"in o&&(l.indices=o.Indexes.a,l.weights=o.Weights.a),n.push(l)}),{rawBones:n,bones:[]}}parseMorphTargets(e,i){const n=[];for(let s=0;s<e.children.length;s++){const o=e.children[s],l=i[o.ID],u={name:l.attrName,initialWeight:l.DeformPercent,id:l.id,fullWeights:l.FullWeights.a};if(l.attrType!=="BlendShapeChannel")return;u.geoID=js.get(parseInt(o.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(u)}return n}parseScene(e,i,n){uo=new rO;const s=this.parseModels(e.skeletons,i,n),o=dn.Objects.Model,l=this;s.forEach(function(c){const d=o[c.ID];l.setLookAtProperties(c,d),js.get(c.ID).parents.forEach(function(p){const f=s.get(p.ID);f!==void 0&&f.add(c)}),c.parent===null&&uo.add(c)}),this.bindSkeleton(e.skeletons,i,s),this.addGlobalSceneSettings(),uo.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const d=FO(c.userData.transformData);c.applyMatrix4(d),c.updateWorldMatrix()}});const u=new jX().parse();uo.children.length===1&&uo.children[0].isGroup&&(uo.children[0].animations=u,uo=uo.children[0]),uo.animations=u}parseModels(e,i,n){const s=new Map,o=dn.Objects.Model;for(const l in o){const u=parseInt(l),c=o[l],d=js.get(u);let p=this.buildSkeleton(d,e,u,c.attrName);if(!p){switch(c.attrType){case"Camera":p=this.createCamera(d);break;case"Light":p=this.createLight(d);break;case"Mesh":p=this.createMesh(d,i,n);break;case"NurbsCurve":p=this.createCurve(d,i);break;case"LimbNode":case"Root":p=new W2;break;case"Null":default:p=new rO;break}p.name=c.attrName?zn.sanitizeNodeName(c.attrName):"",p.userData.originalName=c.attrName,p.ID=u}this.getTransformData(p,c),s.set(u,p)}return s}buildSkeleton(e,i,n,s){let o=null;return e.parents.forEach(function(l){for(const u in i){const c=i[u];c.rawBones.forEach(function(d,p){if(d.ID===l.ID){const f=o;o=new W2,o.matrixWorld.copy(d.transformLink),o.name=s?zn.sanitizeNodeName(s):"",o.userData.originalName=s,o.ID=n,c.bones[p]=o,f!==null&&o.add(f)}})}}),o}createCamera(e){let i,n;if(e.children.forEach(function(s){const o=dn.Objects.NodeAttribute[s.ID];o!==void 0&&(n=o)}),n===void 0)i=new Ba;else{let s=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(s=1);let o=1;n.NearPlane!==void 0&&(o=n.NearPlane.value/1e3);let l=1e3;n.FarPlane!==void 0&&(l=n.FarPlane.value/1e3);let u=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(u=n.AspectWidth.value,c=n.AspectHeight.value);const d=u/c;let p=45;n.FieldOfView!==void 0&&(p=n.FieldOfView.value);const f=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:i=new j2(p,d,o,l),f!==null&&i.setFocalLength(f);break;case 1:i=new iO(-u/2,u/2,c/2,-c/2,o,l);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),i=new Ba;break}}return i}createLight(e){let i,n;if(e.children.forEach(function(s){const o=dn.Objects.NodeAttribute[s.ID];o!==void 0&&(n=o)}),n===void 0)i=new Ba;else{let s;n.LightType===void 0?s=0:s=n.LightType.value;let o=16777215;n.Color!==void 0&&(o=new Ws().fromArray(n.Color.value).convertSRGBToLinear());let l=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(l=0);let u=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?u=0:u=n.FarAttenuationEnd.value);const c=1;switch(s){case 0:i=new CO(o,l,u,c);break;case 1:i=new iX(o,l);break;case 2:let d=Math.PI/3;n.InnerAngle!==void 0&&(d=lo.degToRad(n.InnerAngle.value));let p=0;n.OuterAngle!==void 0&&(p=lo.degToRad(n.OuterAngle.value),p=Math.max(p,1)),i=new $q(o,l,u,d,p,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),i=new CO(o,l);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,n){let s,o=null,l=null;const u=[];return e.children.forEach(function(c){i.has(c.ID)&&(o=i.get(c.ID)),n.has(c.ID)&&u.push(n.get(c.ID))}),u.length>1?l=u:u.length>0?l=u[0]:(l=new J2({name:Zd.DEFAULT_MATERIAL_NAME,color:13421772}),u.push(l)),"color"in o.attributes&&u.forEach(function(c){c.vertexColors=!0}),o.FBX_Deformer?(s=new fq(o,l),s.normalizeSkinWeights()):s=new ZD(o,l),s}createCurve(e,i){const n=e.children.reduce(function(o,l){return i.has(l.ID)&&(o=i.get(l.ID)),o},null),s=new uO({name:Zd.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Aq(n,s)}getTransformData(e,i){const n={};"InheritType"in i&&(n.inheritType=parseInt(i.InheritType.value)),"RotationOrder"in i?n.eulerOrder=kO(i.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in i&&(n.translation=i.Lcl_Translation.value),"PreRotation"in i&&(n.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(n.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(n.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(n.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(n.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(n.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(n.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(n.rotationPivot=i.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,i){"LookAtProperty"in i&&js.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const s=dn.Objects.Model[n.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),uo.add(e.target)):e.lookAt(new Lt().fromArray(o))}}})}bindSkeleton(e,i,n){const s=this.parsePoseNodes();for(const o in e){const l=e[o];js.get(parseInt(l.ID)).parents.forEach(function(u){if(i.has(u.ID)){const c=u.ID;js.get(c).parents.forEach(function(d){n.has(d.ID)&&n.get(d.ID).bind(new Q2(l.bones),s[d.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in dn.Objects){const i=dn.Objects.Pose;for(const n in i)if(i[n].attrType==="BindPose"&&i[n].NbPoseNodes>0){const s=i[n].PoseNode;Array.isArray(s)?s.forEach(function(o){e[o.Node]=new Gr().fromArray(o.Matrix.a)}):e[s.Node]=new Gr().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in dn){if("AmbientColor"in dn.GlobalSettings){const e=dn.GlobalSettings.AmbientColor.value,i=e[0],n=e[1],s=e[2];if(i!==0||n!==0||s!==0){const o=new Ws(i,n,s).convertSRGBToLinear();uo.add(new rX(o,1))}}"UnitScaleFactor"in dn.GlobalSettings&&(uo.userData.unitScaleFactor=dn.GlobalSettings.UnitScaleFactor.value)}}}class zX{constructor(){this.negativeMaterialIndices=!1}parse(e){const i=new Map;if("Geometry"in dn.Objects){const n=dn.Objects.Geometry;for(const s in n){const o=js.get(parseInt(s)),l=this.parseGeometry(o,n[s],e);i.set(parseInt(s),l)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),i}parseGeometry(e,i,n){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,n);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,n){const s=n.skeletons,o=[],l=e.parents.map(function(f){return dn.Objects.Model[f.ID]});if(l.length===0)return;const u=e.children.reduce(function(f,m){return s[m.ID]!==void 0&&(f=s[m.ID]),f},null);e.children.forEach(function(f){n.morphTargets[f.ID]!==void 0&&o.push(n.morphTargets[f.ID])});const c=l[0],d={};"RotationOrder"in c&&(d.eulerOrder=kO(c.RotationOrder.value)),"InheritType"in c&&(d.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(d.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(d.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(d.scale=c.GeometricScaling.value);const p=FO(d);return this.genGeometry(i,u,o,p)}genGeometry(e,i,n,s){const o=new G0;e.attrName&&(o.name=e.attrName);const l=this.parseGeoNode(e,i),u=this.genBuffers(l),c=new Bh(u.vertex,3);if(c.applyMatrix4(s),o.setAttribute("position",c),u.colors.length>0&&o.setAttribute("color",new Bh(u.colors,3)),i&&(o.setAttribute("skinIndex",new QD(u.weightsIndices,4)),o.setAttribute("skinWeight",new Bh(u.vertexWeights,4)),o.FBX_Deformer=i),u.normal.length>0){const d=new Ch().getNormalMatrix(s),p=new Bh(u.normal,3);p.applyNormalMatrix(d),o.setAttribute("normal",p)}if(u.uvs.forEach(function(d,p){const f=p===0?"uv":`uv${p}`;o.setAttribute(f,new Bh(u.uvs[p],2))}),l.material&&l.material.mappingType!=="AllSame"){let d=u.materialIndex[0],p=0;if(u.materialIndex.forEach(function(f,m){f!==d&&(o.addGroup(p,m-p,d),d=f,p=m)}),o.groups.length>0){const f=o.groups[o.groups.length-1],m=f.start+f.count;m!==u.materialIndex.length&&o.addGroup(m,u.materialIndex.length-m,d)}o.groups.length===0&&o.addGroup(0,u.materialIndex.length,u.materialIndex[0])}return this.addMorphTargets(o,e,n,s),o}parseGeoNode(e,i){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return n.weightTable={},i!==null&&(n.skeleton=i,i.rawBones.forEach(function(s,o){s.indices.forEach(function(l,u){n.weightTable[l]===void 0&&(n.weightTable[l]=[]),n.weightTable[l].push({id:o,weight:s.weights[u]})})})),n}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,s=0,o=!1,l=[],u=[],c=[],d=[],p=[],f=[];const m=this;return e.vertexIndices.forEach(function(g,y){let x,v=!1;g<0&&(g=g^-1,v=!0);let _=[],T=[];if(l.push(g*3,g*3+1,g*3+2),e.color){const w=Px(y,n,g,e.color);c.push(w[0],w[1],w[2])}if(e.skeleton){if(e.weightTable[g]!==void 0&&e.weightTable[g].forEach(function(w){T.push(w.weight),_.push(w.id)}),T.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const w=[0,0,0,0],S=[0,0,0,0];T.forEach(function(R,B){let I=R,D=_[B];S.forEach(function(L,O,U){if(I>L){U[O]=I,I=L;const J=w[O];w[O]=D,D=J}})}),_=w,T=S}for(;T.length<4;)T.push(0),_.push(0);for(let w=0;w<4;++w)p.push(T[w]),f.push(_[w])}if(e.normal){const w=Px(y,n,g,e.normal);u.push(w[0],w[1],w[2])}e.material&&e.material.mappingType!=="AllSame"&&(x=Px(y,n,g,e.material)[0],x<0&&(m.negativeMaterialIndices=!0,x=0)),e.uv&&e.uv.forEach(function(w,S){const R=Px(y,n,g,w);d[S]===void 0&&(d[S]=[]),d[S].push(R[0]),d[S].push(R[1])}),s++,v&&(m.genFace(i,e,l,x,u,c,d,p,f,s),n++,s=0,l=[],u=[],c=[],d=[],p=[],f=[])}),i}getNormalNewell(e){const i=new Lt(0,0,0);for(let n=0;n<e.length;n++){const s=e[n],o=e[(n+1)%e.length];i.x+=(s.y-o.y)*(s.z+o.z),i.y+=(s.z-o.z)*(s.x+o.x),i.z+=(s.x-o.x)*(s.y+o.y)}return i.normalize(),i}getNormalTangentAndBitangent(e){const i=this.getNormalNewell(e),n=(Math.abs(i.z)>.5?new Lt(0,1,0):new Lt(0,0,1)).cross(i).normalize(),s=i.clone().cross(n).normalize();return{normal:i,tangent:n,bitangent:s}}flattenVertex(e,i,n){return new zs(e.dot(i),e.dot(n))}genFace(e,i,n,s,o,l,u,c,d,p){let f;if(p>3){const m=[];for(let v=0;v<n.length;v+=3)m.push(new Lt(i.vertexPositions[n[v]],i.vertexPositions[n[v+1]],i.vertexPositions[n[v+2]]));const{tangent:g,bitangent:y}=this.getNormalTangentAndBitangent(m),x=[];for(const v of m)x.push(this.flattenVertex(v,g,y));f=K2.triangulateShape(x,[])}else f=[[0,1,2]];for(const[m,g,y]of f)e.vertex.push(i.vertexPositions[n[m*3]]),e.vertex.push(i.vertexPositions[n[m*3+1]]),e.vertex.push(i.vertexPositions[n[m*3+2]]),e.vertex.push(i.vertexPositions[n[g*3]]),e.vertex.push(i.vertexPositions[n[g*3+1]]),e.vertex.push(i.vertexPositions[n[g*3+2]]),e.vertex.push(i.vertexPositions[n[y*3]]),e.vertex.push(i.vertexPositions[n[y*3+1]]),e.vertex.push(i.vertexPositions[n[y*3+2]]),i.skeleton&&(e.vertexWeights.push(c[m*4]),e.vertexWeights.push(c[m*4+1]),e.vertexWeights.push(c[m*4+2]),e.vertexWeights.push(c[m*4+3]),e.vertexWeights.push(c[g*4]),e.vertexWeights.push(c[g*4+1]),e.vertexWeights.push(c[g*4+2]),e.vertexWeights.push(c[g*4+3]),e.vertexWeights.push(c[y*4]),e.vertexWeights.push(c[y*4+1]),e.vertexWeights.push(c[y*4+2]),e.vertexWeights.push(c[y*4+3]),e.weightsIndices.push(d[m*4]),e.weightsIndices.push(d[m*4+1]),e.weightsIndices.push(d[m*4+2]),e.weightsIndices.push(d[m*4+3]),e.weightsIndices.push(d[g*4]),e.weightsIndices.push(d[g*4+1]),e.weightsIndices.push(d[g*4+2]),e.weightsIndices.push(d[g*4+3]),e.weightsIndices.push(d[y*4]),e.weightsIndices.push(d[y*4+1]),e.weightsIndices.push(d[y*4+2]),e.weightsIndices.push(d[y*4+3])),i.color&&(e.colors.push(l[m*3]),e.colors.push(l[m*3+1]),e.colors.push(l[m*3+2]),e.colors.push(l[g*3]),e.colors.push(l[g*3+1]),e.colors.push(l[g*3+2]),e.colors.push(l[y*3]),e.colors.push(l[y*3+1]),e.colors.push(l[y*3+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),i.normal&&(e.normal.push(o[m*3]),e.normal.push(o[m*3+1]),e.normal.push(o[m*3+2]),e.normal.push(o[g*3]),e.normal.push(o[g*3+1]),e.normal.push(o[g*3+2]),e.normal.push(o[y*3]),e.normal.push(o[y*3+1]),e.normal.push(o[y*3+2])),i.uv&&i.uv.forEach(function(x,v){e.uvs[v]===void 0&&(e.uvs[v]=[]),e.uvs[v].push(u[v][m*2]),e.uvs[v].push(u[v][m*2+1]),e.uvs[v].push(u[v][g*2]),e.uvs[v].push(u[v][g*2+1]),e.uvs[v].push(u[v][y*2]),e.uvs[v].push(u[v][y*2+1])})}addMorphTargets(e,i,n,s){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;n.forEach(function(l){l.rawTargets.forEach(function(u){const c=dn.Objects.Geometry[u.geoID];c!==void 0&&o.genMorphGeometry(e,i,c,s,u.name)})})}genMorphGeometry(e,i,n,s,o){const l=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],u=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],d=e.attributes.position.count*3,p=new Float32Array(d);for(let y=0;y<c.length;y++){const x=c[y]*3;p[x]=u[y*3],p[x+1]=u[y*3+1],p[x+2]=u[y*3+2]}const f={vertexIndices:l,vertexPositions:p},m=this.genBuffers(f),g=new Bh(m.vertex,3);g.name=o||n.attrName,g.applyMatrix4(s),e.morphAttributes.position.push(g)}parseNormals(e){const i=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Normals.a;let o=[];return n==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:o,mappingType:i,referenceType:n}}parseUVs(e){const i=e.MappingInformationType,n=e.ReferenceInformationType,s=e.UV.a;let o=[];return n==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:s,indices:o,mappingType:i,referenceType:n}}parseVertexColors(e){const i=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Colors.a;let o=[];n==="IndexToDirect"&&(o=e.ColorIndex.a);for(let l=0,u=new Ws;l<s.length;l+=4)u.fromArray(s,l).convertSRGBToLinear().toArray(s,l);return{dataSize:4,buffer:s,indices:o,mappingType:i,referenceType:n}}parseMaterialIndices(e){const i=e.MappingInformationType,n=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const s=e.Materials.a,o=[];for(let l=0;l<s.length;++l)o.push(l);return{dataSize:1,buffer:s,indices:o,mappingType:i,referenceType:n}}parseNurbsGeometry(e){const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new G0;const n=i-1,s=e.KnotVector.a,o=[],l=e.Points.a;for(let p=0,f=l.length;p<f;p+=4)o.push(new No().fromArray(l,p));let u,c;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){u=n,c=s.length-1-u;for(let p=0;p<n;++p)o.push(o[p])}const d=new FX(n,s,o,u,c).getPoints(o.length*12);return new G0().setFromPoints(d)}}class jX{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const n in i){const s=i[n],o=this.addClip(s);e.push(o)}return e}parseClips(){if(dn.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=dn.Objects.AnimationCurveNode,i=new Map;for(const n in e){const s=e[n];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:s.id,attr:s.attrName,curves:{}};i.set(o.id,o)}}return i}parseAnimationCurves(e){const i=dn.Objects.AnimationCurve;for(const n in i){const s={id:i[n].id,times:i[n].KeyTime.a.map(QX),values:i[n].KeyValueFloat.a},o=js.get(s.id);if(o!==void 0){const l=o.parents[0].ID,u=o.parents[0].relationship;u.match(/X/)?e.get(l).curves.x=s:u.match(/Y/)?e.get(l).curves.y=s:u.match(/Z/)?e.get(l).curves.z=s:u.match(/DeformPercent/)&&e.has(l)&&(e.get(l).curves.morph=s)}}}parseAnimationLayers(e){const i=dn.Objects.AnimationLayer,n=new Map;for(const s in i){const o=[],l=js.get(parseInt(s));l!==void 0&&(l.children.forEach(function(u,c){if(e.has(u.ID)){const d=e.get(u.ID);if(d.curves.x!==void 0||d.curves.y!==void 0||d.curves.z!==void 0){if(o[c]===void 0){const p=js.get(u.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(p!==void 0){const f=dn.Objects.Model[p.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",u);return}const m={modelName:f.attrName?zn.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};uo.traverse(function(g){g.ID===f.id&&(m.transform=g.matrix,g.userData.transformData&&(m.eulerOrder=g.userData.transformData.eulerOrder))}),m.transform||(m.transform=new Gr),"PreRotation"in f&&(m.preRotation=f.PreRotation.value),"PostRotation"in f&&(m.postRotation=f.PostRotation.value),o[c]=m}}o[c]&&(o[c][d.attr]=d)}else if(d.curves.morph!==void 0){if(o[c]===void 0){const p=js.get(u.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID,f=js.get(p).parents[0].ID,m=js.get(f).parents[0].ID,g=js.get(m).parents[0].ID,y=dn.Objects.Model[g],x={modelName:y.attrName?zn.sanitizeNodeName(y.attrName):"",morphName:dn.Objects.Deformer[p].attrName};o[c]=x}o[c][d.attr]=d}}}),n.set(parseInt(s),o))}return n}parseAnimStacks(e){const i=dn.Objects.AnimationStack,n={};for(const s in i){const o=js.get(parseInt(s)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const l=e.get(o[0].ID);n[s]={name:i[s].attrName,layer:l}}return n}addClip(e){let i=[];const n=this;return e.layer.forEach(function(s){i=i.concat(n.generateTracks(s))}),new Gq(e.name,-1,i)}generateTracks(e){const i=[];let n=new Lt,s=new Lt;if(e.transform&&e.transform.decompose(n,new Lo,s),n=n.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");o!==void 0&&i.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&i.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&i.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&i.push(o)}return i}generateVectorTrack(e,i,n,s){const o=this.getTimesForAllAxes(i),l=this.getKeyframeTrackValues(o,i,n);return new Y0(e+"."+s,o,l)}generateRotationTrack(e,i,n,s,o){let l,u;if(i.x!==void 0&&i.y!==void 0&&i.z!==void 0){const f=this.interpolateRotations(i.x,i.y,i.z,o);l=f[0],u=f[1]}n!==void 0&&(n=n.map(lo.degToRad),n.push(o),n=new co().fromArray(n),n=new Lo().setFromEuler(n)),s!==void 0&&(s=s.map(lo.degToRad),s.push(o),s=new co().fromArray(s),s=new Lo().setFromEuler(s).invert());const c=new Lo,d=new co,p=[];if(!u||!l)return new Jd(e+".quaternion",[0],[0]);for(let f=0;f<u.length;f+=3)d.set(u[f],u[f+1],u[f+2],o),c.setFromEuler(d),n!==void 0&&c.premultiply(n),s!==void 0&&c.multiply(s),f>2&&new Lo().fromArray(p,(f-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(p,f/3*4);return new Jd(e+".quaternion",l,p)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,n=i.values.map(function(o){return o/100}),s=uo.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new X0(e.modelName+".morphTargetInfluences["+s+"]",i.times,n)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(n,s){return n-s}),i.length>1){let n=1,s=i[0];for(let o=1;o<i.length;o++){const l=i[o];l!==s&&(i[n]=l,s=l,n++)}i=i.slice(0,n)}return i}getKeyframeTrackValues(e,i,n){const s=n,o=[];let l=-1,u=-1,c=-1;return e.forEach(function(d){if(i.x&&(l=i.x.times.indexOf(d)),i.y&&(u=i.y.times.indexOf(d)),i.z&&(c=i.z.times.indexOf(d)),l!==-1){const p=i.x.values[l];o.push(p),s[0]=p}else o.push(s[0]);if(u!==-1){const p=i.y.values[u];o.push(p),s[1]=p}else o.push(s[1]);if(c!==-1){const p=i.z.values[c];o.push(p),s[2]=p}else o.push(s[2])}),o}interpolateRotations(e,i,n,s){const o=[],l=[];o.push(e.times[0]),l.push(lo.degToRad(e.values[0])),l.push(lo.degToRad(i.values[0])),l.push(lo.degToRad(n.values[0]));for(let u=1;u<e.values.length;u++){const c=[e.values[u-1],i.values[u-1],n.values[u-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const d=c.map(lo.degToRad),p=[e.values[u],i.values[u],n.values[u]];if(isNaN(p[0])||isNaN(p[1])||isNaN(p[2]))continue;const f=p.map(lo.degToRad),m=[p[0]-c[0],p[1]-c[1],p[2]-c[2]],g=[Math.abs(m[0]),Math.abs(m[1]),Math.abs(m[2])];if(g[0]>=180||g[1]>=180||g[2]>=180){const y=Math.max(...g)/180,x=new co(...d,s),v=new co(...f,s),_=new Lo().setFromEuler(x),T=new Lo().setFromEuler(v);_.dot(T)&&T.set(-T.x,-T.y,-T.z,-T.w);const w=e.times[u-1],S=e.times[u]-w,R=new Lo,B=new co;for(let I=0;I<1;I+=1/y)R.copy(_.clone().slerp(T.clone(),I)),o.push(w+I*S),B.setFromQuaternion(R,s),l.push(B.x),l.push(B.y),l.push(B.z)}else o.push(e.times[u]),l.push(lo.degToRad(e.values[u])),l.push(lo.degToRad(i.values[u])),l.push(lo.degToRad(n.values[u]))}return[o,l]}}class VX{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new OO,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,n=e.split(/[\r\n]+/);return n.forEach(function(s,o){const l=s.match(/^[\s\t]*;/),u=s.match(/^[\s\t]*$/);if(l||u)return;const c=s.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),d=s.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),p=s.match("^\\t{"+(i.currentIndent-1)+"}}");c?i.parseNodeBegin(s,c):d?i.parseNodeProperty(s,d,n[++o]):p?i.popStack():s.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,i){const n=i[1].trim().replace(/^"/,"").replace(/"$/,""),s=i[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:n},l=this.parseNodeAttr(s),u=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,o):n in u?(n==="PoseNode"?u.PoseNode.push(o):u[n].id!==void 0&&(u[n]={},u[n][u[n].id]=u[n]),l.id!==""&&(u[n][l.id]=o)):typeof l.id=="number"?(u[n]={},u[n][l.id]=o):n!=="Properties70"&&(n==="PoseNode"?u[n]=[o]:u[n]=o),typeof l.id=="number"&&(o.id=l.id),l.name!==""&&(o.attrName=l.name),l.type!==""&&(o.attrType=l.type),this.pushStack(o)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let n="",s="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:i,name:n,type:s}}parseNodeProperty(e,i,n){let s=i[1].replace(/^"/,"").replace(/"$/,"").trim(),o=i[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&o===","&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const l=this.getCurrentNode();if(l.name==="Properties70"){this.parseNodeSpecialProperty(e,s,o);return}if(s==="C"){const u=o.split(",").slice(1),c=parseInt(u[0]),d=parseInt(u[1]);let p=o.split(",").slice(3);p=p.map(function(f){return f.trim().replace(/^"/,"")}),s="connections",o=[c,d],XX(o,p),l[s]===void 0&&(l[s]=[])}s==="Node"&&(l.id=o),s in l&&Array.isArray(l[s])?l[s].push(o):s!=="a"?l[s]=o:l.a=o,this.setCurrentProp(l,s),s==="a"&&o.slice(-1)!==","&&(l.a=aC(o))}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=aC(i.a))}parseNodeSpecialProperty(e,i,n){const s=n.split('",').map(function(p){return p.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=s[0],l=s[1],u=s[2],c=s[3];let d=s[4];switch(l){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":d=parseFloat(d);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":d=aC(d);break}this.getPrevNode()[o]={type:l,type2:u,flag:c,value:d},this.setCurrentProp(this.getPrevNode(),o)}}class GX{parse(e){const i=new DO(e);i.skip(23);const n=i.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const s=new OO;for(;!this.endOfContent(i);){const o=this.parseNode(i,n);o!==null&&s.add(o.name,o)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const n={},s=i>=7500?e.getUint64():e.getUint32(),o=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const l=e.getUint8(),u=e.getString(l);if(s===0)return null;const c=[];for(let m=0;m<o;m++)c.push(this.parseProperty(e));const d=c.length>0?c[0]:"",p=c.length>1?c[1]:"",f=c.length>2?c[2]:"";for(n.singleProperty=o===1&&e.getOffset()===s;s>e.getOffset();){const m=this.parseNode(e,i);m!==null&&this.parseSubNode(u,n,m)}return n.propertyList=c,typeof d=="number"&&(n.id=d),p!==""&&(n.attrName=p),f!==""&&(n.attrType=f),u!==""&&(n.name=u),n}parseSubNode(e,i,n){if(n.singleProperty===!0){const s=n.propertyList[0];Array.isArray(s)?(i[n.name]=n,n.a=s):i[n.name]=s}else if(e==="Connections"&&n.name==="C"){const s=[];n.propertyList.forEach(function(o,l){l!==0&&s.push(o)}),i.connections===void 0&&(i.connections=[]),i.connections.push(s)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){i[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let s=n.propertyList[0],o=n.propertyList[1];const l=n.propertyList[2],u=n.propertyList[3];let c;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],i[s]={type:o,type2:l,flag:u,value:c}}else i[n.name]===void 0?typeof n.id=="number"?(i[n.name]={},i[n.name][n.id]=n):i[n.name]=n:n.name==="PoseNode"?(Array.isArray(i[n.name])||(i[n.name]=[i[n.name]]),i[n.name].push(n)):i[n.name][n.id]===void 0&&(i[n.name][n.id]=n)}parseProperty(e){const i=e.getString(1);let n;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),o=e.getUint32(),l=e.getUint32();if(o===0)switch(i){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const u=TX(new Uint8Array(e.getArrayBuffer(l))),c=new DO(u.buffer);switch(i){case"b":case"c":return c.getBooleanArray(s);case"d":return c.getFloat64Array(s);case"f":return c.getFloat32Array(s);case"i":return c.getInt32Array(s);case"l":return c.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class DO{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i!==void 0?i:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const i=[];for(let n=0;n<e;n++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i&2147483648?(i=~i&4294967295,e=~e&4294967295,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(i*4294967296+e)):i*4294967296+e}getInt64Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){const i=this.offset;let n=new Uint8Array(this.dv.buffer,i,e);this.skip(e);const s=n.indexOf(0);return s>=0&&(n=new Uint8Array(this.dv.buffer,i,s)),this._textDecoder.decode(n)}}class OO{add(e,i){this[e]=i}}function HX(r){const e="Kaydara FBX Binary  \0";return r.byteLength>=e.length&&e===UO(r,0,e.length)}function WX(r){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let i=0;function n(s){const o=r[s-1];return r=r.slice(i+s),i++,o}for(let s=0;s<e.length;++s)if(n(1)===e[s])return!1;return!0}function PO(r){const e=/FBXVersion: (\d+)/,i=r.match(e);if(i)return parseInt(i[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function QX(r){return r/46186158e3}const qX=[];function Px(r,e,i,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=r;break;case"ByPolygon":s=e;break;case"ByVertice":s=i;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(s=n.indices[s]);const o=s*n.dataSize,l=o+n.dataSize;return YX(qX,n.buffer,o,l)}const sC=new co,tm=new Lt;function FO(r){const e=new Gr,i=new Gr,n=new Gr,s=new Gr,o=new Gr,l=new Gr,u=new Gr,c=new Gr,d=new Gr,p=new Gr,f=new Gr,m=new Gr,g=r.inheritType?r.inheritType:0;if(r.translation&&e.setPosition(tm.fromArray(r.translation)),r.preRotation){const O=r.preRotation.map(lo.degToRad);O.push(r.eulerOrder||co.DEFAULT_ORDER),i.makeRotationFromEuler(sC.fromArray(O))}if(r.rotation){const O=r.rotation.map(lo.degToRad);O.push(r.eulerOrder||co.DEFAULT_ORDER),n.makeRotationFromEuler(sC.fromArray(O))}if(r.postRotation){const O=r.postRotation.map(lo.degToRad);O.push(r.eulerOrder||co.DEFAULT_ORDER),s.makeRotationFromEuler(sC.fromArray(O)),s.invert()}r.scale&&o.scale(tm.fromArray(r.scale)),r.scalingOffset&&u.setPosition(tm.fromArray(r.scalingOffset)),r.scalingPivot&&l.setPosition(tm.fromArray(r.scalingPivot)),r.rotationOffset&&c.setPosition(tm.fromArray(r.rotationOffset)),r.rotationPivot&&d.setPosition(tm.fromArray(r.rotationPivot)),r.parentMatrixWorld&&(f.copy(r.parentMatrix),p.copy(r.parentMatrixWorld));const y=i.clone().multiply(n).multiply(s),x=new Gr;x.extractRotation(p);const v=new Gr;v.copyPosition(p);const _=v.clone().invert().multiply(p),T=x.clone().invert().multiply(_),w=o,S=new Gr;if(g===0)S.copy(x).multiply(y).multiply(T).multiply(w);else if(g===1)S.copy(x).multiply(T).multiply(y).multiply(w);else{const O=new Gr().scale(new Lt().setFromMatrixScale(f)).clone().invert(),U=T.clone().multiply(O);S.copy(x).multiply(y).multiply(U).multiply(w)}const R=d.clone().invert(),B=l.clone().invert();let I=e.clone().multiply(c).multiply(d).multiply(i).multiply(n).multiply(s).multiply(R).multiply(u).multiply(l).multiply(o).multiply(B);const D=new Gr().copyPosition(I),L=p.clone().multiply(D);return m.copyPosition(L),I=m.clone().multiply(S),I.premultiply(p.invert()),I}function kO(r){r=r||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return r===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[r]}function aC(r){return r.split(",").map(function(e){return parseFloat(e)})}function UO(r,e,i){return e===void 0&&(e=0),i===void 0&&(i=r.byteLength),new TextDecoder().decode(new Uint8Array(r,e,i))}function XX(r,e){for(let i=0,n=r.length,s=e.length;i<s;i++,n++)r[n]=e[i]}function YX(r,e,i,n){for(let s=i,o=0;s<n;s++,o++)r[o]=e[s];return r}THREE.FBXLoader=kX,AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){const r=this.data;if(!r.src)return;this.remove();const e=new THREE.FBXLoader;r.crossorigin&&e.setCrossOrigin(r.crossorigin),e.load(r.src,this.load.bind(this))},load:function(r){this.model=r,this.el.setObject3D("mesh",r),this.el.emit("model-loaded",{format:"fbx",model:r})},remove:function(){this.model&&this.el.removeObject3D("mesh")}});function KX(){return"script_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function JX(r,e){var i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.id=e,i.src=r,i}function oC(r){const e=document.getElementById(r),i=e.parentNode;try{i&&i.removeChild(e)}catch{}}function ZX(r){const e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(r,e)}function $X(r,e,i){return new i(function(n,s){const o=e.timeout||5e3,l=KX(),u=JX(r,l),c=setTimeout(function(){s(new Error("Script request to "+r+" timed out")),oC(l)},o),d=function(p){clearTimeout(p)};u.addEventListener("load",function(p){n({ok:!0}),d(c),oC(l)}),u.addEventListener("error",function(p){s(new Error("Script request to "+r+" failed "+p)),d(c),oC(l)}),ZX(u)})}function eY(r){return r=r||{},function(e,i){return i=i||{},$X(e,i,r.Promise||Promise)}}var tY=eY;const iY=tY(),rY="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js",nY=function(){let r;return function(){return r=r||iY(rY),r}}();AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=nY().then(()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")})},update:function(){const r=this,e=this.el,i=this.data;i&&(this.remove(),this.loaderPromise.then(()=>{this.loader.load(i,function(n){r.model=n.scene,r.model.animations=n.animations,e.setObject3D("mesh",r.model),e.emit("model-loaded",{format:"gltf",model:r.model})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let r;const e=this.data;e.src&&(this.remove(),r=new THREE.ObjectLoader,e.crossorigin&&r.setCrossOrigin(e.crossorigin),r.load(e.src,i=>{i.traverse(n=>{n instanceof THREE.SkinnedMesh&&n.material&&(n.material.skinning=!!(n.geometry&&n.geometry.bones||[]).length)}),this.load(i)}))},load:function(r){this.model=r,this.el.setObject3D("mesh",r),this.el.emit("model-loaded",{format:"json",model:r})},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){const r=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!r)throw new Error("No `checkpoint-controls` component found.");r.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}});function sY(r){return r?Array.isArray(r)?r:r.materials?r.materials:[r]:[]}function eA(r,e,i,n){r&&(e=e||[],r.traverse(s=>{s.isMesh&&sY(s.material).forEach(o=>{o&&!("envMap"in o)||e.length&&e.indexOf(o.name)===-1||(o.envMap=i,o.reflectivity=n,o.needsUpdate=!0)})}))}AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){const r=this.data;this.texture=new THREE.CubeTextureLoader().load([r.path+"posx."+r.extension,r.path+"negx."+r.extension,r.path+"posy."+r.extension,r.path+"negy."+r.extension,r.path+"posz."+r.extension,r.path+"negz."+r.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=()=>{const e=this.el.getObject3D("mesh"),i=this.data;eA(e,i.materials,this.texture,i.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(r){const e=this.data,i=this.el.getObject3D("mesh");let n=[],s=[];if(e.materials.length&&(r.materials?(n=e.materials.filter(o=>!r.materials.includes(o)),s=r.materials.filter(o=>!e.materials.includes(o))):n=e.materials),n.length&&eA(i,n,this.texture,e.reflectivity),s.length&&eA(i,s,null,1),r.materials&&e.reflectivity!==r.reflectivity){const o=e.materials.filter(l=>r.materials.includes(l));o.length&&eA(i,o,this.texture,e.reflectivity)}this.data.enableBackground&&!r.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&r.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);const r=this.el.getObject3D("mesh"),e=this.data;eA(r,e.materials,null,1),e.enableBackground&&this.setBackground(null)},setBackground:function(r){this.el.sceneEl.object3D.background=r}}),AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){const r=this.el;r.addEventListener("hit",this.onHit),r.addEventListener("gripdown",this.onGripClose),r.addEventListener("gripup",this.onGripOpen),r.addEventListener("trackpaddown",this.onGripClose),r.addEventListener("trackpadup",this.onGripOpen),r.addEventListener("triggerdown",this.onGripClose),r.addEventListener("triggerup",this.onGripOpen)},pause:function(){const r=this.el;r.removeEventListener("hit",this.onHit),r.removeEventListener("gripdown",this.onGripClose),r.removeEventListener("gripup",this.onGripOpen),r.removeEventListener("trackpaddown",this.onGripClose),r.removeEventListener("trackpadup",this.onGripOpen),r.removeEventListener("triggerdown",this.onGripClose),r.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){const r=this.hitEl;this.grabbing=!1,r&&(r.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(r){const e=r.detail.el;e.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(e.addState(this.GRABBED_STATE),this.hitEl=e,this.constraint=new CANNON.LockConstraint(this.el.body,e.body),this.system.addConstraint(this.constraint))}}),AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse(r=>{r.isMesh&&(r.material=this.material)})}}),AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){const r=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(r,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){const r=this.data;let e;r.objects?e=this.el.sceneEl.querySelectorAll(r.objects):e=this.el.sceneEl.children,this.els=Array.prototype.slice.call(e)},tick:function(){const r=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,s=new THREE.Box3,o=[],l=new Map;return function(u){if(!this.data.enabled)return;const c=this.prevCheckTime;if(c&&u-c<this.data.interval)return;this.prevCheckTime=u;const d=this.el,p=this.data,f=d.getObject3D("mesh");let m;if(!f)return;o.length=0,l.clear(),d.object3D.getWorldPosition(r),d.object3D.getWorldScale(i),m=p.radius*y(i),this.els.forEach(g),o.sort((x,v)=>l.get(x)>l.get(v)?1:-1).forEach(this.handleHit),this.collisions.filter(x=>!l.has(x)).forEach(this.handleHitEnd),aY(this.collisions,o);function g(x){let v,_,T,w;x.isEntity&&(_=x.getObject3D("mesh"),_&&(s.setFromObject(_).getSize(n),w=Math.max(n.x,n.y,n.z)/2,v=Math.sqrt(2*w*w),s.getCenter(e),v&&(T=r.distanceTo(e),T<v+m&&(o.push(x),l.set(x,T)))))}function y(x){return Math.max(x.x,x.y,x.z)}}}(),handleHit:function(r){r.emit("hit"),r.addState(this.data.state),this.eventDetail.el=r,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(r){r.emit("hitend"),r.removeState(this.data.state),this.eventDetail.el=r,this.el.emit("hitend",this.eventDetail)}});function aY(r,e){r.length=0;for(let i=0;i<e.length;i++)r[i]=e[i]}AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var r=this;const e=this.el.getObject3D("mesh");if(this.el.sceneEl.object3D,!e)return;let i;if(e.traverse(s=>{s.isMesh&&(!r.nodeName||s.name===r.nodeName)&&(i=s)}),!i)return;const n=i.geometry.clone();i.updateWorldMatrix(!0,!1),n.applyMatrix4(i.matrixWorld),this.system.setNavMeshGeometry(n),this.hasLoadedNavMesh=!0}}),AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){const r=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3;return function(n,s){const o=this.el,l=this.data,u=this.raycaster,c=l.speed*s/1e3;if(!l.active)return;if(!this.path.length){const y=this.el.object3D.position;this.group=this.group||this.system.getGroup(y),this.path=this.system.getPath(y,r.copy(l.destination),this.group)||[],o.emit("navigation-start")}if(!this.path.length){console.warn("[nav] Unable to find path to %o.",l.destination),this.el.setAttribute("nav-agent",{active:!1}),o.emit("navigation-end");return}const d=o.object3D.position,p=this.path[0];e.subVectors(p,d);const f=e.length();let m;if(f<c){if(this.path.shift(),!this.path.length){this.el.setAttribute("nav-agent",{active:!1}),o.emit("navigation-end");return}i.copy(d),m=this.path[0]}else i.copy(e.setLength(c)).add(d),m=p;m.y=d.y,o.object3D.lookAt(m),u.ray.origin.copy(i),u.ray.origin.y+=1.5,u.ray.direction={x:0,y:-1,z:0};const g=u.intersectObject(this.system.getNavMesh());g.length?(e.subVectors(g[0].point,d),d.add(e.setLength(c))):d.copy(i)}}()});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Fx="170",Na={ROTATE:0,DOLLY:1,PAN:2},du={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},oY=0,zO=1,lY=2,jO=1,cY=2,pu=3,Dh=0,ho=1,fu=2,mu=0,im=1,VO=2,GO=3,HO=4,uY=5,$d=100,hY=101,dY=102,pY=103,fY=104,mY=200,gY=201,AY=202,yY=203,lC=204,cC=205,vY=206,xY=207,bY=208,_Y=209,EY=210,wY=211,CY=212,SY=213,TY=214,uC=0,hC=1,dC=2,rm=3,pC=4,fC=5,mC=6,gC=7,AC=0,MY=1,RY=2,Oh=0,IY=1,BY=2,NY=3,LY=4,DY=5,OY=6,PY=7,WO=300,nm=301,sm=302,yC=303,vC=304,kx=306,xC=1e3,ep=1001,bC=1002,Kl=1003,FY=1004,Ux=1005,Bc=1006,_C=1007,tp=1008,gu=1009,QO=1010,qO=1011,tA=1012,EC=1013,ip=1014,Au=1015,am=1016,wC=1017,CC=1018,om=1020,XO=35902,YO=1021,KO=1022,Jl=1023,JO=1024,ZO=1025,lm=1026,cm=1027,$O=1028,SC=1029,eP=1030,TC=1031,MC=1033,zx=33776,jx=33777,Vx=33778,Gx=33779,RC=35840,IC=35841,BC=35842,NC=35843,LC=36196,DC=37492,OC=37496,PC=37808,FC=37809,kC=37810,UC=37811,zC=37812,jC=37813,VC=37814,GC=37815,HC=37816,WC=37817,QC=37818,qC=37819,XC=37820,YC=37821,Hx=36492,KC=36494,JC=36495,tP=36283,ZC=36284,$C=36285,eS=36286,kY=3200,UY=3201,iP=0,zY=1,Ph="",Do="srgb",um="srgb-linear",Wx="linear",ss="srgb",hm=7680,rP=519,jY=512,VY=513,GY=514,nP=515,HY=516,WY=517,QY=518,qY=519,tS=35044,sP="300 es",yu=2e3,Qx=2001;let rp=class{addEventListener(r,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[r]===void 0&&(i[r]=[]),i[r].indexOf(e)===-1&&i[r].push(e)}hasEventListener(r,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[r]!==void 0&&i[r].indexOf(e)!==-1}removeEventListener(r,e){if(this._listeners===void 0)return;const i=this._listeners[r];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const e=this._listeners[r.type];if(e!==void 0){r.target=this;const i=e.slice(0);for(let n=0,s=i.length;n<s;n++)i[n].call(this,r);r.target=null}}};const qa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let aP=1234567;const iA=Math.PI/180,rA=180/Math.PI;function vu(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(qa[r&255]+qa[r>>8&255]+qa[r>>16&255]+qa[r>>24&255]+"-"+qa[e&255]+qa[e>>8&255]+"-"+qa[e>>16&15|64]+qa[e>>24&255]+"-"+qa[i&63|128]+qa[i>>8&255]+"-"+qa[i>>16&255]+qa[i>>24&255]+qa[n&255]+qa[n>>8&255]+qa[n>>16&255]+qa[n>>24&255]).toLowerCase()}function ba(r,e,i){return Math.max(e,Math.min(i,r))}function iS(r,e){return(r%e+e)%e}function XY(r,e,i,n,s){return n+(r-e)*(s-n)/(i-e)}function YY(r,e,i){return r!==e?(i-r)/(e-r):0}function nA(r,e,i){return(1-i)*r+i*e}function KY(r,e,i,n){return nA(r,e,1-Math.exp(-i*n))}function JY(r,e=1){return e-Math.abs(iS(r,e*2)-e)}function ZY(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*(3-2*r))}function $Y(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*r*(r*(r*6-15)+10))}function eK(r,e){return r+Math.floor(Math.random()*(e-r+1))}function tK(r,e){return r+Math.random()*(e-r)}function iK(r){return r*(.5-Math.random())}function rK(r){r!==void 0&&(aP=r);let e=aP+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function nK(r){return r*iA}function sK(r){return r*rA}function aK(r){return(r&r-1)===0&&r!==0}function oK(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function lK(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function cK(r,e,i,n,s){const o=Math.cos,l=Math.sin,u=o(i/2),c=l(i/2),d=o((e+n)/2),p=l((e+n)/2),f=o((e-n)/2),m=l((e-n)/2),g=o((n-e)/2),y=l((n-e)/2);switch(s){case"XYX":r.set(u*p,c*f,c*m,u*d);break;case"YZY":r.set(c*m,u*p,c*f,u*d);break;case"ZXZ":r.set(c*f,c*m,u*p,u*d);break;case"XZX":r.set(u*p,c*y,c*g,u*d);break;case"YXY":r.set(c*g,u*p,c*y,u*d);break;case"ZYZ":r.set(c*y,c*g,u*p,u*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Zl(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function ts(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const rS={DEG2RAD:iA,RAD2DEG:rA,generateUUID:vu,clamp:ba,euclideanModulo:iS,mapLinear:XY,inverseLerp:YY,lerp:nA,damp:KY,pingpong:JY,smoothstep:ZY,smootherstep:$Y,randInt:eK,randFloat:tK,randFloatSpread:iK,seededRandom:rK,degToRad:nK,radToDeg:sK,isPowerOfTwo:aK,ceilPowerOfTwo:oK,floorPowerOfTwo:lK,setQuaternionFromProperEuler:cK,normalize:ts,denormalize:Zl};let zi=class sG{constructor(e=0,i=0){sG.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(ba(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),s=Math.sin(i),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*s+e.x,this.y=o*s+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},pn=class aG{constructor(e,i,n,s,o,l,u,c,d){aG.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,d)}set(e,i,n,s,o,l,u,c,d){const p=this.elements;return p[0]=e,p[1]=s,p[2]=u,p[3]=i,p[4]=o,p[5]=c,p[6]=n,p[7]=l,p[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[3],c=n[6],d=n[1],p=n[4],f=n[7],m=n[2],g=n[5],y=n[8],x=s[0],v=s[3],_=s[6],T=s[1],w=s[4],S=s[7],R=s[2],B=s[5],I=s[8];return o[0]=l*x+u*T+c*R,o[3]=l*v+u*w+c*B,o[6]=l*_+u*S+c*I,o[1]=d*x+p*T+f*R,o[4]=d*v+p*w+f*B,o[7]=d*_+p*S+f*I,o[2]=m*x+g*T+y*R,o[5]=m*v+g*w+y*B,o[8]=m*_+g*S+y*I,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8];return i*l*p-i*u*d-n*o*p+n*u*c+s*o*d-s*l*c}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8],f=p*l-u*d,m=u*c-p*o,g=d*o-l*c,y=i*f+n*m+s*g;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/y;return e[0]=f*x,e[1]=(s*d-p*n)*x,e[2]=(u*n-s*l)*x,e[3]=m*x,e[4]=(p*i-s*c)*x,e[5]=(s*o-u*i)*x,e[6]=g*x,e[7]=(n*c-d*i)*x,e[8]=(l*i-n*o)*x,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,s,o,l,u){const c=Math.cos(o),d=Math.sin(o);return this.set(n*c,n*d,-n*(c*l+d*u)+l+e,-s*d,s*c,-s*(-d*l+c*u)+u+i,0,0,1),this}scale(e,i){return this.premultiply(nS.makeScale(e,i)),this}rotate(e){return this.premultiply(nS.makeRotation(-e)),this}translate(e,i){return this.premultiply(nS.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const nS=new pn;function oP(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function sA(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function uK(){const r=sA("canvas");return r.style.display="block",r}const lP={};function aA(r){r in lP||(lP[r]=!0,console.warn(r))}function hK(r,e,i){return new Promise(function(n,s){function o(){switch(r.clientWaitSync(e,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:s();break;case r.TIMEOUT_EXPIRED:setTimeout(o,i);break;default:n()}}setTimeout(o,i)})}function dK(r){const e=r.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function pK(r){const e=r.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Pn={enabled:!0,workingColorSpace:um,spaces:{},convert:function(r,e,i){return this.enabled===!1||e===i||!e||!i||(this.spaces[e].transfer===ss&&(r.r=xu(r.r),r.g=xu(r.g),r.b=xu(r.b)),this.spaces[e].primaries!==this.spaces[i].primaries&&(r.applyMatrix3(this.spaces[e].toXYZ),r.applyMatrix3(this.spaces[i].fromXYZ)),this.spaces[i].transfer===ss&&(r.r=dm(r.r),r.g=dm(r.g),r.b=dm(r.b))),r},fromWorkingColorSpace:function(r,e){return this.convert(r,this.workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Ph?Wx:this.spaces[r].transfer},getLuminanceCoefficients:function(r,e=this.workingColorSpace){return r.fromArray(this.spaces[e].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,e,i){return r.copy(this.spaces[e].toXYZ).multiply(this.spaces[i].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}};function xu(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function dm(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const cP=[.64,.33,.3,.6,.15,.06],uP=[.2126,.7152,.0722],hP=[.3127,.329],dP=new pn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),pP=new pn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Pn.define({[um]:{primaries:cP,whitePoint:hP,transfer:Wx,toXYZ:dP,fromXYZ:pP,luminanceCoefficients:uP,workingColorSpaceConfig:{unpackColorSpace:Do},outputColorSpaceConfig:{drawingBufferColorSpace:Do}},[Do]:{primaries:cP,whitePoint:hP,transfer:ss,toXYZ:dP,fromXYZ:pP,luminanceCoefficients:uP,outputColorSpaceConfig:{drawingBufferColorSpace:Do}}});let pm,fK=class{static getDataURL(r){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let e;if(r instanceof HTMLCanvasElement)e=r;else{pm===void 0&&(pm=sA("canvas")),pm.width=r.width,pm.height=r.height;const i=pm.getContext("2d");r instanceof ImageData?i.putImageData(r,0,0):i.drawImage(r,0,0,r.width,r.height),e=pm}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const e=sA("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height);const n=i.getImageData(0,0,r.width,r.height),s=n.data;for(let o=0;o<s.length;o++)s[o]=xu(s[o]/255)*255;return i.putImageData(n,0,0),e}else if(r.data){const e=r.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(xu(e[i]/255)*255):e[i]=xu(e[i]);return{data:e,width:r.width,height:r.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}},mK=0,fP=class{constructor(r=null){this.isSource=!0,Object.defineProperty(this,"id",{value:mK++}),this.uuid=vu(),this.data=r,this.dataReady=!0,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const e=r===void 0||typeof r=="string";if(!e&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let o=0,l=n.length;o<l;o++)n[o].isDataTexture?s.push(sS(n[o].image)):s.push(sS(n[o]))}else s=sS(n);i.url=s}return e||(r.images[this.uuid]=i),i}};function sS(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?fK.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let gK=0,Sl=class Lw extends rp{constructor(e=Lw.DEFAULT_IMAGE,i=Lw.DEFAULT_MAPPING,n=ep,s=ep,o=Bc,l=tp,u=Jl,c=gu,d=Lw.DEFAULT_ANISOTROPY,p=Ph){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gK++}),this.uuid=vu(),this.name="",this.source=new fP(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=l,this.anisotropy=d,this.format=u,this.internalFormat=null,this.type=c,this.offset=new zi(0,0),this.repeat=new zi(1,1),this.center=new zi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==WO)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case xC:e.x=e.x-Math.floor(e.x);break;case ep:e.x=e.x<0?0:1;break;case bC:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case xC:e.y=e.y-Math.floor(e.y);break;case ep:e.y=e.y<0?0:1;break;case bC:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};Sl.DEFAULT_IMAGE=null,Sl.DEFAULT_MAPPING=WO,Sl.DEFAULT_ANISOTROPY=1;let qs=class oG{constructor(e=0,i=0,n=0,s=1){oG.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,s){return this.x=e,this.y=i,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*i+l[4]*n+l[8]*s+l[12]*o,this.y=l[1]*i+l[5]*n+l[9]*s+l[13]*o,this.z=l[2]*i+l[6]*n+l[10]*s+l[14]*o,this.w=l[3]*i+l[7]*n+l[11]*s+l[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,s,o;const l=e.elements,u=l[0],c=l[4],d=l[8],p=l[1],f=l[5],m=l[9],g=l[2],y=l[6],x=l[10];if(Math.abs(c-p)<.01&&Math.abs(d-g)<.01&&Math.abs(m-y)<.01){if(Math.abs(c+p)<.1&&Math.abs(d+g)<.1&&Math.abs(m+y)<.1&&Math.abs(u+f+x-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,T=(f+1)/2,w=(x+1)/2,S=(c+p)/4,R=(d+g)/4,B=(m+y)/4;return _>T&&_>w?_<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(_),s=S/n,o=R/n):T>w?T<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(T),n=S/s,o=B/s):w<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(w),n=R/o,s=B/o),this.set(n,s,o,i),this}let v=Math.sqrt((y-m)*(y-m)+(d-g)*(d-g)+(p-c)*(p-c));return Math.abs(v)<.001&&(v=1),this.x=(y-m)/v,this.y=(d-g)/v,this.z=(p-c)/v,this.w=Math.acos((u+f+x-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},AK=class extends rp{constructor(r=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=r,this.height=e,this.depth=1,this.scissor=new qs(0,0,r,e),this.scissorTest=!1,this.viewport=new qs(0,0,r,e);const n={width:r,height:e,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Bc,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new Sl(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let l=0;l<o;l++)this.textures[l]=s.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(r){this.textures[0]=r}setSize(r,e,i=1){if(this.width!==r||this.height!==e||this.depth!==i){this.width=r,this.height=e,this.depth=i;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=r,this.textures[n].image.height=e,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,r,e),this.scissor.set(0,0,r,e)}clone(){return new this.constructor().copy(this)}copy(r){this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.textures.length=0;for(let i=0,n=r.textures.length;i<n;i++)this.textures[i]=r.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const e=Object.assign({},r.texture.image);return this.texture.source=new fP(e),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.samples=r.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Fh=class extends AK{constructor(r=1,e=1,i={}){super(r,e,i),this.isWebGLRenderTarget=!0}},mP=class extends Sl{constructor(r=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:r,width:e,height:i,depth:n},this.magFilter=Kl,this.minFilter=Kl,this.wrapR=ep,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(r){this.layerUpdates.add(r)}clearLayerUpdates(){this.layerUpdates.clear()}};class yK extends Sl{constructor(e=null,i=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:n,depth:s},this.magFilter=Kl,this.minFilter=Kl,this.wrapR=ep,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let Nc=class{constructor(r=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=r,this._y=e,this._z=i,this._w=n}static slerpFlat(r,e,i,n,s,o,l){let u=i[n+0],c=i[n+1],d=i[n+2],p=i[n+3];const f=s[o+0],m=s[o+1],g=s[o+2],y=s[o+3];if(l===0){r[e+0]=u,r[e+1]=c,r[e+2]=d,r[e+3]=p;return}if(l===1){r[e+0]=f,r[e+1]=m,r[e+2]=g,r[e+3]=y;return}if(p!==y||u!==f||c!==m||d!==g){let x=1-l;const v=u*f+c*m+d*g+p*y,_=v>=0?1:-1,T=1-v*v;if(T>Number.EPSILON){const S=Math.sqrt(T),R=Math.atan2(S,v*_);x=Math.sin(x*R)/S,l=Math.sin(l*R)/S}const w=l*_;if(u=u*x+f*w,c=c*x+m*w,d=d*x+g*w,p=p*x+y*w,x===1-l){const S=1/Math.sqrt(u*u+c*c+d*d+p*p);u*=S,c*=S,d*=S,p*=S}}r[e]=u,r[e+1]=c,r[e+2]=d,r[e+3]=p}static multiplyQuaternionsFlat(r,e,i,n,s,o){const l=i[n],u=i[n+1],c=i[n+2],d=i[n+3],p=s[o],f=s[o+1],m=s[o+2],g=s[o+3];return r[e]=l*g+d*p+u*m-c*f,r[e+1]=u*g+d*f+c*p-l*m,r[e+2]=c*g+d*m+l*f-u*p,r[e+3]=d*g-l*p-u*f-c*m,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,e,i,n){return this._x=r,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,e=!0){const i=r._x,n=r._y,s=r._z,o=r._order,l=Math.cos,u=Math.sin,c=l(i/2),d=l(n/2),p=l(s/2),f=u(i/2),m=u(n/2),g=u(s/2);switch(o){case"XYZ":this._x=f*d*p+c*m*g,this._y=c*m*p-f*d*g,this._z=c*d*g+f*m*p,this._w=c*d*p-f*m*g;break;case"YXZ":this._x=f*d*p+c*m*g,this._y=c*m*p-f*d*g,this._z=c*d*g-f*m*p,this._w=c*d*p+f*m*g;break;case"ZXY":this._x=f*d*p-c*m*g,this._y=c*m*p+f*d*g,this._z=c*d*g+f*m*p,this._w=c*d*p-f*m*g;break;case"ZYX":this._x=f*d*p-c*m*g,this._y=c*m*p+f*d*g,this._z=c*d*g-f*m*p,this._w=c*d*p+f*m*g;break;case"YZX":this._x=f*d*p+c*m*g,this._y=c*m*p+f*d*g,this._z=c*d*g-f*m*p,this._w=c*d*p-f*m*g;break;case"XZY":this._x=f*d*p-c*m*g,this._y=c*m*p-f*d*g,this._z=c*d*g+f*m*p,this._w=c*d*p+f*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(r,e){const i=e/2,n=Math.sin(i);return this._x=r.x*n,this._y=r.y*n,this._z=r.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(r){const e=r.elements,i=e[0],n=e[4],s=e[8],o=e[1],l=e[5],u=e[9],c=e[2],d=e[6],p=e[10],f=i+l+p;if(f>0){const m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(d-u)*m,this._y=(s-c)*m,this._z=(o-n)*m}else if(i>l&&i>p){const m=2*Math.sqrt(1+i-l-p);this._w=(d-u)/m,this._x=.25*m,this._y=(n+o)/m,this._z=(s+c)/m}else if(l>p){const m=2*Math.sqrt(1+l-i-p);this._w=(s-c)/m,this._x=(n+o)/m,this._y=.25*m,this._z=(u+d)/m}else{const m=2*Math.sqrt(1+p-i-l);this._w=(o-n)/m,this._x=(s+c)/m,this._y=(u+d)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(r,e){let i=r.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=i):(this._x=0,this._y=-r.z,this._z=r.y,this._w=i)):(this._x=r.y*e.z-r.z*e.y,this._y=r.z*e.x-r.x*e.z,this._z=r.x*e.y-r.y*e.x,this._w=i),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(ba(this.dot(r),-1,1)))}rotateTowards(r,e){const i=this.angleTo(r);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(r,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,e){const i=r._x,n=r._y,s=r._z,o=r._w,l=e._x,u=e._y,c=e._z,d=e._w;return this._x=i*d+o*l+n*c-s*u,this._y=n*d+o*u+s*l-i*c,this._z=s*d+o*c+i*u-n*l,this._w=o*d-i*l-n*u-s*c,this._onChangeCallback(),this}slerp(r,e){if(e===0)return this;if(e===1)return this.copy(r);const i=this._x,n=this._y,s=this._z,o=this._w;let l=o*r._w+i*r._x+n*r._y+s*r._z;if(l<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,l=-l):this.copy(r),l>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const u=1-l*l;if(u<=Number.EPSILON){const m=1-e;return this._w=m*o+e*this._w,this._x=m*i+e*this._x,this._y=m*n+e*this._y,this._z=m*s+e*this._z,this.normalize(),this}const c=Math.sqrt(u),d=Math.atan2(c,l),p=Math.sin((1-e)*d)/c,f=Math.sin(e*d)/c;return this._w=o*p+this._w*f,this._x=i*p+this._x*f,this._y=n*p+this._y*f,this._z=s*p+this._z*f,this._onChangeCallback(),this}slerpQuaternions(r,e,i){return this.copy(r).slerp(e,i)}random(){const r=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(n*Math.sin(r),n*Math.cos(r),s*Math.sin(e),s*Math.cos(e))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,e=0){return this._x=r[e],this._y=r[e+1],this._z=r[e+2],this._w=r[e+3],this._onChangeCallback(),this}toArray(r=[],e=0){return r[e]=this._x,r[e+1]=this._y,r[e+2]=this._z,r[e+3]=this._w,r}fromBufferAttribute(r,e){return this._x=r.getX(e),this._y=r.getY(e),this._z=r.getZ(e),this._w=r.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},at=class lG{constructor(e=0,i=0,n=0){lG.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(gP.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(gP.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*n+o[6]*s,this.y=o[1]*i+o[4]*n+o[7]*s,this.z=o[2]*i+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=e.elements,l=1/(o[3]*i+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*n+o[8]*s+o[12])*l,this.y=(o[1]*i+o[5]*n+o[9]*s+o[13])*l,this.z=(o[2]*i+o[6]*n+o[10]*s+o[14])*l,this}applyQuaternion(e){const i=this.x,n=this.y,s=this.z,o=e.x,l=e.y,u=e.z,c=e.w,d=2*(l*s-u*n),p=2*(u*i-o*s),f=2*(o*n-l*i);return this.x=i+c*d+l*f-u*p,this.y=n+c*p+u*d-o*f,this.z=s+c*f+o*p-l*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*s,this.y=o[1]*i+o[5]*n+o[9]*s,this.z=o[2]*i+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,s=e.y,o=e.z,l=i.x,u=i.y,c=i.z;return this.x=s*c-o*u,this.y=o*l-n*c,this.z=n*u-s*l,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return aS.copy(this).projectOnVector(e),this.sub(aS)}reflect(e){return this.sub(aS.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(ba(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return i*i+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const s=Math.sin(i)*e;return this.x=s*Math.sin(n),this.y=Math.cos(i)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const aS=new at,gP=new Nc;let np=class{constructor(r=new at(1/0,1/0,1/0),e=new at(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=e}set(r,e){return this.min.copy(r),this.max.copy(e),this}setFromArray(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e+=3)this.expandByPoint($l.fromArray(r,e));return this}setFromBufferAttribute(r){this.makeEmpty();for(let e=0,i=r.count;e<i;e++)this.expandByPoint($l.fromBufferAttribute(r,e));return this}setFromPoints(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(r,e){const i=$l.copy(e).multiplyScalar(.5);return this.min.copy(r).sub(i),this.max.copy(r).add(i),this}setFromObject(r,e=!1){return this.makeEmpty(),this.expandByObject(r,e)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,e=!1){r.updateWorldMatrix(!1,!1);const i=r.geometry;if(i!==void 0){const s=i.getAttribute("position");if(e===!0&&s!==void 0&&r.isInstancedMesh!==!0)for(let o=0,l=s.count;o<l;o++)r.isMesh===!0?r.getVertexPosition(o,$l):$l.fromBufferAttribute(s,o),$l.applyMatrix4(r.matrixWorld),this.expandByPoint($l);else r.boundingBox!==void 0?(r.boundingBox===null&&r.computeBoundingBox(),qx.copy(r.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),qx.copy(i.boundingBox)),qx.applyMatrix4(r.matrixWorld),this.union(qx)}const n=r.children;for(let s=0,o=n.length;s<o;s++)this.expandByObject(n[s],e);return this}containsPoint(r){return r.x>=this.min.x&&r.x<=this.max.x&&r.y>=this.min.y&&r.y<=this.max.y&&r.z>=this.min.z&&r.z<=this.max.z}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,e){return e.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return r.max.x>=this.min.x&&r.min.x<=this.max.x&&r.max.y>=this.min.y&&r.min.y<=this.max.y&&r.max.z>=this.min.z&&r.min.z<=this.max.z}intersectsSphere(r){return this.clampPoint(r.center,$l),$l.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let e,i;return r.normal.x>0?(e=r.normal.x*this.min.x,i=r.normal.x*this.max.x):(e=r.normal.x*this.max.x,i=r.normal.x*this.min.x),r.normal.y>0?(e+=r.normal.y*this.min.y,i+=r.normal.y*this.max.y):(e+=r.normal.y*this.max.y,i+=r.normal.y*this.min.y),r.normal.z>0?(e+=r.normal.z*this.min.z,i+=r.normal.z*this.max.z):(e+=r.normal.z*this.max.z,i+=r.normal.z*this.min.z),e<=-r.constant&&i>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(oA),Xx.subVectors(this.max,oA),fm.subVectors(r.a,oA),mm.subVectors(r.b,oA),gm.subVectors(r.c,oA),kh.subVectors(mm,fm),Uh.subVectors(gm,mm),sp.subVectors(fm,gm);let e=[0,-kh.z,kh.y,0,-Uh.z,Uh.y,0,-sp.z,sp.y,kh.z,0,-kh.x,Uh.z,0,-Uh.x,sp.z,0,-sp.x,-kh.y,kh.x,0,-Uh.y,Uh.x,0,-sp.y,sp.x,0];return!oS(e,fm,mm,gm,Xx)||(e=[1,0,0,0,1,0,0,0,1],!oS(e,fm,mm,gm,Xx))?!1:(Yx.crossVectors(kh,Uh),e=[Yx.x,Yx.y,Yx.z],oS(e,fm,mm,gm,Xx))}clampPoint(r,e){return e.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,$l).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=this.getSize($l).length()*.5),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()?this:(bu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),bu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),bu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),bu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),bu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),bu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),bu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),bu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(bu),this)}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}};const bu=[new at,new at,new at,new at,new at,new at,new at,new at],$l=new at,qx=new np,fm=new at,mm=new at,gm=new at,kh=new at,Uh=new at,sp=new at,oA=new at,Xx=new at,Yx=new at,ap=new at;function oS(r,e,i,n,s){for(let o=0,l=r.length-3;o<=l;o+=3){ap.fromArray(r,o);const u=s.x*Math.abs(ap.x)+s.y*Math.abs(ap.y)+s.z*Math.abs(ap.z),c=e.dot(ap),d=i.dot(ap),p=n.dot(ap);if(Math.max(-Math.max(c,d,p),Math.min(c,d,p))>u)return!1}return!0}const vK=new np,lA=new at,lS=new at;let Kx=class{constructor(r=new at,e=-1){this.isSphere=!0,this.center=r,this.radius=e}set(r,e){return this.center.copy(r),this.radius=e,this}setFromPoints(r,e){const i=this.center;e!==void 0?i.copy(e):vK.setFromPoints(r).getCenter(i);let n=0;for(let s=0,o=r.length;s<o;s++)n=Math.max(n,i.distanceToSquared(r[s]));return this.radius=Math.sqrt(n),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const e=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=e*e}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,e){const i=this.center.distanceToSquared(r);return e.copy(r),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;lA.subVectors(r,this.center);const e=lA.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.addScaledVector(lA,n/i),this.radius+=n}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(lS.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(lA.copy(r.center).add(lS)),this.expandByPoint(lA.copy(r.center).sub(lS))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}};const _u=new at,cS=new at,Jx=new at,zh=new at,uS=new at,Zx=new at,hS=new at;let $x=class{constructor(r=new at,e=new at(0,0,-1)){this.origin=r,this.direction=e}set(r,e){return this.origin.copy(r),this.direction.copy(e),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,e){return e.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,_u)),this}closestPointToPoint(r,e){e.subVectors(r,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const e=_u.subVectors(r,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(r):(_u.copy(this.origin).addScaledVector(this.direction,e),_u.distanceToSquared(r))}distanceSqToSegment(r,e,i,n){cS.copy(r).add(e).multiplyScalar(.5),Jx.copy(e).sub(r).normalize(),zh.copy(this.origin).sub(cS);const s=r.distanceTo(e)*.5,o=-this.direction.dot(Jx),l=zh.dot(this.direction),u=-zh.dot(Jx),c=zh.lengthSq(),d=Math.abs(1-o*o);let p,f,m,g;if(d>0)if(p=o*u-l,f=o*l-u,g=s*d,p>=0)if(f>=-g)if(f<=g){const y=1/d;p*=y,f*=y,m=p*(p+o*f+2*l)+f*(o*p+f+2*u)+c}else f=s,p=Math.max(0,-(o*f+l)),m=-p*p+f*(f+2*u)+c;else f=-s,p=Math.max(0,-(o*f+l)),m=-p*p+f*(f+2*u)+c;else f<=-g?(p=Math.max(0,-(-o*s+l)),f=p>0?-s:Math.min(Math.max(-s,-u),s),m=-p*p+f*(f+2*u)+c):f<=g?(p=0,f=Math.min(Math.max(-s,-u),s),m=f*(f+2*u)+c):(p=Math.max(0,-(o*s+l)),f=p>0?s:Math.min(Math.max(-s,-u),s),m=-p*p+f*(f+2*u)+c);else f=o>0?-s:s,p=Math.max(0,-(o*f+l)),m=-p*p+f*(f+2*u)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,p),n&&n.copy(cS).addScaledVector(Jx,f),m}intersectSphere(r,e){_u.subVectors(r.center,this.origin);const i=_u.dot(this.direction),n=_u.dot(_u)-i*i,s=r.radius*r.radius;if(n>s)return null;const o=Math.sqrt(s-n),l=i-o,u=i+o;return u<0?null:l<0?this.at(u,e):this.at(l,e)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const e=r.normal.dot(this.direction);if(e===0)return r.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(r.normal)+r.constant)/e;return i>=0?i:null}intersectPlane(r,e){const i=this.distanceToPlane(r);return i===null?null:this.at(i,e)}intersectsPlane(r){const e=r.distanceToPoint(this.origin);return e===0||r.normal.dot(this.direction)*e<0}intersectBox(r,e){let i,n,s,o,l,u;const c=1/this.direction.x,d=1/this.direction.y,p=1/this.direction.z,f=this.origin;return c>=0?(i=(r.min.x-f.x)*c,n=(r.max.x-f.x)*c):(i=(r.max.x-f.x)*c,n=(r.min.x-f.x)*c),d>=0?(s=(r.min.y-f.y)*d,o=(r.max.y-f.y)*d):(s=(r.max.y-f.y)*d,o=(r.min.y-f.y)*d),i>o||s>n||((s>i||isNaN(i))&&(i=s),(o<n||isNaN(n))&&(n=o),p>=0?(l=(r.min.z-f.z)*p,u=(r.max.z-f.z)*p):(l=(r.max.z-f.z)*p,u=(r.min.z-f.z)*p),i>u||l>n)||((l>i||i!==i)&&(i=l),(u<n||n!==n)&&(n=u),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(r){return this.intersectBox(r,_u)!==null}intersectTriangle(r,e,i,n,s){uS.subVectors(e,r),Zx.subVectors(i,r),hS.crossVectors(uS,Zx);let o=this.direction.dot(hS),l;if(o>0){if(n)return null;l=1}else if(o<0)l=-1,o=-o;else return null;zh.subVectors(this.origin,r);const u=l*this.direction.dot(Zx.crossVectors(zh,Zx));if(u<0)return null;const c=l*this.direction.dot(uS.cross(zh));if(c<0||u+c>o)return null;const d=-l*zh.dot(hS);return d<0?null:this.at(d/o,s)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},ps=class LN{constructor(e,i,n,s,o,l,u,c,d,p,f,m,g,y,x,v){LN.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,d,p,f,m,g,y,x,v)}set(e,i,n,s,o,l,u,c,d,p,f,m,g,y,x,v){const _=this.elements;return _[0]=e,_[4]=i,_[8]=n,_[12]=s,_[1]=o,_[5]=l,_[9]=u,_[13]=c,_[2]=d,_[6]=p,_[10]=f,_[14]=m,_[3]=g,_[7]=y,_[11]=x,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new LN().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,s=1/Am.setFromMatrixColumn(e,0).length(),o=1/Am.setFromMatrixColumn(e,1).length(),l=1/Am.setFromMatrixColumn(e,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*l,i[9]=n[9]*l,i[10]=n[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,s=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),d=Math.sin(s),p=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){const m=l*p,g=l*f,y=u*p,x=u*f;i[0]=c*p,i[4]=-c*f,i[8]=d,i[1]=g+y*d,i[5]=m-x*d,i[9]=-u*c,i[2]=x-m*d,i[6]=y+g*d,i[10]=l*c}else if(e.order==="YXZ"){const m=c*p,g=c*f,y=d*p,x=d*f;i[0]=m+x*u,i[4]=y*u-g,i[8]=l*d,i[1]=l*f,i[5]=l*p,i[9]=-u,i[2]=g*u-y,i[6]=x+m*u,i[10]=l*c}else if(e.order==="ZXY"){const m=c*p,g=c*f,y=d*p,x=d*f;i[0]=m-x*u,i[4]=-l*f,i[8]=y+g*u,i[1]=g+y*u,i[5]=l*p,i[9]=x-m*u,i[2]=-l*d,i[6]=u,i[10]=l*c}else if(e.order==="ZYX"){const m=l*p,g=l*f,y=u*p,x=u*f;i[0]=c*p,i[4]=y*d-g,i[8]=m*d+x,i[1]=c*f,i[5]=x*d+m,i[9]=g*d-y,i[2]=-d,i[6]=u*c,i[10]=l*c}else if(e.order==="YZX"){const m=l*c,g=l*d,y=u*c,x=u*d;i[0]=c*p,i[4]=x-m*f,i[8]=y*f+g,i[1]=f,i[5]=l*p,i[9]=-u*p,i[2]=-d*p,i[6]=g*f+y,i[10]=m-x*f}else if(e.order==="XZY"){const m=l*c,g=l*d,y=u*c,x=u*d;i[0]=c*p,i[4]=-f,i[8]=d*p,i[1]=m*f+x,i[5]=l*p,i[9]=g*f-y,i[2]=y*f-g,i[6]=u*p,i[10]=x*f+m}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(xK,e,bK)}lookAt(e,i,n){const s=this.elements;return rl.subVectors(e,i),rl.lengthSq()===0&&(rl.z=1),rl.normalize(),jh.crossVectors(n,rl),jh.lengthSq()===0&&(Math.abs(n.z)===1?rl.x+=1e-4:rl.z+=1e-4,rl.normalize(),jh.crossVectors(n,rl)),jh.normalize(),eb.crossVectors(rl,jh),s[0]=jh.x,s[4]=eb.x,s[8]=rl.x,s[1]=jh.y,s[5]=eb.y,s[9]=rl.y,s[2]=jh.z,s[6]=eb.z,s[10]=rl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[4],c=n[8],d=n[12],p=n[1],f=n[5],m=n[9],g=n[13],y=n[2],x=n[6],v=n[10],_=n[14],T=n[3],w=n[7],S=n[11],R=n[15],B=s[0],I=s[4],D=s[8],L=s[12],O=s[1],U=s[5],J=s[9],H=s[13],V=s[2],$=s[6],Q=s[10],G=s[14],j=s[3],ie=s[7],Y=s[11],ae=s[15];return o[0]=l*B+u*O+c*V+d*j,o[4]=l*I+u*U+c*$+d*ie,o[8]=l*D+u*J+c*Q+d*Y,o[12]=l*L+u*H+c*G+d*ae,o[1]=p*B+f*O+m*V+g*j,o[5]=p*I+f*U+m*$+g*ie,o[9]=p*D+f*J+m*Q+g*Y,o[13]=p*L+f*H+m*G+g*ae,o[2]=y*B+x*O+v*V+_*j,o[6]=y*I+x*U+v*$+_*ie,o[10]=y*D+x*J+v*Q+_*Y,o[14]=y*L+x*H+v*G+_*ae,o[3]=T*B+w*O+S*V+R*j,o[7]=T*I+w*U+S*$+R*ie,o[11]=T*D+w*J+S*Q+R*Y,o[15]=T*L+w*H+S*G+R*ae,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],s=e[8],o=e[12],l=e[1],u=e[5],c=e[9],d=e[13],p=e[2],f=e[6],m=e[10],g=e[14],y=e[3],x=e[7],v=e[11],_=e[15];return y*(+o*c*f-s*d*f-o*u*m+n*d*m+s*u*g-n*c*g)+x*(+i*c*g-i*d*m+o*l*m-s*l*g+s*d*p-o*c*p)+v*(+i*d*f-i*u*g-o*l*f+n*l*g+o*u*p-n*d*p)+_*(-s*u*p-i*c*f+i*u*m+s*l*f-n*l*m+n*c*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8],f=e[9],m=e[10],g=e[11],y=e[12],x=e[13],v=e[14],_=e[15],T=f*v*d-x*m*d+x*c*g-u*v*g-f*c*_+u*m*_,w=y*m*d-p*v*d-y*c*g+l*v*g+p*c*_-l*m*_,S=p*x*d-y*f*d+y*u*g-l*x*g-p*u*_+l*f*_,R=y*f*c-p*x*c-y*u*m+l*x*m+p*u*v-l*f*v,B=i*T+n*w+s*S+o*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/B;return e[0]=T*I,e[1]=(x*m*o-f*v*o-x*s*g+n*v*g+f*s*_-n*m*_)*I,e[2]=(u*v*o-x*c*o+x*s*d-n*v*d-u*s*_+n*c*_)*I,e[3]=(f*c*o-u*m*o-f*s*d+n*m*d+u*s*g-n*c*g)*I,e[4]=w*I,e[5]=(p*v*o-y*m*o+y*s*g-i*v*g-p*s*_+i*m*_)*I,e[6]=(y*c*o-l*v*o-y*s*d+i*v*d+l*s*_-i*c*_)*I,e[7]=(l*m*o-p*c*o+p*s*d-i*m*d-l*s*g+i*c*g)*I,e[8]=S*I,e[9]=(y*f*o-p*x*o-y*n*g+i*x*g+p*n*_-i*f*_)*I,e[10]=(l*x*o-y*u*o+y*n*d-i*x*d-l*n*_+i*u*_)*I,e[11]=(p*u*o-l*f*o-p*n*d+i*f*d+l*n*g-i*u*g)*I,e[12]=R*I,e[13]=(p*x*s-y*f*s+y*n*m-i*x*m-p*n*v+i*f*v)*I,e[14]=(y*u*s-l*x*s-y*n*c+i*x*c+l*n*v-i*u*v)*I,e[15]=(l*f*s-p*u*s+p*n*c-i*f*c-l*n*m+i*u*m)*I,this}scale(e){const i=this.elements,n=e.x,s=e.y,o=e.z;return i[0]*=n,i[4]*=s,i[8]*=o,i[1]*=n,i[5]*=s,i[9]*=o,i[2]*=n,i[6]*=s,i[10]*=o,i[3]*=n,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,s))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),s=Math.sin(i),o=1-n,l=e.x,u=e.y,c=e.z,d=o*l,p=o*u;return this.set(d*l+n,d*u-s*c,d*c+s*u,0,d*u+s*c,p*u+n,p*c-s*l,0,d*c-s*u,p*c+s*l,o*c*c+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,s,o,l){return this.set(1,n,o,0,e,1,l,0,i,s,1,0,0,0,0,1),this}compose(e,i,n){const s=this.elements,o=i._x,l=i._y,u=i._z,c=i._w,d=o+o,p=l+l,f=u+u,m=o*d,g=o*p,y=o*f,x=l*p,v=l*f,_=u*f,T=c*d,w=c*p,S=c*f,R=n.x,B=n.y,I=n.z;return s[0]=(1-(x+_))*R,s[1]=(g+S)*R,s[2]=(y-w)*R,s[3]=0,s[4]=(g-S)*B,s[5]=(1-(m+_))*B,s[6]=(v+T)*B,s[7]=0,s[8]=(y+w)*I,s[9]=(v-T)*I,s[10]=(1-(m+x))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,n){const s=this.elements;let o=Am.set(s[0],s[1],s[2]).length();const l=Am.set(s[4],s[5],s[6]).length(),u=Am.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],ec.copy(this);const c=1/o,d=1/l,p=1/u;return ec.elements[0]*=c,ec.elements[1]*=c,ec.elements[2]*=c,ec.elements[4]*=d,ec.elements[5]*=d,ec.elements[6]*=d,ec.elements[8]*=p,ec.elements[9]*=p,ec.elements[10]*=p,i.setFromRotationMatrix(ec),n.x=o,n.y=l,n.z=u,this}makePerspective(e,i,n,s,o,l,u=yu){const c=this.elements,d=2*o/(i-e),p=2*o/(n-s),f=(i+e)/(i-e),m=(n+s)/(n-s);let g,y;if(u===yu)g=-(l+o)/(l-o),y=-2*l*o/(l-o);else if(u===Qx)g=-l/(l-o),y=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=d,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,n,s,o,l,u=yu){const c=this.elements,d=1/(i-e),p=1/(n-s),f=1/(l-o),m=(i+e)*d,g=(n+s)*p;let y,x;if(u===yu)y=(l+o)*f,x=-2*f;else if(u===Qx)y=o*f,x=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*d,c[4]=0,c[8]=0,c[12]=-m,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-g,c[2]=0,c[6]=0,c[10]=x,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}};const Am=new at,ec=new ps,xK=new at(0,0,0),bK=new at(1,1,1),jh=new at,eb=new at,rl=new at,AP=new ps,yP=new Nc;let Vh=class cG{constructor(e=0,i=0,n=0,s=cG.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,s=this._order){return this._x=e,this._y=i,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],c=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];switch(i){case"XYZ":this._y=Math.asin(ba(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-p,g),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(m,d),this._z=0);break;case"YXZ":this._x=Math.asin(-ba(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(u,g),this._z=Math.atan2(c,d)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(ba(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-f,g),this._z=Math.atan2(-l,d)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-ba(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(m,g),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-l,d));break;case"YZX":this._z=Math.asin(ba(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,d),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,g));break;case"XZY":this._z=Math.asin(-ba(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(m,d),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-p,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return AP.makeRotationFromQuaternion(e),this.setFromRotationMatrix(AP,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return yP.setFromEuler(this),this.setFromQuaternion(yP,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Vh.DEFAULT_ORDER="XYZ";let dS=class{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!==0}isEnabled(r){return(this.mask&(1<<r|0))!==0}},_K=0;const vP=new at,ym=new Nc,Eu=new ps,tb=new at,cA=new at,EK=new at,wK=new Nc,xP=new at(1,0,0),bP=new at(0,1,0),_P=new at(0,0,1),EP={type:"added"},CK={type:"removed"},vm={type:"childadded",child:null},pS={type:"childremoved",child:null};let Xa=class Dw extends rp{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_K++}),this.uuid=vu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Dw.DEFAULT_UP.clone();const e=new at,i=new Vh,n=new Nc,s=new at(1,1,1);function o(){n.setFromEuler(i,!1)}function l(){i.setFromQuaternion(n,void 0,!1)}i._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ps},normalMatrix:{value:new pn}}),this.matrix=new ps,this.matrixWorld=new ps,this.matrixAutoUpdate=Dw.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Dw.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new dS,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return ym.setFromAxisAngle(e,i),this.quaternion.multiply(ym),this}rotateOnWorldAxis(e,i){return ym.setFromAxisAngle(e,i),this.quaternion.premultiply(ym),this}rotateX(e){return this.rotateOnAxis(xP,e)}rotateY(e){return this.rotateOnAxis(bP,e)}rotateZ(e){return this.rotateOnAxis(_P,e)}translateOnAxis(e,i){return vP.copy(e).applyQuaternion(this.quaternion),this.position.add(vP.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(xP,e)}translateY(e){return this.translateOnAxis(bP,e)}translateZ(e){return this.translateOnAxis(_P,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Eu.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?tb.copy(e):tb.set(e,i,n);const s=this.parent;this.updateWorldMatrix(!0,!1),cA.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Eu.lookAt(cA,tb,this.up):Eu.lookAt(tb,cA,this.up),this.quaternion.setFromRotationMatrix(Eu),s&&(Eu.extractRotation(s.matrixWorld),ym.setFromRotationMatrix(Eu),this.quaternion.premultiply(ym.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(EP),vm.child=e,this.dispatchEvent(vm),vm.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(CK),pS.child=e,this.dispatchEvent(pS),pS.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Eu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Eu.multiply(e.parent.matrixWorld)),e.applyMatrix4(Eu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(EP),vm.child=e,this.dispatchEvent(vm),vm.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cA,e,EK),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cA,wK,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].updateMatrixWorld(e)}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let d=0,p=c.length;d<p;d++){const f=c[d];o(e.shapes,f)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,d=this.material.length;c<d;c++)u.push(o(e.materials,this.material[c]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];s.animations.push(o(e.animations,c))}}if(i){const u=l(e.geometries),c=l(e.materials),d=l(e.textures),p=l(e.images),f=l(e.shapes),m=l(e.skeletons),g=l(e.animations),y=l(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),d.length>0&&(n.textures=d),p.length>0&&(n.images=p),f.length>0&&(n.shapes=f),m.length>0&&(n.skeletons=m),g.length>0&&(n.animations=g),y.length>0&&(n.nodes=y)}return n.object=s,n;function l(u){const c=[];for(const d in u){const p=u[d];delete p.metadata,c.push(p)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}};Xa.DEFAULT_UP=new at(0,1,0),Xa.DEFAULT_MATRIX_AUTO_UPDATE=!0,Xa.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const tc=new at,wu=new at,fS=new at,Cu=new at,xm=new at,bm=new at,wP=new at,mS=new at,gS=new at,AS=new at,yS=new qs,vS=new qs,xS=new qs;let op=class _0{constructor(e=new at,i=new at,n=new at){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,s){s.subVectors(n,i),tc.subVectors(e,i),s.cross(tc);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,n,s,o){tc.subVectors(s,i),wu.subVectors(n,i),fS.subVectors(e,i);const l=tc.dot(tc),u=tc.dot(wu),c=tc.dot(fS),d=wu.dot(wu),p=wu.dot(fS),f=l*d-u*u;if(f===0)return o.set(0,0,0),null;const m=1/f,g=(d*c-u*p)*m,y=(l*p-u*c)*m;return o.set(1-g-y,y,g)}static containsPoint(e,i,n,s){return this.getBarycoord(e,i,n,s,Cu)===null?!1:Cu.x>=0&&Cu.y>=0&&Cu.x+Cu.y<=1}static getInterpolation(e,i,n,s,o,l,u,c){return this.getBarycoord(e,i,n,s,Cu)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,Cu.x),c.addScaledVector(l,Cu.y),c.addScaledVector(u,Cu.z),c)}static getInterpolatedAttribute(e,i,n,s,o,l){return yS.setScalar(0),vS.setScalar(0),xS.setScalar(0),yS.fromBufferAttribute(e,i),vS.fromBufferAttribute(e,n),xS.fromBufferAttribute(e,s),l.setScalar(0),l.addScaledVector(yS,o.x),l.addScaledVector(vS,o.y),l.addScaledVector(xS,o.z),l}static isFrontFacing(e,i,n,s){return tc.subVectors(n,i),wu.subVectors(e,i),tc.cross(wu).dot(s)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,s){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,n,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return tc.subVectors(this.c,this.b),wu.subVectors(this.a,this.b),tc.cross(wu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return _0.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return _0.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,s,o){return _0.getInterpolation(e,this.a,this.b,this.c,i,n,s,o)}containsPoint(e){return _0.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return _0.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,s=this.b,o=this.c;let l,u;xm.subVectors(s,n),bm.subVectors(o,n),mS.subVectors(e,n);const c=xm.dot(mS),d=bm.dot(mS);if(c<=0&&d<=0)return i.copy(n);gS.subVectors(e,s);const p=xm.dot(gS),f=bm.dot(gS);if(p>=0&&f<=p)return i.copy(s);const m=c*f-p*d;if(m<=0&&c>=0&&p<=0)return l=c/(c-p),i.copy(n).addScaledVector(xm,l);AS.subVectors(e,o);const g=xm.dot(AS),y=bm.dot(AS);if(y>=0&&g<=y)return i.copy(o);const x=g*d-c*y;if(x<=0&&d>=0&&y<=0)return u=d/(d-y),i.copy(n).addScaledVector(bm,u);const v=p*y-g*f;if(v<=0&&f-p>=0&&g-y>=0)return wP.subVectors(o,s),u=(f-p)/(f-p+(g-y)),i.copy(s).addScaledVector(wP,u);const _=1/(v+x+m);return l=x*_,u=m*_,i.copy(n).addScaledVector(xm,l).addScaledVector(bm,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const CP={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gh={h:0,s:0,l:0},ib={h:0,s:0,l:0};function bS(r,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(e-r)*6*i:i<1/2?e:i<2/3?r+(e-r)*6*(2/3-i):r}let wn=class{constructor(r,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(r,e,i)}set(r,e,i){if(e===void 0&&i===void 0){const n=r;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(r,e,i);return this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,e=Do){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(r&255)/255,Pn.toWorkingColorSpace(this,e),this}setRGB(r,e,i,n=Pn.workingColorSpace){return this.r=r,this.g=e,this.b=i,Pn.toWorkingColorSpace(this,n),this}setHSL(r,e,i,n=Pn.workingColorSpace){if(r=iS(r,1),e=ba(e,0,1),i=ba(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,o=2*i-s;this.r=bS(o,s,r+1/3),this.g=bS(o,s,r),this.b=bS(o,s,r-1/3)}return Pn.toWorkingColorSpace(this,n),this}setStyle(r,e=Do){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(r)){let s;const o=n[1],l=n[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(r)){const s=n[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,e);return this}setColorName(r,e=Do){const i=CP[r.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=xu(r.r),this.g=xu(r.g),this.b=xu(r.b),this}copyLinearToSRGB(r){return this.r=dm(r.r),this.g=dm(r.g),this.b=dm(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=Do){return Pn.fromWorkingColorSpace(Ya.copy(this),r),Math.round(ba(Ya.r*255,0,255))*65536+Math.round(ba(Ya.g*255,0,255))*256+Math.round(ba(Ya.b*255,0,255))}getHexString(r=Do){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,e=Pn.workingColorSpace){Pn.fromWorkingColorSpace(Ya.copy(this),e);const i=Ya.r,n=Ya.g,s=Ya.b,o=Math.max(i,n,s),l=Math.min(i,n,s);let u,c;const d=(l+o)/2;if(l===o)u=0,c=0;else{const p=o-l;switch(c=d<=.5?p/(o+l):p/(2-o-l),o){case i:u=(n-s)/p+(n<s?6:0);break;case n:u=(s-i)/p+2;break;case s:u=(i-n)/p+4;break}u/=6}return r.h=u,r.s=c,r.l=d,r}getRGB(r,e=Pn.workingColorSpace){return Pn.fromWorkingColorSpace(Ya.copy(this),e),r.r=Ya.r,r.g=Ya.g,r.b=Ya.b,r}getStyle(r=Do){Pn.fromWorkingColorSpace(Ya.copy(this),r);const e=Ya.r,i=Ya.g,n=Ya.b;return r!==Do?`color(${r} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(r,e,i){return this.getHSL(Gh),this.setHSL(Gh.h+r,Gh.s+e,Gh.l+i)}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,e){return this.r=r.r+e.r,this.g=r.g+e.g,this.b=r.b+e.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,e){return this.r+=(r.r-this.r)*e,this.g+=(r.g-this.g)*e,this.b+=(r.b-this.b)*e,this}lerpColors(r,e,i){return this.r=r.r+(e.r-r.r)*i,this.g=r.g+(e.g-r.g)*i,this.b=r.b+(e.b-r.b)*i,this}lerpHSL(r,e){this.getHSL(Gh),r.getHSL(ib);const i=nA(Gh.h,ib.h,e),n=nA(Gh.s,ib.s,e),s=nA(Gh.l,ib.l,e);return this.setHSL(i,n,s),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const e=this.r,i=this.g,n=this.b,s=r.elements;return this.r=s[0]*e+s[3]*i+s[6]*n,this.g=s[1]*e+s[4]*i+s[7]*n,this.b=s[2]*e+s[5]*i+s[8]*n,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,e=0){return this.r=r[e],this.g=r[e+1],this.b=r[e+2],this}toArray(r=[],e=0){return r[e]=this.r,r[e+1]=this.g,r[e+2]=this.b,r}fromBufferAttribute(r,e){return this.r=r.getX(e),this.g=r.getY(e),this.b=r.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Ya=new wn;wn.NAMES=CP;let SK=0,lp=class extends rp{static get type(){return"Material"}get type(){return this.constructor.type}set type(r){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:SK++}),this.uuid=vu(),this.name="",this.blending=im,this.side=Dh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=lC,this.blendDst=cC,this.blendEquation=$d,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new wn(0,0,0),this.blendAlpha=0,this.depthFunc=rm,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=rP,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hm,this.stencilZFail=hm,this.stencilZPass=hm,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const e in r){const i=r[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];if(n===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}}toJSON(r){const e=r===void 0||typeof r=="string";e&&(r={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(r).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(r).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(r).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(r).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(r).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==im&&(i.blending=this.blending),this.side!==Dh&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==lC&&(i.blendSrc=this.blendSrc),this.blendDst!==cC&&(i.blendDst=this.blendDst),this.blendEquation!==$d&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==rm&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==rP&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hm&&(i.stencilFail=this.stencilFail),this.stencilZFail!==hm&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==hm&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(s){const o=[];for(const l in s){const u=s[l];delete u.metadata,o.push(u)}return o}if(e){const s=n(r.textures),o=n(r.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.blendColor.copy(r.blendColor),this.blendAlpha=r.blendAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const e=r.clippingPlanes;let i=null;if(e!==null){const n=e.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaHash=r.alphaHash,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=JSON.parse(JSON.stringify(r.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}},Hh=class extends lp{static get type(){return"MeshBasicMaterial"}constructor(r){super(),this.isMeshBasicMaterial=!0,this.color=new wn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Vh,this.combine=AC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}};const Xs=new at,rb=new zi;let Oo=class{constructor(r,e,i=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=e,this.count=r!==void 0?r.length/e:0,this.normalized=i,this.usage=tS,this.updateRanges=[],this.gpuType=Au,this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}addUpdateRange(r,e){this.updateRanges.push({start:r,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this.gpuType=r.gpuType,this}copyAt(r,e,i){r*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[r+n]=e.array[i+n];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)rb.fromBufferAttribute(this,e),rb.applyMatrix3(r),this.setXY(e,rb.x,rb.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Xs.fromBufferAttribute(this,e),Xs.applyMatrix3(r),this.setXYZ(e,Xs.x,Xs.y,Xs.z);return this}applyMatrix4(r){for(let e=0,i=this.count;e<i;e++)Xs.fromBufferAttribute(this,e),Xs.applyMatrix4(r),this.setXYZ(e,Xs.x,Xs.y,Xs.z);return this}applyNormalMatrix(r){for(let e=0,i=this.count;e<i;e++)Xs.fromBufferAttribute(this,e),Xs.applyNormalMatrix(r),this.setXYZ(e,Xs.x,Xs.y,Xs.z);return this}transformDirection(r){for(let e=0,i=this.count;e<i;e++)Xs.fromBufferAttribute(this,e),Xs.transformDirection(r),this.setXYZ(e,Xs.x,Xs.y,Xs.z);return this}set(r,e=0){return this.array.set(r,e),this}getComponent(r,e){let i=this.array[r*this.itemSize+e];return this.normalized&&(i=Zl(i,this.array)),i}setComponent(r,e,i){return this.normalized&&(i=ts(i,this.array)),this.array[r*this.itemSize+e]=i,this}getX(r){let e=this.array[r*this.itemSize];return this.normalized&&(e=Zl(e,this.array)),e}setX(r,e){return this.normalized&&(e=ts(e,this.array)),this.array[r*this.itemSize]=e,this}getY(r){let e=this.array[r*this.itemSize+1];return this.normalized&&(e=Zl(e,this.array)),e}setY(r,e){return this.normalized&&(e=ts(e,this.array)),this.array[r*this.itemSize+1]=e,this}getZ(r){let e=this.array[r*this.itemSize+2];return this.normalized&&(e=Zl(e,this.array)),e}setZ(r,e){return this.normalized&&(e=ts(e,this.array)),this.array[r*this.itemSize+2]=e,this}getW(r){let e=this.array[r*this.itemSize+3];return this.normalized&&(e=Zl(e,this.array)),e}setW(r,e){return this.normalized&&(e=ts(e,this.array)),this.array[r*this.itemSize+3]=e,this}setXY(r,e,i){return r*=this.itemSize,this.normalized&&(e=ts(e,this.array),i=ts(i,this.array)),this.array[r+0]=e,this.array[r+1]=i,this}setXYZ(r,e,i,n){return r*=this.itemSize,this.normalized&&(e=ts(e,this.array),i=ts(i,this.array),n=ts(n,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this}setXYZW(r,e,i,n,s){return r*=this.itemSize,this.normalized&&(e=ts(e,this.array),i=ts(i,this.array),n=ts(n,this.array),s=ts(s,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this.array[r+3]=s,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==tS&&(r.usage=this.usage),r}},SP=class extends Oo{constructor(r,e,i){super(new Uint16Array(r),e,i)}},TP=class extends Oo{constructor(r,e,i){super(new Uint32Array(r),e,i)}},la=class extends Oo{constructor(r,e,i){super(new Float32Array(r),e,i)}},TK=0;const Tl=new ps,_S=new Xa,_m=new at,nl=new np,uA=new np,_a=new at;let Po=class uG extends rp{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:TK++}),this.uuid=vu(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(oP(e)?TP:SP)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new pn().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Tl.makeRotationFromQuaternion(e),this.applyMatrix4(Tl),this}rotateX(e){return Tl.makeRotationX(e),this.applyMatrix4(Tl),this}rotateY(e){return Tl.makeRotationY(e),this.applyMatrix4(Tl),this}rotateZ(e){return Tl.makeRotationZ(e),this.applyMatrix4(Tl),this}translate(e,i,n){return Tl.makeTranslation(e,i,n),this.applyMatrix4(Tl),this}scale(e,i,n){return Tl.makeScale(e,i,n),this.applyMatrix4(Tl),this}lookAt(e){return _S.lookAt(e),_S.updateMatrix(),this.applyMatrix4(_S.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_m).negate(),this.translate(_m.x,_m.y,_m.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const n=[];for(let s=0,o=e.length;s<o;s++){const l=e[s];n.push(l.x,l.y,l.z||0)}this.setAttribute("position",new la(n,3))}else{for(let n=0,s=i.count;n<s;n++){const o=e[n];i.setXYZ(n,o.x,o.y,o.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new np);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new at(-1/0,-1/0,-1/0),new at(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,s=i.length;n<s;n++){const o=i[n];nl.setFromBufferAttribute(o),this.morphTargetsRelative?(_a.addVectors(this.boundingBox.min,nl.min),this.boundingBox.expandByPoint(_a),_a.addVectors(this.boundingBox.max,nl.max),this.boundingBox.expandByPoint(_a)):(this.boundingBox.expandByPoint(nl.min),this.boundingBox.expandByPoint(nl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Kx);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new at,1/0);return}if(e){const n=this.boundingSphere.center;if(nl.setFromBufferAttribute(e),i)for(let o=0,l=i.length;o<l;o++){const u=i[o];uA.setFromBufferAttribute(u),this.morphTargetsRelative?(_a.addVectors(nl.min,uA.min),nl.expandByPoint(_a),_a.addVectors(nl.max,uA.max),nl.expandByPoint(_a)):(nl.expandByPoint(uA.min),nl.expandByPoint(uA.max))}nl.getCenter(n);let s=0;for(let o=0,l=e.count;o<l;o++)_a.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(_a));if(i)for(let o=0,l=i.length;o<l;o++){const u=i[o],c=this.morphTargetsRelative;for(let d=0,p=u.count;d<p;d++)_a.fromBufferAttribute(u,d),c&&(_m.fromBufferAttribute(e,d),_a.add(_m)),s=Math.max(s,n.distanceToSquared(_a))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Oo(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],c=[];for(let D=0;D<n.count;D++)u[D]=new at,c[D]=new at;const d=new at,p=new at,f=new at,m=new zi,g=new zi,y=new zi,x=new at,v=new at;function _(D,L,O){d.fromBufferAttribute(n,D),p.fromBufferAttribute(n,L),f.fromBufferAttribute(n,O),m.fromBufferAttribute(o,D),g.fromBufferAttribute(o,L),y.fromBufferAttribute(o,O),p.sub(d),f.sub(d),g.sub(m),y.sub(m);const U=1/(g.x*y.y-y.x*g.y);isFinite(U)&&(x.copy(p).multiplyScalar(y.y).addScaledVector(f,-g.y).multiplyScalar(U),v.copy(f).multiplyScalar(g.x).addScaledVector(p,-y.x).multiplyScalar(U),u[D].add(x),u[L].add(x),u[O].add(x),c[D].add(v),c[L].add(v),c[O].add(v))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let D=0,L=T.length;D<L;++D){const O=T[D],U=O.start,J=O.count;for(let H=U,V=U+J;H<V;H+=3)_(e.getX(H+0),e.getX(H+1),e.getX(H+2))}const w=new at,S=new at,R=new at,B=new at;function I(D){R.fromBufferAttribute(s,D),B.copy(R);const L=u[D];w.copy(L),w.sub(R.multiplyScalar(R.dot(L))).normalize(),S.crossVectors(B,L);const O=S.dot(c[D])<0?-1:1;l.setXYZW(D,w.x,w.y,w.z,O)}for(let D=0,L=T.length;D<L;++D){const O=T[D],U=O.start,J=O.count;for(let H=U,V=U+J;H<V;H+=3)I(e.getX(H+0)),I(e.getX(H+1)),I(e.getX(H+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Oo(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let m=0,g=n.count;m<g;m++)n.setXYZ(m,0,0,0);const s=new at,o=new at,l=new at,u=new at,c=new at,d=new at,p=new at,f=new at;if(e)for(let m=0,g=e.count;m<g;m+=3){const y=e.getX(m+0),x=e.getX(m+1),v=e.getX(m+2);s.fromBufferAttribute(i,y),o.fromBufferAttribute(i,x),l.fromBufferAttribute(i,v),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),u.fromBufferAttribute(n,y),c.fromBufferAttribute(n,x),d.fromBufferAttribute(n,v),u.add(p),c.add(p),d.add(p),n.setXYZ(y,u.x,u.y,u.z),n.setXYZ(x,c.x,c.y,c.z),n.setXYZ(v,d.x,d.y,d.z)}else for(let m=0,g=i.count;m<g;m+=3)s.fromBufferAttribute(i,m+0),o.fromBufferAttribute(i,m+1),l.fromBufferAttribute(i,m+2),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),n.setXYZ(m+0,p.x,p.y,p.z),n.setXYZ(m+1,p.x,p.y,p.z),n.setXYZ(m+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)_a.fromBufferAttribute(e,i),_a.normalize(),e.setXYZ(i,_a.x,_a.y,_a.z)}toNonIndexed(){function e(u,c){const d=u.array,p=u.itemSize,f=u.normalized,m=new d.constructor(c.length*p);let g=0,y=0;for(let x=0,v=c.length;x<v;x++){u.isInterleavedBufferAttribute?g=c[x]*u.data.stride+u.offset:g=c[x]*p;for(let _=0;_<p;_++)m[y++]=d[g++]}return new Oo(m,p,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new uG,n=this.index.array,s=this.attributes;for(const u in s){const c=s[u],d=e(c,n);i.setAttribute(u,d)}const o=this.morphAttributes;for(const u in o){const c=[],d=o[u];for(let p=0,f=d.length;p<f;p++){const m=d[p],g=e(m,n);c.push(g)}i.morphAttributes[u]=c}i.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,c=l.length;u<c;u++){const d=l[u];i.addGroup(d.start,d.count,d.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const d in c)c[d]!==void 0&&(e[d]=c[d]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const c in n){const d=n[c];e.data.attributes[c]=d.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const d=this.morphAttributes[c],p=[];for(let f=0,m=d.length;f<m;f++){const g=d[f];p.push(g.toJSON(e.data))}p.length>0&&(s[c]=p,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const s=e.attributes;for(const d in s){const p=s[d];this.setAttribute(d,p.clone(i))}const o=e.morphAttributes;for(const d in o){const p=[],f=o[d];for(let m=0,g=f.length;m<g;m++)p.push(f[m].clone(i));this.morphAttributes[d]=p}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let d=0,p=l.length;d<p;d++){const f=l[d];this.addGroup(f.start,f.count,f.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const MP=new ps,cp=new $x,nb=new Kx,RP=new at,sb=new at,ab=new at,ob=new at,ES=new at,lb=new at,IP=new at,cb=new at;let La=class extends Xa{constructor(r=new Po,e=new Hh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=e,this.updateMorphTargets()}copy(r,e){return super.copy(r,e),r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}updateMorphTargets(){const r=this.geometry.morphAttributes,e=Object.keys(r);if(e.length>0){const i=r[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(r,e){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(n,r);const l=this.morphTargetInfluences;if(s&&l){lb.set(0,0,0);for(let u=0,c=s.length;u<c;u++){const d=l[u],p=s[u];d!==0&&(ES.fromBufferAttribute(p,r),o?lb.addScaledVector(ES,d):lb.addScaledVector(ES.sub(e),d))}e.add(lb)}return e}raycast(r,e){const i=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),nb.copy(i.boundingSphere),nb.applyMatrix4(s),cp.copy(r.ray).recast(r.near),!(nb.containsPoint(cp.origin)===!1&&(cp.intersectSphere(nb,RP)===null||cp.origin.distanceToSquared(RP)>(r.far-r.near)**2))&&(MP.copy(s).invert(),cp.copy(r.ray).applyMatrix4(MP),!(i.boundingBox!==null&&cp.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(r,e,cp)))}_computeIntersections(r,e,i){let n;const s=this.geometry,o=this.material,l=s.index,u=s.attributes.position,c=s.attributes.uv,d=s.attributes.uv1,p=s.attributes.normal,f=s.groups,m=s.drawRange;if(l!==null)if(Array.isArray(o))for(let g=0,y=f.length;g<y;g++){const x=f[g],v=o[x.materialIndex],_=Math.max(x.start,m.start),T=Math.min(l.count,Math.min(x.start+x.count,m.start+m.count));for(let w=_,S=T;w<S;w+=3){const R=l.getX(w),B=l.getX(w+1),I=l.getX(w+2);n=ub(this,v,r,i,c,d,p,R,B,I),n&&(n.faceIndex=Math.floor(w/3),n.face.materialIndex=x.materialIndex,e.push(n))}}else{const g=Math.max(0,m.start),y=Math.min(l.count,m.start+m.count);for(let x=g,v=y;x<v;x+=3){const _=l.getX(x),T=l.getX(x+1),w=l.getX(x+2);n=ub(this,o,r,i,c,d,p,_,T,w),n&&(n.faceIndex=Math.floor(x/3),e.push(n))}}else if(u!==void 0)if(Array.isArray(o))for(let g=0,y=f.length;g<y;g++){const x=f[g],v=o[x.materialIndex],_=Math.max(x.start,m.start),T=Math.min(u.count,Math.min(x.start+x.count,m.start+m.count));for(let w=_,S=T;w<S;w+=3){const R=w,B=w+1,I=w+2;n=ub(this,v,r,i,c,d,p,R,B,I),n&&(n.faceIndex=Math.floor(w/3),n.face.materialIndex=x.materialIndex,e.push(n))}}else{const g=Math.max(0,m.start),y=Math.min(u.count,m.start+m.count);for(let x=g,v=y;x<v;x+=3){const _=x,T=x+1,w=x+2;n=ub(this,o,r,i,c,d,p,_,T,w),n&&(n.faceIndex=Math.floor(x/3),e.push(n))}}}};function MK(r,e,i,n,s,o,l,u){let c;if(e.side===ho?c=n.intersectTriangle(l,o,s,!0,u):c=n.intersectTriangle(s,o,l,e.side===Dh,u),c===null)return null;cb.copy(u),cb.applyMatrix4(r.matrixWorld);const d=i.ray.origin.distanceTo(cb);return d<i.near||d>i.far?null:{distance:d,point:cb.clone(),object:r}}function ub(r,e,i,n,s,o,l,u,c,d){r.getVertexPosition(u,sb),r.getVertexPosition(c,ab),r.getVertexPosition(d,ob);const p=MK(r,e,i,n,sb,ab,ob,IP);if(p){const f=new at;op.getBarycoord(IP,sb,ab,ob,f),s&&(p.uv=op.getInterpolatedAttribute(s,u,c,d,f,new zi)),o&&(p.uv1=op.getInterpolatedAttribute(o,u,c,d,f,new zi)),l&&(p.normal=op.getInterpolatedAttribute(l,u,c,d,f,new at),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const m={a:u,b:c,c:d,normal:new at,materialIndex:0};op.getNormal(sb,ab,ob,m.normal),p.face=m,p.barycoord=f}return p}let Em=class hG extends Po{constructor(e=1,i=1,n=1,s=1,o=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:s,heightSegments:o,depthSegments:l};const u=this;s=Math.floor(s),o=Math.floor(o),l=Math.floor(l);const c=[],d=[],p=[],f=[];let m=0,g=0;y("z","y","x",-1,-1,n,i,e,l,o,0),y("z","y","x",1,-1,n,i,-e,l,o,1),y("x","z","y",1,1,e,n,i,s,l,2),y("x","z","y",1,-1,e,n,-i,s,l,3),y("x","y","z",1,-1,e,i,n,s,o,4),y("x","y","z",-1,-1,e,i,-n,s,o,5),this.setIndex(c),this.setAttribute("position",new la(d,3)),this.setAttribute("normal",new la(p,3)),this.setAttribute("uv",new la(f,2));function y(x,v,_,T,w,S,R,B,I,D,L){const O=S/I,U=R/D,J=S/2,H=R/2,V=B/2,$=I+1,Q=D+1;let G=0,j=0;const ie=new at;for(let Y=0;Y<Q;Y++){const ae=Y*U-H;for(let xe=0;xe<$;xe++){const fe=xe*O-J;ie[x]=fe*T,ie[v]=ae*w,ie[_]=V,d.push(ie.x,ie.y,ie.z),ie[x]=0,ie[v]=0,ie[_]=B>0?1:-1,p.push(ie.x,ie.y,ie.z),f.push(xe/I),f.push(1-Y/D),G+=1}}for(let Y=0;Y<D;Y++)for(let ae=0;ae<I;ae++){const xe=m+ae+$*Y,fe=m+ae+$*(Y+1),de=m+(ae+1)+$*(Y+1),Ie=m+(ae+1)+$*Y;c.push(xe,fe,Ie),c.push(fe,de,Ie),j+=6}u.addGroup(g,j,L),g+=j,m+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hG(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function wm(r){const e={};for(const i in r){e[i]={};for(const n in r[i]){const s=r[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function po(r){const e={};for(let i=0;i<r.length;i++){const n=wm(r[i]);for(const s in n)e[s]=n[s]}return e}function RK(r){const e=[];for(let i=0;i<r.length;i++)e.push(r[i].clone());return e}function BP(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Pn.workingColorSpace}const NP={clone:wm,merge:po};var IK=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,BK=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;let Lc=class extends lp{static get type(){return"ShaderMaterial"}constructor(r){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=IK,this.fragmentShader=BK,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,r!==void 0&&this.setValues(r)}copy(r){return super.copy(r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=wm(r.uniforms),this.uniformsGroups=RK(r.uniformsGroups),this.defines=Object.assign({},r.defines),this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.fog=r.fog,this.lights=r.lights,this.clipping=r.clipping,this.extensions=Object.assign({},r.extensions),this.glslVersion=r.glslVersion,this}toJSON(r){const e=super.toJSON(r);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const s=this.uniforms[n].value;s&&s.isTexture?e.uniforms[n]={type:"t",value:s.toJSON(r).uuid}:s&&s.isColor?e.uniforms[n]={type:"c",value:s.getHex()}:s&&s.isVector2?e.uniforms[n]={type:"v2",value:s.toArray()}:s&&s.isVector3?e.uniforms[n]={type:"v3",value:s.toArray()}:s&&s.isVector4?e.uniforms[n]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?e.uniforms[n]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?e.uniforms[n]={type:"m4",value:s.toArray()}:e.uniforms[n]={value:s}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}},LP=class extends Xa{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ps,this.projectionMatrix=new ps,this.projectionMatrixInverse=new ps,this.coordinateSystem=yu}copy(r,e){return super.copy(r,e),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this.coordinateSystem=r.coordinateSystem,this}getWorldDirection(r){return super.getWorldDirection(r).negate()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,e){super.updateWorldMatrix(r,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Wh=new at,DP=new zi,OP=new zi;let Ml=class extends LP{constructor(r=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const e=.5*this.getFilmHeight()/r;this.fov=rA*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(iA*.5*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return rA*2*Math.atan(Math.tan(iA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(r,e,i){Wh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Wh.x,Wh.y).multiplyScalar(-r/Wh.z),Wh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Wh.x,Wh.y).multiplyScalar(-r/Wh.z)}getViewSize(r,e){return this.getViewBounds(r,DP,OP),e.subVectors(OP,DP)}setViewOffset(r,e,i,n,s,o){this.aspect=r/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let e=r*Math.tan(iA*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const u=o.fullWidth,c=o.fullHeight;s+=o.offsetX*n/u,e-=o.offsetY*i/c,n*=o.width/u,i*=o.height/c}const l=this.filmOffset;l!==0&&(s+=r*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,r,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const Cm=-90,Sm=1;let NK=class extends Xa{constructor(r,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new Ml(Cm,Sm,r,e);n.layers=this.layers,this.add(n);const s=new Ml(Cm,Sm,r,e);s.layers=this.layers,this.add(s);const o=new Ml(Cm,Sm,r,e);o.layers=this.layers,this.add(o);const l=new Ml(Cm,Sm,r,e);l.layers=this.layers,this.add(l);const u=new Ml(Cm,Sm,r,e);u.layers=this.layers,this.add(u);const c=new Ml(Cm,Sm,r,e);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const r=this.coordinateSystem,e=this.children.concat(),[i,n,s,o,l,u]=e;for(const c of e)this.remove(c);if(r===yu)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(r===Qx)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+r);for(const c of e)this.add(c),c.updateMatrixWorld()}update(r,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==r.coordinateSystem&&(this.coordinateSystem=r.coordinateSystem,this.updateCoordinateSystem());const[s,o,l,u,c,d]=this.children,p=r.getRenderTarget(),f=r.getActiveCubeFace(),m=r.getActiveMipmapLevel(),g=r.xr.enabled;r.xr.enabled=!1;const y=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,r.setRenderTarget(i,0,n),r.render(e,s),r.setRenderTarget(i,1,n),r.render(e,o),r.setRenderTarget(i,2,n),r.render(e,l),r.setRenderTarget(i,3,n),r.render(e,u),r.setRenderTarget(i,4,n),r.render(e,c),i.texture.generateMipmaps=y,r.setRenderTarget(i,5,n),r.render(e,d),r.setRenderTarget(p,f,m),r.xr.enabled=g,i.texture.needsPMREMUpdate=!0}},PP=class extends Sl{constructor(r,e,i,n,s,o,l,u,c,d){r=r!==void 0?r:[],e=e!==void 0?e:nm,super(r,e,i,n,s,o,l,u,c,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(r){this.image=r}},LK=class extends Fh{constructor(r=1,e={}){super(r,r,e),this.isWebGLCubeRenderTarget=!0;const i={width:r,height:r,depth:1},n=[i,i,i,i,i,i];this.texture=new PP(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:Bc}fromEquirectangularTexture(r,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Em(5,5,5),s=new Lc({name:"CubemapFromEquirect",uniforms:wm(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:ho,blending:mu});s.uniforms.tEquirect.value=e;const o=new La(n,s),l=e.minFilter;return e.minFilter===tp&&(e.minFilter=Bc),new NK(1,10,this).update(r,o),e.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(r,e,i,n){const s=r.getRenderTarget();for(let o=0;o<6;o++)r.setRenderTarget(this,o),r.clear(e,i,n);r.setRenderTarget(s)}};const wS=new at,DK=new at,OK=new pn;let ic=class{constructor(r=new at(1,0,0),e=0){this.isPlane=!0,this.normal=r,this.constant=e}set(r,e){return this.normal.copy(r),this.constant=e,this}setComponents(r,e,i,n){return this.normal.set(r,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(r,e){return this.normal.copy(r),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(r,e,i){const n=wS.subVectors(i,e).cross(DK.subVectors(r,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,e){return e.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,e){const i=r.delta(wS),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(r.start)===0?e.copy(r.start):null;const s=-(r.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(r.start).addScaledVector(i,s)}intersectsLine(r){const e=this.distanceToPoint(r.start),i=this.distanceToPoint(r.end);return e<0&&i>0||i<0&&e>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,e){const i=e||OK.getNormalMatrix(r),n=this.coplanarPoint(wS).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}};const up=new Kx,hb=new at;let CS=class{constructor(r=new ic,e=new ic,i=new ic,n=new ic,s=new ic,o=new ic){this.planes=[r,e,i,n,s,o]}set(r,e,i,n,s,o){const l=this.planes;return l[0].copy(r),l[1].copy(e),l[2].copy(i),l[3].copy(n),l[4].copy(s),l[5].copy(o),this}copy(r){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(r.planes[i]);return this}setFromProjectionMatrix(r,e=yu){const i=this.planes,n=r.elements,s=n[0],o=n[1],l=n[2],u=n[3],c=n[4],d=n[5],p=n[6],f=n[7],m=n[8],g=n[9],y=n[10],x=n[11],v=n[12],_=n[13],T=n[14],w=n[15];if(i[0].setComponents(u-s,f-c,x-m,w-v).normalize(),i[1].setComponents(u+s,f+c,x+m,w+v).normalize(),i[2].setComponents(u+o,f+d,x+g,w+_).normalize(),i[3].setComponents(u-o,f-d,x-g,w-_).normalize(),i[4].setComponents(u-l,f-p,x-y,w-T).normalize(),e===yu)i[5].setComponents(u+l,f+p,x+y,w+T).normalize();else if(e===Qx)i[5].setComponents(l,p,y,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),up.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const e=r.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),up.copy(e.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(up)}intersectsSprite(r){return up.center.set(0,0,0),up.radius=.7071067811865476,up.applyMatrix4(r.matrixWorld),this.intersectsSphere(up)}intersectsSphere(r){const e=this.planes,i=r.center,n=-r.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(r){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(hb.x=n.normal.x>0?r.max.x:r.min.x,hb.y=n.normal.y>0?r.max.y:r.min.y,hb.z=n.normal.z>0?r.max.z:r.min.z,n.distanceToPoint(hb)<0)return!1}return!0}containsPoint(r){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function FP(){let r=null,e=!1,i=null,n=null;function s(o,l){i(o,l),n=r.requestAnimationFrame(s)}return{start:function(){e!==!0&&i!==null&&(n=r.requestAnimationFrame(s),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(o){i=o},setContext:function(o){r=o}}}function PK(r){const e=new WeakMap;function i(u,c){const d=u.array,p=u.usage,f=d.byteLength,m=r.createBuffer();r.bindBuffer(c,m),r.bufferData(c,d,p),u.onUploadCallback();let g;if(d instanceof Float32Array)g=r.FLOAT;else if(d instanceof Uint16Array)u.isFloat16BufferAttribute?g=r.HALF_FLOAT:g=r.UNSIGNED_SHORT;else if(d instanceof Int16Array)g=r.SHORT;else if(d instanceof Uint32Array)g=r.UNSIGNED_INT;else if(d instanceof Int32Array)g=r.INT;else if(d instanceof Int8Array)g=r.BYTE;else if(d instanceof Uint8Array)g=r.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)g=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:m,type:g,bytesPerElement:d.BYTES_PER_ELEMENT,version:u.version,size:f}}function n(u,c,d){const p=c.array,f=c.updateRanges;if(r.bindBuffer(d,u),f.length===0)r.bufferSubData(d,0,p);else{f.sort((g,y)=>g.start-y.start);let m=0;for(let g=1;g<f.length;g++){const y=f[m],x=f[g];x.start<=y.start+y.count+1?y.count=Math.max(y.count,x.start+x.count-y.start):(++m,f[m]=x)}f.length=m+1;for(let g=0,y=f.length;g<y;g++){const x=f[g];r.bufferSubData(d,x.start*p.BYTES_PER_ELEMENT,p,x.start,x.count)}c.clearUpdateRanges()}c.onUploadCallback()}function s(u){return u.isInterleavedBufferAttribute&&(u=u.data),e.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);const c=e.get(u);c&&(r.deleteBuffer(c.buffer),e.delete(u))}function l(u,c){if(u.isInterleavedBufferAttribute&&(u=u.data),u.isGLBufferAttribute){const p=e.get(u);(!p||p.version<u.version)&&e.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}const d=e.get(u);if(d===void 0)e.set(u,i(u,c));else if(d.version<u.version){if(d.size!==u.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(d.buffer,u,c),d.version=u.version}}return{get:s,remove:o,update:l}}class db extends Po{constructor(e=1,i=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:n,heightSegments:s};const o=e/2,l=i/2,u=Math.floor(n),c=Math.floor(s),d=u+1,p=c+1,f=e/u,m=i/c,g=[],y=[],x=[],v=[];for(let _=0;_<p;_++){const T=_*m-l;for(let w=0;w<d;w++){const S=w*f-o;y.push(S,-T,0),x.push(0,0,1),v.push(w/u),v.push(1-_/c)}}for(let _=0;_<c;_++)for(let T=0;T<u;T++){const w=T+d*_,S=T+d*(_+1),R=T+1+d*(_+1),B=T+1+d*_;g.push(w,S,B),g.push(S,R,B)}this.setIndex(g),this.setAttribute("position",new la(y,3)),this.setAttribute("normal",new la(x,3)),this.setAttribute("uv",new la(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new db(e.width,e.height,e.widthSegments,e.heightSegments)}}var FK=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,kK=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,UK=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,zK=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,jK=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,VK=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,GK=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,HK=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,WK=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,QK=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,qK=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,XK=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,YK=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,KK=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,JK=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,ZK=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,$K=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,eJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,tJ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,iJ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,rJ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,nJ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,sJ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,aJ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,oJ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,lJ=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,cJ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,uJ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,hJ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,dJ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,pJ="gl_FragColor = linearToOutputTexel( gl_FragColor );",fJ=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,mJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,gJ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,AJ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,yJ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,vJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,xJ=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,bJ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,_J=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,EJ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,wJ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,CJ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,SJ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,TJ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,MJ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,RJ=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,IJ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,BJ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,NJ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,LJ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,DJ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,OJ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,PJ=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,FJ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,kJ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,UJ=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,zJ=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,jJ=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,VJ=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,GJ=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,HJ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,WJ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,QJ=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,qJ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,XJ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,YJ=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,KJ=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,JJ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,ZJ=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,$J=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,eZ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,tZ=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,iZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,rZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,nZ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,sZ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,aZ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,oZ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,lZ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,cZ=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,uZ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,hZ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,dZ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,pZ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,fZ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,mZ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,gZ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,AZ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,yZ=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,vZ=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,xZ=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,bZ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,_Z=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,EZ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,wZ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,CZ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,SZ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,TZ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,MZ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,RZ=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,IZ=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,BZ=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,NZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,LZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,DZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,OZ=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const PZ=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,FZ=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,kZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,UZ=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,zZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,jZ=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,VZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,GZ=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,HZ=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,WZ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,QZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,qZ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,XZ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,YZ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,KZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,JZ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ZZ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$Z=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,e$=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,t$=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,i$=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,r$=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,n$=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,s$=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,a$=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,o$=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,l$=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,c$=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,u$=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,h$=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,d$=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,p$=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,f$=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,m$=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ln={alphahash_fragment:FK,alphahash_pars_fragment:kK,alphamap_fragment:UK,alphamap_pars_fragment:zK,alphatest_fragment:jK,alphatest_pars_fragment:VK,aomap_fragment:GK,aomap_pars_fragment:HK,batching_pars_vertex:WK,batching_vertex:QK,begin_vertex:qK,beginnormal_vertex:XK,bsdfs:YK,iridescence_fragment:KK,bumpmap_pars_fragment:JK,clipping_planes_fragment:ZK,clipping_planes_pars_fragment:$K,clipping_planes_pars_vertex:eJ,clipping_planes_vertex:tJ,color_fragment:iJ,color_pars_fragment:rJ,color_pars_vertex:nJ,color_vertex:sJ,common:aJ,cube_uv_reflection_fragment:oJ,defaultnormal_vertex:lJ,displacementmap_pars_vertex:cJ,displacementmap_vertex:uJ,emissivemap_fragment:hJ,emissivemap_pars_fragment:dJ,colorspace_fragment:pJ,colorspace_pars_fragment:fJ,envmap_fragment:mJ,envmap_common_pars_fragment:gJ,envmap_pars_fragment:AJ,envmap_pars_vertex:yJ,envmap_physical_pars_fragment:RJ,envmap_vertex:vJ,fog_vertex:xJ,fog_pars_vertex:bJ,fog_fragment:_J,fog_pars_fragment:EJ,gradientmap_pars_fragment:wJ,lightmap_pars_fragment:CJ,lights_lambert_fragment:SJ,lights_lambert_pars_fragment:TJ,lights_pars_begin:MJ,lights_toon_fragment:IJ,lights_toon_pars_fragment:BJ,lights_phong_fragment:NJ,lights_phong_pars_fragment:LJ,lights_physical_fragment:DJ,lights_physical_pars_fragment:OJ,lights_fragment_begin:PJ,lights_fragment_maps:FJ,lights_fragment_end:kJ,logdepthbuf_fragment:UJ,logdepthbuf_pars_fragment:zJ,logdepthbuf_pars_vertex:jJ,logdepthbuf_vertex:VJ,map_fragment:GJ,map_pars_fragment:HJ,map_particle_fragment:WJ,map_particle_pars_fragment:QJ,metalnessmap_fragment:qJ,metalnessmap_pars_fragment:XJ,morphinstance_vertex:YJ,morphcolor_vertex:KJ,morphnormal_vertex:JJ,morphtarget_pars_vertex:ZJ,morphtarget_vertex:$J,normal_fragment_begin:eZ,normal_fragment_maps:tZ,normal_pars_fragment:iZ,normal_pars_vertex:rZ,normal_vertex:nZ,normalmap_pars_fragment:sZ,clearcoat_normal_fragment_begin:aZ,clearcoat_normal_fragment_maps:oZ,clearcoat_pars_fragment:lZ,iridescence_pars_fragment:cZ,opaque_fragment:uZ,packing:hZ,premultiplied_alpha_fragment:dZ,project_vertex:pZ,dithering_fragment:fZ,dithering_pars_fragment:mZ,roughnessmap_fragment:gZ,roughnessmap_pars_fragment:AZ,shadowmap_pars_fragment:yZ,shadowmap_pars_vertex:vZ,shadowmap_vertex:xZ,shadowmask_pars_fragment:bZ,skinbase_vertex:_Z,skinning_pars_vertex:EZ,skinning_vertex:wZ,skinnormal_vertex:CZ,specularmap_fragment:SZ,specularmap_pars_fragment:TZ,tonemapping_fragment:MZ,tonemapping_pars_fragment:RZ,transmission_fragment:IZ,transmission_pars_fragment:BZ,uv_pars_fragment:NZ,uv_pars_vertex:LZ,uv_vertex:DZ,worldpos_vertex:OZ,background_vert:PZ,background_frag:FZ,backgroundCube_vert:kZ,backgroundCube_frag:UZ,cube_vert:zZ,cube_frag:jZ,depth_vert:VZ,depth_frag:GZ,distanceRGBA_vert:HZ,distanceRGBA_frag:WZ,equirect_vert:QZ,equirect_frag:qZ,linedashed_vert:XZ,linedashed_frag:YZ,meshbasic_vert:KZ,meshbasic_frag:JZ,meshlambert_vert:ZZ,meshlambert_frag:$Z,meshmatcap_vert:e$,meshmatcap_frag:t$,meshnormal_vert:i$,meshnormal_frag:r$,meshphong_vert:n$,meshphong_frag:s$,meshphysical_vert:a$,meshphysical_frag:o$,meshtoon_vert:l$,meshtoon_frag:c$,points_vert:u$,points_frag:h$,shadow_vert:d$,shadow_frag:p$,sprite_vert:f$,sprite_frag:m$},qi={common:{diffuse:{value:new wn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new pn},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new pn}},envmap:{envMap:{value:null},envMapRotation:{value:new pn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new pn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new pn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new pn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new pn},normalScale:{value:new zi(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new pn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new pn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new pn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new pn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new wn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new wn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0},uvTransform:{value:new pn}},sprite:{diffuse:{value:new wn(16777215)},opacity:{value:1},center:{value:new zi(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new pn},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0}}},Dc={basic:{uniforms:po([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.fog]),vertexShader:ln.meshbasic_vert,fragmentShader:ln.meshbasic_frag},lambert:{uniforms:po([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,qi.lights,{emissive:{value:new wn(0)}}]),vertexShader:ln.meshlambert_vert,fragmentShader:ln.meshlambert_frag},phong:{uniforms:po([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,qi.lights,{emissive:{value:new wn(0)},specular:{value:new wn(1118481)},shininess:{value:30}}]),vertexShader:ln.meshphong_vert,fragmentShader:ln.meshphong_frag},standard:{uniforms:po([qi.common,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.roughnessmap,qi.metalnessmap,qi.fog,qi.lights,{emissive:{value:new wn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ln.meshphysical_vert,fragmentShader:ln.meshphysical_frag},toon:{uniforms:po([qi.common,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.gradientmap,qi.fog,qi.lights,{emissive:{value:new wn(0)}}]),vertexShader:ln.meshtoon_vert,fragmentShader:ln.meshtoon_frag},matcap:{uniforms:po([qi.common,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,{matcap:{value:null}}]),vertexShader:ln.meshmatcap_vert,fragmentShader:ln.meshmatcap_frag},points:{uniforms:po([qi.points,qi.fog]),vertexShader:ln.points_vert,fragmentShader:ln.points_frag},dashed:{uniforms:po([qi.common,qi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ln.linedashed_vert,fragmentShader:ln.linedashed_frag},depth:{uniforms:po([qi.common,qi.displacementmap]),vertexShader:ln.depth_vert,fragmentShader:ln.depth_frag},normal:{uniforms:po([qi.common,qi.bumpmap,qi.normalmap,qi.displacementmap,{opacity:{value:1}}]),vertexShader:ln.meshnormal_vert,fragmentShader:ln.meshnormal_frag},sprite:{uniforms:po([qi.sprite,qi.fog]),vertexShader:ln.sprite_vert,fragmentShader:ln.sprite_frag},background:{uniforms:{uvTransform:{value:new pn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ln.background_vert,fragmentShader:ln.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new pn}},vertexShader:ln.backgroundCube_vert,fragmentShader:ln.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ln.cube_vert,fragmentShader:ln.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ln.equirect_vert,fragmentShader:ln.equirect_frag},distanceRGBA:{uniforms:po([qi.common,qi.displacementmap,{referencePosition:{value:new at},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ln.distanceRGBA_vert,fragmentShader:ln.distanceRGBA_frag},shadow:{uniforms:po([qi.lights,qi.fog,{color:{value:new wn(0)},opacity:{value:1}}]),vertexShader:ln.shadow_vert,fragmentShader:ln.shadow_frag}};Dc.physical={uniforms:po([Dc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new pn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new pn},clearcoatNormalScale:{value:new zi(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new pn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new pn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new pn},sheen:{value:0},sheenColor:{value:new wn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new pn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new pn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new pn},transmissionSamplerSize:{value:new zi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new pn},attenuationDistance:{value:0},attenuationColor:{value:new wn(0)},specularColor:{value:new wn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new pn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new pn},anisotropyVector:{value:new zi},anisotropyMap:{value:null},anisotropyMapTransform:{value:new pn}}]),vertexShader:ln.meshphysical_vert,fragmentShader:ln.meshphysical_frag};const pb={r:0,b:0,g:0},hp=new Vh,g$=new ps;function A$(r,e,i,n,s,o,l){const u=new wn(0);let c=o===!0?0:1,d,p,f=null,m=0,g=null;function y(T){let w=T.isScene===!0?T.background:null;return w&&w.isTexture&&(w=(T.backgroundBlurriness>0?i:e).get(w)),w}function x(T){let w=!1;const S=y(T);S===null?_(u,c):S&&S.isColor&&(_(S,1),w=!0);const R=r.xr.getEnvironmentBlendMode();R==="additive"?n.buffers.color.setClear(0,0,0,1,l):R==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,l),(r.autoClear||w)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function v(T,w){const S=y(w);S&&(S.isCubeTexture||S.mapping===kx)?(p===void 0&&(p=new La(new Em(1,1,1),new Lc({name:"BackgroundCubeMaterial",uniforms:wm(Dc.backgroundCube.uniforms),vertexShader:Dc.backgroundCube.vertexShader,fragmentShader:Dc.backgroundCube.fragmentShader,side:ho,depthTest:!1,depthWrite:!1,fog:!1})),p.geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(R,B,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(p)),hp.copy(w.backgroundRotation),hp.x*=-1,hp.y*=-1,hp.z*=-1,S.isCubeTexture&&S.isRenderTargetTexture===!1&&(hp.y*=-1,hp.z*=-1),p.material.uniforms.envMap.value=S,p.material.uniforms.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,p.material.uniforms.backgroundBlurriness.value=w.backgroundBlurriness,p.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,p.material.uniforms.backgroundRotation.value.setFromMatrix4(g$.makeRotationFromEuler(hp)),p.material.toneMapped=Pn.getTransfer(S.colorSpace)!==ss,(f!==S||m!==S.version||g!==r.toneMapping)&&(p.material.needsUpdate=!0,f=S,m=S.version,g=r.toneMapping),p.layers.enableAll(),T.unshift(p,p.geometry,p.material,0,0,null)):S&&S.isTexture&&(d===void 0&&(d=new La(new db(2,2),new Lc({name:"BackgroundMaterial",uniforms:wm(Dc.background.uniforms),vertexShader:Dc.background.vertexShader,fragmentShader:Dc.background.fragmentShader,side:Dh,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(d)),d.material.uniforms.t2D.value=S,d.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,d.material.toneMapped=Pn.getTransfer(S.colorSpace)!==ss,S.matrixAutoUpdate===!0&&S.updateMatrix(),d.material.uniforms.uvTransform.value.copy(S.matrix),(f!==S||m!==S.version||g!==r.toneMapping)&&(d.material.needsUpdate=!0,f=S,m=S.version,g=r.toneMapping),d.layers.enableAll(),T.unshift(d,d.geometry,d.material,0,0,null))}function _(T,w){T.getRGB(pb,BP(r)),n.buffers.color.setClear(pb.r,pb.g,pb.b,w,l)}return{getClearColor:function(){return u},setClearColor:function(T,w=1){u.set(T),c=w,_(u,c)},getClearAlpha:function(){return c},setClearAlpha:function(T){c=T,_(u,c)},render:x,addToRenderList:v}}function y$(r,e){const i=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},s=m(null);let o=s,l=!1;function u(O,U,J,H,V){let $=!1;const Q=f(H,J,U);o!==Q&&(o=Q,d(o.object)),$=g(O,H,J,V),$&&y(O,H,J,V),V!==null&&e.update(V,r.ELEMENT_ARRAY_BUFFER),($||l)&&(l=!1,S(O,U,J,H),V!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get(V).buffer))}function c(){return r.createVertexArray()}function d(O){return r.bindVertexArray(O)}function p(O){return r.deleteVertexArray(O)}function f(O,U,J){const H=J.wireframe===!0;let V=n[O.id];V===void 0&&(V={},n[O.id]=V);let $=V[U.id];$===void 0&&($={},V[U.id]=$);let Q=$[H];return Q===void 0&&(Q=m(c()),$[H]=Q),Q}function m(O){const U=[],J=[],H=[];for(let V=0;V<i;V++)U[V]=0,J[V]=0,H[V]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:J,attributeDivisors:H,object:O,attributes:{},index:null}}function g(O,U,J,H){const V=o.attributes,$=U.attributes;let Q=0;const G=J.getAttributes();for(const j in G)if(G[j].location>=0){const ie=V[j];let Y=$[j];if(Y===void 0&&(j==="instanceMatrix"&&O.instanceMatrix&&(Y=O.instanceMatrix),j==="instanceColor"&&O.instanceColor&&(Y=O.instanceColor)),ie===void 0||ie.attribute!==Y||Y&&ie.data!==Y.data)return!0;Q++}return o.attributesNum!==Q||o.index!==H}function y(O,U,J,H){const V={},$=U.attributes;let Q=0;const G=J.getAttributes();for(const j in G)if(G[j].location>=0){let ie=$[j];ie===void 0&&(j==="instanceMatrix"&&O.instanceMatrix&&(ie=O.instanceMatrix),j==="instanceColor"&&O.instanceColor&&(ie=O.instanceColor));const Y={};Y.attribute=ie,ie&&ie.data&&(Y.data=ie.data),V[j]=Y,Q++}o.attributes=V,o.attributesNum=Q,o.index=H}function x(){const O=o.newAttributes;for(let U=0,J=O.length;U<J;U++)O[U]=0}function v(O){_(O,0)}function _(O,U){const J=o.newAttributes,H=o.enabledAttributes,V=o.attributeDivisors;J[O]=1,H[O]===0&&(r.enableVertexAttribArray(O),H[O]=1),V[O]!==U&&(r.vertexAttribDivisor(O,U),V[O]=U)}function T(){const O=o.newAttributes,U=o.enabledAttributes;for(let J=0,H=U.length;J<H;J++)U[J]!==O[J]&&(r.disableVertexAttribArray(J),U[J]=0)}function w(O,U,J,H,V,$,Q){Q===!0?r.vertexAttribIPointer(O,U,J,V,$):r.vertexAttribPointer(O,U,J,H,V,$)}function S(O,U,J,H){x();const V=H.attributes,$=J.getAttributes(),Q=U.defaultAttributeValues;for(const G in $){const j=$[G];if(j.location>=0){let ie=V[G];if(ie===void 0&&(G==="instanceMatrix"&&O.instanceMatrix&&(ie=O.instanceMatrix),G==="instanceColor"&&O.instanceColor&&(ie=O.instanceColor)),ie!==void 0){const Y=ie.normalized,ae=ie.itemSize,xe=e.get(ie);if(xe===void 0)continue;const fe=xe.buffer,de=xe.type,Ie=xe.bytesPerElement,Ge=de===r.INT||de===r.UNSIGNED_INT||ie.gpuType===EC;if(ie.isInterleavedBufferAttribute){const Xe=ie.data,$e=Xe.stride,lt=ie.offset;if(Xe.isInstancedInterleavedBuffer){for(let At=0;At<j.locationSize;At++)_(j.location+At,Xe.meshPerAttribute);O.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=Xe.meshPerAttribute*Xe.count)}else for(let At=0;At<j.locationSize;At++)v(j.location+At);r.bindBuffer(r.ARRAY_BUFFER,fe);for(let At=0;At<j.locationSize;At++)w(j.location+At,ae/j.locationSize,de,Y,$e*Ie,(lt+ae/j.locationSize*At)*Ie,Ge)}else{if(ie.isInstancedBufferAttribute){for(let Xe=0;Xe<j.locationSize;Xe++)_(j.location+Xe,ie.meshPerAttribute);O.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=ie.meshPerAttribute*ie.count)}else for(let Xe=0;Xe<j.locationSize;Xe++)v(j.location+Xe);r.bindBuffer(r.ARRAY_BUFFER,fe);for(let Xe=0;Xe<j.locationSize;Xe++)w(j.location+Xe,ae/j.locationSize,de,Y,ae*Ie,ae/j.locationSize*Xe*Ie,Ge)}}else if(Q!==void 0){const Y=Q[G];if(Y!==void 0)switch(Y.length){case 2:r.vertexAttrib2fv(j.location,Y);break;case 3:r.vertexAttrib3fv(j.location,Y);break;case 4:r.vertexAttrib4fv(j.location,Y);break;default:r.vertexAttrib1fv(j.location,Y)}}}}T()}function R(){D();for(const O in n){const U=n[O];for(const J in U){const H=U[J];for(const V in H)p(H[V].object),delete H[V];delete U[J]}delete n[O]}}function B(O){if(n[O.id]===void 0)return;const U=n[O.id];for(const J in U){const H=U[J];for(const V in H)p(H[V].object),delete H[V];delete U[J]}delete n[O.id]}function I(O){for(const U in n){const J=n[U];if(J[O.id]===void 0)continue;const H=J[O.id];for(const V in H)p(H[V].object),delete H[V];delete J[O.id]}}function D(){L(),l=!0,o!==s&&(o=s,d(o.object))}function L(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:u,reset:D,resetDefaultState:L,dispose:R,releaseStatesOfGeometry:B,releaseStatesOfProgram:I,initAttributes:x,enableAttribute:v,disableUnusedAttributes:T}}function v$(r,e,i){let n;function s(d){n=d}function o(d,p){r.drawArrays(n,d,p),i.update(p,n,1)}function l(d,p,f){f!==0&&(r.drawArraysInstanced(n,d,p,f),i.update(p,n,f))}function u(d,p,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,d,0,p,0,f);let m=0;for(let g=0;g<f;g++)m+=p[g];i.update(m,n,1)}function c(d,p,f,m){if(f===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let y=0;y<d.length;y++)l(d[y],p[y],m[y]);else{g.multiDrawArraysInstancedWEBGL(n,d,0,p,0,m,0,f);let y=0;for(let x=0;x<f;x++)y+=p[x]*m[x];i.update(y,n,1)}}this.setMode=s,this.render=o,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=c}function x$(r,e,i,n){let s;function o(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const I=e.get("EXT_texture_filter_anisotropic");s=r.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function l(I){return!(I!==Jl&&n.convert(I)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function u(I){const D=I===am&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(I!==gu&&n.convert(I)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&I!==Au&&!D)}function c(I){if(I==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";I="mediump"}return I==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let d=i.precision!==void 0?i.precision:"highp";const p=c(d);p!==d&&(console.warn("THREE.WebGLRenderer:",d,"not supported, using",p,"instead."),d=p);const f=i.logarithmicDepthBuffer===!0,m=i.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),g=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),y=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x=r.getParameter(r.MAX_TEXTURE_SIZE),v=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),_=r.getParameter(r.MAX_VERTEX_ATTRIBS),T=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),w=r.getParameter(r.MAX_VARYING_VECTORS),S=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),R=y>0,B=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:c,textureFormatReadable:l,textureTypeReadable:u,precision:d,logarithmicDepthBuffer:f,reverseDepthBuffer:m,maxTextures:g,maxVertexTextures:y,maxTextureSize:x,maxCubemapSize:v,maxAttributes:_,maxVertexUniforms:T,maxVaryings:w,maxFragmentUniforms:S,vertexTextures:R,maxSamples:B}}function b$(r){const e=this;let i=null,n=0,s=!1,o=!1;const l=new ic,u=new pn,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(f,m){const g=f.length!==0||m||n!==0||s;return s=m,n=f.length,g},this.beginShadows=function(){o=!0,p(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(f,m){i=p(f,m,0)},this.setState=function(f,m,g){const y=f.clippingPlanes,x=f.clipIntersection,v=f.clipShadows,_=r.get(f);if(!s||y===null||y.length===0||o&&!v)o?p(null):d();else{const T=o?0:n,w=T*4;let S=_.clippingState||null;c.value=S,S=p(y,m,w,g);for(let R=0;R!==w;++R)S[R]=i[R];_.clippingState=S,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=T}};function d(){c.value!==i&&(c.value=i,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function p(f,m,g,y){const x=f!==null?f.length:0;let v=null;if(x!==0){if(v=c.value,y!==!0||v===null){const _=g+x*4,T=m.matrixWorldInverse;u.getNormalMatrix(T),(v===null||v.length<_)&&(v=new Float32Array(_));for(let w=0,S=g;w!==x;++w,S+=4)l.copy(f[w]).applyMatrix4(T,u),l.normal.toArray(v,S),v[S+3]=l.constant}c.value=v,c.needsUpdate=!0}return e.numPlanes=x,e.numIntersection=0,v}}function _$(r){let e=new WeakMap;function i(l,u){return u===yC?l.mapping=nm:u===vC&&(l.mapping=sm),l}function n(l){if(l&&l.isTexture){const u=l.mapping;if(u===yC||u===vC)if(e.has(l)){const c=e.get(l).texture;return i(c,l.mapping)}else{const c=l.image;if(c&&c.height>0){const d=new LK(c.height);return d.fromEquirectangularTexture(r,l),e.set(l,d),l.addEventListener("dispose",s),i(d.texture,l.mapping)}else return null}}return l}function s(l){const u=l.target;u.removeEventListener("dispose",s);const c=e.get(u);c!==void 0&&(e.delete(u),c.dispose())}function o(){e=new WeakMap}return{get:n,dispose:o}}let SS=class extends LP{constructor(r=-1,e=1,i=1,n=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,e,i,n,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-r,o=i+r,l=n+e,u=n-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,l-=d*this.view.offsetY,u=l-d*this.view.height}this.projectionMatrix.makeOrthographic(s,o,l,u,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}};const Tm=4,kP=[.125,.215,.35,.446,.526,.582],dp=20,TS=new SS,UP=new wn;let MS=null,RS=0,IS=0,BS=!1;const pp=(1+Math.sqrt(5))/2,Mm=1/pp,zP=[new at(-pp,Mm,0),new at(pp,Mm,0),new at(-Mm,0,pp),new at(Mm,0,pp),new at(0,pp,-Mm),new at(0,pp,Mm),new at(-1,1,-1),new at(1,1,-1),new at(-1,1,1),new at(1,1,1)];let jP=class{constructor(r){this._renderer=r,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(r,e=0,i=.1,n=100){MS=this._renderer.getRenderTarget(),RS=this._renderer.getActiveCubeFace(),IS=this._renderer.getActiveMipmapLevel(),BS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(r,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(r,e=null){return this._fromTexture(r,e)}fromCubemap(r,e=null){return this._fromTexture(r,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=HP(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=GP(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(r){this._lodMax=Math.floor(Math.log2(r)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let r=0;r<this._lodPlanes.length;r++)this._lodPlanes[r].dispose()}_cleanup(r){this._renderer.setRenderTarget(MS,RS,IS),this._renderer.xr.enabled=BS,r.scissorTest=!1,fb(r,0,0,r.width,r.height)}_fromTexture(r,e){r.mapping===nm||r.mapping===sm?this._setSize(r.image.length===0?16:r.image[0].width||r.image[0].image.width):this._setSize(r.image.width/4),MS=this._renderer.getRenderTarget(),RS=this._renderer.getActiveCubeFace(),IS=this._renderer.getActiveMipmapLevel(),BS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=e||this._allocateTargets();return this._textureToCubeUV(r,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const r=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:Bc,minFilter:Bc,generateMipmaps:!1,type:am,format:Jl,colorSpace:um,depthBuffer:!1},n=VP(r,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==r||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=VP(r,e,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=E$(s)),this._blurMaterial=w$(s,r,e)}return n}_compileMaterial(r){const e=new La(this._lodPlanes[0],r);this._renderer.compile(e,TS)}_sceneToCubeUV(r,e,i,n){const s=new Ml(90,1,e,i),o=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,c=u.autoClear,d=u.toneMapping;u.getClearColor(UP),u.toneMapping=Oh,u.autoClear=!1;const p=new Hh({name:"PMREM.Background",side:ho,depthWrite:!1,depthTest:!1}),f=new La(new Em,p);let m=!1;const g=r.background;g?g.isColor&&(p.color.copy(g),r.background=null,m=!0):(p.color.copy(UP),m=!0);for(let y=0;y<6;y++){const x=y%3;x===0?(s.up.set(0,o[y],0),s.lookAt(l[y],0,0)):x===1?(s.up.set(0,0,o[y]),s.lookAt(0,l[y],0)):(s.up.set(0,o[y],0),s.lookAt(0,0,l[y]));const v=this._cubeSize;fb(n,x*v,y>2?v:0,v,v),u.setRenderTarget(n),m&&u.render(f,s),u.render(r,s)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=d,u.autoClear=c,r.background=g}_textureToCubeUV(r,e){const i=this._renderer,n=r.mapping===nm||r.mapping===sm;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=HP()),this._cubemapMaterial.uniforms.flipEnvMap.value=r.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=GP());const s=n?this._cubemapMaterial:this._equirectMaterial,o=new La(this._lodPlanes[0],s),l=s.uniforms;l.envMap.value=r;const u=this._cubeSize;fb(e,0,0,3*u,2*u),i.setRenderTarget(e),i.render(o,TS)}_applyPMREM(r){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const n=this._lodPlanes.length;for(let s=1;s<n;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),l=zP[(n-s-1)%zP.length];this._blur(r,s-1,s,o,l)}e.autoClear=i}_blur(r,e,i,n,s){const o=this._pingPongRenderTarget;this._halfBlur(r,o,e,i,n,"latitudinal",s),this._halfBlur(o,r,i,i,n,"longitudinal",s)}_halfBlur(r,e,i,n,s,o,l){const u=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,p=new La(this._lodPlanes[n],c),f=c.uniforms,m=this._sizeLods[i]-1,g=isFinite(s)?Math.PI/(2*m):2*Math.PI/(2*dp-1),y=s/g,x=isFinite(s)?1+Math.floor(d*y):dp;x>dp&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${x} samples when the maximum is set to ${dp}`);const v=[];let _=0;for(let B=0;B<dp;++B){const I=B/y,D=Math.exp(-I*I/2);v.push(D),B===0?_+=D:B<x&&(_+=2*D)}for(let B=0;B<v.length;B++)v[B]=v[B]/_;f.envMap.value=r.texture,f.samples.value=x,f.weights.value=v,f.latitudinal.value=o==="latitudinal",l&&(f.poleAxis.value=l);const{_lodMax:T}=this;f.dTheta.value=g,f.mipInt.value=T-i;const w=this._sizeLods[n],S=3*w*(n>T-Tm?n-T+Tm:0),R=4*(this._cubeSize-w);fb(e,S,R,3*w,2*w),u.setRenderTarget(e),u.render(p,TS)}};function E$(r){const e=[],i=[],n=[];let s=r;const o=r-Tm+1+kP.length;for(let l=0;l<o;l++){const u=Math.pow(2,s);i.push(u);let c=1/u;l>r-Tm?c=kP[l-r+Tm-1]:l===0&&(c=0),n.push(c);const d=1/(u-2),p=-d,f=1+d,m=[p,p,f,p,f,f,p,p,f,f,p,f],g=6,y=6,x=3,v=2,_=1,T=new Float32Array(x*y*g),w=new Float32Array(v*y*g),S=new Float32Array(_*y*g);for(let B=0;B<g;B++){const I=B%3*2/3-1,D=B>2?0:-1,L=[I,D,0,I+2/3,D,0,I+2/3,D+1,0,I,D,0,I+2/3,D+1,0,I,D+1,0];T.set(L,x*y*B),w.set(m,v*y*B);const O=[B,B,B,B,B,B];S.set(O,_*y*B)}const R=new Po;R.setAttribute("position",new Oo(T,x)),R.setAttribute("uv",new Oo(w,v)),R.setAttribute("faceIndex",new Oo(S,_)),e.push(R),s>Tm&&s--}return{lodPlanes:e,sizeLods:i,sigmas:n}}function VP(r,e,i){const n=new Fh(r,e,i);return n.texture.mapping=kx,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function fb(r,e,i,n,s){r.viewport.set(e,i,n,s),r.scissor.set(e,i,n,s)}function w$(r,e,i){const n=new Float32Array(dp),s=new at(0,1,0);return new Lc({name:"SphericalGaussianBlur",defines:{n:dp,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:NS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:mu,depthTest:!1,depthWrite:!1})}function GP(){return new Lc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:NS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:mu,depthTest:!1,depthWrite:!1})}function HP(){return new Lc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:NS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:mu,depthTest:!1,depthWrite:!1})}function NS(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function C$(r){let e=new WeakMap,i=null;function n(u){if(u&&u.isTexture){const c=u.mapping,d=c===yC||c===vC,p=c===nm||c===sm;if(d||p){let f=e.get(u);const m=f!==void 0?f.texture.pmremVersion:0;if(u.isRenderTargetTexture&&u.pmremVersion!==m)return i===null&&(i=new jP(r)),f=d?i.fromEquirectangular(u,f):i.fromCubemap(u,f),f.texture.pmremVersion=u.pmremVersion,e.set(u,f),f.texture;if(f!==void 0)return f.texture;{const g=u.image;return d&&g&&g.height>0||p&&g&&s(g)?(i===null&&(i=new jP(r)),f=d?i.fromEquirectangular(u):i.fromCubemap(u),f.texture.pmremVersion=u.pmremVersion,e.set(u,f),u.addEventListener("dispose",o),f.texture):null}}}return u}function s(u){let c=0;const d=6;for(let p=0;p<d;p++)u[p]!==void 0&&c++;return c===d}function o(u){const c=u.target;c.removeEventListener("dispose",o);const d=e.get(c);d!==void 0&&(e.delete(c),d.dispose())}function l(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:n,dispose:l}}function S$(r){const e={};function i(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=r.getExtension(n)}return e[n]=s,s}return{has:function(n){return i(n)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(n){const s=i(n);return s===null&&aA("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function T$(r,e,i,n){const s={},o=new WeakMap;function l(f){const m=f.target;m.index!==null&&e.remove(m.index);for(const y in m.attributes)e.remove(m.attributes[y]);for(const y in m.morphAttributes){const x=m.morphAttributes[y];for(let v=0,_=x.length;v<_;v++)e.remove(x[v])}m.removeEventListener("dispose",l),delete s[m.id];const g=o.get(m);g&&(e.remove(g),o.delete(m)),n.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,i.memory.geometries--}function u(f,m){return s[m.id]===!0||(m.addEventListener("dispose",l),s[m.id]=!0,i.memory.geometries++),m}function c(f){const m=f.attributes;for(const y in m)e.update(m[y],r.ARRAY_BUFFER);const g=f.morphAttributes;for(const y in g){const x=g[y];for(let v=0,_=x.length;v<_;v++)e.update(x[v],r.ARRAY_BUFFER)}}function d(f){const m=[],g=f.index,y=f.attributes.position;let x=0;if(g!==null){const T=g.array;x=g.version;for(let w=0,S=T.length;w<S;w+=3){const R=T[w+0],B=T[w+1],I=T[w+2];m.push(R,B,B,I,I,R)}}else if(y!==void 0){const T=y.array;x=y.version;for(let w=0,S=T.length/3-1;w<S;w+=3){const R=w+0,B=w+1,I=w+2;m.push(R,B,B,I,I,R)}}else return;const v=new(oP(m)?TP:SP)(m,1);v.version=x;const _=o.get(f);_&&e.remove(_),o.set(f,v)}function p(f){const m=o.get(f);if(m){const g=f.index;g!==null&&m.version<g.version&&d(f)}else d(f);return o.get(f)}return{get:u,update:c,getWireframeAttribute:p}}function M$(r,e,i){let n;function s(m){n=m}let o,l;function u(m){o=m.type,l=m.bytesPerElement}function c(m,g){r.drawElements(n,g,o,m*l),i.update(g,n,1)}function d(m,g,y){y!==0&&(r.drawElementsInstanced(n,g,o,m*l,y),i.update(g,n,y))}function p(m,g,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,g,0,o,m,0,y);let x=0;for(let v=0;v<y;v++)x+=g[v];i.update(x,n,1)}function f(m,g,y,x){if(y===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let _=0;_<m.length;_++)d(m[_]/l,g[_],x[_]);else{v.multiDrawElementsInstancedWEBGL(n,g,0,o,m,0,x,0,y);let _=0;for(let T=0;T<y;T++)_+=g[T]*x[T];i.update(_,n,1)}}this.setMode=s,this.setIndex=u,this.render=c,this.renderInstances=d,this.renderMultiDraw=p,this.renderMultiDrawInstances=f}function R$(r){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function n(o,l,u){switch(i.calls++,l){case r.TRIANGLES:i.triangles+=u*(o/3);break;case r.LINES:i.lines+=u*(o/2);break;case r.LINE_STRIP:i.lines+=u*(o-1);break;case r.LINE_LOOP:i.lines+=u*o;break;case r.POINTS:i.points+=u*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l);break}}function s(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:s,update:n}}function I$(r,e,i){const n=new WeakMap,s=new qs;function o(l,u,c){const d=l.morphTargetInfluences,p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,f=p!==void 0?p.length:0;let m=n.get(u);if(m===void 0||m.count!==f){let g=function(){D.dispose(),n.delete(u),u.removeEventListener("dispose",g)};m!==void 0&&m.texture.dispose();const y=u.morphAttributes.position!==void 0,x=u.morphAttributes.normal!==void 0,v=u.morphAttributes.color!==void 0,_=u.morphAttributes.position||[],T=u.morphAttributes.normal||[],w=u.morphAttributes.color||[];let S=0;y===!0&&(S=1),x===!0&&(S=2),v===!0&&(S=3);let R=u.attributes.position.count*S,B=1;R>e.maxTextureSize&&(B=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const I=new Float32Array(R*B*4*f),D=new mP(I,R,B,f);D.type=Au,D.needsUpdate=!0;const L=S*4;for(let O=0;O<f;O++){const U=_[O],J=T[O],H=w[O],V=R*B*4*O;for(let $=0;$<U.count;$++){const Q=$*L;y===!0&&(s.fromBufferAttribute(U,$),I[V+Q+0]=s.x,I[V+Q+1]=s.y,I[V+Q+2]=s.z,I[V+Q+3]=0),x===!0&&(s.fromBufferAttribute(J,$),I[V+Q+4]=s.x,I[V+Q+5]=s.y,I[V+Q+6]=s.z,I[V+Q+7]=0),v===!0&&(s.fromBufferAttribute(H,$),I[V+Q+8]=s.x,I[V+Q+9]=s.y,I[V+Q+10]=s.z,I[V+Q+11]=H.itemSize===4?s.w:1)}}m={count:f,texture:D,size:new zi(R,B)},n.set(u,m),u.addEventListener("dispose",g)}if(l.isInstancedMesh===!0&&l.morphTexture!==null)c.getUniforms().setValue(r,"morphTexture",l.morphTexture,i);else{let g=0;for(let x=0;x<d.length;x++)g+=d[x];const y=u.morphTargetsRelative?1:1-g;c.getUniforms().setValue(r,"morphTargetBaseInfluence",y),c.getUniforms().setValue(r,"morphTargetInfluences",d)}c.getUniforms().setValue(r,"morphTargetsTexture",m.texture,i),c.getUniforms().setValue(r,"morphTargetsTextureSize",m.size)}return{update:o}}function B$(r,e,i,n){let s=new WeakMap;function o(c){const d=n.render.frame,p=c.geometry,f=e.get(c,p);if(s.get(f)!==d&&(e.update(f),s.set(f,d)),c.isInstancedMesh&&(c.hasEventListener("dispose",u)===!1&&c.addEventListener("dispose",u),s.get(c)!==d&&(i.update(c.instanceMatrix,r.ARRAY_BUFFER),c.instanceColor!==null&&i.update(c.instanceColor,r.ARRAY_BUFFER),s.set(c,d))),c.isSkinnedMesh){const m=c.skeleton;s.get(m)!==d&&(m.update(),s.set(m,d))}return f}function l(){s=new WeakMap}function u(c){const d=c.target;d.removeEventListener("dispose",u),i.remove(d.instanceMatrix),d.instanceColor!==null&&i.remove(d.instanceColor)}return{update:o,dispose:l}}let WP=class extends Sl{constructor(r,e,i,n,s,o,l,u,c,d=lm){if(d!==lm&&d!==cm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&d===lm&&(i=ip),i===void 0&&d===cm&&(i=om),super(null,n,s,o,l,u,d,i,c),this.isDepthTexture=!0,this.image={width:r,height:e},this.magFilter=l!==void 0?l:Kl,this.minFilter=u!==void 0?u:Kl,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(r){return super.copy(r),this.compareFunction=r.compareFunction,this}toJSON(r){const e=super.toJSON(r);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}};const QP=new Sl,qP=new WP(1,1),XP=new mP,YP=new yK,KP=new PP,JP=[],ZP=[],$P=new Float32Array(16),e4=new Float32Array(9),t4=new Float32Array(4);function Rm(r,e,i){const n=r[0];if(n<=0||n>0)return r;const s=e*i;let o=JP[s];if(o===void 0&&(o=new Float32Array(s),JP[s]=o),e!==0){n.toArray(o,0);for(let l=1,u=0;l!==e;++l)u+=i,r[l].toArray(o,u)}return o}function ca(r,e){if(r.length!==e.length)return!1;for(let i=0,n=r.length;i<n;i++)if(r[i]!==e[i])return!1;return!0}function ua(r,e){for(let i=0,n=e.length;i<n;i++)r[i]=e[i]}function mb(r,e){let i=ZP[e];i===void 0&&(i=new Int32Array(e),ZP[e]=i);for(let n=0;n!==e;++n)i[n]=r.allocateTextureUnit();return i}function N$(r,e){const i=this.cache;i[0]!==e&&(r.uniform1f(this.addr,e),i[0]=e)}function L$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ca(i,e))return;r.uniform2fv(this.addr,e),ua(i,e)}}function D$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(ca(i,e))return;r.uniform3fv(this.addr,e),ua(i,e)}}function O$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ca(i,e))return;r.uniform4fv(this.addr,e),ua(i,e)}}function P$(r,e){const i=this.cache,n=e.elements;if(n===void 0){if(ca(i,e))return;r.uniformMatrix2fv(this.addr,!1,e),ua(i,e)}else{if(ca(i,n))return;t4.set(n),r.uniformMatrix2fv(this.addr,!1,t4),ua(i,n)}}function F$(r,e){const i=this.cache,n=e.elements;if(n===void 0){if(ca(i,e))return;r.uniformMatrix3fv(this.addr,!1,e),ua(i,e)}else{if(ca(i,n))return;e4.set(n),r.uniformMatrix3fv(this.addr,!1,e4),ua(i,n)}}function k$(r,e){const i=this.cache,n=e.elements;if(n===void 0){if(ca(i,e))return;r.uniformMatrix4fv(this.addr,!1,e),ua(i,e)}else{if(ca(i,n))return;$P.set(n),r.uniformMatrix4fv(this.addr,!1,$P),ua(i,n)}}function U$(r,e){const i=this.cache;i[0]!==e&&(r.uniform1i(this.addr,e),i[0]=e)}function z$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ca(i,e))return;r.uniform2iv(this.addr,e),ua(i,e)}}function j$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ca(i,e))return;r.uniform3iv(this.addr,e),ua(i,e)}}function V$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ca(i,e))return;r.uniform4iv(this.addr,e),ua(i,e)}}function G$(r,e){const i=this.cache;i[0]!==e&&(r.uniform1ui(this.addr,e),i[0]=e)}function H$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ca(i,e))return;r.uniform2uiv(this.addr,e),ua(i,e)}}function W$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ca(i,e))return;r.uniform3uiv(this.addr,e),ua(i,e)}}function Q$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ca(i,e))return;r.uniform4uiv(this.addr,e),ua(i,e)}}function q$(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s);let o;this.type===r.SAMPLER_2D_SHADOW?(qP.compareFunction=nP,o=qP):o=QP,i.setTexture2D(e||o,s)}function X$(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(e||YP,s)}function Y$(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),i.setTextureCube(e||KP,s)}function K$(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(e||XP,s)}function J$(r){switch(r){case 5126:return N$;case 35664:return L$;case 35665:return D$;case 35666:return O$;case 35674:return P$;case 35675:return F$;case 35676:return k$;case 5124:case 35670:return U$;case 35667:case 35671:return z$;case 35668:case 35672:return j$;case 35669:case 35673:return V$;case 5125:return G$;case 36294:return H$;case 36295:return W$;case 36296:return Q$;case 35678:case 36198:case 36298:case 36306:case 35682:return q$;case 35679:case 36299:case 36307:return X$;case 35680:case 36300:case 36308:case 36293:return Y$;case 36289:case 36303:case 36311:case 36292:return K$}}function Z$(r,e){r.uniform1fv(this.addr,e)}function $$(r,e){const i=Rm(e,this.size,2);r.uniform2fv(this.addr,i)}function eee(r,e){const i=Rm(e,this.size,3);r.uniform3fv(this.addr,i)}function tee(r,e){const i=Rm(e,this.size,4);r.uniform4fv(this.addr,i)}function iee(r,e){const i=Rm(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,i)}function ree(r,e){const i=Rm(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,i)}function nee(r,e){const i=Rm(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,i)}function see(r,e){r.uniform1iv(this.addr,e)}function aee(r,e){r.uniform2iv(this.addr,e)}function oee(r,e){r.uniform3iv(this.addr,e)}function lee(r,e){r.uniform4iv(this.addr,e)}function cee(r,e){r.uniform1uiv(this.addr,e)}function uee(r,e){r.uniform2uiv(this.addr,e)}function hee(r,e){r.uniform3uiv(this.addr,e)}function dee(r,e){r.uniform4uiv(this.addr,e)}function pee(r,e,i){const n=this.cache,s=e.length,o=mb(i,s);ca(n,o)||(r.uniform1iv(this.addr,o),ua(n,o));for(let l=0;l!==s;++l)i.setTexture2D(e[l]||QP,o[l])}function fee(r,e,i){const n=this.cache,s=e.length,o=mb(i,s);ca(n,o)||(r.uniform1iv(this.addr,o),ua(n,o));for(let l=0;l!==s;++l)i.setTexture3D(e[l]||YP,o[l])}function mee(r,e,i){const n=this.cache,s=e.length,o=mb(i,s);ca(n,o)||(r.uniform1iv(this.addr,o),ua(n,o));for(let l=0;l!==s;++l)i.setTextureCube(e[l]||KP,o[l])}function gee(r,e,i){const n=this.cache,s=e.length,o=mb(i,s);ca(n,o)||(r.uniform1iv(this.addr,o),ua(n,o));for(let l=0;l!==s;++l)i.setTexture2DArray(e[l]||XP,o[l])}function Aee(r){switch(r){case 5126:return Z$;case 35664:return $$;case 35665:return eee;case 35666:return tee;case 35674:return iee;case 35675:return ree;case 35676:return nee;case 5124:case 35670:return see;case 35667:case 35671:return aee;case 35668:case 35672:return oee;case 35669:case 35673:return lee;case 5125:return cee;case 36294:return uee;case 36295:return hee;case 36296:return dee;case 35678:case 36198:case 36298:case 36306:case 35682:return pee;case 35679:case 36299:case 36307:return fee;case 35680:case 36300:case 36308:case 36293:return mee;case 36289:case 36303:case 36311:case 36292:return gee}}class yee{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.setValue=J$(i.type)}}class vee{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=Aee(i.type)}}class xee{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,n){const s=this.seq;for(let o=0,l=s.length;o!==l;++o){const u=s[o];u.setValue(e,i[u.id],n)}}}const LS=/(\w+)(\])?(\[|\.)?/g;function i4(r,e){r.seq.push(e),r.map[e.id]=e}function bee(r,e,i){const n=r.name,s=n.length;for(LS.lastIndex=0;;){const o=LS.exec(n),l=LS.lastIndex;let u=o[1];const c=o[2]==="]",d=o[3];if(c&&(u=u|0),d===void 0||d==="["&&l+2===s){i4(i,d===void 0?new yee(u,r,e):new vee(u,r,e));break}else{let p=i.map[u];p===void 0&&(p=new xee(u),i4(i,p)),i=p}}}class gb{constructor(e,i){this.seq=[],this.map={};const n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){const o=e.getActiveUniform(i,s),l=e.getUniformLocation(i,o.name);bee(o,l,this)}}setValue(e,i,n,s){const o=this.map[i];o!==void 0&&o.setValue(e,n,s)}setOptional(e,i,n){const s=i[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,i,n,s){for(let o=0,l=i.length;o!==l;++o){const u=i[o],c=n[u.id];c.needsUpdate!==!1&&u.setValue(e,c.value,s)}}static seqWithValue(e,i){const n=[];for(let s=0,o=e.length;s!==o;++s){const l=e[s];l.id in i&&n.push(l)}return n}}function r4(r,e,i){const n=r.createShader(e);return r.shaderSource(n,i),r.compileShader(n),n}const _ee=37297;let Eee=0;function wee(r,e){const i=r.split(`
`),n=[],s=Math.max(e-6,0),o=Math.min(e+6,i.length);for(let l=s;l<o;l++){const u=l+1;n.push(`${u===e?">":" "} ${u}: ${i[l]}`)}return n.join(`
`)}const n4=new pn;function Cee(r){Pn._getMatrix(n4,Pn.workingColorSpace,r);const e=`mat3( ${n4.elements.map(i=>i.toFixed(4))} )`;switch(Pn.getTransfer(r)){case Wx:return[e,"LinearTransferOETF"];case ss:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",r),[e,"LinearTransferOETF"]}}function s4(r,e,i){const n=r.getShaderParameter(e,r.COMPILE_STATUS),s=r.getShaderInfoLog(e).trim();if(n&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const l=parseInt(o[1]);return i.toUpperCase()+`

`+s+`

`+wee(r.getShaderSource(e),l)}else return s}function See(r,e){const i=Cee(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)}function Tee(r,e){let i;switch(e){case IY:i="Linear";break;case BY:i="Reinhard";break;case NY:i="Cineon";break;case LY:i="ACESFilmic";break;case OY:i="AgX";break;case PY:i="Neutral";break;case DY:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+r+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const Ab=new at;function Mee(){Pn.getLuminanceCoefficients(Ab);const r=Ab.x.toFixed(4),e=Ab.y.toFixed(4),i=Ab.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${e}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Ree(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(hA).join(`
`)}function Iee(r){const e=[];for(const i in r){const n=r[i];n!==!1&&e.push("#define "+i+" "+n)}return e.join(`
`)}function Bee(r,e){const i={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const o=r.getActiveAttrib(e,s),l=o.name;let u=1;o.type===r.FLOAT_MAT2&&(u=2),o.type===r.FLOAT_MAT3&&(u=3),o.type===r.FLOAT_MAT4&&(u=4),i[l]={type:o.type,location:r.getAttribLocation(e,l),locationSize:u}}return i}function hA(r){return r!==""}function a4(r,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function o4(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Nee=/^[ \t]*#include +<([\w\d./]+)>/gm;function DS(r){return r.replace(Nee,Dee)}const Lee=new Map;function Dee(r,e){let i=ln[e];if(i===void 0){const n=Lee.get(e);if(n!==void 0)i=ln[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return DS(i)}const Oee=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function l4(r){return r.replace(Oee,Pee)}function Pee(r,e,i,n){let s="";for(let o=parseInt(e);o<parseInt(i);o++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return s}function c4(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Fee(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===jO?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===cY?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===pu&&(e="SHADOWMAP_TYPE_VSM"),e}function kee(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case nm:case sm:e="ENVMAP_TYPE_CUBE";break;case kx:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Uee(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case sm:e="ENVMAP_MODE_REFRACTION";break}return e}function zee(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case AC:e="ENVMAP_BLENDING_MULTIPLY";break;case MY:e="ENVMAP_BLENDING_MIX";break;case RY:e="ENVMAP_BLENDING_ADD";break}return e}function jee(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:n,maxMip:i}}function Vee(r,e,i,n){const s=r.getContext(),o=i.defines;let l=i.vertexShader,u=i.fragmentShader;const c=Fee(i),d=kee(i),p=Uee(i),f=zee(i),m=jee(i),g=Ree(i),y=Iee(o),x=s.createProgram();let v,_,T=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(v=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y].filter(hA).join(`
`),v.length>0&&(v+=`
`),_=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y].filter(hA).join(`
`),_.length>0&&(_+=`
`)):(v=[c4(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(hA).join(`
`),_=[c4(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.envMap?"#define "+p:"",i.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Oh?"#define TONE_MAPPING":"",i.toneMapping!==Oh?ln.tonemapping_pars_fragment:"",i.toneMapping!==Oh?Tee("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ln.colorspace_pars_fragment,See("linearToOutputTexel",i.outputColorSpace),Mee(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(hA).join(`
`)),l=DS(l),l=a4(l,i),l=o4(l,i),u=DS(u),u=a4(u,i),u=o4(u,i),l=l4(l),u=l4(u),i.isRawShaderMaterial!==!0&&(T=`#version 300 es
`,v=[g,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,_=["#define varying in",i.glslVersion===sP?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===sP?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const w=T+v+l,S=T+_+u,R=r4(s,s.VERTEX_SHADER,w),B=r4(s,s.FRAGMENT_SHADER,S);s.attachShader(x,R),s.attachShader(x,B),i.index0AttributeName!==void 0?s.bindAttribLocation(x,0,i.index0AttributeName):i.morphTargets===!0&&s.bindAttribLocation(x,0,"position"),s.linkProgram(x);function I(U){if(r.debug.checkShaderErrors){const J=s.getProgramInfoLog(x).trim(),H=s.getShaderInfoLog(R).trim(),V=s.getShaderInfoLog(B).trim();let $=!0,Q=!0;if(s.getProgramParameter(x,s.LINK_STATUS)===!1)if($=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(s,x,R,B);else{const G=s4(s,R,"vertex"),j=s4(s,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(x,s.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+J+`
`+G+`
`+j)}else J!==""?console.warn("THREE.WebGLProgram: Program Info Log:",J):(H===""||V==="")&&(Q=!1);Q&&(U.diagnostics={runnable:$,programLog:J,vertexShader:{log:H,prefix:v},fragmentShader:{log:V,prefix:_}})}s.deleteShader(R),s.deleteShader(B),D=new gb(s,x),L=Bee(s,x)}let D;this.getUniforms=function(){return D===void 0&&I(this),D};let L;this.getAttributes=function(){return L===void 0&&I(this),L};let O=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return O===!1&&(O=s.getProgramParameter(x,_ee)),O},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(x),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=Eee++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=R,this.fragmentShader=B,this}let Gee=0;class Hee{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(i),o=this._getShaderStage(n),l=this._getShaderCacheForMaterial(e);return l.has(s)===!1&&(l.add(s),s.usedTimes++),l.has(o)===!1&&(l.add(o),o.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const n of i)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let n=i.get(e);return n===void 0&&(n=new Set,i.set(e,n)),n}_getShaderStage(e){const i=this.shaderCache;let n=i.get(e);return n===void 0&&(n=new Wee(e),i.set(e,n)),n}}class Wee{constructor(e){this.id=Gee++,this.code=e,this.usedTimes=0}}function Qee(r,e,i,n,s,o,l){const u=new dS,c=new Hee,d=new Set,p=[],f=s.logarithmicDepthBuffer,m=s.vertexTextures;let g=s.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(L){return d.add(L),L===0?"uv":`uv${L}`}function v(L,O,U,J,H){const V=J.fog,$=H.geometry,Q=L.isMeshStandardMaterial?J.environment:null,G=(L.isMeshStandardMaterial?i:e).get(L.envMap||Q),j=G&&G.mapping===kx?G.image.height:null,ie=y[L.type];L.precision!==null&&(g=s.getMaxPrecision(L.precision),g!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",g,"instead."));const Y=$.morphAttributes.position||$.morphAttributes.normal||$.morphAttributes.color,ae=Y!==void 0?Y.length:0;let xe=0;$.morphAttributes.position!==void 0&&(xe=1),$.morphAttributes.normal!==void 0&&(xe=2),$.morphAttributes.color!==void 0&&(xe=3);let fe,de,Ie,Ge;if(ie){const Pi=Dc[ie];fe=Pi.vertexShader,de=Pi.fragmentShader}else fe=L.vertexShader,de=L.fragmentShader,c.update(L),Ie=c.getVertexShaderID(L),Ge=c.getFragmentShaderID(L);const Xe=r.getRenderTarget(),$e=r.state.buffers.depth.getReversed(),lt=H.isInstancedMesh===!0,At=H.isBatchedMesh===!0,Gt=!!L.map,gt=!!L.matcap,yi=!!G,Ze=!!L.aoMap,ki=!!L.lightMap,hi=!!L.bumpMap,Ri=!!L.normalMap,Si=!!L.displacementMap,tr=!!L.emissiveMap,Vi=!!L.metalnessMap,Qe=!!L.roughnessMap,Ce=L.anisotropy>0,yt=L.clearcoat>0,Ot=L.dispersion>0,Jt=L.iridescence>0,zt=L.sheen>0,xi=L.transmission>0,vt=Ce&&!!L.anisotropyMap,ye=yt&&!!L.clearcoatMap,ve=yt&&!!L.clearcoatNormalMap,Le=yt&&!!L.clearcoatRoughnessMap,Te=Jt&&!!L.iridescenceMap,Fe=Jt&&!!L.iridescenceThicknessMap,Pe=zt&&!!L.sheenColorMap,k=zt&&!!L.sheenRoughnessMap,Z=!!L.specularMap,re=!!L.specularColorMap,Re=!!L.specularIntensityMap,ce=xi&&!!L.transmissionMap,Ue=xi&&!!L.thicknessMap,je=!!L.gradientMap,dt=!!L.alphaMap,Bt=L.alphaTest>0,bt=!!L.alphaHash,Ut=!!L.extensions;let di=Oh;L.toneMapped&&(Xe===null||Xe.isXRRenderTarget===!0)&&(di=r.toneMapping);const br={shaderID:ie,shaderType:L.type,shaderName:L.name,vertexShader:fe,fragmentShader:de,defines:L.defines,customVertexShaderID:Ie,customFragmentShaderID:Ge,isRawShaderMaterial:L.isRawShaderMaterial===!0,glslVersion:L.glslVersion,precision:g,batching:At,batchingColor:At&&H._colorsTexture!==null,instancing:lt,instancingColor:lt&&H.instanceColor!==null,instancingMorph:lt&&H.morphTexture!==null,supportsVertexTextures:m,outputColorSpace:Xe===null?r.outputColorSpace:Xe.isXRRenderTarget===!0?Xe.texture.colorSpace:um,alphaToCoverage:!!L.alphaToCoverage,map:Gt,matcap:gt,envMap:yi,envMapMode:yi&&G.mapping,envMapCubeUVHeight:j,aoMap:Ze,lightMap:ki,bumpMap:hi,normalMap:Ri,displacementMap:m&&Si,emissiveMap:tr,normalMapObjectSpace:Ri&&L.normalMapType===zY,normalMapTangentSpace:Ri&&L.normalMapType===iP,metalnessMap:Vi,roughnessMap:Qe,anisotropy:Ce,anisotropyMap:vt,clearcoat:yt,clearcoatMap:ye,clearcoatNormalMap:ve,clearcoatRoughnessMap:Le,dispersion:Ot,iridescence:Jt,iridescenceMap:Te,iridescenceThicknessMap:Fe,sheen:zt,sheenColorMap:Pe,sheenRoughnessMap:k,specularMap:Z,specularColorMap:re,specularIntensityMap:Re,transmission:xi,transmissionMap:ce,thicknessMap:Ue,gradientMap:je,opaque:L.transparent===!1&&L.blending===im&&L.alphaToCoverage===!1,alphaMap:dt,alphaTest:Bt,alphaHash:bt,combine:L.combine,mapUv:Gt&&x(L.map.channel),aoMapUv:Ze&&x(L.aoMap.channel),lightMapUv:ki&&x(L.lightMap.channel),bumpMapUv:hi&&x(L.bumpMap.channel),normalMapUv:Ri&&x(L.normalMap.channel),displacementMapUv:Si&&x(L.displacementMap.channel),emissiveMapUv:tr&&x(L.emissiveMap.channel),metalnessMapUv:Vi&&x(L.metalnessMap.channel),roughnessMapUv:Qe&&x(L.roughnessMap.channel),anisotropyMapUv:vt&&x(L.anisotropyMap.channel),clearcoatMapUv:ye&&x(L.clearcoatMap.channel),clearcoatNormalMapUv:ve&&x(L.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Le&&x(L.clearcoatRoughnessMap.channel),iridescenceMapUv:Te&&x(L.iridescenceMap.channel),iridescenceThicknessMapUv:Fe&&x(L.iridescenceThicknessMap.channel),sheenColorMapUv:Pe&&x(L.sheenColorMap.channel),sheenRoughnessMapUv:k&&x(L.sheenRoughnessMap.channel),specularMapUv:Z&&x(L.specularMap.channel),specularColorMapUv:re&&x(L.specularColorMap.channel),specularIntensityMapUv:Re&&x(L.specularIntensityMap.channel),transmissionMapUv:ce&&x(L.transmissionMap.channel),thicknessMapUv:Ue&&x(L.thicknessMap.channel),alphaMapUv:dt&&x(L.alphaMap.channel),vertexTangents:!!$.attributes.tangent&&(Ri||Ce),vertexColors:L.vertexColors,vertexAlphas:L.vertexColors===!0&&!!$.attributes.color&&$.attributes.color.itemSize===4,pointsUvs:H.isPoints===!0&&!!$.attributes.uv&&(Gt||dt),fog:!!V,useFog:L.fog===!0,fogExp2:!!V&&V.isFogExp2,flatShading:L.flatShading===!0,sizeAttenuation:L.sizeAttenuation===!0,logarithmicDepthBuffer:f,reverseDepthBuffer:$e,skinning:H.isSkinnedMesh===!0,morphTargets:$.morphAttributes.position!==void 0,morphNormals:$.morphAttributes.normal!==void 0,morphColors:$.morphAttributes.color!==void 0,morphTargetsCount:ae,morphTextureStride:xe,numDirLights:O.directional.length,numPointLights:O.point.length,numSpotLights:O.spot.length,numSpotLightMaps:O.spotLightMap.length,numRectAreaLights:O.rectArea.length,numHemiLights:O.hemi.length,numDirLightShadows:O.directionalShadowMap.length,numPointLightShadows:O.pointShadowMap.length,numSpotLightShadows:O.spotShadowMap.length,numSpotLightShadowsWithMaps:O.numSpotLightShadowsWithMaps,numLightProbes:O.numLightProbes,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:L.dithering,shadowMapEnabled:r.shadowMap.enabled&&U.length>0,shadowMapType:r.shadowMap.type,toneMapping:di,decodeVideoTexture:Gt&&L.map.isVideoTexture===!0&&Pn.getTransfer(L.map.colorSpace)===ss,decodeVideoTextureEmissive:tr&&L.emissiveMap.isVideoTexture===!0&&Pn.getTransfer(L.emissiveMap.colorSpace)===ss,premultipliedAlpha:L.premultipliedAlpha,doubleSided:L.side===fu,flipSided:L.side===ho,useDepthPacking:L.depthPacking>=0,depthPacking:L.depthPacking||0,index0AttributeName:L.index0AttributeName,extensionClipCullDistance:Ut&&L.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Ut&&L.extensions.multiDraw===!0||At)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:L.customProgramCacheKey()};return br.vertexUv1s=d.has(1),br.vertexUv2s=d.has(2),br.vertexUv3s=d.has(3),d.clear(),br}function _(L){const O=[];if(L.shaderID?O.push(L.shaderID):(O.push(L.customVertexShaderID),O.push(L.customFragmentShaderID)),L.defines!==void 0)for(const U in L.defines)O.push(U),O.push(L.defines[U]);return L.isRawShaderMaterial===!1&&(T(O,L),w(O,L),O.push(r.outputColorSpace)),O.push(L.customProgramCacheKey),O.join()}function T(L,O){L.push(O.precision),L.push(O.outputColorSpace),L.push(O.envMapMode),L.push(O.envMapCubeUVHeight),L.push(O.mapUv),L.push(O.alphaMapUv),L.push(O.lightMapUv),L.push(O.aoMapUv),L.push(O.bumpMapUv),L.push(O.normalMapUv),L.push(O.displacementMapUv),L.push(O.emissiveMapUv),L.push(O.metalnessMapUv),L.push(O.roughnessMapUv),L.push(O.anisotropyMapUv),L.push(O.clearcoatMapUv),L.push(O.clearcoatNormalMapUv),L.push(O.clearcoatRoughnessMapUv),L.push(O.iridescenceMapUv),L.push(O.iridescenceThicknessMapUv),L.push(O.sheenColorMapUv),L.push(O.sheenRoughnessMapUv),L.push(O.specularMapUv),L.push(O.specularColorMapUv),L.push(O.specularIntensityMapUv),L.push(O.transmissionMapUv),L.push(O.thicknessMapUv),L.push(O.combine),L.push(O.fogExp2),L.push(O.sizeAttenuation),L.push(O.morphTargetsCount),L.push(O.morphAttributeCount),L.push(O.numDirLights),L.push(O.numPointLights),L.push(O.numSpotLights),L.push(O.numSpotLightMaps),L.push(O.numHemiLights),L.push(O.numRectAreaLights),L.push(O.numDirLightShadows),L.push(O.numPointLightShadows),L.push(O.numSpotLightShadows),L.push(O.numSpotLightShadowsWithMaps),L.push(O.numLightProbes),L.push(O.shadowMapType),L.push(O.toneMapping),L.push(O.numClippingPlanes),L.push(O.numClipIntersection),L.push(O.depthPacking)}function w(L,O){u.disableAll(),O.supportsVertexTextures&&u.enable(0),O.instancing&&u.enable(1),O.instancingColor&&u.enable(2),O.instancingMorph&&u.enable(3),O.matcap&&u.enable(4),O.envMap&&u.enable(5),O.normalMapObjectSpace&&u.enable(6),O.normalMapTangentSpace&&u.enable(7),O.clearcoat&&u.enable(8),O.iridescence&&u.enable(9),O.alphaTest&&u.enable(10),O.vertexColors&&u.enable(11),O.vertexAlphas&&u.enable(12),O.vertexUv1s&&u.enable(13),O.vertexUv2s&&u.enable(14),O.vertexUv3s&&u.enable(15),O.vertexTangents&&u.enable(16),O.anisotropy&&u.enable(17),O.alphaHash&&u.enable(18),O.batching&&u.enable(19),O.dispersion&&u.enable(20),O.batchingColor&&u.enable(21),L.push(u.mask),u.disableAll(),O.fog&&u.enable(0),O.useFog&&u.enable(1),O.flatShading&&u.enable(2),O.logarithmicDepthBuffer&&u.enable(3),O.reverseDepthBuffer&&u.enable(4),O.skinning&&u.enable(5),O.morphTargets&&u.enable(6),O.morphNormals&&u.enable(7),O.morphColors&&u.enable(8),O.premultipliedAlpha&&u.enable(9),O.shadowMapEnabled&&u.enable(10),O.doubleSided&&u.enable(11),O.flipSided&&u.enable(12),O.useDepthPacking&&u.enable(13),O.dithering&&u.enable(14),O.transmission&&u.enable(15),O.sheen&&u.enable(16),O.opaque&&u.enable(17),O.pointsUvs&&u.enable(18),O.decodeVideoTexture&&u.enable(19),O.decodeVideoTextureEmissive&&u.enable(20),O.alphaToCoverage&&u.enable(21),L.push(u.mask)}function S(L){const O=y[L.type];let U;if(O){const J=Dc[O];U=NP.clone(J.uniforms)}else U=L.uniforms;return U}function R(L,O){let U;for(let J=0,H=p.length;J<H;J++){const V=p[J];if(V.cacheKey===O){U=V,++U.usedTimes;break}}return U===void 0&&(U=new Vee(r,O,L,o),p.push(U)),U}function B(L){if(--L.usedTimes===0){const O=p.indexOf(L);p[O]=p[p.length-1],p.pop(),L.destroy()}}function I(L){c.remove(L)}function D(){c.dispose()}return{getParameters:v,getProgramCacheKey:_,getUniforms:S,acquireProgram:R,releaseProgram:B,releaseShaderCache:I,programs:p,dispose:D}}function qee(){let r=new WeakMap;function e(l){return r.has(l)}function i(l){let u=r.get(l);return u===void 0&&(u={},r.set(l,u)),u}function n(l){r.delete(l)}function s(l,u,c){r.get(l)[u]=c}function o(){r=new WeakMap}return{has:e,get:i,remove:n,update:s,dispose:o}}function Xee(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function u4(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function h4(){const r=[];let e=0;const i=[],n=[],s=[];function o(){e=0,i.length=0,n.length=0,s.length=0}function l(f,m,g,y,x,v){let _=r[e];return _===void 0?(_={id:f.id,object:f,geometry:m,material:g,groupOrder:y,renderOrder:f.renderOrder,z:x,group:v},r[e]=_):(_.id=f.id,_.object=f,_.geometry=m,_.material=g,_.groupOrder=y,_.renderOrder=f.renderOrder,_.z=x,_.group=v),e++,_}function u(f,m,g,y,x,v){const _=l(f,m,g,y,x,v);g.transmission>0?n.push(_):g.transparent===!0?s.push(_):i.push(_)}function c(f,m,g,y,x,v){const _=l(f,m,g,y,x,v);g.transmission>0?n.unshift(_):g.transparent===!0?s.unshift(_):i.unshift(_)}function d(f,m){i.length>1&&i.sort(f||Xee),n.length>1&&n.sort(m||u4),s.length>1&&s.sort(m||u4)}function p(){for(let f=e,m=r.length;f<m;f++){const g=r[f];if(g.id===null)break;g.id=null,g.object=null,g.geometry=null,g.material=null,g.group=null}}return{opaque:i,transmissive:n,transparent:s,init:o,push:u,unshift:c,finish:p,sort:d}}function Yee(){let r=new WeakMap;function e(n,s){const o=r.get(n);let l;return o===void 0?(l=new h4,r.set(n,[l])):s>=o.length?(l=new h4,o.push(l)):l=o[s],l}function i(){r=new WeakMap}return{get:e,dispose:i}}function Kee(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new at,color:new wn};break;case"SpotLight":i={position:new at,direction:new at,color:new wn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new at,color:new wn,distance:0,decay:0};break;case"HemisphereLight":i={direction:new at,skyColor:new wn,groundColor:new wn};break;case"RectAreaLight":i={color:new wn,position:new at,halfWidth:new at,halfHeight:new at};break}return r[e.id]=i,i}}}function Jee(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zi};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zi};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zi,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=i,i}}}let Zee=0;function $ee(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function ete(r){const e=new Kee,i=Jee(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let d=0;d<9;d++)n.probe.push(new at);const s=new at,o=new ps,l=new ps;function u(d){let p=0,f=0,m=0;for(let L=0;L<9;L++)n.probe[L].set(0,0,0);let g=0,y=0,x=0,v=0,_=0,T=0,w=0,S=0,R=0,B=0,I=0;d.sort($ee);for(let L=0,O=d.length;L<O;L++){const U=d[L],J=U.color,H=U.intensity,V=U.distance,$=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)p+=J.r*H,f+=J.g*H,m+=J.b*H;else if(U.isLightProbe){for(let Q=0;Q<9;Q++)n.probe[Q].addScaledVector(U.sh.coefficients[Q],H);I++}else if(U.isDirectionalLight){const Q=e.get(U);if(Q.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const G=U.shadow,j=i.get(U);j.shadowIntensity=G.intensity,j.shadowBias=G.bias,j.shadowNormalBias=G.normalBias,j.shadowRadius=G.radius,j.shadowMapSize=G.mapSize,n.directionalShadow[g]=j,n.directionalShadowMap[g]=$,n.directionalShadowMatrix[g]=U.shadow.matrix,T++}n.directional[g]=Q,g++}else if(U.isSpotLight){const Q=e.get(U);Q.position.setFromMatrixPosition(U.matrixWorld),Q.color.copy(J).multiplyScalar(H),Q.distance=V,Q.coneCos=Math.cos(U.angle),Q.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),Q.decay=U.decay,n.spot[x]=Q;const G=U.shadow;if(U.map&&(n.spotLightMap[R]=U.map,R++,G.updateMatrices(U),U.castShadow&&B++),n.spotLightMatrix[x]=G.matrix,U.castShadow){const j=i.get(U);j.shadowIntensity=G.intensity,j.shadowBias=G.bias,j.shadowNormalBias=G.normalBias,j.shadowRadius=G.radius,j.shadowMapSize=G.mapSize,n.spotShadow[x]=j,n.spotShadowMap[x]=$,S++}x++}else if(U.isRectAreaLight){const Q=e.get(U);Q.color.copy(J).multiplyScalar(H),Q.halfWidth.set(U.width*.5,0,0),Q.halfHeight.set(0,U.height*.5,0),n.rectArea[v]=Q,v++}else if(U.isPointLight){const Q=e.get(U);if(Q.color.copy(U.color).multiplyScalar(U.intensity),Q.distance=U.distance,Q.decay=U.decay,U.castShadow){const G=U.shadow,j=i.get(U);j.shadowIntensity=G.intensity,j.shadowBias=G.bias,j.shadowNormalBias=G.normalBias,j.shadowRadius=G.radius,j.shadowMapSize=G.mapSize,j.shadowCameraNear=G.camera.near,j.shadowCameraFar=G.camera.far,n.pointShadow[y]=j,n.pointShadowMap[y]=$,n.pointShadowMatrix[y]=U.shadow.matrix,w++}n.point[y]=Q,y++}else if(U.isHemisphereLight){const Q=e.get(U);Q.skyColor.copy(U.color).multiplyScalar(H),Q.groundColor.copy(U.groundColor).multiplyScalar(H),n.hemi[_]=Q,_++}}v>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=qi.LTC_FLOAT_1,n.rectAreaLTC2=qi.LTC_FLOAT_2):(n.rectAreaLTC1=qi.LTC_HALF_1,n.rectAreaLTC2=qi.LTC_HALF_2)),n.ambient[0]=p,n.ambient[1]=f,n.ambient[2]=m;const D=n.hash;(D.directionalLength!==g||D.pointLength!==y||D.spotLength!==x||D.rectAreaLength!==v||D.hemiLength!==_||D.numDirectionalShadows!==T||D.numPointShadows!==w||D.numSpotShadows!==S||D.numSpotMaps!==R||D.numLightProbes!==I)&&(n.directional.length=g,n.spot.length=x,n.rectArea.length=v,n.point.length=y,n.hemi.length=_,n.directionalShadow.length=T,n.directionalShadowMap.length=T,n.pointShadow.length=w,n.pointShadowMap.length=w,n.spotShadow.length=S,n.spotShadowMap.length=S,n.directionalShadowMatrix.length=T,n.pointShadowMatrix.length=w,n.spotLightMatrix.length=S+R-B,n.spotLightMap.length=R,n.numSpotLightShadowsWithMaps=B,n.numLightProbes=I,D.directionalLength=g,D.pointLength=y,D.spotLength=x,D.rectAreaLength=v,D.hemiLength=_,D.numDirectionalShadows=T,D.numPointShadows=w,D.numSpotShadows=S,D.numSpotMaps=R,D.numLightProbes=I,n.version=Zee++)}function c(d,p){let f=0,m=0,g=0,y=0,x=0;const v=p.matrixWorldInverse;for(let _=0,T=d.length;_<T;_++){const w=d[_];if(w.isDirectionalLight){const S=n.directional[f];S.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(v),f++}else if(w.isSpotLight){const S=n.spot[g];S.position.setFromMatrixPosition(w.matrixWorld),S.position.applyMatrix4(v),S.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(v),g++}else if(w.isRectAreaLight){const S=n.rectArea[y];S.position.setFromMatrixPosition(w.matrixWorld),S.position.applyMatrix4(v),l.identity(),o.copy(w.matrixWorld),o.premultiply(v),l.extractRotation(o),S.halfWidth.set(w.width*.5,0,0),S.halfHeight.set(0,w.height*.5,0),S.halfWidth.applyMatrix4(l),S.halfHeight.applyMatrix4(l),y++}else if(w.isPointLight){const S=n.point[m];S.position.setFromMatrixPosition(w.matrixWorld),S.position.applyMatrix4(v),m++}else if(w.isHemisphereLight){const S=n.hemi[x];S.direction.setFromMatrixPosition(w.matrixWorld),S.direction.transformDirection(v),x++}}}return{setup:u,setupView:c,state:n}}function d4(r){const e=new ete(r),i=[],n=[];function s(p){d.camera=p,i.length=0,n.length=0}function o(p){i.push(p)}function l(p){n.push(p)}function u(){e.setup(i)}function c(p){e.setupView(i,p)}const d={lightsArray:i,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:d,setupLights:u,setupLightsView:c,pushLight:o,pushShadow:l}}function tte(r){let e=new WeakMap;function i(s,o=0){const l=e.get(s);let u;return l===void 0?(u=new d4(r),e.set(s,[u])):o>=l.length?(u=new d4(r),l.push(u)):u=l[o],u}function n(){e=new WeakMap}return{get:i,dispose:n}}class ite extends lp{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=kY,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class rte extends lp{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const nte=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,ste=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function ate(r,e,i){let n=new CS;const s=new zi,o=new zi,l=new qs,u=new ite({depthPacking:UY}),c=new rte,d={},p=i.maxTextureSize,f={[Dh]:ho,[ho]:Dh,[fu]:fu},m=new Lc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new zi},radius:{value:4}},vertexShader:nte,fragmentShader:ste}),g=m.clone();g.defines.HORIZONTAL_PASS=1;const y=new Po;y.setAttribute("position",new Oo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new La(y,m),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=jO;let _=this.type;this.render=function(B,I,D){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||B.length===0)return;const L=r.getRenderTarget(),O=r.getActiveCubeFace(),U=r.getActiveMipmapLevel(),J=r.state;J.setBlending(mu),J.buffers.color.setClear(1,1,1,1),J.buffers.depth.setTest(!0),J.setScissorTest(!1);const H=_!==pu&&this.type===pu,V=_===pu&&this.type!==pu;for(let $=0,Q=B.length;$<Q;$++){const G=B[$],j=G.shadow;if(j===void 0){console.warn("THREE.WebGLShadowMap:",G,"has no shadow.");continue}if(j.autoUpdate===!1&&j.needsUpdate===!1)continue;s.copy(j.mapSize);const ie=j.getFrameExtents();if(s.multiply(ie),o.copy(j.mapSize),(s.x>p||s.y>p)&&(s.x>p&&(o.x=Math.floor(p/ie.x),s.x=o.x*ie.x,j.mapSize.x=o.x),s.y>p&&(o.y=Math.floor(p/ie.y),s.y=o.y*ie.y,j.mapSize.y=o.y)),j.map===null||H===!0||V===!0){const ae=this.type!==pu?{minFilter:Kl,magFilter:Kl}:{};j.map!==null&&j.map.dispose(),j.map=new Fh(s.x,s.y,ae),j.map.texture.name=G.name+".shadowMap",j.camera.updateProjectionMatrix()}r.setRenderTarget(j.map),r.clear();const Y=j.getViewportCount();for(let ae=0;ae<Y;ae++){const xe=j.getViewport(ae);l.set(o.x*xe.x,o.y*xe.y,o.x*xe.z,o.y*xe.w),J.viewport(l),j.updateMatrices(G,ae),n=j.getFrustum(),S(I,D,j.camera,G,this.type)}j.isPointLightShadow!==!0&&this.type===pu&&T(j,D),j.needsUpdate=!1}_=this.type,v.needsUpdate=!1,r.setRenderTarget(L,O,U)};function T(B,I){const D=e.update(x);m.defines.VSM_SAMPLES!==B.blurSamples&&(m.defines.VSM_SAMPLES=B.blurSamples,g.defines.VSM_SAMPLES=B.blurSamples,m.needsUpdate=!0,g.needsUpdate=!0),B.mapPass===null&&(B.mapPass=new Fh(s.x,s.y)),m.uniforms.shadow_pass.value=B.map.texture,m.uniforms.resolution.value=B.mapSize,m.uniforms.radius.value=B.radius,r.setRenderTarget(B.mapPass),r.clear(),r.renderBufferDirect(I,null,D,m,x,null),g.uniforms.shadow_pass.value=B.mapPass.texture,g.uniforms.resolution.value=B.mapSize,g.uniforms.radius.value=B.radius,r.setRenderTarget(B.map),r.clear(),r.renderBufferDirect(I,null,D,g,x,null)}function w(B,I,D,L){let O=null;const U=D.isPointLight===!0?B.customDistanceMaterial:B.customDepthMaterial;if(U!==void 0)O=U;else if(O=D.isPointLight===!0?c:u,r.localClippingEnabled&&I.clipShadows===!0&&Array.isArray(I.clippingPlanes)&&I.clippingPlanes.length!==0||I.displacementMap&&I.displacementScale!==0||I.alphaMap&&I.alphaTest>0||I.map&&I.alphaTest>0){const J=O.uuid,H=I.uuid;let V=d[J];V===void 0&&(V={},d[J]=V);let $=V[H];$===void 0&&($=O.clone(),V[H]=$,I.addEventListener("dispose",R)),O=$}if(O.visible=I.visible,O.wireframe=I.wireframe,L===pu?O.side=I.shadowSide!==null?I.shadowSide:I.side:O.side=I.shadowSide!==null?I.shadowSide:f[I.side],O.alphaMap=I.alphaMap,O.alphaTest=I.alphaTest,O.map=I.map,O.clipShadows=I.clipShadows,O.clippingPlanes=I.clippingPlanes,O.clipIntersection=I.clipIntersection,O.displacementMap=I.displacementMap,O.displacementScale=I.displacementScale,O.displacementBias=I.displacementBias,O.wireframeLinewidth=I.wireframeLinewidth,O.linewidth=I.linewidth,D.isPointLight===!0&&O.isMeshDistanceMaterial===!0){const J=r.properties.get(O);J.light=D}return O}function S(B,I,D,L,O){if(B.visible===!1)return;if(B.layers.test(I.layers)&&(B.isMesh||B.isLine||B.isPoints)&&(B.castShadow||B.receiveShadow&&O===pu)&&(!B.frustumCulled||n.intersectsObject(B))){B.modelViewMatrix.multiplyMatrices(D.matrixWorldInverse,B.matrixWorld);const J=e.update(B),H=B.material;if(Array.isArray(H)){const V=J.groups;for(let $=0,Q=V.length;$<Q;$++){const G=V[$],j=H[G.materialIndex];if(j&&j.visible){const ie=w(B,j,L,O);B.onBeforeShadow(r,B,I,D,J,ie,G),r.renderBufferDirect(D,null,J,ie,B,G),B.onAfterShadow(r,B,I,D,J,ie,G)}}}else if(H.visible){const V=w(B,H,L,O);B.onBeforeShadow(r,B,I,D,J,V,null),r.renderBufferDirect(D,null,J,V,B,null),B.onAfterShadow(r,B,I,D,J,V,null)}}const U=B.children;for(let J=0,H=U.length;J<H;J++)S(U[J],I,D,L,O)}function R(B){B.target.removeEventListener("dispose",R);for(const I in d){const D=d[I],L=B.target.uuid;L in D&&(D[L].dispose(),delete D[L])}}}const ote={[uC]:hC,[dC]:mC,[pC]:gC,[rm]:fC,[hC]:uC,[mC]:dC,[gC]:pC,[fC]:rm};function lte(r,e){function i(){let ce=!1;const Ue=new qs;let je=null;const dt=new qs(0,0,0,0);return{setMask:function(Bt){je!==Bt&&!ce&&(r.colorMask(Bt,Bt,Bt,Bt),je=Bt)},setLocked:function(Bt){ce=Bt},setClear:function(Bt,bt,Ut,di,br){br===!0&&(Bt*=di,bt*=di,Ut*=di),Ue.set(Bt,bt,Ut,di),dt.equals(Ue)===!1&&(r.clearColor(Bt,bt,Ut,di),dt.copy(Ue))},reset:function(){ce=!1,je=null,dt.set(-1,0,0,0)}}}function n(){let ce=!1,Ue=!1,je=null,dt=null,Bt=null;return{setReversed:function(bt){if(Ue!==bt){const Ut=e.get("EXT_clip_control");Ue?Ut.clipControlEXT(Ut.LOWER_LEFT_EXT,Ut.ZERO_TO_ONE_EXT):Ut.clipControlEXT(Ut.LOWER_LEFT_EXT,Ut.NEGATIVE_ONE_TO_ONE_EXT);const di=Bt;Bt=null,this.setClear(di)}Ue=bt},getReversed:function(){return Ue},setTest:function(bt){bt?Xe(r.DEPTH_TEST):$e(r.DEPTH_TEST)},setMask:function(bt){je!==bt&&!ce&&(r.depthMask(bt),je=bt)},setFunc:function(bt){if(Ue&&(bt=ote[bt]),dt!==bt){switch(bt){case uC:r.depthFunc(r.NEVER);break;case hC:r.depthFunc(r.ALWAYS);break;case dC:r.depthFunc(r.LESS);break;case rm:r.depthFunc(r.LEQUAL);break;case pC:r.depthFunc(r.EQUAL);break;case fC:r.depthFunc(r.GEQUAL);break;case mC:r.depthFunc(r.GREATER);break;case gC:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}dt=bt}},setLocked:function(bt){ce=bt},setClear:function(bt){Bt!==bt&&(Ue&&(bt=1-bt),r.clearDepth(bt),Bt=bt)},reset:function(){ce=!1,je=null,dt=null,Bt=null,Ue=!1}}}function s(){let ce=!1,Ue=null,je=null,dt=null,Bt=null,bt=null,Ut=null,di=null,br=null;return{setTest:function(Pi){ce||(Pi?Xe(r.STENCIL_TEST):$e(r.STENCIL_TEST))},setMask:function(Pi){Ue!==Pi&&!ce&&(r.stencilMask(Pi),Ue=Pi)},setFunc:function(Pi,fn,Pr){(je!==Pi||dt!==fn||Bt!==Pr)&&(r.stencilFunc(Pi,fn,Pr),je=Pi,dt=fn,Bt=Pr)},setOp:function(Pi,fn,Pr){(bt!==Pi||Ut!==fn||di!==Pr)&&(r.stencilOp(Pi,fn,Pr),bt=Pi,Ut=fn,di=Pr)},setLocked:function(Pi){ce=Pi},setClear:function(Pi){br!==Pi&&(r.clearStencil(Pi),br=Pi)},reset:function(){ce=!1,Ue=null,je=null,dt=null,Bt=null,bt=null,Ut=null,di=null,br=null}}}const o=new i,l=new n,u=new s,c=new WeakMap,d=new WeakMap;let p={},f={},m=new WeakMap,g=[],y=null,x=!1,v=null,_=null,T=null,w=null,S=null,R=null,B=null,I=new wn(0,0,0),D=0,L=!1,O=null,U=null,J=null,H=null,V=null;const $=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Q=!1,G=0;const j=r.getParameter(r.VERSION);j.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(j)[1]),Q=G>=1):j.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(j)[1]),Q=G>=2);let ie=null,Y={};const ae=r.getParameter(r.SCISSOR_BOX),xe=r.getParameter(r.VIEWPORT),fe=new qs().fromArray(ae),de=new qs().fromArray(xe);function Ie(ce,Ue,je,dt){const Bt=new Uint8Array(4),bt=r.createTexture();r.bindTexture(ce,bt),r.texParameteri(ce,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(ce,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let Ut=0;Ut<je;Ut++)ce===r.TEXTURE_3D||ce===r.TEXTURE_2D_ARRAY?r.texImage3D(Ue,0,r.RGBA,1,1,dt,0,r.RGBA,r.UNSIGNED_BYTE,Bt):r.texImage2D(Ue+Ut,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,Bt);return bt}const Ge={};Ge[r.TEXTURE_2D]=Ie(r.TEXTURE_2D,r.TEXTURE_2D,1),Ge[r.TEXTURE_CUBE_MAP]=Ie(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),Ge[r.TEXTURE_2D_ARRAY]=Ie(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),Ge[r.TEXTURE_3D]=Ie(r.TEXTURE_3D,r.TEXTURE_3D,1,1),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),Xe(r.DEPTH_TEST),l.setFunc(rm),hi(!1),Ri(zO),Xe(r.CULL_FACE),Ze(mu);function Xe(ce){p[ce]!==!0&&(r.enable(ce),p[ce]=!0)}function $e(ce){p[ce]!==!1&&(r.disable(ce),p[ce]=!1)}function lt(ce,Ue){return f[ce]!==Ue?(r.bindFramebuffer(ce,Ue),f[ce]=Ue,ce===r.DRAW_FRAMEBUFFER&&(f[r.FRAMEBUFFER]=Ue),ce===r.FRAMEBUFFER&&(f[r.DRAW_FRAMEBUFFER]=Ue),!0):!1}function At(ce,Ue){let je=g,dt=!1;if(ce){je=m.get(Ue),je===void 0&&(je=[],m.set(Ue,je));const Bt=ce.textures;if(je.length!==Bt.length||je[0]!==r.COLOR_ATTACHMENT0){for(let bt=0,Ut=Bt.length;bt<Ut;bt++)je[bt]=r.COLOR_ATTACHMENT0+bt;je.length=Bt.length,dt=!0}}else je[0]!==r.BACK&&(je[0]=r.BACK,dt=!0);dt&&r.drawBuffers(je)}function Gt(ce){return y!==ce?(r.useProgram(ce),y=ce,!0):!1}const gt={[$d]:r.FUNC_ADD,[hY]:r.FUNC_SUBTRACT,[dY]:r.FUNC_REVERSE_SUBTRACT};gt[pY]=r.MIN,gt[fY]=r.MAX;const yi={[mY]:r.ZERO,[gY]:r.ONE,[AY]:r.SRC_COLOR,[lC]:r.SRC_ALPHA,[EY]:r.SRC_ALPHA_SATURATE,[bY]:r.DST_COLOR,[vY]:r.DST_ALPHA,[yY]:r.ONE_MINUS_SRC_COLOR,[cC]:r.ONE_MINUS_SRC_ALPHA,[_Y]:r.ONE_MINUS_DST_COLOR,[xY]:r.ONE_MINUS_DST_ALPHA,[wY]:r.CONSTANT_COLOR,[CY]:r.ONE_MINUS_CONSTANT_COLOR,[SY]:r.CONSTANT_ALPHA,[TY]:r.ONE_MINUS_CONSTANT_ALPHA};function Ze(ce,Ue,je,dt,Bt,bt,Ut,di,br,Pi){if(ce===mu){x===!0&&($e(r.BLEND),x=!1);return}if(x===!1&&(Xe(r.BLEND),x=!0),ce!==uY){if(ce!==v||Pi!==L){if((_!==$d||S!==$d)&&(r.blendEquation(r.FUNC_ADD),_=$d,S=$d),Pi)switch(ce){case im:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case VO:r.blendFunc(r.ONE,r.ONE);break;case GO:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case HO:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}else switch(ce){case im:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case VO:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case GO:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case HO:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}T=null,w=null,R=null,B=null,I.set(0,0,0),D=0,v=ce,L=Pi}return}Bt=Bt||Ue,bt=bt||je,Ut=Ut||dt,(Ue!==_||Bt!==S)&&(r.blendEquationSeparate(gt[Ue],gt[Bt]),_=Ue,S=Bt),(je!==T||dt!==w||bt!==R||Ut!==B)&&(r.blendFuncSeparate(yi[je],yi[dt],yi[bt],yi[Ut]),T=je,w=dt,R=bt,B=Ut),(di.equals(I)===!1||br!==D)&&(r.blendColor(di.r,di.g,di.b,br),I.copy(di),D=br),v=ce,L=!1}function ki(ce,Ue){ce.side===fu?$e(r.CULL_FACE):Xe(r.CULL_FACE);let je=ce.side===ho;Ue&&(je=!je),hi(je),ce.blending===im&&ce.transparent===!1?Ze(mu):Ze(ce.blending,ce.blendEquation,ce.blendSrc,ce.blendDst,ce.blendEquationAlpha,ce.blendSrcAlpha,ce.blendDstAlpha,ce.blendColor,ce.blendAlpha,ce.premultipliedAlpha),l.setFunc(ce.depthFunc),l.setTest(ce.depthTest),l.setMask(ce.depthWrite),o.setMask(ce.colorWrite);const dt=ce.stencilWrite;u.setTest(dt),dt&&(u.setMask(ce.stencilWriteMask),u.setFunc(ce.stencilFunc,ce.stencilRef,ce.stencilFuncMask),u.setOp(ce.stencilFail,ce.stencilZFail,ce.stencilZPass)),tr(ce.polygonOffset,ce.polygonOffsetFactor,ce.polygonOffsetUnits),ce.alphaToCoverage===!0?Xe(r.SAMPLE_ALPHA_TO_COVERAGE):$e(r.SAMPLE_ALPHA_TO_COVERAGE)}function hi(ce){O!==ce&&(ce?r.frontFace(r.CW):r.frontFace(r.CCW),O=ce)}function Ri(ce){ce!==oY?(Xe(r.CULL_FACE),ce!==U&&(ce===zO?r.cullFace(r.BACK):ce===lY?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):$e(r.CULL_FACE),U=ce}function Si(ce){ce!==J&&(Q&&r.lineWidth(ce),J=ce)}function tr(ce,Ue,je){ce?(Xe(r.POLYGON_OFFSET_FILL),(H!==Ue||V!==je)&&(r.polygonOffset(Ue,je),H=Ue,V=je)):$e(r.POLYGON_OFFSET_FILL)}function Vi(ce){ce?Xe(r.SCISSOR_TEST):$e(r.SCISSOR_TEST)}function Qe(ce){ce===void 0&&(ce=r.TEXTURE0+$-1),ie!==ce&&(r.activeTexture(ce),ie=ce)}function Ce(ce,Ue,je){je===void 0&&(ie===null?je=r.TEXTURE0+$-1:je=ie);let dt=Y[je];dt===void 0&&(dt={type:void 0,texture:void 0},Y[je]=dt),(dt.type!==ce||dt.texture!==Ue)&&(ie!==je&&(r.activeTexture(je),ie=je),r.bindTexture(ce,Ue||Ge[ce]),dt.type=ce,dt.texture=Ue)}function yt(){const ce=Y[ie];ce!==void 0&&ce.type!==void 0&&(r.bindTexture(ce.type,null),ce.type=void 0,ce.texture=void 0)}function Ot(){try{r.compressedTexImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Jt(){try{r.compressedTexImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function zt(){try{r.texSubImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function xi(){try{r.texSubImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function vt(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function ye(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function ve(){try{r.texStorage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Le(){try{r.texStorage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Te(){try{r.texImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Fe(){try{r.texImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Pe(ce){fe.equals(ce)===!1&&(r.scissor(ce.x,ce.y,ce.z,ce.w),fe.copy(ce))}function k(ce){de.equals(ce)===!1&&(r.viewport(ce.x,ce.y,ce.z,ce.w),de.copy(ce))}function Z(ce,Ue){let je=d.get(Ue);je===void 0&&(je=new WeakMap,d.set(Ue,je));let dt=je.get(ce);dt===void 0&&(dt=r.getUniformBlockIndex(Ue,ce.name),je.set(ce,dt))}function re(ce,Ue){const je=d.get(Ue).get(ce);c.get(Ue)!==je&&(r.uniformBlockBinding(Ue,je,ce.__bindingPointIndex),c.set(Ue,je))}function Re(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),l.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),p={},ie=null,Y={},f={},m=new WeakMap,g=[],y=null,x=!1,v=null,_=null,T=null,w=null,S=null,R=null,B=null,I=new wn(0,0,0),D=0,L=!1,O=null,U=null,J=null,H=null,V=null,fe.set(0,0,r.canvas.width,r.canvas.height),de.set(0,0,r.canvas.width,r.canvas.height),o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:Xe,disable:$e,bindFramebuffer:lt,drawBuffers:At,useProgram:Gt,setBlending:Ze,setMaterial:ki,setFlipSided:hi,setCullFace:Ri,setLineWidth:Si,setPolygonOffset:tr,setScissorTest:Vi,activeTexture:Qe,bindTexture:Ce,unbindTexture:yt,compressedTexImage2D:Ot,compressedTexImage3D:Jt,texImage2D:Te,texImage3D:Fe,updateUBOMapping:Z,uniformBlockBinding:re,texStorage2D:ve,texStorage3D:Le,texSubImage2D:zt,texSubImage3D:xi,compressedTexSubImage2D:vt,compressedTexSubImage3D:ye,scissor:Pe,viewport:k,reset:Re}}function p4(r,e,i,n){const s=cte(n);switch(i){case YO:return r*e;case JO:return r*e;case ZO:return r*e*2;case $O:return r*e/s.components*s.byteLength;case SC:return r*e/s.components*s.byteLength;case eP:return r*e*2/s.components*s.byteLength;case TC:return r*e*2/s.components*s.byteLength;case KO:return r*e*3/s.components*s.byteLength;case Jl:return r*e*4/s.components*s.byteLength;case MC:return r*e*4/s.components*s.byteLength;case zx:case jx:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case Vx:case Gx:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case IC:case NC:return Math.max(r,16)*Math.max(e,8)/4;case RC:case BC:return Math.max(r,8)*Math.max(e,8)/2;case LC:case DC:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case OC:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case PC:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case FC:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case kC:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case UC:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case zC:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case jC:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case VC:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case GC:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case HC:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case WC:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case QC:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case qC:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case XC:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case YC:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case Hx:case KC:case JC:return Math.ceil(r/4)*Math.ceil(e/4)*16;case tP:case ZC:return Math.ceil(r/4)*Math.ceil(e/4)*8;case $C:case eS:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function cte(r){switch(r){case gu:case QO:return{byteLength:1,components:1};case tA:case qO:case am:return{byteLength:2,components:1};case wC:case CC:return{byteLength:2,components:4};case ip:case EC:case Au:return{byteLength:4,components:1};case XO:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}function ute(r,e,i,n,s,o,l){const u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),d=new zi,p=new WeakMap;let f;const m=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(Qe,Ce){return g?new OffscreenCanvas(Qe,Ce):sA("canvas")}function x(Qe,Ce,yt){let Ot=1;const Jt=Vi(Qe);if((Jt.width>yt||Jt.height>yt)&&(Ot=yt/Math.max(Jt.width,Jt.height)),Ot<1)if(typeof HTMLImageElement<"u"&&Qe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Qe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Qe instanceof ImageBitmap||typeof VideoFrame<"u"&&Qe instanceof VideoFrame){const zt=Math.floor(Ot*Jt.width),xi=Math.floor(Ot*Jt.height);f===void 0&&(f=y(zt,xi));const vt=Ce?y(zt,xi):f;return vt.width=zt,vt.height=xi,vt.getContext("2d").drawImage(Qe,0,0,zt,xi),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Jt.width+"x"+Jt.height+") to ("+zt+"x"+xi+")."),vt}else return"data"in Qe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Jt.width+"x"+Jt.height+")."),Qe;return Qe}function v(Qe){return Qe.generateMipmaps}function _(Qe){r.generateMipmap(Qe)}function T(Qe){return Qe.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:Qe.isWebGL3DRenderTarget?r.TEXTURE_3D:Qe.isWebGLArrayRenderTarget||Qe.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function w(Qe,Ce,yt,Ot,Jt=!1){if(Qe!==null){if(r[Qe]!==void 0)return r[Qe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Qe+"'")}let zt=Ce;if(Ce===r.RED&&(yt===r.FLOAT&&(zt=r.R32F),yt===r.HALF_FLOAT&&(zt=r.R16F),yt===r.UNSIGNED_BYTE&&(zt=r.R8)),Ce===r.RED_INTEGER&&(yt===r.UNSIGNED_BYTE&&(zt=r.R8UI),yt===r.UNSIGNED_SHORT&&(zt=r.R16UI),yt===r.UNSIGNED_INT&&(zt=r.R32UI),yt===r.BYTE&&(zt=r.R8I),yt===r.SHORT&&(zt=r.R16I),yt===r.INT&&(zt=r.R32I)),Ce===r.RG&&(yt===r.FLOAT&&(zt=r.RG32F),yt===r.HALF_FLOAT&&(zt=r.RG16F),yt===r.UNSIGNED_BYTE&&(zt=r.RG8)),Ce===r.RG_INTEGER&&(yt===r.UNSIGNED_BYTE&&(zt=r.RG8UI),yt===r.UNSIGNED_SHORT&&(zt=r.RG16UI),yt===r.UNSIGNED_INT&&(zt=r.RG32UI),yt===r.BYTE&&(zt=r.RG8I),yt===r.SHORT&&(zt=r.RG16I),yt===r.INT&&(zt=r.RG32I)),Ce===r.RGB_INTEGER&&(yt===r.UNSIGNED_BYTE&&(zt=r.RGB8UI),yt===r.UNSIGNED_SHORT&&(zt=r.RGB16UI),yt===r.UNSIGNED_INT&&(zt=r.RGB32UI),yt===r.BYTE&&(zt=r.RGB8I),yt===r.SHORT&&(zt=r.RGB16I),yt===r.INT&&(zt=r.RGB32I)),Ce===r.RGBA_INTEGER&&(yt===r.UNSIGNED_BYTE&&(zt=r.RGBA8UI),yt===r.UNSIGNED_SHORT&&(zt=r.RGBA16UI),yt===r.UNSIGNED_INT&&(zt=r.RGBA32UI),yt===r.BYTE&&(zt=r.RGBA8I),yt===r.SHORT&&(zt=r.RGBA16I),yt===r.INT&&(zt=r.RGBA32I)),Ce===r.RGB&&yt===r.UNSIGNED_INT_5_9_9_9_REV&&(zt=r.RGB9_E5),Ce===r.RGBA){const xi=Jt?Wx:Pn.getTransfer(Ot);yt===r.FLOAT&&(zt=r.RGBA32F),yt===r.HALF_FLOAT&&(zt=r.RGBA16F),yt===r.UNSIGNED_BYTE&&(zt=xi===ss?r.SRGB8_ALPHA8:r.RGBA8),yt===r.UNSIGNED_SHORT_4_4_4_4&&(zt=r.RGBA4),yt===r.UNSIGNED_SHORT_5_5_5_1&&(zt=r.RGB5_A1)}return(zt===r.R16F||zt===r.R32F||zt===r.RG16F||zt===r.RG32F||zt===r.RGBA16F||zt===r.RGBA32F)&&e.get("EXT_color_buffer_float"),zt}function S(Qe,Ce){let yt;return Qe?Ce===null||Ce===ip||Ce===om?yt=r.DEPTH24_STENCIL8:Ce===Au?yt=r.DEPTH32F_STENCIL8:Ce===tA&&(yt=r.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Ce===null||Ce===ip||Ce===om?yt=r.DEPTH_COMPONENT24:Ce===Au?yt=r.DEPTH_COMPONENT32F:Ce===tA&&(yt=r.DEPTH_COMPONENT16),yt}function R(Qe,Ce){return v(Qe)===!0||Qe.isFramebufferTexture&&Qe.minFilter!==Kl&&Qe.minFilter!==Bc?Math.log2(Math.max(Ce.width,Ce.height))+1:Qe.mipmaps!==void 0&&Qe.mipmaps.length>0?Qe.mipmaps.length:Qe.isCompressedTexture&&Array.isArray(Qe.image)?Ce.mipmaps.length:1}function B(Qe){const Ce=Qe.target;Ce.removeEventListener("dispose",B),D(Ce),Ce.isVideoTexture&&p.delete(Ce)}function I(Qe){const Ce=Qe.target;Ce.removeEventListener("dispose",I),O(Ce)}function D(Qe){const Ce=n.get(Qe);if(Ce.__webglInit===void 0)return;const yt=Qe.source,Ot=m.get(yt);if(Ot){const Jt=Ot[Ce.__cacheKey];Jt.usedTimes--,Jt.usedTimes===0&&L(Qe),Object.keys(Ot).length===0&&m.delete(yt)}n.remove(Qe)}function L(Qe){const Ce=n.get(Qe);r.deleteTexture(Ce.__webglTexture);const yt=Qe.source,Ot=m.get(yt);delete Ot[Ce.__cacheKey],l.memory.textures--}function O(Qe){const Ce=n.get(Qe);if(Qe.depthTexture&&(Qe.depthTexture.dispose(),n.remove(Qe.depthTexture)),Qe.isWebGLCubeRenderTarget)for(let Ot=0;Ot<6;Ot++){if(Array.isArray(Ce.__webglFramebuffer[Ot]))for(let Jt=0;Jt<Ce.__webglFramebuffer[Ot].length;Jt++)r.deleteFramebuffer(Ce.__webglFramebuffer[Ot][Jt]);else r.deleteFramebuffer(Ce.__webglFramebuffer[Ot]);Ce.__webglDepthbuffer&&r.deleteRenderbuffer(Ce.__webglDepthbuffer[Ot])}else{if(Array.isArray(Ce.__webglFramebuffer))for(let Ot=0;Ot<Ce.__webglFramebuffer.length;Ot++)r.deleteFramebuffer(Ce.__webglFramebuffer[Ot]);else r.deleteFramebuffer(Ce.__webglFramebuffer);if(Ce.__webglDepthbuffer&&r.deleteRenderbuffer(Ce.__webglDepthbuffer),Ce.__webglMultisampledFramebuffer&&r.deleteFramebuffer(Ce.__webglMultisampledFramebuffer),Ce.__webglColorRenderbuffer)for(let Ot=0;Ot<Ce.__webglColorRenderbuffer.length;Ot++)Ce.__webglColorRenderbuffer[Ot]&&r.deleteRenderbuffer(Ce.__webglColorRenderbuffer[Ot]);Ce.__webglDepthRenderbuffer&&r.deleteRenderbuffer(Ce.__webglDepthRenderbuffer)}const yt=Qe.textures;for(let Ot=0,Jt=yt.length;Ot<Jt;Ot++){const zt=n.get(yt[Ot]);zt.__webglTexture&&(r.deleteTexture(zt.__webglTexture),l.memory.textures--),n.remove(yt[Ot])}n.remove(Qe)}let U=0;function J(){U=0}function H(){const Qe=U;return Qe>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Qe+" texture units while this GPU supports only "+s.maxTextures),U+=1,Qe}function V(Qe){const Ce=[];return Ce.push(Qe.wrapS),Ce.push(Qe.wrapT),Ce.push(Qe.wrapR||0),Ce.push(Qe.magFilter),Ce.push(Qe.minFilter),Ce.push(Qe.anisotropy),Ce.push(Qe.internalFormat),Ce.push(Qe.format),Ce.push(Qe.type),Ce.push(Qe.generateMipmaps),Ce.push(Qe.premultiplyAlpha),Ce.push(Qe.flipY),Ce.push(Qe.unpackAlignment),Ce.push(Qe.colorSpace),Ce.join()}function $(Qe,Ce){const yt=n.get(Qe);if(Qe.isVideoTexture&&Si(Qe),Qe.isRenderTargetTexture===!1&&Qe.version>0&&yt.__version!==Qe.version){const Ot=Qe.image;if(Ot===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ot.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{de(yt,Qe,Ce);return}}i.bindTexture(r.TEXTURE_2D,yt.__webglTexture,r.TEXTURE0+Ce)}function Q(Qe,Ce){const yt=n.get(Qe);if(Qe.version>0&&yt.__version!==Qe.version){de(yt,Qe,Ce);return}i.bindTexture(r.TEXTURE_2D_ARRAY,yt.__webglTexture,r.TEXTURE0+Ce)}function G(Qe,Ce){const yt=n.get(Qe);if(Qe.version>0&&yt.__version!==Qe.version){de(yt,Qe,Ce);return}i.bindTexture(r.TEXTURE_3D,yt.__webglTexture,r.TEXTURE0+Ce)}function j(Qe,Ce){const yt=n.get(Qe);if(Qe.version>0&&yt.__version!==Qe.version){Ie(yt,Qe,Ce);return}i.bindTexture(r.TEXTURE_CUBE_MAP,yt.__webglTexture,r.TEXTURE0+Ce)}const ie={[xC]:r.REPEAT,[ep]:r.CLAMP_TO_EDGE,[bC]:r.MIRRORED_REPEAT},Y={[Kl]:r.NEAREST,[FY]:r.NEAREST_MIPMAP_NEAREST,[Ux]:r.NEAREST_MIPMAP_LINEAR,[Bc]:r.LINEAR,[_C]:r.LINEAR_MIPMAP_NEAREST,[tp]:r.LINEAR_MIPMAP_LINEAR},ae={[jY]:r.NEVER,[qY]:r.ALWAYS,[VY]:r.LESS,[nP]:r.LEQUAL,[GY]:r.EQUAL,[QY]:r.GEQUAL,[HY]:r.GREATER,[WY]:r.NOTEQUAL};function xe(Qe,Ce){if(Ce.type===Au&&e.has("OES_texture_float_linear")===!1&&(Ce.magFilter===Bc||Ce.magFilter===_C||Ce.magFilter===Ux||Ce.magFilter===tp||Ce.minFilter===Bc||Ce.minFilter===_C||Ce.minFilter===Ux||Ce.minFilter===tp)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(Qe,r.TEXTURE_WRAP_S,ie[Ce.wrapS]),r.texParameteri(Qe,r.TEXTURE_WRAP_T,ie[Ce.wrapT]),(Qe===r.TEXTURE_3D||Qe===r.TEXTURE_2D_ARRAY)&&r.texParameteri(Qe,r.TEXTURE_WRAP_R,ie[Ce.wrapR]),r.texParameteri(Qe,r.TEXTURE_MAG_FILTER,Y[Ce.magFilter]),r.texParameteri(Qe,r.TEXTURE_MIN_FILTER,Y[Ce.minFilter]),Ce.compareFunction&&(r.texParameteri(Qe,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(Qe,r.TEXTURE_COMPARE_FUNC,ae[Ce.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(Ce.magFilter===Kl||Ce.minFilter!==Ux&&Ce.minFilter!==tp||Ce.type===Au&&e.has("OES_texture_float_linear")===!1)return;if(Ce.anisotropy>1||n.get(Ce).__currentAnisotropy){const yt=e.get("EXT_texture_filter_anisotropic");r.texParameterf(Qe,yt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ce.anisotropy,s.getMaxAnisotropy())),n.get(Ce).__currentAnisotropy=Ce.anisotropy}}}function fe(Qe,Ce){let yt=!1;Qe.__webglInit===void 0&&(Qe.__webglInit=!0,Ce.addEventListener("dispose",B));const Ot=Ce.source;let Jt=m.get(Ot);Jt===void 0&&(Jt={},m.set(Ot,Jt));const zt=V(Ce);if(zt!==Qe.__cacheKey){Jt[zt]===void 0&&(Jt[zt]={texture:r.createTexture(),usedTimes:0},l.memory.textures++,yt=!0),Jt[zt].usedTimes++;const xi=Jt[Qe.__cacheKey];xi!==void 0&&(Jt[Qe.__cacheKey].usedTimes--,xi.usedTimes===0&&L(Ce)),Qe.__cacheKey=zt,Qe.__webglTexture=Jt[zt].texture}return yt}function de(Qe,Ce,yt){let Ot=r.TEXTURE_2D;(Ce.isDataArrayTexture||Ce.isCompressedArrayTexture)&&(Ot=r.TEXTURE_2D_ARRAY),Ce.isData3DTexture&&(Ot=r.TEXTURE_3D);const Jt=fe(Qe,Ce),zt=Ce.source;i.bindTexture(Ot,Qe.__webglTexture,r.TEXTURE0+yt);const xi=n.get(zt);if(zt.version!==xi.__version||Jt===!0){i.activeTexture(r.TEXTURE0+yt);const vt=Pn.getPrimaries(Pn.workingColorSpace),ye=Ce.colorSpace===Ph?null:Pn.getPrimaries(Ce.colorSpace),ve=Ce.colorSpace===Ph||vt===ye?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Ce.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ce.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Ce.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,ve);let Le=x(Ce.image,!1,s.maxTextureSize);Le=tr(Ce,Le);const Te=o.convert(Ce.format,Ce.colorSpace),Fe=o.convert(Ce.type);let Pe=w(Ce.internalFormat,Te,Fe,Ce.colorSpace,Ce.isVideoTexture);xe(Ot,Ce);let k;const Z=Ce.mipmaps,re=Ce.isVideoTexture!==!0,Re=xi.__version===void 0||Jt===!0,ce=zt.dataReady,Ue=R(Ce,Le);if(Ce.isDepthTexture)Pe=S(Ce.format===cm,Ce.type),Re&&(re?i.texStorage2D(r.TEXTURE_2D,1,Pe,Le.width,Le.height):i.texImage2D(r.TEXTURE_2D,0,Pe,Le.width,Le.height,0,Te,Fe,null));else if(Ce.isDataTexture)if(Z.length>0){re&&Re&&i.texStorage2D(r.TEXTURE_2D,Ue,Pe,Z[0].width,Z[0].height);for(let je=0,dt=Z.length;je<dt;je++)k=Z[je],re?ce&&i.texSubImage2D(r.TEXTURE_2D,je,0,0,k.width,k.height,Te,Fe,k.data):i.texImage2D(r.TEXTURE_2D,je,Pe,k.width,k.height,0,Te,Fe,k.data);Ce.generateMipmaps=!1}else re?(Re&&i.texStorage2D(r.TEXTURE_2D,Ue,Pe,Le.width,Le.height),ce&&i.texSubImage2D(r.TEXTURE_2D,0,0,0,Le.width,Le.height,Te,Fe,Le.data)):i.texImage2D(r.TEXTURE_2D,0,Pe,Le.width,Le.height,0,Te,Fe,Le.data);else if(Ce.isCompressedTexture)if(Ce.isCompressedArrayTexture){re&&Re&&i.texStorage3D(r.TEXTURE_2D_ARRAY,Ue,Pe,Z[0].width,Z[0].height,Le.depth);for(let je=0,dt=Z.length;je<dt;je++)if(k=Z[je],Ce.format!==Jl)if(Te!==null)if(re){if(ce)if(Ce.layerUpdates.size>0){const Bt=p4(k.width,k.height,Ce.format,Ce.type);for(const bt of Ce.layerUpdates){const Ut=k.data.subarray(bt*Bt/k.data.BYTES_PER_ELEMENT,(bt+1)*Bt/k.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,je,0,0,bt,k.width,k.height,1,Te,Ut)}Ce.clearLayerUpdates()}else i.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,je,0,0,0,k.width,k.height,Le.depth,Te,k.data)}else i.compressedTexImage3D(r.TEXTURE_2D_ARRAY,je,Pe,k.width,k.height,Le.depth,0,k.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else re?ce&&i.texSubImage3D(r.TEXTURE_2D_ARRAY,je,0,0,0,k.width,k.height,Le.depth,Te,Fe,k.data):i.texImage3D(r.TEXTURE_2D_ARRAY,je,Pe,k.width,k.height,Le.depth,0,Te,Fe,k.data)}else{re&&Re&&i.texStorage2D(r.TEXTURE_2D,Ue,Pe,Z[0].width,Z[0].height);for(let je=0,dt=Z.length;je<dt;je++)k=Z[je],Ce.format!==Jl?Te!==null?re?ce&&i.compressedTexSubImage2D(r.TEXTURE_2D,je,0,0,k.width,k.height,Te,k.data):i.compressedTexImage2D(r.TEXTURE_2D,je,Pe,k.width,k.height,0,k.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):re?ce&&i.texSubImage2D(r.TEXTURE_2D,je,0,0,k.width,k.height,Te,Fe,k.data):i.texImage2D(r.TEXTURE_2D,je,Pe,k.width,k.height,0,Te,Fe,k.data)}else if(Ce.isDataArrayTexture)if(re){if(Re&&i.texStorage3D(r.TEXTURE_2D_ARRAY,Ue,Pe,Le.width,Le.height,Le.depth),ce)if(Ce.layerUpdates.size>0){const je=p4(Le.width,Le.height,Ce.format,Ce.type);for(const dt of Ce.layerUpdates){const Bt=Le.data.subarray(dt*je/Le.data.BYTES_PER_ELEMENT,(dt+1)*je/Le.data.BYTES_PER_ELEMENT);i.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,dt,Le.width,Le.height,1,Te,Fe,Bt)}Ce.clearLayerUpdates()}else i.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,Le.width,Le.height,Le.depth,Te,Fe,Le.data)}else i.texImage3D(r.TEXTURE_2D_ARRAY,0,Pe,Le.width,Le.height,Le.depth,0,Te,Fe,Le.data);else if(Ce.isData3DTexture)re?(Re&&i.texStorage3D(r.TEXTURE_3D,Ue,Pe,Le.width,Le.height,Le.depth),ce&&i.texSubImage3D(r.TEXTURE_3D,0,0,0,0,Le.width,Le.height,Le.depth,Te,Fe,Le.data)):i.texImage3D(r.TEXTURE_3D,0,Pe,Le.width,Le.height,Le.depth,0,Te,Fe,Le.data);else if(Ce.isFramebufferTexture){if(Re)if(re)i.texStorage2D(r.TEXTURE_2D,Ue,Pe,Le.width,Le.height);else{let je=Le.width,dt=Le.height;for(let Bt=0;Bt<Ue;Bt++)i.texImage2D(r.TEXTURE_2D,Bt,Pe,je,dt,0,Te,Fe,null),je>>=1,dt>>=1}}else if(Z.length>0){if(re&&Re){const je=Vi(Z[0]);i.texStorage2D(r.TEXTURE_2D,Ue,Pe,je.width,je.height)}for(let je=0,dt=Z.length;je<dt;je++)k=Z[je],re?ce&&i.texSubImage2D(r.TEXTURE_2D,je,0,0,Te,Fe,k):i.texImage2D(r.TEXTURE_2D,je,Pe,Te,Fe,k);Ce.generateMipmaps=!1}else if(re){if(Re){const je=Vi(Le);i.texStorage2D(r.TEXTURE_2D,Ue,Pe,je.width,je.height)}ce&&i.texSubImage2D(r.TEXTURE_2D,0,0,0,Te,Fe,Le)}else i.texImage2D(r.TEXTURE_2D,0,Pe,Te,Fe,Le);v(Ce)&&_(Ot),xi.__version=zt.version,Ce.onUpdate&&Ce.onUpdate(Ce)}Qe.__version=Ce.version}function Ie(Qe,Ce,yt){if(Ce.image.length!==6)return;const Ot=fe(Qe,Ce),Jt=Ce.source;i.bindTexture(r.TEXTURE_CUBE_MAP,Qe.__webglTexture,r.TEXTURE0+yt);const zt=n.get(Jt);if(Jt.version!==zt.__version||Ot===!0){i.activeTexture(r.TEXTURE0+yt);const xi=Pn.getPrimaries(Pn.workingColorSpace),vt=Ce.colorSpace===Ph?null:Pn.getPrimaries(Ce.colorSpace),ye=Ce.colorSpace===Ph||xi===vt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Ce.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ce.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Ce.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,ye);const ve=Ce.isCompressedTexture||Ce.image[0].isCompressedTexture,Le=Ce.image[0]&&Ce.image[0].isDataTexture,Te=[];for(let dt=0;dt<6;dt++)!ve&&!Le?Te[dt]=x(Ce.image[dt],!0,s.maxCubemapSize):Te[dt]=Le?Ce.image[dt].image:Ce.image[dt],Te[dt]=tr(Ce,Te[dt]);const Fe=Te[0],Pe=o.convert(Ce.format,Ce.colorSpace),k=o.convert(Ce.type),Z=w(Ce.internalFormat,Pe,k,Ce.colorSpace),re=Ce.isVideoTexture!==!0,Re=zt.__version===void 0||Ot===!0,ce=Jt.dataReady;let Ue=R(Ce,Fe);xe(r.TEXTURE_CUBE_MAP,Ce);let je;if(ve){re&&Re&&i.texStorage2D(r.TEXTURE_CUBE_MAP,Ue,Z,Fe.width,Fe.height);for(let dt=0;dt<6;dt++){je=Te[dt].mipmaps;for(let Bt=0;Bt<je.length;Bt++){const bt=je[Bt];Ce.format!==Jl?Pe!==null?re?ce&&i.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,Bt,0,0,bt.width,bt.height,Pe,bt.data):i.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,Bt,Z,bt.width,bt.height,0,bt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,Bt,0,0,bt.width,bt.height,Pe,k,bt.data):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,Bt,Z,bt.width,bt.height,0,Pe,k,bt.data)}}}else{if(je=Ce.mipmaps,re&&Re){je.length>0&&Ue++;const dt=Vi(Te[0]);i.texStorage2D(r.TEXTURE_CUBE_MAP,Ue,Z,dt.width,dt.height)}for(let dt=0;dt<6;dt++)if(Le){re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0,0,0,Te[dt].width,Te[dt].height,Pe,k,Te[dt].data):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0,Z,Te[dt].width,Te[dt].height,0,Pe,k,Te[dt].data);for(let Bt=0;Bt<je.length;Bt++){const bt=je[Bt].image[dt].image;re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,Bt+1,0,0,bt.width,bt.height,Pe,k,bt.data):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,Bt+1,Z,bt.width,bt.height,0,Pe,k,bt.data)}}else{re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0,0,0,Pe,k,Te[dt]):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0,Z,Pe,k,Te[dt]);for(let Bt=0;Bt<je.length;Bt++){const bt=je[Bt];re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,Bt+1,0,0,Pe,k,bt.image[dt]):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+dt,Bt+1,Z,Pe,k,bt.image[dt])}}}v(Ce)&&_(r.TEXTURE_CUBE_MAP),zt.__version=Jt.version,Ce.onUpdate&&Ce.onUpdate(Ce)}Qe.__version=Ce.version}function Ge(Qe,Ce,yt,Ot,Jt,zt){const xi=o.convert(yt.format,yt.colorSpace),vt=o.convert(yt.type),ye=w(yt.internalFormat,xi,vt,yt.colorSpace),ve=n.get(Ce),Le=n.get(yt);if(Le.__renderTarget=Ce,!ve.__hasExternalTextures){const Te=Math.max(1,Ce.width>>zt),Fe=Math.max(1,Ce.height>>zt);Jt===r.TEXTURE_3D||Jt===r.TEXTURE_2D_ARRAY?i.texImage3D(Jt,zt,ye,Te,Fe,Ce.depth,0,xi,vt,null):i.texImage2D(Jt,zt,ye,Te,Fe,0,xi,vt,null)}i.bindFramebuffer(r.FRAMEBUFFER,Qe),Ri(Ce)?u.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Ot,Jt,Le.__webglTexture,0,hi(Ce)):(Jt===r.TEXTURE_2D||Jt>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&Jt<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,Ot,Jt,Le.__webglTexture,zt),i.bindFramebuffer(r.FRAMEBUFFER,null)}function Xe(Qe,Ce,yt){if(r.bindRenderbuffer(r.RENDERBUFFER,Qe),Ce.depthBuffer){const Ot=Ce.depthTexture,Jt=Ot&&Ot.isDepthTexture?Ot.type:null,zt=S(Ce.stencilBuffer,Jt),xi=Ce.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,vt=hi(Ce);Ri(Ce)?u.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,vt,zt,Ce.width,Ce.height):yt?r.renderbufferStorageMultisample(r.RENDERBUFFER,vt,zt,Ce.width,Ce.height):r.renderbufferStorage(r.RENDERBUFFER,zt,Ce.width,Ce.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,xi,r.RENDERBUFFER,Qe)}else{const Ot=Ce.textures;for(let Jt=0;Jt<Ot.length;Jt++){const zt=Ot[Jt],xi=o.convert(zt.format,zt.colorSpace),vt=o.convert(zt.type),ye=w(zt.internalFormat,xi,vt,zt.colorSpace),ve=hi(Ce);yt&&Ri(Ce)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,ve,ye,Ce.width,Ce.height):Ri(Ce)?u.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,ve,ye,Ce.width,Ce.height):r.renderbufferStorage(r.RENDERBUFFER,ye,Ce.width,Ce.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function $e(Qe,Ce){if(Ce&&Ce.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(r.FRAMEBUFFER,Qe),!(Ce.depthTexture&&Ce.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const yt=n.get(Ce.depthTexture);yt.__renderTarget=Ce,(!yt.__webglTexture||Ce.depthTexture.image.width!==Ce.width||Ce.depthTexture.image.height!==Ce.height)&&(Ce.depthTexture.image.width=Ce.width,Ce.depthTexture.image.height=Ce.height,Ce.depthTexture.needsUpdate=!0),$(Ce.depthTexture,0);const Ot=yt.__webglTexture,Jt=hi(Ce);if(Ce.depthTexture.format===lm)Ri(Ce)?u.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Ot,0,Jt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Ot,0);else if(Ce.depthTexture.format===cm)Ri(Ce)?u.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Ot,0,Jt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Ot,0);else throw new Error("Unknown depthTexture format")}function lt(Qe){const Ce=n.get(Qe),yt=Qe.isWebGLCubeRenderTarget===!0;if(Ce.__boundDepthTexture!==Qe.depthTexture){const Ot=Qe.depthTexture;if(Ce.__depthDisposeCallback&&Ce.__depthDisposeCallback(),Ot){const Jt=()=>{delete Ce.__boundDepthTexture,delete Ce.__depthDisposeCallback,Ot.removeEventListener("dispose",Jt)};Ot.addEventListener("dispose",Jt),Ce.__depthDisposeCallback=Jt}Ce.__boundDepthTexture=Ot}if(Qe.depthTexture&&!Ce.__autoAllocateDepthBuffer){if(yt)throw new Error("target.depthTexture not supported in Cube render targets");$e(Ce.__webglFramebuffer,Qe)}else if(yt){Ce.__webglDepthbuffer=[];for(let Ot=0;Ot<6;Ot++)if(i.bindFramebuffer(r.FRAMEBUFFER,Ce.__webglFramebuffer[Ot]),Ce.__webglDepthbuffer[Ot]===void 0)Ce.__webglDepthbuffer[Ot]=r.createRenderbuffer(),Xe(Ce.__webglDepthbuffer[Ot],Qe,!1);else{const Jt=Qe.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,zt=Ce.__webglDepthbuffer[Ot];r.bindRenderbuffer(r.RENDERBUFFER,zt),r.framebufferRenderbuffer(r.FRAMEBUFFER,Jt,r.RENDERBUFFER,zt)}}else if(i.bindFramebuffer(r.FRAMEBUFFER,Ce.__webglFramebuffer),Ce.__webglDepthbuffer===void 0)Ce.__webglDepthbuffer=r.createRenderbuffer(),Xe(Ce.__webglDepthbuffer,Qe,!1);else{const Ot=Qe.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Jt=Ce.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,Jt),r.framebufferRenderbuffer(r.FRAMEBUFFER,Ot,r.RENDERBUFFER,Jt)}i.bindFramebuffer(r.FRAMEBUFFER,null)}function At(Qe,Ce,yt){const Ot=n.get(Qe);Ce!==void 0&&Ge(Ot.__webglFramebuffer,Qe,Qe.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),yt!==void 0&&lt(Qe)}function Gt(Qe){const Ce=Qe.texture,yt=n.get(Qe),Ot=n.get(Ce);Qe.addEventListener("dispose",I);const Jt=Qe.textures,zt=Qe.isWebGLCubeRenderTarget===!0,xi=Jt.length>1;if(xi||(Ot.__webglTexture===void 0&&(Ot.__webglTexture=r.createTexture()),Ot.__version=Ce.version,l.memory.textures++),zt){yt.__webglFramebuffer=[];for(let vt=0;vt<6;vt++)if(Ce.mipmaps&&Ce.mipmaps.length>0){yt.__webglFramebuffer[vt]=[];for(let ye=0;ye<Ce.mipmaps.length;ye++)yt.__webglFramebuffer[vt][ye]=r.createFramebuffer()}else yt.__webglFramebuffer[vt]=r.createFramebuffer()}else{if(Ce.mipmaps&&Ce.mipmaps.length>0){yt.__webglFramebuffer=[];for(let vt=0;vt<Ce.mipmaps.length;vt++)yt.__webglFramebuffer[vt]=r.createFramebuffer()}else yt.__webglFramebuffer=r.createFramebuffer();if(xi)for(let vt=0,ye=Jt.length;vt<ye;vt++){const ve=n.get(Jt[vt]);ve.__webglTexture===void 0&&(ve.__webglTexture=r.createTexture(),l.memory.textures++)}if(Qe.samples>0&&Ri(Qe)===!1){yt.__webglMultisampledFramebuffer=r.createFramebuffer(),yt.__webglColorRenderbuffer=[],i.bindFramebuffer(r.FRAMEBUFFER,yt.__webglMultisampledFramebuffer);for(let vt=0;vt<Jt.length;vt++){const ye=Jt[vt];yt.__webglColorRenderbuffer[vt]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,yt.__webglColorRenderbuffer[vt]);const ve=o.convert(ye.format,ye.colorSpace),Le=o.convert(ye.type),Te=w(ye.internalFormat,ve,Le,ye.colorSpace,Qe.isXRRenderTarget===!0),Fe=hi(Qe);r.renderbufferStorageMultisample(r.RENDERBUFFER,Fe,Te,Qe.width,Qe.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+vt,r.RENDERBUFFER,yt.__webglColorRenderbuffer[vt])}r.bindRenderbuffer(r.RENDERBUFFER,null),Qe.depthBuffer&&(yt.__webglDepthRenderbuffer=r.createRenderbuffer(),Xe(yt.__webglDepthRenderbuffer,Qe,!0)),i.bindFramebuffer(r.FRAMEBUFFER,null)}}if(zt){i.bindTexture(r.TEXTURE_CUBE_MAP,Ot.__webglTexture),xe(r.TEXTURE_CUBE_MAP,Ce);for(let vt=0;vt<6;vt++)if(Ce.mipmaps&&Ce.mipmaps.length>0)for(let ye=0;ye<Ce.mipmaps.length;ye++)Ge(yt.__webglFramebuffer[vt][ye],Qe,Ce,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+vt,ye);else Ge(yt.__webglFramebuffer[vt],Qe,Ce,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+vt,0);v(Ce)&&_(r.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(xi){for(let vt=0,ye=Jt.length;vt<ye;vt++){const ve=Jt[vt],Le=n.get(ve);i.bindTexture(r.TEXTURE_2D,Le.__webglTexture),xe(r.TEXTURE_2D,ve),Ge(yt.__webglFramebuffer,Qe,ve,r.COLOR_ATTACHMENT0+vt,r.TEXTURE_2D,0),v(ve)&&_(r.TEXTURE_2D)}i.unbindTexture()}else{let vt=r.TEXTURE_2D;if((Qe.isWebGL3DRenderTarget||Qe.isWebGLArrayRenderTarget)&&(vt=Qe.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),i.bindTexture(vt,Ot.__webglTexture),xe(vt,Ce),Ce.mipmaps&&Ce.mipmaps.length>0)for(let ye=0;ye<Ce.mipmaps.length;ye++)Ge(yt.__webglFramebuffer[ye],Qe,Ce,r.COLOR_ATTACHMENT0,vt,ye);else Ge(yt.__webglFramebuffer,Qe,Ce,r.COLOR_ATTACHMENT0,vt,0);v(Ce)&&_(vt),i.unbindTexture()}Qe.depthBuffer&&lt(Qe)}function gt(Qe){const Ce=Qe.textures;for(let yt=0,Ot=Ce.length;yt<Ot;yt++){const Jt=Ce[yt];if(v(Jt)){const zt=T(Qe),xi=n.get(Jt).__webglTexture;i.bindTexture(zt,xi),_(zt),i.unbindTexture()}}}const yi=[],Ze=[];function ki(Qe){if(Qe.samples>0){if(Ri(Qe)===!1){const Ce=Qe.textures,yt=Qe.width,Ot=Qe.height;let Jt=r.COLOR_BUFFER_BIT;const zt=Qe.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,xi=n.get(Qe),vt=Ce.length>1;if(vt)for(let ye=0;ye<Ce.length;ye++)i.bindFramebuffer(r.FRAMEBUFFER,xi.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ye,r.RENDERBUFFER,null),i.bindFramebuffer(r.FRAMEBUFFER,xi.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ye,r.TEXTURE_2D,null,0);i.bindFramebuffer(r.READ_FRAMEBUFFER,xi.__webglMultisampledFramebuffer),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,xi.__webglFramebuffer);for(let ye=0;ye<Ce.length;ye++){if(Qe.resolveDepthBuffer&&(Qe.depthBuffer&&(Jt|=r.DEPTH_BUFFER_BIT),Qe.stencilBuffer&&Qe.resolveStencilBuffer&&(Jt|=r.STENCIL_BUFFER_BIT)),vt){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,xi.__webglColorRenderbuffer[ye]);const ve=n.get(Ce[ye]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,ve,0)}r.blitFramebuffer(0,0,yt,Ot,0,0,yt,Ot,Jt,r.NEAREST),c===!0&&(yi.length=0,Ze.length=0,yi.push(r.COLOR_ATTACHMENT0+ye),Qe.depthBuffer&&Qe.resolveDepthBuffer===!1&&(yi.push(zt),Ze.push(zt),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,Ze)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,yi))}if(i.bindFramebuffer(r.READ_FRAMEBUFFER,null),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),vt)for(let ye=0;ye<Ce.length;ye++){i.bindFramebuffer(r.FRAMEBUFFER,xi.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ye,r.RENDERBUFFER,xi.__webglColorRenderbuffer[ye]);const ve=n.get(Ce[ye]).__webglTexture;i.bindFramebuffer(r.FRAMEBUFFER,xi.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ye,r.TEXTURE_2D,ve,0)}i.bindFramebuffer(r.DRAW_FRAMEBUFFER,xi.__webglMultisampledFramebuffer)}else if(Qe.depthBuffer&&Qe.resolveDepthBuffer===!1&&c){const Ce=Qe.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[Ce])}}}function hi(Qe){return Math.min(s.maxSamples,Qe.samples)}function Ri(Qe){const Ce=n.get(Qe);return Qe.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Ce.__useRenderToTexture!==!1}function Si(Qe){const Ce=l.render.frame;p.get(Qe)!==Ce&&(p.set(Qe,Ce),Qe.update())}function tr(Qe,Ce){const yt=Qe.colorSpace,Ot=Qe.format,Jt=Qe.type;return Qe.isCompressedTexture===!0||Qe.isVideoTexture===!0||yt!==um&&yt!==Ph&&(Pn.getTransfer(yt)===ss?(Ot!==Jl||Jt!==gu)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",yt)),Ce}function Vi(Qe){return typeof HTMLImageElement<"u"&&Qe instanceof HTMLImageElement?(d.width=Qe.naturalWidth||Qe.width,d.height=Qe.naturalHeight||Qe.height):typeof VideoFrame<"u"&&Qe instanceof VideoFrame?(d.width=Qe.displayWidth,d.height=Qe.displayHeight):(d.width=Qe.width,d.height=Qe.height),d}this.allocateTextureUnit=H,this.resetTextureUnits=J,this.setTexture2D=$,this.setTexture2DArray=Q,this.setTexture3D=G,this.setTextureCube=j,this.rebindTextures=At,this.setupRenderTarget=Gt,this.updateRenderTargetMipmap=gt,this.updateMultisampleRenderTarget=ki,this.setupDepthRenderbuffer=lt,this.setupFrameBufferTexture=Ge,this.useMultisampledRTT=Ri}function hte(r,e){function i(n,s=Ph){let o;const l=Pn.getTransfer(s);if(n===gu)return r.UNSIGNED_BYTE;if(n===wC)return r.UNSIGNED_SHORT_4_4_4_4;if(n===CC)return r.UNSIGNED_SHORT_5_5_5_1;if(n===XO)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===QO)return r.BYTE;if(n===qO)return r.SHORT;if(n===tA)return r.UNSIGNED_SHORT;if(n===EC)return r.INT;if(n===ip)return r.UNSIGNED_INT;if(n===Au)return r.FLOAT;if(n===am)return r.HALF_FLOAT;if(n===YO)return r.ALPHA;if(n===KO)return r.RGB;if(n===Jl)return r.RGBA;if(n===JO)return r.LUMINANCE;if(n===ZO)return r.LUMINANCE_ALPHA;if(n===lm)return r.DEPTH_COMPONENT;if(n===cm)return r.DEPTH_STENCIL;if(n===$O)return r.RED;if(n===SC)return r.RED_INTEGER;if(n===eP)return r.RG;if(n===TC)return r.RG_INTEGER;if(n===MC)return r.RGBA_INTEGER;if(n===zx||n===jx||n===Vx||n===Gx)if(l===ss)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(n===zx)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===jx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Vx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Gx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(n===zx)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===jx)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Vx)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Gx)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===RC||n===IC||n===BC||n===NC)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(n===RC)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===IC)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===BC)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===NC)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===LC||n===DC||n===OC)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(n===LC||n===DC)return l===ss?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(n===OC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===PC||n===FC||n===kC||n===UC||n===zC||n===jC||n===VC||n===GC||n===HC||n===WC||n===QC||n===qC||n===XC||n===YC)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(n===PC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===FC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===kC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===UC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===zC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===jC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===VC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===GC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===HC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===WC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===QC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===qC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===XC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===YC)return l===ss?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Hx||n===KC||n===JC)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(n===Hx)return l===ss?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===KC)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===JC)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===tP||n===ZC||n===$C||n===eS)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(n===Hx)return o.COMPRESSED_RED_RGTC1_EXT;if(n===ZC)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===$C)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===eS)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===om?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:i}}class dte extends Ml{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let Im=class extends Xa{constructor(){super(),this.isGroup=!0,this.type="Group"}};const pte={type:"move"};class OS{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Im,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Im,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new at,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new at),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Im,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new at,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new at),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const n of e.hand.values())this._getHandJoint(i,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,n){let s=null,o=null,l=null;const u=this._targetRay,c=this._grip,d=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(d&&e.hand){l=!0;for(const x of e.hand.values()){const v=i.getJointPose(x,n),_=this._getHandJoint(d,x);v!==null&&(_.matrix.fromArray(v.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.matrixWorldNeedsUpdate=!0,_.jointRadius=v.radius),_.visible=v!==null}const p=d.joints["index-finger-tip"],f=d.joints["thumb-tip"],m=p.position.distanceTo(f.position),g=.02,y=.005;d.inputState.pinching&&m>g+y?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&m<=g-y&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(o=i.getPose(e.gripSpace,n),o!==null&&(c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,o.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(o.linearVelocity)):c.hasLinearVelocity=!1,o.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(o.angularVelocity)):c.hasAngularVelocity=!1));u!==null&&(s=i.getPose(e.targetRaySpace,n),s===null&&o!==null&&(s=o),s!==null&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(pte)))}return u!==null&&(u.visible=s!==null),c!==null&&(c.visible=o!==null),d!==null&&(d.visible=l!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const n=new Im;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[i.jointName]=n,e.add(n)}return e.joints[i.jointName]}}const fte=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,mte=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class gte{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,n){if(this.texture===null){const s=new Sl,o=e.properties.get(s);o.__webglTexture=i.texture,(i.depthNear!=n.depthNear||i.depthFar!=n.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const i=e.cameras[0].viewport,n=new Lc({vertexShader:fte,fragmentShader:mte,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new La(new db(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Ate extends rp{constructor(e,i){super();const n=this;let s=null,o=1,l=null,u="local-floor",c=1,d=null,p=null,f=null,m=null,g=null,y=null;const x=new gte,v=i.getContextAttributes();let _=null,T=null;const w=[],S=[],R=new zi;let B=null;const I=new Ml;I.viewport=new qs;const D=new Ml;D.viewport=new qs;const L=[I,D],O=new dte;let U=null,J=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(de){let Ie=w[de];return Ie===void 0&&(Ie=new OS,w[de]=Ie),Ie.getTargetRaySpace()},this.getControllerGrip=function(de){let Ie=w[de];return Ie===void 0&&(Ie=new OS,w[de]=Ie),Ie.getGripSpace()},this.getHand=function(de){let Ie=w[de];return Ie===void 0&&(Ie=new OS,w[de]=Ie),Ie.getHandSpace()};function H(de){const Ie=S.indexOf(de.inputSource);if(Ie===-1)return;const Ge=w[Ie];Ge!==void 0&&(Ge.update(de.inputSource,de.frame,d||l),Ge.dispatchEvent({type:de.type,data:de.inputSource}))}function V(){s.removeEventListener("select",H),s.removeEventListener("selectstart",H),s.removeEventListener("selectend",H),s.removeEventListener("squeeze",H),s.removeEventListener("squeezestart",H),s.removeEventListener("squeezeend",H),s.removeEventListener("end",V),s.removeEventListener("inputsourceschange",$);for(let de=0;de<w.length;de++){const Ie=S[de];Ie!==null&&(S[de]=null,w[de].disconnect(Ie))}U=null,J=null,x.reset(),e.setRenderTarget(_),g=null,m=null,f=null,s=null,T=null,fe.stop(),n.isPresenting=!1,e.setPixelRatio(B),e.setSize(R.width,R.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(de){o=de,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(de){u=de,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||l},this.setReferenceSpace=function(de){d=de},this.getBaseLayer=function(){return m!==null?m:g},this.getBinding=function(){return f},this.getFrame=function(){return y},this.getSession=function(){return s},this.setSession=async function(de){if(s=de,s!==null){if(_=e.getRenderTarget(),s.addEventListener("select",H),s.addEventListener("selectstart",H),s.addEventListener("selectend",H),s.addEventListener("squeeze",H),s.addEventListener("squeezestart",H),s.addEventListener("squeezeend",H),s.addEventListener("end",V),s.addEventListener("inputsourceschange",$),v.xrCompatible!==!0&&await i.makeXRCompatible(),B=e.getPixelRatio(),e.getSize(R),s.renderState.layers===void 0){const Ie={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:o};g=new XRWebGLLayer(s,i,Ie),s.updateRenderState({baseLayer:g}),e.setPixelRatio(1),e.setSize(g.framebufferWidth,g.framebufferHeight,!1),T=new Fh(g.framebufferWidth,g.framebufferHeight,{format:Jl,type:gu,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let Ie=null,Ge=null,Xe=null;v.depth&&(Xe=v.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,Ie=v.stencil?cm:lm,Ge=v.stencil?om:ip);const $e={colorFormat:i.RGBA8,depthFormat:Xe,scaleFactor:o};f=new XRWebGLBinding(s,i),m=f.createProjectionLayer($e),s.updateRenderState({layers:[m]}),e.setPixelRatio(1),e.setSize(m.textureWidth,m.textureHeight,!1),T=new Fh(m.textureWidth,m.textureHeight,{format:Jl,type:gu,depthTexture:new WP(m.textureWidth,m.textureHeight,Ge,void 0,void 0,void 0,void 0,void 0,void 0,Ie),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:m.ignoreDepthValues===!1})}T.isXRRenderTarget=!0,this.setFoveation(c),d=null,l=await s.requestReferenceSpace(u),fe.setContext(s),fe.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return x.getDepthTexture()};function $(de){for(let Ie=0;Ie<de.removed.length;Ie++){const Ge=de.removed[Ie],Xe=S.indexOf(Ge);Xe>=0&&(S[Xe]=null,w[Xe].disconnect(Ge))}for(let Ie=0;Ie<de.added.length;Ie++){const Ge=de.added[Ie];let Xe=S.indexOf(Ge);if(Xe===-1){for(let lt=0;lt<w.length;lt++)if(lt>=S.length){S.push(Ge),Xe=lt;break}else if(S[lt]===null){S[lt]=Ge,Xe=lt;break}if(Xe===-1)break}const $e=w[Xe];$e&&$e.connect(Ge)}}const Q=new at,G=new at;function j(de,Ie,Ge){Q.setFromMatrixPosition(Ie.matrixWorld),G.setFromMatrixPosition(Ge.matrixWorld);const Xe=Q.distanceTo(G),$e=Ie.projectionMatrix.elements,lt=Ge.projectionMatrix.elements,At=$e[14]/($e[10]-1),Gt=$e[14]/($e[10]+1),gt=($e[9]+1)/$e[5],yi=($e[9]-1)/$e[5],Ze=($e[8]-1)/$e[0],ki=(lt[8]+1)/lt[0],hi=At*Ze,Ri=At*ki,Si=Xe/(-Ze+ki),tr=Si*-Ze;if(Ie.matrixWorld.decompose(de.position,de.quaternion,de.scale),de.translateX(tr),de.translateZ(Si),de.matrixWorld.compose(de.position,de.quaternion,de.scale),de.matrixWorldInverse.copy(de.matrixWorld).invert(),$e[10]===-1)de.projectionMatrix.copy(Ie.projectionMatrix),de.projectionMatrixInverse.copy(Ie.projectionMatrixInverse);else{const Vi=At+Si,Qe=Gt+Si,Ce=hi-tr,yt=Ri+(Xe-tr),Ot=gt*Gt/Qe*Vi,Jt=yi*Gt/Qe*Vi;de.projectionMatrix.makePerspective(Ce,yt,Ot,Jt,Vi,Qe),de.projectionMatrixInverse.copy(de.projectionMatrix).invert()}}function ie(de,Ie){Ie===null?de.matrixWorld.copy(de.matrix):de.matrixWorld.multiplyMatrices(Ie.matrixWorld,de.matrix),de.matrixWorldInverse.copy(de.matrixWorld).invert()}this.updateCamera=function(de){if(s===null)return;let Ie=de.near,Ge=de.far;x.texture!==null&&(x.depthNear>0&&(Ie=x.depthNear),x.depthFar>0&&(Ge=x.depthFar)),O.near=D.near=I.near=Ie,O.far=D.far=I.far=Ge,(U!==O.near||J!==O.far)&&(s.updateRenderState({depthNear:O.near,depthFar:O.far}),U=O.near,J=O.far),I.layers.mask=de.layers.mask|2,D.layers.mask=de.layers.mask|4,O.layers.mask=I.layers.mask|D.layers.mask;const Xe=de.parent,$e=O.cameras;ie(O,Xe);for(let lt=0;lt<$e.length;lt++)ie($e[lt],Xe);$e.length===2?j(O,I,D):O.projectionMatrix.copy(I.projectionMatrix),Y(de,O,Xe)};function Y(de,Ie,Ge){Ge===null?de.matrix.copy(Ie.matrixWorld):(de.matrix.copy(Ge.matrixWorld),de.matrix.invert(),de.matrix.multiply(Ie.matrixWorld)),de.matrix.decompose(de.position,de.quaternion,de.scale),de.updateMatrixWorld(!0),de.projectionMatrix.copy(Ie.projectionMatrix),de.projectionMatrixInverse.copy(Ie.projectionMatrixInverse),de.isPerspectiveCamera&&(de.fov=rA*2*Math.atan(1/de.projectionMatrix.elements[5]),de.zoom=1)}this.getCamera=function(){return O},this.getFoveation=function(){if(!(m===null&&g===null))return c},this.setFoveation=function(de){c=de,m!==null&&(m.fixedFoveation=de),g!==null&&g.fixedFoveation!==void 0&&(g.fixedFoveation=de)},this.hasDepthSensing=function(){return x.texture!==null},this.getDepthSensingMesh=function(){return x.getMesh(O)};let ae=null;function xe(de,Ie){if(p=Ie.getViewerPose(d||l),y=Ie,p!==null){const Ge=p.views;g!==null&&(e.setRenderTargetFramebuffer(T,g.framebuffer),e.setRenderTarget(T));let Xe=!1;Ge.length!==O.cameras.length&&(O.cameras.length=0,Xe=!0);for(let lt=0;lt<Ge.length;lt++){const At=Ge[lt];let Gt=null;if(g!==null)Gt=g.getViewport(At);else{const yi=f.getViewSubImage(m,At);Gt=yi.viewport,lt===0&&(e.setRenderTargetTextures(T,yi.colorTexture,m.ignoreDepthValues?void 0:yi.depthStencilTexture),e.setRenderTarget(T))}let gt=L[lt];gt===void 0&&(gt=new Ml,gt.layers.enable(lt),gt.viewport=new qs,L[lt]=gt),gt.matrix.fromArray(At.transform.matrix),gt.matrix.decompose(gt.position,gt.quaternion,gt.scale),gt.projectionMatrix.fromArray(At.projectionMatrix),gt.projectionMatrixInverse.copy(gt.projectionMatrix).invert(),gt.viewport.set(Gt.x,Gt.y,Gt.width,Gt.height),lt===0&&(O.matrix.copy(gt.matrix),O.matrix.decompose(O.position,O.quaternion,O.scale)),Xe===!0&&O.cameras.push(gt)}const $e=s.enabledFeatures;if($e&&$e.includes("depth-sensing")){const lt=f.getDepthInformation(Ge[0]);lt&&lt.isValid&&lt.texture&&x.init(e,lt,s.renderState)}}for(let Ge=0;Ge<w.length;Ge++){const Xe=S[Ge],$e=w[Ge];Xe!==null&&$e!==void 0&&$e.update(Xe,Ie,d||l)}ae&&ae(de,Ie),Ie.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Ie}),y=null}const fe=new FP;fe.setAnimationLoop(xe),this.setAnimationLoop=function(de){ae=de},this.dispose=function(){}}}const fp=new Vh,yte=new ps;function vte(r,e){function i(v,_){v.matrixAutoUpdate===!0&&v.updateMatrix(),_.value.copy(v.matrix)}function n(v,_){_.color.getRGB(v.fogColor.value,BP(r)),_.isFog?(v.fogNear.value=_.near,v.fogFar.value=_.far):_.isFogExp2&&(v.fogDensity.value=_.density)}function s(v,_,T,w,S){_.isMeshBasicMaterial||_.isMeshLambertMaterial?o(v,_):_.isMeshToonMaterial?(o(v,_),f(v,_)):_.isMeshPhongMaterial?(o(v,_),p(v,_)):_.isMeshStandardMaterial?(o(v,_),m(v,_),_.isMeshPhysicalMaterial&&g(v,_,S)):_.isMeshMatcapMaterial?(o(v,_),y(v,_)):_.isMeshDepthMaterial?o(v,_):_.isMeshDistanceMaterial?(o(v,_),x(v,_)):_.isMeshNormalMaterial?o(v,_):_.isLineBasicMaterial?(l(v,_),_.isLineDashedMaterial&&u(v,_)):_.isPointsMaterial?c(v,_,T,w):_.isSpriteMaterial?d(v,_):_.isShadowMaterial?(v.color.value.copy(_.color),v.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}function o(v,_){v.opacity.value=_.opacity,_.color&&v.diffuse.value.copy(_.color),_.emissive&&v.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(v.map.value=_.map,i(_.map,v.mapTransform)),_.alphaMap&&(v.alphaMap.value=_.alphaMap,i(_.alphaMap,v.alphaMapTransform)),_.bumpMap&&(v.bumpMap.value=_.bumpMap,i(_.bumpMap,v.bumpMapTransform),v.bumpScale.value=_.bumpScale,_.side===ho&&(v.bumpScale.value*=-1)),_.normalMap&&(v.normalMap.value=_.normalMap,i(_.normalMap,v.normalMapTransform),v.normalScale.value.copy(_.normalScale),_.side===ho&&v.normalScale.value.negate()),_.displacementMap&&(v.displacementMap.value=_.displacementMap,i(_.displacementMap,v.displacementMapTransform),v.displacementScale.value=_.displacementScale,v.displacementBias.value=_.displacementBias),_.emissiveMap&&(v.emissiveMap.value=_.emissiveMap,i(_.emissiveMap,v.emissiveMapTransform)),_.specularMap&&(v.specularMap.value=_.specularMap,i(_.specularMap,v.specularMapTransform)),_.alphaTest>0&&(v.alphaTest.value=_.alphaTest);const T=e.get(_),w=T.envMap,S=T.envMapRotation;w&&(v.envMap.value=w,fp.copy(S),fp.x*=-1,fp.y*=-1,fp.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(fp.y*=-1,fp.z*=-1),v.envMapRotation.value.setFromMatrix4(yte.makeRotationFromEuler(fp)),v.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=_.reflectivity,v.ior.value=_.ior,v.refractionRatio.value=_.refractionRatio),_.lightMap&&(v.lightMap.value=_.lightMap,v.lightMapIntensity.value=_.lightMapIntensity,i(_.lightMap,v.lightMapTransform)),_.aoMap&&(v.aoMap.value=_.aoMap,v.aoMapIntensity.value=_.aoMapIntensity,i(_.aoMap,v.aoMapTransform))}function l(v,_){v.diffuse.value.copy(_.color),v.opacity.value=_.opacity,_.map&&(v.map.value=_.map,i(_.map,v.mapTransform))}function u(v,_){v.dashSize.value=_.dashSize,v.totalSize.value=_.dashSize+_.gapSize,v.scale.value=_.scale}function c(v,_,T,w){v.diffuse.value.copy(_.color),v.opacity.value=_.opacity,v.size.value=_.size*T,v.scale.value=w*.5,_.map&&(v.map.value=_.map,i(_.map,v.uvTransform)),_.alphaMap&&(v.alphaMap.value=_.alphaMap,i(_.alphaMap,v.alphaMapTransform)),_.alphaTest>0&&(v.alphaTest.value=_.alphaTest)}function d(v,_){v.diffuse.value.copy(_.color),v.opacity.value=_.opacity,v.rotation.value=_.rotation,_.map&&(v.map.value=_.map,i(_.map,v.mapTransform)),_.alphaMap&&(v.alphaMap.value=_.alphaMap,i(_.alphaMap,v.alphaMapTransform)),_.alphaTest>0&&(v.alphaTest.value=_.alphaTest)}function p(v,_){v.specular.value.copy(_.specular),v.shininess.value=Math.max(_.shininess,1e-4)}function f(v,_){_.gradientMap&&(v.gradientMap.value=_.gradientMap)}function m(v,_){v.metalness.value=_.metalness,_.metalnessMap&&(v.metalnessMap.value=_.metalnessMap,i(_.metalnessMap,v.metalnessMapTransform)),v.roughness.value=_.roughness,_.roughnessMap&&(v.roughnessMap.value=_.roughnessMap,i(_.roughnessMap,v.roughnessMapTransform)),_.envMap&&(v.envMapIntensity.value=_.envMapIntensity)}function g(v,_,T){v.ior.value=_.ior,_.sheen>0&&(v.sheenColor.value.copy(_.sheenColor).multiplyScalar(_.sheen),v.sheenRoughness.value=_.sheenRoughness,_.sheenColorMap&&(v.sheenColorMap.value=_.sheenColorMap,i(_.sheenColorMap,v.sheenColorMapTransform)),_.sheenRoughnessMap&&(v.sheenRoughnessMap.value=_.sheenRoughnessMap,i(_.sheenRoughnessMap,v.sheenRoughnessMapTransform))),_.clearcoat>0&&(v.clearcoat.value=_.clearcoat,v.clearcoatRoughness.value=_.clearcoatRoughness,_.clearcoatMap&&(v.clearcoatMap.value=_.clearcoatMap,i(_.clearcoatMap,v.clearcoatMapTransform)),_.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=_.clearcoatRoughnessMap,i(_.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),_.clearcoatNormalMap&&(v.clearcoatNormalMap.value=_.clearcoatNormalMap,i(_.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(_.clearcoatNormalScale),_.side===ho&&v.clearcoatNormalScale.value.negate())),_.dispersion>0&&(v.dispersion.value=_.dispersion),_.iridescence>0&&(v.iridescence.value=_.iridescence,v.iridescenceIOR.value=_.iridescenceIOR,v.iridescenceThicknessMinimum.value=_.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=_.iridescenceThicknessRange[1],_.iridescenceMap&&(v.iridescenceMap.value=_.iridescenceMap,i(_.iridescenceMap,v.iridescenceMapTransform)),_.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=_.iridescenceThicknessMap,i(_.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),_.transmission>0&&(v.transmission.value=_.transmission,v.transmissionSamplerMap.value=T.texture,v.transmissionSamplerSize.value.set(T.width,T.height),_.transmissionMap&&(v.transmissionMap.value=_.transmissionMap,i(_.transmissionMap,v.transmissionMapTransform)),v.thickness.value=_.thickness,_.thicknessMap&&(v.thicknessMap.value=_.thicknessMap,i(_.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=_.attenuationDistance,v.attenuationColor.value.copy(_.attenuationColor)),_.anisotropy>0&&(v.anisotropyVector.value.set(_.anisotropy*Math.cos(_.anisotropyRotation),_.anisotropy*Math.sin(_.anisotropyRotation)),_.anisotropyMap&&(v.anisotropyMap.value=_.anisotropyMap,i(_.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=_.specularIntensity,v.specularColor.value.copy(_.specularColor),_.specularColorMap&&(v.specularColorMap.value=_.specularColorMap,i(_.specularColorMap,v.specularColorMapTransform)),_.specularIntensityMap&&(v.specularIntensityMap.value=_.specularIntensityMap,i(_.specularIntensityMap,v.specularIntensityMapTransform))}function y(v,_){_.matcap&&(v.matcap.value=_.matcap)}function x(v,_){const T=e.get(_).light;v.referencePosition.value.setFromMatrixPosition(T.matrixWorld),v.nearDistance.value=T.shadow.camera.near,v.farDistance.value=T.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function xte(r,e,i,n){let s={},o={},l=[];const u=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function c(T,w){const S=w.program;n.uniformBlockBinding(T,S)}function d(T,w){let S=s[T.id];S===void 0&&(y(T),S=p(T),s[T.id]=S,T.addEventListener("dispose",v));const R=w.program;n.updateUBOMapping(T,R);const B=e.render.frame;o[T.id]!==B&&(m(T),o[T.id]=B)}function p(T){const w=f();T.__bindingPointIndex=w;const S=r.createBuffer(),R=T.__size,B=T.usage;return r.bindBuffer(r.UNIFORM_BUFFER,S),r.bufferData(r.UNIFORM_BUFFER,R,B),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,w,S),S}function f(){for(let T=0;T<u;T++)if(l.indexOf(T)===-1)return l.push(T),T;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(T){const w=s[T.id],S=T.uniforms,R=T.__cache;r.bindBuffer(r.UNIFORM_BUFFER,w);for(let B=0,I=S.length;B<I;B++){const D=Array.isArray(S[B])?S[B]:[S[B]];for(let L=0,O=D.length;L<O;L++){const U=D[L];if(g(U,B,L,R)===!0){const J=U.__offset,H=Array.isArray(U.value)?U.value:[U.value];let V=0;for(let $=0;$<H.length;$++){const Q=H[$],G=x(Q);typeof Q=="number"||typeof Q=="boolean"?(U.__data[0]=Q,r.bufferSubData(r.UNIFORM_BUFFER,J+V,U.__data)):Q.isMatrix3?(U.__data[0]=Q.elements[0],U.__data[1]=Q.elements[1],U.__data[2]=Q.elements[2],U.__data[3]=0,U.__data[4]=Q.elements[3],U.__data[5]=Q.elements[4],U.__data[6]=Q.elements[5],U.__data[7]=0,U.__data[8]=Q.elements[6],U.__data[9]=Q.elements[7],U.__data[10]=Q.elements[8],U.__data[11]=0):(Q.toArray(U.__data,V),V+=G.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,J,U.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function g(T,w,S,R){const B=T.value,I=w+"_"+S;if(R[I]===void 0)return typeof B=="number"||typeof B=="boolean"?R[I]=B:R[I]=B.clone(),!0;{const D=R[I];if(typeof B=="number"||typeof B=="boolean"){if(D!==B)return R[I]=B,!0}else if(D.equals(B)===!1)return D.copy(B),!0}return!1}function y(T){const w=T.uniforms;let S=0;const R=16;for(let I=0,D=w.length;I<D;I++){const L=Array.isArray(w[I])?w[I]:[w[I]];for(let O=0,U=L.length;O<U;O++){const J=L[O],H=Array.isArray(J.value)?J.value:[J.value];for(let V=0,$=H.length;V<$;V++){const Q=H[V],G=x(Q),j=S%R,ie=j%G.boundary,Y=j+ie;S+=ie,Y!==0&&R-Y<G.storage&&(S+=R-Y),J.__data=new Float32Array(G.storage/Float32Array.BYTES_PER_ELEMENT),J.__offset=S,S+=G.storage}}}const B=S%R;return B>0&&(S+=R-B),T.__size=S,T.__cache={},this}function x(T){const w={boundary:0,storage:0};return typeof T=="number"||typeof T=="boolean"?(w.boundary=4,w.storage=4):T.isVector2?(w.boundary=8,w.storage=8):T.isVector3||T.isColor?(w.boundary=16,w.storage=12):T.isVector4?(w.boundary=16,w.storage=16):T.isMatrix3?(w.boundary=48,w.storage=48):T.isMatrix4?(w.boundary=64,w.storage=64):T.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",T),w}function v(T){const w=T.target;w.removeEventListener("dispose",v);const S=l.indexOf(w.__bindingPointIndex);l.splice(S,1),r.deleteBuffer(s[w.id]),delete s[w.id],delete o[w.id]}function _(){for(const T in s)r.deleteBuffer(s[T]);l=[],s={},o={}}return{bind:c,update:d,dispose:_}}class bte{constructor(e={}){const{canvas:i=uK(),context:n=null,depth:s=!0,stencil:o=!1,alpha:l=!1,antialias:u=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:d=!1,powerPreference:p="default",failIfMajorPerformanceCaveat:f=!1,reverseDepthBuffer:m=!1}=e;this.isWebGLRenderer=!0;let g;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");g=n.getContextAttributes().alpha}else g=l;const y=new Uint32Array(4),x=new Int32Array(4);let v=null,_=null;const T=[],w=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Do,this.toneMapping=Oh,this.toneMappingExposure=1;const S=this;let R=!1,B=0,I=0,D=null,L=-1,O=null;const U=new qs,J=new qs;let H=null;const V=new wn(0);let $=0,Q=i.width,G=i.height,j=1,ie=null,Y=null;const ae=new qs(0,0,Q,G),xe=new qs(0,0,Q,G);let fe=!1;const de=new CS;let Ie=!1,Ge=!1;const Xe=new ps,$e=new ps,lt=new at,At=new qs,Gt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let gt=!1;function yi(){return D===null?j:1}let Ze=n;function ki(Be,se){return i.getContext(Be,se)}try{const Be={alpha:!0,depth:s,stencil:o,antialias:u,premultipliedAlpha:c,preserveDrawingBuffer:d,powerPreference:p,failIfMajorPerformanceCaveat:f};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${Fx}`),i.addEventListener("webglcontextlost",dt,!1),i.addEventListener("webglcontextrestored",Bt,!1),i.addEventListener("webglcontextcreationerror",bt,!1),Ze===null){const se="webgl2";if(Ze=ki(se,Be),Ze===null)throw ki(se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Be){throw console.error("THREE.WebGLRenderer: "+Be.message),Be}let hi,Ri,Si,tr,Vi,Qe,Ce,yt,Ot,Jt,zt,xi,vt,ye,ve,Le,Te,Fe,Pe,k,Z,re,Re,ce;function Ue(){hi=new S$(Ze),hi.init(),re=new hte(Ze,hi),Ri=new x$(Ze,hi,e,re),Si=new lte(Ze,hi),Ri.reverseDepthBuffer&&m&&Si.buffers.depth.setReversed(!0),tr=new R$(Ze),Vi=new qee,Qe=new ute(Ze,hi,Si,Vi,Ri,re,tr),Ce=new _$(S),yt=new C$(S),Ot=new PK(Ze),Re=new y$(Ze,Ot),Jt=new T$(Ze,Ot,tr,Re),zt=new B$(Ze,Jt,Ot,tr),Pe=new I$(Ze,Ri,Qe),Le=new b$(Vi),xi=new Qee(S,Ce,yt,hi,Ri,Re,Le),vt=new vte(S,Vi),ye=new Yee,ve=new tte(hi),Fe=new A$(S,Ce,yt,Si,zt,g,c),Te=new ate(S,zt,Ri),ce=new xte(Ze,tr,Ri,Si),k=new v$(Ze,hi,tr),Z=new M$(Ze,hi,tr),tr.programs=xi.programs,S.capabilities=Ri,S.extensions=hi,S.properties=Vi,S.renderLists=ye,S.shadowMap=Te,S.state=Si,S.info=tr}Ue();const je=new Ate(S,Ze);this.xr=je,this.getContext=function(){return Ze},this.getContextAttributes=function(){return Ze.getContextAttributes()},this.forceContextLoss=function(){const Be=hi.get("WEBGL_lose_context");Be&&Be.loseContext()},this.forceContextRestore=function(){const Be=hi.get("WEBGL_lose_context");Be&&Be.restoreContext()},this.getPixelRatio=function(){return j},this.setPixelRatio=function(Be){Be!==void 0&&(j=Be,this.setSize(Q,G,!1))},this.getSize=function(Be){return Be.set(Q,G)},this.setSize=function(Be,se,ge=!0){if(je.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Q=Be,G=se,i.width=Math.floor(Be*j),i.height=Math.floor(se*j),ge===!0&&(i.style.width=Be+"px",i.style.height=se+"px"),this.setViewport(0,0,Be,se)},this.getDrawingBufferSize=function(Be){return Be.set(Q*j,G*j).floor()},this.setDrawingBufferSize=function(Be,se,ge){Q=Be,G=se,j=ge,i.width=Math.floor(Be*ge),i.height=Math.floor(se*ge),this.setViewport(0,0,Be,se)},this.getCurrentViewport=function(Be){return Be.copy(U)},this.getViewport=function(Be){return Be.copy(ae)},this.setViewport=function(Be,se,ge,Ne){Be.isVector4?ae.set(Be.x,Be.y,Be.z,Be.w):ae.set(Be,se,ge,Ne),Si.viewport(U.copy(ae).multiplyScalar(j).round())},this.getScissor=function(Be){return Be.copy(xe)},this.setScissor=function(Be,se,ge,Ne){Be.isVector4?xe.set(Be.x,Be.y,Be.z,Be.w):xe.set(Be,se,ge,Ne),Si.scissor(J.copy(xe).multiplyScalar(j).round())},this.getScissorTest=function(){return fe},this.setScissorTest=function(Be){Si.setScissorTest(fe=Be)},this.setOpaqueSort=function(Be){ie=Be},this.setTransparentSort=function(Be){Y=Be},this.getClearColor=function(Be){return Be.copy(Fe.getClearColor())},this.setClearColor=function(){Fe.setClearColor.apply(Fe,arguments)},this.getClearAlpha=function(){return Fe.getClearAlpha()},this.setClearAlpha=function(){Fe.setClearAlpha.apply(Fe,arguments)},this.clear=function(Be=!0,se=!0,ge=!0){let Ne=0;if(Be){let ke=!1;if(D!==null){const Ke=D.texture.format;ke=Ke===MC||Ke===TC||Ke===SC}if(ke){const Ke=D.texture.type,ot=Ke===gu||Ke===ip||Ke===tA||Ke===om||Ke===wC||Ke===CC,wt=Fe.getClearColor(),qt=Fe.getClearAlpha(),Kt=wt.r,Rt=wt.g,ti=wt.b;ot?(y[0]=Kt,y[1]=Rt,y[2]=ti,y[3]=qt,Ze.clearBufferuiv(Ze.COLOR,0,y)):(x[0]=Kt,x[1]=Rt,x[2]=ti,x[3]=qt,Ze.clearBufferiv(Ze.COLOR,0,x))}else Ne|=Ze.COLOR_BUFFER_BIT}se&&(Ne|=Ze.DEPTH_BUFFER_BIT),ge&&(Ne|=Ze.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ze.clear(Ne)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",dt,!1),i.removeEventListener("webglcontextrestored",Bt,!1),i.removeEventListener("webglcontextcreationerror",bt,!1),ye.dispose(),ve.dispose(),Vi.dispose(),Ce.dispose(),yt.dispose(),zt.dispose(),Re.dispose(),ce.dispose(),xi.dispose(),je.dispose(),je.removeEventListener("sessionstart",tn),je.removeEventListener("sessionend",gs),mn.stop()};function dt(Be){Be.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function Bt(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1;const Be=tr.autoReset,se=Te.enabled,ge=Te.autoUpdate,Ne=Te.needsUpdate,ke=Te.type;Ue(),tr.autoReset=Be,Te.enabled=se,Te.autoUpdate=ge,Te.needsUpdate=Ne,Te.type=ke}function bt(Be){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Be.statusMessage)}function Ut(Be){const se=Be.target;se.removeEventListener("dispose",Ut),di(se)}function di(Be){br(Be),Vi.remove(Be)}function br(Be){const se=Vi.get(Be).programs;se!==void 0&&(se.forEach(function(ge){xi.releaseProgram(ge)}),Be.isShaderMaterial&&xi.releaseShaderCache(Be))}this.renderBufferDirect=function(Be,se,ge,Ne,ke,Ke){se===null&&(se=Gt);const ot=ke.isMesh&&ke.matrixWorld.determinant()<0,wt=sr(Be,se,ge,Ne,ke);Si.setMaterial(Ne,ot);let qt=ge.index,Kt=1;if(Ne.wireframe===!0){if(qt=Jt.getWireframeAttribute(ge),qt===void 0)return;Kt=2}const Rt=ge.drawRange,ti=ge.attributes.position;let bi=Rt.start*Kt,Fi=(Rt.start+Rt.count)*Kt;Ke!==null&&(bi=Math.max(bi,Ke.start*Kt),Fi=Math.min(Fi,(Ke.start+Ke.count)*Kt)),qt!==null?(bi=Math.max(bi,0),Fi=Math.min(Fi,qt.count)):ti!=null&&(bi=Math.max(bi,0),Fi=Math.min(Fi,ti.count));const Cr=Fi-bi;if(Cr<0||Cr===1/0)return;Re.setup(ke,Ne,wt,ge,qt);let ur,Ji=k;if(qt!==null&&(ur=Ot.get(qt),Ji=Z,Ji.setIndex(ur)),ke.isMesh)Ne.wireframe===!0?(Si.setLineWidth(Ne.wireframeLinewidth*yi()),Ji.setMode(Ze.LINES)):Ji.setMode(Ze.TRIANGLES);else if(ke.isLine){let vi=Ne.linewidth;vi===void 0&&(vi=1),Si.setLineWidth(vi*yi()),ke.isLineSegments?Ji.setMode(Ze.LINES):ke.isLineLoop?Ji.setMode(Ze.LINE_LOOP):Ji.setMode(Ze.LINE_STRIP)}else ke.isPoints?Ji.setMode(Ze.POINTS):ke.isSprite&&Ji.setMode(Ze.TRIANGLES);if(ke.isBatchedMesh)if(ke._multiDrawInstances!==null)Ji.renderMultiDrawInstances(ke._multiDrawStarts,ke._multiDrawCounts,ke._multiDrawCount,ke._multiDrawInstances);else if(hi.get("WEBGL_multi_draw"))Ji.renderMultiDraw(ke._multiDrawStarts,ke._multiDrawCounts,ke._multiDrawCount);else{const vi=ke._multiDrawStarts,Tn=ke._multiDrawCounts,qn=ke._multiDrawCount,Mi=qt?Ot.get(qt).bytesPerElement:1,ar=Vi.get(Ne).currentProgram.getUniforms();for(let un=0;un<qn;un++)ar.setValue(Ze,"_gl_DrawID",un),Ji.render(vi[un]/Mi,Tn[un])}else if(ke.isInstancedMesh)Ji.renderInstances(bi,Cr,ke.count);else if(ge.isInstancedBufferGeometry){const vi=ge._maxInstanceCount!==void 0?ge._maxInstanceCount:1/0,Tn=Math.min(ge.instanceCount,vi);Ji.renderInstances(bi,Cr,Tn)}else Ji.render(bi,Cr)};function Pi(Be,se,ge){Be.transparent===!0&&Be.side===fu&&Be.forceSinglePass===!1?(Be.side=ho,Be.needsUpdate=!0,St(Be,se,ge),Be.side=Dh,Be.needsUpdate=!0,St(Be,se,ge),Be.side=fu):St(Be,se,ge)}this.compile=function(Be,se,ge=null){ge===null&&(ge=Be),_=ve.get(ge),_.init(se),w.push(_),ge.traverseVisible(function(ke){ke.isLight&&ke.layers.test(se.layers)&&(_.pushLight(ke),ke.castShadow&&_.pushShadow(ke))}),Be!==ge&&Be.traverseVisible(function(ke){ke.isLight&&ke.layers.test(se.layers)&&(_.pushLight(ke),ke.castShadow&&_.pushShadow(ke))}),_.setupLights();const Ne=new Set;return Be.traverse(function(ke){if(!(ke.isMesh||ke.isPoints||ke.isLine||ke.isSprite))return;const Ke=ke.material;if(Ke)if(Array.isArray(Ke))for(let ot=0;ot<Ke.length;ot++){const wt=Ke[ot];Pi(wt,ge,ke),Ne.add(wt)}else Pi(Ke,ge,ke),Ne.add(Ke)}),w.pop(),_=null,Ne},this.compileAsync=function(Be,se,ge=null){const Ne=this.compile(Be,se,ge);return new Promise(ke=>{function Ke(){if(Ne.forEach(function(ot){Vi.get(ot).currentProgram.isReady()&&Ne.delete(ot)}),Ne.size===0){ke(Be);return}setTimeout(Ke,10)}hi.get("KHR_parallel_shader_compile")!==null?Ke():setTimeout(Ke,10)})};let fn=null;function Pr(Be){fn&&fn(Be)}function tn(){mn.stop()}function gs(){mn.start()}const mn=new FP;mn.setAnimationLoop(Pr),typeof self<"u"&&mn.setContext(self),this.setAnimationLoop=function(Be){fn=Be,je.setAnimationLoop(Be),Be===null?mn.stop():mn.start()},je.addEventListener("sessionstart",tn),je.addEventListener("sessionend",gs),this.render=function(Be,se){if(se!==void 0&&se.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(R===!0)return;if(Be.matrixWorldAutoUpdate===!0&&Be.updateMatrixWorld(),se.parent===null&&se.matrixWorldAutoUpdate===!0&&se.updateMatrixWorld(),je.enabled===!0&&je.isPresenting===!0&&(je.cameraAutoUpdate===!0&&je.updateCamera(se),se=je.getCamera()),Be.isScene===!0&&Be.onBeforeRender(S,Be,se,D),_=ve.get(Be,w.length),_.init(se),w.push(_),$e.multiplyMatrices(se.projectionMatrix,se.matrixWorldInverse),de.setFromProjectionMatrix($e),Ge=this.localClippingEnabled,Ie=Le.init(this.clippingPlanes,Ge),v=ye.get(Be,T.length),v.init(),T.push(v),je.enabled===!0&&je.isPresenting===!0){const Ke=S.xr.getDepthSensingMesh();Ke!==null&&Rs(Ke,se,-1/0,S.sortObjects)}Rs(Be,se,0,S.sortObjects),v.finish(),S.sortObjects===!0&&v.sort(ie,Y),gt=je.enabled===!1||je.isPresenting===!1||je.hasDepthSensing()===!1,gt&&Fe.addToRenderList(v,Be),this.info.render.frame++,Ie===!0&&Le.beginShadows();const ge=_.state.shadowsArray;Te.render(ge,Be,se),Ie===!0&&Le.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ne=v.opaque,ke=v.transmissive;if(_.setupLights(),se.isArrayCamera){const Ke=se.cameras;if(ke.length>0)for(let ot=0,wt=Ke.length;ot<wt;ot++){const qt=Ke[ot];As(Ne,ke,Be,qt)}gt&&Fe.render(Be);for(let ot=0,wt=Ke.length;ot<wt;ot++){const qt=Ke[ot];$n(v,Be,qt,qt.viewport)}}else ke.length>0&&As(Ne,ke,Be,se),gt&&Fe.render(Be),$n(v,Be,se);D!==null&&(Qe.updateMultisampleRenderTarget(D),Qe.updateRenderTargetMipmap(D)),Be.isScene===!0&&Be.onAfterRender(S,Be,se),Re.resetDefaultState(),L=-1,O=null,w.pop(),w.length>0?(_=w[w.length-1],Ie===!0&&Le.setGlobalState(S.clippingPlanes,_.state.camera)):_=null,T.pop(),T.length>0?v=T[T.length-1]:v=null};function Rs(Be,se,ge,Ne){if(Be.visible===!1)return;if(Be.layers.test(se.layers)){if(Be.isGroup)ge=Be.renderOrder;else if(Be.isLOD)Be.autoUpdate===!0&&Be.update(se);else if(Be.isLight)_.pushLight(Be),Be.castShadow&&_.pushShadow(Be);else if(Be.isSprite){if(!Be.frustumCulled||de.intersectsSprite(Be)){Ne&&At.setFromMatrixPosition(Be.matrixWorld).applyMatrix4($e);const Ke=zt.update(Be),ot=Be.material;ot.visible&&v.push(Be,Ke,ot,ge,At.z,null)}}else if((Be.isMesh||Be.isLine||Be.isPoints)&&(!Be.frustumCulled||de.intersectsObject(Be))){const Ke=zt.update(Be),ot=Be.material;if(Ne&&(Be.boundingSphere!==void 0?(Be.boundingSphere===null&&Be.computeBoundingSphere(),At.copy(Be.boundingSphere.center)):(Ke.boundingSphere===null&&Ke.computeBoundingSphere(),At.copy(Ke.boundingSphere.center)),At.applyMatrix4(Be.matrixWorld).applyMatrix4($e)),Array.isArray(ot)){const wt=Ke.groups;for(let qt=0,Kt=wt.length;qt<Kt;qt++){const Rt=wt[qt],ti=ot[Rt.materialIndex];ti&&ti.visible&&v.push(Be,Ke,ti,ge,At.z,Rt)}}else ot.visible&&v.push(Be,Ke,ot,ge,At.z,null)}}const ke=Be.children;for(let Ke=0,ot=ke.length;Ke<ot;Ke++)Rs(ke[Ke],se,ge,Ne)}function $n(Be,se,ge,Ne){const ke=Be.opaque,Ke=Be.transmissive,ot=Be.transparent;_.setupLightsView(ge),Ie===!0&&Le.setGlobalState(S.clippingPlanes,ge),Ne&&Si.viewport(U.copy(Ne)),ke.length>0&&me(ke,se,ge),Ke.length>0&&me(Ke,se,ge),ot.length>0&&me(ot,se,ge),Si.buffers.depth.setTest(!0),Si.buffers.depth.setMask(!0),Si.buffers.color.setMask(!0),Si.setPolygonOffset(!1)}function As(Be,se,ge,Ne){if((ge.isScene===!0?ge.overrideMaterial:null)!==null)return;_.state.transmissionRenderTarget[Ne.id]===void 0&&(_.state.transmissionRenderTarget[Ne.id]=new Fh(1,1,{generateMipmaps:!0,type:hi.has("EXT_color_buffer_half_float")||hi.has("EXT_color_buffer_float")?am:gu,minFilter:tp,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Pn.workingColorSpace}));const ke=_.state.transmissionRenderTarget[Ne.id],Ke=Ne.viewport||U;ke.setSize(Ke.z,Ke.w);const ot=S.getRenderTarget();S.setRenderTarget(ke),S.getClearColor(V),$=S.getClearAlpha(),$<1&&S.setClearColor(16777215,.5),S.clear(),gt&&Fe.render(ge);const wt=S.toneMapping;S.toneMapping=Oh;const qt=Ne.viewport;if(Ne.viewport!==void 0&&(Ne.viewport=void 0),_.setupLightsView(Ne),Ie===!0&&Le.setGlobalState(S.clippingPlanes,Ne),me(Be,ge,Ne),Qe.updateMultisampleRenderTarget(ke),Qe.updateRenderTargetMipmap(ke),hi.has("WEBGL_multisampled_render_to_texture")===!1){let Kt=!1;for(let Rt=0,ti=se.length;Rt<ti;Rt++){const bi=se[Rt],Fi=bi.object,Cr=bi.geometry,ur=bi.material,Ji=bi.group;if(ur.side===fu&&Fi.layers.test(Ne.layers)){const vi=ur.side;ur.side=ho,ur.needsUpdate=!0,ct(Fi,ge,Ne,Cr,ur,Ji),ur.side=vi,ur.needsUpdate=!0,Kt=!0}}Kt===!0&&(Qe.updateMultisampleRenderTarget(ke),Qe.updateRenderTargetMipmap(ke))}S.setRenderTarget(ot),S.setClearColor(V,$),qt!==void 0&&(Ne.viewport=qt),S.toneMapping=wt}function me(Be,se,ge){const Ne=se.isScene===!0?se.overrideMaterial:null;for(let ke=0,Ke=Be.length;ke<Ke;ke++){const ot=Be[ke],wt=ot.object,qt=ot.geometry,Kt=Ne===null?ot.material:Ne,Rt=ot.group;wt.layers.test(ge.layers)&&ct(wt,se,ge,qt,Kt,Rt)}}function ct(Be,se,ge,Ne,ke,Ke){Be.onBeforeRender(S,se,ge,Ne,ke,Ke),Be.modelViewMatrix.multiplyMatrices(ge.matrixWorldInverse,Be.matrixWorld),Be.normalMatrix.getNormalMatrix(Be.modelViewMatrix),ke.onBeforeRender(S,se,ge,Ne,Be,Ke),ke.transparent===!0&&ke.side===fu&&ke.forceSinglePass===!1?(ke.side=ho,ke.needsUpdate=!0,S.renderBufferDirect(ge,se,Ne,ke,Be,Ke),ke.side=Dh,ke.needsUpdate=!0,S.renderBufferDirect(ge,se,Ne,ke,Be,Ke),ke.side=fu):S.renderBufferDirect(ge,se,Ne,ke,Be,Ke),Be.onAfterRender(S,se,ge,Ne,ke,Ke)}function St(Be,se,ge){se.isScene!==!0&&(se=Gt);const Ne=Vi.get(Be),ke=_.state.lights,Ke=_.state.shadowsArray,ot=ke.state.version,wt=xi.getParameters(Be,ke.state,Ke,se,ge),qt=xi.getProgramCacheKey(wt);let Kt=Ne.programs;Ne.environment=Be.isMeshStandardMaterial?se.environment:null,Ne.fog=se.fog,Ne.envMap=(Be.isMeshStandardMaterial?yt:Ce).get(Be.envMap||Ne.environment),Ne.envMapRotation=Ne.environment!==null&&Be.envMap===null?se.environmentRotation:Be.envMapRotation,Kt===void 0&&(Be.addEventListener("dispose",Ut),Kt=new Map,Ne.programs=Kt);let Rt=Kt.get(qt);if(Rt!==void 0){if(Ne.currentProgram===Rt&&Ne.lightsStateVersion===ot)return Ii(Be,wt),Rt}else wt.uniforms=xi.getUniforms(Be),Be.onBeforeCompile(wt,S),Rt=xi.acquireProgram(wt,qt),Kt.set(qt,Rt),Ne.uniforms=wt.uniforms;const ti=Ne.uniforms;return(!Be.isShaderMaterial&&!Be.isRawShaderMaterial||Be.clipping===!0)&&(ti.clippingPlanes=Le.uniform),Ii(Be,wt),Ne.needsLights=Oi(Be),Ne.lightsStateVersion=ot,Ne.needsLights&&(ti.ambientLightColor.value=ke.state.ambient,ti.lightProbe.value=ke.state.probe,ti.directionalLights.value=ke.state.directional,ti.directionalLightShadows.value=ke.state.directionalShadow,ti.spotLights.value=ke.state.spot,ti.spotLightShadows.value=ke.state.spotShadow,ti.rectAreaLights.value=ke.state.rectArea,ti.ltc_1.value=ke.state.rectAreaLTC1,ti.ltc_2.value=ke.state.rectAreaLTC2,ti.pointLights.value=ke.state.point,ti.pointLightShadows.value=ke.state.pointShadow,ti.hemisphereLights.value=ke.state.hemi,ti.directionalShadowMap.value=ke.state.directionalShadowMap,ti.directionalShadowMatrix.value=ke.state.directionalShadowMatrix,ti.spotShadowMap.value=ke.state.spotShadowMap,ti.spotLightMatrix.value=ke.state.spotLightMatrix,ti.spotLightMap.value=ke.state.spotLightMap,ti.pointShadowMap.value=ke.state.pointShadowMap,ti.pointShadowMatrix.value=ke.state.pointShadowMatrix),Ne.currentProgram=Rt,Ne.uniformsList=null,Rt}function Xt(Be){if(Be.uniformsList===null){const se=Be.currentProgram.getUniforms();Be.uniformsList=gb.seqWithValue(se.seq,Be.uniforms)}return Be.uniformsList}function Ii(Be,se){const ge=Vi.get(Be);ge.outputColorSpace=se.outputColorSpace,ge.batching=se.batching,ge.batchingColor=se.batchingColor,ge.instancing=se.instancing,ge.instancingColor=se.instancingColor,ge.instancingMorph=se.instancingMorph,ge.skinning=se.skinning,ge.morphTargets=se.morphTargets,ge.morphNormals=se.morphNormals,ge.morphColors=se.morphColors,ge.morphTargetsCount=se.morphTargetsCount,ge.numClippingPlanes=se.numClippingPlanes,ge.numIntersection=se.numClipIntersection,ge.vertexAlphas=se.vertexAlphas,ge.vertexTangents=se.vertexTangents,ge.toneMapping=se.toneMapping}function sr(Be,se,ge,Ne,ke){se.isScene!==!0&&(se=Gt),Qe.resetTextureUnits();const Ke=se.fog,ot=Ne.isMeshStandardMaterial?se.environment:null,wt=D===null?S.outputColorSpace:D.isXRRenderTarget===!0?D.texture.colorSpace:um,qt=(Ne.isMeshStandardMaterial?yt:Ce).get(Ne.envMap||ot),Kt=Ne.vertexColors===!0&&!!ge.attributes.color&&ge.attributes.color.itemSize===4,Rt=!!ge.attributes.tangent&&(!!Ne.normalMap||Ne.anisotropy>0),ti=!!ge.morphAttributes.position,bi=!!ge.morphAttributes.normal,Fi=!!ge.morphAttributes.color;let Cr=Oh;Ne.toneMapped&&(D===null||D.isXRRenderTarget===!0)&&(Cr=S.toneMapping);const ur=ge.morphAttributes.position||ge.morphAttributes.normal||ge.morphAttributes.color,Ji=ur!==void 0?ur.length:0,vi=Vi.get(Ne),Tn=_.state.lights;if(Ie===!0&&(Ge===!0||Be!==O)){const Se=Be===O&&Ne.id===L;Le.setState(Ne,Be,Se)}let qn=!1;Ne.version===vi.__version?(vi.needsLights&&vi.lightsStateVersion!==Tn.state.version||vi.outputColorSpace!==wt||ke.isBatchedMesh&&vi.batching===!1||!ke.isBatchedMesh&&vi.batching===!0||ke.isBatchedMesh&&vi.batchingColor===!0&&ke.colorTexture===null||ke.isBatchedMesh&&vi.batchingColor===!1&&ke.colorTexture!==null||ke.isInstancedMesh&&vi.instancing===!1||!ke.isInstancedMesh&&vi.instancing===!0||ke.isSkinnedMesh&&vi.skinning===!1||!ke.isSkinnedMesh&&vi.skinning===!0||ke.isInstancedMesh&&vi.instancingColor===!0&&ke.instanceColor===null||ke.isInstancedMesh&&vi.instancingColor===!1&&ke.instanceColor!==null||ke.isInstancedMesh&&vi.instancingMorph===!0&&ke.morphTexture===null||ke.isInstancedMesh&&vi.instancingMorph===!1&&ke.morphTexture!==null||vi.envMap!==qt||Ne.fog===!0&&vi.fog!==Ke||vi.numClippingPlanes!==void 0&&(vi.numClippingPlanes!==Le.numPlanes||vi.numIntersection!==Le.numIntersection)||vi.vertexAlphas!==Kt||vi.vertexTangents!==Rt||vi.morphTargets!==ti||vi.morphNormals!==bi||vi.morphColors!==Fi||vi.toneMapping!==Cr||vi.morphTargetsCount!==Ji)&&(qn=!0):(qn=!0,vi.__version=Ne.version);let Mi=vi.currentProgram;qn===!0&&(Mi=St(Ne,se,ke));let ar=!1,un=!1,Qr=!1;const W=Mi.getUniforms(),ue=vi.uniforms;if(Si.useProgram(Mi.program)&&(ar=!0,un=!0,Qr=!0),Ne.id!==L&&(L=Ne.id,un=!0),ar||O!==Be){Si.buffers.depth.getReversed()?(Xe.copy(Be.projectionMatrix),dK(Xe),pK(Xe),W.setValue(Ze,"projectionMatrix",Xe)):W.setValue(Ze,"projectionMatrix",Be.projectionMatrix),W.setValue(Ze,"viewMatrix",Be.matrixWorldInverse);const Se=W.map.cameraPosition;Se!==void 0&&Se.setValue(Ze,lt.setFromMatrixPosition(Be.matrixWorld)),Ri.logarithmicDepthBuffer&&W.setValue(Ze,"logDepthBufFC",2/(Math.log(Be.far+1)/Math.LN2)),(Ne.isMeshPhongMaterial||Ne.isMeshToonMaterial||Ne.isMeshLambertMaterial||Ne.isMeshBasicMaterial||Ne.isMeshStandardMaterial||Ne.isShaderMaterial)&&W.setValue(Ze,"isOrthographic",Be.isOrthographicCamera===!0),O!==Be&&(O=Be,un=!0,Qr=!0)}if(ke.isSkinnedMesh){W.setOptional(Ze,ke,"bindMatrix"),W.setOptional(Ze,ke,"bindMatrixInverse");const Se=ke.skeleton;Se&&(Se.boneTexture===null&&Se.computeBoneTexture(),W.setValue(Ze,"boneTexture",Se.boneTexture,Qe))}ke.isBatchedMesh&&(W.setOptional(Ze,ke,"batchingTexture"),W.setValue(Ze,"batchingTexture",ke._matricesTexture,Qe),W.setOptional(Ze,ke,"batchingIdTexture"),W.setValue(Ze,"batchingIdTexture",ke._indirectTexture,Qe),W.setOptional(Ze,ke,"batchingColorTexture"),ke._colorsTexture!==null&&W.setValue(Ze,"batchingColorTexture",ke._colorsTexture,Qe));const Ae=ge.morphAttributes;if((Ae.position!==void 0||Ae.normal!==void 0||Ae.color!==void 0)&&Pe.update(ke,ge,Mi),(un||vi.receiveShadow!==ke.receiveShadow)&&(vi.receiveShadow=ke.receiveShadow,W.setValue(Ze,"receiveShadow",ke.receiveShadow)),Ne.isMeshGouraudMaterial&&Ne.envMap!==null&&(ue.envMap.value=qt,ue.flipEnvMap.value=qt.isCubeTexture&&qt.isRenderTargetTexture===!1?-1:1),Ne.isMeshStandardMaterial&&Ne.envMap===null&&se.environment!==null&&(ue.envMapIntensity.value=se.environmentIntensity),un&&(W.setValue(Ze,"toneMappingExposure",S.toneMappingExposure),vi.needsLights&&Ni(ue,Qr),Ke&&Ne.fog===!0&&vt.refreshFogUniforms(ue,Ke),vt.refreshMaterialUniforms(ue,Ne,j,G,_.state.transmissionRenderTarget[Be.id]),gb.upload(Ze,Xt(vi),ue,Qe)),Ne.isShaderMaterial&&Ne.uniformsNeedUpdate===!0&&(gb.upload(Ze,Xt(vi),ue,Qe),Ne.uniformsNeedUpdate=!1),Ne.isSpriteMaterial&&W.setValue(Ze,"center",ke.center),W.setValue(Ze,"modelViewMatrix",ke.modelViewMatrix),W.setValue(Ze,"normalMatrix",ke.normalMatrix),W.setValue(Ze,"modelMatrix",ke.matrixWorld),Ne.isShaderMaterial||Ne.isRawShaderMaterial){const Se=Ne.uniformsGroups;for(let We=0,Ye=Se.length;We<Ye;We++){const ft=Se[We];ce.update(ft,Mi),ce.bind(ft,Mi)}}return Mi}function Ni(Be,se){Be.ambientLightColor.needsUpdate=se,Be.lightProbe.needsUpdate=se,Be.directionalLights.needsUpdate=se,Be.directionalLightShadows.needsUpdate=se,Be.pointLights.needsUpdate=se,Be.pointLightShadows.needsUpdate=se,Be.spotLights.needsUpdate=se,Be.spotLightShadows.needsUpdate=se,Be.rectAreaLights.needsUpdate=se,Be.hemisphereLights.needsUpdate=se}function Oi(Be){return Be.isMeshLambertMaterial||Be.isMeshToonMaterial||Be.isMeshPhongMaterial||Be.isMeshStandardMaterial||Be.isShadowMaterial||Be.isShaderMaterial&&Be.lights===!0}this.getActiveCubeFace=function(){return B},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return D},this.setRenderTargetTextures=function(Be,se,ge){Vi.get(Be.texture).__webglTexture=se,Vi.get(Be.depthTexture).__webglTexture=ge;const Ne=Vi.get(Be);Ne.__hasExternalTextures=!0,Ne.__autoAllocateDepthBuffer=ge===void 0,Ne.__autoAllocateDepthBuffer||hi.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ne.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Be,se){const ge=Vi.get(Be);ge.__webglFramebuffer=se,ge.__useDefaultFramebuffer=se===void 0},this.setRenderTarget=function(Be,se=0,ge=0){D=Be,B=se,I=ge;let Ne=!0,ke=null,Ke=!1,ot=!1;if(Be){const wt=Vi.get(Be);if(wt.__useDefaultFramebuffer!==void 0)Si.bindFramebuffer(Ze.FRAMEBUFFER,null),Ne=!1;else if(wt.__webglFramebuffer===void 0)Qe.setupRenderTarget(Be);else if(wt.__hasExternalTextures)Qe.rebindTextures(Be,Vi.get(Be.texture).__webglTexture,Vi.get(Be.depthTexture).__webglTexture);else if(Be.depthBuffer){const Rt=Be.depthTexture;if(wt.__boundDepthTexture!==Rt){if(Rt!==null&&Vi.has(Rt)&&(Be.width!==Rt.image.width||Be.height!==Rt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Qe.setupDepthRenderbuffer(Be)}}const qt=Be.texture;(qt.isData3DTexture||qt.isDataArrayTexture||qt.isCompressedArrayTexture)&&(ot=!0);const Kt=Vi.get(Be).__webglFramebuffer;Be.isWebGLCubeRenderTarget?(Array.isArray(Kt[se])?ke=Kt[se][ge]:ke=Kt[se],Ke=!0):Be.samples>0&&Qe.useMultisampledRTT(Be)===!1?ke=Vi.get(Be).__webglMultisampledFramebuffer:Array.isArray(Kt)?ke=Kt[ge]:ke=Kt,U.copy(Be.viewport),J.copy(Be.scissor),H=Be.scissorTest}else U.copy(ae).multiplyScalar(j).floor(),J.copy(xe).multiplyScalar(j).floor(),H=fe;if(Si.bindFramebuffer(Ze.FRAMEBUFFER,ke)&&Ne&&Si.drawBuffers(Be,ke),Si.viewport(U),Si.scissor(J),Si.setScissorTest(H),Ke){const wt=Vi.get(Be.texture);Ze.framebufferTexture2D(Ze.FRAMEBUFFER,Ze.COLOR_ATTACHMENT0,Ze.TEXTURE_CUBE_MAP_POSITIVE_X+se,wt.__webglTexture,ge)}else if(ot){const wt=Vi.get(Be.texture),qt=se||0;Ze.framebufferTextureLayer(Ze.FRAMEBUFFER,Ze.COLOR_ATTACHMENT0,wt.__webglTexture,ge||0,qt)}L=-1},this.readRenderTargetPixels=function(Be,se,ge,Ne,ke,Ke,ot){if(!(Be&&Be.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let wt=Vi.get(Be).__webglFramebuffer;if(Be.isWebGLCubeRenderTarget&&ot!==void 0&&(wt=wt[ot]),wt){Si.bindFramebuffer(Ze.FRAMEBUFFER,wt);try{const qt=Be.texture,Kt=qt.format,Rt=qt.type;if(!Ri.textureFormatReadable(Kt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ri.textureTypeReadable(Rt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}se>=0&&se<=Be.width-Ne&&ge>=0&&ge<=Be.height-ke&&Ze.readPixels(se,ge,Ne,ke,re.convert(Kt),re.convert(Rt),Ke)}finally{const qt=D!==null?Vi.get(D).__webglFramebuffer:null;Si.bindFramebuffer(Ze.FRAMEBUFFER,qt)}}},this.readRenderTargetPixelsAsync=async function(Be,se,ge,Ne,ke,Ke,ot){if(!(Be&&Be.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let wt=Vi.get(Be).__webglFramebuffer;if(Be.isWebGLCubeRenderTarget&&ot!==void 0&&(wt=wt[ot]),wt){const qt=Be.texture,Kt=qt.format,Rt=qt.type;if(!Ri.textureFormatReadable(Kt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ri.textureTypeReadable(Rt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(se>=0&&se<=Be.width-Ne&&ge>=0&&ge<=Be.height-ke){Si.bindFramebuffer(Ze.FRAMEBUFFER,wt);const ti=Ze.createBuffer();Ze.bindBuffer(Ze.PIXEL_PACK_BUFFER,ti),Ze.bufferData(Ze.PIXEL_PACK_BUFFER,Ke.byteLength,Ze.STREAM_READ),Ze.readPixels(se,ge,Ne,ke,re.convert(Kt),re.convert(Rt),0);const bi=D!==null?Vi.get(D).__webglFramebuffer:null;Si.bindFramebuffer(Ze.FRAMEBUFFER,bi);const Fi=Ze.fenceSync(Ze.SYNC_GPU_COMMANDS_COMPLETE,0);return Ze.flush(),await hK(Ze,Fi,4),Ze.bindBuffer(Ze.PIXEL_PACK_BUFFER,ti),Ze.getBufferSubData(Ze.PIXEL_PACK_BUFFER,0,Ke),Ze.deleteBuffer(ti),Ze.deleteSync(Fi),Ke}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(Be,se=null,ge=0){Be.isTexture!==!0&&(aA("WebGLRenderer: copyFramebufferToTexture function signature has changed."),se=arguments[0]||null,Be=arguments[1]);const Ne=Math.pow(2,-ge),ke=Math.floor(Be.image.width*Ne),Ke=Math.floor(Be.image.height*Ne),ot=se!==null?se.x:0,wt=se!==null?se.y:0;Qe.setTexture2D(Be,0),Ze.copyTexSubImage2D(Ze.TEXTURE_2D,ge,0,0,ot,wt,ke,Ke),Si.unbindTexture()},this.copyTextureToTexture=function(Be,se,ge=null,Ne=null,ke=0){Be.isTexture!==!0&&(aA("WebGLRenderer: copyTextureToTexture function signature has changed."),Ne=arguments[0]||null,Be=arguments[1],se=arguments[2],ke=arguments[3]||0,ge=null);let Ke,ot,wt,qt,Kt,Rt,ti,bi,Fi;const Cr=Be.isCompressedTexture?Be.mipmaps[ke]:Be.image;ge!==null?(Ke=ge.max.x-ge.min.x,ot=ge.max.y-ge.min.y,wt=ge.isBox3?ge.max.z-ge.min.z:1,qt=ge.min.x,Kt=ge.min.y,Rt=ge.isBox3?ge.min.z:0):(Ke=Cr.width,ot=Cr.height,wt=Cr.depth||1,qt=0,Kt=0,Rt=0),Ne!==null?(ti=Ne.x,bi=Ne.y,Fi=Ne.z):(ti=0,bi=0,Fi=0);const ur=re.convert(se.format),Ji=re.convert(se.type);let vi;se.isData3DTexture?(Qe.setTexture3D(se,0),vi=Ze.TEXTURE_3D):se.isDataArrayTexture||se.isCompressedArrayTexture?(Qe.setTexture2DArray(se,0),vi=Ze.TEXTURE_2D_ARRAY):(Qe.setTexture2D(se,0),vi=Ze.TEXTURE_2D),Ze.pixelStorei(Ze.UNPACK_FLIP_Y_WEBGL,se.flipY),Ze.pixelStorei(Ze.UNPACK_PREMULTIPLY_ALPHA_WEBGL,se.premultiplyAlpha),Ze.pixelStorei(Ze.UNPACK_ALIGNMENT,se.unpackAlignment);const Tn=Ze.getParameter(Ze.UNPACK_ROW_LENGTH),qn=Ze.getParameter(Ze.UNPACK_IMAGE_HEIGHT),Mi=Ze.getParameter(Ze.UNPACK_SKIP_PIXELS),ar=Ze.getParameter(Ze.UNPACK_SKIP_ROWS),un=Ze.getParameter(Ze.UNPACK_SKIP_IMAGES);Ze.pixelStorei(Ze.UNPACK_ROW_LENGTH,Cr.width),Ze.pixelStorei(Ze.UNPACK_IMAGE_HEIGHT,Cr.height),Ze.pixelStorei(Ze.UNPACK_SKIP_PIXELS,qt),Ze.pixelStorei(Ze.UNPACK_SKIP_ROWS,Kt),Ze.pixelStorei(Ze.UNPACK_SKIP_IMAGES,Rt);const Qr=Be.isDataArrayTexture||Be.isData3DTexture,W=se.isDataArrayTexture||se.isData3DTexture;if(Be.isRenderTargetTexture||Be.isDepthTexture){const ue=Vi.get(Be),Ae=Vi.get(se),Se=Vi.get(ue.__renderTarget),We=Vi.get(Ae.__renderTarget);Si.bindFramebuffer(Ze.READ_FRAMEBUFFER,Se.__webglFramebuffer),Si.bindFramebuffer(Ze.DRAW_FRAMEBUFFER,We.__webglFramebuffer);for(let Ye=0;Ye<wt;Ye++)Qr&&Ze.framebufferTextureLayer(Ze.READ_FRAMEBUFFER,Ze.COLOR_ATTACHMENT0,Vi.get(Be).__webglTexture,ke,Rt+Ye),Be.isDepthTexture?(W&&Ze.framebufferTextureLayer(Ze.DRAW_FRAMEBUFFER,Ze.COLOR_ATTACHMENT0,Vi.get(se).__webglTexture,ke,Fi+Ye),Ze.blitFramebuffer(qt,Kt,Ke,ot,ti,bi,Ke,ot,Ze.DEPTH_BUFFER_BIT,Ze.NEAREST)):W?Ze.copyTexSubImage3D(vi,ke,ti,bi,Fi+Ye,qt,Kt,Ke,ot):Ze.copyTexSubImage2D(vi,ke,ti,bi,Fi+Ye,qt,Kt,Ke,ot);Si.bindFramebuffer(Ze.READ_FRAMEBUFFER,null),Si.bindFramebuffer(Ze.DRAW_FRAMEBUFFER,null)}else W?Be.isDataTexture||Be.isData3DTexture?Ze.texSubImage3D(vi,ke,ti,bi,Fi,Ke,ot,wt,ur,Ji,Cr.data):se.isCompressedArrayTexture?Ze.compressedTexSubImage3D(vi,ke,ti,bi,Fi,Ke,ot,wt,ur,Cr.data):Ze.texSubImage3D(vi,ke,ti,bi,Fi,Ke,ot,wt,ur,Ji,Cr):Be.isDataTexture?Ze.texSubImage2D(Ze.TEXTURE_2D,ke,ti,bi,Ke,ot,ur,Ji,Cr.data):Be.isCompressedTexture?Ze.compressedTexSubImage2D(Ze.TEXTURE_2D,ke,ti,bi,Cr.width,Cr.height,ur,Cr.data):Ze.texSubImage2D(Ze.TEXTURE_2D,ke,ti,bi,Ke,ot,ur,Ji,Cr);Ze.pixelStorei(Ze.UNPACK_ROW_LENGTH,Tn),Ze.pixelStorei(Ze.UNPACK_IMAGE_HEIGHT,qn),Ze.pixelStorei(Ze.UNPACK_SKIP_PIXELS,Mi),Ze.pixelStorei(Ze.UNPACK_SKIP_ROWS,ar),Ze.pixelStorei(Ze.UNPACK_SKIP_IMAGES,un),ke===0&&se.generateMipmaps&&Ze.generateMipmap(vi),Si.unbindTexture()},this.copyTextureToTexture3D=function(Be,se,ge=null,Ne=null,ke=0){return Be.isTexture!==!0&&(aA("WebGLRenderer: copyTextureToTexture3D function signature has changed."),ge=arguments[0]||null,Ne=arguments[1]||null,Be=arguments[2],se=arguments[3],ke=arguments[4]||0),aA('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Be,se,ge,Ne,ke)},this.initRenderTarget=function(Be){Vi.get(Be).__webglFramebuffer===void 0&&Qe.setupRenderTarget(Be)},this.initTexture=function(Be){Be.isCubeTexture?Qe.setTextureCube(Be,0):Be.isData3DTexture?Qe.setTexture3D(Be,0):Be.isDataArrayTexture||Be.isCompressedArrayTexture?Qe.setTexture2DArray(Be,0):Qe.setTexture2D(Be,0),Si.unbindTexture()},this.resetState=function(){B=0,I=0,D=null,Si.reset(),Re.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return yu}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorspace=Pn._getDrawingBufferColorSpace(e),i.unpackColorSpace=Pn._getUnpackColorSpace()}}let _te=class extends Xa{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Vh,this.environmentIntensity=1,this.environmentRotation=new Vh,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(r,e){return super.copy(r,e),r.background!==null&&(this.background=r.background.clone()),r.environment!==null&&(this.environment=r.environment.clone()),r.fog!==null&&(this.fog=r.fog.clone()),this.backgroundBlurriness=r.backgroundBlurriness,this.backgroundIntensity=r.backgroundIntensity,this.backgroundRotation.copy(r.backgroundRotation),this.environmentIntensity=r.environmentIntensity,this.environmentRotation.copy(r.environmentRotation),r.overrideMaterial!==null&&(this.overrideMaterial=r.overrideMaterial.clone()),this.matrixAutoUpdate=r.matrixAutoUpdate,this}toJSON(r){const e=super.toJSON(r);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}},Ete=class{constructor(r,e){this.isInterleavedBuffer=!0,this.array=r,this.stride=e,this.count=r!==void 0?r.length/e:0,this.usage=tS,this.updateRanges=[],this.version=0,this.uuid=vu()}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}addUpdateRange(r,e){this.updateRanges.push({start:r,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(r){return this.array=new r.array.constructor(r.array),this.count=r.count,this.stride=r.stride,this.usage=r.usage,this}copyAt(r,e,i){r*=this.stride,i*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[r+n]=e.array[i+n];return this}set(r,e=0){return this.array.set(r,e),this}clone(r){r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=vu()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(r.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(r){return this.onUploadCallback=r,this}toJSON(r){return r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=vu()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const fo=new at;let f4=class dG{constructor(e,i,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,n=this.data.count;i<n;i++)fo.fromBufferAttribute(this,i),fo.applyMatrix4(e),this.setXYZ(i,fo.x,fo.y,fo.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)fo.fromBufferAttribute(this,i),fo.applyNormalMatrix(e),this.setXYZ(i,fo.x,fo.y,fo.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)fo.fromBufferAttribute(this,i),fo.transformDirection(e),this.setXYZ(i,fo.x,fo.y,fo.z);return this}getComponent(e,i){let n=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(n=Zl(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=ts(n,this.array)),this.data.array[e*this.data.stride+this.offset+i]=n,this}setX(e,i){return this.normalized&&(i=ts(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=ts(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=ts(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=ts(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=Zl(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=Zl(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=Zl(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=Zl(i,this.array)),i}setXY(e,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=ts(i,this.array),n=ts(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this}setXYZ(e,i,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=ts(i,this.array),n=ts(n,this.array),s=ts(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,i,n,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=ts(i,this.array),n=ts(n,this.array),s=ts(s,this.array),o=ts(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return new Oo(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new dG(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},m4=class extends lp{static get type(){return"SpriteMaterial"}constructor(r){super(),this.isSpriteMaterial=!0,this.color=new wn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.rotation=r.rotation,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}},Bm;const dA=new at,Nm=new at,Lm=new at,Dm=new zi,pA=new zi,g4=new ps,yb=new at,fA=new at,vb=new at,A4=new zi,PS=new zi,y4=new zi;class wte extends Xa{constructor(e=new m4){if(super(),this.isSprite=!0,this.type="Sprite",Bm===void 0){Bm=new Po;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Ete(i,5);Bm.setIndex([0,1,2,0,2,3]),Bm.setAttribute("position",new f4(n,3,0,!1)),Bm.setAttribute("uv",new f4(n,2,3,!1))}this.geometry=Bm,this.material=e,this.center=new zi(.5,.5)}raycast(e,i){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Nm.setFromMatrixScale(this.matrixWorld),g4.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Lm.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Nm.multiplyScalar(-Lm.z);const n=this.material.rotation;let s,o;n!==0&&(o=Math.cos(n),s=Math.sin(n));const l=this.center;xb(yb.set(-.5,-.5,0),Lm,l,Nm,s,o),xb(fA.set(.5,-.5,0),Lm,l,Nm,s,o),xb(vb.set(.5,.5,0),Lm,l,Nm,s,o),A4.set(0,0),PS.set(1,0),y4.set(1,1);let u=e.ray.intersectTriangle(yb,fA,vb,!1,dA);if(u===null&&(xb(fA.set(-.5,.5,0),Lm,l,Nm,s,o),PS.set(0,1),u=e.ray.intersectTriangle(yb,vb,fA,!1,dA),u===null))return;const c=e.ray.origin.distanceTo(dA);c<e.near||c>e.far||i.push({distance:c,point:dA.clone(),uv:op.getInterpolation(dA,yb,fA,vb,A4,PS,y4,new zi),face:null,object:this})}copy(e,i){return super.copy(e,i),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function xb(r,e,i,n,s,o){Dm.subVectors(r,i).addScalar(.5).multiply(n),s!==void 0?(pA.x=o*Dm.x-s*Dm.y,pA.y=s*Dm.x+o*Dm.y):pA.copy(Dm),r.copy(e),r.x+=pA.x,r.y+=pA.y,r.applyMatrix4(g4)}let FS=class extends lp{static get type(){return"LineBasicMaterial"}constructor(r){super(),this.isLineBasicMaterial=!0,this.color=new wn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}};const bb=new at,_b=new at,v4=new ps,mA=new $x,Eb=new Kx,kS=new at,x4=new at;class b4 extends Xa{constructor(e=new Po,i=new FS){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,n=[0];for(let s=1,o=i.count;s<o;s++)bb.fromBufferAttribute(i,s-1),_b.fromBufferAttribute(i,s),n[s]=n[s-1],n[s]+=bb.distanceTo(_b);e.setAttribute("lineDistance",new la(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const n=this.geometry,s=this.matrixWorld,o=e.params.Line.threshold,l=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Eb.copy(n.boundingSphere),Eb.applyMatrix4(s),Eb.radius+=o,e.ray.intersectsSphere(Eb)===!1)return;v4.copy(s).invert(),mA.copy(e.ray).applyMatrix4(v4);const u=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(p!==null){const m=Math.max(0,l.start),g=Math.min(p.count,l.start+l.count);for(let y=m,x=g-1;y<x;y+=d){const v=p.getX(y),_=p.getX(y+1),T=wb(this,e,mA,c,v,_);T&&i.push(T)}if(this.isLineLoop){const y=p.getX(g-1),x=p.getX(m),v=wb(this,e,mA,c,y,x);v&&i.push(v)}}else{const m=Math.max(0,l.start),g=Math.min(f.count,l.start+l.count);for(let y=m,x=g-1;y<x;y+=d){const v=wb(this,e,mA,c,y,y+1);v&&i.push(v)}if(this.isLineLoop){const y=wb(this,e,mA,c,g-1,m);y&&i.push(y)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const l=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}}function wb(r,e,i,n,s,o){const l=r.geometry.attributes.position;if(bb.fromBufferAttribute(l,s),_b.fromBufferAttribute(l,o),i.distanceSqToSegment(bb,_b,kS,x4)>n)return;kS.applyMatrix4(r.matrixWorld);const u=e.ray.origin.distanceTo(kS);if(!(u<e.near||u>e.far))return{distance:u,point:x4.clone().applyMatrix4(r.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:r}}class Cte extends Sl{constructor(e,i,n,s,o,l,u,c,d){super(e,i,n,s,o,l,u,c,d),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Su{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){const n=this.getUtoTmapping(e);return this.getPoint(n,i)}getPoints(e=5){const i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return i}getSpacedPoints(e=5){const i=[];for(let n=0;n<=e;n++)i.push(this.getPointAt(n/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let n,s=this.getPoint(0),o=0;i.push(0);for(let l=1;l<=e;l++)n=this.getPoint(l/e),o+=n.distanceTo(s),i.push(o),s=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){const n=this.getLengths();let s=0;const o=n.length;let l;i?l=i:l=e*n[o-1];let u=0,c=o-1,d;for(;u<=c;)if(s=Math.floor(u+(c-u)/2),d=n[s]-l,d<0)u=s+1;else if(d>0)c=s-1;else{c=s;break}if(s=c,n[s]===l)return s/(o-1);const p=n[s],f=n[s+1]-p,m=(l-p)/f;return(s+m)/(o-1)}getTangent(e,i){let n=e-1e-4,s=e+1e-4;n<0&&(n=0),s>1&&(s=1);const o=this.getPoint(n),l=this.getPoint(s),u=i||(o.isVector2?new zi:new at);return u.copy(l).sub(o).normalize(),u}getTangentAt(e,i){const n=this.getUtoTmapping(e);return this.getTangent(n,i)}computeFrenetFrames(e,i){const n=new at,s=[],o=[],l=[],u=new at,c=new ps;for(let g=0;g<=e;g++){const y=g/e;s[g]=this.getTangentAt(y,new at)}o[0]=new at,l[0]=new at;let d=Number.MAX_VALUE;const p=Math.abs(s[0].x),f=Math.abs(s[0].y),m=Math.abs(s[0].z);p<=d&&(d=p,n.set(1,0,0)),f<=d&&(d=f,n.set(0,1,0)),m<=d&&n.set(0,0,1),u.crossVectors(s[0],n).normalize(),o[0].crossVectors(s[0],u),l[0].crossVectors(s[0],o[0]);for(let g=1;g<=e;g++){if(o[g]=o[g-1].clone(),l[g]=l[g-1].clone(),u.crossVectors(s[g-1],s[g]),u.length()>Number.EPSILON){u.normalize();const y=Math.acos(ba(s[g-1].dot(s[g]),-1,1));o[g].applyMatrix4(c.makeRotationAxis(u,y))}l[g].crossVectors(s[g],o[g])}if(i===!0){let g=Math.acos(ba(o[0].dot(o[e]),-1,1));g/=e,s[0].dot(u.crossVectors(o[0],o[e]))>0&&(g=-g);for(let y=1;y<=e;y++)o[y].applyMatrix4(c.makeRotationAxis(s[y],g*y)),l[y].crossVectors(s[y],o[y])}return{tangents:s,normals:o,binormals:l}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class _4 extends Su{constructor(e=0,i=0,n=1,s=1,o=0,l=Math.PI*2,u=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=n,this.yRadius=s,this.aStartAngle=o,this.aEndAngle=l,this.aClockwise=u,this.aRotation=c}getPoint(e,i=new zi){const n=i,s=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const l=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=s;for(;o>s;)o-=s;o<Number.EPSILON&&(l?o=0:o=s),this.aClockwise===!0&&!l&&(o===s?o=-s:o=o-s);const u=this.aStartAngle+e*o;let c=this.aX+this.xRadius*Math.cos(u),d=this.aY+this.yRadius*Math.sin(u);if(this.aRotation!==0){const p=Math.cos(this.aRotation),f=Math.sin(this.aRotation),m=c-this.aX,g=d-this.aY;c=m*p-g*f+this.aX,d=m*f+g*p+this.aY}return n.set(c,d)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Ste extends _4{constructor(e,i,n,s,o,l){super(e,i,n,n,s,o,l),this.isArcCurve=!0,this.type="ArcCurve"}}function US(){let r=0,e=0,i=0,n=0;function s(o,l,u,c){r=o,e=u,i=-3*o+3*l-2*u-c,n=2*o-2*l+u+c}return{initCatmullRom:function(o,l,u,c,d){s(l,u,d*(u-o),d*(c-l))},initNonuniformCatmullRom:function(o,l,u,c,d,p,f){let m=(l-o)/d-(u-o)/(d+p)+(u-l)/p,g=(u-l)/p-(c-l)/(p+f)+(c-u)/f;m*=p,g*=p,s(l,u,m,g)},calc:function(o){const l=o*o,u=l*o;return r+e*o+i*l+n*u}}}const Cb=new at,zS=new US,jS=new US,VS=new US;class Tte extends Su{constructor(e=[],i=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=n,this.tension=s}getPoint(e,i=new at){const n=i,s=this.points,o=s.length,l=(o-(this.closed?0:1))*e;let u=Math.floor(l),c=l-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:c===0&&u===o-1&&(u=o-2,c=1);let d,p;this.closed||u>0?d=s[(u-1)%o]:(Cb.subVectors(s[0],s[1]).add(s[0]),d=Cb);const f=s[u%o],m=s[(u+1)%o];if(this.closed||u+2<o?p=s[(u+2)%o]:(Cb.subVectors(s[o-1],s[o-2]).add(s[o-1]),p=Cb),this.curveType==="centripetal"||this.curveType==="chordal"){const g=this.curveType==="chordal"?.5:.25;let y=Math.pow(d.distanceToSquared(f),g),x=Math.pow(f.distanceToSquared(m),g),v=Math.pow(m.distanceToSquared(p),g);x<1e-4&&(x=1),y<1e-4&&(y=x),v<1e-4&&(v=x),zS.initNonuniformCatmullRom(d.x,f.x,m.x,p.x,y,x,v),jS.initNonuniformCatmullRom(d.y,f.y,m.y,p.y,y,x,v),VS.initNonuniformCatmullRom(d.z,f.z,m.z,p.z,y,x,v)}else this.curveType==="catmullrom"&&(zS.initCatmullRom(d.x,f.x,m.x,p.x,this.tension),jS.initCatmullRom(d.y,f.y,m.y,p.y,this.tension),VS.initCatmullRom(d.z,f.z,m.z,p.z,this.tension));return n.set(zS.calc(c),jS.calc(c),VS.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){const s=this.points[i];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(new at().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function E4(r,e,i,n,s){const o=(n-e)*.5,l=(s-i)*.5,u=r*r,c=r*u;return(2*i-2*n+o+l)*c+(-3*i+3*n-2*o-l)*u+o*r+i}function Mte(r,e){const i=1-r;return i*i*e}function Rte(r,e){return 2*(1-r)*r*e}function Ite(r,e){return r*r*e}function gA(r,e,i,n){return Mte(r,e)+Rte(r,i)+Ite(r,n)}function Bte(r,e){const i=1-r;return i*i*i*e}function Nte(r,e){const i=1-r;return 3*i*i*r*e}function Lte(r,e){return 3*(1-r)*r*r*e}function Dte(r,e){return r*r*r*e}function AA(r,e,i,n,s){return Bte(r,e)+Nte(r,i)+Lte(r,n)+Dte(r,s)}class Ote extends Su{constructor(e=new zi,i=new zi,n=new zi,s=new zi){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=n,this.v3=s}getPoint(e,i=new zi){const n=i,s=this.v0,o=this.v1,l=this.v2,u=this.v3;return n.set(AA(e,s.x,o.x,l.x,u.x),AA(e,s.y,o.y,l.y,u.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class w4 extends Su{constructor(e=new at,i=new at,n=new at,s=new at){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=n,this.v3=s}getPoint(e,i=new at){const n=i,s=this.v0,o=this.v1,l=this.v2,u=this.v3;return n.set(AA(e,s.x,o.x,l.x,u.x),AA(e,s.y,o.y,l.y,u.y),AA(e,s.z,o.z,l.z,u.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Pte extends Su{constructor(e=new zi,i=new zi){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new zi){const n=i;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new zi){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Fte extends Su{constructor(e=new at,i=new at){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new at){const n=i;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new at){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class kte extends Su{constructor(e=new zi,i=new zi,n=new zi){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new zi){const n=i,s=this.v0,o=this.v1,l=this.v2;return n.set(gA(e,s.x,o.x,l.x),gA(e,s.y,o.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class GS extends Su{constructor(e=new at,i=new at,n=new at){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new at){const n=i,s=this.v0,o=this.v1,l=this.v2;return n.set(gA(e,s.x,o.x,l.x),gA(e,s.y,o.y,l.y),gA(e,s.z,o.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ute extends Su{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new zi){const n=i,s=this.points,o=(s.length-1)*e,l=Math.floor(o),u=o-l,c=s[l===0?l:l-1],d=s[l],p=s[l>s.length-2?s.length-1:l+1],f=s[l>s.length-3?s.length-1:l+2];return n.set(E4(u,c.x,d.x,p.x,f.x),E4(u,c.y,d.y,p.y,f.y)),n}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){const s=this.points[i];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(new zi().fromArray(s))}return this}}var zte=Object.freeze({__proto__:null,ArcCurve:Ste,CatmullRomCurve3:Tte,CubicBezierCurve:Ote,CubicBezierCurve3:w4,EllipseCurve:_4,LineCurve:Pte,LineCurve3:Fte,QuadraticBezierCurve:kte,QuadraticBezierCurve3:GS,SplineCurve:Ute});class Sb extends Po{constructor(e=1,i=1,n=1,s=32,o=1,l=!1,u=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:n,radialSegments:s,heightSegments:o,openEnded:l,thetaStart:u,thetaLength:c};const d=this;s=Math.floor(s),o=Math.floor(o);const p=[],f=[],m=[],g=[];let y=0;const x=[],v=n/2;let _=0;T(),l===!1&&(e>0&&w(!0),i>0&&w(!1)),this.setIndex(p),this.setAttribute("position",new la(f,3)),this.setAttribute("normal",new la(m,3)),this.setAttribute("uv",new la(g,2));function T(){const S=new at,R=new at;let B=0;const I=(i-e)/n;for(let D=0;D<=o;D++){const L=[],O=D/o,U=O*(i-e)+e;for(let J=0;J<=s;J++){const H=J/s,V=H*c+u,$=Math.sin(V),Q=Math.cos(V);R.x=U*$,R.y=-O*n+v,R.z=U*Q,f.push(R.x,R.y,R.z),S.set($,I,Q).normalize(),m.push(S.x,S.y,S.z),g.push(H,1-O),L.push(y++)}x.push(L)}for(let D=0;D<s;D++)for(let L=0;L<o;L++){const O=x[L][D],U=x[L+1][D],J=x[L+1][D+1],H=x[L][D+1];(e>0||L!==0)&&(p.push(O,U,H),B+=3),(i>0||L!==o-1)&&(p.push(U,J,H),B+=3)}d.addGroup(_,B,0),_+=B}function w(S){const R=y,B=new zi,I=new at;let D=0;const L=S===!0?e:i,O=S===!0?1:-1;for(let J=1;J<=s;J++)f.push(0,v*O,0),m.push(0,O,0),g.push(.5,.5),y++;const U=y;for(let J=0;J<=s;J++){const H=J/s*c+u,V=Math.cos(H),$=Math.sin(H);I.x=L*$,I.y=v*O,I.z=L*V,f.push(I.x,I.y,I.z),m.push(0,O,0),B.x=V*.5+.5,B.y=$*.5*O+.5,g.push(B.x,B.y),y++}for(let J=0;J<s;J++){const H=R+J,V=U+J;S===!0?p.push(V,V+1,H):p.push(V+1,V,H),D+=3}d.addGroup(_,D,S===!0?1:2),_+=D}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sb(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class HS extends Sb{constructor(e=1,i=1,n=32,s=1,o=!1,l=0,u=Math.PI*2){super(0,e,i,n,s,o,l,u),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:n,heightSegments:s,openEnded:o,thetaStart:l,thetaLength:u}}static fromJSON(e){return new HS(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}let Tb=class pG extends Po{constructor(e=1,i=32,n=16,s=0,o=Math.PI*2,l=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:s,phiLength:o,thetaStart:l,thetaLength:u},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const c=Math.min(l+u,Math.PI);let d=0;const p=[],f=new at,m=new at,g=[],y=[],x=[],v=[];for(let _=0;_<=n;_++){const T=[],w=_/n;let S=0;_===0&&l===0?S=.5/i:_===n&&c===Math.PI&&(S=-.5/i);for(let R=0;R<=i;R++){const B=R/i;f.x=-e*Math.cos(s+B*o)*Math.sin(l+w*u),f.y=e*Math.cos(l+w*u),f.z=e*Math.sin(s+B*o)*Math.sin(l+w*u),y.push(f.x,f.y,f.z),m.copy(f).normalize(),x.push(m.x,m.y,m.z),v.push(B+S,1-w),T.push(d++)}p.push(T)}for(let _=0;_<n;_++)for(let T=0;T<i;T++){const w=p[_][T+1],S=p[_][T],R=p[_+1][T],B=p[_+1][T+1];(_!==0||l>0)&&g.push(w,S,B),(_!==n-1||c<Math.PI)&&g.push(S,R,B)}this.setIndex(g),this.setAttribute("position",new la(y,3)),this.setAttribute("normal",new la(x,3)),this.setAttribute("uv",new la(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pG(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}};class WS extends Po{constructor(e=new GS(new at(-1,-1,0),new at(-1,1,0),new at(1,1,0)),i=64,n=1,s=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:n,radialSegments:s,closed:o};const l=e.computeFrenetFrames(i,o);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;const u=new at,c=new at,d=new zi;let p=new at;const f=[],m=[],g=[],y=[];x(),this.setIndex(y),this.setAttribute("position",new la(f,3)),this.setAttribute("normal",new la(m,3)),this.setAttribute("uv",new la(g,2));function x(){for(let w=0;w<i;w++)v(w);v(o===!1?i:0),T(),_()}function v(w){p=e.getPointAt(w/i,p);const S=l.normals[w],R=l.binormals[w];for(let B=0;B<=s;B++){const I=B/s*Math.PI*2,D=Math.sin(I),L=-Math.cos(I);c.x=L*S.x+D*R.x,c.y=L*S.y+D*R.y,c.z=L*S.z+D*R.z,c.normalize(),m.push(c.x,c.y,c.z),u.x=p.x+n*c.x,u.y=p.y+n*c.y,u.z=p.z+n*c.z,f.push(u.x,u.y,u.z)}}function _(){for(let w=1;w<=i;w++)for(let S=1;S<=s;S++){const R=(s+1)*(w-1)+(S-1),B=(s+1)*w+(S-1),I=(s+1)*w+S,D=(s+1)*(w-1)+S;y.push(R,B,D),y.push(B,I,D)}}function T(){for(let w=0;w<=i;w++)for(let S=0;S<=s;S++)d.x=w/i,d.y=S/s,g.push(d.x,d.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new WS(new zte[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}let jte=class extends lp{static get type(){return"MeshLambertMaterial"}constructor(r){super(),this.isMeshLambertMaterial=!0,this.color=new wn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=iP,this.normalScale=new zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Vh,this.combine=AC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}};const C4={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class Vte{constructor(e,i,n){const s=this;let o=!1,l=0,u=0,c;const d=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=n,this.itemStart=function(p){u++,o===!1&&s.onStart!==void 0&&s.onStart(p,l,u),o=!0},this.itemEnd=function(p){l++,s.onProgress!==void 0&&s.onProgress(p,l,u),l===u&&(o=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(p){s.onError!==void 0&&s.onError(p)},this.resolveURL=function(p){return c?c(p):p},this.setURLModifier=function(p){return c=p,this},this.addHandler=function(p,f){return d.push(p,f),this},this.removeHandler=function(p){const f=d.indexOf(p);return f!==-1&&d.splice(f,2),this},this.getHandler=function(p){for(let f=0,m=d.length;f<m;f+=2){const g=d[f],y=d[f+1];if(g.global&&(g.lastIndex=0),g.test(p))return y}return null}}}const Gte=new Vte;class QS{constructor(e){this.manager=e!==void 0?e:Gte,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const n=this;return new Promise(function(s,o){n.load(e,s,i,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}QS.DEFAULT_MATERIAL_NAME="__DEFAULT";class Hte extends QS{constructor(e){super(e)}load(e,i,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=C4.get(e);if(l!==void 0)return o.manager.itemStart(e),setTimeout(function(){i&&i(l),o.manager.itemEnd(e)},0),l;const u=sA("img");function c(){p(),C4.add(e,this),i&&i(this),o.manager.itemEnd(e)}function d(f){p(),s&&s(f),o.manager.itemError(e),o.manager.itemEnd(e)}function p(){u.removeEventListener("load",c,!1),u.removeEventListener("error",d,!1)}return u.addEventListener("load",c,!1),u.addEventListener("error",d,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(u.crossOrigin=this.crossOrigin),o.manager.itemStart(e),u.src=e,u}}class Wte extends QS{constructor(e){super(e)}load(e,i,n,s){const o=new Sl,l=new Hte(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,function(u){o.image=u,o.needsUpdate=!0,i!==void 0&&i(o)},n,s),o}}let S4=class extends Xa{constructor(r,e=1){super(),this.isLight=!0,this.type="Light",this.color=new wn(r),this.intensity=e}dispose(){}copy(r,e){return super.copy(r,e),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const e=super.toJSON(r);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}};const qS=new ps,T4=new at,M4=new at;let Qte=class{constructor(r){this.camera=r,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new zi(512,512),this.map=null,this.mapPass=null,this.matrix=new ps,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new CS,this._frameExtents=new zi(1,1),this._viewportCount=1,this._viewports=[new qs(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const e=this.camera,i=this.matrix;T4.setFromMatrixPosition(r.matrixWorld),e.position.copy(T4),M4.setFromMatrixPosition(r.target.matrixWorld),e.lookAt(M4),e.updateMatrixWorld(),qS.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qS),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(qS)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.intensity=r.intensity,this.bias=r.bias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.intensity!==1&&(r.intensity=this.intensity),this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}},qte=class extends Qte{constructor(){super(new SS(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Xte=class extends S4{constructor(r,e){super(r,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Xa.DEFAULT_UP),this.updateMatrix(),this.target=new Xa,this.shadow=new qte}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}},Yte=class extends S4{constructor(r,e){super(r,e),this.isAmbientLight=!0,this.type="AmbientLight"}};class R4{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=I4(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=I4();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function I4(){return performance.now()}const B4=new ps;class N4{constructor(e,i,n=0,s=1/0){this.ray=new $x(e,i),this.near=n,this.far=s,this.camera=null,this.layers=new dS,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return B4.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(B4),this}intersectObject(e,i=!0,n=[]){return XS(e,this,n,i),n.sort(L4),n}intersectObjects(e,i=!0,n=[]){for(let s=0,o=e.length;s<o;s++)XS(e[s],this,n,i);return n.sort(L4),n}}function L4(r,e){return r.distance-e.distance}function XS(r,e,i,n){let s=!0;if(r.layers.test(e.layers)&&r.raycast(e,i)===!1&&(s=!1),s===!0&&n===!0){const o=r.children;for(let l=0,u=o.length;l<u;l++)XS(o[l],e,i,!0)}}class D4{constructor(e=1,i=0,n=0){return this.radius=e,this.phi=i,this.theta=n,this}set(e,i,n){return this.radius=e,this.phi=i,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,n){return this.radius=Math.sqrt(e*e+i*i+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ba(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Mb extends rp{constructor(e,i=null){super(),this.object=e,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Fx}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Fx);class Vs{static roundNumber(e,i){const n=Math.pow(10,i);return Math.round(e*n)/n}static sample(e){return e[Math.floor(Math.random()*e.length)]}static distanceToSquared(e,i){var n=e.x-i.x,s=e.y-i.y,o=e.z-i.z;return n*n+s*s+o*o}static isPointInPoly(e,i){for(var n=!1,s=-1,o=e.length,l=o-1;++s<o;l=s)(e[s].z<=i.z&&i.z<e[l].z||e[l].z<=i.z&&i.z<e[s].z)&&i.x<(e[l].x-e[s].x)*(i.z-e[s].z)/(e[l].z-e[s].z)+e[s].x&&(n=!n);return n}static isVectorInPolygon(e,i,n){var s=1e5,o=-1e5,l=[];return i.vertexIds.forEach(u=>{s=Math.min(n[u].y,s),o=Math.max(n[u].y,o),l.push(n[u])}),!!(e.y<o+.5&&e.y>s-.5&&this.isPointInPoly(l,e))}static triarea2(e,i,n){return(n.x-e.x)*(i.z-e.z)-(i.x-e.x)*(n.z-e.z)}static vequal(e,i){return this.distanceToSquared(e,i)<1e-5}static mergeVertices(e,i=1e-4){i=Math.max(i,Number.EPSILON);for(var n={},s=e.getIndex(),o=e.getAttribute("position"),l=s?s.count:o.count,u=0,c=[],d=[],p=Math.log10(1/i),f=Math.pow(10,p),m=0;m<l;m++){var g=s?s.getX(m):m,y="";y+=~~(o.getX(g)*f)+",",y+=~~(o.getY(g)*f)+",",(y+=~~(o.getZ(g)*f)+",")in n?c.push(n[y]):(d.push(o.getX(g)),d.push(o.getY(g)),d.push(o.getZ(g)),n[y]=u,c.push(u),u++)}const x=new Oo(new Float32Array(d),o.itemSize,o.normalized),v=new Po;return v.setAttribute("position",x),v.setIndex(c),v}}class Kte{constructor(e){this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.sinkDown(this.content.length-1)}pop(){const e=this.content[0],i=this.content.pop();return this.content.length>0&&(this.content[0]=i,this.bubbleUp(0)),e}remove(e){const i=this.content.indexOf(e),n=this.content.pop();i!==this.content.length-1&&(this.content[i]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(i):this.bubbleUp(i))}size(){return this.content.length}rescoreElement(e){this.sinkDown(this.content.indexOf(e))}sinkDown(e){const i=this.content[e];for(;e>0;){const n=(e+1>>1)-1,s=this.content[n];if(!(this.scoreFunction(i)<this.scoreFunction(s)))break;this.content[n]=i,this.content[e]=s,e=n}}bubbleUp(e){const i=this.content.length,n=this.content[e],s=this.scoreFunction(n);for(;;){const o=e+1<<1,l=o-1;let u,c=null;if(l<i&&(u=this.scoreFunction(this.content[l]),u<s&&(c=l)),o<i&&this.scoreFunction(this.content[o])<(c===null?s:u)&&(c=o),c===null)break;this.content[e]=this.content[c],this.content[c]=n,e=c}}}class Jte{constructor(){this.portals=[]}push(e,i){i===void 0&&(i=e),this.portals.push({left:e,right:i})}stringPull(){const e=this.portals,i=[];let n,s,o,l=0,u=0,c=0;n=e[0].left,s=e[0].left,o=e[0].right,i.push(n);for(let d=1;d<e.length;d++){const p=e[d].left,f=e[d].right;if(Vs.triarea2(n,o,f)<=0){if(!(Vs.vequal(n,o)||Vs.triarea2(n,s,f)>0)){i.push(s),n=s,l=u,s=n,o=n,u=l,c=l,d=l;continue}o=f,c=d}if(Vs.triarea2(n,s,p)>=0){if(!(Vs.vequal(n,s)||Vs.triarea2(n,o,p)<0)){i.push(o),n=o,l=c,s=n,o=n,u=l,c=l,d=l;continue}s=p,u=d}}return i.length!==0&&Vs.vequal(i[i.length-1],e[e.length-1].left)||i.push(e[e.length-1].left),this.path=i,i}}class YS{constructor(){this.zones={}}static createZone(e,i=1e-4){return(class{static buildZone(n,s){const o=this._buildNavigationMesh(n,s),l={};o.vertices.forEach(c=>{c.x=Vs.roundNumber(c.x,2),c.y=Vs.roundNumber(c.y,2),c.z=Vs.roundNumber(c.z,2)}),l.vertices=o.vertices;const u=this._buildPolygonGroups(o);return l.groups=new Array(u.length),u.forEach((c,d)=>{const p=new Map;c.forEach((m,g)=>{p.set(m,g)});const f=new Array(c.length);c.forEach((m,g)=>{const y=[];m.neighbours.forEach(_=>y.push(p.get(_)));const x=[];m.neighbours.forEach(_=>x.push(this._getSharedVerticesInOrder(m,_)));const v=new at(0,0,0);v.add(l.vertices[m.vertexIds[0]]),v.add(l.vertices[m.vertexIds[1]]),v.add(l.vertices[m.vertexIds[2]]),v.divideScalar(3),v.x=Vs.roundNumber(v.x,2),v.y=Vs.roundNumber(v.y,2),v.z=Vs.roundNumber(v.z,2),f[g]={id:g,neighbours:y,vertexIds:m.vertexIds,centroid:v,portals:x}}),l.groups[d]=f}),l}static _buildNavigationMesh(n,s){return n=Vs.mergeVertices(n,s),this._buildPolygonsFromGeometry(n)}static _spreadGroupId(n){let s=new Set([n]);for(;s.size>0;){const o=s;s=new Set,o.forEach(l=>{l.group=n.group,l.neighbours.forEach(u=>{u.group===void 0&&s.add(u)})})}}static _buildPolygonGroups(n){const s=[];return n.polygons.forEach(o=>{o.group!==void 0?s[o.group].push(o):(o.group=s.length,this._spreadGroupId(o),s.push([o]))}),s}static _buildPolygonNeighbours(n,s){const o=new Set,l=s[n.vertexIds[1]],u=s[n.vertexIds[2]];return s[n.vertexIds[0]].forEach(c=>{c!==n&&(l.includes(c)||u.includes(c))&&o.add(c)}),l.forEach(c=>{c!==n&&u.includes(c)&&o.add(c)}),o}static _buildPolygonsFromGeometry(n){const s=[],o=[],l=n.attributes.position,u=n.index,c=[];for(let d=0;d<l.count;d++)o.push(new at().fromBufferAttribute(l,d)),c[d]=[];for(let d=0;d<n.index.count;d+=3){const p=u.getX(d),f=u.getX(d+1),m=u.getX(d+2),g={vertexIds:[p,f,m],neighbours:null};s.push(g),c[p].push(g),c[f].push(g),c[m].push(g)}return s.forEach(d=>{d.neighbours=this._buildPolygonNeighbours(d,c)}),{polygons:s,vertices:o}}static _getSharedVerticesInOrder(n,s){const o=n.vertexIds,l=o[0],u=o[1],c=o[2],d=s.vertexIds,p=d.includes(l),f=d.includes(u),m=d.includes(c);return p&&f&&m?Array.from(o):p&&f?[l,u]:f&&m?[u,c]:p&&m?[c,l]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}).buildZone(e,i)}setZoneData(e,i){this.zones[e]=i}getRandomNode(e,i,n,s){if(!this.zones[e])return new at;n=n||null,s=s||0;const o=[];return this.zones[e].groups[i].forEach(l=>{n&&s?Vs.distanceToSquared(n,l.centroid)<s*s&&o.push(l.centroid):o.push(l.centroid)}),Vs.sample(o)||new at}getClosestNode(e,i,n,s=!1){const o=this.zones[i].vertices;let l=null,u=1/0;return this.zones[i].groups[n].forEach(c=>{const d=Vs.distanceToSquared(c.centroid,e);d<u&&(!s||Vs.isVectorInPolygon(e,c,o))&&(l=c,u=d)}),l}findPath(e,i,n,s){const o=this.zones[n].groups[s],l=this.zones[n].vertices,u=this.getClosestNode(e,n,s,!0),c=this.getClosestNode(i,n,s,!0);if(!u||!c)return null;const d=(class{static init(g){for(let y=0;y<g.length;y++){const x=g[y];x.f=0,x.g=0,x.h=0,x.cost=1,x.visited=!1,x.closed=!1,x.parent=null}}static cleanUp(g){for(let y=0;y<g.length;y++){const x=g[y];delete x.f,delete x.g,delete x.h,delete x.cost,delete x.visited,delete x.closed,delete x.parent}}static heap(){return new Kte(function(g){return g.f})}static search(g,y,x){this.init(g);const v=this.heap();for(v.push(y);v.size()>0;){const _=v.pop();if(_===x){let w=_;const S=[];for(;w.parent;)S.push(w),w=w.parent;return this.cleanUp(S),S.reverse()}_.closed=!0;const T=this.neighbours(g,_);for(let w=0,S=T.length;w<S;w++){const R=T[w];if(R.closed)continue;const B=_.g+R.cost,I=R.visited;if(!I||B<R.g){if(R.visited=!0,R.parent=_,!R.centroid||!x.centroid)throw new Error("Unexpected state");R.h=R.h||this.heuristic(R.centroid,x.centroid),R.g=B,R.f=R.g+R.h,I?v.rescoreElement(R):v.push(R)}}}return[]}static heuristic(g,y){return Vs.distanceToSquared(g,y)}static neighbours(g,y){const x=[];for(let v=0;v<y.neighbours.length;v++)x.push(g[y.neighbours[v]]);return x}}).search(o,u,c),p=function(g,y){for(var x=0;x<g.neighbours.length;x++)if(g.neighbours[x]===y.id)return g.portals[x]},f=new Jte;f.push(e);for(let g=0;g<d.length;g++){const y=d[g],x=d[g+1];if(x){const v=p(y,x);f.push(l[v[0]],l[v[1]])}}f.push(i),f.stringPull();const m=f.path.map(g=>new at(g.x,g.y,g.z));return m.shift(),m}}YS.prototype.getGroup=function(){const r=new ic;return function(e,i,n=!1){if(!this.zones[e])return null;let s=null,o=Math.pow(50,2);const l=this.zones[e];for(let u=0;u<l.groups.length;u++){const c=l.groups[u];for(const d of c){if(n&&(r.setFromCoplanarPoints(l.vertices[d.vertexIds[0]],l.vertices[d.vertexIds[1]],l.vertices[d.vertexIds[2]]),Math.abs(r.distanceToPoint(i))<.01)&&Vs.isPointInPoly([l.vertices[d.vertexIds[0]],l.vertices[d.vertexIds[1]],l.vertices[d.vertexIds[2]]],i))return u;const p=Vs.distanceToSquared(d.centroid,i);p<o&&(s=u,o=p)}}return s}}(),YS.prototype.clampStep=function(){const r=new at,e=new ic,i=new op,n=new at;let s,o,l=new at;return function(u,c,d,p,f,m){const g=this.zones[p].vertices,y=this.zones[p].groups[f],x=[d],v={};v[d.id]=0,s=void 0,l.set(0,0,0),o=1/0,e.setFromCoplanarPoints(g[d.vertexIds[0]],g[d.vertexIds[1]],g[d.vertexIds[2]]),e.projectPoint(c,r),n.copy(r);for(let _=x.pop();_;_=x.pop()){i.set(g[_.vertexIds[0]],g[_.vertexIds[1]],g[_.vertexIds[2]]),i.closestPointToPoint(n,r),r.distanceToSquared(n)<o&&(s=_,l.copy(r),o=r.distanceToSquared(n));const T=v[_.id];if(!(T>2))for(let w=0;w<_.neighbours.length;w++){const S=y[_.neighbours[w]];S.id in v||(x.push(S),v[S.id]=T+1)}}return m.copy(l),s}}();class Zte extends Xa{constructor(){super(),this._playerMarker=new La(new Tb(.25,32,32),new Hh({color:15631215})),this._targetMarker=new La(new Em(.3,.3,.3),new Hh({color:14469912})),this._nodeMarker=new La(new Em(.1,.8,.1),new Hh({color:4417387})),this._stepMarker=new La(new Em(.1,1,.1),new Hh({color:14472114})),this._pathMarker=new Xa,this._pathLineMaterial=new FS({color:41903,linewidth:2}),this._pathPointMaterial=new Hh({color:41903}),this._pathPointGeometry=new Tb(.08),this._markers=[this._playerMarker,this._targetMarker,this._nodeMarker,this._stepMarker,this._pathMarker],this._markers.forEach(e=>{e.visible=!1,this.add(e)})}setPath(e){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);e=[this._playerMarker.position].concat(e);const i=new Po;i.setAttribute("position",new Oo(new Float32Array(3*e.length),3));for(let n=0;n<e.length;n++)i.attributes.position.setXYZ(n,e[n].x,e[n].y+.2,e[n].z);this._pathMarker.add(new b4(i,this._pathLineMaterial));for(let n=0;n<e.length-1;n++){const s=new La(this._pathPointGeometry,this._pathPointMaterial);s.position.copy(e[n]),s.position.y+=.2,this._pathMarker.add(s)}return this._pathMarker.visible=!0,this}setPlayerPosition(e){return this._playerMarker.position.copy(e),this._playerMarker.visible=!0,this}setTargetPosition(e){return this._targetMarker.position.copy(e),this._targetMarker.visible=!0,this}setNodePosition(e){return this._nodeMarker.position.copy(e),this._nodeMarker.visible=!0,this}setStepPosition(e){return this._stepMarker.position.copy(e),this._stepMarker.visible=!0,this}reset(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach(e=>{e.visible=!1}),this}}const $te=Object.freeze(Object.defineProperty({__proto__:null,Pathfinding:YS,PathfindingHelper:Zte},Symbol.toStringTag,{value:"Module"})),eie=i2($te),{Pathfinding:O4}=eie,yA=new O4,vA="level";AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(r){this.navMesh=new THREE.Mesh(r),yA.setZoneData(vA,O4.createZone(r)),Array.from(this.agents).forEach(e=>e.updateNavLocation())},getNavMesh:function(){return this.navMesh},addAgent:function(r){this.agents.add(r)},removeAgent:function(r){this.agents.delete(r)},getPath:function(r,e,i){return this.navMesh?yA.findPath(r,e,vA,i):null},getGroup:function(r){return this.navMesh?yA.getGroup(vA,r):null},getNode:function(r,e){return this.navMesh?yA.getClosestNode(r,vA,e,!0):null},clampStep:function(r,e,i,n,s){if(this.navMesh){if(!n)return s.copy(e),this.getNode(e,i)}else return s.copy(e),null;return yA.clampStep(r,e,n,vA,i,s)}}),AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}}),AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){const r=this.el,e=this.data;let i=r.components.material;const n=new THREE.PlaneGeometry(e.width,e.depth,e.density,e.density);this.waves=[];const s=n.getAttribute("position");for(let o=0;o<s.count;o++)this.waves.push({z:s.getZ(o),ang:Math.random()*Math.PI*2,amp:e.amplitude+Math.random()*e.amplitudeVariance,speed:(e.speed+Math.random()*e.speedVariance)/1e3});i||(i={},i.material=new THREE.MeshPhongMaterial({color:e.color,transparent:e.opacity<1,opacity:e.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(n,i.material),r.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(r,e){if(!e)return;const i=this.mesh.geometry.getAttribute("position");for(let n=0;n<i.count;n++){const s=this.waves[n],o=s.z+Math.sin(s.ang)*s.amp;i.setZ(n,o),s.ang+=s.speed*e}i.needsUpdate=!0}}),AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){const r=this.el,e=this.data;let i=r.components.material;if(!e.path.length){console.error("[a-tube] `path` property expected but not found.");return}const n=new THREE.CatmullRomCurve3(e.path.map(function(o){return o=o.split(" "),new THREE.Vector3(Number(o[0]),Number(o[1]),Number(o[2]))})),s=new THREE.TubeGeometry(n,e.segments,e.radius,e.radialSegments,e.closed);i||(i={},i.material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(s,i.material),this.el.setObject3D("mesh",this.mesh)},update:function(r){Object.keys(r).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}});var mr=function(r){return typeof r=="function"?r:typeof r=="string"?function(e){return e[r]}:function(e){return r}};const tie=Object.freeze(Object.defineProperty({__proto__:null,default:mr},Symbol.toStringTag,{value:"Module"})),iie=i2(tie);function P4(r,e,i){var n,s=1;r==null&&(r=0),e==null&&(e=0),i==null&&(i=0);function o(){var l,u=n.length,c,d=0,p=0,f=0;for(l=0;l<u;++l)c=n[l],d+=c.x||0,p+=c.y||0,f+=c.z||0;for(d=(d/u-r)*s,p=(p/u-e)*s,f=(f/u-i)*s,l=0;l<u;++l)c=n[l],d&&(c.x-=d),p&&(c.y-=p),f&&(c.z-=f)}return o.initialize=function(l){n=l},o.x=function(l){return arguments.length?(r=+l,o):r},o.y=function(l){return arguments.length?(e=+l,o):e},o.z=function(l){return arguments.length?(i=+l,o):i},o.strength=function(l){return arguments.length?(s=+l,o):s},o}function rie(r){const e=+this._x.call(null,r);return F4(this.cover(e),e,r)}function F4(r,e,i){if(isNaN(e))return r;var n,s=r._root,o={data:i},l=r._x0,u=r._x1,c,d,p,f,m;if(!s)return r._root=o,r;for(;s.length;)if((p=e>=(c=(l+u)/2))?l=c:u=c,n=s,!(s=s[f=+p]))return n[f]=o,r;if(d=+r._x.call(null,s.data),e===d)return o.next=s,n?n[f]=o:r._root=o,r;do n=n?n[f]=new Array(2):r._root=new Array(2),(p=e>=(c=(l+u)/2))?l=c:u=c;while((f=+p)==(m=+(d>=c)));return n[m]=s,n[f]=o,r}function nie(r){Array.isArray(r)||(r=Array.from(r));const e=r.length,i=new Float64Array(e);let n=1/0,s=-1/0;for(let o=0,l;o<e;++o)isNaN(l=+this._x.call(null,r[o]))||(i[o]=l,l<n&&(n=l),l>s&&(s=l));if(n>s)return this;this.cover(n).cover(s);for(let o=0;o<e;++o)F4(this,i[o],r[o]);return this}function sie(r){if(isNaN(r=+r))return this;var e=this._x0,i=this._x1;if(isNaN(e))i=(e=Math.floor(r))+1;else{for(var n=i-e||1,s=this._root,o,l;e>r||r>=i;)switch(l=+(r<e),o=new Array(2),o[l]=s,s=o,n*=2,l){case 0:i=e+n;break;case 1:e=i-n;break}this._root&&this._root.length&&(this._root=s)}return this._x0=e,this._x1=i,this}function aie(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function oie(r){return arguments.length?this.cover(+r[0][0]).cover(+r[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Tu(r,e,i){this.node=r,this.x0=e,this.x1=i}function lie(r,e){var i,n=this._x0,s,o,l=this._x1,u=[],c=this._root,d,p;for(c&&u.push(new Tu(c,n,l)),e==null?e=1/0:(n=r-e,l=r+e);d=u.pop();)if(!(!(c=d.node)||(s=d.x0)>l||(o=d.x1)<n))if(c.length){var f=(s+o)/2;u.push(new Tu(c[1],f,o),new Tu(c[0],s,f)),(p=+(r>=f))&&(d=u[u.length-1],u[u.length-1]=u[u.length-1-p],u[u.length-1-p]=d)}else{var m=Math.abs(r-+this._x.call(null,c.data));m<e&&(e=m,n=r-m,l=r+m,i=c.data)}return i}function cie(r){if(isNaN(c=+this._x.call(null,r)))return this;var e,i=this._root,n,s,o,l=this._x0,u=this._x1,c,d,p,f,m;if(!i)return this;if(i.length)for(;;){if((p=c>=(d=(l+u)/2))?l=d:u=d,e=i,!(i=i[f=+p]))return this;if(!i.length)break;e[f+1&1]&&(n=e,m=f)}for(;i.data!==r;)if(s=i,!(i=i.next))return this;return(o=i.next)&&delete i.next,s?(o?s.next=o:delete s.next,this):e?(o?e[f]=o:delete e[f],(i=e[0]||e[1])&&i===(e[1]||e[0])&&!i.length&&(n?n[m]=i:this._root=i),this):(this._root=o,this)}function uie(r){for(var e=0,i=r.length;e<i;++e)this.remove(r[e]);return this}function hie(){return this._root}function die(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function pie(r){var e=[],i,n=this._root,s,o,l;for(n&&e.push(new Tu(n,this._x0,this._x1));i=e.pop();)if(!r(n=i.node,o=i.x0,l=i.x1)&&n.length){var u=(o+l)/2;(s=n[1])&&e.push(new Tu(s,u,l)),(s=n[0])&&e.push(new Tu(s,o,u))}return this}function fie(r){var e=[],i=[],n;for(this._root&&e.push(new Tu(this._root,this._x0,this._x1));n=e.pop();){var s=n.node;if(s.length){var o,l=n.x0,u=n.x1,c=(l+u)/2;(o=s[0])&&e.push(new Tu(o,l,c)),(o=s[1])&&e.push(new Tu(o,c,u))}i.push(n)}for(;n=i.pop();)r(n.node,n.x0,n.x1);return this}function mie(r){return r[0]}function gie(r){return arguments.length?(this._x=r,this):this._x}function k4(r,e){var i=new KS(e??mie,NaN,NaN);return r==null?i:i.addAll(r)}function KS(r,e,i){this._x=r,this._x0=e,this._x1=i,this._root=void 0}function U4(r){for(var e={data:r.data},i=e;r=r.next;)i=i.next={data:r.data};return e}var Fo=k4.prototype=KS.prototype;Fo.copy=function(){var r=new KS(this._x,this._x0,this._x1),e=this._root,i,n;if(!e)return r;if(!e.length)return r._root=U4(e),r;for(i=[{source:e,target:r._root=new Array(2)}];e=i.pop();)for(var s=0;s<2;++s)(n=e.source[s])&&(n.length?i.push({source:n,target:e.target[s]=new Array(2)}):e.target[s]=U4(n));return r},Fo.add=rie,Fo.addAll=nie,Fo.cover=sie,Fo.data=aie,Fo.extent=oie,Fo.find=lie,Fo.remove=cie,Fo.removeAll=uie,Fo.root=hie,Fo.size=die,Fo.visit=pie,Fo.visitAfter=fie,Fo.x=gie;function Aie(r){const e=+this._x.call(null,r),i=+this._y.call(null,r);return z4(this.cover(e,i),e,i,r)}function z4(r,e,i,n){if(isNaN(e)||isNaN(i))return r;var s,o=r._root,l={data:n},u=r._x0,c=r._y0,d=r._x1,p=r._y1,f,m,g,y,x,v,_,T;if(!o)return r._root=l,r;for(;o.length;)if((x=e>=(f=(u+d)/2))?u=f:d=f,(v=i>=(m=(c+p)/2))?c=m:p=m,s=o,!(o=o[_=v<<1|x]))return s[_]=l,r;if(g=+r._x.call(null,o.data),y=+r._y.call(null,o.data),e===g&&i===y)return l.next=o,s?s[_]=l:r._root=l,r;do s=s?s[_]=new Array(4):r._root=new Array(4),(x=e>=(f=(u+d)/2))?u=f:d=f,(v=i>=(m=(c+p)/2))?c=m:p=m;while((_=v<<1|x)===(T=(y>=m)<<1|g>=f));return s[T]=o,s[_]=l,r}function yie(r){var e,i,n=r.length,s,o,l=new Array(n),u=new Array(n),c=1/0,d=1/0,p=-1/0,f=-1/0;for(i=0;i<n;++i)isNaN(s=+this._x.call(null,e=r[i]))||isNaN(o=+this._y.call(null,e))||(l[i]=s,u[i]=o,s<c&&(c=s),s>p&&(p=s),o<d&&(d=o),o>f&&(f=o));if(c>p||d>f)return this;for(this.cover(c,d).cover(p,f),i=0;i<n;++i)z4(this,l[i],u[i],r[i]);return this}function vie(r,e){if(isNaN(r=+r)||isNaN(e=+e))return this;var i=this._x0,n=this._y0,s=this._x1,o=this._y1;if(isNaN(i))s=(i=Math.floor(r))+1,o=(n=Math.floor(e))+1;else{for(var l=s-i||1,u=this._root,c,d;i>r||r>=s||n>e||e>=o;)switch(d=(e<n)<<1|r<i,c=new Array(4),c[d]=u,u=c,l*=2,d){case 0:s=i+l,o=n+l;break;case 1:i=s-l,o=n+l;break;case 2:s=i+l,n=o-l;break;case 3:i=s-l,n=o-l;break}this._root&&this._root.length&&(this._root=u)}return this._x0=i,this._y0=n,this._x1=s,this._y1=o,this}function xie(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function bie(r){return arguments.length?this.cover(+r[0][0],+r[0][1]).cover(+r[1][0],+r[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function mo(r,e,i,n,s){this.node=r,this.x0=e,this.y0=i,this.x1=n,this.y1=s}function _ie(r,e,i){var n,s=this._x0,o=this._y0,l,u,c,d,p=this._x1,f=this._y1,m=[],g=this._root,y,x;for(g&&m.push(new mo(g,s,o,p,f)),i==null?i=1/0:(s=r-i,o=e-i,p=r+i,f=e+i,i*=i);y=m.pop();)if(!(!(g=y.node)||(l=y.x0)>p||(u=y.y0)>f||(c=y.x1)<s||(d=y.y1)<o))if(g.length){var v=(l+c)/2,_=(u+d)/2;m.push(new mo(g[3],v,_,c,d),new mo(g[2],l,_,v,d),new mo(g[1],v,u,c,_),new mo(g[0],l,u,v,_)),(x=(e>=_)<<1|r>=v)&&(y=m[m.length-1],m[m.length-1]=m[m.length-1-x],m[m.length-1-x]=y)}else{var T=r-+this._x.call(null,g.data),w=e-+this._y.call(null,g.data),S=T*T+w*w;if(S<i){var R=Math.sqrt(i=S);s=r-R,o=e-R,p=r+R,f=e+R,n=g.data}}return n}function Eie(r){if(isNaN(p=+this._x.call(null,r))||isNaN(f=+this._y.call(null,r)))return this;var e,i=this._root,n,s,o,l=this._x0,u=this._y0,c=this._x1,d=this._y1,p,f,m,g,y,x,v,_;if(!i)return this;if(i.length)for(;;){if((y=p>=(m=(l+c)/2))?l=m:c=m,(x=f>=(g=(u+d)/2))?u=g:d=g,e=i,!(i=i[v=x<<1|y]))return this;if(!i.length)break;(e[v+1&3]||e[v+2&3]||e[v+3&3])&&(n=e,_=v)}for(;i.data!==r;)if(s=i,!(i=i.next))return this;return(o=i.next)&&delete i.next,s?(o?s.next=o:delete s.next,this):e?(o?e[v]=o:delete e[v],(i=e[0]||e[1]||e[2]||e[3])&&i===(e[3]||e[2]||e[1]||e[0])&&!i.length&&(n?n[_]=i:this._root=i),this):(this._root=o,this)}function wie(r){for(var e=0,i=r.length;e<i;++e)this.remove(r[e]);return this}function Cie(){return this._root}function Sie(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function Tie(r){var e=[],i,n=this._root,s,o,l,u,c;for(n&&e.push(new mo(n,this._x0,this._y0,this._x1,this._y1));i=e.pop();)if(!r(n=i.node,o=i.x0,l=i.y0,u=i.x1,c=i.y1)&&n.length){var d=(o+u)/2,p=(l+c)/2;(s=n[3])&&e.push(new mo(s,d,p,u,c)),(s=n[2])&&e.push(new mo(s,o,p,d,c)),(s=n[1])&&e.push(new mo(s,d,l,u,p)),(s=n[0])&&e.push(new mo(s,o,l,d,p))}return this}function Mie(r){var e=[],i=[],n;for(this._root&&e.push(new mo(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var s=n.node;if(s.length){var o,l=n.x0,u=n.y0,c=n.x1,d=n.y1,p=(l+c)/2,f=(u+d)/2;(o=s[0])&&e.push(new mo(o,l,u,p,f)),(o=s[1])&&e.push(new mo(o,p,u,c,f)),(o=s[2])&&e.push(new mo(o,l,f,p,d)),(o=s[3])&&e.push(new mo(o,p,f,c,d))}i.push(n)}for(;n=i.pop();)r(n.node,n.x0,n.y0,n.x1,n.y1);return this}function Rie(r){return r[0]}function Iie(r){return arguments.length?(this._x=r,this):this._x}function Bie(r){return r[1]}function Nie(r){return arguments.length?(this._y=r,this):this._y}function j4(r,e,i){var n=new JS(e??Rie,i??Bie,NaN,NaN,NaN,NaN);return r==null?n:n.addAll(r)}function JS(r,e,i,n,s,o){this._x=r,this._y=e,this._x0=i,this._y0=n,this._x1=s,this._y1=o,this._root=void 0}function V4(r){for(var e={data:r.data},i=e;r=r.next;)i=i.next={data:r.data};return e}var go=j4.prototype=JS.prototype;go.copy=function(){var r=new JS(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,i,n;if(!e)return r;if(!e.length)return r._root=V4(e),r;for(i=[{source:e,target:r._root=new Array(4)}];e=i.pop();)for(var s=0;s<4;++s)(n=e.source[s])&&(n.length?i.push({source:n,target:e.target[s]=new Array(4)}):e.target[s]=V4(n));return r},go.add=Aie,go.addAll=yie,go.cover=vie,go.data=xie,go.extent=bie,go.find=_ie,go.remove=Eie,go.removeAll=wie,go.root=Cie,go.size=Sie,go.visit=Tie,go.visitAfter=Mie,go.x=Iie,go.y=Nie;function Lie(r){const e=+this._x.call(null,r),i=+this._y.call(null,r),n=+this._z.call(null,r);return G4(this.cover(e,i,n),e,i,n,r)}function G4(r,e,i,n,s){if(isNaN(e)||isNaN(i)||isNaN(n))return r;var o,l=r._root,u={data:s},c=r._x0,d=r._y0,p=r._z0,f=r._x1,m=r._y1,g=r._z1,y,x,v,_,T,w,S,R,B,I,D;if(!l)return r._root=u,r;for(;l.length;)if((S=e>=(y=(c+f)/2))?c=y:f=y,(R=i>=(x=(d+m)/2))?d=x:m=x,(B=n>=(v=(p+g)/2))?p=v:g=v,o=l,!(l=l[I=B<<2|R<<1|S]))return o[I]=u,r;if(_=+r._x.call(null,l.data),T=+r._y.call(null,l.data),w=+r._z.call(null,l.data),e===_&&i===T&&n===w)return u.next=l,o?o[I]=u:r._root=u,r;do o=o?o[I]=new Array(8):r._root=new Array(8),(S=e>=(y=(c+f)/2))?c=y:f=y,(R=i>=(x=(d+m)/2))?d=x:m=x,(B=n>=(v=(p+g)/2))?p=v:g=v;while((I=B<<2|R<<1|S)===(D=(w>=v)<<2|(T>=x)<<1|_>=y));return o[D]=l,o[I]=u,r}function Die(r){Array.isArray(r)||(r=Array.from(r));const e=r.length,i=new Float64Array(e),n=new Float64Array(e),s=new Float64Array(e);let o=1/0,l=1/0,u=1/0,c=-1/0,d=-1/0,p=-1/0;for(let f=0,m,g,y,x;f<e;++f)isNaN(g=+this._x.call(null,m=r[f]))||isNaN(y=+this._y.call(null,m))||isNaN(x=+this._z.call(null,m))||(i[f]=g,n[f]=y,s[f]=x,g<o&&(o=g),g>c&&(c=g),y<l&&(l=y),y>d&&(d=y),x<u&&(u=x),x>p&&(p=x));if(o>c||l>d||u>p)return this;this.cover(o,l,u).cover(c,d,p);for(let f=0;f<e;++f)G4(this,i[f],n[f],s[f],r[f]);return this}function Oie(r,e,i){if(isNaN(r=+r)||isNaN(e=+e)||isNaN(i=+i))return this;var n=this._x0,s=this._y0,o=this._z0,l=this._x1,u=this._y1,c=this._z1;if(isNaN(n))l=(n=Math.floor(r))+1,u=(s=Math.floor(e))+1,c=(o=Math.floor(i))+1;else{for(var d=l-n||1,p=this._root,f,m;n>r||r>=l||s>e||e>=u||o>i||i>=c;)switch(m=(i<o)<<2|(e<s)<<1|r<n,f=new Array(8),f[m]=p,p=f,d*=2,m){case 0:l=n+d,u=s+d,c=o+d;break;case 1:n=l-d,u=s+d,c=o+d;break;case 2:l=n+d,s=u-d,c=o+d;break;case 3:n=l-d,s=u-d,c=o+d;break;case 4:l=n+d,u=s+d,o=c-d;break;case 5:n=l-d,u=s+d,o=c-d;break;case 6:l=n+d,s=u-d,o=c-d;break;case 7:n=l-d,s=u-d,o=c-d;break}this._root&&this._root.length&&(this._root=p)}return this._x0=n,this._y0=s,this._z0=o,this._x1=l,this._y1=u,this._z1=c,this}function Pie(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function Fie(r){return arguments.length?this.cover(+r[0][0],+r[0][1],+r[0][2]).cover(+r[1][0],+r[1][1],+r[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function ls(r,e,i,n,s,o,l){this.node=r,this.x0=e,this.y0=i,this.z0=n,this.x1=s,this.y1=o,this.z1=l}function kie(r,e,i,n){var s,o=this._x0,l=this._y0,u=this._z0,c,d,p,f,m,g,y=this._x1,x=this._y1,v=this._z1,_=[],T=this._root,w,S;for(T&&_.push(new ls(T,o,l,u,y,x,v)),n==null?n=1/0:(o=r-n,l=e-n,u=i-n,y=r+n,x=e+n,v=i+n,n*=n);w=_.pop();)if(!(!(T=w.node)||(c=w.x0)>y||(d=w.y0)>x||(p=w.z0)>v||(f=w.x1)<o||(m=w.y1)<l||(g=w.z1)<u))if(T.length){var R=(c+f)/2,B=(d+m)/2,I=(p+g)/2;_.push(new ls(T[7],R,B,I,f,m,g),new ls(T[6],c,B,I,R,m,g),new ls(T[5],R,d,I,f,B,g),new ls(T[4],c,d,I,R,B,g),new ls(T[3],R,B,p,f,m,I),new ls(T[2],c,B,p,R,m,I),new ls(T[1],R,d,p,f,B,I),new ls(T[0],c,d,p,R,B,I)),(S=(i>=I)<<2|(e>=B)<<1|r>=R)&&(w=_[_.length-1],_[_.length-1]=_[_.length-1-S],_[_.length-1-S]=w)}else{var D=r-+this._x.call(null,T.data),L=e-+this._y.call(null,T.data),O=i-+this._z.call(null,T.data),U=D*D+L*L+O*O;if(U<n){var J=Math.sqrt(n=U);o=r-J,l=e-J,u=i-J,y=r+J,x=e+J,v=i+J,s=T.data}}return s}function Uie(r){if(isNaN(m=+this._x.call(null,r))||isNaN(g=+this._y.call(null,r))||isNaN(y=+this._z.call(null,r)))return this;var e,i=this._root,n,s,o,l=this._x0,u=this._y0,c=this._z0,d=this._x1,p=this._y1,f=this._z1,m,g,y,x,v,_,T,w,S,R,B;if(!i)return this;if(i.length)for(;;){if((T=m>=(x=(l+d)/2))?l=x:d=x,(w=g>=(v=(u+p)/2))?u=v:p=v,(S=y>=(_=(c+f)/2))?c=_:f=_,e=i,!(i=i[R=S<<2|w<<1|T]))return this;if(!i.length)break;(e[R+1&7]||e[R+2&7]||e[R+3&7]||e[R+4&7]||e[R+5&7]||e[R+6&7]||e[R+7&7])&&(n=e,B=R)}for(;i.data!==r;)if(s=i,!(i=i.next))return this;return(o=i.next)&&delete i.next,s?(o?s.next=o:delete s.next,this):e?(o?e[R]=o:delete e[R],(i=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&i===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!i.length&&(n?n[B]=i:this._root=i),this):(this._root=o,this)}function zie(r){for(var e=0,i=r.length;e<i;++e)this.remove(r[e]);return this}function jie(){return this._root}function Vie(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function Gie(r){var e=[],i,n=this._root,s,o,l,u,c,d,p;for(n&&e.push(new ls(n,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=e.pop();)if(!r(n=i.node,o=i.x0,l=i.y0,u=i.z0,c=i.x1,d=i.y1,p=i.z1)&&n.length){var f=(o+c)/2,m=(l+d)/2,g=(u+p)/2;(s=n[7])&&e.push(new ls(s,f,m,g,c,d,p)),(s=n[6])&&e.push(new ls(s,o,m,g,f,d,p)),(s=n[5])&&e.push(new ls(s,f,l,g,c,m,p)),(s=n[4])&&e.push(new ls(s,o,l,g,f,m,p)),(s=n[3])&&e.push(new ls(s,f,m,u,c,d,g)),(s=n[2])&&e.push(new ls(s,o,m,u,f,d,g)),(s=n[1])&&e.push(new ls(s,f,l,u,c,m,g)),(s=n[0])&&e.push(new ls(s,o,l,u,f,m,g))}return this}function Hie(r){var e=[],i=[],n;for(this._root&&e.push(new ls(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=e.pop();){var s=n.node;if(s.length){var o,l=n.x0,u=n.y0,c=n.z0,d=n.x1,p=n.y1,f=n.z1,m=(l+d)/2,g=(u+p)/2,y=(c+f)/2;(o=s[0])&&e.push(new ls(o,l,u,c,m,g,y)),(o=s[1])&&e.push(new ls(o,m,u,c,d,g,y)),(o=s[2])&&e.push(new ls(o,l,g,c,m,p,y)),(o=s[3])&&e.push(new ls(o,m,g,c,d,p,y)),(o=s[4])&&e.push(new ls(o,l,u,y,m,g,f)),(o=s[5])&&e.push(new ls(o,m,u,y,d,g,f)),(o=s[6])&&e.push(new ls(o,l,g,y,m,p,f)),(o=s[7])&&e.push(new ls(o,m,g,y,d,p,f))}i.push(n)}for(;n=i.pop();)r(n.node,n.x0,n.y0,n.z0,n.x1,n.y1,n.z1);return this}function Wie(r){return r[0]}function Qie(r){return arguments.length?(this._x=r,this):this._x}function qie(r){return r[1]}function Xie(r){return arguments.length?(this._y=r,this):this._y}function Yie(r){return r[2]}function Kie(r){return arguments.length?(this._z=r,this):this._z}function H4(r,e,i,n){var s=new ZS(e??Wie,i??qie,n??Yie,NaN,NaN,NaN,NaN,NaN,NaN);return r==null?s:s.addAll(r)}function ZS(r,e,i,n,s,o,l,u,c){this._x=r,this._y=e,this._z=i,this._x0=n,this._y0=s,this._z0=o,this._x1=l,this._y1=u,this._z1=c,this._root=void 0}function W4(r){for(var e={data:r.data},i=e;r=r.next;)i=i.next={data:r.data};return e}var Ka=H4.prototype=ZS.prototype;Ka.copy=function(){var r=new ZS(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,i,n;if(!e)return r;if(!e.length)return r._root=W4(e),r;for(i=[{source:e,target:r._root=new Array(8)}];e=i.pop();)for(var s=0;s<8;++s)(n=e.source[s])&&(n.length?i.push({source:n,target:e.target[s]=new Array(8)}):e.target[s]=W4(n));return r},Ka.add=Lie,Ka.addAll=Die,Ka.cover=Oie,Ka.data=Pie,Ka.extent=Fie,Ka.find=kie,Ka.remove=Uie,Ka.removeAll=zie,Ka.root=jie,Ka.size=Vie,Ka.visit=Gie,Ka.visitAfter=Hie,Ka.x=Qie,Ka.y=Xie,Ka.z=Kie;function Mu(r){return function(){return r}}function Ru(r){return(r()-.5)*1e-6}function Jie(r){return r.index}function Q4(r,e){var i=r.get(e);if(!i)throw new Error("node not found: "+e);return i}function q4(r){var e=Jie,i=m,n,s=Mu(30),o,l,u,c,d,p,f=1;r==null&&(r=[]);function m(_){return 1/Math.min(c[_.source.index],c[_.target.index])}function g(_){for(var T=0,w=r.length;T<f;++T)for(var S=0,R,B,I,D=0,L=0,O=0,U,J;S<w;++S)R=r[S],B=R.source,I=R.target,D=I.x+I.vx-B.x-B.vx||Ru(p),u>1&&(L=I.y+I.vy-B.y-B.vy||Ru(p)),u>2&&(O=I.z+I.vz-B.z-B.vz||Ru(p)),U=Math.sqrt(D*D+L*L+O*O),U=(U-o[S])/U*_*n[S],D*=U,L*=U,O*=U,I.vx-=D*(J=d[S]),u>1&&(I.vy-=L*J),u>2&&(I.vz-=O*J),B.vx+=D*(J=1-J),u>1&&(B.vy+=L*J),u>2&&(B.vz+=O*J)}function y(){if(l){var _,T=l.length,w=r.length,S=new Map(l.map((B,I)=>[e(B,I,l),B])),R;for(_=0,c=new Array(T);_<w;++_)R=r[_],R.index=_,typeof R.source!="object"&&(R.source=Q4(S,R.source)),typeof R.target!="object"&&(R.target=Q4(S,R.target)),c[R.source.index]=(c[R.source.index]||0)+1,c[R.target.index]=(c[R.target.index]||0)+1;for(_=0,d=new Array(w);_<w;++_)R=r[_],d[_]=c[R.source.index]/(c[R.source.index]+c[R.target.index]);n=new Array(w),x(),o=new Array(w),v()}}function x(){if(l)for(var _=0,T=r.length;_<T;++_)n[_]=+i(r[_],_,r)}function v(){if(l)for(var _=0,T=r.length;_<T;++_)o[_]=+s(r[_],_,r)}return g.initialize=function(_,...T){l=_,p=T.find(w=>typeof w=="function")||Math.random,u=T.find(w=>[1,2,3].includes(w))||2,y()},g.links=function(_){return arguments.length?(r=_,y(),g):r},g.id=function(_){return arguments.length?(e=_,g):e},g.iterations=function(_){return arguments.length?(f=+_,g):f},g.strength=function(_){return arguments.length?(i=typeof _=="function"?_:Mu(+_),x(),g):i},g.distance=function(_){return arguments.length?(s=typeof _=="function"?_:Mu(+_),v(),g):s},g}var Zie={value:()=>{}};function xA(){for(var r=0,e=arguments.length,i={},n;r<e;++r){if(!(n=arguments[r]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new Rb(i)}function Rb(r){this._=r}function $ie(r,e){return r.trim().split(/^|\s+/).map(function(i){var n="",s=i.indexOf(".");if(s>=0&&(n=i.slice(s+1),i=i.slice(0,s)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}Rb.prototype=xA.prototype={constructor:Rb,on:function(r,e){var i=this._,n=$ie(r+"",i),s,o=-1,l=n.length;if(arguments.length<2){for(;++o<l;)if((s=(r=n[o]).type)&&(s=ere(i[s],r.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<l;)if(s=(r=n[o]).type)i[s]=X4(i[s],r.name,e);else if(e==null)for(s in i)i[s]=X4(i[s],r.name,null);return this},copy:function(){var r={},e=this._;for(var i in e)r[i]=e[i].slice();return new Rb(r)},call:function(r,e){if((s=arguments.length-2)>0)for(var i=new Array(s),n=0,s,o;n<s;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(o=this._[r],n=0,s=o.length;n<s;++n)o[n].value.apply(e,i)},apply:function(r,e,i){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var n=this._[r],s=0,o=n.length;s<o;++s)n[s].value.apply(e,i)}};function ere(r,e){for(var i=0,n=r.length,s;i<n;++i)if((s=r[i]).name===e)return s.value}function X4(r,e,i){for(var n=0,s=r.length;n<s;++n)if(r[n].name===e){r[n]=Zie,r=r.slice(0,n).concat(r.slice(n+1));break}return i!=null&&r.push({name:e,value:i}),r}var Om=0,bA=0,_A=0,Y4=1e3,Ib,EA,Bb=0,mp=0,Nb=0,wA=typeof performance=="object"&&performance.now?performance:Date,K4=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function $S(){return mp||(K4(tre),mp=wA.now()+Nb)}function tre(){mp=0}function Lb(){this._call=this._time=this._next=null}Lb.prototype=eT.prototype={constructor:Lb,restart:function(r,e,i){if(typeof r!="function")throw new TypeError("callback is not a function");i=(i==null?$S():+i)+(e==null?0:+e),!this._next&&EA!==this&&(EA?EA._next=this:Ib=this,EA=this),this._call=r,this._time=i,tT()},stop:function(){this._call&&(this._call=null,this._time=1/0,tT())}};function eT(r,e,i){var n=new Lb;return n.restart(r,e,i),n}function ire(){$S(),++Om;for(var r=Ib,e;r;)(e=mp-r._time)>=0&&r._call.call(void 0,e),r=r._next;--Om}function J4(){mp=(Bb=wA.now())+Nb,Om=bA=0;try{ire()}finally{Om=0,nre(),mp=0}}function rre(){var r=wA.now(),e=r-Bb;e>Y4&&(Nb-=e,Bb=r)}function nre(){for(var r,e=Ib,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),r=e,e=e._next):(i=e._next,e._next=null,e=r?r._next=i:Ib=i);EA=r,tT(n)}function tT(r){if(!Om){bA&&(bA=clearTimeout(bA));var e=r-mp;e>24?(r<1/0&&(bA=setTimeout(J4,r-wA.now()-Nb)),_A&&(_A=clearInterval(_A))):(_A||(Bb=wA.now(),_A=setInterval(rre,Y4)),Om=1,K4(J4))}}function Z4(r,e,i){var n=new Lb;return e=e==null?0:+e,n.restart(s=>{n.stop(),r(s+e)},e,i),n}const sre=1664525,are=1013904223,$4=4294967296;function ore(){let r=1;return()=>(r=(sre*r+are)%$4)/$4}var eF=3;function iT(r){return r.x}function tF(r){return r.y}function lre(r){return r.z}var cre=10,ure=Math.PI*(3-Math.sqrt(5)),hre=Math.PI*20/(9+Math.sqrt(221));function iF(r,e){e=e||2;var i=Math.min(eF,Math.max(1,Math.round(e))),n,s=1,o=.001,l=1-Math.pow(o,1/300),u=0,c=.6,d=new Map,p=eT(g),f=xA("tick","end"),m=ore();r==null&&(r=[]);function g(){y(),f.call("tick",n),s<o&&(p.stop(),f.call("end",n))}function y(_){var T,w=r.length,S;_===void 0&&(_=1);for(var R=0;R<_;++R)for(s+=(u-s)*l,d.forEach(function(B){B(s)}),T=0;T<w;++T)S=r[T],S.fx==null?S.x+=S.vx*=c:(S.x=S.fx,S.vx=0),i>1&&(S.fy==null?S.y+=S.vy*=c:(S.y=S.fy,S.vy=0)),i>2&&(S.fz==null?S.z+=S.vz*=c:(S.z=S.fz,S.vz=0));return n}function x(){for(var _=0,T=r.length,w;_<T;++_){if(w=r[_],w.index=_,w.fx!=null&&(w.x=w.fx),w.fy!=null&&(w.y=w.fy),w.fz!=null&&(w.z=w.fz),isNaN(w.x)||i>1&&isNaN(w.y)||i>2&&isNaN(w.z)){var S=cre*(i>2?Math.cbrt(.5+_):i>1?Math.sqrt(.5+_):_),R=_*ure,B=_*hre;i===1?w.x=S:i===2?(w.x=S*Math.cos(R),w.y=S*Math.sin(R)):(w.x=S*Math.sin(R)*Math.cos(B),w.y=S*Math.cos(R),w.z=S*Math.sin(R)*Math.sin(B))}(isNaN(w.vx)||i>1&&isNaN(w.vy)||i>2&&isNaN(w.vz))&&(w.vx=0,i>1&&(w.vy=0),i>2&&(w.vz=0))}}function v(_){return _.initialize&&_.initialize(r,m,i),_}return x(),n={tick:y,restart:function(){return p.restart(g),n},stop:function(){return p.stop(),n},numDimensions:function(_){return arguments.length?(i=Math.min(eF,Math.max(1,Math.round(_))),d.forEach(v),n):i},nodes:function(_){return arguments.length?(r=_,x(),d.forEach(v),n):r},alpha:function(_){return arguments.length?(s=+_,n):s},alphaMin:function(_){return arguments.length?(o=+_,n):o},alphaDecay:function(_){return arguments.length?(l=+_,n):+l},alphaTarget:function(_){return arguments.length?(u=+_,n):u},velocityDecay:function(_){return arguments.length?(c=1-_,n):1-c},randomSource:function(_){return arguments.length?(m=_,d.forEach(v),n):m},force:function(_,T){return arguments.length>1?(T==null?d.delete(_):d.set(_,v(T)),n):d.get(_)},find:function(){var _=Array.prototype.slice.call(arguments),T=_.shift()||0,w=(i>1?_.shift():null)||0,S=(i>2?_.shift():null)||0,R=_.shift()||1/0,B=0,I=r.length,D,L,O,U,J,H;for(R*=R,B=0;B<I;++B)J=r[B],D=T-J.x,L=w-(J.y||0),O=S-(J.z||0),U=D*D+L*L+O*O,U<R&&(H=J,R=U);return H},on:function(_,T){return arguments.length>1?(f.on(_,T),n):f.on(_)}}}function rF(){var r,e,i,n,s,o=Mu(-30),l,u=1,c=1/0,d=.81;function p(y){var x,v=r.length,_=(e===1?k4(r,iT):e===2?j4(r,iT,tF):e===3?H4(r,iT,tF,lre):null).visitAfter(m);for(s=y,x=0;x<v;++x)i=r[x],_.visit(g)}function f(){if(r){var y,x=r.length,v;for(l=new Array(x),y=0;y<x;++y)v=r[y],l[v.index]=+o(v,y,r)}}function m(y){var x=0,v,_,T=0,w,S,R,B,I=y.length;if(I){for(w=S=R=B=0;B<I;++B)(v=y[B])&&(_=Math.abs(v.value))&&(x+=v.value,T+=_,w+=_*(v.x||0),S+=_*(v.y||0),R+=_*(v.z||0));x*=Math.sqrt(4/I),y.x=w/T,e>1&&(y.y=S/T),e>2&&(y.z=R/T)}else{v=y,v.x=v.data.x,e>1&&(v.y=v.data.y),e>2&&(v.z=v.data.z);do x+=l[v.data.index];while(v=v.next)}y.value=x}function g(y,x,v,_,T){if(!y.value)return!0;var w=[v,_,T][e-1],S=y.x-i.x,R=e>1?y.y-i.y:0,B=e>2?y.z-i.z:0,I=w-x,D=S*S+R*R+B*B;if(I*I/d<D)return D<c&&(S===0&&(S=Ru(n),D+=S*S),e>1&&R===0&&(R=Ru(n),D+=R*R),e>2&&B===0&&(B=Ru(n),D+=B*B),D<u&&(D=Math.sqrt(u*D)),i.vx+=S*y.value*s/D,e>1&&(i.vy+=R*y.value*s/D),e>2&&(i.vz+=B*y.value*s/D)),!0;if(!(y.length||D>=c)){(y.data!==i||y.next)&&(S===0&&(S=Ru(n),D+=S*S),e>1&&R===0&&(R=Ru(n),D+=R*R),e>2&&B===0&&(B=Ru(n),D+=B*B),D<u&&(D=Math.sqrt(u*D)));do y.data!==i&&(I=l[y.data.index]*s/D,i.vx+=S*I,e>1&&(i.vy+=R*I),e>2&&(i.vz+=B*I));while(y=y.next)}}return p.initialize=function(y,...x){r=y,n=x.find(v=>typeof v=="function")||Math.random,e=x.find(v=>[1,2,3].includes(v))||2,f()},p.strength=function(y){return arguments.length?(o=typeof y=="function"?y:Mu(+y),f(),p):o},p.distanceMin=function(y){return arguments.length?(u=y*y,p):Math.sqrt(u)},p.distanceMax=function(y){return arguments.length?(c=y*y,p):Math.sqrt(c)},p.theta=function(y){return arguments.length?(d=y*y,p):Math.sqrt(d)},p}function nF(r,e,i,n){var s,o,l=Mu(.1),u,c;typeof r!="function"&&(r=Mu(+r)),e==null&&(e=0),i==null&&(i=0),n==null&&(n=0);function d(f){for(var m=0,g=s.length;m<g;++m){var y=s[m],x=y.x-e||1e-6,v=(y.y||0)-i||1e-6,_=(y.z||0)-n||1e-6,T=Math.sqrt(x*x+v*v+_*_),w=(c[m]-T)*u[m]*f/T;y.vx+=x*w,o>1&&(y.vy+=v*w),o>2&&(y.vz+=_*w)}}function p(){if(s){var f,m=s.length;for(u=new Array(m),c=new Array(m),f=0;f<m;++f)c[f]=+r(s[f],f,s),u[f]=isNaN(c[f])?0:+l(s[f],f,s)}}return d.initialize=function(f,...m){s=f,o=m.find(g=>[1,2,3].includes(g))||2,p()},d.strength=function(f){return arguments.length?(l=typeof f=="function"?f:Mu(+f),p(),d):l},d.radius=function(f){return arguments.length?(r=typeof f=="function"?f:Mu(+f),p(),d):r},d.x=function(f){return arguments.length?(e=+f,d):e},d.y=function(f){return arguments.length?(i=+f,d):i},d.z=function(f){return arguments.length?(n=+f,d):n},d}var rT=function(r){pre(r);var e=dre(r);return r.on=e.on,r.off=e.off,r.fire=e.fire,r};function dre(r){var e=Object.create(null);return{on:function(i,n,s){if(typeof n!="function")throw new Error("callback is expected to be a function");var o=e[i];return o||(o=e[i]=[]),o.push({callback:n,ctx:s}),r},off:function(i,n){var s=typeof i>"u";if(s)return e=Object.create(null),r;if(e[i]){var o=typeof n!="function";if(o)delete e[i];else for(var l=e[i],u=0;u<l.length;++u)l[u].callback===n&&l.splice(u,1)}return r},fire:function(i){var n=e[i];if(!n)return r;var s;arguments.length>1&&(s=Array.prototype.splice.call(arguments,1));for(var o=0;o<n.length;++o){var l=n[o];l.callback.apply(l.ctx,s)}return r}}}function pre(r){if(!r)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],i=0;i<e.length;++i)if(r.hasOwnProperty(e[i]))throw new Error("Subject cannot be eventified, since it already has property '"+e[i]+"'")}var fre=gre,mre=rT;function gre(r){if(r=r||{},"uniqueLinkId"in r&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),r.multigraph=r.uniqueLinkId),r.multigraph===void 0&&(r.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,i=new Map,n={},s=0,o=r.multigraph?S:w,l=[],u=Q,c=Q,d=Q,p=Q,f={version:20,addNode:x,addLink:T,removeLink:D,removeNode:_,getNode:v,getNodeCount:R,getLinkCount:B,getEdgeCount:B,getLinksCount:B,getNodesCount:R,getLinks:I,forEachNode:ie,forEachLinkedNode:H,forEachLink:J,beginUpdate:d,endUpdate:p,clear:U,hasLink:O,hasNode:v,getLink:O};return mre(f),m(),f;function m(){var Y=f.on;f.on=ae;function ae(){return f.beginUpdate=d=G,f.endUpdate=p=j,u=g,c=y,f.on=Y,Y.apply(f,arguments)}}function g(Y,ae){l.push({link:Y,changeType:ae})}function y(Y,ae){l.push({node:Y,changeType:ae})}function x(Y,ae){if(Y===void 0)throw new Error("Invalid node identifier");d();var xe=v(Y);return xe?(xe.data=ae,c(xe,"update")):(xe=new Are(Y,ae),c(xe,"add")),e.set(Y,xe),p(),xe}function v(Y){return e.get(Y)}function _(Y){var ae=v(Y);if(!ae)return!1;d();var xe=ae.links;return xe&&(xe.forEach(L),ae.links=null),e.delete(Y),c(ae,"remove"),p(),!0}function T(Y,ae,xe){d();var fe=v(Y)||x(Y),de=v(ae)||x(ae),Ie=o(Y,ae,xe),Ge=i.has(Ie.id);return i.set(Ie.id,Ie),sF(fe,Ie),Y!==ae&&sF(de,Ie),u(Ie,Ge?"update":"add"),p(),Ie}function w(Y,ae,xe){var fe=Db(Y,ae),de=i.get(fe);return de?(de.data=xe,de):new aF(Y,ae,xe,fe)}function S(Y,ae,xe){var fe=Db(Y,ae),de=n.hasOwnProperty(fe);if(de||O(Y,ae)){de||(n[fe]=0);var Ie="@"+ ++n[fe];fe=Db(Y+Ie,ae+Ie)}return new aF(Y,ae,xe,fe)}function R(){return e.size}function B(){return i.size}function I(Y){var ae=v(Y);return ae?ae.links:null}function D(Y,ae){return ae!==void 0&&(Y=O(Y,ae)),L(Y)}function L(Y){if(!Y||!i.get(Y.id))return!1;d(),i.delete(Y.id);var ae=v(Y.fromId),xe=v(Y.toId);return ae&&ae.links.delete(Y),xe&&xe.links.delete(Y),u(Y,"remove"),p(),!0}function O(Y,ae){if(!(Y===void 0||ae===void 0))return i.get(Db(Y,ae))}function U(){d(),ie(function(Y){_(Y.id)}),p()}function J(Y){if(typeof Y=="function")for(var ae=i.values(),xe=ae.next();!xe.done;){if(Y(xe.value))return!0;xe=ae.next()}}function H(Y,ae,xe){var fe=v(Y);if(fe&&fe.links&&typeof ae=="function")return xe?$(fe.links,Y,ae):V(fe.links,Y,ae)}function V(Y,ae,xe){for(var fe,de=Y.values(),Ie=de.next();!Ie.done;){var Ge=Ie.value,Xe=Ge.fromId===ae?Ge.toId:Ge.fromId;if(fe=xe(e.get(Xe),Ge),fe)return!0;Ie=de.next()}}function $(Y,ae,xe){for(var fe,de=Y.values(),Ie=de.next();!Ie.done;){var Ge=Ie.value;if(Ge.fromId===ae&&(fe=xe(e.get(Ge.toId),Ge),fe))return!0;Ie=de.next()}}function Q(){}function G(){s+=1}function j(){s-=1,s===0&&l.length>0&&(f.fire("changed",l),l.length=0)}function ie(Y){if(typeof Y!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+Y);for(var ae=e.values(),xe=ae.next();!xe.done;){if(Y(xe.value))return!0;xe=ae.next()}}}function Are(r,e){this.id=r,this.links=null,this.data=e}function sF(r,e){r.links?r.links.add(e):r.links=new Set([e])}function aF(r,e,i,n){this.fromId=r,this.toId=e,this.data=i,this.id=n}function Db(r,e){return r.toString()+" "+e.toString()}const yre=t2(fre);var nT={exports:{}},CA={exports:{}},oF=function(r){return r===0?"x":r===1?"y":r===2?"z":"c"+(r+1)};const vre=oF;var Pm=function(r){return e;function e(i,n){let s=n&&n.indent||0,o=n&&n.join!==void 0?n.join:`
`,l=Array(s+1).join(" "),u=[];for(let c=0;c<r;++c){let d=vre(c),p=c===0?"":l;u.push(p+i.replace(/{var}/g,d))}return u.join(o)}};const lF=Pm;CA.exports=xre,CA.exports.generateCreateBodyFunctionBody=cF,CA.exports.getVectorCode=hF,CA.exports.getBodyCode=uF;function xre(r,e){let i=cF(r,e),{Body:n}=new Function(i)();return n}function cF(r,e){return`
${hF(r,e)}
${uF(r)}
return {Body: Body, Vector: Vector};
`}function uF(r){let e=lF(r),i=e("{var}",{join:", "});return`
function Body(${i}) {
  this.isPinned = false;
  this.pos = new Vector(${i});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${i}) {
  ${e("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function hF(r,e){let i=lF(r),n="";return e&&(n=`${i(`
   var v{var};
Object.defineProperty(this, '{var}', {
  set: function(v) { 
    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
    v{var} = v; 
  },
  get: function() { return v{var}; }
});`)}`),`function Vector(${i("{var}",{join:", "})}) {
  ${n}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${i('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${i("this.{var} = v.{var};",{indent:4})}
    } else {
      ${i('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${i("this.{var} = ",{join:""})}0;
  };`}var bre=CA.exports,Qh={exports:{}};const sT=Pm,qh=oF;Qh.exports=_re,Qh.exports.generateQuadTreeFunctionBody=dF,Qh.exports.getInsertStackCode=AF,Qh.exports.getQuadNodeCode=gF,Qh.exports.isSamePosition=pF,Qh.exports.getChildBodyCode=mF,Qh.exports.setChildBodyCode=fF;function _re(r){let e=dF(r);return new Function(e)()}function dF(r){let e=sT(r),i=Math.pow(2,r);return`
${AF()}
${gF(r)}
${pF(r)}
${mF(r)}
${fF(r)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${o("      node.")}
      node.body = null;
      node.mass = ${e("node.mass_{var} = ",{join:""})}0;
      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${e("var d{var};",{indent:4})}
    var r; 
    ${e("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${e("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < , treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${qh(0)} - node.min_${qh(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${e("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${s()}
        }
      }
    }

    ${e("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${e("root.min_{var} = {var}min;",{indent:4})}
    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${e("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${e("var min_{var} = node.min_{var};",{indent:8})}
        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${n(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${e("child.min_{var} = min_{var};",{indent:10})}
          ${e("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function n(l){let u=[],c=Array(l+1).join(" ");for(let d=0;d<r;++d)u.push(c+`if (${qh(d)} > max_${qh(d)}) {`),u.push(c+`  quadIdx = quadIdx + ${Math.pow(2,d)};`),u.push(c+`  min_${qh(d)} = max_${qh(d)};`),u.push(c+`  max_${qh(d)} = node.max_${qh(d)};`),u.push(c+"}");return u.join(`
`)}function s(){let l=Array(11).join(" "),u=[];for(let c=0;c<i;++c)u.push(l+`if (node.quad${c}) {`),u.push(l+`  queue[pushIdx] = node.quad${c};`),u.push(l+"  queueLength += 1;"),u.push(l+"  pushIdx += 1;"),u.push(l+"}");return u.join(`
`)}function o(l){let u=[];for(let c=0;c<i;++c)u.push(`${l}quad${c} = null;`);return u.join(`
`)}}function pF(r){let e=sT(r);return`
  function isSamePosition(point1, point2) {
    ${e("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${e("d{var} < 1e-8",{join:" && "})};
  }  
`}function fF(r){var e=Math.pow(2,r);return`
function setChild(node, idx, child) {
  ${i()}
}`;function i(){let n=[];for(let s=0;s<e;++s){let o=s===0?"  ":"  else ";n.push(`${o}if (idx === ${s}) node.quad${s} = child;`)}return n.join(`
`)}}function mF(r){return`function getChild(node, idx) {
${e()}
  return null;
}`;function e(){let i=[],n=Math.pow(2,r);for(let s=0;s<n;++s)i.push(`  if (idx === ${s}) return node.quad${s};`);return i.join(`
`)}}function gF(r){let e=sT(r),i=Math.pow(2,r);var n=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${s("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${e("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${e("this.min_{var} = 0;",{indent:2})}
  ${e("this.max_{var} = 0;",{indent:2})}
}
`;return n;function s(o){let l=[];for(let u=0;u<i;++u)l.push(`${o}quad${u} = null;`);return l.join(`
`)}}function AF(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}var Ere=Qh.exports,aT={exports:{}};aT.exports=Cre,aT.exports.generateFunctionBody=yF;const wre=Pm;function Cre(r){let e=yF(r);return new Function("bodies","settings","random",e)}function yF(r){let e=wre(r);return`
  var boundingBox = {
    ${e("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${e("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${e("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${e("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${e("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${e("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${e("var max_{var} = -Infinity;",{indent:4})}
    ${e("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${e("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${e("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${e("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${e("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${e("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}var Sre=aT.exports,oT={exports:{}};const Tre=Pm;oT.exports=Mre,oT.exports.generateCreateDragForceFunctionBody=vF;function Mre(r){let e=vF(r);return new Function("options",e)}function vF(r){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${Tre(r)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}var Rre=oT.exports,lT={exports:{}};const Ire=Pm;lT.exports=Bre,lT.exports.generateCreateSpringForceFunctionBody=xF;function Bre(r){let e=xF(r);return new Function("options","random",e)}function xF(r){let e=Ire(r);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${e("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${e("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${e("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}var Nre=lT.exports,cT={exports:{}};const Lre=Pm;cT.exports=Dre,cT.exports.generateIntegratorFunctionBody=bF;function Dre(r){let e=bF(r);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)}function bF(r){let e=Lre(r);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${e("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${e("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${e("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${e("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${e("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${e("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${e("body.pos.{var} += d{var};",{indent:4})}

    ${e("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${e("t{var} * t{var}",{join:" + "})})/length;
`}var Ore=cT.exports,uT,_F;function Pre(){if(_F)return uT;_F=1,uT=r;function r(e,i,n,s){this.from=e,this.to=i,this.length=n,this.coefficient=s}return uT}var hT,EF;function Fre(){if(EF)return hT;EF=1,hT=r;function r(e,i){var n;if(e||(e={}),i){for(n in i)if(i.hasOwnProperty(n)){var s=e.hasOwnProperty(n),o=typeof i[n],l=!s||typeof e[n]!==o;l?e[n]=i[n]:o==="object"&&(e[n]=r(e[n],i[n]))}}return e}return hT}var SA={exports:{}},wF;function kre(){if(wF)return SA.exports;wF=1,SA.exports=r,SA.exports.random=r,SA.exports.randomIterator=u;function r(c){var d=typeof c=="number"?c:+new Date;return new e(d)}function e(c){this.seed=c}e.prototype.next=l,e.prototype.nextDouble=o,e.prototype.uniform=o,e.prototype.gaussian=i;function i(){var c,d,p;do d=this.nextDouble()*2-1,p=this.nextDouble()*2-1,c=d*d+p*p;while(c>=1||c===0);return d*Math.sqrt(-2*Math.log(c)/c)}e.prototype.levy=n;function n(){var c=1.5,d=Math.pow(s(1+c)*Math.sin(Math.PI*c/2)/(s((1+c)/2)*c*Math.pow(2,(c-1)/2)),1/c);return this.gaussian()*d/Math.pow(Math.abs(this.gaussian()),1/c)}function s(c){return Math.sqrt(2*Math.PI/c)*Math.pow(1/Math.E*(c+1/(12*c-1/(10*c))),c)}function o(){var c=this.seed;return c=c+2127912214+(c<<12)&4294967295,c=(c^3345072700^c>>>19)&4294967295,c=c+374761393+(c<<5)&4294967295,c=(c+3550635116^c<<9)&4294967295,c=c+4251993797+(c<<3)&4294967295,c=(c^3042594569^c>>>16)&4294967295,this.seed=c,(c&268435455)/268435456}function l(c){return Math.floor(this.nextDouble()*c)}function u(c,d){var p=d||r();if(typeof p.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:m,shuffle:f};function f(){var g,y,x;for(g=c.length-1;g>0;--g)y=p.next(g+1),x=c[y],c[y]=c[g],c[g]=x;return c}function m(g){var y,x,v;for(y=c.length-1;y>0;--y)x=p.next(y+1),v=c[x],c[x]=c[y],c[y]=v,g(v);c.length&&g(c[0])}}return SA.exports}var CF=Wre,Ure=bre,zre=Ere,jre=Sre,Vre=Rre,Gre=Nre,Hre=Ore,SF={};function Wre(r){var e=Pre(),i=Fre(),n=rT;if(r){if(r.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(r.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}r=i(r,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var s=SF[r.dimensions];if(!s){var o=r.dimensions;s={Body:Ure(o,r.debug),createQuadTree:zre(o),createBounds:jre(o),createDragForce:Vre(o),createSpringForce:Gre(o),integrate:Hre(o)},SF[o]=s}var l=s.Body,u=s.createQuadTree,c=s.createBounds,d=s.createDragForce,p=s.createSpringForce,f=s.integrate,m=$=>new l($),g=kre().random(42),y=[],x=[],v=u(r,g),_=c(y,r,g),T=p(r,g),w=d(r),S=0,R=[],B=new Map,I=0;O("nbody",H),O("spring",V);var D={bodies:y,quadTree:v,springs:x,settings:r,addForce:O,removeForce:U,getForces:J,step:function(){for(var $=0;$<R.length;++$)R[$](I);var Q=f(y,r.timeStep,r.adaptiveTimeStepWeight);return I+=1,Q},addBody:function($){if(!$)throw new Error("Body is required");return y.push($),$},addBodyAt:function($){if(!$)throw new Error("Body position is required");var Q=m($);return y.push(Q),Q},removeBody:function($){if($){var Q=y.indexOf($);if(!(Q<0))return y.splice(Q,1),y.length===0&&_.reset(),!0}},addSpring:function($,Q,G,j){if(!$||!Q)throw new Error("Cannot add null spring to force simulator");typeof G!="number"&&(G=-1);var ie=new e($,Q,G,j>=0?j:-1);return x.push(ie),ie},getTotalMovement:function(){return S},removeSpring:function($){if($){var Q=x.indexOf($);if(Q>-1)return x.splice(Q,1),!0}},getBestNewBodyPosition:function($){return _.getBestNewPosition($)},getBBox:L,getBoundingBox:L,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function($){return $!==void 0?(r.gravity=$,v.options({gravity:$}),this):r.gravity},theta:function($){return $!==void 0?(r.theta=$,v.options({theta:$}),this):r.theta},random:g};return Qre(r,D),n(D),D;function L(){return _.update(),_.box}function O($,Q){if(B.has($))throw new Error("Force "+$+" is already added");B.set($,Q),R.push(Q)}function U($){var Q=R.indexOf(B.get($));Q<0||(R.splice(Q,1),B.delete($))}function J(){return B}function H(){if(y.length!==0){v.insertBodies(y);for(var $=y.length;$--;){var Q=y[$];Q.isPinned||(Q.reset(),v.updateBodyForce(Q),w.update(Q))}}}function V(){for(var $=x.length;$--;)T.update(x[$])}}function Qre(r,e){for(var i in r)qre(r,e,i)}function qre(r,e,i){if(r.hasOwnProperty(i)&&typeof e[i]!="function"){var n=Number.isFinite(r[i]);n?e[i]=function(s){if(s!==void 0){if(!Number.isFinite(s))throw new Error("Value of "+i+" should be a valid number.");return r[i]=s,e}return r[i]}:e[i]=function(s){return s!==void 0?(r[i]=s,e):r[i]}}}nT.exports=Yre,nT.exports.simulator=CF;var Xre=rT;function Yre(r,e){if(!r)throw new Error("Graph structure cannot be undefined");var i=e&&e.createSimulator||CF,n=i(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var s=r.version>19?H:J;e&&typeof e.nodeMass=="function"&&(s=e.nodeMass);var o=new Map,l={},u=0,c=n.settings.springTransform||Kre;w(),v();var d=!1,p={step:function(){if(u===0)return f(!0),!0;var V=n.step();p.lastMove=V,p.fire("step");var $=V/u,Q=$<=.01;return f(Q),Q},getNodePosition:function(V){return U(V).pos},setNodePosition:function(V){var $=U(V);$.setPosition.apply($,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(V){var $=l[V];if($)return{from:$.from.pos,to:$.to.pos}},getGraphRect:function(){return n.getBBox()},forEachBody:m,pinNode:function(V,$){var Q=U(V.id);Q.isPinned=!!$},isNodePinned:function(V){return U(V.id).isPinned},dispose:function(){r.off("changed",T),p.fire("disposed")},getBody:x,getSpring:y,getForceVectorLength:g,simulator:n,graph:r,lastMove:0};return Xre(p),p;function f(V){d!==V&&(d=V,_(V))}function m(V){o.forEach(V)}function g(){var V=0,$=0;return m(function(Q){V+=Math.abs(Q.force.x),$+=Math.abs(Q.force.y)}),Math.sqrt(V*V+$*$)}function y(V,$){var Q;if($===void 0)typeof V!="object"?Q=V:Q=V.id;else{var G=r.hasLink(V,$);if(!G)return;Q=G.id}return l[Q]}function x(V){return o.get(V)}function v(){r.on("changed",T)}function _(V){p.fire("stable",V)}function T(V){for(var $=0;$<V.length;++$){var Q=V[$];Q.changeType==="add"?(Q.node&&S(Q.node.id),Q.link&&B(Q.link)):Q.changeType==="remove"&&(Q.node&&R(Q.node),Q.link&&I(Q.link))}u=r.getNodesCount()}function w(){u=0,r.forEachNode(function(V){S(V.id),u+=1}),r.forEachLink(B)}function S(V){var $=o.get(V);if(!$){var Q=r.getNode(V);if(!Q)throw new Error("initBody() was called with unknown node id");var G=Q.position;if(!G){var j=D(Q);G=n.getBestNewBodyPosition(j)}$=n.addBodyAt(G),$.id=V,o.set(V,$),L(V),O(Q)&&($.isPinned=!0)}}function R(V){var $=V.id,Q=o.get($);Q&&(o.delete($),n.removeBody(Q))}function B(V){L(V.fromId),L(V.toId);var $=o.get(V.fromId),Q=o.get(V.toId),G=n.addSpring($,Q,V.length);c(V,G),l[V.id]=G}function I(V){var $=l[V.id];if($){var Q=r.getNode(V.fromId),G=r.getNode(V.toId);Q&&L(Q.id),G&&L(G.id),delete l[V.id],n.removeSpring($)}}function D(V){var $=[];if(!V.links)return $;for(var Q=Math.min(V.links.length,2),G=0;G<Q;++G){var j=V.links[G],ie=j.fromId!==V.id?o.get(j.fromId):o.get(j.toId);ie&&ie.pos&&$.push(ie)}return $}function L(V){var $=o.get(V);if($.mass=s(V),Number.isNaN($.mass))throw new Error("Node mass should be a number")}function O(V){return V&&(V.isPinned||V.data&&V.data.isPinned)}function U(V){var $=o.get(V);return $||(S(V),$=o.get(V)),$}function J(V){var $=r.getLinks(V);return $?1+$.length/3:1}function H(V){var $=r.getLinks(V);return $?1+$.size/3:1}}function Kre(){}var Jre=nT.exports;const Zre=t2(Jre);function Ob(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var $re=typeof global=="object"&&global&&global.Object===Object&&global,ene=typeof self=="object"&&self&&self.Object===Object&&self,TF=$re||ene||Function("return this")(),dT=function(){return TF.Date.now()},tne=/\s/;function ine(r){for(var e=r.length;e--&&tne.test(r.charAt(e)););return e}var rne=/^\s+/;function nne(r){return r&&r.slice(0,ine(r)+1).replace(rne,"")}var Pb=TF.Symbol,MF=Object.prototype,sne=MF.hasOwnProperty,ane=MF.toString,TA=Pb?Pb.toStringTag:void 0;function one(r){var e=sne.call(r,TA),i=r[TA];try{r[TA]=void 0;var n=!0}catch{}var s=ane.call(r);return n&&(e?r[TA]=i:delete r[TA]),s}var lne=Object.prototype,cne=lne.toString;function une(r){return cne.call(r)}var hne="[object Null]",dne="[object Undefined]",RF=Pb?Pb.toStringTag:void 0;function pne(r){return r==null?r===void 0?dne:hne:RF&&RF in Object(r)?one(r):une(r)}function fne(r){return r!=null&&typeof r=="object"}var mne="[object Symbol]";function gne(r){return typeof r=="symbol"||fne(r)&&pne(r)==mne}var IF=NaN,Ane=/^[-+]0x[0-9a-f]+$/i,yne=/^0b[01]+$/i,vne=/^0o[0-7]+$/i,xne=parseInt;function BF(r){if(typeof r=="number")return r;if(gne(r))return IF;if(Ob(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=Ob(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=nne(r);var i=yne.test(r);return i||vne.test(r)?xne(r.slice(2),i?2:8):Ane.test(r)?IF:+r}var bne="Expected a function",_ne=Math.max,Ene=Math.min;function NF(r,e,i){var n,s,o,l,u,c,d=0,p=!1,f=!1,m=!0;if(typeof r!="function")throw new TypeError(bne);e=BF(e)||0,Ob(i)&&(p=!!i.leading,f="maxWait"in i,o=f?_ne(BF(i.maxWait)||0,e):o,m="trailing"in i?!!i.trailing:m);function g(B){var I=n,D=s;return n=s=void 0,d=B,l=r.apply(D,I),l}function y(B){return d=B,u=setTimeout(_,e),p?g(B):l}function x(B){var I=B-c,D=B-d,L=e-I;return f?Ene(L,o-D):L}function v(B){var I=B-c,D=B-d;return c===void 0||I>=e||I<0||f&&D>=o}function _(){var B=dT();if(v(B))return T(B);u=setTimeout(_,x(B))}function T(B){return u=void 0,m&&n?g(B):(n=s=void 0,l)}function w(){u!==void 0&&clearTimeout(u),d=0,n=c=s=u=void 0}function S(){return u===void 0?l:T(dT())}function R(){var B=dT(),I=v(B);if(n=arguments,s=this,c=B,I){if(u===void 0)return y(c);if(f)return clearTimeout(u),u=setTimeout(_,e),g(c)}return u===void 0&&(u=setTimeout(_,e)),l}return R.cancel=w,R.flush=S,R}function LF(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function wne(r){if(Array.isArray(r))return r}function Cne(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Sne(r,e,i){return Object.defineProperty(r,"prototype",{writable:!1}),r}function Tne(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function Mne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rne(r,e){return wne(r)||Tne(r,e)||Ine(r,e)||Mne()}function Ine(r,e){if(r){if(typeof r=="string")return LF(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?LF(r,e):void 0}}var Bne=Sne(function r(e,i){var n=i.default,s=n===void 0?null:n,o=i.triggerUpdate,l=o===void 0?!0:o,u=i.onChange,c=u===void 0?function(d,p){}:u;Cne(this,r),this.name=e,this.defaultVal=s,this.triggerUpdate=l,this.onChange=c});function gp(r){var e=r.stateInit,i=e===void 0?function(){return{}}:e,n=r.props,s=n===void 0?{}:n,o=r.methods,l=o===void 0?{}:o,u=r.aliases,c=u===void 0?{}:u,d=r.init,p=d===void 0?function(){}:d,f=r.update,m=f===void 0?function(){}:f,g=Object.keys(s).map(function(y){return new Bne(y,s[y])});return function y(){for(var x=arguments.length,v=new Array(x),_=0;_<x;_++)v[_]=arguments[_];var T=!!(this instanceof y&&this.constructor),w=T?v.shift():void 0,S=v[0],R=S===void 0?{}:S,B=Object.assign({},i instanceof Function?i(R):i,{initialised:!1}),I={};function D(U){return L(U,R),O(),D}var L=function(U,J){p.call(D,U,B,J),B.initialised=!0},O=NF(function(){B.initialised&&(m.call(D,B,I),I={})},1);return g.forEach(function(U){D[U.name]=J(U);function J(H){var V=H.name,$=H.triggerUpdate,Q=$===void 0?!1:$,G=H.onChange,j=G===void 0?function(ae,xe){}:G,ie=H.defaultVal,Y=ie===void 0?null:ie;return function(ae){var xe=B[V];if(!arguments.length)return xe;var fe=ae===void 0?Y:ae;return B[V]=fe,j.call(D,fe,B,xe),!I.hasOwnProperty(V)&&(I[V]=xe),Q&&O(),D}}}),Object.keys(l).forEach(function(U){D[U]=function(){for(var J,H=arguments.length,V=new Array(H),$=0;$<H;$++)V[$]=arguments[$];return(J=l[U]).call.apply(J,[D,B].concat(V))}}),Object.entries(c).forEach(function(U){var J=Rne(U,2),H=J[0],V=J[1];return D[H]=D[V]}),D.resetProps=function(){return g.forEach(function(U){D[U.name](U.defaultVal)}),D},D.resetProps(),B._rerender=O,T&&w&&D(w),D}}class DF extends Map{constructor(e,i=Dne){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:i}}),e!=null)for(const[n,s]of e)this.set(n,s)}get(e){return super.get(OF(this,e))}has(e){return super.has(OF(this,e))}set(e,i){return super.set(Nne(this,e),i)}delete(e){return super.delete(Lne(this,e))}}function OF({_intern:r,_key:e},i){const n=e(i);return r.has(n)?r.get(n):i}function Nne({_intern:r,_key:e},i){const n=e(i);return r.has(n)?r.get(n):(r.set(n,i),i)}function Lne({_intern:r,_key:e},i){const n=e(i);return r.has(n)&&(i=r.get(n),r.delete(n)),i}function Dne(r){return r!==null&&typeof r=="object"?r.valueOf():r}function pT(r,e){let i;if(e===void 0)for(const n of r)n!=null&&(i<n||i===void 0&&n>=n)&&(i=n);else{let n=-1;for(let s of r)(s=e(s,++n,r))!=null&&(i<s||i===void 0&&s>=s)&&(i=s)}return i}function fT(r,e){let i;if(e===void 0)for(const n of r)n!=null&&(i>n||i===void 0&&n>=n)&&(i=n);else{let n=-1;for(let s of r)(s=e(s,++n,r))!=null&&(i>s||i===void 0&&s>=s)&&(i=s)}return i}function mT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function One(r){if(Array.isArray(r))return r}function Pne(r){if(Array.isArray(r))return mT(r)}function Fne(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function kne(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function Une(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jne(r,e){if(r==null)return{};var i,n,s=Vne(r,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(n=0;n<o.length;n++)i=o[n],e.includes(i)||{}.propertyIsEnumerable.call(r,i)&&(s[i]=r[i])}return s}function Vne(r,e){if(r==null)return{};var i={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;i[n]=r[n]}return i}function Gne(r,e){return One(r)||kne(r,e)||PF(r,e)||Une()}function Hne(r){return Pne(r)||Fne(r)||PF(r)||zne()}function Wne(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Qne(r){var e=Wne(r,"string");return typeof e=="symbol"?e:e+""}function PF(r,e){if(r){if(typeof r=="string")return mT(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?mT(r,e):void 0}}var gT=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=(e instanceof Array?e.length?e:[void 0]:[e]).map(function(u){return{keyAccessor:u,isProp:!(u instanceof Function)}}),o=r.reduce(function(u,c){var d=u,p=c;return s.forEach(function(f,m){var g=f.keyAccessor,y=f.isProp,x;if(y){var v=p,_=v[g],T=jne(v,[g].map(Qne));x=_,p=T}else x=g(p,m);m+1<s.length?(d.hasOwnProperty(x)||(d[x]={}),d=d[x]):i?(d.hasOwnProperty(x)||(d[x]=[]),d[x].push(p)):d[x]=p}),u},{});i instanceof Function&&function u(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;d===s.length?Object.keys(c).forEach(function(p){return c[p]=i(c[p])}):Object.values(c).forEach(function(p){return u(p,d+1)})}(o);var l=o;return n&&(l=[],function u(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];d.length===s.length?l.push({keys:d,vals:c}):Object.entries(c).forEach(function(p){var f=Gne(p,2),m=f[0],g=f[1];return u(g,[].concat(Hne(d),[m]))})}(o),e instanceof Array&&e.length===0&&l.length===1&&(l[0].keys=[])),l};function qne(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function FF(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function Xne(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?FF(Object(i),!0).forEach(function(n){kF(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):FF(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function kF(r,e,i){return e=rse(e),e in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function Yne(r,e){if(r==null)return{};var i={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(i[s]=r[s]);return i}function Kne(r,e){if(r==null)return{};var i=Yne(r,e),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(s=0;s<o.length;s++)n=o[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(i[n]=r[n])}return i}function UF(r,e){return Zne(r)||qne(r,e)||zF(r,e)||tse()}function Fb(r){return Jne(r)||$ne(r)||zF(r)||ese()}function Jne(r){if(Array.isArray(r))return AT(r)}function Zne(r){if(Array.isArray(r))return r}function $ne(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function zF(r,e){if(r){if(typeof r=="string")return AT(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return AT(r,e)}}function AT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=r[i];return n}function ese(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tse(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ise(r,e){if(typeof r!="object"||r===null)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function rse(r){var e=ise(r,"string");return typeof e=="symbol"?e:String(e)}var nse=["createObj","updateObj","exitObj","objBindAttr","dataBindAttr"];function sse(r,e,i){var n={enter:[],update:[],exit:[]};if(i){var s=gT(r,i,!1),o=gT(e,i,!1),l=Object.assign({},s,o);Object.entries(l).forEach(function(d){var p=UF(d,2),f=p[0],m=p[1],g=s.hasOwnProperty(f)?o.hasOwnProperty(f)?"update":"exit":"enter";n[g].push(g==="update"?[s[f],o[f]]:m)})}else{var u=new Set(r),c=new Set(e);new Set([].concat(Fb(u),Fb(c))).forEach(function(d){var p=u.has(d)?c.has(d)?"update":"exit":"enter";n[p].push(p==="update"?[d,d]:d)})}return n}function ase(r,e,i){var n=i.objBindAttr,s=n===void 0?"__obj":n,o=i.dataBindAttr,l=o===void 0?"__data":o,u=i.idAccessor,c=i.purge,d=c===void 0?!1:c,p=function(x){return x.hasOwnProperty(l)},f=e.filter(function(x){return!p(x)}),m=e.filter(p).map(function(x){return x[l]}),g=r,y=d?{enter:g,exit:m,update:[]}:sse(m,g,u);return y.update=y.update.map(function(x){var v=UF(x,2),_=v[0],T=v[1];return _!==T&&(T[s]=_[s],T[s][l]=T),T}),y.exit=y.exit.concat(f.map(function(x){return kF({},s,x)})),y}function ose(r,e,i,n,s){var o=s.createObj,l=o===void 0?function(D){return{}}:o,u=s.updateObj,c=u===void 0?function(D,L){}:u,d=s.exitObj,p=d===void 0?function(D){}:d,f=s.objBindAttr,m=f===void 0?"__obj":f,g=s.dataBindAttr,y=g===void 0?"__data":g,x=Kne(s,nse),v=ase(r,e,Xne({objBindAttr:m,dataBindAttr:y},x)),_=v.enter,T=v.update,w=v.exit;w.forEach(function(D){var L=D[m];delete D[m],p(L),n(L)});var S=B(_),R=[].concat(Fb(_),Fb(T));I(R),S.forEach(i);function B(D){var L=[];return D.forEach(function(O){var U=l(O);U&&(U[y]=O,O[m]=U,L.push(U))}),L}function I(D){D.forEach(function(L){var O=L[m];O&&(O[y]=L,c(O,L))})}}function lse(r,e){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(e).domain(r);break}return this}const jF=Symbol("implicit");function yT(){var r=new DF,e=[],i=[],n=jF;function s(o){let l=r.get(o);if(l===void 0){if(n!==jF)return n;r.set(o,l=e.push(o)-1)}return i[l%i.length]}return s.domain=function(o){if(!arguments.length)return e.slice();e=[],r=new DF;for(const l of o)r.has(l)||r.set(l,e.push(l)-1);return s},s.range=function(o){return arguments.length?(i=Array.from(o),s):i.slice()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return yT(e,i).unknown(n)},lse.apply(s,arguments),s}function vT(r,e,i){r.prototype=e.prototype=i,i.constructor=r}function VF(r,e){var i=Object.create(r.prototype);for(var n in e)i[n]=e[n];return i}function MA(){}var RA=.7,kb=1/RA,Fm="\\s*([+-]?\\d+)\\s*",IA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Oc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",cse=/^#([0-9a-f]{3,8})$/,use=new RegExp(`^rgb\\(${Fm},${Fm},${Fm}\\)$`),hse=new RegExp(`^rgb\\(${Oc},${Oc},${Oc}\\)$`),dse=new RegExp(`^rgba\\(${Fm},${Fm},${Fm},${IA}\\)$`),pse=new RegExp(`^rgba\\(${Oc},${Oc},${Oc},${IA}\\)$`),fse=new RegExp(`^hsl\\(${IA},${Oc},${Oc}\\)$`),mse=new RegExp(`^hsla\\(${IA},${Oc},${Oc},${IA}\\)$`),GF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};vT(MA,BA,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:HF,formatHex:HF,formatHex8:gse,formatHsl:Ase,formatRgb:WF,toString:WF});function HF(){return this.rgb().formatHex()}function gse(){return this.rgb().formatHex8()}function Ase(){return KF(this).formatHsl()}function WF(){return this.rgb().formatRgb()}function BA(r){var e,i;return r=(r+"").trim().toLowerCase(),(e=cse.exec(r))?(i=e[1].length,e=parseInt(e[1],16),i===6?QF(e):i===3?new ko(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?Ub(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?Ub(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=use.exec(r))?new ko(e[1],e[2],e[3],1):(e=hse.exec(r))?new ko(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=dse.exec(r))?Ub(e[1],e[2],e[3],e[4]):(e=pse.exec(r))?Ub(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=fse.exec(r))?YF(e[1],e[2]/100,e[3]/100,1):(e=mse.exec(r))?YF(e[1],e[2]/100,e[3]/100,e[4]):GF.hasOwnProperty(r)?QF(GF[r]):r==="transparent"?new ko(NaN,NaN,NaN,0):null}function QF(r){return new ko(r>>16&255,r>>8&255,r&255,1)}function Ub(r,e,i,n){return n<=0&&(r=e=i=NaN),new ko(r,e,i,n)}function yse(r){return r instanceof MA||(r=BA(r)),r?(r=r.rgb(),new ko(r.r,r.g,r.b,r.opacity)):new ko}function xT(r,e,i,n){return arguments.length===1?yse(r):new ko(r,e,i,n??1)}function ko(r,e,i,n){this.r=+r,this.g=+e,this.b=+i,this.opacity=+n}vT(ko,xT,VF(MA,{brighter(r){return r=r==null?kb:Math.pow(kb,r),new ko(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?RA:Math.pow(RA,r),new ko(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new ko(Ap(this.r),Ap(this.g),Ap(this.b),zb(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:qF,formatHex:qF,formatHex8:vse,formatRgb:XF,toString:XF}));function qF(){return`#${yp(this.r)}${yp(this.g)}${yp(this.b)}`}function vse(){return`#${yp(this.r)}${yp(this.g)}${yp(this.b)}${yp((isNaN(this.opacity)?1:this.opacity)*255)}`}function XF(){const r=zb(this.opacity);return`${r===1?"rgb(":"rgba("}${Ap(this.r)}, ${Ap(this.g)}, ${Ap(this.b)}${r===1?")":`, ${r})`}`}function zb(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function Ap(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function yp(r){return r=Ap(r),(r<16?"0":"")+r.toString(16)}function YF(r,e,i,n){return n<=0?r=e=i=NaN:i<=0||i>=1?r=e=NaN:e<=0&&(r=NaN),new rc(r,e,i,n)}function KF(r){if(r instanceof rc)return new rc(r.h,r.s,r.l,r.opacity);if(r instanceof MA||(r=BA(r)),!r)return new rc;if(r instanceof rc)return r;r=r.rgb();var e=r.r/255,i=r.g/255,n=r.b/255,s=Math.min(e,i,n),o=Math.max(e,i,n),l=NaN,u=o-s,c=(o+s)/2;return u?(e===o?l=(i-n)/u+(i<n)*6:i===o?l=(n-e)/u+2:l=(e-i)/u+4,u/=c<.5?o+s:2-o-s,l*=60):u=c>0&&c<1?0:l,new rc(l,u,c,r.opacity)}function xse(r,e,i,n){return arguments.length===1?KF(r):new rc(r,e,i,n??1)}function rc(r,e,i,n){this.h=+r,this.s=+e,this.l=+i,this.opacity=+n}vT(rc,xse,VF(MA,{brighter(r){return r=r==null?kb:Math.pow(kb,r),new rc(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?RA:Math.pow(RA,r),new rc(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,e=isNaN(r)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,s=2*i-n;return new ko(bT(r>=240?r-240:r+120,s,n),bT(r,s,n),bT(r<120?r+240:r-120,s,n),this.opacity)},clamp(){return new rc(JF(this.h),jb(this.s),jb(this.l),zb(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=zb(this.opacity);return`${r===1?"hsl(":"hsla("}${JF(this.h)}, ${jb(this.s)*100}%, ${jb(this.l)*100}%${r===1?")":`, ${r})`}`}}));function JF(r){return r=(r||0)%360,r<0?r+360:r}function jb(r){return Math.max(0,Math.min(1,r||0))}function bT(r,e,i){return(r<60?e+(i-e)*r/60:r<180?i:r<240?e+(i-e)*(240-r)/60:e)*255}const ZF=r=>()=>r;function bse(r,e){return function(i){return r+i*e}}function _se(r,e,i){return r=Math.pow(r,i),e=Math.pow(e,i)-r,i=1/i,function(n){return Math.pow(r+n*e,i)}}function Ese(r){return(r=+r)==1?$F:function(e,i){return i-e?_se(e,i,r):ZF(isNaN(e)?i:e)}}function $F(r,e){var i=e-r;return i?bse(r,i):ZF(isNaN(r)?e:r)}const ek=function r(e){var i=Ese(e);function n(s,o){var l=i((s=xT(s)).r,(o=xT(o)).r),u=i(s.g,o.g),c=i(s.b,o.b),d=$F(s.opacity,o.opacity);return function(p){return s.r=l(p),s.g=u(p),s.b=c(p),s.opacity=d(p),s+""}}return n.gamma=r,n}(1);function Xh(r,e){return r=+r,e=+e,function(i){return r*(1-i)+e*i}}var _T=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ET=new RegExp(_T.source,"g");function wse(r){return function(){return r}}function Cse(r){return function(e){return r(e)+""}}function Sse(r,e){var i=_T.lastIndex=ET.lastIndex=0,n,s,o,l=-1,u=[],c=[];for(r=r+"",e=e+"";(n=_T.exec(r))&&(s=ET.exec(e));)(o=s.index)>i&&(o=e.slice(i,o),u[l]?u[l]+=o:u[++l]=o),(n=n[0])===(s=s[0])?u[l]?u[l]+=s:u[++l]=s:(u[++l]=null,c.push({i:l,x:Xh(n,s)})),i=ET.lastIndex;return i<e.length&&(o=e.slice(i),u[l]?u[l]+=o:u[++l]=o),u.length<2?c[0]?Cse(c[0].x):wse(e):(e=c.length,function(d){for(var p=0,f;p<e;++p)u[(f=c[p]).i]=f.x(d);return u.join("")})}var tk=180/Math.PI,ik={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function rk(r,e,i,n,s,o){var l,u,c;return(l=Math.sqrt(r*r+e*e))&&(r/=l,e/=l),(c=r*i+e*n)&&(i-=r*c,n-=e*c),(u=Math.sqrt(i*i+n*n))&&(i/=u,n/=u,c/=u),r*n<e*i&&(r=-r,e=-e,c=-c,l=-l),{translateX:s,translateY:o,rotate:Math.atan2(e,r)*tk,skewX:Math.atan(c)*tk,scaleX:l,scaleY:u}}var Vb;function Tse(r){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return e.isIdentity?ik:rk(e.a,e.b,e.c,e.d,e.e,e.f)}function Mse(r){return r==null||(Vb||(Vb=document.createElementNS("http://www.w3.org/2000/svg","g")),Vb.setAttribute("transform",r),!(r=Vb.transform.baseVal.consolidate()))?ik:(r=r.matrix,rk(r.a,r.b,r.c,r.d,r.e,r.f))}function nk(r,e,i,n){function s(d){return d.length?d.pop()+" ":""}function o(d,p,f,m,g,y){if(d!==f||p!==m){var x=g.push("translate(",null,e,null,i);y.push({i:x-4,x:Xh(d,f)},{i:x-2,x:Xh(p,m)})}else(f||m)&&g.push("translate("+f+e+m+i)}function l(d,p,f,m){d!==p?(d-p>180?p+=360:p-d>180&&(d+=360),m.push({i:f.push(s(f)+"rotate(",null,n)-2,x:Xh(d,p)})):p&&f.push(s(f)+"rotate("+p+n)}function u(d,p,f,m){d!==p?m.push({i:f.push(s(f)+"skewX(",null,n)-2,x:Xh(d,p)}):p&&f.push(s(f)+"skewX("+p+n)}function c(d,p,f,m,g,y){if(d!==f||p!==m){var x=g.push(s(g)+"scale(",null,",",null,")");y.push({i:x-4,x:Xh(d,f)},{i:x-2,x:Xh(p,m)})}else(f!==1||m!==1)&&g.push(s(g)+"scale("+f+","+m+")")}return function(d,p){var f=[],m=[];return d=r(d),p=r(p),o(d.translateX,d.translateY,p.translateX,p.translateY,f,m),l(d.rotate,p.rotate,f,m),u(d.skewX,p.skewX,f,m),c(d.scaleX,d.scaleY,p.scaleX,p.scaleY,f,m),d=p=null,function(g){for(var y=-1,x=m.length,v;++y<x;)f[(v=m[y]).i]=v.x(g);return f.join("")}}}var Rse=nk(Tse,"px, ","px)","deg)"),Ise=nk(Mse,", ",")",")"),Bse=1e-12;function sk(r){return((r=Math.exp(r))+1/r)/2}function Nse(r){return((r=Math.exp(r))-1/r)/2}function Lse(r){return((r=Math.exp(2*r))-1)/(r+1)}const Dse=function r(e,i,n){function s(o,l){var u=o[0],c=o[1],d=o[2],p=l[0],f=l[1],m=l[2],g=p-u,y=f-c,x=g*g+y*y,v,_;if(x<Bse)_=Math.log(m/d)/e,v=function(I){return[u+I*g,c+I*y,d*Math.exp(e*I*_)]};else{var T=Math.sqrt(x),w=(m*m-d*d+n*x)/(2*d*i*T),S=(m*m-d*d-n*x)/(2*m*i*T),R=Math.log(Math.sqrt(w*w+1)-w),B=Math.log(Math.sqrt(S*S+1)-S);_=(B-R)/e,v=function(I){var D=I*_,L=sk(R),O=d/(i*T)*(L*Lse(e*D+R)-Nse(R));return[u+O*g,c+O*y,d*L/sk(e*D+R)]}}return v.duration=_*1e3*e/Math.SQRT2,v}return s.rho=function(o){var l=Math.max(.001,+o),u=l*l,c=u*u;return r(l,u,c)},s}(Math.SQRT2,2,4);function Ose(r){for(var e=r.length/6|0,i=new Array(e),n=0;n<e;)i[n]="#"+r.slice(n*6,++n*6);return i}const ak=Ose("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Gb(r){"@babel/helpers - typeof";return Gb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gb(r)}var Pse=/^\s+/,Fse=/\s+$/;function xr(r,e){if(r=r||"",e=e||{},r instanceof xr)return r;if(!(this instanceof xr))return new xr(r,e);var i=kse(r);this._originalInput=r,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||i.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=i.ok}xr.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var r=this.toRgb();return(r.r*299+r.g*587+r.b*114)/1e3},getLuminance:function(){var r=this.toRgb(),e,i,n,s,o,l;return e=r.r/255,i=r.g/255,n=r.b/255,e<=.03928?s=e/12.92:s=Math.pow((e+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),n<=.03928?l=n/12.92:l=Math.pow((n+.055)/1.055,2.4),.2126*s+.7152*o+.0722*l},setAlpha:function(r){return this._a=dk(r),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var r=lk(this._r,this._g,this._b);return{h:r.h*360,s:r.s,v:r.v,a:this._a}},toHsvString:function(){var r=lk(this._r,this._g,this._b),e=Math.round(r.h*360),i=Math.round(r.s*100),n=Math.round(r.v*100);return this._a==1?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var r=ok(this._r,this._g,this._b);return{h:r.h*360,s:r.s,l:r.l,a:this._a}},toHslString:function(){var r=ok(this._r,this._g,this._b),e=Math.round(r.h*360),i=Math.round(r.s*100),n=Math.round(r.l*100);return this._a==1?"hsl("+e+", "+i+"%, "+n+"%)":"hsla("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHex:function(r){return ck(this._r,this._g,this._b,r)},toHexString:function(r){return"#"+this.toHex(r)},toHex8:function(r){return Vse(this._r,this._g,this._b,this._a,r)},toHex8String:function(r){return"#"+this.toHex8(r)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(xs(this._r,255)*100)+"%",g:Math.round(xs(this._g,255)*100)+"%",b:Math.round(xs(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(xs(this._r,255)*100)+"%, "+Math.round(xs(this._g,255)*100)+"%, "+Math.round(xs(this._b,255)*100)+"%)":"rgba("+Math.round(xs(this._r,255)*100)+"%, "+Math.round(xs(this._g,255)*100)+"%, "+Math.round(xs(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:eae[ck(this._r,this._g,this._b,!0)]||!1},toFilter:function(r){var e="#"+uk(this._r,this._g,this._b,this._a),i=e,n=this._gradientType?"GradientType = 1, ":"";if(r){var s=xr(r);i="#"+uk(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+i+")"},toString:function(r){var e=!!r;r=r||this._format;var i=!1,n=this._a<1&&this._a>=0,s=!e&&n&&(r==="hex"||r==="hex6"||r==="hex3"||r==="hex4"||r==="hex8"||r==="name");return s?r==="name"&&this._a===0?this.toName():this.toRgbString():(r==="rgb"&&(i=this.toRgbString()),r==="prgb"&&(i=this.toPercentageRgbString()),(r==="hex"||r==="hex6")&&(i=this.toHexString()),r==="hex3"&&(i=this.toHexString(!0)),r==="hex4"&&(i=this.toHex8String(!0)),r==="hex8"&&(i=this.toHex8String()),r==="name"&&(i=this.toName()),r==="hsl"&&(i=this.toHslString()),r==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return xr(this.toString())},_applyModification:function(r,e){var i=r.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(Qse,arguments)},brighten:function(){return this._applyModification(qse,arguments)},darken:function(){return this._applyModification(Xse,arguments)},desaturate:function(){return this._applyModification(Gse,arguments)},saturate:function(){return this._applyModification(Hse,arguments)},greyscale:function(){return this._applyModification(Wse,arguments)},spin:function(){return this._applyModification(Yse,arguments)},_applyCombination:function(r,e){return r.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(Zse,arguments)},complement:function(){return this._applyCombination(Kse,arguments)},monochromatic:function(){return this._applyCombination($se,arguments)},splitcomplement:function(){return this._applyCombination(Jse,arguments)},triad:function(){return this._applyCombination(hk,[3])},tetrad:function(){return this._applyCombination(hk,[4])}},xr.fromRatio=function(r,e){if(Gb(r)=="object"){var i={};for(var n in r)r.hasOwnProperty(n)&&(n==="a"?i[n]=r[n]:i[n]=NA(r[n]));r=i}return xr(r,e)};function kse(r){var e={r:0,g:0,b:0},i=1,n=null,s=null,o=null,l=!1,u=!1;return typeof r=="string"&&(r=nae(r)),Gb(r)=="object"&&(Iu(r.r)&&Iu(r.g)&&Iu(r.b)?(e=Use(r.r,r.g,r.b),l=!0,u=String(r.r).substr(-1)==="%"?"prgb":"rgb"):Iu(r.h)&&Iu(r.s)&&Iu(r.v)?(n=NA(r.s),s=NA(r.v),e=jse(r.h,n,s),l=!0,u="hsv"):Iu(r.h)&&Iu(r.s)&&Iu(r.l)&&(n=NA(r.s),o=NA(r.l),e=zse(r.h,n,o),l=!0,u="hsl"),r.hasOwnProperty("a")&&(i=r.a)),i=dk(i),{ok:l,format:r.format||u,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:i}}function Use(r,e,i){return{r:xs(r,255)*255,g:xs(e,255)*255,b:xs(i,255)*255}}function ok(r,e,i){r=xs(r,255),e=xs(e,255),i=xs(i,255);var n=Math.max(r,e,i),s=Math.min(r,e,i),o,l,u=(n+s)/2;if(n==s)o=l=0;else{var c=n-s;switch(l=u>.5?c/(2-n-s):c/(n+s),n){case r:o=(e-i)/c+(e<i?6:0);break;case e:o=(i-r)/c+2;break;case i:o=(r-e)/c+4;break}o/=6}return{h:o,s:l,l:u}}function zse(r,e,i){var n,s,o;r=xs(r,360),e=xs(e,100),i=xs(i,100);function l(d,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+(p-d)*6*f:f<1/2?p:f<2/3?d+(p-d)*(2/3-f)*6:d}if(e===0)n=s=o=i;else{var u=i<.5?i*(1+e):i+e-i*e,c=2*i-u;n=l(c,u,r+1/3),s=l(c,u,r),o=l(c,u,r-1/3)}return{r:n*255,g:s*255,b:o*255}}function lk(r,e,i){r=xs(r,255),e=xs(e,255),i=xs(i,255);var n=Math.max(r,e,i),s=Math.min(r,e,i),o,l,u=n,c=n-s;if(l=n===0?0:c/n,n==s)o=0;else{switch(n){case r:o=(e-i)/c+(e<i?6:0);break;case e:o=(i-r)/c+2;break;case i:o=(r-e)/c+4;break}o/=6}return{h:o,s:l,v:u}}function jse(r,e,i){r=xs(r,360)*6,e=xs(e,100),i=xs(i,100);var n=Math.floor(r),s=r-n,o=i*(1-e),l=i*(1-s*e),u=i*(1-(1-s)*e),c=n%6,d=[i,l,o,o,u,i][c],p=[u,i,i,l,o,o][c],f=[o,o,u,i,i,l][c];return{r:d*255,g:p*255,b:f*255}}function ck(r,e,i,n){var s=[nc(Math.round(r).toString(16)),nc(Math.round(e).toString(16)),nc(Math.round(i).toString(16))];return n&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function Vse(r,e,i,n,s){var o=[nc(Math.round(r).toString(16)),nc(Math.round(e).toString(16)),nc(Math.round(i).toString(16)),nc(pk(n))];return s&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}function uk(r,e,i,n){var s=[nc(pk(n)),nc(Math.round(r).toString(16)),nc(Math.round(e).toString(16)),nc(Math.round(i).toString(16))];return s.join("")}xr.equals=function(r,e){return!r||!e?!1:xr(r).toRgbString()==xr(e).toRgbString()},xr.random=function(){return xr.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function Gse(r,e){e=e===0?0:e||10;var i=xr(r).toHsl();return i.s-=e/100,i.s=Hb(i.s),xr(i)}function Hse(r,e){e=e===0?0:e||10;var i=xr(r).toHsl();return i.s+=e/100,i.s=Hb(i.s),xr(i)}function Wse(r){return xr(r).desaturate(100)}function Qse(r,e){e=e===0?0:e||10;var i=xr(r).toHsl();return i.l+=e/100,i.l=Hb(i.l),xr(i)}function qse(r,e){e=e===0?0:e||10;var i=xr(r).toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(255*-(e/100)))),i.g=Math.max(0,Math.min(255,i.g-Math.round(255*-(e/100)))),i.b=Math.max(0,Math.min(255,i.b-Math.round(255*-(e/100)))),xr(i)}function Xse(r,e){e=e===0?0:e||10;var i=xr(r).toHsl();return i.l-=e/100,i.l=Hb(i.l),xr(i)}function Yse(r,e){var i=xr(r).toHsl(),n=(i.h+e)%360;return i.h=n<0?360+n:n,xr(i)}function Kse(r){var e=xr(r).toHsl();return e.h=(e.h+180)%360,xr(e)}function hk(r,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var i=xr(r).toHsl(),n=[xr(r)],s=360/e,o=1;o<e;o++)n.push(xr({h:(i.h+o*s)%360,s:i.s,l:i.l}));return n}function Jse(r){var e=xr(r).toHsl(),i=e.h;return[xr(r),xr({h:(i+72)%360,s:e.s,l:e.l}),xr({h:(i+216)%360,s:e.s,l:e.l})]}function Zse(r,e,i){e=e||6,i=i||30;var n=xr(r).toHsl(),s=360/i,o=[xr(r)];for(n.h=(n.h-(s*e>>1)+720)%360;--e;)n.h=(n.h+s)%360,o.push(xr(n));return o}function $se(r,e){e=e||6;for(var i=xr(r).toHsv(),n=i.h,s=i.s,o=i.v,l=[],u=1/e;e--;)l.push(xr({h:n,s,v:o})),o=(o+u)%1;return l}xr.mix=function(r,e,i){i=i===0?0:i||50;var n=xr(r).toRgb(),s=xr(e).toRgb(),o=i/100,l={r:(s.r-n.r)*o+n.r,g:(s.g-n.g)*o+n.g,b:(s.b-n.b)*o+n.b,a:(s.a-n.a)*o+n.a};return xr(l)},xr.readability=function(r,e){var i=xr(r),n=xr(e);return(Math.max(i.getLuminance(),n.getLuminance())+.05)/(Math.min(i.getLuminance(),n.getLuminance())+.05)},xr.isReadable=function(r,e,i){var n=xr.readability(r,e),s,o;switch(o=!1,s=sae(i),s.level+s.size){case"AAsmall":case"AAAlarge":o=n>=4.5;break;case"AAlarge":o=n>=3;break;case"AAAsmall":o=n>=7;break}return o},xr.mostReadable=function(r,e,i){var n=null,s=0,o,l,u,c;i=i||{},l=i.includeFallbackColors,u=i.level,c=i.size;for(var d=0;d<e.length;d++)o=xr.readability(r,e[d]),o>s&&(s=o,n=xr(e[d]));return xr.isReadable(r,n,{level:u,size:c})||!l?n:(i.includeFallbackColors=!1,xr.mostReadable(r,["#fff","#000"],i))};var wT=xr.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},eae=xr.hexNames=tae(wT);function tae(r){var e={};for(var i in r)r.hasOwnProperty(i)&&(e[r[i]]=i);return e}function dk(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function xs(r,e){iae(r)&&(r="100%");var i=rae(r);return r=Math.min(e,Math.max(0,parseFloat(r))),i&&(r=parseInt(r*e,10)/100),Math.abs(r-e)<1e-6?1:r%e/parseFloat(e)}function Hb(r){return Math.min(1,Math.max(0,r))}function sl(r){return parseInt(r,16)}function iae(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1}function rae(r){return typeof r=="string"&&r.indexOf("%")!=-1}function nc(r){return r.length==1?"0"+r:""+r}function NA(r){return r<=1&&(r=r*100+"%"),r}function pk(r){return Math.round(parseFloat(r)*255).toString(16)}function fk(r){return sl(r)/255}var sc=function(){var r="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",i="(?:"+e+")|(?:"+r+")",n="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?",s="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?";return{CSS_UNIT:new RegExp(i),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Iu(r){return!!sc.CSS_UNIT.exec(r)}function nae(r){r=r.replace(Pse,"").replace(Fse,"").toLowerCase();var e=!1;if(wT[r])r=wT[r],e=!0;else if(r=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=sc.rgb.exec(r))?{r:i[1],g:i[2],b:i[3]}:(i=sc.rgba.exec(r))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=sc.hsl.exec(r))?{h:i[1],s:i[2],l:i[3]}:(i=sc.hsla.exec(r))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=sc.hsv.exec(r))?{h:i[1],s:i[2],v:i[3]}:(i=sc.hsva.exec(r))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=sc.hex8.exec(r))?{r:sl(i[1]),g:sl(i[2]),b:sl(i[3]),a:fk(i[4]),format:e?"name":"hex8"}:(i=sc.hex6.exec(r))?{r:sl(i[1]),g:sl(i[2]),b:sl(i[3]),format:e?"name":"hex"}:(i=sc.hex4.exec(r))?{r:sl(i[1]+""+i[1]),g:sl(i[2]+""+i[2]),b:sl(i[3]+""+i[3]),a:fk(i[4]+""+i[4]),format:e?"name":"hex8"}:(i=sc.hex3.exec(r))?{r:sl(i[1]+""+i[1]),g:sl(i[2]+""+i[2]),b:sl(i[3]+""+i[3]),format:e?"name":"hex"}:!1}function sae(r){var e,i;return r=r||{level:"AA",size:"small"},e=(r.level||"AA").toUpperCase(),i=(r.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),i!=="small"&&i!=="large"&&(i="small"),{level:e,size:i}}function CT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function aae(r){if(Array.isArray(r))return r}function oae(r){if(Array.isArray(r))return CT(r)}function lae(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function cae(r,e,i){return e=Wb(e),vae(r,TT()?Reflect.construct(e,i||[],Wb(r).constructor):e.apply(r,i))}function uae(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function mk(r,e,i){if(TT())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return s}function hae(r,e,i){return Object.defineProperty(r,"prototype",{writable:!1}),r}function ST(r,e,i){return(e=bae(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function Wb(r){return Wb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Wb(r)}function dae(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&MT(r,e)}function TT(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(TT=function(){return!!r})()}function pae(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function fae(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function mae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gk(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function Ak(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?gk(Object(i),!0).forEach(function(n){ST(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):gk(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function Aae(r,e){if(r==null)return{};var i,n,s=yae(r,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(n=0;n<o.length;n++)i=o[n],e.includes(i)||{}.propertyIsEnumerable.call(r,i)&&(s[i]=r[i])}return s}function yae(r,e){if(r==null)return{};var i={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;i[n]=r[n]}return i}function vae(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lae(r)}function MT(r,e){return MT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},MT(r,e)}function yk(r,e){return aae(r)||fae(r,e)||vk(r,e)||mae()}function ac(r){return oae(r)||pae(r)||vk(r)||gae()}function xae(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function bae(r){var e=xae(r,"string");return typeof e=="symbol"?e:e+""}function RT(r){"@babel/helpers - typeof";return RT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},RT(r)}function vk(r,e){if(r){if(typeof r=="string")return CT(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?CT(r,e):void 0}}var xk=function(r){r instanceof Array?r.forEach(xk):(r.map&&r.map.dispose(),r.dispose())},bk=function(r){r.geometry&&r.geometry.dispose(),r.material&&xk(r.material),r.texture&&r.texture.dispose(),r.children&&r.children.forEach(bk)},IT=function(r){for(;r.children.length;){var e=r.children[0];r.remove(e),bk(e)}},_ae=["objFilter"];function LA(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.objFilter,s=n===void 0?function(){return!0}:n,o=Aae(i,_ae);return ose(r,e.children.filter(s),function(l){return e.add(l)},function(l){e.remove(l),IT(l)},Ak({objBindAttr:"__threeObj"},o))}var DA=function(r){return isNaN(r)?parseInt(xr(r).toHex(),16):r},BT=function(r){return isNaN(r)?xr(r).getAlpha():1},Eae=yT(ak);function _k(r,e,i){!e||typeof i!="string"||r.filter(function(n){return!n[i]}).forEach(function(n){n[i]=Eae(e(n))})}function wae(r,e){var i=r.nodes,n=r.links,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.nodeFilter,l=o===void 0?function(){return!0}:o,u=s.onLoopError,c=u===void 0?function(g){throw"Invalid DAG structure! Found cycle in node path: ".concat(g.join(" -> "),".")}:u,d={};i.forEach(function(g){return d[e(g)]={data:g,out:[],depth:-1,skip:!l(g)}}),n.forEach(function(g){var y=g.source,x=g.target,v=S(y),_=S(x);if(!d.hasOwnProperty(v))throw"Missing source node with id: ".concat(v);if(!d.hasOwnProperty(_))throw"Missing target node with id: ".concat(_);var T=d[v],w=d[_];T.out.push(w);function S(R){return RT(R)==="object"?e(R):R}});var p=[];m(Object.values(d));var f=Object.assign.apply(Object,[{}].concat(ac(Object.entries(d).filter(function(g){var y=yk(g,2),x=y[1];return!x.skip}).map(function(g){var y=yk(g,2),x=y[0],v=y[1];return ST({},x,v.depth)}))));return f;function m(g){for(var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=function(){var w=g[_];if(y.indexOf(w)!==-1){var S=[].concat(ac(y.slice(y.indexOf(w))),[w]).map(function(R){return e(R.data)});return p.some(function(R){return R.length===S.length&&R.every(function(B,I){return B===S[I]})})||(p.push(S),c(S)),1}x>w.depth&&(w.depth=x,m(w.out,[].concat(ac(y),[w]),x+(w.skip?0:1)))},_=0,T=g.length;_<T;_++)v()}}var Dr=window.THREE?window.THREE:{Group:Im,Mesh:La,MeshLambertMaterial:jte,Color:wn,BufferGeometry:Po,BufferAttribute:Oo,Matrix4:ps,Vector3:at,SphereGeometry:Tb,CylinderGeometry:Sb,TubeGeometry:WS,ConeGeometry:HS,Line:b4,LineBasicMaterial:FS,QuadraticBezierCurve3:GS,CubicBezierCurve3:w4,Box3:np},Ek={graph:yre,forcelayout:Zre},Cae=2,NT=new Dr.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Qb=new Dr.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",Sae=gp({props:{jsonUrl:{onChange:function(r,e){var i=this;r&&!e.fetchingJson&&(e.fetchingJson=!0,e.onLoading(),fetch(r).then(function(n){return n.json()}).then(function(n){e.fetchingJson=!1,e.onFinishLoading(n),i.graphData(n)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(r,e){e.engineRunning=!1}},numDimensions:{default:3,onChange:function(r,e){var i=e.d3ForceLayout.force("charge");i&&i.strength(r>2?-60:-30),r<3&&n(e.graphData.nodes,"z"),r<2&&n(e.graphData.nodes,"y");function n(s,o){s.forEach(function(l){delete l[o],delete l["v".concat(o)]})}}},dagMode:{onChange:function(r,e){!r&&e.forceEngine==="d3"&&(e.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=i.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(r){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(r,e){e.d3ForceLayout.alphaDecay(r)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(r,e){e.d3ForceLayout.alphaTarget(r)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(r,e){e.d3ForceLayout.velocityDecay(r)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(r){return r._flushObjects=!0,r._rerender(),this},d3Force:function(r,e,i){return i===void 0?r.d3ForceLayout.force(e):(r.d3ForceLayout.force(e,i),this)},d3ReheatSimulation:function(r){return r.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(r){return r.cntTicks=0,r.startTickTime=new Date,r.engineRunning=!0,this},tickFrame:function(r){var e=r.forceEngine!=="ngraph";return r.engineRunning&&i(),n(),s(),this;function i(){++r.cntTicks>r.cooldownTicks||new Date-r.startTickTime>r.cooldownTime||e&&r.d3AlphaMin>0&&r.d3ForceLayout.alpha()<r.d3AlphaMin?(r.engineRunning=!1,r.onEngineStop()):(r.layout[e?"tick":"step"](),r.onEngineTick());var o=mr(r.nodeThreeObjectExtend);r.graphData.nodes.forEach(function(f){var m=f.__threeObj;if(m){var g=e?f:r.layout.getNodePosition(f[r.nodeId]),y=o(f);(!r.nodePositionUpdate||!r.nodePositionUpdate(y?m.children[0]:m,{x:g.x,y:g.y,z:g.z},f)||y)&&(m.position.x=g.x,m.position.y=g.y||0,m.position.z=g.z||0)}});var l=mr(r.linkWidth),u=mr(r.linkCurvature),c=mr(r.linkCurveRotation),d=mr(r.linkThreeObjectExtend);r.graphData.links.forEach(function(f){var m=f.__lineObj;if(m){var g=e?f:r.layout.getLinkPosition(r.layout.graph.getLink(f.source,f.target).id),y=g[e?"source":"from"],x=g[e?"target":"to"];if(!(!y||!x||!y.hasOwnProperty("x")||!x.hasOwnProperty("x"))){p(f);var v=d(f);if(!(r.linkPositionUpdate&&r.linkPositionUpdate(v?m.children[1]:m,{start:{x:y.x,y:y.y,z:y.z},end:{x:x.x,y:x.y,z:x.z}},f)&&!v)){var _=30,T=f.__curve,w=m.children.length?m.children[0]:m;if(w.type==="Line"){if(T){var S=T.getPoints(_);w.geometry.getAttribute("position").array.length!==S.length*3&&w.geometry[NT]("position",new Dr.BufferAttribute(new Float32Array(S.length*3),3)),w.geometry.setFromPoints(S)}else{var R=w.geometry.getAttribute("position");(!R||!R.array||R.array.length!==6)&&w.geometry[NT]("position",R=new Dr.BufferAttribute(new Float32Array(2*3),3)),R.array[0]=y.x,R.array[1]=y.y||0,R.array[2]=y.z||0,R.array[3]=x.x,R.array[4]=x.y||0,R.array[5]=x.z||0,R.needsUpdate=!0}w.geometry.computeBoundingSphere()}else if(w.type==="Mesh")if(T){w.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(w.position.set(0,0,0),w.rotation.set(0,0,0),w.scale.set(1,1,1));var B=Math.ceil(l(f)*10)/10,I=B/2,D=new Dr.TubeGeometry(T,_,I,r.linkResolution,!1);w.geometry.dispose(),w.geometry=D}else{if(!w.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var L=Math.ceil(l(f)*10)/10,O=L/2,U=new Dr.CylinderGeometry(O,O,1,r.linkResolution,1,!1);U[Qb](new Dr.Matrix4().makeTranslation(0,1/2,0)),U[Qb](new Dr.Matrix4().makeRotationX(Math.PI/2)),w.geometry.dispose(),w.geometry=U}var J=new Dr.Vector3(y.x,y.y||0,y.z||0),H=new Dr.Vector3(x.x,x.y||0,x.z||0),V=J.distanceTo(H);w.position.x=J.x,w.position.y=J.y,w.position.z=J.z,w.scale.z=V,w.parent.localToWorld(H),w.lookAt(H)}}}}});function p(f){var m=e?f:r.layout.getLinkPosition(r.layout.graph.getLink(f.source,f.target).id),g=m[e?"source":"from"],y=m[e?"target":"to"];if(!(!g||!y||!g.hasOwnProperty("x")||!y.hasOwnProperty("x"))){var x=u(f);if(!x)f.__curve=null;else{var v=new Dr.Vector3(g.x,g.y||0,g.z||0),_=new Dr.Vector3(y.x,y.y||0,y.z||0),T=v.distanceTo(_),w,S=c(f);if(T>0){var R=y.x-g.x,B=y.y-g.y||0,I=new Dr.Vector3().subVectors(_,v),D=I.clone().multiplyScalar(x).cross(R!==0||B!==0?new Dr.Vector3(0,0,1):new Dr.Vector3(0,1,0)).applyAxisAngle(I.normalize(),S).add(new Dr.Vector3().addVectors(v,_).divideScalar(2));w=new Dr.QuadraticBezierCurve3(v,D,_)}else{var L=x*70,O=-S,U=O+Math.PI/2;w=new Dr.CubicBezierCurve3(v,new Dr.Vector3(L*Math.cos(U),L*Math.sin(U),0).add(v),new Dr.Vector3(L*Math.cos(O),L*Math.sin(O),0).add(v),_)}f.__curve=w}}}}function n(){var o=mr(r.linkDirectionalArrowRelPos),l=mr(r.linkDirectionalArrowLength),u=mr(r.nodeVal);r.graphData.links.forEach(function(c){var d=c.__arrowObj;if(d){var p=e?c:r.layout.getLinkPosition(r.layout.graph.getLink(c.source,c.target).id),f=p[e?"source":"from"],m=p[e?"target":"to"];if(!(!f||!m||!f.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var g=Math.cbrt(Math.max(0,u(f)||1))*r.nodeRelSize,y=Math.cbrt(Math.max(0,u(m)||1))*r.nodeRelSize,x=l(c),v=o(c),_=c.__curve?function(I){return c.__curve.getPoint(I)}:function(I){var D=function(L,O,U,J){return O[L]+(U[L]-O[L])*J||0};return{x:D("x",f,m,I),y:D("y",f,m,I),z:D("z",f,m,I)}},T=c.__curve?c.__curve.getLength():Math.sqrt(["x","y","z"].map(function(I){return Math.pow((m[I]||0)-(f[I]||0),2)}).reduce(function(I,D){return I+D},0)),w=g+x+(T-g-y-x)*v,S=_(w/T),R=_((w-x)/T);["x","y","z"].forEach(function(I){return d.position[I]=R[I]});var B=mk(Dr.Vector3,ac(["x","y","z"].map(function(I){return S[I]})));d.parent.localToWorld(B),d.lookAt(B)}}})}function s(){var o=mr(r.linkDirectionalParticleSpeed);r.graphData.links.forEach(function(l){var u=l.__photonsObj&&l.__photonsObj.children,c=l.__singleHopPhotonsObj&&l.__singleHopPhotonsObj.children;if(!((!c||!c.length)&&(!u||!u.length))){var d=e?l:r.layout.getLinkPosition(r.layout.graph.getLink(l.source,l.target).id),p=d[e?"source":"from"],f=d[e?"target":"to"];if(!(!p||!f||!p.hasOwnProperty("x")||!f.hasOwnProperty("x"))){var m=o(l),g=l.__curve?function(x){return l.__curve.getPoint(x)}:function(x){var v=function(_,T,w,S){return T[_]+(w[_]-T[_])*S||0};return{x:v("x",p,f,x),y:v("y",p,f,x),z:v("z",p,f,x)}},y=[].concat(ac(u||[]),ac(c||[]));y.forEach(function(x,v){var _=x.parent.__linkThreeObjType==="singleHopPhotons";if(x.hasOwnProperty("__progressRatio")||(x.__progressRatio=_?0:v/u.length),x.__progressRatio+=m,x.__progressRatio>=1)if(!_)x.__progressRatio=x.__progressRatio%1;else{x.parent.remove(x),IT(x);return}var T=x.__progressRatio,w=g(T);["x","y","z"].forEach(function(S){return x.position[S]=w[S]})})}}})}},emitParticle:function(r,e){if(e&&r.graphData.links.includes(e)){if(!e.__singleHopPhotonsObj){var i=new Dr.Group;i.__linkThreeObjType="singleHopPhotons",e.__singleHopPhotonsObj=i,r.graphScene.add(i)}var n=mr(r.linkDirectionalParticleWidth),s=Math.ceil(n(e)*10)/10/2,o=r.linkDirectionalParticleResolution,l=new Dr.SphereGeometry(s,o,o),u=mr(r.linkColor),c=mr(r.linkDirectionalParticleColor),d=c(e)||u(e)||"#f0f0f0",p=new Dr.Color(DA(d)),f=r.linkOpacity*3,m=new Dr.MeshLambertMaterial({color:p,transparent:!0,opacity:f});e.__singleHopPhotonsObj.add(new Dr.Mesh(l,m))}return this},getGraphBbox:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!r.initialised)return null;var i=function n(s){var o=[];if(s.geometry){s.geometry.computeBoundingBox();var l=new Dr.Box3;l.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),o.push(l)}return o.concat.apply(o,ac((s.children||[]).filter(function(u){return!u.hasOwnProperty("__graphObjType")||u.__graphObjType==="node"&&e(u.__data)}).map(n)))}(r.graphScene);return i.length?Object.assign.apply(Object,ac(["x","y","z"].map(function(n){return ST({},n,[fT(i,function(s){return s.min[n]}),pT(i,function(s){return s.max[n]})])}))):null}},stateInit:function(){return{d3ForceLayout:iF().force("link",q4()).force("charge",rF()).force("center",P4()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(r,e){e.graphScene=r},update:function(r,e){var i=function(fe){return fe.some(function(de){return e.hasOwnProperty(de)})};if(r.engineRunning=!1,r.onUpdate(),r.nodeAutoColorBy!==null&&i(["nodeAutoColorBy","graphData","nodeColor"])&&_k(r.graphData.nodes,mr(r.nodeAutoColorBy),r.nodeColor),r.linkAutoColorBy!==null&&i(["linkAutoColorBy","graphData","linkColor"])&&_k(r.graphData.links,mr(r.linkAutoColorBy),r.linkColor),r._flushObjects||i(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var n=mr(r.nodeThreeObject),s=mr(r.nodeThreeObjectExtend),o=mr(r.nodeVal),l=mr(r.nodeColor),u=mr(r.nodeVisibility),c={},d={};LA(r.graphData.nodes.filter(u),r.graphScene,{purge:r._flushObjects||i(["nodeThreeObject","nodeThreeObjectExtend"]),objFilter:function(fe){return fe.__graphObjType==="node"},createObj:function(fe){var de=n(fe),Ie=s(fe);de&&r.nodeThreeObject===de&&(de=de.clone());var Ge;return de&&!Ie?Ge=de:(Ge=new Dr.Mesh,Ge.__graphDefaultObj=!0,de&&Ie&&Ge.add(de)),Ge.__graphObjType="node",Ge},updateObj:function(fe,de){if(fe.__graphDefaultObj){var Ie=o(de)||1,Ge=Math.cbrt(Ie)*r.nodeRelSize,Xe=r.nodeResolution;(!fe.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||fe.geometry.parameters.radius!==Ge||fe.geometry.parameters.widthSegments!==Xe)&&(c.hasOwnProperty(Ie)||(c[Ie]=new Dr.SphereGeometry(Ge,Xe,Xe)),fe.geometry.dispose(),fe.geometry=c[Ie]);var $e=l(de),lt=new Dr.Color(DA($e||"#ffffaa")),At=r.nodeOpacity*BT($e);(fe.material.type!=="MeshLambertMaterial"||!fe.material.color.equals(lt)||fe.material.opacity!==At)&&(d.hasOwnProperty($e)||(d[$e]=new Dr.MeshLambertMaterial({color:lt,transparent:!0,opacity:At})),fe.material.dispose(),fe.material=d[$e])}}})}if(r._flushObjects||i(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var p=mr(r.linkThreeObject),f=mr(r.linkThreeObjectExtend),m=mr(r.linkMaterial),g=mr(r.linkVisibility),y=mr(r.linkColor),x=mr(r.linkWidth),v={},_={},T={},w=r.graphData.links.filter(g);if(LA(w,r.graphScene,{objBindAttr:"__lineObj",purge:r._flushObjects||i(["linkThreeObject","linkThreeObjectExtend","linkWidth"]),objFilter:function(fe){return fe.__graphObjType==="link"},exitObj:function(fe){var de=fe.__data&&fe.__data.__singleHopPhotonsObj;de&&(de.parent.remove(de),IT(de),delete fe.__data.__singleHopPhotonsObj)},createObj:function(fe){var de=p(fe),Ie=f(fe);de&&r.linkThreeObject===de&&(de=de.clone());var Ge;if(!de||Ie){var Xe=!!x(fe);if(Xe)Ge=new Dr.Mesh;else{var $e=new Dr.BufferGeometry;$e[NT]("position",new Dr.BufferAttribute(new Float32Array(2*3),3)),Ge=new Dr.Line($e)}}var lt;return de?Ie?(lt=new Dr.Group,lt.__graphDefaultObj=!0,lt.add(Ge),lt.add(de)):lt=de:(lt=Ge,lt.__graphDefaultObj=!0),lt.renderOrder=10,lt.__graphObjType="link",lt},updateObj:function(fe,de){if(fe.__graphDefaultObj){var Ie=fe.children.length?fe.children[0]:fe,Ge=Math.ceil(x(de)*10)/10,Xe=!!Ge;if(Xe){var $e=Ge/2,lt=r.linkResolution;if(!Ie.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||Ie.geometry.parameters.radiusTop!==$e||Ie.geometry.parameters.radialSegments!==lt){if(!v.hasOwnProperty(Ge)){var At=new Dr.CylinderGeometry($e,$e,1,lt,1,!1);At[Qb](new Dr.Matrix4().makeTranslation(0,1/2,0)),At[Qb](new Dr.Matrix4().makeRotationX(Math.PI/2)),v[Ge]=At}Ie.geometry.dispose(),Ie.geometry=v[Ge]}}var Gt=m(de);if(Gt)Ie.material=Gt;else{var gt=y(de),yi=new Dr.Color(DA(gt||"#f0f0f0")),Ze=r.linkOpacity*BT(gt),ki=Xe?"MeshLambertMaterial":"LineBasicMaterial";if(Ie.material.type!==ki||!Ie.material.color.equals(yi)||Ie.material.opacity!==Ze){var hi=Xe?_:T;hi.hasOwnProperty(gt)||(hi[gt]=new Dr[ki]({color:yi,transparent:Ze<1,opacity:Ze,depthWrite:Ze>=1})),Ie.material.dispose(),Ie.material=hi[gt]}}}}}),r.linkDirectionalArrowLength||e.hasOwnProperty("linkDirectionalArrowLength")){var S=mr(r.linkDirectionalArrowLength),R=mr(r.linkDirectionalArrowColor);LA(w.filter(S),r.graphScene,{objBindAttr:"__arrowObj",objFilter:function(fe){return fe.__linkThreeObjType==="arrow"},createObj:function(){var fe=new Dr.Mesh(void 0,new Dr.MeshLambertMaterial({transparent:!0}));return fe.__linkThreeObjType="arrow",fe},updateObj:function(fe,de){var Ie=S(de),Ge=r.linkDirectionalArrowResolution;if(!fe.geometry.type.match(/^Cone(Buffer)?Geometry$/)||fe.geometry.parameters.height!==Ie||fe.geometry.parameters.radialSegments!==Ge){var Xe=new Dr.ConeGeometry(Ie*.25,Ie,Ge);Xe.translate(0,Ie/2,0),Xe.rotateX(Math.PI/2),fe.geometry.dispose(),fe.geometry=Xe}var $e=R(de)||y(de)||"#f0f0f0";fe.material.color=new Dr.Color(DA($e)),fe.material.opacity=r.linkOpacity*3*BT($e)}})}if(r.linkDirectionalParticles||e.hasOwnProperty("linkDirectionalParticles")){var B=mr(r.linkDirectionalParticles),I=mr(r.linkDirectionalParticleWidth),D=mr(r.linkDirectionalParticleColor),L={},O={};LA(w.filter(B),r.graphScene,{objBindAttr:"__photonsObj",objFilter:function(fe){return fe.__linkThreeObjType==="photons"},createObj:function(){var fe=new Dr.Group;return fe.__linkThreeObjType="photons",fe},updateObj:function(fe,de){var Ie=Math.round(Math.abs(B(de))),Ge=!!fe.children.length&&fe.children[0],Xe=Math.ceil(I(de)*10)/10/2,$e=r.linkDirectionalParticleResolution,lt;Ge&&Ge.geometry.parameters.radius===Xe&&Ge.geometry.parameters.widthSegments===$e?lt=Ge.geometry:(O.hasOwnProperty(Xe)||(O[Xe]=new Dr.SphereGeometry(Xe,$e,$e)),lt=O[Xe],Ge&&Ge.geometry.dispose());var At=D(de)||y(de)||"#f0f0f0",Gt=new Dr.Color(DA(At)),gt=r.linkOpacity*3,yi;Ge&&Ge.material.color.equals(Gt)&&Ge.material.opacity===gt?yi=Ge.material:(L.hasOwnProperty(At)||(L[At]=new Dr.MeshLambertMaterial({color:Gt,transparent:!0,opacity:gt})),yi=L[At],Ge&&Ge.material.dispose()),LA(ac(new Array(Ie)).map(function(Ze,ki){return{idx:ki}}),fe,{idAccessor:function(Ze){return Ze.idx},createObj:function(){return new Dr.Mesh(lt,yi)},updateObj:function(Ze){Ze.geometry=lt,Ze.material=yi}})}})}}if(r._flushObjects=!1,i(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){r.engineRunning=!1,r.graphData.links.forEach(function(fe){fe.source=fe[r.linkSource],fe.target=fe[r.linkTarget]});var U=r.forceEngine!=="ngraph",J;if(U){(J=r.d3ForceLayout).stop().alpha(1).numDimensions(r.numDimensions).nodes(r.graphData.nodes);var H=r.d3ForceLayout.force("link");H&&H.id(function(fe){return fe[r.nodeId]}).links(r.graphData.links);var V=r.dagMode&&wae(r.graphData,function(fe){return fe[r.nodeId]},{nodeFilter:r.dagNodeFilter,onLoopError:r.onDagError||void 0}),$=Math.max.apply(Math,ac(Object.values(V||[]))),Q=r.dagLevelDistance||r.graphData.nodes.length/($||1)*Cae*(["radialin","radialout"].indexOf(r.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var G=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(fe){return delete fe[G]})}if(["lr","rl","td","bu","zin","zout"].includes(r.dagMode)){var j=["rl","td","zout"].includes(r.dagMode),ie=function(fe){return(V[fe[r.nodeId]]-$/2)*Q*(j?-1:1)},Y=["lr","rl"].includes(r.dagMode)?"fx":["td","bu"].includes(r.dagMode)?"fy":"fz";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(fe){return fe[Y]=ie(fe)})}r.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(r.dagMode)!==-1?nF(function(fe){var de=V[fe[r.nodeId]]||-1;return(r.dagMode==="radialin"?$-de:de)*Q}).strength(function(fe){return r.dagNodeFilter(fe)?1:0}):null)}else{var ae=Ek.graph();r.graphData.nodes.forEach(function(fe){ae.addNode(fe[r.nodeId])}),r.graphData.links.forEach(function(fe){ae.addLink(fe.source,fe.target)}),J=Ek.forcelayout(ae,Ak({dimensions:r.numDimensions},r.ngraphPhysics)),J.graph=ae}for(var xe=0;xe<r.warmupTicks&&!(U&&r.d3AlphaMin>0&&r.d3ForceLayout.alpha()<r.d3AlphaMin);xe++)J[U?"tick":"step"]();r.layout=J,this.resetCountdown()}r.engineRunning=!0,r.onFinishUpdate()}});function Tae(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=function(s){function o(){var l;uae(this,o);for(var u=arguments.length,c=new Array(u),d=0;d<u;d++)c[d]=arguments[d];return l=cae(this,o,[].concat(c)),l.__kapsuleInstance=mk(r,[].concat(ac(i?[l]:[]),c)),l}return dae(o,s),hae(o)}(e);return Object.keys(r()).forEach(function(s){return n.prototype[s]=function(){var o,l=(o=this.__kapsuleInstance)[s].apply(o,arguments);return l===this.__kapsuleInstance?this:l}}),n}var Mae=window.THREE?window.THREE:{Group:Im},LT=Tae(Sae,Mae.Group,!0);const Rae=Object.freeze(Object.defineProperty({__proto__:null,default:LT},Symbol.toStringTag,{value:"Module"})),Iae=i2(Rae);if(typeof AFRAME>"u")throw new Error("Component attempted to register before AFRAME was available.");let DT=iie;"default"in DT&&(DT=DT.default);let vp=Iae;"default"in vp&&(vp=vp.default);const OT=function(r){return typeof r=="string"?JSON.parse(r):r},oc=function(r){if(typeof r=="function")return r;const e=eval;try{return e("("+r+")")}catch{}return null},Ns=function(r){return isNaN(parseFloat(r))?oc(r)?oc(r):r:parseFloat(r)};AFRAME.registerComponent("forcegraph",{schema:{jsonUrl:{type:"string",default:""},nodes:{parse:OT,default:[]},links:{parse:OT,default:[]},numDimensions:{type:"number",default:3},dagMode:{type:"string",default:""},dagLevelDistance:{type:"number",default:0},dagNodeFilter:{parse:oc,default:function(){return!0}},onDagError:{parse:oc,default:void 0},nodeRelSize:{type:"number",default:4},nodeId:{type:"string",default:"id"},nodeVal:{parse:Ns,default:"val"},nodeResolution:{type:"number",default:8},nodeVisibility:{parse:Ns,default:!0},nodeColor:{parse:Ns,default:"color"},nodeAutoColorBy:{parse:Ns,default:""},nodeOpacity:{type:"number",default:.75},nodeThreeObject:{parse:Ns,default:null},nodeThreeObjectExtend:{parse:Ns,default:!1},linkSource:{type:"string",default:"source"},linkTarget:{type:"string",default:"target"},linkVisibility:{parse:Ns,default:!0},linkColor:{parse:Ns,default:"color"},linkAutoColorBy:{parse:Ns,default:""},linkOpacity:{type:"number",default:.2},linkWidth:{parse:Ns,default:0},linkResolution:{type:"number",default:6},linkCurvature:{parse:Ns,default:0},linkCurveRotation:{parse:Ns,default:0},linkMaterial:{parse:Ns,default:null},linkThreeObject:{parse:Ns,default:null},linkThreeObjectExtend:{parse:Ns,default:!1},linkPositionUpdate:{parse:oc,default:null},linkDirectionalArrowLength:{parse:Ns,default:0},linkDirectionalArrowColor:{parse:Ns,default:null},linkDirectionalArrowRelPos:{parse:Ns,default:.5},linkDirectionalArrowResolution:{type:"number",default:8},linkDirectionalParticles:{parse:Ns,default:0},linkDirectionalParticleSpeed:{parse:Ns,default:.01},linkDirectionalParticleWidth:{parse:Ns,default:.5},linkDirectionalParticleColor:{parse:Ns,default:null},linkDirectionalParticleResolution:{type:"number",default:4},onNodeHover:{parse:oc,default:()=>{}},onLinkHover:{parse:oc,default:()=>{}},onNodeClick:{parse:oc,default:()=>{}},onLinkClick:{parse:oc,default:()=>{}},forceEngine:{type:"string",default:"d3"},d3AlphaMin:{type:"number",default:0},d3AlphaDecay:{type:"number",default:.0228},d3VelocityDecay:{type:"number",default:.4},ngraphPhysics:{parse:OT,default:null},warmupTicks:{type:"int",default:0},cooldownTicks:{type:"int",default:1e18},cooldownTime:{type:"int",default:15e3},onEngineTick:{parse:oc,default:function(){}},onEngineStop:{parse:oc,default:function(){}}},getGraphBbox:function(r){return this.forceGraph||(this.forceGraph=new vp),this.forceGraph.getGraphBbox(r)},emitParticle:function(){this.forceGraph||(this.forceGraph=new vp);const r=this.forceGraph,e=r.emitParticle.apply(r,arguments);return e===r?this:e},d3Force:function(){this.forceGraph||(this.forceGraph=new vp);const r=this.forceGraph,e=r.d3Force.apply(r,arguments);return e===r?this:e},d3ReheatSimulation:function(){return this.forceGraph&&this.forceGraph.d3ReheatSimulation(),this},refresh:function(){return this.forceGraph&&this.forceGraph.refresh(),this},init:function(){const r=this.state={};r.infoEl=document.createElement("a-text"),r.infoEl.setAttribute("position","0 -0.1 -1"),r.infoEl.setAttribute("width",1),r.infoEl.setAttribute("align","center"),r.infoEl.setAttribute("color","lavender");const e=document.querySelector("a-entity[camera], a-camera");e.appendChild(r.infoEl),r.cameraObj=e.object3D.children.filter(function(i){return i.type==="PerspectiveCamera"})[0],this.el.sceneEl.addEventListener("camera-set-active",function(i){r.cameraObj=i.detail.cameraEl.components.camera.camera}),this.forceGraph||(this.forceGraph=new vp),this.forceGraph.onFinishUpdate(()=>this.el.setObject3D("forcegraphGroup",this.forceGraph)).onLoading(()=>r.infoEl.setAttribute("value","Loading...")).onFinishLoading(()=>r.infoEl.setAttribute("value","")),this.el.addEventListener("raycaster-intersected",i=>r.hoverDetail=i.detail),this.el.addEventListener("raycaster-intersected-cleared",i=>r.hoverDetail=i.detail),this.el.addEventListener("click",()=>r.hoverObj&&this.data["on"+(r.hoverObj.__graphObjType==="node"?"Node":"Link")+"Click"](r.hoverObj.__data))},remove:function(){this.state.infoEl.remove(),this.el.removeObject3D("forcegraphGroup")},update:function(r){const e=this,i=this.data,n=AFRAME.utils.diff(i,r);["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].filter(function(s){return s in n}).forEach(function(s){e.forceGraph[s](i[s]!==""?i[s]:null)}),("nodes"in n||"links"in n)&&e.forceGraph.graphData({nodes:i.nodes,links:i.links})},tick:function(r,e){const i=this.state,n=this.data,s=i.hoverDetail?i.hoverDetail.getIntersection?i.hoverDetail.getIntersection(this.el):i.hoverDetail.intersection||void 0:void 0;let o=s?s.object:void 0;for(;o&&!o.hasOwnProperty("__graphObjType");)o=o.parent;if(o!==i.hoverObj){const l=i.hoverObj?i.hoverObj.__graphObjType:null,u=i.hoverObj?i.hoverObj.__data:null,c=o?o.__graphObjType:null,d=o?o.__data:null;l&&l!==c&&n["on"+(l==="node"?"Node":"Link")+"Hover"](null,u),c&&n["on"+(c==="node"?"Node":"Link")+"Hover"](d,l===c?u:null),i.hoverObj=o}this.forceGraph.tickFrame()}});function Uo(){return Uo=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(r[n]=i[n])}return r},Uo.apply(null,arguments)}function Bae(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function OA(r,e){return OA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},OA(r,e)}function Nae(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,OA(r,e)}function PT(r){return PT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},PT(r)}function Lae(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function wk(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wk=function(){return!!r})()}function Dae(r,e,i){if(wk())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return i&&OA(s,i.prototype),s}function FT(r){var e=typeof Map=="function"?new Map:void 0;return FT=function(i){if(i===null||!Lae(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,n)}function n(){return Dae(i,arguments,PT(this).constructor)}return n.prototype=Object.create(i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),OA(n,i)},FT(r)}var Oae={1:`Passed invalid arguments to hsl, please pass multiple numbers e.g. hsl(360, 0.75, 0.4) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75 }).

`,2:`Passed invalid arguments to hsla, please pass multiple numbers e.g. hsla(360, 0.75, 0.4, 0.7) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75, alpha: 0.7 }).

`,3:`Passed an incorrect argument to a color function, please pass a string representation of a color.

`,4:`Couldn't generate valid rgb string from %s, it returned %s.

`,5:`Couldn't parse the color string. Please provide the color as a string in hex, rgb, rgba, hsl or hsla notation.

`,6:`Passed invalid arguments to rgb, please pass multiple numbers e.g. rgb(255, 205, 100) or an object e.g. rgb({ red: 255, green: 205, blue: 100 }).

`,7:`Passed invalid arguments to rgba, please pass multiple numbers e.g. rgb(255, 205, 100, 0.75) or an object e.g. rgb({ red: 255, green: 205, blue: 100, alpha: 0.75 }).

`,8:`Passed invalid argument to toColorString, please pass a RgbColor, RgbaColor, HslColor or HslaColor object.

`,9:`Please provide a number of steps to the modularScale helper.

`,10:`Please pass a number or one of the predefined scales to the modularScale helper as the ratio.

`,11:`Invalid value passed as base to modularScale, expected number or em string but got "%s"

`,12:`Expected a string ending in "px" or a number passed as the first argument to %s(), got "%s" instead.

`,13:`Expected a string ending in "px" or a number passed as the second argument to %s(), got "%s" instead.

`,14:`Passed invalid pixel value ("%s") to %s(), please pass a value like "12px" or 12.

`,15:`Passed invalid base value ("%s") to %s(), please pass a value like "12px" or 12.

`,16:`You must provide a template to this method.

`,17:`You passed an unsupported selector state to this method.

`,18:`minScreen and maxScreen must be provided as stringified numbers with the same units.

`,19:`fromSize and toSize must be provided as stringified numbers with the same units.

`,20:`expects either an array of objects or a single object with the properties prop, fromSize, and toSize.

`,21:"expects the objects in the first argument array to have the properties `prop`, `fromSize`, and `toSize`.\n\n",22:"expects the first argument object to have the properties `prop`, `fromSize`, and `toSize`.\n\n",23:`fontFace expects a name of a font-family.

`,24:`fontFace expects either the path to the font file(s) or a name of a local copy.

`,25:`fontFace expects localFonts to be an array.

`,26:`fontFace expects fileFormats to be an array.

`,27:`radialGradient requries at least 2 color-stops to properly render.

`,28:`Please supply a filename to retinaImage() as the first argument.

`,29:`Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.

`,30:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",31:`The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation

`,32:`To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])
To pass a single animation please supply them in simple values, e.g. animation('rotate', '2s')

`,33:`The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation

`,34:`borderRadius expects a radius value as a string or number as the second argument.

`,35:`borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.

`,36:`Property must be a string value.

`,37:`Syntax Error at %s.

`,38:`Formula contains a function that needs parentheses at %s.

`,39:`Formula is missing closing parenthesis at %s.

`,40:`Formula has too many closing parentheses at %s.

`,41:`All values in a formula must have the same unit or be unitless.

`,42:`Please provide a number of steps to the modularScale helper.

`,43:`Please pass a number or one of the predefined scales to the modularScale helper as the ratio.

`,44:`Invalid value passed as base to modularScale, expected number or em/rem string but got %s.

`,45:`Passed invalid argument to hslToColorString, please pass a HslColor or HslaColor object.

`,46:`Passed invalid argument to rgbToColorString, please pass a RgbColor or RgbaColor object.

`,47:`minScreen and maxScreen must be provided as stringified numbers with the same units.

`,48:`fromSize and toSize must be provided as stringified numbers with the same units.

`,49:`Expects either an array of objects or a single object with the properties prop, fromSize, and toSize.

`,50:`Expects the objects in the first argument array to have the properties prop, fromSize, and toSize.

`,51:`Expects the first argument object to have the properties prop, fromSize, and toSize.

`,52:`fontFace expects either the path to the font file(s) or a name of a local copy.

`,53:`fontFace expects localFonts to be an array.

`,54:`fontFace expects fileFormats to be an array.

`,55:`fontFace expects a name of a font-family.

`,56:`linearGradient requries at least 2 color-stops to properly render.

`,57:`radialGradient requries at least 2 color-stops to properly render.

`,58:`Please supply a filename to retinaImage() as the first argument.

`,59:`Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.

`,60:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",61:`Property must be a string value.

`,62:`borderRadius expects a radius value as a string or number as the second argument.

`,63:`borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.

`,64:`The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation.

`,65:`To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])\\nTo pass a single animation please supply them in simple values, e.g. animation('rotate', '2s').

`,66:`The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation.

`,67:`You must provide a template to this method.

`,68:`You passed an unsupported selector state to this method.

`,69:`Expected a string ending in "px" or a number passed as the first argument to %s(), got %s instead.

`,70:`Expected a string ending in "px" or a number passed as the second argument to %s(), got %s instead.

`,71:`Passed invalid pixel value %s to %s(), please pass a value like "12px" or 12.

`,72:`Passed invalid base value %s to %s(), please pass a value like "12px" or 12.

`,73:`Please provide a valid CSS variable.

`,74:`CSS variable not found and no default was provided.

`,75:`important requires a valid style object, got a %s instead.

`,76:`fromSize and toSize must be provided as stringified numbers with the same units as minScreen and maxScreen.

`,77:`remToPx expects a value in "rem" but you provided it in "%s".

`,78:`base must be set in "px" or "%" but you set it in "%s".
`};function Pae(){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];var n=e[0],s=[],o;for(o=1;o<e.length;o+=1)s.push(e[o]);return s.forEach(function(l){n=n.replace(/%[a-z]/,l)}),n}var Pc=function(r){Nae(e,r);function e(i){var n;if(process.env.NODE_ENV==="production")n=r.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+i+" for more information.")||this;else{for(var s=arguments.length,o=new Array(s>1?s-1:0),l=1;l<s;l++)o[l-1]=arguments[l];n=r.call(this,Pae.apply(void 0,[Oae[i]].concat(o)))||this}return Bae(n)}return e}(FT(Error));function kT(r){return Math.round(r*255)}function Fae(r,e,i){return kT(r)+","+kT(e)+","+kT(i)}function qb(r,e,i,n){if(n===void 0&&(n=Fae),e===0)return n(i,i,i);var s=(r%360+360)%360/60,o=(1-Math.abs(2*i-1))*e,l=o*(1-Math.abs(s%2-1)),u=0,c=0,d=0;s>=0&&s<1?(u=o,c=l):s>=1&&s<2?(u=l,c=o):s>=2&&s<3?(c=o,d=l):s>=3&&s<4?(c=l,d=o):s>=4&&s<5?(u=l,d=o):s>=5&&s<6&&(u=o,d=l);var p=i-o/2,f=u+p,m=c+p,g=d+p;return n(f,m,g)}var Ck={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function kae(r){if(typeof r!="string")return r;var e=r.toLowerCase();return Ck[e]?"#"+Ck[e]:r}var Uae=/^#[a-fA-F0-9]{6}$/,zae=/^#[a-fA-F0-9]{8}$/,jae=/^#[a-fA-F0-9]{3}$/,Vae=/^#[a-fA-F0-9]{4}$/,UT=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Gae=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Hae=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Wae=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function xp(r){if(typeof r!="string")throw new Pc(3);var e=kae(r);if(e.match(Uae))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(zae)){var i=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:i}}if(e.match(jae))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(Vae)){var n=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:n}}var s=UT.exec(e);if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10)};var o=Gae.exec(e.substring(0,50));if(o)return{red:parseInt(""+o[1],10),green:parseInt(""+o[2],10),blue:parseInt(""+o[3],10),alpha:parseFloat(""+o[4])>1?parseFloat(""+o[4])/100:parseFloat(""+o[4])};var l=Hae.exec(e);if(l){var u=parseInt(""+l[1],10),c=parseInt(""+l[2],10)/100,d=parseInt(""+l[3],10)/100,p="rgb("+qb(u,c,d)+")",f=UT.exec(p);if(!f)throw new Pc(4,e,p);return{red:parseInt(""+f[1],10),green:parseInt(""+f[2],10),blue:parseInt(""+f[3],10)}}var m=Wae.exec(e.substring(0,50));if(m){var g=parseInt(""+m[1],10),y=parseInt(""+m[2],10)/100,x=parseInt(""+m[3],10)/100,v="rgb("+qb(g,y,x)+")",_=UT.exec(v);if(!_)throw new Pc(4,e,v);return{red:parseInt(""+_[1],10),green:parseInt(""+_[2],10),blue:parseInt(""+_[3],10),alpha:parseFloat(""+m[4])>1?parseFloat(""+m[4])/100:parseFloat(""+m[4])}}throw new Pc(5)}function Qae(r){var e=r.red/255,i=r.green/255,n=r.blue/255,s=Math.max(e,i,n),o=Math.min(e,i,n),l=(s+o)/2;if(s===o)return r.alpha!==void 0?{hue:0,saturation:0,lightness:l,alpha:r.alpha}:{hue:0,saturation:0,lightness:l};var u,c=s-o,d=l>.5?c/(2-s-o):c/(s+o);switch(s){case e:u=(i-n)/c+(i<n?6:0);break;case i:u=(n-e)/c+2;break;default:u=(e-i)/c+4;break}return u*=60,r.alpha!==void 0?{hue:u,saturation:d,lightness:l,alpha:r.alpha}:{hue:u,saturation:d,lightness:l}}function Yh(r){return Qae(xp(r))}var qae=function(r){return r.length===7&&r[1]===r[2]&&r[3]===r[4]&&r[5]===r[6]?"#"+r[1]+r[3]+r[5]:r},zT=qae;function bp(r){var e=r.toString(16);return e.length===1?"0"+e:e}function jT(r){return bp(Math.round(r*255))}function Xae(r,e,i){return zT("#"+jT(r)+jT(e)+jT(i))}function Sk(r,e,i){return qb(r,e,i,Xae)}function Yae(r,e,i){if(typeof r=="object"&&e===void 0&&i===void 0)return Sk(r.hue,r.saturation,r.lightness);throw new Pc(1)}function Kae(r,e,i,n){if(typeof r=="object"&&e===void 0&&i===void 0&&n===void 0)return r.alpha>=1?Sk(r.hue,r.saturation,r.lightness):"rgba("+qb(r.hue,r.saturation,r.lightness)+","+r.alpha+")";throw new Pc(2)}function Tk(r,e,i){if(typeof r=="number"&&typeof e=="number"&&typeof i=="number")return zT("#"+bp(r)+bp(e)+bp(i));if(typeof r=="object"&&e===void 0&&i===void 0)return zT("#"+bp(r.red)+bp(r.green)+bp(r.blue));throw new Pc(6)}function Xb(r,e,i,n){if(typeof r=="object"&&e===void 0&&i===void 0&&n===void 0)return r.alpha>=1?Tk(r.red,r.green,r.blue):"rgba("+r.red+","+r.green+","+r.blue+","+r.alpha+")";throw new Pc(7)}var Jae=function(r){return typeof r.red=="number"&&typeof r.green=="number"&&typeof r.blue=="number"&&(typeof r.alpha!="number"||typeof r.alpha>"u")},Zae=function(r){return typeof r.red=="number"&&typeof r.green=="number"&&typeof r.blue=="number"&&typeof r.alpha=="number"},$ae=function(r){return typeof r.hue=="number"&&typeof r.saturation=="number"&&typeof r.lightness=="number"&&(typeof r.alpha!="number"||typeof r.alpha>"u")},eoe=function(r){return typeof r.hue=="number"&&typeof r.saturation=="number"&&typeof r.lightness=="number"&&typeof r.alpha=="number"};function Kh(r){if(typeof r!="object")throw new Pc(8);if(Zae(r))return Xb(r);if(Jae(r))return Tk(r);if(eoe(r))return Kae(r);if($ae(r))return Yae(r);throw new Pc(8)}function Mk(r,e,i){return function(){var n=i.concat(Array.prototype.slice.call(arguments));return n.length>=e?r.apply(this,n):Mk(r,e,n)}}function al(r){return Mk(r,r.length,[])}function toe(r,e){if(e==="transparent")return e;var i=Yh(e);return Kh(Uo({},i,{hue:i.hue+parseFloat(r)}))}al(toe);function km(r,e,i){return Math.max(r,Math.min(e,i))}function ioe(r,e){if(e==="transparent")return e;var i=Yh(e);return Kh(Uo({},i,{lightness:km(0,1,i.lightness-parseFloat(r))}))}al(ioe);function roe(r,e){if(e==="transparent")return e;var i=Yh(e);return Kh(Uo({},i,{saturation:km(0,1,i.saturation-parseFloat(r))}))}al(roe);function noe(r,e){if(e==="transparent")return e;var i=Yh(e);return Kh(Uo({},i,{lightness:km(0,1,i.lightness+parseFloat(r))}))}al(noe);function soe(r,e,i){if(e==="transparent")return i;if(i==="transparent")return e;if(r===0)return i;var n=xp(e),s=Uo({},n,{alpha:typeof n.alpha=="number"?n.alpha:1}),o=xp(i),l=Uo({},o,{alpha:typeof o.alpha=="number"?o.alpha:1}),u=s.alpha-l.alpha,c=parseFloat(r)*2-1,d=c*u===-1?c:c+u,p=1+c*u,f=(d/p+1)/2,m=1-f,g={red:Math.floor(s.red*f+l.red*m),green:Math.floor(s.green*f+l.green*m),blue:Math.floor(s.blue*f+l.blue*m),alpha:s.alpha*parseFloat(r)+l.alpha*(1-parseFloat(r))};return Xb(g)}var aoe=al(soe),Rk=aoe;function ooe(r,e){if(e==="transparent")return e;var i=xp(e),n=typeof i.alpha=="number"?i.alpha:1,s=Uo({},i,{alpha:km(0,1,(n*100+parseFloat(r)*100)/100)});return Xb(s)}var loe=al(ooe),Ik=loe;function coe(r,e){if(e==="transparent")return e;var i=Yh(e);return Kh(Uo({},i,{saturation:km(0,1,i.saturation+parseFloat(r))}))}al(coe);function uoe(r,e){return e==="transparent"?e:Kh(Uo({},Yh(e),{hue:parseFloat(r)}))}al(uoe);function hoe(r,e){return e==="transparent"?e:Kh(Uo({},Yh(e),{lightness:parseFloat(r)}))}al(hoe);function doe(r,e){return e==="transparent"?e:Kh(Uo({},Yh(e),{saturation:parseFloat(r)}))}al(doe);function poe(r,e){return e==="transparent"?e:Rk(parseFloat(r),"rgb(0, 0, 0)",e)}al(poe);function foe(r,e){return e==="transparent"?e:Rk(parseFloat(r),"rgb(255, 255, 255)",e)}al(foe);function moe(r,e){if(e==="transparent")return e;var i=xp(e),n=typeof i.alpha=="number"?i.alpha:1,s=Uo({},i,{alpha:km(0,1,+(n*100-parseFloat(r)*100).toFixed(2)/100)});return Xb(s)}al(moe);function goe(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var Aoe=`.graph-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: Sans-serif;
  z-index: 1000;
}`;goe(Aoe);function VT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function yoe(r){if(Array.isArray(r))return r}function voe(r){if(Array.isArray(r))return VT(r)}function PA(r,e,i){return(e=Coe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function xoe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function boe(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function _oe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Eoe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bk(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function Nk(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Bk(Object(i),!0).forEach(function(n){PA(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Bk(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function GT(r,e){return yoe(r)||boe(r,e)||Lk(r,e)||_oe()}function Yb(r){return voe(r)||xoe(r)||Lk(r)||Eoe()}function woe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Coe(r){var e=woe(r,"string");return typeof e=="symbol"?e:e+""}function Lk(r,e){if(r){if(typeof r=="string")return VT(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?VT(r,e):void 0}}var Dk=gp({props:{width:{default:window.innerWidth,triggerUpdate:!1,onChange:function(r,e){e.container&&(e.container.style.width="".concat(r,"px"))}},height:{default:window.innerHeight,triggerUpdate:!1,onChange:function(r,e){e.container&&(e.container.style.height="".concat(r,"px"))}},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},backgroundColor:{default:"#002"},showNavInfo:{default:!0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeLabel:{default:"name"},nodeDesc:{default:"desc"},onNodeHover:{},onNodeClick:{},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkLabel:{default:"name"},linkDesc:{default:"desc"},onLinkHover:{},onLinkClick:{},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:Nk(Nk({},Object.assign.apply(Object,[{}].concat(Yb(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map(function(r){return PA({},r,function(e){for(var i=e.forcegraph.components.forcegraph,n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];var l=i[r].apply(i,s);return l===i?this:l})}))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(r,e){r.innerHTML="",e.container=document.createElement("div"),r.appendChild(e.container),e.container.style.position="relative",e.container.style.width="".concat(e.width,"px"),e.container.style.height="".concat(e.height,"px"),e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="graph-nav-info",e.navInfo.textContent="Mouse drag: look, gamepad/arrow/wasd keys: move";var i=document.createElement("a-scene");i.setAttribute("embedded",""),i.appendChild(e.sky=document.createElement("a-sky")),e.sky.setAttribute("radius",3e3);var n;i.appendChild(n=document.createElement("a-entity")),n.setAttribute("position","0 0 300"),n.setAttribute("movement-controls","controls: gamepad, touch; fly: true; speed: 7");var s;n.appendChild(s=document.createElement("a-entity")),s.setAttribute("camera",""),s.setAttribute("position","0 0 0"),s.setAttribute("look-controls","pointerLockEnabled: false"),s.setAttribute("wasd-controls","fly: true; acceleration: 700");var o;s.appendChild(o=document.createElement("a-text")),o.setAttribute("position","0 -0.3 -1"),o.setAttribute("width",2),o.setAttribute("align","center"),o.setAttribute("color","lavender"),o.setAttribute("value","");var l;s.appendChild(l=document.createElement("a-text")),l.setAttribute("position","0 -0.4 -1"),l.setAttribute("width",1.3),l.setAttribute("align","center"),l.setAttribute("color","lavender"),l.setAttribute("value",""),e.raycasterEls=[];var u;i.appendChild(u=document.createElement("a-entity")),u.setAttribute("cursor","rayOrigin: mouse; mouseCursorStylesEnabled: true"),u.setAttribute("raycaster","objects: [forcegraph]; interval: 100"),e.raycasterEls.push(u),["left","right"].forEach(function(c){var d;n.appendChild(d=document.createElement("a-entity")),d.setAttribute("laser-controls","hand: ".concat(c,"; model: false;")),d.setAttribute("raycaster","objects: [forcegraph]; interval: 100; lineColor: steelblue; lineOpacity: 0.85"),e.raycasterEls.push(d)}),i.appendChild(e.forcegraph=document.createElement("a-entity")),e.forcegraph.setAttribute("forcegraph",null),e.container.appendChild(i),e.forcegraph.setAttribute("forcegraph",Object.assign.apply(Object,Yb(["node","link"].map(function(c){var d={node:"Node",link:"Link"}[c];return PA({},"on".concat(d,"Hover"),function(p,f){var m=p&&mr(e["".concat(c,"Label")])(p)||"",g=p&&mr(e["".concat(c,"Desc")])(p)||"";o.setAttribute("value",m),l.setAttribute("value",g),e["on".concat(d,"Hover")]&&e["on".concat(d,"Hover")](p,f)})}))))},update:function(r,e){if(e.hasOwnProperty("backgroundColor")){var i=xp(r.backgroundColor).alpha;i===void 0&&(i=1),r.sky.setAttribute("color",Ik(1,r.backgroundColor)),r.sky.setAttribute("opacity",i)}e.hasOwnProperty("showNavInfo")&&(r.navInfo.style.display=r.showNavInfo?null:"none");var n=["onNodeHover","onLinkHover","onNodeClick","onLinkClick"].some(function(l){return r[l]})||["nodeLabel","linkLabel"].some(function(l){return r[l]!=="name"})||["nodeDesc","linkDesc"].some(function(l){return r[l]!=="desc"});r.raycasterEls.forEach(function(l){return l.setAttribute("raycaster",n?"objects: [forcegraph]; interval: 100":"objects: __none__")});var s=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","onNodeClick","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","onLinkClick","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],o=Object.assign.apply(Object,[{}].concat(Yb(Object.entries(r).filter(function(l){var u=GT(l,2),c=u[0],d=u[1];return e.hasOwnProperty(c)&&s.indexOf(c)!==-1&&d!==void 0&&d!==null}).map(function(l){var u=GT(l,2),c=u[0],d=u[1];return PA({},c,d)})),Yb(Object.entries(r.graphData).map(function(l){var u=GT(l,2),c=u[0],d=u[1];return PA({},c,d)}))));r.forcegraph.setAttribute("forcegraph",o)}}),HT={exports:{}},WT={exports:{}},Yn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ok;function Soe(){if(Ok)return Yn;Ok=1;var r=typeof Symbol=="function"&&Symbol.for,e=r?Symbol.for("react.element"):60103,i=r?Symbol.for("react.portal"):60106,n=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,o=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,c=r?Symbol.for("react.async_mode"):60111,d=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,g=r?Symbol.for("react.memo"):60115,y=r?Symbol.for("react.lazy"):60116,x=r?Symbol.for("react.block"):60121,v=r?Symbol.for("react.fundamental"):60117,_=r?Symbol.for("react.responder"):60118,T=r?Symbol.for("react.scope"):60119;function w(R){if(typeof R=="object"&&R!==null){var B=R.$$typeof;switch(B){case e:switch(R=R.type,R){case c:case d:case n:case o:case s:case f:return R;default:switch(R=R&&R.$$typeof,R){case u:case p:case y:case g:case l:return R;default:return B}}case i:return B}}}function S(R){return w(R)===d}return Yn.AsyncMode=c,Yn.ConcurrentMode=d,Yn.ContextConsumer=u,Yn.ContextProvider=l,Yn.Element=e,Yn.ForwardRef=p,Yn.Fragment=n,Yn.Lazy=y,Yn.Memo=g,Yn.Portal=i,Yn.Profiler=o,Yn.StrictMode=s,Yn.Suspense=f,Yn.isAsyncMode=function(R){return S(R)||w(R)===c},Yn.isConcurrentMode=S,Yn.isContextConsumer=function(R){return w(R)===u},Yn.isContextProvider=function(R){return w(R)===l},Yn.isElement=function(R){return typeof R=="object"&&R!==null&&R.$$typeof===e},Yn.isForwardRef=function(R){return w(R)===p},Yn.isFragment=function(R){return w(R)===n},Yn.isLazy=function(R){return w(R)===y},Yn.isMemo=function(R){return w(R)===g},Yn.isPortal=function(R){return w(R)===i},Yn.isProfiler=function(R){return w(R)===o},Yn.isStrictMode=function(R){return w(R)===s},Yn.isSuspense=function(R){return w(R)===f},Yn.isValidElementType=function(R){return typeof R=="string"||typeof R=="function"||R===n||R===d||R===o||R===s||R===f||R===m||typeof R=="object"&&R!==null&&(R.$$typeof===y||R.$$typeof===g||R.$$typeof===l||R.$$typeof===u||R.$$typeof===p||R.$$typeof===v||R.$$typeof===_||R.$$typeof===T||R.$$typeof===x)},Yn.typeOf=w,Yn}var is={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pk;function Toe(){return Pk||(Pk=1,process.env.NODE_ENV!=="production"&&function(){var r=typeof Symbol=="function"&&Symbol.for,e=r?Symbol.for("react.element"):60103,i=r?Symbol.for("react.portal"):60106,n=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,o=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,c=r?Symbol.for("react.async_mode"):60111,d=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,g=r?Symbol.for("react.memo"):60115,y=r?Symbol.for("react.lazy"):60116,x=r?Symbol.for("react.block"):60121,v=r?Symbol.for("react.fundamental"):60117,_=r?Symbol.for("react.responder"):60118,T=r?Symbol.for("react.scope"):60119;function w(gt){return typeof gt=="string"||typeof gt=="function"||gt===n||gt===d||gt===o||gt===s||gt===f||gt===m||typeof gt=="object"&&gt!==null&&(gt.$$typeof===y||gt.$$typeof===g||gt.$$typeof===l||gt.$$typeof===u||gt.$$typeof===p||gt.$$typeof===v||gt.$$typeof===_||gt.$$typeof===T||gt.$$typeof===x)}function S(gt){if(typeof gt=="object"&&gt!==null){var yi=gt.$$typeof;switch(yi){case e:var Ze=gt.type;switch(Ze){case c:case d:case n:case o:case s:case f:return Ze;default:var ki=Ze&&Ze.$$typeof;switch(ki){case u:case p:case y:case g:case l:return ki;default:return yi}}case i:return yi}}}var R=c,B=d,I=u,D=l,L=e,O=p,U=n,J=y,H=g,V=i,$=o,Q=s,G=f,j=!1;function ie(gt){return j||(j=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),Y(gt)||S(gt)===c}function Y(gt){return S(gt)===d}function ae(gt){return S(gt)===u}function xe(gt){return S(gt)===l}function fe(gt){return typeof gt=="object"&&gt!==null&&gt.$$typeof===e}function de(gt){return S(gt)===p}function Ie(gt){return S(gt)===n}function Ge(gt){return S(gt)===y}function Xe(gt){return S(gt)===g}function $e(gt){return S(gt)===i}function lt(gt){return S(gt)===o}function At(gt){return S(gt)===s}function Gt(gt){return S(gt)===f}is.AsyncMode=R,is.ConcurrentMode=B,is.ContextConsumer=I,is.ContextProvider=D,is.Element=L,is.ForwardRef=O,is.Fragment=U,is.Lazy=J,is.Memo=H,is.Portal=V,is.Profiler=$,is.StrictMode=Q,is.Suspense=G,is.isAsyncMode=ie,is.isConcurrentMode=Y,is.isContextConsumer=ae,is.isContextProvider=xe,is.isElement=fe,is.isForwardRef=de,is.isFragment=Ie,is.isLazy=Ge,is.isMemo=Xe,is.isPortal=$e,is.isProfiler=lt,is.isStrictMode=At,is.isSuspense=Gt,is.isValidElementType=w,is.typeOf=S}()),is}var Fk;function kk(){return Fk||(Fk=1,process.env.NODE_ENV==="production"?WT.exports=Soe():WT.exports=Toe()),WT.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var QT,Uk;function Moe(){if(Uk)return QT;Uk=1;var r=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function n(o){if(o==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(o)}function s(){try{if(!Object.assign)return!1;var o=new String("abc");if(o[5]="de",Object.getOwnPropertyNames(o)[0]==="5")return!1;for(var l={},u=0;u<10;u++)l["_"+String.fromCharCode(u)]=u;var c=Object.getOwnPropertyNames(l).map(function(p){return l[p]});if(c.join("")!=="0123456789")return!1;var d={};return"abcdefghijklmnopqrst".split("").forEach(function(p){d[p]=p}),Object.keys(Object.assign({},d)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return QT=s()?Object.assign:function(o,l){for(var u,c=n(o),d,p=1;p<arguments.length;p++){u=Object(arguments[p]);for(var f in u)e.call(u,f)&&(c[f]=u[f]);if(r){d=r(u);for(var m=0;m<d.length;m++)i.call(u,d[m])&&(c[d[m]]=u[d[m]])}}return c},QT}var qT,zk;function XT(){if(zk)return qT;zk=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return qT=r,qT}var jk,Vk;function Gk(){return Vk||(Vk=1,jk=Function.call.bind(Object.prototype.hasOwnProperty)),jk}var YT,Hk;function Roe(){if(Hk)return YT;Hk=1;var r=function(){};if(process.env.NODE_ENV!=="production"){var e=XT(),i={},n=Gk();r=function(o){var l="Warning: "+o;typeof console<"u"&&console.error(l);try{throw new Error(l)}catch{}}}function s(o,l,u,c,d){if(process.env.NODE_ENV!=="production"){for(var p in o)if(n(o,p)){var f;try{if(typeof o[p]!="function"){var m=Error((c||"React class")+": "+u+" type `"+p+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof o[p]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw m.name="Invariant Violation",m}f=o[p](l,p,c,u,null,e)}catch(y){f=y}if(f&&!(f instanceof Error)&&r((c||"React class")+": type specification of "+u+" `"+p+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof f+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),f instanceof Error&&!(f.message in i)){i[f.message]=!0;var g=d?d():"";r("Failed "+u+" type: "+f.message+(g??""))}}}}return s.resetWarningCache=function(){process.env.NODE_ENV!=="production"&&(i={})},YT=s,YT}var KT,Wk;function Ioe(){if(Wk)return KT;Wk=1;var r=kk(),e=Moe(),i=XT(),n=Gk(),s=Roe(),o=function(){};process.env.NODE_ENV!=="production"&&(o=function(u){var c="Warning: "+u;typeof console<"u"&&console.error(c);try{throw new Error(c)}catch{}});function l(){return null}return KT=function(u,c){var d=typeof Symbol=="function"&&Symbol.iterator,p="@@iterator";function f(Y){var ae=Y&&(d&&Y[d]||Y[p]);if(typeof ae=="function")return ae}var m="<<anonymous>>",g={array:_("array"),bigint:_("bigint"),bool:_("boolean"),func:_("function"),number:_("number"),object:_("object"),string:_("string"),symbol:_("symbol"),any:T(),arrayOf:w,element:S(),elementType:R(),instanceOf:B,node:O(),objectOf:D,oneOf:I,oneOfType:L,shape:J,exact:H};function y(Y,ae){return Y===ae?Y!==0||1/Y===1/ae:Y!==Y&&ae!==ae}function x(Y,ae){this.message=Y,this.data=ae&&typeof ae=="object"?ae:{},this.stack=""}x.prototype=Error.prototype;function v(Y){if(process.env.NODE_ENV!=="production")var ae={},xe=0;function fe(Ie,Ge,Xe,$e,lt,At,Gt){if($e=$e||m,At=At||Xe,Gt!==i){if(c){var gt=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw gt.name="Invariant Violation",gt}else if(process.env.NODE_ENV!=="production"&&typeof console<"u"){var yi=$e+":"+Xe;!ae[yi]&&xe<3&&(o("You are manually calling a React.PropTypes validation function for the `"+At+"` prop on `"+$e+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),ae[yi]=!0,xe++)}}return Ge[Xe]==null?Ie?Ge[Xe]===null?new x("The "+lt+" `"+At+"` is marked as required "+("in `"+$e+"`, but its value is `null`.")):new x("The "+lt+" `"+At+"` is marked as required in "+("`"+$e+"`, but its value is `undefined`.")):null:Y(Ge,Xe,$e,lt,At)}var de=fe.bind(null,!1);return de.isRequired=fe.bind(null,!0),de}function _(Y){function ae(xe,fe,de,Ie,Ge,Xe){var $e=xe[fe],lt=Q($e);if(lt!==Y){var At=G($e);return new x("Invalid "+Ie+" `"+Ge+"` of type "+("`"+At+"` supplied to `"+de+"`, expected ")+("`"+Y+"`."),{expectedType:Y})}return null}return v(ae)}function T(){return v(l)}function w(Y){function ae(xe,fe,de,Ie,Ge){if(typeof Y!="function")return new x("Property `"+Ge+"` of component `"+de+"` has invalid PropType notation inside arrayOf.");var Xe=xe[fe];if(!Array.isArray(Xe)){var $e=Q(Xe);return new x("Invalid "+Ie+" `"+Ge+"` of type "+("`"+$e+"` supplied to `"+de+"`, expected an array."))}for(var lt=0;lt<Xe.length;lt++){var At=Y(Xe,lt,de,Ie,Ge+"["+lt+"]",i);if(At instanceof Error)return At}return null}return v(ae)}function S(){function Y(ae,xe,fe,de,Ie){var Ge=ae[xe];if(!u(Ge)){var Xe=Q(Ge);return new x("Invalid "+de+" `"+Ie+"` of type "+("`"+Xe+"` supplied to `"+fe+"`, expected a single ReactElement."))}return null}return v(Y)}function R(){function Y(ae,xe,fe,de,Ie){var Ge=ae[xe];if(!r.isValidElementType(Ge)){var Xe=Q(Ge);return new x("Invalid "+de+" `"+Ie+"` of type "+("`"+Xe+"` supplied to `"+fe+"`, expected a single ReactElement type."))}return null}return v(Y)}function B(Y){function ae(xe,fe,de,Ie,Ge){if(!(xe[fe]instanceof Y)){var Xe=Y.name||m,$e=ie(xe[fe]);return new x("Invalid "+Ie+" `"+Ge+"` of type "+("`"+$e+"` supplied to `"+de+"`, expected ")+("instance of `"+Xe+"`."))}return null}return v(ae)}function I(Y){if(!Array.isArray(Y))return process.env.NODE_ENV!=="production"&&(arguments.length>1?o("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):o("Invalid argument supplied to oneOf, expected an array.")),l;function ae(xe,fe,de,Ie,Ge){for(var Xe=xe[fe],$e=0;$e<Y.length;$e++)if(y(Xe,Y[$e]))return null;var lt=JSON.stringify(Y,function(At,Gt){var gt=G(Gt);return gt==="symbol"?String(Gt):Gt});return new x("Invalid "+Ie+" `"+Ge+"` of value `"+String(Xe)+"` "+("supplied to `"+de+"`, expected one of "+lt+"."))}return v(ae)}function D(Y){function ae(xe,fe,de,Ie,Ge){if(typeof Y!="function")return new x("Property `"+Ge+"` of component `"+de+"` has invalid PropType notation inside objectOf.");var Xe=xe[fe],$e=Q(Xe);if($e!=="object")return new x("Invalid "+Ie+" `"+Ge+"` of type "+("`"+$e+"` supplied to `"+de+"`, expected an object."));for(var lt in Xe)if(n(Xe,lt)){var At=Y(Xe,lt,de,Ie,Ge+"."+lt,i);if(At instanceof Error)return At}return null}return v(ae)}function L(Y){if(!Array.isArray(Y))return process.env.NODE_ENV!=="production"&&o("Invalid argument supplied to oneOfType, expected an instance of array."),l;for(var ae=0;ae<Y.length;ae++){var xe=Y[ae];if(typeof xe!="function")return o("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+j(xe)+" at index "+ae+"."),l}function fe(de,Ie,Ge,Xe,$e){for(var lt=[],At=0;At<Y.length;At++){var Gt=Y[At],gt=Gt(de,Ie,Ge,Xe,$e,i);if(gt==null)return null;gt.data&&n(gt.data,"expectedType")&&lt.push(gt.data.expectedType)}var yi=lt.length>0?", expected one of type ["+lt.join(", ")+"]":"";return new x("Invalid "+Xe+" `"+$e+"` supplied to "+("`"+Ge+"`"+yi+"."))}return v(fe)}function O(){function Y(ae,xe,fe,de,Ie){return V(ae[xe])?null:new x("Invalid "+de+" `"+Ie+"` supplied to "+("`"+fe+"`, expected a ReactNode."))}return v(Y)}function U(Y,ae,xe,fe,de){return new x((Y||"React class")+": "+ae+" type `"+xe+"."+fe+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+de+"`.")}function J(Y){function ae(xe,fe,de,Ie,Ge){var Xe=xe[fe],$e=Q(Xe);if($e!=="object")return new x("Invalid "+Ie+" `"+Ge+"` of type `"+$e+"` "+("supplied to `"+de+"`, expected `object`."));for(var lt in Y){var At=Y[lt];if(typeof At!="function")return U(de,Ie,Ge,lt,G(At));var Gt=At(Xe,lt,de,Ie,Ge+"."+lt,i);if(Gt)return Gt}return null}return v(ae)}function H(Y){function ae(xe,fe,de,Ie,Ge){var Xe=xe[fe],$e=Q(Xe);if($e!=="object")return new x("Invalid "+Ie+" `"+Ge+"` of type `"+$e+"` "+("supplied to `"+de+"`, expected `object`."));var lt=e({},xe[fe],Y);for(var At in lt){var Gt=Y[At];if(n(Y,At)&&typeof Gt!="function")return U(de,Ie,Ge,At,G(Gt));if(!Gt)return new x("Invalid "+Ie+" `"+Ge+"` key `"+At+"` supplied to `"+de+"`.\nBad object: "+JSON.stringify(xe[fe],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(Y),null,"  "));var gt=Gt(Xe,At,de,Ie,Ge+"."+At,i);if(gt)return gt}return null}return v(ae)}function V(Y){switch(typeof Y){case"number":case"string":case"undefined":return!0;case"boolean":return!Y;case"object":if(Array.isArray(Y))return Y.every(V);if(Y===null||u(Y))return!0;var ae=f(Y);if(ae){var xe=ae.call(Y),fe;if(ae!==Y.entries){for(;!(fe=xe.next()).done;)if(!V(fe.value))return!1}else for(;!(fe=xe.next()).done;){var de=fe.value;if(de&&!V(de[1]))return!1}}else return!1;return!0;default:return!1}}function $(Y,ae){return Y==="symbol"?!0:ae?ae["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&ae instanceof Symbol:!1}function Q(Y){var ae=typeof Y;return Array.isArray(Y)?"array":Y instanceof RegExp?"object":$(ae,Y)?"symbol":ae}function G(Y){if(typeof Y>"u"||Y===null)return""+Y;var ae=Q(Y);if(ae==="object"){if(Y instanceof Date)return"date";if(Y instanceof RegExp)return"regexp"}return ae}function j(Y){var ae=G(Y);switch(ae){case"array":case"object":return"an "+ae;case"boolean":case"date":case"regexp":return"a "+ae;default:return ae}}function ie(Y){return!Y.constructor||!Y.constructor.name?m:Y.constructor.name}return g.checkPropTypes=s,g.resetWarningCache=s.resetWarningCache,g.PropTypes=g,g},KT}var JT,Qk;function Boe(){if(Qk)return JT;Qk=1;var r=XT();function e(){}function i(){}return i.resetWarningCache=e,JT=function(){function n(l,u,c,d,p,f){if(f!==r){var m=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw m.name="Invariant Violation",m}}n.isRequired=n;function s(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:i,resetWarningCache:e};return o.PropTypes=o,o},JT}if(process.env.NODE_ENV!=="production"){var Noe=kk(),Loe=!0;HT.exports=Ioe()(Noe.isElement,Loe)}else HT.exports=Boe()();var Doe=HT.exports;const xt=t2(Doe);function ZT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function Ooe(r){if(Array.isArray(r))return r}function Poe(r){if(Array.isArray(r))return ZT(r)}function Kb(r,e,i){return(e=Voe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function Foe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function koe(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function Uoe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zoe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qk(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function Xk(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?qk(Object(i),!0).forEach(function(n){Kb(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):qk(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function Jb(r,e){return Ooe(r)||koe(r,e)||Yk(r,e)||Uoe()}function Zb(r){return Poe(r)||Foe(r)||Yk(r)||zoe()}function joe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Voe(r){var e=joe(r,"string");return typeof e=="symbol"?e:e+""}function Yk(r,e){if(r){if(typeof r=="string")return ZT(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ZT(r,e):void 0}}var Goe=gp({props:{width:{},height:{},yOffset:{default:1.5},glScale:{default:200},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},onNodeHover:{},onNodeClick:{},onLinkHover:{},onLinkClick:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:Xk(Xk({},Object.assign.apply(Object,[{}].concat(Zb(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map(function(r){return Kb({},r,function(e){for(var i=e.forcegraph.components.forcegraph,n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];var l=i[r].apply(i,s);return l===i?this:l})}))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.markerAttrs,s=n===void 0?{preset:"hiro"}:n;r.innerHTML="",e.container=document.createElement("div"),r.appendChild(e.container);var o=document.createElement("a-scene");o.setAttribute("embedded",""),o.setAttribute("vr-mode-ui","enabled: false"),o.setAttribute("arjs","debugUIEnabled: false;");var l=document.createElement("a-marker");Object.entries(s).forEach(function(d){var p=Jb(d,2),f=p[0],m=p[1];return l.setAttribute(f,m)}),o.appendChild(l);var u;o.appendChild(u=document.createElement("a-entity")),u.setAttribute("cursor"),u.setAttribute("raycaster","objects: [forcegraph]"),e.forcegraph=document.createElement("a-entity"),e.forcegraph.setAttribute("forcegraph",null),l.appendChild(e.forcegraph);var c=document.createElement("a-entity");c.setAttribute("camera",""),o.appendChild(c),e.container.appendChild(o)},update:function(r,e){e.hasOwnProperty("width")&&r.width&&(r.container.style.width="".concat(r.width,"px")),e.hasOwnProperty("height")&&r.height&&(r.container.style.height="".concat(r.height,"px")),e.hasOwnProperty("glScale")&&r.forcegraph.setAttribute("scale",Zb(new Array(3)).map(function(){return 1/r.glScale}).join(" ")),e.hasOwnProperty("yOffset")&&r.forcegraph.setAttribute("position","0 ".concat(r.yOffset," 0"));var i=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","onNodeHover","onNodeClick","onLinkHover","onLinkClick","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],n=Object.assign.apply(Object,[{}].concat(Zb(Object.entries(r).filter(function(s){var o=Jb(s,2),l=o[0],u=o[1];return e.hasOwnProperty(l)&&i.indexOf(l)!==-1&&u!==void 0&&u!==null}).map(function(s){var o=Jb(s,2),l=o[0],u=o[1];return Kb({},l,u)})),Zb(Object.entries(r.graphData).map(function(s){var o=Jb(s,2),l=o[0],u=o[1];return Kb({},l,u)}))));r.forcegraph.setAttribute("forcegraph",n)}});const Um=new ic,Bu=new zi,Kk=new at,$T=new zi,$b=new zi,e1=new at,eM=new at,Jk=new ps,Zk=new at,$k=new at;let zo=null,Fc=null;const Nu=[],Jh={NONE:-1,PAN:0,ROTATE:1};class Hoe extends Mb{constructor(e,i,n=null){super(i,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new N4,this.mouseButtons={LEFT:Na.PAN,MIDDLE:Na.PAN,RIGHT:Na.ROTATE},this.touches={ONE:du.PAN},this._onPointerMove=Woe.bind(this),this._onPointerDown=Qoe.bind(this),this._onPointerCancel=qoe.bind(this),this._onContextMenu=Xoe.bind(this),n!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const i=this.domElement.getBoundingClientRect();Bu.x=(e.clientX-i.left)/i.width*2-1,Bu.y=-(e.clientY-i.top)/i.height*2+1}_updateState(e){let i;if(e.pointerType==="touch")i=this.touches.ONE;else switch(e.button){case 0:i=this.mouseButtons.LEFT;break;case 1:i=this.mouseButtons.MIDDLE;break;case 2:i=this.mouseButtons.RIGHT;break;default:i=null}switch(i){case Na.PAN:case du.PAN:this.state=Jh.PAN;break;case Na.ROTATE:case du.ROTATE:this.state=Jh.ROTATE;break;default:this.state=Jh.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function Woe(r){const e=this.object,i=this.domElement,n=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(r),n.setFromCamera(Bu,e),zo)this.state===Jh.PAN?n.ray.intersectPlane(Um,e1)&&zo.position.copy(e1.sub(Kk).applyMatrix4(Jk)):this.state===Jh.ROTATE&&($T.subVectors(Bu,$b).multiplyScalar(this.rotateSpeed),zo.rotateOnWorldAxis(Zk,$T.x),zo.rotateOnWorldAxis($k.normalize(),-$T.y)),this.dispatchEvent({type:"drag",object:zo}),$b.copy(Bu);else if(r.pointerType==="mouse"||r.pointerType==="pen")if(Nu.length=0,n.setFromCamera(Bu,e),n.intersectObjects(this.objects,this.recursive,Nu),Nu.length>0){const s=Nu[0].object;Um.setFromNormalAndCoplanarPoint(e.getWorldDirection(Um.normal),eM.setFromMatrixPosition(s.matrixWorld)),Fc!==s&&Fc!==null&&(this.dispatchEvent({type:"hoveroff",object:Fc}),i.style.cursor="auto",Fc=null),Fc!==s&&(this.dispatchEvent({type:"hoveron",object:s}),i.style.cursor="pointer",Fc=s)}else Fc!==null&&(this.dispatchEvent({type:"hoveroff",object:Fc}),i.style.cursor="auto",Fc=null);$b.copy(Bu)}}function Qoe(r){const e=this.object,i=this.domElement,n=this.raycaster;this.enabled!==!1&&(this._updatePointer(r),this._updateState(r),Nu.length=0,n.setFromCamera(Bu,e),n.intersectObjects(this.objects,this.recursive,Nu),Nu.length>0&&(this.transformGroup===!0?zo=eU(Nu[0].object):zo=Nu[0].object,Um.setFromNormalAndCoplanarPoint(e.getWorldDirection(Um.normal),eM.setFromMatrixPosition(zo.matrixWorld)),n.ray.intersectPlane(Um,e1)&&(this.state===Jh.PAN?(Jk.copy(zo.parent.matrixWorld).invert(),Kk.copy(e1).sub(eM.setFromMatrixPosition(zo.matrixWorld))):this.state===Jh.ROTATE&&(Zk.set(0,1,0).applyQuaternion(e.quaternion).normalize(),$k.set(1,0,0).applyQuaternion(e.quaternion).normalize())),i.style.cursor="move",this.dispatchEvent({type:"dragstart",object:zo})),$b.copy(Bu))}function qoe(){this.enabled!==!1&&(zo&&(this.dispatchEvent({type:"dragend",object:zo}),zo=null),this.domElement.style.cursor=Fc?"pointer":"auto",this.state=Jh.NONE)}function Xoe(r){this.enabled!==!1&&r.preventDefault()}function eU(r,e=null){return r.isGroup&&(e=r),r.parent===null?e:eU(r.parent,e)}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const t1="170",Yoe=0,Koe=1,Joe=2,Zoe=1,i1=3,zm=0,lc=1,jm=2,Vm=0,Zh=1,r1=2,n1=3,s1=4,tU=5,$h=100,iU=101,rU=102,$oe=103,ele=104,nU=200,sU=201,aU=202,oU=203,a1=204,o1=205,lU=206,cU=207,uU=208,hU=209,dU=210,pU=0,fU=1,mU=2,l1=3,gU=4,AU=5,yU=6,vU=7,c1=0,tle=1,ile=2,Gm=0,rle=1,nle=2,sle=3,ale=4,ole=6,lle=7,tM=300,_p=301,Hm=302,FA=303,kA=304,iM=306,u1=1e3,Wm=1001,h1=1002,Ja=1003,rM=1004,Qm=1005,ol=1006,nM=1007,Lu=1008,ed=1009,UA=1010,zA=1011,qm=1012,Ao=1013,Da=1014,ll=1015,Du=1016,cle=1017,ule=1018,jA=1020,xU=35902,hle=1021,sM=1022,Xm=1023,dle=1024,ple=1025,Ep=1026,Ym=1027,aM=1028,oM=1029,VA=1030,lM=1031,fle=1032,cM=1033,uM=33776,d1=33777,p1=33778,f1=33779,bU=35840,_U=35841,EU=35842,wU=35843,CU=36196,hM=37492,dM=37496,pM=37808,fM=37809,mM=37810,gM=37811,AM=37812,yM=37813,vM=37814,xM=37815,bM=37816,_M=37817,EM=37818,wM=37819,CM=37820,SM=37821,TM=36492,mle=36283,SU=36284,TU=36285,MU=36286,td=0,gle=1,wp="",Nr="srgb",id="srgb-linear",RU="linear",GA="srgb",Ale=0,Cp=7680,yle=7681,vle=7682,xle=7683,ble=34055,_le=34056,Ele=5386,wle=512,Cle=513,Sle=514,Tle=515,Mle=516,Rle=517,Ile=518,MM=519,IU=512,RM=513,BU=514,NU=515,LU=516,DU=517,OU=518,PU=519,m1=35044,Km=35048,cc=2e3,Sp=2001;class Jm{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(i)===-1&&n[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let s=0,o=n.length;s<o;s++)n[s].call(this,e);e.target=null}}}const Za=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let FU=1234567;const HA=Math.PI/180,WA=180/Math.PI;function Ou(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Za[r&255]+Za[r>>8&255]+Za[r>>16&255]+Za[r>>24&255]+"-"+Za[e&255]+Za[e>>8&255]+"-"+Za[e>>16&15|64]+Za[e>>24&255]+"-"+Za[i&63|128]+Za[i>>8&255]+"-"+Za[i>>16&255]+Za[i>>24&255]+Za[n&255]+Za[n>>8&255]+Za[n>>16&255]+Za[n>>24&255]).toLowerCase()}function Oa(r,e,i){return Math.max(e,Math.min(i,r))}function IM(r,e){return(r%e+e)%e}function Ble(r,e,i,n,s){return n+(r-e)*(s-n)/(i-e)}function Nle(r,e,i){return r!==e?(i-r)/(e-r):0}function QA(r,e,i){return(1-i)*r+i*e}function Lle(r,e,i,n){return QA(r,e,1-Math.exp(-i*n))}function Dle(r,e=1){return e-Math.abs(IM(r,e*2)-e)}function Ole(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*(3-2*r))}function Ple(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*r*(r*(r*6-15)+10))}function Fle(r,e){return r+Math.floor(Math.random()*(e-r+1))}function kle(r,e){return r+Math.random()*(e-r)}function Ule(r){return r*(.5-Math.random())}function zle(r){r!==void 0&&(FU=r);let e=FU+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function jle(r){return r*HA}function Vle(r){return r*WA}function Gle(r){return(r&r-1)===0&&r!==0}function Hle(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Wle(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function Qle(r,e,i,n,s){const o=Math.cos,l=Math.sin,u=o(i/2),c=l(i/2),d=o((e+n)/2),p=l((e+n)/2),f=o((e-n)/2),m=l((e-n)/2),g=o((n-e)/2),y=l((n-e)/2);switch(s){case"XYX":r.set(u*p,c*f,c*m,u*d);break;case"YZY":r.set(c*m,u*p,c*f,u*d);break;case"ZXZ":r.set(c*f,c*m,u*p,u*d);break;case"XZX":r.set(u*p,c*y,c*g,u*d);break;case"YXY":r.set(c*g,u*p,c*y,u*d);break;case"ZYZ":r.set(c*y,c*g,u*p,u*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function yo(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function $r(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const qle={DEG2RAD:HA,RAD2DEG:WA,generateUUID:Ou,clamp:Oa,euclideanModulo:IM,mapLinear:Ble,inverseLerp:Nle,lerp:QA,damp:Lle,pingpong:Dle,smoothstep:Ole,smootherstep:Ple,randInt:Fle,randFloat:kle,randFloatSpread:Ule,seededRandom:zle,degToRad:jle,radToDeg:Vle,isPowerOfTwo:Gle,ceilPowerOfTwo:Hle,floorPowerOfTwo:Wle,setQuaternionFromProperEuler:Qle,normalize:$r,denormalize:yo};class Nn{constructor(e=0,i=0){Nn.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Oa(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),s=Math.sin(i),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*s+e.x,this.y=o*s+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class jo{constructor(e,i,n,s,o,l,u,c,d){jo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,d)}set(e,i,n,s,o,l,u,c,d){const p=this.elements;return p[0]=e,p[1]=s,p[2]=u,p[3]=i,p[4]=o,p[5]=c,p[6]=n,p[7]=l,p[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[3],c=n[6],d=n[1],p=n[4],f=n[7],m=n[2],g=n[5],y=n[8],x=s[0],v=s[3],_=s[6],T=s[1],w=s[4],S=s[7],R=s[2],B=s[5],I=s[8];return o[0]=l*x+u*T+c*R,o[3]=l*v+u*w+c*B,o[6]=l*_+u*S+c*I,o[1]=d*x+p*T+f*R,o[4]=d*v+p*w+f*B,o[7]=d*_+p*S+f*I,o[2]=m*x+g*T+y*R,o[5]=m*v+g*w+y*B,o[8]=m*_+g*S+y*I,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8];return i*l*p-i*u*d-n*o*p+n*u*c+s*o*d-s*l*c}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8],f=p*l-u*d,m=u*c-p*o,g=d*o-l*c,y=i*f+n*m+s*g;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/y;return e[0]=f*x,e[1]=(s*d-p*n)*x,e[2]=(u*n-s*l)*x,e[3]=m*x,e[4]=(p*i-s*c)*x,e[5]=(s*o-u*i)*x,e[6]=g*x,e[7]=(n*c-d*i)*x,e[8]=(l*i-n*o)*x,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,s,o,l,u){const c=Math.cos(o),d=Math.sin(o);return this.set(n*c,n*d,-n*(c*l+d*u)+l+e,-s*d,s*c,-s*(-d*l+c*u)+u+i,0,0,1),this}scale(e,i){return this.premultiply(BM.makeScale(e,i)),this}rotate(e){return this.premultiply(BM.makeRotation(-e)),this}translate(e,i){return this.premultiply(BM.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const BM=new jo;function Xle(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function NM(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function Yle(){const r=NM("canvas");return r.style.display="block",r}const kU={};function Kle(r){r in kU||(kU[r]=!0,console.warn(r))}const Ys={enabled:!0,workingColorSpace:id,spaces:{},convert:function(r,e,i){return this.enabled===!1||e===i||!e||!i||(this.spaces[e].transfer===GA&&(r.r=Pu(r.r),r.g=Pu(r.g),r.b=Pu(r.b)),this.spaces[e].primaries!==this.spaces[i].primaries&&(r.applyMatrix3(this.spaces[e].toXYZ),r.applyMatrix3(this.spaces[i].fromXYZ)),this.spaces[i].transfer===GA&&(r.r=Zm(r.r),r.g=Zm(r.g),r.b=Zm(r.b))),r},fromWorkingColorSpace:function(r,e){return this.convert(r,this.workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===wp?RU:this.spaces[r].transfer},getLuminanceCoefficients:function(r,e=this.workingColorSpace){return r.fromArray(this.spaces[e].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,e,i){return r.copy(this.spaces[e].toXYZ).multiply(this.spaces[i].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}};function Pu(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Zm(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const UU=[.64,.33,.3,.6,.15,.06],zU=[.2126,.7152,.0722],jU=[.3127,.329],VU=new jo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),GU=new jo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Ys.define({[id]:{primaries:UU,whitePoint:jU,transfer:RU,toXYZ:VU,fromXYZ:GU,luminanceCoefficients:zU,workingColorSpaceConfig:{unpackColorSpace:Nr},outputColorSpaceConfig:{drawingBufferColorSpace:Nr}},[Nr]:{primaries:UU,whitePoint:jU,transfer:GA,toXYZ:VU,fromXYZ:GU,luminanceCoefficients:zU,outputColorSpaceConfig:{drawingBufferColorSpace:Nr}}});let $m;class Jle{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{$m===void 0&&($m=NM("canvas")),$m.width=e.width,$m.height=e.height;const n=$m.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),i=$m}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=NM("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),o=s.data;for(let l=0;l<o.length;l++)o[l]=Pu(o[l]/255)*255;return n.putImageData(s,0,0),i}else if(e.data){const i=e.data.slice(0);for(let n=0;n<i.length;n++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[n]=Math.floor(Pu(i[n]/255)*255):i[n]=Pu(i[n]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Zle=0,HU=class{constructor(r=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Zle++}),this.uuid=Ou(),this.data=r,this.dataReady=!0,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const e=r===void 0||typeof r=="string";if(!e&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let o=0,l=n.length;o<l;o++)n[o].isDataTexture?s.push(LM(n[o].image)):s.push(LM(n[o]))}else s=LM(n);i.url=s}return e||(r.images[this.uuid]=i),i}};function LM(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?Jle.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let $le=0;class vo extends Jm{constructor(e=vo.DEFAULT_IMAGE,i=vo.DEFAULT_MAPPING,n=Wm,s=Wm,o=ol,l=Lu,u=Xm,c=ed,d=vo.DEFAULT_ANISOTROPY,p=wp){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:$le++}),this.uuid=Ou(),this.name="",this.source=new HU(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=l,this.anisotropy=d,this.format=u,this.internalFormat=null,this.type=c,this.offset=new Nn(0,0),this.repeat=new Nn(1,1),this.center=new Nn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new jo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==tM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case u1:e.x=e.x-Math.floor(e.x);break;case Wm:e.x=e.x<0?0:1;break;case h1:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case u1:e.y=e.y-Math.floor(e.y);break;case Wm:e.y=e.y<0?0:1;break;case h1:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}vo.DEFAULT_IMAGE=null,vo.DEFAULT_MAPPING=tM,vo.DEFAULT_ANISOTROPY=1;class Kn{constructor(e=0,i=0,n=0,s=1){Kn.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,s){return this.x=e,this.y=i,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*i+l[4]*n+l[8]*s+l[12]*o,this.y=l[1]*i+l[5]*n+l[9]*s+l[13]*o,this.z=l[2]*i+l[6]*n+l[10]*s+l[14]*o,this.w=l[3]*i+l[7]*n+l[11]*s+l[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,s,o;const l=e.elements,u=l[0],c=l[4],d=l[8],p=l[1],f=l[5],m=l[9],g=l[2],y=l[6],x=l[10];if(Math.abs(c-p)<.01&&Math.abs(d-g)<.01&&Math.abs(m-y)<.01){if(Math.abs(c+p)<.1&&Math.abs(d+g)<.1&&Math.abs(m+y)<.1&&Math.abs(u+f+x-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,T=(f+1)/2,w=(x+1)/2,S=(c+p)/4,R=(d+g)/4,B=(m+y)/4;return _>T&&_>w?_<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(_),s=S/n,o=R/n):T>w?T<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(T),n=S/s,o=B/s):w<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(w),n=R/o,s=B/o),this.set(n,s,o,i),this}let v=Math.sqrt((y-m)*(y-m)+(d-g)*(d-g)+(p-c)*(p-c));return Math.abs(v)<.001&&(v=1),this.x=(y-m)/v,this.y=(d-g)/v,this.z=(p-c)/v,this.w=Math.acos((u+f+x-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class eg extends Jm{constructor(e=1,i=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new Kn(0,0,e,i),this.scissorTest=!1,this.viewport=new Kn(0,0,e,i);const s={width:e,height:i,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ol,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const o=new vo(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);o.flipY=!1,o.generateMipmaps=n.generateMipmaps,o.internalFormat=n.internalFormat,this.textures=[];const l=n.count;for(let u=0;u<l;u++)this.textures[u]=o.clone(),this.textures[u].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,i,n=1){if(this.width!==e||this.height!==i||this.depth!==n){this.width=e,this.height=i,this.depth=n;for(let s=0,o=this.textures.length;s<o;s++)this.textures[s].image.width=e,this.textures[s].image.height=i,this.textures[s].image.depth=n;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,s=e.textures.length;n<s;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new HU(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ece extends eg{constructor(e=1,i=1,n={}){super(e,i,n),this.isWebGLRenderTarget=!0}}class tce extends vo{constructor(e=null,i=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:n,depth:s},this.magFilter=Ja,this.minFilter=Ja,this.wrapR=Wm,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class qA{constructor(e=0,i=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=n,this._w=s}static slerpFlat(e,i,n,s,o,l,u){let c=n[s+0],d=n[s+1],p=n[s+2],f=n[s+3];const m=o[l+0],g=o[l+1],y=o[l+2],x=o[l+3];if(u===0){e[i+0]=c,e[i+1]=d,e[i+2]=p,e[i+3]=f;return}if(u===1){e[i+0]=m,e[i+1]=g,e[i+2]=y,e[i+3]=x;return}if(f!==x||c!==m||d!==g||p!==y){let v=1-u;const _=c*m+d*g+p*y+f*x,T=_>=0?1:-1,w=1-_*_;if(w>Number.EPSILON){const R=Math.sqrt(w),B=Math.atan2(R,_*T);v=Math.sin(v*B)/R,u=Math.sin(u*B)/R}const S=u*T;if(c=c*v+m*S,d=d*v+g*S,p=p*v+y*S,f=f*v+x*S,v===1-u){const R=1/Math.sqrt(c*c+d*d+p*p+f*f);c*=R,d*=R,p*=R,f*=R}}e[i]=c,e[i+1]=d,e[i+2]=p,e[i+3]=f}static multiplyQuaternionsFlat(e,i,n,s,o,l){const u=n[s],c=n[s+1],d=n[s+2],p=n[s+3],f=o[l],m=o[l+1],g=o[l+2],y=o[l+3];return e[i]=u*y+p*f+c*g-d*m,e[i+1]=c*y+p*m+d*f-u*g,e[i+2]=d*y+p*g+u*m-c*f,e[i+3]=p*y-u*f-c*m-d*g,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,n,s){return this._x=e,this._y=i,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const n=e._x,s=e._y,o=e._z,l=e._order,u=Math.cos,c=Math.sin,d=u(n/2),p=u(s/2),f=u(o/2),m=c(n/2),g=c(s/2),y=c(o/2);switch(l){case"XYZ":this._x=m*p*f+d*g*y,this._y=d*g*f-m*p*y,this._z=d*p*y+m*g*f,this._w=d*p*f-m*g*y;break;case"YXZ":this._x=m*p*f+d*g*y,this._y=d*g*f-m*p*y,this._z=d*p*y-m*g*f,this._w=d*p*f+m*g*y;break;case"ZXY":this._x=m*p*f-d*g*y,this._y=d*g*f+m*p*y,this._z=d*p*y+m*g*f,this._w=d*p*f-m*g*y;break;case"ZYX":this._x=m*p*f-d*g*y,this._y=d*g*f+m*p*y,this._z=d*p*y-m*g*f,this._w=d*p*f+m*g*y;break;case"YZX":this._x=m*p*f+d*g*y,this._y=d*g*f+m*p*y,this._z=d*p*y-m*g*f,this._w=d*p*f-m*g*y;break;case"XZY":this._x=m*p*f-d*g*y,this._y=d*g*f-m*p*y,this._z=d*p*y+m*g*f,this._w=d*p*f+m*g*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const n=i/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,n=i[0],s=i[4],o=i[8],l=i[1],u=i[5],c=i[9],d=i[2],p=i[6],f=i[10],m=n+u+f;if(m>0){const g=.5/Math.sqrt(m+1);this._w=.25/g,this._x=(p-c)*g,this._y=(o-d)*g,this._z=(l-s)*g}else if(n>u&&n>f){const g=2*Math.sqrt(1+n-u-f);this._w=(p-c)/g,this._x=.25*g,this._y=(s+l)/g,this._z=(o+d)/g}else if(u>f){const g=2*Math.sqrt(1+u-n-f);this._w=(o-d)/g,this._x=(s+l)/g,this._y=.25*g,this._z=(c+p)/g}else{const g=2*Math.sqrt(1+f-n-u);this._w=(l-s)/g,this._x=(o+d)/g,this._y=(c+p)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let n=e.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Oa(this.dot(e),-1,1)))}rotateTowards(e,i){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,i/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const n=e._x,s=e._y,o=e._z,l=e._w,u=i._x,c=i._y,d=i._z,p=i._w;return this._x=n*p+l*u+s*d-o*c,this._y=s*p+l*c+o*u-n*d,this._z=o*p+l*d+n*c-s*u,this._w=l*p-n*u-s*c-o*d,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const n=this._x,s=this._y,o=this._z,l=this._w;let u=l*e._w+n*e._x+s*e._y+o*e._z;if(u<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,u=-u):this.copy(e),u>=1)return this._w=l,this._x=n,this._y=s,this._z=o,this;const c=1-u*u;if(c<=Number.EPSILON){const g=1-i;return this._w=g*l+i*this._w,this._x=g*n+i*this._x,this._y=g*s+i*this._y,this._z=g*o+i*this._z,this.normalize(),this}const d=Math.sqrt(c),p=Math.atan2(d,u),f=Math.sin((1-i)*p)/d,m=Math.sin(i*p)/d;return this._w=l*f+this._w*m,this._x=n*f+this._x*m,this._y=s*f+this._y*m,this._z=o*f+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,i,n){return this.copy(e).slerp(i,n)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),o=Math.sqrt(n);return this.set(s*Math.sin(e),s*Math.cos(e),o*Math.sin(i),o*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class It{constructor(e=0,i=0,n=0){It.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(WU.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(WU.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*n+o[6]*s,this.y=o[1]*i+o[4]*n+o[7]*s,this.z=o[2]*i+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=e.elements,l=1/(o[3]*i+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*n+o[8]*s+o[12])*l,this.y=(o[1]*i+o[5]*n+o[9]*s+o[13])*l,this.z=(o[2]*i+o[6]*n+o[10]*s+o[14])*l,this}applyQuaternion(e){const i=this.x,n=this.y,s=this.z,o=e.x,l=e.y,u=e.z,c=e.w,d=2*(l*s-u*n),p=2*(u*i-o*s),f=2*(o*n-l*i);return this.x=i+c*d+l*f-u*p,this.y=n+c*p+u*d-o*f,this.z=s+c*f+o*p-l*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*s,this.y=o[1]*i+o[5]*n+o[9]*s,this.z=o[2]*i+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,s=e.y,o=e.z,l=i.x,u=i.y,c=i.z;return this.x=s*c-o*u,this.y=o*l-n*c,this.z=n*u-s*l,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return DM.copy(this).projectOnVector(e),this.sub(DM)}reflect(e){return this.sub(DM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Oa(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return i*i+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const s=Math.sin(i)*e;return this.x=s*Math.sin(n),this.y=Math.cos(i)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const DM=new It,WU=new qA;class XA{constructor(e=new It(1/0,1/0,1/0),i=new It(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i+=3)this.expandByPoint(uc.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,n=e.count;i<n;i++)this.expandByPoint(uc.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const n=uc.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const o=n.getAttribute("position");if(i===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let l=0,u=o.count;l<u;l++)e.isMesh===!0?e.getVertexPosition(l,uc):uc.fromBufferAttribute(o,l),uc.applyMatrix4(e.matrixWorld),this.expandByPoint(uc);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),g1.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),g1.copy(n.boundingBox)),g1.applyMatrix4(e.matrixWorld),this.union(g1)}const s=e.children;for(let o=0,l=s.length;o<l;o++)this.expandByObject(s[o],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,uc),uc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,n;return e.normal.x>0?(i=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),i<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(YA),A1.subVectors(this.max,YA),tg.subVectors(e.a,YA),ig.subVectors(e.b,YA),rg.subVectors(e.c,YA),rd.subVectors(ig,tg),nd.subVectors(rg,ig),Tp.subVectors(tg,rg);let i=[0,-rd.z,rd.y,0,-nd.z,nd.y,0,-Tp.z,Tp.y,rd.z,0,-rd.x,nd.z,0,-nd.x,Tp.z,0,-Tp.x,-rd.y,rd.x,0,-nd.y,nd.x,0,-Tp.y,Tp.x,0];return!OM(i,tg,ig,rg,A1)||(i=[1,0,0,0,1,0,0,0,1],!OM(i,tg,ig,rg,A1))?!1:(y1.crossVectors(rd,nd),i=[y1.x,y1.y,y1.z],OM(i,tg,ig,rg,A1))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,uc).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(uc).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Fu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Fu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Fu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Fu=[new It,new It,new It,new It,new It,new It,new It,new It],uc=new It,g1=new XA,tg=new It,ig=new It,rg=new It,rd=new It,nd=new It,Tp=new It,YA=new It,A1=new It,y1=new It,Mp=new It;function OM(r,e,i,n,s){for(let o=0,l=r.length-3;o<=l;o+=3){Mp.fromArray(r,o);const u=s.x*Math.abs(Mp.x)+s.y*Math.abs(Mp.y)+s.z*Math.abs(Mp.z),c=e.dot(Mp),d=i.dot(Mp),p=n.dot(Mp);if(Math.max(-Math.max(c,d,p),Math.min(c,d,p))>u)return!1}return!0}const ice=new XA,KA=new It,PM=new It;class FM{constructor(e=new It,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const n=this.center;i!==void 0?n.copy(i):ice.setFromPoints(e).getCenter(n);let s=0;for(let o=0,l=e.length;o<l;o++)s=Math.max(s,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const n=this.center.distanceToSquared(e);return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;KA.subVectors(e,this.center);const i=KA.lengthSq();if(i>this.radius*this.radius){const n=Math.sqrt(i),s=(n-this.radius)*.5;this.center.addScaledVector(KA,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(PM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(KA.copy(e.center).add(PM)),this.expandByPoint(KA.copy(e.center).sub(PM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ku=new It,kM=new It,v1=new It,sd=new It,UM=new It,x1=new It,zM=new It;class rce{constructor(e=new It,i=new It(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ku)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=ku.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(ku.copy(this.origin).addScaledVector(this.direction,i),ku.distanceToSquared(e))}distanceSqToSegment(e,i,n,s){kM.copy(e).add(i).multiplyScalar(.5),v1.copy(i).sub(e).normalize(),sd.copy(this.origin).sub(kM);const o=e.distanceTo(i)*.5,l=-this.direction.dot(v1),u=sd.dot(this.direction),c=-sd.dot(v1),d=sd.lengthSq(),p=Math.abs(1-l*l);let f,m,g,y;if(p>0)if(f=l*c-u,m=l*u-c,y=o*p,f>=0)if(m>=-y)if(m<=y){const x=1/p;f*=x,m*=x,g=f*(f+l*m+2*u)+m*(l*f+m+2*c)+d}else m=o,f=Math.max(0,-(l*m+u)),g=-f*f+m*(m+2*c)+d;else m=-o,f=Math.max(0,-(l*m+u)),g=-f*f+m*(m+2*c)+d;else m<=-y?(f=Math.max(0,-(-l*o+u)),m=f>0?-o:Math.min(Math.max(-o,-c),o),g=-f*f+m*(m+2*c)+d):m<=y?(f=0,m=Math.min(Math.max(-o,-c),o),g=m*(m+2*c)+d):(f=Math.max(0,-(l*o+u)),m=f>0?o:Math.min(Math.max(-o,-c),o),g=-f*f+m*(m+2*c)+d);else m=l>0?-o:o,f=Math.max(0,-(l*m+u)),g=-f*f+m*(m+2*c)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,f),s&&s.copy(kM).addScaledVector(v1,m),g}intersectSphere(e,i){ku.subVectors(e.center,this.origin);const n=ku.dot(this.direction),s=ku.dot(ku)-n*n,o=e.radius*e.radius;if(s>o)return null;const l=Math.sqrt(o-s),u=n-l,c=n+l;return c<0?null:u<0?this.at(c,i):this.at(u,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/i;return n>=0?n:null}intersectPlane(e,i){const n=this.distanceToPlane(e);return n===null?null:this.at(n,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let n,s,o,l,u,c;const d=1/this.direction.x,p=1/this.direction.y,f=1/this.direction.z,m=this.origin;return d>=0?(n=(e.min.x-m.x)*d,s=(e.max.x-m.x)*d):(n=(e.max.x-m.x)*d,s=(e.min.x-m.x)*d),p>=0?(o=(e.min.y-m.y)*p,l=(e.max.y-m.y)*p):(o=(e.max.y-m.y)*p,l=(e.min.y-m.y)*p),n>l||o>s||((o>n||isNaN(n))&&(n=o),(l<s||isNaN(s))&&(s=l),f>=0?(u=(e.min.z-m.z)*f,c=(e.max.z-m.z)*f):(u=(e.max.z-m.z)*f,c=(e.min.z-m.z)*f),n>c||u>s)||((u>n||n!==n)&&(n=u),(c<s||s!==s)&&(s=c),s<0)?null:this.at(n>=0?n:s,i)}intersectsBox(e){return this.intersectBox(e,ku)!==null}intersectTriangle(e,i,n,s,o){UM.subVectors(i,e),x1.subVectors(n,e),zM.crossVectors(UM,x1);let l=this.direction.dot(zM),u;if(l>0){if(s)return null;u=1}else if(l<0)u=-1,l=-l;else return null;sd.subVectors(this.origin,e);const c=u*this.direction.dot(x1.crossVectors(sd,x1));if(c<0)return null;const d=u*this.direction.dot(UM.cross(sd));if(d<0||c+d>l)return null;const p=-u*sd.dot(zM);return p<0?null:this.at(p/l,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class bs{constructor(e,i,n,s,o,l,u,c,d,p,f,m,g,y,x,v){bs.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,d,p,f,m,g,y,x,v)}set(e,i,n,s,o,l,u,c,d,p,f,m,g,y,x,v){const _=this.elements;return _[0]=e,_[4]=i,_[8]=n,_[12]=s,_[1]=o,_[5]=l,_[9]=u,_[13]=c,_[2]=d,_[6]=p,_[10]=f,_[14]=m,_[3]=g,_[7]=y,_[11]=x,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new bs().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,s=1/ng.setFromMatrixColumn(e,0).length(),o=1/ng.setFromMatrixColumn(e,1).length(),l=1/ng.setFromMatrixColumn(e,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*l,i[9]=n[9]*l,i[10]=n[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,s=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),d=Math.sin(s),p=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){const m=l*p,g=l*f,y=u*p,x=u*f;i[0]=c*p,i[4]=-c*f,i[8]=d,i[1]=g+y*d,i[5]=m-x*d,i[9]=-u*c,i[2]=x-m*d,i[6]=y+g*d,i[10]=l*c}else if(e.order==="YXZ"){const m=c*p,g=c*f,y=d*p,x=d*f;i[0]=m+x*u,i[4]=y*u-g,i[8]=l*d,i[1]=l*f,i[5]=l*p,i[9]=-u,i[2]=g*u-y,i[6]=x+m*u,i[10]=l*c}else if(e.order==="ZXY"){const m=c*p,g=c*f,y=d*p,x=d*f;i[0]=m-x*u,i[4]=-l*f,i[8]=y+g*u,i[1]=g+y*u,i[5]=l*p,i[9]=x-m*u,i[2]=-l*d,i[6]=u,i[10]=l*c}else if(e.order==="ZYX"){const m=l*p,g=l*f,y=u*p,x=u*f;i[0]=c*p,i[4]=y*d-g,i[8]=m*d+x,i[1]=c*f,i[5]=x*d+m,i[9]=g*d-y,i[2]=-d,i[6]=u*c,i[10]=l*c}else if(e.order==="YZX"){const m=l*c,g=l*d,y=u*c,x=u*d;i[0]=c*p,i[4]=x-m*f,i[8]=y*f+g,i[1]=f,i[5]=l*p,i[9]=-u*p,i[2]=-d*p,i[6]=g*f+y,i[10]=m-x*f}else if(e.order==="XZY"){const m=l*c,g=l*d,y=u*c,x=u*d;i[0]=c*p,i[4]=-f,i[8]=d*p,i[1]=m*f+x,i[5]=l*p,i[9]=g*f-y,i[2]=y*f-g,i[6]=u*p,i[10]=x*f+m}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(nce,e,sce)}lookAt(e,i,n){const s=this.elements;return cl.subVectors(e,i),cl.lengthSq()===0&&(cl.z=1),cl.normalize(),ad.crossVectors(n,cl),ad.lengthSq()===0&&(Math.abs(n.z)===1?cl.x+=1e-4:cl.z+=1e-4,cl.normalize(),ad.crossVectors(n,cl)),ad.normalize(),b1.crossVectors(cl,ad),s[0]=ad.x,s[4]=b1.x,s[8]=cl.x,s[1]=ad.y,s[5]=b1.y,s[9]=cl.y,s[2]=ad.z,s[6]=b1.z,s[10]=cl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[4],c=n[8],d=n[12],p=n[1],f=n[5],m=n[9],g=n[13],y=n[2],x=n[6],v=n[10],_=n[14],T=n[3],w=n[7],S=n[11],R=n[15],B=s[0],I=s[4],D=s[8],L=s[12],O=s[1],U=s[5],J=s[9],H=s[13],V=s[2],$=s[6],Q=s[10],G=s[14],j=s[3],ie=s[7],Y=s[11],ae=s[15];return o[0]=l*B+u*O+c*V+d*j,o[4]=l*I+u*U+c*$+d*ie,o[8]=l*D+u*J+c*Q+d*Y,o[12]=l*L+u*H+c*G+d*ae,o[1]=p*B+f*O+m*V+g*j,o[5]=p*I+f*U+m*$+g*ie,o[9]=p*D+f*J+m*Q+g*Y,o[13]=p*L+f*H+m*G+g*ae,o[2]=y*B+x*O+v*V+_*j,o[6]=y*I+x*U+v*$+_*ie,o[10]=y*D+x*J+v*Q+_*Y,o[14]=y*L+x*H+v*G+_*ae,o[3]=T*B+w*O+S*V+R*j,o[7]=T*I+w*U+S*$+R*ie,o[11]=T*D+w*J+S*Q+R*Y,o[15]=T*L+w*H+S*G+R*ae,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],s=e[8],o=e[12],l=e[1],u=e[5],c=e[9],d=e[13],p=e[2],f=e[6],m=e[10],g=e[14],y=e[3],x=e[7],v=e[11],_=e[15];return y*(+o*c*f-s*d*f-o*u*m+n*d*m+s*u*g-n*c*g)+x*(+i*c*g-i*d*m+o*l*m-s*l*g+s*d*p-o*c*p)+v*(+i*d*f-i*u*g-o*l*f+n*l*g+o*u*p-n*d*p)+_*(-s*u*p-i*c*f+i*u*m+s*l*f-n*l*m+n*c*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8],f=e[9],m=e[10],g=e[11],y=e[12],x=e[13],v=e[14],_=e[15],T=f*v*d-x*m*d+x*c*g-u*v*g-f*c*_+u*m*_,w=y*m*d-p*v*d-y*c*g+l*v*g+p*c*_-l*m*_,S=p*x*d-y*f*d+y*u*g-l*x*g-p*u*_+l*f*_,R=y*f*c-p*x*c-y*u*m+l*x*m+p*u*v-l*f*v,B=i*T+n*w+s*S+o*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/B;return e[0]=T*I,e[1]=(x*m*o-f*v*o-x*s*g+n*v*g+f*s*_-n*m*_)*I,e[2]=(u*v*o-x*c*o+x*s*d-n*v*d-u*s*_+n*c*_)*I,e[3]=(f*c*o-u*m*o-f*s*d+n*m*d+u*s*g-n*c*g)*I,e[4]=w*I,e[5]=(p*v*o-y*m*o+y*s*g-i*v*g-p*s*_+i*m*_)*I,e[6]=(y*c*o-l*v*o-y*s*d+i*v*d+l*s*_-i*c*_)*I,e[7]=(l*m*o-p*c*o+p*s*d-i*m*d-l*s*g+i*c*g)*I,e[8]=S*I,e[9]=(y*f*o-p*x*o-y*n*g+i*x*g+p*n*_-i*f*_)*I,e[10]=(l*x*o-y*u*o+y*n*d-i*x*d-l*n*_+i*u*_)*I,e[11]=(p*u*o-l*f*o-p*n*d+i*f*d+l*n*g-i*u*g)*I,e[12]=R*I,e[13]=(p*x*s-y*f*s+y*n*m-i*x*m-p*n*v+i*f*v)*I,e[14]=(y*u*s-l*x*s-y*n*c+i*x*c+l*n*v-i*u*v)*I,e[15]=(l*f*s-p*u*s+p*n*c-i*f*c-l*n*m+i*u*m)*I,this}scale(e){const i=this.elements,n=e.x,s=e.y,o=e.z;return i[0]*=n,i[4]*=s,i[8]*=o,i[1]*=n,i[5]*=s,i[9]*=o,i[2]*=n,i[6]*=s,i[10]*=o,i[3]*=n,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,s))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),s=Math.sin(i),o=1-n,l=e.x,u=e.y,c=e.z,d=o*l,p=o*u;return this.set(d*l+n,d*u-s*c,d*c+s*u,0,d*u+s*c,p*u+n,p*c-s*l,0,d*c-s*u,p*c+s*l,o*c*c+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,s,o,l){return this.set(1,n,o,0,e,1,l,0,i,s,1,0,0,0,0,1),this}compose(e,i,n){const s=this.elements,o=i._x,l=i._y,u=i._z,c=i._w,d=o+o,p=l+l,f=u+u,m=o*d,g=o*p,y=o*f,x=l*p,v=l*f,_=u*f,T=c*d,w=c*p,S=c*f,R=n.x,B=n.y,I=n.z;return s[0]=(1-(x+_))*R,s[1]=(g+S)*R,s[2]=(y-w)*R,s[3]=0,s[4]=(g-S)*B,s[5]=(1-(m+_))*B,s[6]=(v+T)*B,s[7]=0,s[8]=(y+w)*I,s[9]=(v-T)*I,s[10]=(1-(m+x))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,n){const s=this.elements;let o=ng.set(s[0],s[1],s[2]).length();const l=ng.set(s[4],s[5],s[6]).length(),u=ng.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],hc.copy(this);const c=1/o,d=1/l,p=1/u;return hc.elements[0]*=c,hc.elements[1]*=c,hc.elements[2]*=c,hc.elements[4]*=d,hc.elements[5]*=d,hc.elements[6]*=d,hc.elements[8]*=p,hc.elements[9]*=p,hc.elements[10]*=p,i.setFromRotationMatrix(hc),n.x=o,n.y=l,n.z=u,this}makePerspective(e,i,n,s,o,l,u=cc){const c=this.elements,d=2*o/(i-e),p=2*o/(n-s),f=(i+e)/(i-e),m=(n+s)/(n-s);let g,y;if(u===cc)g=-(l+o)/(l-o),y=-2*l*o/(l-o);else if(u===Sp)g=-l/(l-o),y=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=d,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,n,s,o,l,u=cc){const c=this.elements,d=1/(i-e),p=1/(n-s),f=1/(l-o),m=(i+e)*d,g=(n+s)*p;let y,x;if(u===cc)y=(l+o)*f,x=-2*f;else if(u===Sp)y=o*f,x=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*d,c[4]=0,c[8]=0,c[12]=-m,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-g,c[2]=0,c[6]=0,c[10]=x,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}}const ng=new It,hc=new bs,nce=new It(0,0,0),sce=new It(1,1,1),ad=new It,b1=new It,cl=new It,QU=new bs,qU=new qA;class dc{constructor(e=0,i=0,n=0,s=dc.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,s=this._order){return this._x=e,this._y=i,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],c=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];switch(i){case"XYZ":this._y=Math.asin(Oa(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-p,g),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(m,d),this._z=0);break;case"YXZ":this._x=Math.asin(-Oa(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(u,g),this._z=Math.atan2(c,d)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(Oa(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-f,g),this._z=Math.atan2(-l,d)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Oa(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(m,g),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-l,d));break;case"YZX":this._z=Math.asin(Oa(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,d),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,g));break;case"XZY":this._z=Math.asin(-Oa(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(m,d),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-p,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return QU.makeRotationFromQuaternion(e),this.setFromRotationMatrix(QU,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return qU.setFromEuler(this),this.setFromQuaternion(qU,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}dc.DEFAULT_ORDER="XYZ";class ace{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let oce=0;const XU=new It,sg=new qA,Uu=new bs,_1=new It,JA=new It,lce=new It,cce=new qA,YU=new It(1,0,0),KU=new It(0,1,0),JU=new It(0,0,1),ZU={type:"added"},uce={type:"removed"},ag={type:"childadded",child:null},jM={type:"childremoved",child:null};class Ea extends Jm{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:oce++}),this.uuid=Ou(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ea.DEFAULT_UP.clone();const e=new It,i=new dc,n=new qA,s=new It(1,1,1);function o(){n.setFromEuler(i,!1)}function l(){i.setFromQuaternion(n,void 0,!1)}i._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new bs},normalMatrix:{value:new jo}}),this.matrix=new bs,this.matrixWorld=new bs,this.matrixAutoUpdate=Ea.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ea.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ace,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return sg.setFromAxisAngle(e,i),this.quaternion.multiply(sg),this}rotateOnWorldAxis(e,i){return sg.setFromAxisAngle(e,i),this.quaternion.premultiply(sg),this}rotateX(e){return this.rotateOnAxis(YU,e)}rotateY(e){return this.rotateOnAxis(KU,e)}rotateZ(e){return this.rotateOnAxis(JU,e)}translateOnAxis(e,i){return XU.copy(e).applyQuaternion(this.quaternion),this.position.add(XU.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(YU,e)}translateY(e){return this.translateOnAxis(KU,e)}translateZ(e){return this.translateOnAxis(JU,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Uu.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?_1.copy(e):_1.set(e,i,n);const s=this.parent;this.updateWorldMatrix(!0,!1),JA.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Uu.lookAt(JA,_1,this.up):Uu.lookAt(_1,JA,this.up),this.quaternion.setFromRotationMatrix(Uu),s&&(Uu.extractRotation(s.matrixWorld),sg.setFromRotationMatrix(Uu),this.quaternion.premultiply(sg.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(ZU),ag.child=e,this.dispatchEvent(ag),ag.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(uce),jM.child=e,this.dispatchEvent(jM),jM.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Uu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Uu.multiply(e.parent.matrixWorld)),e.applyMatrix4(Uu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(ZU),ag.child=e,this.dispatchEvent(ag),ag.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(JA,e,lce),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(JA,cce,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].updateMatrixWorld(e)}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let d=0,p=c.length;d<p;d++){const f=c[d];o(e.shapes,f)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,d=this.material.length;c<d;c++)u.push(o(e.materials,this.material[c]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];s.animations.push(o(e.animations,c))}}if(i){const u=l(e.geometries),c=l(e.materials),d=l(e.textures),p=l(e.images),f=l(e.shapes),m=l(e.skeletons),g=l(e.animations),y=l(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),d.length>0&&(n.textures=d),p.length>0&&(n.images=p),f.length>0&&(n.shapes=f),m.length>0&&(n.skeletons=m),g.length>0&&(n.animations=g),y.length>0&&(n.nodes=y)}return n.object=s,n;function l(u){const c=[];for(const d in u){const p=u[d];delete p.metadata,c.push(p)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}Ea.DEFAULT_UP=new It(0,1,0),Ea.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ea.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const pc=new It,zu=new It,VM=new It,ju=new It,og=new It,lg=new It,$U=new It,GM=new It,HM=new It,WM=new It,QM=new Kn,qM=new Kn,XM=new Kn;class fc{constructor(e=new It,i=new It,n=new It){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,s){s.subVectors(n,i),pc.subVectors(e,i),s.cross(pc);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,n,s,o){pc.subVectors(s,i),zu.subVectors(n,i),VM.subVectors(e,i);const l=pc.dot(pc),u=pc.dot(zu),c=pc.dot(VM),d=zu.dot(zu),p=zu.dot(VM),f=l*d-u*u;if(f===0)return o.set(0,0,0),null;const m=1/f,g=(d*c-u*p)*m,y=(l*p-u*c)*m;return o.set(1-g-y,y,g)}static containsPoint(e,i,n,s){return this.getBarycoord(e,i,n,s,ju)===null?!1:ju.x>=0&&ju.y>=0&&ju.x+ju.y<=1}static getInterpolation(e,i,n,s,o,l,u,c){return this.getBarycoord(e,i,n,s,ju)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,ju.x),c.addScaledVector(l,ju.y),c.addScaledVector(u,ju.z),c)}static getInterpolatedAttribute(e,i,n,s,o,l){return QM.setScalar(0),qM.setScalar(0),XM.setScalar(0),QM.fromBufferAttribute(e,i),qM.fromBufferAttribute(e,n),XM.fromBufferAttribute(e,s),l.setScalar(0),l.addScaledVector(QM,o.x),l.addScaledVector(qM,o.y),l.addScaledVector(XM,o.z),l}static isFrontFacing(e,i,n,s){return pc.subVectors(n,i),zu.subVectors(e,i),pc.cross(zu).dot(s)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,s){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,n,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pc.subVectors(this.c,this.b),zu.subVectors(this.a,this.b),pc.cross(zu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return fc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return fc.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,s,o){return fc.getInterpolation(e,this.a,this.b,this.c,i,n,s,o)}containsPoint(e){return fc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return fc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,s=this.b,o=this.c;let l,u;og.subVectors(s,n),lg.subVectors(o,n),GM.subVectors(e,n);const c=og.dot(GM),d=lg.dot(GM);if(c<=0&&d<=0)return i.copy(n);HM.subVectors(e,s);const p=og.dot(HM),f=lg.dot(HM);if(p>=0&&f<=p)return i.copy(s);const m=c*f-p*d;if(m<=0&&c>=0&&p<=0)return l=c/(c-p),i.copy(n).addScaledVector(og,l);WM.subVectors(e,o);const g=og.dot(WM),y=lg.dot(WM);if(y>=0&&g<=y)return i.copy(o);const x=g*d-c*y;if(x<=0&&d>=0&&y<=0)return u=d/(d-y),i.copy(n).addScaledVector(lg,u);const v=p*y-g*f;if(v<=0&&f-p>=0&&g-y>=0)return $U.subVectors(o,s),u=(f-p)/(f-p+(g-y)),i.copy(s).addScaledVector($U,u);const _=1/(v+x+m);return l=x*_,u=m*_,i.copy(n).addScaledVector(og,l).addScaledVector(lg,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const e5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},od={h:0,s:0,l:0},E1={h:0,s:0,l:0};function YM(r,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(e-r)*6*i:i<1/2?e:i<2/3?r+(e-r)*6*(2/3-i):r}class Jn{constructor(e,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,n)}set(e,i,n){if(i===void 0&&n===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,i,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Nr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ys.toWorkingColorSpace(this,i),this}setRGB(e,i,n,s=Ys.workingColorSpace){return this.r=e,this.g=i,this.b=n,Ys.toWorkingColorSpace(this,s),this}setHSL(e,i,n,s=Ys.workingColorSpace){if(e=IM(e,1),i=Oa(i,0,1),n=Oa(n,0,1),i===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+i):n+i-n*i,l=2*n-o;this.r=YM(l,o,e+1/3),this.g=YM(l,o,e),this.b=YM(l,o,e-1/3)}return Ys.toWorkingColorSpace(this,s),this}setStyle(e,i=Nr){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const l=s[1],u=s[2];switch(l){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,i);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,i);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=s[1],l=o.length;if(l===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,i);if(l===6)return this.setHex(parseInt(o,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=Nr){const n=e5[e.toLowerCase()];return n!==void 0?this.setHex(n,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Pu(e.r),this.g=Pu(e.g),this.b=Pu(e.b),this}copyLinearToSRGB(e){return this.r=Zm(e.r),this.g=Zm(e.g),this.b=Zm(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Nr){return Ys.fromWorkingColorSpace($a.copy(this),e),Math.round(Oa($a.r*255,0,255))*65536+Math.round(Oa($a.g*255,0,255))*256+Math.round(Oa($a.b*255,0,255))}getHexString(e=Nr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=Ys.workingColorSpace){Ys.fromWorkingColorSpace($a.copy(this),i);const n=$a.r,s=$a.g,o=$a.b,l=Math.max(n,s,o),u=Math.min(n,s,o);let c,d;const p=(u+l)/2;if(u===l)c=0,d=0;else{const f=l-u;switch(d=p<=.5?f/(l+u):f/(2-l-u),l){case n:c=(s-o)/f+(s<o?6:0);break;case s:c=(o-n)/f+2;break;case o:c=(n-s)/f+4;break}c/=6}return e.h=c,e.s=d,e.l=p,e}getRGB(e,i=Ys.workingColorSpace){return Ys.fromWorkingColorSpace($a.copy(this),i),e.r=$a.r,e.g=$a.g,e.b=$a.b,e}getStyle(e=Nr){Ys.fromWorkingColorSpace($a.copy(this),e);const i=$a.r,n=$a.g,s=$a.b;return e!==Nr?`color(${e} ${i.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(e,i,n){return this.getHSL(od),this.setHSL(od.h+e,od.s+i,od.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,n){return this.r=e.r+(i.r-e.r)*n,this.g=e.g+(i.g-e.g)*n,this.b=e.b+(i.b-e.b)*n,this}lerpHSL(e,i){this.getHSL(od),e.getHSL(E1);const n=QA(od.h,E1.h,i),s=QA(od.s,E1.s,i),o=QA(od.l,E1.l,i);return this.setHSL(n,s,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,n=this.g,s=this.b,o=e.elements;return this.r=o[0]*i+o[3]*n+o[6]*s,this.g=o[1]*i+o[4]*n+o[7]*s,this.b=o[2]*i+o[5]*n+o[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const $a=new Jn;Jn.NAMES=e5;let hce=0;class Vo extends Jm{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:hce++}),this.uuid=Ou(),this.name="",this.blending=Zh,this.side=zm,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=a1,this.blendDst=o1,this.blendEquation=$h,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Jn(0,0,0),this.blendAlpha=0,this.depthFunc=l1,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=MM,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Cp,this.stencilZFail=Cp,this.stencilZPass=Cp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const n=e[i];if(n===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const s=this[i];if(s===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[i]=n}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Zh&&(n.blending=this.blending),this.side!==zm&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==a1&&(n.blendSrc=this.blendSrc),this.blendDst!==o1&&(n.blendDst=this.blendDst),this.blendEquation!==$h&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==l1&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==MM&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Cp&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Cp&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Cp&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}if(i){const o=s(e.textures),l=s(e.images);o.length>0&&(n.textures=o),l.length>0&&(n.images=l)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let n=null;if(i!==null){const s=i.length;n=new Array(s);for(let o=0;o!==s;++o)n[o]=i[o].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class w1 extends Vo{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new Jn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new dc,this.combine=c1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Vu=dce();function dce(){const r=new ArrayBuffer(4),e=new Float32Array(r),i=new Uint32Array(r),n=new Uint32Array(512),s=new Uint32Array(512);for(let c=0;c<256;++c){const d=c-127;d<-27?(n[c]=0,n[c|256]=32768,s[c]=24,s[c|256]=24):d<-14?(n[c]=1024>>-d-14,n[c|256]=1024>>-d-14|32768,s[c]=-d-1,s[c|256]=-d-1):d<=15?(n[c]=d+15<<10,n[c|256]=d+15<<10|32768,s[c]=13,s[c|256]=13):d<128?(n[c]=31744,n[c|256]=64512,s[c]=24,s[c|256]=24):(n[c]=31744,n[c|256]=64512,s[c]=13,s[c|256]=13)}const o=new Uint32Array(2048),l=new Uint32Array(64),u=new Uint32Array(64);for(let c=1;c<1024;++c){let d=c<<13,p=0;for(;!(d&8388608);)d<<=1,p-=8388608;d&=-8388609,p+=947912704,o[c]=d|p}for(let c=1024;c<2048;++c)o[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)l[c]=c<<23;l[31]=1199570944,l[32]=2147483648;for(let c=33;c<63;++c)l[c]=2147483648+(c-32<<23);l[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(u[c]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:s,mantissaTable:o,exponentTable:l,offsetTable:u}}function ul(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=Oa(r,-65504,65504),Vu.floatView[0]=r;const e=Vu.uint32View[0],i=e>>23&511;return Vu.baseTable[i]+((e&8388607)>>Vu.shiftTable[i])}function C1(r){const e=r>>10;return Vu.uint32View[0]=Vu.mantissaTable[Vu.offsetTable[e]+(r&1023)]+Vu.exponentTable[e],Vu.floatView[0]}const Ks=new It,S1=new Nn;class Rl{constructor(e,i,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=n,this.usage=m1,this.updateRanges=[],this.gpuType=ll,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,n){e*=this.itemSize,n*=i.itemSize;for(let s=0,o=this.itemSize;s<o;s++)this.array[e+s]=i.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,n=this.count;i<n;i++)S1.fromBufferAttribute(this,i),S1.applyMatrix3(e),this.setXY(i,S1.x,S1.y);else if(this.itemSize===3)for(let i=0,n=this.count;i<n;i++)Ks.fromBufferAttribute(this,i),Ks.applyMatrix3(e),this.setXYZ(i,Ks.x,Ks.y,Ks.z);return this}applyMatrix4(e){for(let i=0,n=this.count;i<n;i++)Ks.fromBufferAttribute(this,i),Ks.applyMatrix4(e),this.setXYZ(i,Ks.x,Ks.y,Ks.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)Ks.fromBufferAttribute(this,i),Ks.applyNormalMatrix(e),this.setXYZ(i,Ks.x,Ks.y,Ks.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)Ks.fromBufferAttribute(this,i),Ks.transformDirection(e),this.setXYZ(i,Ks.x,Ks.y,Ks.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let n=this.array[e*this.itemSize+i];return this.normalized&&(n=yo(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=$r(n,this.array)),this.array[e*this.itemSize+i]=n,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=yo(i,this.array)),i}setX(e,i){return this.normalized&&(i=$r(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=yo(i,this.array)),i}setY(e,i){return this.normalized&&(i=$r(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=yo(i,this.array)),i}setZ(e,i){return this.normalized&&(i=$r(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=yo(i,this.array)),i}setW(e,i){return this.normalized&&(i=$r(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=$r(i,this.array),n=$r(n,this.array)),this.array[e+0]=i,this.array[e+1]=n,this}setXYZ(e,i,n,s){return e*=this.itemSize,this.normalized&&(i=$r(i,this.array),n=$r(n,this.array),s=$r(s,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,i,n,s,o){return e*=this.itemSize,this.normalized&&(i=$r(i,this.array),n=$r(n,this.array),s=$r(s,this.array),o=$r(o,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==m1&&(e.usage=this.usage),e}}class t5 extends Rl{constructor(e,i,n){super(new Uint16Array(e),i,n)}}class i5 extends Rl{constructor(e,i,n){super(new Uint32Array(e),i,n)}}class r5 extends Rl{constructor(e,i,n){super(new Uint16Array(e),i,n),this.isFloat16BufferAttribute=!0}getX(e){let i=C1(this.array[e*this.itemSize]);return this.normalized&&(i=yo(i,this.array)),i}setX(e,i){return this.normalized&&(i=$r(i,this.array)),this.array[e*this.itemSize]=ul(i),this}getY(e){let i=C1(this.array[e*this.itemSize+1]);return this.normalized&&(i=yo(i,this.array)),i}setY(e,i){return this.normalized&&(i=$r(i,this.array)),this.array[e*this.itemSize+1]=ul(i),this}getZ(e){let i=C1(this.array[e*this.itemSize+2]);return this.normalized&&(i=yo(i,this.array)),i}setZ(e,i){return this.normalized&&(i=$r(i,this.array)),this.array[e*this.itemSize+2]=ul(i),this}getW(e){let i=C1(this.array[e*this.itemSize+3]);return this.normalized&&(i=yo(i,this.array)),i}setW(e,i){return this.normalized&&(i=$r(i,this.array)),this.array[e*this.itemSize+3]=ul(i),this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=$r(i,this.array),n=$r(n,this.array)),this.array[e+0]=ul(i),this.array[e+1]=ul(n),this}setXYZ(e,i,n,s){return e*=this.itemSize,this.normalized&&(i=$r(i,this.array),n=$r(n,this.array),s=$r(s,this.array)),this.array[e+0]=ul(i),this.array[e+1]=ul(n),this.array[e+2]=ul(s),this}setXYZW(e,i,n,s,o){return e*=this.itemSize,this.normalized&&(i=$r(i,this.array),n=$r(n,this.array),s=$r(s,this.array),o=$r(o,this.array)),this.array[e+0]=ul(i),this.array[e+1]=ul(n),this.array[e+2]=ul(s),this.array[e+3]=ul(o),this}}class Gu extends Rl{constructor(e,i,n){super(new Float32Array(e),i,n)}}let pce=0;const Il=new bs,KM=new Ea,cg=new It,hl=new XA,ZA=new XA,wa=new It;class Rp extends Jm{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:pce++}),this.uuid=Ou(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Xle(e)?i5:t5)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new jo().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Il.makeRotationFromQuaternion(e),this.applyMatrix4(Il),this}rotateX(e){return Il.makeRotationX(e),this.applyMatrix4(Il),this}rotateY(e){return Il.makeRotationY(e),this.applyMatrix4(Il),this}rotateZ(e){return Il.makeRotationZ(e),this.applyMatrix4(Il),this}translate(e,i,n){return Il.makeTranslation(e,i,n),this.applyMatrix4(Il),this}scale(e,i,n){return Il.makeScale(e,i,n),this.applyMatrix4(Il),this}lookAt(e){return KM.lookAt(e),KM.updateMatrix(),this.applyMatrix4(KM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(cg).negate(),this.translate(cg.x,cg.y,cg.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const n=[];for(let s=0,o=e.length;s<o;s++){const l=e[s];n.push(l.x,l.y,l.z||0)}this.setAttribute("position",new Gu(n,3))}else{for(let n=0,s=i.count;n<s;n++){const o=e[n];i.setXYZ(n,o.x,o.y,o.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new XA);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new It(-1/0,-1/0,-1/0),new It(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,s=i.length;n<s;n++){const o=i[n];hl.setFromBufferAttribute(o),this.morphTargetsRelative?(wa.addVectors(this.boundingBox.min,hl.min),this.boundingBox.expandByPoint(wa),wa.addVectors(this.boundingBox.max,hl.max),this.boundingBox.expandByPoint(wa)):(this.boundingBox.expandByPoint(hl.min),this.boundingBox.expandByPoint(hl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new FM);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new It,1/0);return}if(e){const n=this.boundingSphere.center;if(hl.setFromBufferAttribute(e),i)for(let o=0,l=i.length;o<l;o++){const u=i[o];ZA.setFromBufferAttribute(u),this.morphTargetsRelative?(wa.addVectors(hl.min,ZA.min),hl.expandByPoint(wa),wa.addVectors(hl.max,ZA.max),hl.expandByPoint(wa)):(hl.expandByPoint(ZA.min),hl.expandByPoint(ZA.max))}hl.getCenter(n);let s=0;for(let o=0,l=e.count;o<l;o++)wa.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(wa));if(i)for(let o=0,l=i.length;o<l;o++){const u=i[o],c=this.morphTargetsRelative;for(let d=0,p=u.count;d<p;d++)wa.fromBufferAttribute(u,d),c&&(cg.fromBufferAttribute(e,d),wa.add(cg)),s=Math.max(s,n.distanceToSquared(wa))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Rl(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],c=[];for(let D=0;D<n.count;D++)u[D]=new It,c[D]=new It;const d=new It,p=new It,f=new It,m=new Nn,g=new Nn,y=new Nn,x=new It,v=new It;function _(D,L,O){d.fromBufferAttribute(n,D),p.fromBufferAttribute(n,L),f.fromBufferAttribute(n,O),m.fromBufferAttribute(o,D),g.fromBufferAttribute(o,L),y.fromBufferAttribute(o,O),p.sub(d),f.sub(d),g.sub(m),y.sub(m);const U=1/(g.x*y.y-y.x*g.y);isFinite(U)&&(x.copy(p).multiplyScalar(y.y).addScaledVector(f,-g.y).multiplyScalar(U),v.copy(f).multiplyScalar(g.x).addScaledVector(p,-y.x).multiplyScalar(U),u[D].add(x),u[L].add(x),u[O].add(x),c[D].add(v),c[L].add(v),c[O].add(v))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let D=0,L=T.length;D<L;++D){const O=T[D],U=O.start,J=O.count;for(let H=U,V=U+J;H<V;H+=3)_(e.getX(H+0),e.getX(H+1),e.getX(H+2))}const w=new It,S=new It,R=new It,B=new It;function I(D){R.fromBufferAttribute(s,D),B.copy(R);const L=u[D];w.copy(L),w.sub(R.multiplyScalar(R.dot(L))).normalize(),S.crossVectors(B,L);const O=S.dot(c[D])<0?-1:1;l.setXYZW(D,w.x,w.y,w.z,O)}for(let D=0,L=T.length;D<L;++D){const O=T[D],U=O.start,J=O.count;for(let H=U,V=U+J;H<V;H+=3)I(e.getX(H+0)),I(e.getX(H+1)),I(e.getX(H+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Rl(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let m=0,g=n.count;m<g;m++)n.setXYZ(m,0,0,0);const s=new It,o=new It,l=new It,u=new It,c=new It,d=new It,p=new It,f=new It;if(e)for(let m=0,g=e.count;m<g;m+=3){const y=e.getX(m+0),x=e.getX(m+1),v=e.getX(m+2);s.fromBufferAttribute(i,y),o.fromBufferAttribute(i,x),l.fromBufferAttribute(i,v),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),u.fromBufferAttribute(n,y),c.fromBufferAttribute(n,x),d.fromBufferAttribute(n,v),u.add(p),c.add(p),d.add(p),n.setXYZ(y,u.x,u.y,u.z),n.setXYZ(x,c.x,c.y,c.z),n.setXYZ(v,d.x,d.y,d.z)}else for(let m=0,g=i.count;m<g;m+=3)s.fromBufferAttribute(i,m+0),o.fromBufferAttribute(i,m+1),l.fromBufferAttribute(i,m+2),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),n.setXYZ(m+0,p.x,p.y,p.z),n.setXYZ(m+1,p.x,p.y,p.z),n.setXYZ(m+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)wa.fromBufferAttribute(e,i),wa.normalize(),e.setXYZ(i,wa.x,wa.y,wa.z)}toNonIndexed(){function e(u,c){const d=u.array,p=u.itemSize,f=u.normalized,m=new d.constructor(c.length*p);let g=0,y=0;for(let x=0,v=c.length;x<v;x++){u.isInterleavedBufferAttribute?g=c[x]*u.data.stride+u.offset:g=c[x]*p;for(let _=0;_<p;_++)m[y++]=d[g++]}return new Rl(m,p,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Rp,n=this.index.array,s=this.attributes;for(const u in s){const c=s[u],d=e(c,n);i.setAttribute(u,d)}const o=this.morphAttributes;for(const u in o){const c=[],d=o[u];for(let p=0,f=d.length;p<f;p++){const m=d[p],g=e(m,n);c.push(g)}i.morphAttributes[u]=c}i.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,c=l.length;u<c;u++){const d=l[u];i.addGroup(d.start,d.count,d.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const d in c)c[d]!==void 0&&(e[d]=c[d]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const c in n){const d=n[c];e.data.attributes[c]=d.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const d=this.morphAttributes[c],p=[];for(let f=0,m=d.length;f<m;f++){const g=d[f];p.push(g.toJSON(e.data))}p.length>0&&(s[c]=p,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const s=e.attributes;for(const d in s){const p=s[d];this.setAttribute(d,p.clone(i))}const o=e.morphAttributes;for(const d in o){const p=[],f=o[d];for(let m=0,g=f.length;m<g;m++)p.push(f[m].clone(i));this.morphAttributes[d]=p}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let d=0,p=l.length;d<p;d++){const f=l[d];this.addGroup(f.start,f.count,f.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const n5=new bs,Ip=new rce,T1=new FM,s5=new It,M1=new It,R1=new It,I1=new It,JM=new It,B1=new It,a5=new It,N1=new It;class Bp extends Ea{constructor(e=new Rp,i=new w1){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const l=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}getVertexPosition(e,i){const n=this.geometry,s=n.attributes.position,o=n.morphAttributes.position,l=n.morphTargetsRelative;i.fromBufferAttribute(s,e);const u=this.morphTargetInfluences;if(o&&u){B1.set(0,0,0);for(let c=0,d=o.length;c<d;c++){const p=u[c],f=o[c];p!==0&&(JM.fromBufferAttribute(f,e),l?B1.addScaledVector(JM,p):B1.addScaledVector(JM.sub(i),p))}i.add(B1)}return i}raycast(e,i){const n=this.geometry,s=this.material,o=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),T1.copy(n.boundingSphere),T1.applyMatrix4(o),Ip.copy(e.ray).recast(e.near),!(T1.containsPoint(Ip.origin)===!1&&(Ip.intersectSphere(T1,s5)===null||Ip.origin.distanceToSquared(s5)>(e.far-e.near)**2))&&(n5.copy(o).invert(),Ip.copy(e.ray).applyMatrix4(n5),!(n.boundingBox!==null&&Ip.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,i,Ip)))}_computeIntersections(e,i,n){let s;const o=this.geometry,l=this.material,u=o.index,c=o.attributes.position,d=o.attributes.uv,p=o.attributes.uv1,f=o.attributes.normal,m=o.groups,g=o.drawRange;if(u!==null)if(Array.isArray(l))for(let y=0,x=m.length;y<x;y++){const v=m[y],_=l[v.materialIndex],T=Math.max(v.start,g.start),w=Math.min(u.count,Math.min(v.start+v.count,g.start+g.count));for(let S=T,R=w;S<R;S+=3){const B=u.getX(S),I=u.getX(S+1),D=u.getX(S+2);s=L1(this,_,e,n,d,p,f,B,I,D),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const y=Math.max(0,g.start),x=Math.min(u.count,g.start+g.count);for(let v=y,_=x;v<_;v+=3){const T=u.getX(v),w=u.getX(v+1),S=u.getX(v+2);s=L1(this,l,e,n,d,p,f,T,w,S),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}else if(c!==void 0)if(Array.isArray(l))for(let y=0,x=m.length;y<x;y++){const v=m[y],_=l[v.materialIndex],T=Math.max(v.start,g.start),w=Math.min(c.count,Math.min(v.start+v.count,g.start+g.count));for(let S=T,R=w;S<R;S+=3){const B=S,I=S+1,D=S+2;s=L1(this,_,e,n,d,p,f,B,I,D),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const y=Math.max(0,g.start),x=Math.min(c.count,g.start+g.count);for(let v=y,_=x;v<_;v+=3){const T=v,w=v+1,S=v+2;s=L1(this,l,e,n,d,p,f,T,w,S),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}}}function fce(r,e,i,n,s,o,l,u){let c;if(e.side===lc?c=n.intersectTriangle(l,o,s,!0,u):c=n.intersectTriangle(s,o,l,e.side===zm,u),c===null)return null;N1.copy(u),N1.applyMatrix4(r.matrixWorld);const d=i.ray.origin.distanceTo(N1);return d<i.near||d>i.far?null:{distance:d,point:N1.clone(),object:r}}function L1(r,e,i,n,s,o,l,u,c,d){r.getVertexPosition(u,M1),r.getVertexPosition(c,R1),r.getVertexPosition(d,I1);const p=fce(r,e,i,n,M1,R1,I1,a5);if(p){const f=new It;fc.getBarycoord(a5,M1,R1,I1,f),s&&(p.uv=fc.getInterpolatedAttribute(s,u,c,d,f,new Nn)),o&&(p.uv1=fc.getInterpolatedAttribute(o,u,c,d,f,new Nn)),l&&(p.normal=fc.getInterpolatedAttribute(l,u,c,d,f,new It),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const m={a:u,b:c,c:d,normal:new It,materialIndex:0};fc.getNormal(M1,R1,I1,m.normal),p.face=m,p.barycoord=f}return p}class $A extends Rp{constructor(e=1,i=1,n=1,s=1,o=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:s,heightSegments:o,depthSegments:l};const u=this;s=Math.floor(s),o=Math.floor(o),l=Math.floor(l);const c=[],d=[],p=[],f=[];let m=0,g=0;y("z","y","x",-1,-1,n,i,e,l,o,0),y("z","y","x",1,-1,n,i,-e,l,o,1),y("x","z","y",1,1,e,n,i,s,l,2),y("x","z","y",1,-1,e,n,-i,s,l,3),y("x","y","z",1,-1,e,i,n,s,o,4),y("x","y","z",-1,-1,e,i,-n,s,o,5),this.setIndex(c),this.setAttribute("position",new Gu(d,3)),this.setAttribute("normal",new Gu(p,3)),this.setAttribute("uv",new Gu(f,2));function y(x,v,_,T,w,S,R,B,I,D,L){const O=S/I,U=R/D,J=S/2,H=R/2,V=B/2,$=I+1,Q=D+1;let G=0,j=0;const ie=new It;for(let Y=0;Y<Q;Y++){const ae=Y*U-H;for(let xe=0;xe<$;xe++){const fe=xe*O-J;ie[x]=fe*T,ie[v]=ae*w,ie[_]=V,d.push(ie.x,ie.y,ie.z),ie[x]=0,ie[v]=0,ie[_]=B>0?1:-1,p.push(ie.x,ie.y,ie.z),f.push(xe/I),f.push(1-Y/D),G+=1}}for(let Y=0;Y<D;Y++)for(let ae=0;ae<I;ae++){const xe=m+ae+$*Y,fe=m+ae+$*(Y+1),de=m+(ae+1)+$*(Y+1),Ie=m+(ae+1)+$*Y;c.push(xe,fe,Ie),c.push(fe,de,Ie),j+=6}u.addGroup(g,j,L),g+=j,m+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $A(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function o5(r){const e={};for(const i in r){e[i]={};for(const n in r[i]){const s=r[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function mce(r){const e=[];for(let i=0;i<r.length;i++)e.push(r[i].clone());return e}var gce=`
void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`,Ace=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`;class yce extends Vo{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=gce,this.fragmentShader=Ace,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=o5(e.uniforms),this.uniformsGroups=mce(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?i.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?i.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?i.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?i.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?i.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?i.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?i.uniforms[s]={type:"m4",value:o.toArray()}:i.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(i.extensions=n),i}}class l5 extends Ea{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new bs,this.projectionMatrix=new bs,this.projectionMatrixInverse=new bs,this.coordinateSystem=cc}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const ld=new It,c5=new Nn,u5=new Nn;class Hu extends l5{constructor(e=50,i=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=WA*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(HA*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return WA*2*Math.atan(Math.tan(HA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,n){ld.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ld.x,ld.y).multiplyScalar(-e/ld.z),ld.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(ld.x,ld.y).multiplyScalar(-e/ld.z)}getViewSize(e,i){return this.getViewBounds(e,c5,u5),i.subVectors(u5,c5)}setViewOffset(e,i,n,s,o,l){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(HA*.5*this.fov)/this.zoom,n=2*i,s=this.aspect*n,o=-.5*s;const l=this.view;if(this.view!==null&&this.view.enabled){const c=l.fullWidth,d=l.fullHeight;o+=l.offsetX*s/c,i-=l.offsetY*n/d,s*=l.width/c,n*=l.height/d}const u=this.filmOffset;u!==0&&(o+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+s,i,i-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const ug=-90,hg=1;class h5 extends Ea{constructor(e,i,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Hu(ug,hg,e,i);s.layers=this.layers,this.add(s);const o=new Hu(ug,hg,e,i);o.layers=this.layers,this.add(o);const l=new Hu(ug,hg,e,i);l.layers=this.layers,this.add(l);const u=new Hu(ug,hg,e,i);u.layers=this.layers,this.add(u);const c=new Hu(ug,hg,e,i);c.layers=this.layers,this.add(c);const d=new Hu(ug,hg,e,i);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[n,s,o,l,u,c]=i;for(const d of i)this.remove(d);if(e===cc)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),l.up.set(0,0,1),l.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===Sp)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),l.up.set(0,0,-1),l.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of i)this.add(d),d.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,l,u,c,d,p]=this.children,f=e.getRenderTarget(),m=e.getActiveCubeFace(),g=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const x=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,s),e.render(i,o),e.setRenderTarget(n,1,s),e.render(i,l),e.setRenderTarget(n,2,s),e.render(i,u),e.setRenderTarget(n,3,s),e.render(i,c),e.setRenderTarget(n,4,s),e.render(i,d),n.texture.generateMipmaps=x,e.setRenderTarget(n,5,s),e.render(i,p),e.setRenderTarget(f,m,g),e.xr.enabled=y,n.texture.needsPMREMUpdate=!0}}class ZM extends vo{constructor(e,i,n,s,o,l,u,c,d,p){e=e!==void 0?e:[],i=i!==void 0?i:_p,super(e,i,n,s,o,l,u,c,d,p),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class vce extends ece{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new ZM(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:ol}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new $A(5,5,5),o=new yce({name:"CubemapFromEquirect",uniforms:o5(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:lc,blending:Vm});o.uniforms.tEquirect.value=i;const l=new Bp(s,o),u=i.minFilter;return i.minFilter===Lu&&(i.minFilter=ol),new h5(1,10,this).update(e,l),i.minFilter=u,l.geometry.dispose(),l.material.dispose(),this}clear(e,i,n,s){const o=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(i,n,s);e.setRenderTarget(o)}}class d5 extends Ea{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new dc,this.environmentIntensity=1,this.environmentRotation=new dc,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class p5{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=m1,this.updateRanges=[],this.version=0,this.uuid=Ou()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,n){e*=this.stride,n*=i.stride;for(let s=0,o=this.stride;s<o;s++)this.array[e+s]=i.array[n+s];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ou()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(i,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ou()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const xo=new It;class $M{constructor(e,i,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,n=this.data.count;i<n;i++)xo.fromBufferAttribute(this,i),xo.applyMatrix4(e),this.setXYZ(i,xo.x,xo.y,xo.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)xo.fromBufferAttribute(this,i),xo.applyNormalMatrix(e),this.setXYZ(i,xo.x,xo.y,xo.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)xo.fromBufferAttribute(this,i),xo.transformDirection(e),this.setXYZ(i,xo.x,xo.y,xo.z);return this}getComponent(e,i){let n=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(n=yo(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=$r(n,this.array)),this.data.array[e*this.data.stride+this.offset+i]=n,this}setX(e,i){return this.normalized&&(i=$r(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=$r(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=$r(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=$r(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=yo(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=yo(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=yo(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=yo(i,this.array)),i}setXY(e,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=$r(i,this.array),n=$r(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this}setXYZ(e,i,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=$r(i,this.array),n=$r(n,this.array),s=$r(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,i,n,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=$r(i,this.array),n=$r(n,this.array),s=$r(s,this.array),o=$r(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return new Rl(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new $M(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class f5 extends Vo{static get type(){return"SpriteMaterial"}constructor(e){super(),this.isSpriteMaterial=!0,this.color=new Jn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class xce extends vo{constructor(e=null,i=1,n=1,s,o,l,u,c,d=Ja,p=Ja,f,m){super(null,l,u,c,d,p,s,o,f,m),this.isDataTexture=!0,this.image={data:e,width:i,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bce extends Rl{constructor(e,i,n,s=1){super(e,i,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const e3=new It,_ce=new It,Ece=new jo;class cd{constructor(e=new It(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,n,s){return this.normal.set(e,i,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,n){const s=e3.subVectors(n,i).cross(_ce.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const n=e.delta(e3),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/s;return o<0||o>1?null:i.copy(e.start).addScaledVector(n,o)}intersectsLine(e){const i=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return i<0&&n>0||n<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const n=i||Ece.getNormalMatrix(e),s=this.coplanarPoint(e3).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Np=new FM,D1=new It;class m5{constructor(e=new cd,i=new cd,n=new cd,s=new cd,o=new cd,l=new cd){this.planes=[e,i,n,s,o,l]}set(e,i,n,s,o,l){const u=this.planes;return u[0].copy(e),u[1].copy(i),u[2].copy(n),u[3].copy(s),u[4].copy(o),u[5].copy(l),this}copy(e){const i=this.planes;for(let n=0;n<6;n++)i[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,i=cc){const n=this.planes,s=e.elements,o=s[0],l=s[1],u=s[2],c=s[3],d=s[4],p=s[5],f=s[6],m=s[7],g=s[8],y=s[9],x=s[10],v=s[11],_=s[12],T=s[13],w=s[14],S=s[15];if(n[0].setComponents(c-o,m-d,v-g,S-_).normalize(),n[1].setComponents(c+o,m+d,v+g,S+_).normalize(),n[2].setComponents(c+l,m+p,v+y,S+T).normalize(),n[3].setComponents(c-l,m-p,v-y,S-T).normalize(),n[4].setComponents(c-u,m-f,v-x,S-w).normalize(),i===cc)n[5].setComponents(c+u,m+f,v+x,S+w).normalize();else if(i===Sp)n[5].setComponents(u,f,x,w).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Np.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Np.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Np)}intersectsSprite(e){return Np.center.set(0,0,0),Np.radius=.7071067811865476,Np.applyMatrix4(e.matrixWorld),this.intersectsSphere(Np)}intersectsSphere(e){const i=this.planes,n=e.center,s=-e.radius;for(let o=0;o<6;o++)if(i[o].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const i=this.planes;for(let n=0;n<6;n++){const s=i[n];if(D1.x=s.normal.x>0?e.max.x:e.min.x,D1.y=s.normal.y>0?e.max.y:e.min.y,D1.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(D1)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let n=0;n<6;n++)if(i[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class t3 extends Vo{static get type(){return"LineBasicMaterial"}constructor(e){super(),this.isLineBasicMaterial=!0,this.color=new Jn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}class g5 extends Vo{static get type(){return"PointsMaterial"}constructor(e){super(),this.isPointsMaterial=!0,this.color=new Jn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class wce extends vo{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=Ja,this.minFilter=Ja,this.generateMipmaps=!1,this.needsUpdate=!0}}class dg extends vo{constructor(e,i,n,s,o,l,u,c,d,p=Ep){if(p!==Ep&&p!==Ym)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&p===Ep&&(n=Da),n===void 0&&p===Ym&&(n=jA),super(null,s,o,l,u,c,p,n,d),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=u!==void 0?u:Ja,this.minFilter=c!==void 0?c:Ja,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class i3 extends Rp{constructor(e=1,i=32,n=16,s=0,o=Math.PI*2,l=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:s,phiLength:o,thetaStart:l,thetaLength:u},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const c=Math.min(l+u,Math.PI);let d=0;const p=[],f=new It,m=new It,g=[],y=[],x=[],v=[];for(let _=0;_<=n;_++){const T=[],w=_/n;let S=0;_===0&&l===0?S=.5/i:_===n&&c===Math.PI&&(S=-.5/i);for(let R=0;R<=i;R++){const B=R/i;f.x=-e*Math.cos(s+B*o)*Math.sin(l+w*u),f.y=e*Math.cos(l+w*u),f.z=e*Math.sin(s+B*o)*Math.sin(l+w*u),y.push(f.x,f.y,f.z),m.copy(f).normalize(),x.push(m.x,m.y,m.z),v.push(B+S,1-w),T.push(d++)}p.push(T)}for(let _=0;_<n;_++)for(let T=0;T<i;T++){const w=p[_][T+1],S=p[_][T],R=p[_+1][T],B=p[_+1][T+1];(_!==0||l>0)&&g.push(w,S,B),(_!==n-1||c<Math.PI)&&g.push(S,R,B)}this.setIndex(g),this.setAttribute("position",new Gu(y,3)),this.setAttribute("normal",new Gu(x,3)),this.setAttribute("uv",new Gu(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new i3(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class A5 extends Vo{static get type(){return"ShadowMaterial"}constructor(e){super(),this.isShadowMaterial=!0,this.color=new Jn(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class r3 extends Vo{static get type(){return"MeshStandardMaterial"}constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new Jn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=td,this.normalScale=new Nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new dc,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class y5 extends r3{static get type(){return"MeshPhysicalMaterial"}constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Nn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Oa(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Jn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Jn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Jn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class v5 extends Vo{static get type(){return"MeshPhongMaterial"}constructor(e){super(),this.isMeshPhongMaterial=!0,this.color=new Jn(16777215),this.specular=new Jn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=td,this.normalScale=new Nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new dc,this.combine=c1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class x5 extends Vo{static get type(){return"MeshToonMaterial"}constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.color=new Jn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=td,this.normalScale=new Nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class b5 extends Vo{static get type(){return"MeshNormalMaterial"}constructor(e){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=td,this.normalScale=new Nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class _5 extends Vo{static get type(){return"MeshLambertMaterial"}constructor(e){super(),this.isMeshLambertMaterial=!0,this.color=new Jn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=td,this.normalScale=new Nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new dc,this.combine=c1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class E5 extends Vo{static get type(){return"MeshMatcapMaterial"}constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.color=new Jn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=td,this.normalScale=new Nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class w5 extends t3{static get type(){return"LineDashedMaterial"}constructor(e){super(),this.isLineDashedMaterial=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class Lp extends Ea{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Jn(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class Cce extends Lp{constructor(e,i,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ea.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Jn(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const n3=new bs,C5=new It,S5=new It;class s3{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Nn(512,512),this.map=null,this.mapPass=null,this.matrix=new bs,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new m5,this._frameExtents=new Nn(1,1),this._viewportCount=1,this._viewports=[new Kn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,n=this.matrix;C5.setFromMatrixPosition(e.matrixWorld),i.position.copy(C5),S5.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(S5),i.updateMatrixWorld(),n3.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n3),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(n3)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Sce extends s3{constructor(){super(new Hu(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,n=WA*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,o=e.distance||i.far;(n!==i.fov||s!==i.aspect||o!==i.far)&&(i.fov=n,i.aspect=s,i.far=o,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class T5 extends Lp{constructor(e,i,n=0,s=Math.PI/3,o=0,l=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ea.DEFAULT_UP),this.updateMatrix(),this.target=new Ea,this.distance=n,this.angle=s,this.penumbra=o,this.decay=l,this.map=null,this.shadow=new Sce}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const M5=new bs,ey=new It,a3=new It;class Tce extends s3{constructor(){super(new Hu(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Nn(4,2),this._viewportCount=6,this._viewports=[new Kn(2,1,1,1),new Kn(0,1,1,1),new Kn(3,1,1,1),new Kn(1,1,1,1),new Kn(3,0,1,1),new Kn(1,0,1,1)],this._cubeDirections=[new It(1,0,0),new It(-1,0,0),new It(0,0,1),new It(0,0,-1),new It(0,1,0),new It(0,-1,0)],this._cubeUps=[new It(0,1,0),new It(0,1,0),new It(0,1,0),new It(0,1,0),new It(0,0,1),new It(0,0,-1)]}updateMatrices(e,i=0){const n=this.camera,s=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),ey.setFromMatrixPosition(e.matrixWorld),n.position.copy(ey),a3.copy(n.position),a3.add(this._cubeDirections[i]),n.up.copy(this._cubeUps[i]),n.lookAt(a3),n.updateMatrixWorld(),s.makeTranslation(-ey.x,-ey.y,-ey.z),M5.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(M5)}}class Mce extends Lp{constructor(e,i,n=0,s=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new Tce}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class o3 extends l5{constructor(e=-1,i=1,n=1,s=-1,o=.1,l=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=n,this.bottom=s,this.near=o,this.far=l,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,n,s,o,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let o=n-e,l=n+e,u=s+i,c=s-i;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,p=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=d*this.view.offsetX,l=o+d*this.view.width,u-=p*this.view.offsetY,c=u-p*this.view.height}this.projectionMatrix.makeOrthographic(o,l,u,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class Rce extends s3{constructor(){super(new o3(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Ice extends Lp{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ea.DEFAULT_UP),this.updateMatrix(),this.target=new Ea,this.shadow=new Rce}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Bce extends Lp{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class Nce extends Lp{constructor(e,i,n=10,s=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class Lce{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new It)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const n=e.x,s=e.y,o=e.z,l=this.coefficients;return i.copy(l[0]).multiplyScalar(.282095),i.addScaledVector(l[1],.488603*s),i.addScaledVector(l[2],.488603*o),i.addScaledVector(l[3],.488603*n),i.addScaledVector(l[4],1.092548*(n*s)),i.addScaledVector(l[5],1.092548*(s*o)),i.addScaledVector(l[6],.315392*(3*o*o-1)),i.addScaledVector(l[7],1.092548*(n*o)),i.addScaledVector(l[8],.546274*(n*n-s*s)),i}getIrradianceAt(e,i){const n=e.x,s=e.y,o=e.z,l=this.coefficients;return i.copy(l[0]).multiplyScalar(.886227),i.addScaledVector(l[1],2*.511664*s),i.addScaledVector(l[2],2*.511664*o),i.addScaledVector(l[3],2*.511664*n),i.addScaledVector(l[4],2*.429043*n*s),i.addScaledVector(l[5],2*.429043*s*o),i.addScaledVector(l[6],.743125*o*o-.247708),i.addScaledVector(l[7],2*.429043*n*o),i.addScaledVector(l[8],.429043*(n*n-s*s)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,i+s*3);return this}toArray(e=[],i=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,i+s*3);return e}static getBasisAt(e,i){const n=e.x,s=e.y,o=e.z;i[0]=.282095,i[1]=.488603*s,i[2]=.488603*o,i[3]=.488603*n,i[4]=1.092548*n*s,i[5]=1.092548*s*o,i[6]=.315392*(3*o*o-1),i[7]=1.092548*n*o,i[8]=.546274*(n*n-s*s)}}class Dce extends Lp{constructor(e=new Lce,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class Oce extends p5{constructor(e,i,n=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}const Pce=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class Fce{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=Pce,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let i=this.renderObjects.get(e);if(i===void 0){const{geometry:n,material:s}=e;if(i={material:this.getMaterialData(s),geometry:{attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:e.object.matrixWorld.clone()},e.object.center&&(i.center=e.object.center.clone()),e.object.morphTargetInfluences&&(i.morphTargetInfluences=e.object.morphTargetInfluences.slice()),e.bundle!==null&&(i.version=e.bundle.version),i.material.transmission>0){const{width:o,height:l}=e.context;i.bufferWidth=o,i.bufferHeight=l}this.renderObjects.set(e,i)}return i}getAttributesData(e){const i={};for(const n in e){const s=e[n];i[n]={version:s.version}}return i}containsNode(e){const i=e.material;for(const n in i)if(i[n]&&i[n].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const i={};for(const n of this.refreshUniforms){const s=e[n];s!=null&&(typeof s=="object"&&s.clone!==void 0?s.isTexture===!0?i[n]={id:s.id,version:s.version}:i[n]=s.clone():i[n]=s)}return i}equals(e){const{object:i,material:n,geometry:s}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(i.matrixWorld)!==!0)return o.worldMatrix.copy(i.matrixWorld),!1;const l=o.material;for(const x in l){const v=l[x],_=n[x];if(v.equals!==void 0){if(v.equals(_)===!1)return v.copy(_),!1}else if(_.isTexture===!0){if(v.id!==_.id||v.version!==_.version)return v.id=_.id,v.version=_.version,!1}else if(v!==_)return l[x]=_,!1}if(l.transmission>0){const{width:x,height:v}=e.context;if(o.bufferWidth!==x||o.bufferHeight!==v)return o.bufferWidth=x,o.bufferHeight=v,!1}const u=o.geometry,c=s.attributes,d=u.attributes,p=Object.keys(d),f=Object.keys(c);if(p.length!==f.length)return o.geometry.attributes=this.getAttributesData(c),!1;for(const x of p){const v=d[x],_=c[x];if(_===void 0)return delete d[x],!1;if(v.version!==_.version)return v.version=_.version,!1}const m=s.index,g=u.indexVersion,y=m?m.version:null;if(g!==y)return u.indexVersion=y,!1;if(u.drawRange.start!==s.drawRange.start||u.drawRange.count!==s.drawRange.count)return u.drawRange.start=s.drawRange.start,u.drawRange.count=s.drawRange.count,!1;if(o.morphTargetInfluences){let x=!1;for(let v=0;v<o.morphTargetInfluences.length;v++)o.morphTargetInfluences[v]!==i.morphTargetInfluences[v]&&(x=!0);if(x)return!0}return o.center&&o.center.equals(i.center)===!1?(o.center.copy(i.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}needsRefresh(e,i){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:n}=i;if(this.renderId!==n)return this.renderId=n,!0;const s=e.object.static===!0,o=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return s||o?!1:this.equals(e)!==!0}}function ty(r,e=0){let i=3735928559^e,n=1103547991^e;if(r instanceof Array)for(let s=0,o;s<r.length;s++)o=r[s],i=Math.imul(i^o,2654435761),n=Math.imul(n^o,1597334677);else for(let s=0,o;s<r.length;s++)o=r.charCodeAt(s),i=Math.imul(i^o,2654435761),n=Math.imul(n^o,1597334677);return i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(i^i>>>13,3266489909),4294967296*(2097151&n)+(i>>>0)}const kce=r=>ty(r),R5=r=>ty(r),O1=(...r)=>ty(r);function I5(r,e=!1){const i=[];r.isNode===!0&&(i.push(r.id),r=r.getSelf());for(const{property:n,childNode:s}of P1(r))i.push(i,ty(n.slice(0,-4)),s.getCacheKey(e));return ty(i)}function*P1(r,e=!1){for(const i in r){if(i.startsWith("_")===!0)continue;const n=r[i];if(Array.isArray(n)===!0)for(let s=0;s<n.length;s++){const o=n[s];o&&(o.isNode===!0||e&&typeof o.toJSON=="function")&&(yield{property:i,index:s,childNode:o})}else if(n&&n.isNode===!0)yield{property:i,childNode:n};else if(typeof n=="object")for(const s in n){const o=n[s];o&&(o.isNode===!0||e&&typeof o.toJSON=="function")&&(yield{property:i,index:s,childNode:o})}}}function F1(r){if(r==null)return null;const e=typeof r;return r.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function B5(r,...e){const i=r?r.slice(-4):void 0;return e.length===1&&(i==="vec2"?e=[e[0],e[0]]:i==="vec3"?e=[e[0],e[0],e[0]]:i==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),r==="color"?new Jn(...e):i==="vec2"?new Nn(...e):i==="vec3"?new It(...e):i==="vec4"?new Kn(...e):i==="mat3"?new jo(...e):i==="mat4"?new bs(...e):r==="bool"?e[0]||!1:r==="float"||r==="int"||r==="uint"?e[0]||0:r==="string"?e[0]||"":r==="ArrayBuffer"?zce(e[0]):null}function Uce(r){let e="";const i=new Uint8Array(r);for(let n=0;n<i.length;n++)e+=String.fromCharCode(i[n]);return btoa(e)}function zce(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0)).buffer}const N5={VERTEX:"vertex"},cn={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},jce=["fragment","vertex"],L5=["setup","analyze","generate"],D5=[...jce,"compute"],pg=["x","y","z","w"];let Vce=0,en=class extends Jm{static get type(){return"Node"}constructor(r=null){super(),this.nodeType=r,this.updateType=cn.NONE,this.updateBeforeType=cn.NONE,this.updateAfterType=cn.NONE,this.uuid=qle.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:Vce++})}set needsUpdate(r){r===!0&&this.version++}get type(){return this.constructor.type}onUpdate(r,e){return this.updateType=e,this.update=r.bind(this.getSelf()),this}onFrameUpdate(r){return this.onUpdate(r,cn.FRAME)}onRenderUpdate(r){return this.onUpdate(r,cn.RENDER)}onObjectUpdate(r){return this.onUpdate(r,cn.OBJECT)}onReference(r){return this.updateReference=r.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:r}of P1(this))yield r}dispose(){this.dispatchEvent({type:"dispose"})}traverse(r){r(this);for(const e of this.getChildren())e.traverse(r)}getCacheKey(r=!1){return r=r||this.version!==this._cacheKeyVersion,(r===!0||this._cacheKey===null)&&(this._cacheKey=I5(this,r),this._cacheKeyVersion=this.version),this._cacheKey}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(r){const e=this.getNodeType(r);return r.getElementType(e)}getNodeType(r){const e=r.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(r):this.nodeType}getShared(r){const e=this.getHash(r);return r.getNodeFromHash(e)||this}setup(r){const e=r.getNodeProperties(this);let i=0;for(const n of this.getChildren())e["node"+i++]=n;return null}analyze(r){if(r.increaseUsage(this)===1){const e=r.getNodeProperties(this);for(const i of Object.values(e))i&&i.isNode===!0&&i.build(r)}}generate(r,e){const{outputNode:i}=r.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(r,e)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(r,e=null){const i=this.getShared(r);if(this!==i)return i.build(r,e);r.addNode(this),r.addChain(this);let n=null;const s=r.getBuildStage();if(s==="setup"){this.updateReference(r);const o=r.getNodeProperties(this);if(o.initialized!==!0){r.stack.nodes.length,o.initialized=!0,o.outputNode=this.setup(r),o.outputNode!==null&&r.stack.nodes.length;for(const l of Object.values(o))l&&l.isNode===!0&&l.build(r)}}else if(s==="analyze")this.analyze(r);else if(s==="generate")if(this.generate.length===1){const o=this.getNodeType(r),l=r.getDataFromNode(this);n=l.snippet,n===void 0?(n=this.generate(r)||"",l.snippet=n):l.flowCodes!==void 0&&r.context.nodeBlock!==void 0&&r.addFlowCodeHierarchy(this,r.context.nodeBlock),n=r.format(n,o,e)}else n=this.generate(r,e)||"";return r.removeChain(this),r.addSequentialNode(this),n}getSerializeChildren(){return P1(this)}serialize(r){const e=this.getSerializeChildren(),i={};for(const{property:n,index:s,childNode:o}of e)s!==void 0?(i[n]===void 0&&(i[n]=Number.isInteger(s)?[]:{}),i[n][s]=o.toJSON(r.meta).uuid):i[n]=o.toJSON(r.meta).uuid;Object.keys(i).length>0&&(r.inputNodes=i)}deserialize(r){if(r.inputNodes!==void 0){const e=r.meta.nodes;for(const i in r.inputNodes)if(Array.isArray(r.inputNodes[i])){const n=[];for(const s of r.inputNodes[i])n.push(e[s]);this[i]=n}else if(typeof r.inputNodes[i]=="object"){const n={};for(const s in r.inputNodes[i]){const o=r.inputNodes[i][s];n[s]=e[o]}this[i]=n}else{const n=r.inputNodes[i];this[i]=e[n]}}}toJSON(r){const{uuid:e,type:i}=this,n=r===void 0||typeof r=="string";n&&(r={textures:{},images:{},nodes:{}});let s=r.nodes[e];s===void 0&&(s={uuid:e,type:i,meta:r,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},n!==!0&&(r.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(l){const u=[];for(const c in l){const d=l[c];delete d.metadata,u.push(d)}return u}if(n){const l=o(r.textures),u=o(r.images),c=o(r.nodes);l.length>0&&(s.textures=l),u.length>0&&(s.images=u),c.length>0&&(s.nodes=c)}return s}};class iy extends en{static get type(){return"ArrayElementNode"}constructor(e,i){super(),this.node=e,this.indexNode=i,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const i=this.node.build(e),n=this.indexNode.build(e,"uint");return`${i}[ ${n} ]`}}class O5 extends en{static get type(){return"ConvertNode"}constructor(e,i){super(),this.node=e,this.convertTo=i}getNodeType(e){const i=this.node.getNodeType(e);let n=null;for(const s of this.convertTo.split("|"))(n===null||e.getTypeLength(i)===e.getTypeLength(s))&&(n=s);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,i){const n=this.node,s=this.getNodeType(e),o=n.build(e,s);return e.format(o,s,i)}}class Js extends en{static get type(){return"TempNode"}constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,i){if(e.getBuildStage()==="generate"){const n=e.getVectorType(this.getNodeType(e,i)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,n,i);if(n!=="void"&&i!=="void"&&this.hasDependencies(e)){const o=super.build(e,n),l=e.getVarFromNode(this,null,n),u=e.getPropertyName(l);return e.addLineFlowCode(`${u} = ${o}`,this),s.snippet=o,s.propertyName=u,e.format(s.propertyName,n,i)}}return super.build(e,i)}}class Gce extends Js{static get type(){return"JoinNode"}constructor(e=[],i=null){super(i),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((i,n)=>i+e.getTypeLength(n.getNodeType(e)),0))}generate(e,i){const n=this.getNodeType(e),s=this.nodes,o=e.getComponentType(n),l=[];for(const c of s){let d=c.build(e);const p=e.getComponentType(c.getNodeType(e));p!==o&&(d=e.format(d,p,o)),l.push(d)}const u=`${e.getType(n)}( ${l.join(", ")} )`;return e.format(u,n,i)}}const Hce=pg.join("");class P5 extends en{static get type(){return"SplitNode"}constructor(e,i="x"){super(),this.node=e,this.components=i,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const i of this.components)e=Math.max(pg.indexOf(i)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,i){const n=this.node,s=e.getTypeLength(n.getNodeType(e));let o=null;if(s>1){let l=null;this.getVectorLength()>=s&&(l=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const u=n.build(e,l);this.components.length===s&&this.components===Hce.slice(0,this.components.length)?o=e.format(u,l,i):o=e.format(`${u}.${this.components}`,this.getNodeType(e),i)}else o=n.build(e,i);return o}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class Wce extends Js{static get type(){return"SetNode"}constructor(e,i,n){super(),this.sourceNode=e,this.components=i,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:i,components:n,targetNode:s}=this,o=this.getNodeType(e),l=e.getTypeFromLength(n.length,s.getNodeType(e)),u=s.build(e,l),c=i.build(e,o),d=e.getTypeLength(o),p=[];for(let f=0;f<d;f++){const m=pg[f];m===n[0]?(p.push(u),f+=n.length-1):p.push(c+"."+m)}return`${e.getType(o)}( ${p.join(", ")} )`}}class Qce extends Js{static get type(){return"FlipNode"}constructor(e,i){super(),this.sourceNode=e,this.components=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:i,sourceNode:n}=this,s=this.getNodeType(e),o=n.build(e),l=e.getVarFromNode(this),u=e.getPropertyName(l);e.addLineFlowCode(u+" = "+o,this);const c=e.getTypeLength(s),d=[];let p=0;for(let f=0;f<c;f++){const m=pg[f];m===i[p]?(d.push("1.0 - "+(u+"."+m)),p++):d.push(u+"."+m)}return`${e.getType(s)}( ${d.join(", ")} )`}}class l3 extends en{static get type(){return"InputNode"}constructor(e,i=null){super(i),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?F1(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=F1(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=Uce(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?B5(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}class Wu extends l3{static get type(){return"ConstNode"}constructor(e,i=null){super(e,i),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,i){const n=this.getNodeType(e);return e.format(this.generateConst(e),n,i)}}let fg=null;const mg=new Map;function Yt(r,e){if(mg.has(r)){console.warn(`Redefinition of method chaining ${r}`);return}if(typeof e!="function")throw new Error(`Node element ${r} is not a function`);mg.set(r,e)}const F5=r=>r.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),k5=r=>F5(r).split("").sort().join(""),U5={setup(r,e){const i=e.shift();return r(j1(i),...e)},get(r,e,i){if(typeof e=="string"&&r[e]===void 0){if(r.isStackNode!==!0&&e==="assign")return(...n)=>(fg.assign(i,...n),i);if(mg.has(e)){const n=mg.get(e);return r.isStackNode?(...s)=>i.add(n(...s)):(...s)=>n(i,...s)}else{if(e==="self")return r;if(e.endsWith("Assign")&&mg.has(e.slice(0,e.length-6))){const n=mg.get(e.slice(0,e.length-6));return r.isStackNode?(...s)=>i.assign(s[0],n(...s)):(...s)=>i.assign(n(i,...s))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=F5(e),wi(new P5(i,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=k5(e.slice(3).toLowerCase()),n=>wi(new Wce(r,e,n));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=k5(e.slice(4).toLowerCase()),()=>wi(new Qce(wi(r),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),wi(new P5(r,e));if(/^\d+$/.test(e)===!0)return wi(new iy(i,new Wu(Number(e),"uint")))}}}return Reflect.get(r,e,i)},set(r,e,i,n){return typeof e=="string"&&r[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(n[e].assign(i),!0):Reflect.set(r,e,i,n)}},c3=new WeakMap,z5=new WeakMap,qce=function(r,e=null){const i=F1(r);if(i==="node"){let n=c3.get(r);return n===void 0&&(n=new Proxy(r,U5),c3.set(r,n),c3.set(n,n)),n}else{if(e===null&&(i==="float"||i==="boolean")||i&&i!=="shader"&&i!=="string")return wi(p3(r,e));if(i==="shader")return ji(r)}return r},Xce=function(r,e=null){for(const i in r)r[i]=wi(r[i],e);return r},Yce=function(r,e=null){const i=r.length;for(let n=0;n<i;n++)r[n]=wi(r[n],e);return r},Kce=function(r,e=null,i=null,n=null){const s=o=>wi(n!==null?Object.assign(o,n):o);return e===null?(...o)=>s(new r(...gg(o))):i!==null?(i=wi(i),(...o)=>s(new r(e,...gg(o),i))):(...o)=>s(new r(e,...gg(o)))},Jce=function(r,...e){return wi(new r(...gg(e)))};class Zce extends en{constructor(e,i){super(),this.shaderNode=e,this.inputNodes=i}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}call(e){const{shaderNode:i,inputNodes:n}=this,s=e.getNodeProperties(i);if(s.onceOutput)return s.onceOutput;let o=null;if(i.layout){let l=z5.get(e.constructor);l===void 0&&(l=new WeakMap,z5.set(e.constructor,l));let u=l.get(i);u===void 0&&(u=wi(e.buildFunctionNode(i)),l.set(i,u)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(u),o=wi(u.call(n))}else{const l=i.jsFunc,u=n!==null?l(n,e):l(e);o=wi(u)}return i.once&&(s.onceOutput=o),o}getOutputNode(e){const i=e.getNodeProperties(this);return i.outputNode===null&&(i.outputNode=this.setupOutput(e)),i.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,i){return this.getOutputNode(e).build(e,i)}}class $ce extends en{constructor(e,i){super(i),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return j1(e),wi(new Zce(this,e))}setup(){return this.call()}}const eue=[!1,!0],tue=[0,1,2,3],iue=[-1,-2],j5=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],u3=new Map;for(const r of eue)u3.set(r,new Wu(r));const h3=new Map;for(const r of tue)h3.set(r,new Wu(r,"uint"));const d3=new Map([...h3].map(r=>new Wu(r.value,"int")));for(const r of iue)d3.set(r,new Wu(r,"int"));const k1=new Map([...d3].map(r=>new Wu(r.value)));for(const r of j5)k1.set(r,new Wu(r));for(const r of j5)k1.set(-r,new Wu(-r));const U1={bool:u3,uint:h3,ints:d3,float:k1},V5=new Map([...u3,...k1]),p3=(r,e)=>V5.has(r)?V5.get(r):r.isNode===!0?r:new Wu(r,e),rue=r=>{try{return r.getNodeType()}catch{return}},Zs=function(r,e=null){return(...i)=>{if((i.length===0||!["bool","float","int","uint"].includes(r)&&i.every(s=>typeof s!="object"))&&(i=[B5(r,...i)]),i.length===1&&e!==null&&e.has(i[0]))return wi(e.get(i[0]));if(i.length===1){const s=p3(i[0],r);return rue(s)===r?wi(s):wi(new O5(s,r))}const n=i.map(s=>p3(s));return wi(new Gce(n,r))}},G5=r=>typeof r=="object"&&r!==null?r.value:r,nue=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function z1(r,e){return new Proxy(new $ce(r,e),U5)}const wi=(r,e=null)=>qce(r,e),j1=(r,e=null)=>new Xce(r,e),gg=(r,e=null)=>new Yce(r,e),oi=(...r)=>new Kce(...r),Xi=(...r)=>new Jce(...r),ji=(r,e)=>{const i=new z1(r,e),n=(...s)=>{let o;return j1(s),s[0]&&s[0].isNode?o=[...s]:o=s[0],i.call(o)};return n.shaderNode=i,n.setLayout=s=>(i.setLayout(s),n),n.once=()=>(i.once=!0,n),n};Yt("toGlobal",r=>(r.global=!0,r));const V1=r=>{fg=r},H5=()=>fg,Pa=(...r)=>fg.If(...r);function sue(r){return fg&&fg.add(r),r}Yt("append",sue);const aue=new Zs("color"),ei=new Zs("float",U1.float),Ls=new Zs("int",U1.ints),oue=new Zs("uint",U1.uint),lue=new Zs("bool",U1.bool),Yi=new Zs("vec2"),Qu=new Zs("ivec2"),cue=new Zs("uvec2"),uue=new Zs("bvec2"),Zt=new Zs("vec3"),hue=new Zs("ivec3"),due=new Zs("uvec3"),pue=new Zs("bvec3"),Kr=new Zs("vec4"),fue=new Zs("ivec4"),mue=new Zs("uvec4"),gue=new Zs("bvec4"),f3=new Zs("mat2"),bo=new Zs("mat3"),Ag=new Zs("mat4");Yt("toColor",aue),Yt("toFloat",ei),Yt("toInt",Ls),Yt("toUint",oue),Yt("toBool",lue),Yt("toVec2",Yi),Yt("toIVec2",Qu),Yt("toUVec2",cue),Yt("toBVec2",uue),Yt("toVec3",Zt),Yt("toIVec3",hue),Yt("toUVec3",due),Yt("toBVec3",pue),Yt("toVec4",Kr),Yt("toIVec4",fue),Yt("toUVec4",mue),Yt("toBVec4",gue),Yt("toMat2",f3),Yt("toMat3",bo),Yt("toMat4",Ag);const Aue=oi(iy),yue=(r,e)=>wi(new O5(wi(r),e));Yt("element",Aue),Yt("convert",yue);class W5 extends en{static get type(){return"UniformGroupNode"}constructor(e,i=!1,n=1){super("string"),this.name=e,this.version=0,this.shared=i,this.order=n,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const vue=r=>new W5(r),Q5=(r,e=0)=>new W5(r,!0,e),xue=Q5("frame"),Cn=Q5("render"),q5=vue("object");class ry extends l3{static get type(){return"UniformNode"}constructor(e,i=null){super(e,i),this.isUniformNode=!0,this.name="",this.groupNode=q5}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,i){const n=this.getSelf();return e=e.bind(n),super.onUpdate(s=>{const o=e(s,n);o!==void 0&&(this.value=o)},i)}generate(e,i){const n=this.getNodeType(e),s=this.getUniformHash(e);let o=e.getNodeFromHash(s);o===void 0&&(e.setHashNode(this,s),o=this);const l=o.getInputType(e),u=e.getUniformFromNode(o,l,e.shaderStage,this.name||e.context.label),c=e.getPropertyName(u);return e.context.label!==void 0&&delete e.context.label,e.format(c,n,i)}}const Jr=(r,e)=>{const i=nue(e||r),n=r&&r.isNode===!0?r.node&&r.node.value||r.value:r;return wi(new ry(n,i))};class Zn extends en{static get type(){return"PropertyNode"}constructor(e,i=null,n=!1){super(e),this.name=i,this.varying=n,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let i;return this.varying===!0?(i=e.getVaryingFromNode(this,this.name),i.needsInterpolation=!0):i=e.getVarFromNode(this,this.name),e.getPropertyName(i)}}const yg=(r,e)=>wi(new Zn(r,e)),G1=(r,e)=>wi(new Zn(r,e,!0)),Wn=Xi(Zn,"vec4","DiffuseColor"),X5=Xi(Zn,"vec3","EmissiveColor"),qu=Xi(Zn,"float","Roughness"),H1=Xi(Zn,"float","Metalness"),m3=Xi(Zn,"float","Clearcoat"),W1=Xi(Zn,"float","ClearcoatRoughness"),vg=Xi(Zn,"vec3","Sheen"),g3=Xi(Zn,"float","SheenRoughness"),A3=Xi(Zn,"float","Iridescence"),Y5=Xi(Zn,"float","IridescenceIOR"),K5=Xi(Zn,"float","IridescenceThickness"),y3=Xi(Zn,"float","AlphaT"),Dp=Xi(Zn,"float","Anisotropy"),Q1=Xi(Zn,"vec3","AnisotropyT"),xg=Xi(Zn,"vec3","AnisotropyB"),dl=Xi(Zn,"color","SpecularColor"),q1=Xi(Zn,"float","SpecularF90"),v3=Xi(Zn,"float","Shininess"),bue=Xi(Zn,"vec4","Output"),x3=Xi(Zn,"float","dashSize"),J5=Xi(Zn,"float","gapSize"),X1=Xi(Zn,"float","IOR"),b3=Xi(Zn,"float","Transmission"),Z5=Xi(Zn,"float","Thickness"),$5=Xi(Zn,"float","AttenuationDistance"),e6=Xi(Zn,"color","AttenuationColor"),t6=Xi(Zn,"float","Dispersion");class _ue extends Js{static get type(){return"AssignNode"}constructor(e,i){super(),this.targetNode=e,this.sourceNode=i}hasDependencies(){return!1}getNodeType(e,i){return i!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:i}=this;if(e.isAvailable("swizzleAssign")===!1&&i.isSplitNode&&i.components.length>1){const n=e.getTypeLength(i.node.getNodeType(e));return pg.join("").slice(0,n)!==i.components}return!1}generate(e,i){const{targetNode:n,sourceNode:s}=this,o=this.needsSplitAssign(e),l=n.getNodeType(e),u=n.context({assign:!0}).build(e),c=s.build(e,l),d=s.getNodeType(e),p=e.getDataFromNode(this);let f;if(p.initialized===!0)i!=="void"&&(f=u);else if(o){const m=e.getVarFromNode(this,null,l),g=e.getPropertyName(m);e.addLineFlowCode(`${g} = ${c}`,this);const y=n.node.context({assign:!0}).build(e);for(let x=0;x<n.components.length;x++){const v=n.components[x];e.addLineFlowCode(`${y}.${v} = ${g}[ ${x} ]`,this)}i!=="void"&&(f=u)}else f=`${u} = ${c}`,(i==="void"||d==="void")&&(e.addLineFlowCode(f,this),i!=="void"&&(f=u));return p.initialized=!0,e.format(f,l,i)}}Yt("assign",oi(_ue));class Eue extends Js{static get type(){return"FunctionCallNode"}constructor(e=null,i={}){super(),this.functionNode=e,this.parameters=i}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const i=[],n=this.functionNode,s=n.getInputs(e),o=this.parameters,l=(u,c)=>{const d=c.type,p=d==="pointer";let f;return p?f="&"+u.build(e):f=u.build(e,d),f};if(Array.isArray(o))for(let u=0;u<o.length;u++)i.push(l(o[u],s[u]));else for(const u of s){const c=o[u.name];if(c!==void 0)i.push(l(c,u));else throw new Error(`FunctionCallNode: Input '${u.name}' not found in FunctionNode.`)}return`${n.build(e,"property")}( ${i.join(", ")} )`}}Yt("call",(r,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?gg(e):j1(e[0]),wi(new Eue(wi(r),e))));class _s extends Js{static get type(){return"OperatorNode"}constructor(e,i,n,...s){if(super(),s.length>0){let o=new _s(e,i,n);for(let l=0;l<s.length-1;l++)o=new _s(e,o,s[l]);i=o,n=s[s.length-1]}this.op=e,this.aNode=i,this.bNode=n}getNodeType(e,i){const n=this.op,s=this.aNode,o=this.bNode,l=s.getNodeType(e),u=typeof o<"u"?o.getNodeType(e):null;if(l==="void"||u==="void")return"void";if(n==="%")return l;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(l);if(n==="!"||n==="=="||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="<"||n===">"||n==="<="||n===">="){const c=i?e.getTypeLength(i):Math.max(e.getTypeLength(l),e.getTypeLength(u));return c>1?`bvec${c}`:"bool"}else return l==="float"&&e.isMatrix(u)?u:e.isMatrix(l)&&e.isVector(u)?e.getVectorFromMatrix(l):e.isVector(l)&&e.isMatrix(u)?e.getVectorFromMatrix(u):e.getTypeLength(u)>e.getTypeLength(l)?u:l}generate(e,i){const n=this.op,s=this.aNode,o=this.bNode,l=this.getNodeType(e,i);let u=null,c=null;l!=="void"?(u=s.getNodeType(e),c=typeof o<"u"?o.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="?e.isVector(u)?c=u:u!==c&&(u=c="float"):n===">>"||n==="<<"?(u=l,c=e.changeComponentType(c,"uint")):e.isMatrix(u)&&e.isVector(c)?c=e.getVectorFromMatrix(u):e.isVector(u)&&e.isMatrix(c)?u=e.getVectorFromMatrix(c):u=c=l):u=c=l;const d=s.build(e,u),p=typeof o<"u"?o.build(e,c):null,f=e.getTypeLength(i),m=e.getFunctionOperator(n);if(i!=="void")return n==="<"&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThan",i)}( ${d}, ${p} )`,l,i):e.format(`( ${d} < ${p} )`,l,i):n==="<="&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",i)}( ${d}, ${p} )`,l,i):e.format(`( ${d} <= ${p} )`,l,i):n===">"&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",i)}( ${d}, ${p} )`,l,i):e.format(`( ${d} > ${p} )`,l,i):n===">="&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",i)}( ${d}, ${p} )`,l,i):e.format(`( ${d} >= ${p} )`,l,i):n==="!"||n==="~"?e.format(`(${n}${d})`,u,i):m?e.format(`${m}( ${d}, ${p} )`,l,i):e.format(`( ${d} ${n} ${p} )`,l,i);if(u!=="void")return m?e.format(`${m}( ${d}, ${p} )`,l,i):e.format(`${d} ${n} ${p}`,l,i)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const _o=oi(_s,"+"),pl=oi(_s,"-"),yn=oi(_s,"*"),ud=oi(_s,"/"),i6=oi(_s,"%"),wue=oi(_s,"=="),Cue=oi(_s,"!="),Sue=oi(_s,"<"),Tue=oi(_s,">"),Mue=oi(_s,"<="),Rue=oi(_s,">="),Iue=oi(_s,"&&"),Bue=oi(_s,"||"),Nue=oi(_s,"!"),Lue=oi(_s,"^^"),Due=oi(_s,"&"),Oue=oi(_s,"~"),Pue=oi(_s,"|"),Fue=oi(_s,"^"),kue=oi(_s,"<<"),Uue=oi(_s,">>");Yt("add",_o),Yt("sub",pl),Yt("mul",yn),Yt("div",ud),Yt("modInt",i6),Yt("equal",wue),Yt("notEqual",Cue),Yt("lessThan",Sue),Yt("greaterThan",Tue),Yt("lessThanEqual",Mue),Yt("greaterThanEqual",Rue),Yt("and",Iue),Yt("or",Bue),Yt("not",Nue),Yt("xor",Lue),Yt("bitAnd",Due),Yt("bitNot",Oue),Yt("bitOr",Pue),Yt("bitXor",Fue),Yt("shiftLeft",kue),Yt("shiftRight",Uue),Yt("remainder",(...r)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),i6(...r)));class _t extends Js{static get type(){return"MathNode"}constructor(e,i,n=null,s=null){super(),this.method=e,this.aNode=i,this.bNode=n,this.cNode=s}getInputType(e){const i=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,s=this.cNode?this.cNode.getNodeType(e):null,o=e.isMatrix(i)?0:e.getTypeLength(i),l=e.isMatrix(n)?0:e.getTypeLength(n),u=e.isMatrix(s)?0:e.getTypeLength(s);return o>l&&o>u?i:l>u?n:u>o?s:i}getNodeType(e){const i=this.method;return i===_t.LENGTH||i===_t.DISTANCE||i===_t.DOT?"float":i===_t.CROSS?"vec3":i===_t.ALL?"bool":i===_t.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):i===_t.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,i){const n=this.method,s=this.getNodeType(e),o=this.getInputType(e),l=this.aNode,u=this.bNode,c=this.cNode,d=e.renderer.isWebGLRenderer===!0;if(n===_t.TRANSFORM_DIRECTION){let p=l,f=u;e.isMatrix(p.getNodeType(e))?f=Kr(Zt(f),0):p=Kr(Zt(p),0);const m=yn(p,f).xyz;return sy(m).build(e,i)}else{if(n===_t.NEGATE)return e.format("( - "+l.build(e,o)+" )",s,i);if(n===_t.ONE_MINUS)return pl(1,l).build(e,i);if(n===_t.RECIPROCAL)return ud(1,l).build(e,i);if(n===_t.DIFFERENCE)return gc(pl(l,u)).build(e,i);{const p=[];return n===_t.CROSS||n===_t.MOD?p.push(l.build(e,s),u.build(e,s)):d&&n===_t.STEP?p.push(l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o),u.build(e,o)):d&&(n===_t.MIN||n===_t.MAX)||n===_t.MOD?p.push(l.build(e,o),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":o)):n===_t.REFRACT?p.push(l.build(e,o),u.build(e,o),c.build(e,"float")):n===_t.MIX?p.push(l.build(e,o),u.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):(p.push(l.build(e,o)),u!==null&&p.push(u.build(e,o)),c!==null&&p.push(c.build(e,o))),e.format(`${e.getMethod(n,s)}( ${p.join(", ")} )`,s,i)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}_t.ALL="all",_t.ANY="any",_t.EQUALS="equals",_t.RADIANS="radians",_t.DEGREES="degrees",_t.EXP="exp",_t.EXP2="exp2",_t.LOG="log",_t.LOG2="log2",_t.SQRT="sqrt",_t.INVERSE_SQRT="inversesqrt",_t.FLOOR="floor",_t.CEIL="ceil",_t.NORMALIZE="normalize",_t.FRACT="fract",_t.SIN="sin",_t.COS="cos",_t.TAN="tan",_t.ASIN="asin",_t.ACOS="acos",_t.ATAN="atan",_t.ABS="abs",_t.SIGN="sign",_t.LENGTH="length",_t.NEGATE="negate",_t.ONE_MINUS="oneMinus",_t.DFDX="dFdx",_t.DFDY="dFdy",_t.ROUND="round",_t.RECIPROCAL="reciprocal",_t.TRUNC="trunc",_t.FWIDTH="fwidth",_t.BITCAST="bitcast",_t.TRANSPOSE="transpose",_t.ATAN2="atan2",_t.MIN="min",_t.MAX="max",_t.MOD="mod",_t.STEP="step",_t.REFLECT="reflect",_t.DISTANCE="distance",_t.DIFFERENCE="difference",_t.DOT="dot",_t.CROSS="cross",_t.POW="pow",_t.TRANSFORM_DIRECTION="transformDirection",_t.MIX="mix",_t.CLAMP="clamp",_t.REFRACT="refract",_t.SMOOTHSTEP="smoothstep",_t.FACEFORWARD="faceforward";const zue=ei(1e-6),jue=ei(Math.PI),r6=oi(_t,_t.ALL),Vue=oi(_t,_t.ANY),Gue=oi(_t,_t.EQUALS),Hue=oi(_t,_t.RADIANS),Wue=oi(_t,_t.DEGREES),n6=oi(_t,_t.EXP),ny=oi(_t,_t.EXP2),s6=oi(_t,_t.LOG),Xu=oi(_t,_t.LOG2),_3=oi(_t,_t.SQRT),Que=oi(_t,_t.INVERSE_SQRT),Op=oi(_t,_t.FLOOR),E3=oi(_t,_t.CEIL),sy=oi(_t,_t.NORMALIZE),hd=oi(_t,_t.FRACT),mc=oi(_t,_t.SIN),dd=oi(_t,_t.COS),que=oi(_t,_t.TAN),Xue=oi(_t,_t.ASIN),Yue=oi(_t,_t.ACOS),Kue=oi(_t,_t.ATAN),gc=oi(_t,_t.ABS),a6=oi(_t,_t.SIGN),pd=oi(_t,_t.LENGTH),Jue=oi(_t,_t.NEGATE),Zue=oi(_t,_t.ONE_MINUS),o6=oi(_t,_t.DFDX),l6=oi(_t,_t.DFDY),$ue=oi(_t,_t.ROUND),ehe=oi(_t,_t.RECIPROCAL),the=oi(_t,_t.TRUNC),ihe=oi(_t,_t.FWIDTH);_t.BITCAST;const rhe=oi(_t,_t.TRANSPOSE),nhe=oi(_t,_t.ATAN2),ay=oi(_t,_t.MIN),Bl=oi(_t,_t.MAX),c6=oi(_t,_t.MOD),u6=oi(_t,_t.STEP),she=oi(_t,_t.REFLECT),ahe=oi(_t,_t.DISTANCE),ohe=oi(_t,_t.DIFFERENCE),w3=oi(_t,_t.DOT),h6=oi(_t,_t.CROSS),Y1=oi(_t,_t.POW),d6=oi(_t,_t.POW,2),lhe=oi(_t,_t.POW,3),che=oi(_t,_t.POW,4),uhe=oi(_t,_t.TRANSFORM_DIRECTION),hhe=r=>yn(a6(r),Y1(gc(r),1/3)),dhe=r=>w3(r,r),fs=oi(_t,_t.MIX),Yu=(r,e=0,i=1)=>wi(new _t(_t.CLAMP,wi(r),wi(e),wi(i))),phe=r=>Yu(r),p6=oi(_t,_t.REFRACT),Pp=oi(_t,_t.SMOOTHSTEP),fhe=oi(_t,_t.FACEFORWARD),mhe=ji(([r])=>{const e=43758.5453,i=w3(r.xy,Yi(12.9898,78.233)),n=c6(i,jue);return hd(mc(n).mul(e))}),ghe=(r,e,i)=>fs(e,i,r),Ahe=(r,e,i)=>Pp(e,i,r);Yt("all",r6),Yt("any",Vue),Yt("equals",Gue),Yt("radians",Hue),Yt("degrees",Wue),Yt("exp",n6),Yt("exp2",ny),Yt("log",s6),Yt("log2",Xu),Yt("sqrt",_3),Yt("inverseSqrt",Que),Yt("floor",Op),Yt("ceil",E3),Yt("normalize",sy),Yt("fract",hd),Yt("sin",mc),Yt("cos",dd),Yt("tan",que),Yt("asin",Xue),Yt("acos",Yue),Yt("atan",Kue),Yt("abs",gc),Yt("sign",a6),Yt("length",pd),Yt("lengthSq",dhe),Yt("negate",Jue),Yt("oneMinus",Zue),Yt("dFdx",o6),Yt("dFdy",l6),Yt("round",$ue),Yt("reciprocal",ehe),Yt("trunc",the),Yt("fwidth",ihe),Yt("atan2",nhe),Yt("min",ay),Yt("max",Bl),Yt("mod",c6),Yt("step",u6),Yt("reflect",she),Yt("distance",ahe),Yt("dot",w3),Yt("cross",h6),Yt("pow",Y1),Yt("pow2",d6),Yt("pow3",lhe),Yt("pow4",che),Yt("transformDirection",uhe),Yt("mix",ghe),Yt("clamp",Yu),Yt("refract",p6),Yt("smoothstep",Ahe),Yt("faceForward",fhe),Yt("difference",ohe),Yt("saturate",phe),Yt("cbrt",hhe),Yt("transpose",rhe),Yt("rand",mhe);class yhe extends en{static get type(){return"ConditionalNode"}constructor(e,i,n=null){super(),this.condNode=e,this.ifNode=i,this.elseNode=n}getNodeType(e){const i=this.ifNode.getNodeType(e);if(this.elseNode!==null){const n=this.elseNode.getNodeType(e);if(e.getTypeLength(n)>e.getTypeLength(i))return n}return i}setup(e){const i=this.condNode.cache(),n=this.ifNode.cache(),s=this.elseNode?this.elseNode.cache():null,o=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=o,s!==null&&(e.getDataFromNode(s).parentNodeBlock=o);const l=e.getNodeProperties(this);l.condNode=i,l.ifNode=n.context({nodeBlock:n}),l.elseNode=s?s.context({nodeBlock:s}):null}generate(e,i){const n=this.getNodeType(e),s=e.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:o,ifNode:l,elseNode:u}=e.getNodeProperties(this),c=i!=="void",d=c?yg(n).build(e):"";s.nodeProperty=d;const p=o.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${p} ) {

`).addFlowTab();let f=l.build(e,n);if(f&&(c?f=d+" = "+f+";":f="return "+f+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+f+`

`+e.tab+"}"),u!==null){e.addFlowCode(` else {

`).addFlowTab();let m=u.build(e,n);m&&(c?m=d+" = "+m+";":m="return "+m+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+m+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(d,n,i)}}const Go=oi(yhe);Yt("select",Go),Yt("cond",(...r)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),Go(...r)));class f6 extends en{static get type(){return"ContextNode"}constructor(e,i={}){super(),this.isContextNode=!0,this.node=e,this.value=i}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const i=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e);return e.setContext(i),n}generate(e,i){const n=e.getContext();e.setContext({...e.context,...this.value});const s=this.node.build(e,i);return e.setContext(n),s}}const C3=oi(f6),vhe=(r,e)=>C3(r,{label:e});Yt("context",C3),Yt("label",vhe);class xhe extends en{static get type(){return"VarNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:i,name:n}=this,s=e.getVarFromNode(this,n,e.getVectorType(this.getNodeType(e))),o=e.getPropertyName(s),l=i.build(e,s.type);return e.addLineFlowCode(`${o} = ${l}`,this),o}}const m6=oi(xhe);Yt("toVar",(...r)=>m6(...r).append()),Yt("temp",r=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),m6(r)));class bhe extends en{static get type(){return"VaryingNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const i=e.getNodeProperties(this);let n=i.varying;if(n===void 0){const s=this.name,o=this.getNodeType(e);i.varying=n=e.getVaryingFromNode(this,s,o),i.node=this.node}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const i=e.getNodeProperties(this),n=this.setupVarying(e);if(i.propertyName===void 0){const s=this.getNodeType(e),o=e.getPropertyName(n,N5.VERTEX);e.flowNodeFromShaderStage(N5.VERTEX,this.node,s,o),i.propertyName=o}return e.getPropertyName(n)}}const Ku=oi(bhe);Yt("varying",Ku);const _he=ji(([r])=>{const e=r.mul(.9478672986).add(.0521327014).pow(2.4),i=r.mul(.0773993808),n=r.lessThanEqual(.04045);return fs(e,i,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Ehe=ji(([r])=>{const e=r.pow(.41666).mul(1.055).sub(.055),i=r.mul(12.92),n=r.lessThanEqual(.0031308);return fs(e,i,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),oy="WorkingColorSpace",S3="OutputColorSpace";class K1 extends Js{static get type(){return"ColorSpaceNode"}constructor(e,i,n){super("vec4"),this.colorNode=e,this.source=i,this.target=n}resolveColorSpace(e,i){return i===oy?Ys.workingColorSpace:i===S3?e.context.outputColorSpace||e.renderer.outputColorSpace:i}setup(e){const{colorNode:i}=this,n=this.resolveColorSpace(e,this.source),s=this.resolveColorSpace(e,this.target);let o=i;return Ys.enabled===!1||n===s||!n||!s||(Ys.getTransfer(n)===GA&&(o=Kr(_he(o.rgb),o.a)),Ys.getPrimaries(n)!==Ys.getPrimaries(s)&&(o=Kr(bo(Ys._getMatrix(new jo,n,s)).mul(o.rgb),o.a)),Ys.getTransfer(s)===GA&&(o=Kr(Ehe(o.rgb),o.a))),o}}const whe=r=>wi(new K1(wi(r),oy,S3)),Che=r=>wi(new K1(wi(r),S3,oy)),She=(r,e)=>wi(new K1(wi(r),oy,e)),g6=(r,e)=>wi(new K1(wi(r),e,oy));Yt("toOutputColorSpace",whe),Yt("toWorkingColorSpace",Che),Yt("workingToColorSpace",She),Yt("colorSpaceToWorking",g6);let The=class extends iy{static get type(){return"ReferenceElementNode"}constructor(r,e){super(r,e),this.referenceNode=r,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(r){const e=super.generate(r),i=this.referenceNode.getNodeType(),n=this.getNodeType();return r.format(e,i,n)}};class A6 extends en{static get type(){return"ReferenceBaseNode"}constructor(e,i,n=null,s=null){super(),this.property=e,this.uniformType=i,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=cn.OBJECT}setGroup(e){return this.group=e,this}element(e){return wi(new The(this,wi(e)))}setNodeType(e){const i=Jr(null,e).getSelf();this.group!==null&&i.setGroup(this.group),this.node=i}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:i}=this;let n=e[i[0]];for(let s=1;s<i.length;s++)n=n[i[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Mhe=(r,e,i)=>wi(new A6(r,e,i));class Rhe extends A6{static get type(){return"RendererReferenceNode"}constructor(e,i,n=null){super(e,i,n),this.renderer=n,this.setGroup(Cn)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const Ihe=(r,e,i)=>wi(new Rhe(r,e,i));class Bhe extends Js{static get type(){return"ToneMappingNode"}constructor(e,i=Lhe,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=i,this.colorNode=n}getCacheKey(){return O1(super.getCacheKey(),this.toneMapping)}setup(e){const i=this.colorNode||e.context.color,n=this.toneMapping;if(n===Gm)return i;let s=null;const o=e.renderer.library.getToneMappingFunction(n);return o!==null?s=Kr(o(i.rgb,this.exposureNode),i.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),s=i),s}}const Nhe=(r,e,i)=>wi(new Bhe(r,wi(e),wi(i))),Lhe=Ihe("toneMappingExposure","float");Yt("toneMapping",(r,e,i)=>Nhe(e,i,r));class Dhe extends l3{static get type(){return"BufferAttributeNode"}constructor(e,i=null,n=0,s=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferStride=n,this.bufferOffset=s,this.usage=m1,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let i=e.globalCache.getData(this.value);return i===void 0&&(i={node:this},e.globalCache.setData(this.value,i)),i.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const i=this.getNodeType(e),n=this.value,s=e.getTypeLength(i),o=this.bufferStride||s,l=this.bufferOffset,u=n.isInterleavedBuffer===!0?n:new p5(n,o),c=new $M(u,s,l);u.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const i=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,i),s=e.getPropertyName(n);let o=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=s,o=s):o=Ku(this).build(e,i),o}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const T3=(r,e,i,n)=>wi(new Dhe(r,e,i,n)),Ohe=(r,e,i,n)=>T3(r,e,i,n).setUsage(Km),y6=(r,e,i,n)=>T3(r,e,i,n).setInstanced(!0),v6=(r,e,i,n)=>Ohe(r,e,i,n).setInstanced(!0);Yt("toAttribute",r=>T3(r.value));class Phe extends en{static get type(){return"ComputeNode"}constructor(e,i,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=i,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.updateBeforeType=cn.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:i}=this;let n=i[0];for(let s=1;s<i.length;s++)n*=i[s];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:i}=e;if(i==="compute"){const n=this.computeNode.build(e,"void");n!==""&&e.addLineFlowCode(n,this)}}}Yt("compute",(r,e,i)=>wi(new Phe(wi(r),e,i)));class Fhe extends en{static get type(){return"CacheNode"}constructor(e,i=!0){super(),this.node=e,this.parent=i,this.isCacheNode=!0}getNodeType(e){return this.node.getNodeType(e)}build(e,...i){const n=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const o=this.node.build(e,...i);return e.setCache(n),o}}const J1=(r,...e)=>wi(new Fhe(wi(r),...e));Yt("cache",J1);class khe extends en{static get type(){return"BypassNode"}constructor(e,i){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=i}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const i=this.callNode.build(e,"void");return i!==""&&e.addLineFlowCode(i,this),this.outputNode.build(e)}}Yt("bypass",oi(khe));class x6 extends en{static get type(){return"RemapNode"}constructor(e,i,n,s=ei(0),o=ei(1)){super(),this.node=e,this.inLowNode=i,this.inHighNode=n,this.outLowNode=s,this.outHighNode=o,this.doClamp=!0}setup(){const{node:e,inLowNode:i,inHighNode:n,outLowNode:s,outHighNode:o,doClamp:l}=this;let u=e.sub(i).div(n.sub(i));return l===!0&&(u=u.clamp()),u.mul(o.sub(s)).add(s)}}const Uhe=oi(x6,null,null,{doClamp:!1}),zhe=oi(x6);Yt("remap",Uhe),Yt("remapClamp",zhe);class jhe extends en{static get type(){return"ExpressionNode"}constructor(e="",i="void"){super(i),this.snippet=e}generate(e,i){const n=this.getNodeType(e),s=this.snippet;if(n==="void")e.addLineFlowCode(s,this);else return e.format(`( ${s} )`,n,i)}}const ly=oi(jhe);Yt("discard",r=>(r?Go(r,ly("discard")):ly("discard")).append());class Vhe extends Js{static get type(){return"RenderOutputNode"}constructor(e,i,n){super("vec4"),this.colorNode=e,this.toneMapping=i,this.outputColorSpace=n,this.isRenderOutput=!0}setup({context:e}){let i=this.colorNode||e.color;const n=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Gm,s=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||wp;return n!==Gm&&(i=i.toneMapping(n)),s!==wp&&s!==Ys.workingColorSpace&&(i=i.workingToColorSpace(s)),i}}Yt("renderOutput",(r,e=null,i=null)=>wi(new Vhe(wi(r),e,i)));class Ghe extends en{static get type(){return"AttributeNode"}constructor(e,i=null){super(i),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let i=this.nodeType;if(i===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const s=e.geometry.getAttribute(n);i=e.getTypeFromAttribute(s)}else i="float"}return i}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const i=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(i)===!0){const s=e.geometry.getAttribute(i),o=e.getTypeFromAttribute(s),l=e.getAttribute(i,o);return e.shaderStage==="vertex"?e.format(l.name,o,n):Ku(this).build(e,n)}else return console.warn(`AttributeNode: Vertex attribute "${i}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Ju=(r,e)=>wi(new Ghe(r,e)),Z1=r=>Ju("uv"+(r>0?r:""),"vec2");class Hhe extends en{static get type(){return"TextureSizeNode"}constructor(e,i=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=i}generate(e,i){const n=this.textureNode.build(e,"property"),s=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${s} )`,this.getNodeType(e),i)}}const cy=oi(Hhe);class Whe extends ry{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=cn.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,i=e.images,n=i&&i.length>0?i[0]&&i[0].image||i[0]:e.image;if(n&&n.width!==void 0){const{width:s,height:o}=n;this.value=Math.log2(Math.max(s,o))}}}const Qhe=oi(Whe);class uy extends ry{static get type(){return"TextureNode"}constructor(e,i=null,n=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=i,this.levelNode=n,this.biasNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=cn.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(i===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Da?"uvec4":this.value.type===Ao?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Z1(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Jr(this.value.matrix)),this._matrixUniform.mul(Zt(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?cn.FRAME:cn.NONE,this}setupUV(e,i){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?i=i.flipY():i=i.setY(Ls(cy(this,this.levelNode).y).sub(i.y).sub(1))),i}setup(e){const i=e.getNodeProperties(this);i.referenceNode=this.referenceNode;let n=this.uvNode;(n===null||e.context.forceUVContext===!0)&&e.context.getUV&&(n=e.context.getUV(this)),n||(n=this.getDefaultUV()),this.updateMatrix===!0&&(n=this.getTransformedUV(n)),n=this.setupUV(e,n);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),i.uvNode=n,i.levelNode=s,i.biasNode=this.biasNode,i.compareNode=this.compareNode,i.gradNode=this.gradNode,i.depthNode=this.depthNode}generateUV(e,i){return i.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,i,n,s,o,l,u,c){const d=this.value;let p;return s?p=e.generateTextureLevel(d,i,n,s,l):o?p=e.generateTextureBias(d,i,n,o,l):c?p=e.generateTextureGrad(d,i,n,c,l):u?p=e.generateTextureCompare(d,i,n,u,l):this.sampler===!1?p=e.generateTextureLoad(d,i,n,l):p=e.generateTexture(d,i,n,l),p}generate(e,i){const n=e.getNodeProperties(this),s=this.value;if(!s||s.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const o=super.generate(e,"property");if(i==="sampler")return o+"_sampler";if(e.isReference(i))return o;{const l=e.getDataFromNode(this);let u=l.propertyName;if(u===void 0){const{uvNode:p,levelNode:f,biasNode:m,compareNode:g,depthNode:y,gradNode:x}=n,v=this.generateUV(e,p),_=f?f.build(e,"float"):null,T=m?m.build(e,"float"):null,w=y?y.build(e,"int"):null,S=g?g.build(e,"float"):null,R=x?[x[0].build(e,"vec2"),x[1].build(e,"vec2")]:null,B=e.getVarFromNode(this);u=e.getPropertyName(B);const I=this.generateSnippet(e,o,v,_,T,w,S,R);e.addLineFlowCode(`${u} = ${I}`,this),l.snippet=I,l.propertyName=u}let c=u;const d=this.getNodeType(e);return e.needsToWorkingColorSpace(s)&&(c=g6(ly(c,d),s.colorSpace).setup(e).build(e,d)),e.format(c,d,i)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const i=this.clone();return i.uvNode=wi(e),i.referenceNode=this.getSelf(),wi(i)}blur(e){const i=this.clone();return i.biasNode=wi(e).mul(Qhe(i)),i.referenceNode=this.getSelf(),wi(i)}level(e){const i=this.clone();return i.levelNode=wi(e),i.referenceNode=this.getSelf(),wi(i)}size(e){return cy(this,e)}bias(e){const i=this.clone();return i.biasNode=wi(e),i.referenceNode=this.getSelf(),wi(i)}compare(e){const i=this.clone();return i.compareNode=wi(e),i.referenceNode=this.getSelf(),wi(i)}grad(e,i){const n=this.clone();return n.gradNode=[wi(e),wi(i)],n.referenceNode=this.getSelf(),wi(n)}depth(e){const i=this.clone();return i.depthNode=wi(e),i.referenceNode=this.getSelf(),wi(i)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,i=this._matrixUniform;i!==null&&(i.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const Ds=oi(uy),Ac=(...r)=>Ds(...r).setSampler(!1),Fp=Jr("float").label("cameraNear").setGroup(Cn).onRenderUpdate(({camera:r})=>r.near),kp=Jr("float").label("cameraFar").setGroup(Cn).onRenderUpdate(({camera:r})=>r.far),$1=Jr("mat4").label("cameraProjectionMatrix").setGroup(Cn).onRenderUpdate(({camera:r})=>r.projectionMatrix),Zu=Jr("mat4").label("cameraViewMatrix").setGroup(Cn).onRenderUpdate(({camera:r})=>r.matrixWorldInverse),qhe=Jr(new It).label("cameraPosition").setGroup(Cn).onRenderUpdate(({camera:r},e)=>e.value.setFromMatrixPosition(r.matrixWorld));class Os extends en{static get type(){return"Object3DNode"}constructor(e,i=null){super(),this.scope=e,this.object3d=i,this.updateType=cn.OBJECT,this._uniformNode=new ry(null)}getNodeType(){const e=this.scope;if(e===Os.WORLD_MATRIX)return"mat4";if(e===Os.POSITION||e===Os.VIEW_POSITION||e===Os.DIRECTION||e===Os.SCALE)return"vec3"}update(e){const i=this.object3d,n=this._uniformNode,s=this.scope;if(s===Os.WORLD_MATRIX)n.value=i.matrixWorld;else if(s===Os.POSITION)n.value=n.value||new It,n.value.setFromMatrixPosition(i.matrixWorld);else if(s===Os.SCALE)n.value=n.value||new It,n.value.setFromMatrixScale(i.matrixWorld);else if(s===Os.DIRECTION)n.value=n.value||new It,i.getWorldDirection(n.value);else if(s===Os.VIEW_POSITION){const o=e.camera;n.value=n.value||new It,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(o.matrixWorldInverse)}}generate(e){const i=this.scope;return i===Os.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(i===Os.POSITION||i===Os.VIEW_POSITION||i===Os.DIRECTION||i===Os.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Os.WORLD_MATRIX="worldMatrix",Os.POSITION="position",Os.SCALE="scale",Os.VIEW_POSITION="viewPosition",Os.DIRECTION="direction";class bg extends Os{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}bg.DIRECTION;const Up=Xi(bg,bg.WORLD_MATRIX);bg.POSITION,bg.SCALE,bg.VIEW_POSITION;const Xhe=Jr(new jo).onObjectUpdate(({object:r},e)=>e.value.getNormalMatrix(r.matrixWorld)),e_=Zu.mul(Up).toVar("modelViewMatrix"),b6=Ju("position","vec3"),Fa=b6.varying("positionLocal"),_6=b6.varying("positionPrevious"),M3=Up.mul(Fa).xyz.varying("v_positionWorld"),E6=Fa.transformDirection(Up).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),ka=e_.mul(Fa).xyz.varying("v_positionView"),Ts=ka.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class Yhe extends en{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:i,material:n}=e;return i.coordinateSystem===cc&&n.side===lc?"false":e.getFrontFacing()}}const Khe=Xi(Yhe),t_=ei(Khe).mul(2).sub(1),w6=Ju("normal","vec3"),kc=ji(r=>r.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),Zt(0,1,0)):w6,"vec3").once()().toVar("normalLocal"),Jhe=ka.dFdx().cross(ka.dFdy()).normalize().toVar("normalFlat"),yc=ji(r=>{let e;return r.material.flatShading===!0?e=Jhe:e=Ku(S6(kc),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),C6=Ku(yc.transformDirection(Zu),"v_normalWorld").normalize().toVar("normalWorld"),$s=ji(r=>r.context.setupNormal(),"vec3").once()().mul(t_).toVar("transformedNormalView"),R3=$s.transformDirection(Zu).toVar("transformedNormalWorld"),hy=ji(r=>r.context.setupClearcoatNormal(),"vec3").once()().mul(t_).toVar("transformedClearcoatNormalView"),Zhe=ji(([r,e=Up])=>{const i=bo(e),n=r.div(Zt(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2])));return i.mul(n).xyz}),S6=ji(([r],e)=>{const i=e.renderer.nodes.modelNormalViewMatrix;if(i!==null)return i.transformDirection(r);const n=Xhe.mul(r);return Zu.transformDirection(n)}),$he=Jr(0).onReference(({material:r})=>r).onRenderUpdate(({material:r})=>r.refractionRatio),ede=Ts.negate().reflect($s),tde=Ts.negate().refract($s,$he),ide=ede.transformDirection(Zu).toVar("reflectVector"),rde=tde.transformDirection(Zu).toVar("reflectVector");class nde extends uy{static get type(){return"CubeTextureNode"}constructor(e,i=null,n=null,s=null){super(e,i,n,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===_p?ide:e.mapping===Hm?rde:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),Zt(0,0,0))}setUpdateMatrix(){}setupUV(e,i){const n=this.value;return e.renderer.coordinateSystem===Sp||!n.isRenderTargetTexture?Zt(i.x.negate(),i.yz):i}generateUV(e,i){return i.build(e,"vec3")}}const dy=oi(nde);class T6 extends ry{static get type(){return"BufferNode"}constructor(e,i,n=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const I3=(r,e,i)=>wi(new T6(r,e,i));class sde extends iy{static get type(){return"UniformArrayElementNode"}constructor(e,i){super(e,i),this.isArrayBufferElementNode=!0}generate(e){const i=super.generate(e),n=this.getNodeType();return e.format(i,"vec4",n)}}class ade extends T6{static get type(){return"UniformArrayNode"}constructor(e,i=null){super(null,"vec4"),this.array=e,this.elementType=i,this._elementType=null,this._elementLength=0,this.updateType=cn.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:e,value:i}=this,n=this.getElementLength(),s=this.getElementType();if(n===1)for(let o=0;o<e.length;o++){const l=o*4;i[l]=e[o]}else if(s==="color")for(let o=0;o<e.length;o++){const l=o*4,u=e[o];i[l]=u.r,i[l+1]=u.g,i[l+2]=u.b||0}else for(let o=0;o<e.length;o++){const l=o*4,u=e[o];i[l]=u.x,i[l+1]=u.y,i[l+2]=u.z||0,i[l+3]=u.w||0}}setup(e){const i=this.array.length;this._elementType=this.elementType===null?F1(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType);let n=Float32Array;return this._elementType.charAt(0)==="i"?n=Int32Array:this._elementType.charAt(0)==="u"&&(n=Uint32Array),this.value=new n(i*4),this.bufferCount=i,this.bufferType=e.changeComponentType("vec4",e.getComponentType(this._elementType)),super.setup(e)}element(e){return wi(new sde(this,wi(e)))}}const py=(r,e)=>wi(new ade(r,e));class ode extends iy{static get type(){return"ReferenceElementNode"}constructor(e,i){super(e,i),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const i=super.generate(e),n=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(i,n,s)}}class B3 extends en{static get type(){return"ReferenceNode"}constructor(e,i,n=null,s=null){super(),this.property=e,this.uniformType=i,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=cn.OBJECT}element(e){return wi(new ode(this,wi(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let i=null;this.count!==null?i=I3(null,e,this.count):Array.isArray(this.getValueFromReference())?i=py(null,e):e==="texture"?i=Ds(null):e==="cubeTexture"?i=dy(null):i=Jr(null,e),this.group!==null&&i.setGroup(this.group),this.name!==null&&i.label(this.name),this.node=i.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:i}=this;let n=e[i[0]];for(let s=1;s<i.length;s++)n=n[i[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Ms=(r,e,i)=>wi(new B3(r,e,i)),M6=(r,e,i,n)=>wi(new B3(r,e,n,i));class lde extends B3{static get type(){return"MaterialReferenceNode"}constructor(e,i,n=null){super(e,i,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const fd=(r,e,i)=>wi(new lde(r,e,i)),R6=ji(r=>(r.geometry.hasAttribute("tangent")===!1&&r.geometry.computeTangents(),Ju("tangent","vec4")))(),N3=R6.xyz.toVar("tangentLocal"),I6=e_.mul(Kr(N3,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),cde=r=>r.mul(R6.w).xyz,ude=Ku(cde(yc.cross(I6)),"v_bitangentView").normalize().toVar("bitangentView"),fy=bo(I6,ude,yc),hde=(()=>{let r=xg.cross(Ts);return r=r.cross(xg).normalize(),r=fs(r,$s,Dp.mul(qu.oneMinus()).oneMinus().pow2().pow2()).normalize(),r})(),dde=ji(r=>{const{eye_pos:e,surf_norm:i,mapN:n,uv:s}=r,o=e.dFdx(),l=e.dFdy(),u=s.dFdx(),c=s.dFdy(),d=i,p=l.cross(d),f=d.cross(o),m=p.mul(u.x).add(f.mul(c.x)),g=p.mul(u.y).add(f.mul(c.y)),y=m.dot(m).max(g.dot(g)),x=t_.mul(y.inverseSqrt());return _o(m.mul(n.x,x),g.mul(n.y,x),d.mul(n.z)).normalize()});class pde extends Js{static get type(){return"NormalMapNode"}constructor(e,i=null){super("vec3"),this.node=e,this.scaleNode=i,this.normalMapType=td}setup(e){const{normalMapType:i,scaleNode:n}=this;let s=this.node.mul(2).sub(1);n!==null&&(s=Zt(s.xy.mul(n),s.z));let o=null;return i===gle?o=S6(s):i===td&&(e.hasGeometryAttribute("tangent")===!0?o=fy.mul(s).normalize():o=dde({eye_pos:ka,surf_norm:yc,mapN:s,uv:Z1()})),o}}const B6=oi(pde),fde=ji(({textureNode:r,bumpScale:e})=>{const i=s=>r.cache().context({getUV:o=>s(o.uvNode||Z1()),forceUVContext:!0}),n=ei(i(s=>s));return Yi(ei(i(s=>s.add(s.dFdx()))).sub(n),ei(i(s=>s.add(s.dFdy()))).sub(n)).mul(e)}),mde=ji(r=>{const{surf_pos:e,surf_norm:i,dHdxy:n}=r,s=e.dFdx().normalize(),o=e.dFdy().normalize(),l=i,u=o.cross(l),c=l.cross(s),d=s.dot(u).mul(t_),p=d.sign().mul(n.x.mul(u).add(n.y.mul(c)));return d.abs().mul(i).sub(p).normalize()});class gde extends Js{static get type(){return"BumpMapNode"}constructor(e,i=null){super("vec3"),this.textureNode=e,this.scaleNode=i}setup(){const e=this.scaleNode!==null?this.scaleNode:1,i=fde({textureNode:this.textureNode,bumpScale:e});return mde({surf_pos:ka,surf_norm:yc,dHdxy:i})}}const Ade=oi(gde),N6=new Map;class Qt extends en{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,i){let n=N6.get(e);return n===void 0&&(n=fd(e,i),N6.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const i=e.context.material,n=this.scope;let s=null;if(n===Qt.COLOR){const o=i.color!==void 0?this.getColor(n):Zt();i.map&&i.map.isTexture===!0?s=o.mul(this.getTexture("map")):s=o}else if(n===Qt.OPACITY){const o=this.getFloat(n);i.alphaMap&&i.alphaMap.isTexture===!0?s=o.mul(this.getTexture("alpha")):s=o}else if(n===Qt.SPECULAR_STRENGTH)i.specularMap&&i.specularMap.isTexture===!0?s=this.getTexture("specular").r:s=ei(1);else if(n===Qt.SPECULAR_INTENSITY){const o=this.getFloat(n);i.specularMap?s=o.mul(this.getTexture(n).a):s=o}else if(n===Qt.SPECULAR_COLOR){const o=this.getColor(n);i.specularColorMap&&i.specularColorMap.isTexture===!0?s=o.mul(this.getTexture(n).rgb):s=o}else if(n===Qt.ROUGHNESS){const o=this.getFloat(n);i.roughnessMap&&i.roughnessMap.isTexture===!0?s=o.mul(this.getTexture(n).g):s=o}else if(n===Qt.METALNESS){const o=this.getFloat(n);i.metalnessMap&&i.metalnessMap.isTexture===!0?s=o.mul(this.getTexture(n).b):s=o}else if(n===Qt.EMISSIVE){const o=this.getFloat("emissiveIntensity"),l=this.getColor(n).mul(o);i.emissiveMap&&i.emissiveMap.isTexture===!0?s=l.mul(this.getTexture(n)):s=l}else if(n===Qt.NORMAL)i.normalMap?(s=B6(this.getTexture("normal"),this.getCache("normalScale","vec2")),s.normalMapType=i.normalMapType):i.bumpMap?s=Ade(this.getTexture("bump").r,this.getFloat("bumpScale")):s=yc;else if(n===Qt.CLEARCOAT){const o=this.getFloat(n);i.clearcoatMap&&i.clearcoatMap.isTexture===!0?s=o.mul(this.getTexture(n).r):s=o}else if(n===Qt.CLEARCOAT_ROUGHNESS){const o=this.getFloat(n);i.clearcoatRoughnessMap&&i.clearcoatRoughnessMap.isTexture===!0?s=o.mul(this.getTexture(n).r):s=o}else if(n===Qt.CLEARCOAT_NORMAL)i.clearcoatNormalMap?s=B6(this.getTexture(n),this.getCache(n+"Scale","vec2")):s=yc;else if(n===Qt.SHEEN){const o=this.getColor("sheenColor").mul(this.getFloat("sheen"));i.sheenColorMap&&i.sheenColorMap.isTexture===!0?s=o.mul(this.getTexture("sheenColor").rgb):s=o}else if(n===Qt.SHEEN_ROUGHNESS){const o=this.getFloat(n);i.sheenRoughnessMap&&i.sheenRoughnessMap.isTexture===!0?s=o.mul(this.getTexture(n).a):s=o,s=s.clamp(.07,1)}else if(n===Qt.ANISOTROPY)if(i.anisotropyMap&&i.anisotropyMap.isTexture===!0){const o=this.getTexture(n);s=f3(my.x,my.y,my.y.negate(),my.x).mul(o.rg.mul(2).sub(Yi(1)).normalize().mul(o.b))}else s=my;else if(n===Qt.IRIDESCENCE_THICKNESS){const o=Ms("1","float",i.iridescenceThicknessRange);if(i.iridescenceThicknessMap){const l=Ms("0","float",i.iridescenceThicknessRange);s=o.sub(l).mul(this.getTexture(n).g).add(l)}else s=o}else if(n===Qt.TRANSMISSION){const o=this.getFloat(n);i.transmissionMap?s=o.mul(this.getTexture(n).r):s=o}else if(n===Qt.THICKNESS){const o=this.getFloat(n);i.thicknessMap?s=o.mul(this.getTexture(n).g):s=o}else if(n===Qt.IOR)s=this.getFloat(n);else if(n===Qt.LIGHT_MAP)s=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Qt.AO_MAP)s=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const o=this.getNodeType(e);s=this.getCache(n,o)}return s}}Qt.ALPHA_TEST="alphaTest",Qt.COLOR="color",Qt.OPACITY="opacity",Qt.SHININESS="shininess",Qt.SPECULAR="specular",Qt.SPECULAR_STRENGTH="specularStrength",Qt.SPECULAR_INTENSITY="specularIntensity",Qt.SPECULAR_COLOR="specularColor",Qt.REFLECTIVITY="reflectivity",Qt.ROUGHNESS="roughness",Qt.METALNESS="metalness",Qt.NORMAL="normal",Qt.CLEARCOAT="clearcoat",Qt.CLEARCOAT_ROUGHNESS="clearcoatRoughness",Qt.CLEARCOAT_NORMAL="clearcoatNormal",Qt.EMISSIVE="emissive",Qt.ROTATION="rotation",Qt.SHEEN="sheen",Qt.SHEEN_ROUGHNESS="sheenRoughness",Qt.ANISOTROPY="anisotropy",Qt.IRIDESCENCE="iridescence",Qt.IRIDESCENCE_IOR="iridescenceIOR",Qt.IRIDESCENCE_THICKNESS="iridescenceThickness",Qt.IOR="ior",Qt.TRANSMISSION="transmission",Qt.THICKNESS="thickness",Qt.ATTENUATION_DISTANCE="attenuationDistance",Qt.ATTENUATION_COLOR="attenuationColor",Qt.LINE_SCALE="scale",Qt.LINE_DASH_SIZE="dashSize",Qt.LINE_GAP_SIZE="gapSize",Qt.LINE_WIDTH="linewidth",Qt.LINE_DASH_OFFSET="dashOffset",Qt.POINT_WIDTH="pointWidth",Qt.DISPERSION="dispersion",Qt.LIGHT_MAP="light",Qt.AO_MAP="ao";const yde=Xi(Qt,Qt.ALPHA_TEST),vde=Xi(Qt,Qt.COLOR),xde=Xi(Qt,Qt.SHININESS),bde=Xi(Qt,Qt.EMISSIVE),L6=Xi(Qt,Qt.OPACITY),_de=Xi(Qt,Qt.SPECULAR),D6=Xi(Qt,Qt.SPECULAR_INTENSITY),Ede=Xi(Qt,Qt.SPECULAR_COLOR),i_=Xi(Qt,Qt.SPECULAR_STRENGTH),L3=Xi(Qt,Qt.REFLECTIVITY),wde=Xi(Qt,Qt.ROUGHNESS),Cde=Xi(Qt,Qt.METALNESS),Sde=Xi(Qt,Qt.NORMAL).context({getUV:null}),Tde=Xi(Qt,Qt.CLEARCOAT),Mde=Xi(Qt,Qt.CLEARCOAT_ROUGHNESS),Rde=Xi(Qt,Qt.CLEARCOAT_NORMAL).context({getUV:null}),Ide=Xi(Qt,Qt.ROTATION),Bde=Xi(Qt,Qt.SHEEN),Nde=Xi(Qt,Qt.SHEEN_ROUGHNESS),Lde=Xi(Qt,Qt.ANISOTROPY),Dde=Xi(Qt,Qt.IRIDESCENCE),Ode=Xi(Qt,Qt.IRIDESCENCE_IOR),Pde=Xi(Qt,Qt.IRIDESCENCE_THICKNESS),Fde=Xi(Qt,Qt.TRANSMISSION),kde=Xi(Qt,Qt.THICKNESS),Ude=Xi(Qt,Qt.IOR),zde=Xi(Qt,Qt.ATTENUATION_DISTANCE),jde=Xi(Qt,Qt.ATTENUATION_COLOR),Vde=Xi(Qt,Qt.LINE_SCALE),Gde=Xi(Qt,Qt.LINE_DASH_SIZE),Hde=Xi(Qt,Qt.LINE_GAP_SIZE);Qt.LINE_WIDTH,Qt.LINE_DASH_OFFSET,Qt.POINT_WIDTH;const Wde=Xi(Qt,Qt.DISPERSION),O6=Xi(Qt,Qt.LIGHT_MAP),Qde=Xi(Qt,Qt.AO_MAP),my=Jr(new Nn).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))});class qde extends Js{static get type(){return"ModelViewProjectionNode"}constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return Ku(e.context.mvp);const i=this.positionNode||Fa,n=e.renderer.nodes.modelViewMatrix||e_;return $1.mul(n).mul(i)}}const D3=oi(qde);class Ps extends en{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const i=this.getNodeType(e),n=this.scope;let s;if(n===Ps.VERTEX)s=e.getVertexIndex();else if(n===Ps.INSTANCE)s=e.getInstanceIndex();else if(n===Ps.DRAW)s=e.getDrawIndex();else if(n===Ps.INVOCATION_LOCAL)s=e.getInvocationLocalIndex();else if(n===Ps.INVOCATION_SUBGROUP)s=e.getInvocationSubgroupIndex();else if(n===Ps.SUBGROUP)s=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let o;return e.shaderStage==="vertex"||e.shaderStage==="compute"?o=s:o=Ku(this).build(e,i),o}}Ps.VERTEX="vertex",Ps.INSTANCE="instance",Ps.SUBGROUP="subgroup",Ps.INVOCATION_LOCAL="invocationLocal",Ps.INVOCATION_SUBGROUP="invocationSubgroup",Ps.DRAW="draw";const Xde=Xi(Ps,Ps.VERTEX),O3=Xi(Ps,Ps.INSTANCE);Ps.SUBGROUP,Ps.INVOCATION_SUBGROUP,Ps.INVOCATION_LOCAL;const Yde=Xi(Ps,Ps.DRAW);class Kde extends en{static get type(){return"InstanceNode"}constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=cn.FRAME,this.buffer=null,this.bufferColor=null}setup(e){let i=this.instanceMatrixNode,n=this.instanceColorNode;const s=this.instanceMesh;if(i===null){const u=s.instanceMatrix;if(s.count<=1e3)i=I3(u.array,"mat4",Math.max(s.count,1)).element(O3);else{const c=new Oce(u.array,16,1);this.buffer=c;const d=u.usage===Km?v6:y6,p=[d(c,"vec4",16,0),d(c,"vec4",16,4),d(c,"vec4",16,8),d(c,"vec4",16,12)];i=Ag(...p)}this.instanceMatrixNode=i}const o=s.instanceColor;if(o&&n===null){const u=new bce(o.array,3),c=o.usage===Km?v6:y6;this.bufferColor=u,n=Zt(c(u,"vec3",3,0)),this.instanceColorNode=n}const l=i.mul(Fa).xyz;if(Fa.assign(l),e.hasGeometryAttribute("normal")){const u=Zhe(kc,i);kc.assign(u)}this.instanceColorNode!==null&&G1("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMesh.instanceMatrix.usage!==Km&&this.buffer!=null&&this.instanceMesh.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMesh.instanceMatrix.version),this.instanceMesh.instanceColor&&this.instanceMesh.instanceColor.usage!==Km&&this.bufferColor!=null&&this.instanceMesh.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceMesh.instanceColor.version)}}const Jde=oi(Kde);class Zde extends en{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=O3:this.batchingIdNode=Yde);const i=ji(([g])=>{const y=cy(Ac(this.batchMesh._indirectTexture),0),x=Ls(g).modInt(Ls(y)),v=Ls(g).div(Ls(y));return Ac(this.batchMesh._indirectTexture,Qu(x,v)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Ls(this.batchingIdNode)),n=this.batchMesh._matricesTexture,s=cy(Ac(n),0),o=ei(i).mul(4).toInt().toVar(),l=o.modInt(s),u=o.div(Ls(s)),c=Ag(Ac(n,Qu(l,u)),Ac(n,Qu(l.add(1),u)),Ac(n,Qu(l.add(2),u)),Ac(n,Qu(l.add(3),u))),d=this.batchMesh._colorsTexture;if(d!==null){const g=ji(([y])=>{const x=cy(Ac(d),0).x,v=y,_=v.modInt(x),T=v.div(x);return Ac(d,Qu(_,T)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);G1("vec3","vBatchColor").assign(g)}const p=bo(c);Fa.assign(c.mul(Fa));const f=kc.div(Zt(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),m=p.mul(f).xyz;kc.assign(m),e.hasGeometryAttribute("tangent")&&N3.mulAssign(p)}}const $de=oi(Zde),P6=new WeakMap;class epe extends en{static get type(){return"SkinningNode"}constructor(e,i=!1){super("void"),this.skinnedMesh=e,this.useReference=i,this.updateType=cn.OBJECT,this.skinIndexNode=Ju("skinIndex","uvec4"),this.skinWeightNode=Ju("skinWeight","vec4");let n,s,o;i?(n=Ms("bindMatrix","mat4"),s=Ms("bindMatrixInverse","mat4"),o=M6("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(n=Jr(e.bindMatrix,"mat4"),s=Jr(e.bindMatrixInverse,"mat4"),o=I3(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=n,this.bindMatrixInverseNode=s,this.boneMatricesNode=o,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,i=Fa){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:o,bindMatrixInverseNode:l}=this,u=e.element(n.x),c=e.element(n.y),d=e.element(n.z),p=e.element(n.w),f=o.mul(i),m=_o(u.mul(s.x).mul(f),c.mul(s.y).mul(f),d.mul(s.z).mul(f),p.mul(s.w).mul(f));return l.mul(m).xyz}getSkinnedNormal(e=this.boneMatricesNode,i=kc){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:o,bindMatrixInverseNode:l}=this,u=e.element(n.x),c=e.element(n.y),d=e.element(n.z),p=e.element(n.w);let f=_o(s.x.mul(u),s.y.mul(c),s.z.mul(d),s.w.mul(p));return f=l.mul(f).mul(o),f.transformDirection(i).xyz}getPreviousSkinnedPosition(e){const i=e.object;return this.previousBoneMatricesNode===null&&(i.skeleton.previousBoneMatrices=new Float32Array(i.skeleton.boneMatrices),this.previousBoneMatricesNode=M6("skeleton.previousBoneMatrices","mat4",i.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,_6)}needsPreviousBoneMatrices(e){const i=e.renderer.getMRT();return i&&i.has("velocity")}setup(e){this.needsPreviousBoneMatrices(e)&&_6.assign(this.getPreviousSkinnedPosition(e));const i=this.getSkinnedPosition();if(Fa.assign(i),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();kc.assign(n),e.hasGeometryAttribute("tangent")&&N3.assign(n)}}generate(e,i){if(i!=="void")return Fa.build(e,i)}update(e){const i=(this.useReference?e.object:this.skinnedMesh).skeleton;P6.get(i)!==e.frameId&&(P6.set(i,e.frameId),this.previousBoneMatricesNode!==null&&i.previousBoneMatrices.set(i.boneMatrices),i.update())}}const tpe=r=>wi(new epe(r,!0));class ipe extends en{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const i=e.getNodeProperties(this);if(i.stackNode!==void 0)return i;const n={};for(let o=0,l=this.params.length-1;o<l;o++){const u=this.params[o],c=u.isNode!==!0&&u.name||this.getVarName(o),d=u.isNode!==!0&&u.type||"int";n[c]=ly(c,d)}const s=e.addStack();return i.returnsNode=this.params[this.params.length-1](n,s,e),i.stackNode=s,e.removeStack(),i}getNodeType(e){const{returnsNode:i}=this.getProperties(e);return i?i.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const i=this.getProperties(e),n=this.params,s=i.stackNode;for(let u=0,c=n.length-1;u<c;u++){const d=n[u];let p=null,f=null,m=null,g=null,y=null,x=null;d.isNode?(g="int",m=this.getVarName(u),p="0",f=d.build(e,g),y="<"):(g=d.type||"int",m=d.name||this.getVarName(u),p=d.start,f=d.end,y=d.condition,x=d.update,typeof p=="number"?p=e.generateConst(g,p):p&&p.isNode&&(p=p.build(e,g)),typeof f=="number"?f=e.generateConst(g,f):f&&f.isNode&&(f=f.build(e,g)),p!==void 0&&f===void 0?(p=p+" - 1",f="0",y=">="):f!==void 0&&p===void 0&&(p="0",y="<"),y===void 0&&(Number(p)>Number(f)?y=">=":y="<"));const v={start:p,end:f},_=v.start,T=v.end;let w="",S="",R="";x||(g==="int"||g==="uint"?y.includes("<")?x="++":x="--":y.includes("<")?x="+= 1.":x="-= 1."),w+=e.getVar(g,m)+" = "+_,S+=m+" "+y+" "+T,R+=m+" "+x;const B=`for ( ${w}; ${S}; ${R} )`;e.addFlowCode((u===0?`
`:"")+e.tab+B+` {

`).addFlowTab()}const o=s.build(e,"void"),l=i.returnsNode?i.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+o);for(let u=0,c=this.params.length-1;u<c;u++)e.addFlowCode((u===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),l}}const Uc=(...r)=>wi(new ipe(gg(r,"int"))).append(),rpe=()=>ly("break").append(),P3=new WeakMap,fl=new Kn,F6=ji(({bufferMap:r,influence:e,stride:i,width:n,depth:s,offset:o})=>{const l=Ls(Xde).mul(i).add(o),u=l.div(n),c=l.sub(u.mul(n));return Ac(r,Qu(c,u)).depth(s).mul(e)});function npe(r){const e=r.morphAttributes.position!==void 0,i=r.morphAttributes.normal!==void 0,n=r.morphAttributes.color!==void 0,s=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,o=s!==void 0?s.length:0;let l=P3.get(r);if(l===void 0||l.count!==o){let u=function(){v.dispose(),P3.delete(r),r.removeEventListener("dispose",u)};l!==void 0&&l.texture.dispose();const c=r.morphAttributes.position||[],d=r.morphAttributes.normal||[],p=r.morphAttributes.color||[];let f=0;e===!0&&(f=1),i===!0&&(f=2),n===!0&&(f=3);let m=r.attributes.position.count*f,g=1;const y=4096;m>y&&(g=Math.ceil(m/y),m=y);const x=new Float32Array(m*g*4*o),v=new tce(x,m,g,o);v.type=ll,v.needsUpdate=!0;const _=f*4;for(let T=0;T<o;T++){const w=c[T],S=d[T],R=p[T],B=m*g*4*T;for(let I=0;I<w.count;I++){const D=I*_;e===!0&&(fl.fromBufferAttribute(w,I),x[B+D+0]=fl.x,x[B+D+1]=fl.y,x[B+D+2]=fl.z,x[B+D+3]=0),i===!0&&(fl.fromBufferAttribute(S,I),x[B+D+4]=fl.x,x[B+D+5]=fl.y,x[B+D+6]=fl.z,x[B+D+7]=0),n===!0&&(fl.fromBufferAttribute(R,I),x[B+D+8]=fl.x,x[B+D+9]=fl.y,x[B+D+10]=fl.z,x[B+D+11]=R.itemSize===4?fl.w:1)}}l={count:o,texture:v,stride:f,size:new Nn(m,g)},P3.set(r,l),r.addEventListener("dispose",u)}return l}class spe extends en{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Jr(1),this.updateType=cn.OBJECT}setup(e){const{geometry:i}=e,n=i.morphAttributes.position!==void 0,s=i.hasAttribute("normal")&&i.morphAttributes.normal!==void 0,o=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,l=o!==void 0?o.length:0,{texture:u,stride:c,size:d}=npe(i);n===!0&&Fa.mulAssign(this.morphBaseInfluence),s===!0&&kc.mulAssign(this.morphBaseInfluence);const p=Ls(d.width);Uc(l,({i:f})=>{const m=ei(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?m.assign(Ac(this.mesh.morphTexture,Qu(Ls(f).add(1),Ls(O3))).r):m.assign(Ms("morphTargetInfluences","float").element(f).toVar()),n===!0&&Fa.addAssign(F6({bufferMap:u,influence:m,stride:c,width:p,depth:f,offset:Ls(0)})),s===!0&&kc.addAssign(F6({bufferMap:u,influence:m,stride:c,width:p,depth:f,offset:Ls(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((i,n)=>i+n,0)}}const ape=oi(spe);class _g extends en{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}generate(){console.warn("Abstract function.")}}class ope extends _g{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class lpe extends f6{static get type(){return"LightingContextNode"}constructor(e,i=null,n=null,s=null){super(e),this.lightingModel=i,this.backdropNode=n,this.backdropAlphaNode=s,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:i}=this,n=Zt().toVar("directDiffuse"),s=Zt().toVar("directSpecular"),o=Zt().toVar("indirectDiffuse"),l=Zt().toVar("indirectSpecular"),u={directDiffuse:n,directSpecular:s,indirectDiffuse:o,indirectSpecular:l};return{radiance:Zt().toVar("radiance"),irradiance:Zt().toVar("irradiance"),iblIrradiance:Zt().toVar("iblIrradiance"),ambientOcclusion:ei(1).toVar("ambientOcclusion"),reflectedLight:u,backdrop:e,backdropAlpha:i}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const cpe=oi(lpe);class upe extends _g{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let gy,Ay;class ea extends en{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===ea.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=cn.NONE;return(this.scope===ea.SIZE||this.scope===ea.VIEWPORT)&&(e=cn.RENDER),this.updateType=e,e}update({renderer:e}){const i=e.getRenderTarget();this.scope===ea.VIEWPORT?i!==null?Ay.copy(i.viewport):(e.getViewport(Ay),Ay.multiplyScalar(e.getPixelRatio())):i!==null?(gy.width=i.width,gy.height=i.height):e.getDrawingBufferSize(gy)}setup(){const e=this.scope;let i=null;return e===ea.SIZE?i=Jr(gy||(gy=new Nn)):e===ea.VIEWPORT?i=Jr(Ay||(Ay=new Kn)):i=Yi(k3.div(F3)),i}generate(e){if(this.scope===ea.COORDINATE){let i=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(F3).outputNode.build(e);i=`${e.getType("vec2")}( ${i}.x, ${n}.y - ${i}.y )`}return i}return super.generate(e)}}ea.COORDINATE="coordinate",ea.VIEWPORT="viewport",ea.SIZE="size",ea.UV="uv";const yy=Xi(ea,ea.UV),F3=Xi(ea,ea.SIZE),k3=Xi(ea,ea.COORDINATE),k6=Xi(ea,ea.VIEWPORT);k6.zw,k6.xy;const vy=new Nn;class U6 extends uy{static get type(){return"ViewportTextureNode"}constructor(e=yy,i=null,n=null){n===null&&(n=new wce,n.minFilter=Lu),super(n,e,i),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=cn.FRAME}updateBefore(e){const i=e.renderer;i.getDrawingBufferSize(vy);const n=this.value;(n.image.width!==vy.width||n.image.height!==vy.height)&&(n.image.width=vy.width,n.image.height=vy.height,n.needsUpdate=!0);const s=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,i.copyFramebufferToTexture(n),n.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const z6=oi(U6,null,null,{generateMipmaps:!0});let U3=null;class hpe extends U6{static get type(){return"ViewportDepthTextureNode"}constructor(e=yy,i=null){U3===null&&(U3=new dg),super(e,i,U3)}}const dpe=oi(hpe);class Ho extends en{static get type(){return"ViewportDepthNode"}constructor(e,i=null){super("float"),this.scope=e,this.valueNode=i,this.isViewportDepthNode=!0}generate(e){const{scope:i}=this;return i===Ho.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:i}=this,n=this.valueNode;let s=null;if(i===Ho.DEPTH_BASE)n!==null&&(s=G6().assign(n));else if(i===Ho.DEPTH)e.isPerspectiveCamera?s=ppe(ka.z,Fp,kp):s=xy(ka.z,Fp,kp);else if(i===Ho.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const o=j6(n,Fp,kp);s=xy(o,Fp,kp)}else s=n;else s=xy(ka.z,Fp,kp);return s}}Ho.DEPTH_BASE="depthBase",Ho.DEPTH="depth",Ho.LINEAR_DEPTH="linearDepth";const xy=(r,e,i)=>r.add(e).div(e.sub(i)),ppe=(r,e,i)=>e.add(r).mul(i).div(i.sub(e).mul(r)),j6=(r,e,i)=>e.mul(i).div(i.sub(e).mul(r).sub(i)),V6=(r,e,i)=>{e=e.max(1e-6).toVar();const n=Xu(r.div(e).add(1)),s=Xu(i.div(e).add(1));return n.div(s)},G6=oi(Ho,Ho.DEPTH_BASE),H6=Xi(Ho,Ho.DEPTH);Ho.LINEAR_DEPTH,dpe(),H6.assign=r=>G6(r);class md extends en{static get type(){return"ClippingNode"}constructor(e=md.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const i=e.clippingContext,{localClipIntersection:n,localClippingCount:s,globalClippingCount:o}=i,l=o+s,u=n?l-s:l;return this.scope===md.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i.planes,l,u):this.setupDefault(i.planes,l,u)}setupAlphaToCoverage(e,i,n){return ji(()=>{const s=py(e),o=yg("float","distanceToPlane"),l=yg("float","distanceToGradient"),u=yg("float","clipOpacity");u.assign(1);let c;if(Uc(n,({i:d})=>{c=s.element(d),o.assign(ka.dot(c.xyz).negate().add(c.w)),l.assign(o.fwidth().div(2)),u.mulAssign(Pp(l.negate(),l,o)),u.equal(0).discard()}),n<i){const d=yg("float","unionclipOpacity");d.assign(1),Uc({start:n,end:i},({i:p})=>{c=s.element(p),o.assign(ka.dot(c.xyz).negate().add(c.w)),l.assign(o.fwidth().div(2)),d.mulAssign(Pp(l.negate(),l,o).oneMinus())}),u.mulAssign(d.oneMinus())}Wn.a.mulAssign(u),Wn.a.equal(0).discard()})()}setupDefault(e,i,n){return ji(()=>{const s=py(e);let o;if(Uc(n,({i:l})=>{o=s.element(l),ka.dot(o.xyz).greaterThan(o.w).discard()}),n<i){const l=yg("bool","clipped");l.assign(!0),Uc({start:n,end:i},({i:u})=>{o=s.element(u),l.assign(ka.dot(o.xyz).greaterThan(o.w).and(l))}),l.discard()}})()}}md.ALPHA_TO_COVERAGE="alphaToCoverage",md.DEFAULT="default";const fpe=()=>wi(new md),mpe=()=>wi(new md(md.ALPHA_TO_COVERAGE)),gpe=.05,W6=ji(([r])=>hd(yn(1e4,mc(yn(17,r.x).add(yn(.1,r.y)))).mul(_o(.1,gc(mc(yn(13,r.y).add(r.x))))))),Q6=ji(([r])=>W6(Yi(W6(r.xy),r.z))),Ape=ji(([r])=>{const e=Bl(pd(o6(r.xyz)),pd(l6(r.xyz))).toVar("maxDeriv"),i=ei(1).div(ei(gpe).mul(e)).toVar("pixScale"),n=Yi(ny(Op(Xu(i))),ny(E3(Xu(i)))).toVar("pixScales"),s=Yi(Q6(Op(n.x.mul(r.xyz))),Q6(Op(n.y.mul(r.xyz)))).toVar("alpha"),o=hd(Xu(i)).toVar("lerpFactor"),l=_o(yn(o.oneMinus(),s.x),yn(o,s.y)).toVar("x"),u=ay(o,o.oneMinus()).toVar("a"),c=Zt(l.mul(l).div(yn(2,u).mul(pl(1,u))),l.sub(yn(.5,u)).div(pl(1,u)),pl(1,pl(1,l).mul(pl(1,l)).div(yn(2,u).mul(pl(1,u))))).toVar("cases"),d=l.lessThan(u.oneMinus()).select(l.lessThan(u).select(c.x,c.y),c.z);return Yu(d,1e-6,1)});class ta extends Vo{static get type(){return"NodeMaterial"}constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+I5(this)}build(e){this.setup(e)}setupObserver(e){return new Fce(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let i;const n=this.setupClipping(e);if(this.depthWrite===!0&&this.setupDepth(e),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const s=this.setupLighting(e);n!==null&&e.stack.add(n);const o=Kr(s,Wn.a).max(0);if(i=this.setupOutput(e,o),bue.assign(i),this.outputNode!==null&&(i=this.outputNode),e.renderer.getRenderTarget()!==null){const l=e.renderer.getMRT(),u=this.mrtNode;l!==null?(i=l,u!==null&&(i=l.merge(u))):u!==null&&(i=u)}}else{let s=this.fragmentNode;s.isOutputStructNode!==!0&&(s=Kr(s)),i=this.setupOutput(e,s)}e.stack.outputNode=i,e.addFlow("fragment",e.removeStack()),e.monitor=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{globalClippingCount:i,localClippingCount:n}=e.clippingContext;let s=null;if(i||n){const o=e.renderer.samples;this.alphaToCoverage&&o>1?s=mpe():e.stack.add(fpe())}return s}setupDepth(e){const{renderer:i,camera:n}=e;let s=this.depthNode;if(s===null){const o=i.getMRT();o&&o.has("depth")?s=o.get("depth"):i.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?s=V6(D3().w,Fp,kp):s=xy(ka.z,Fp,kp))}s!==null&&H6.assign(s).append()}setupPosition(e){const{object:i}=e,n=i.geometry;if(e.addStack(),(n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&ape(i).append(),i.isSkinnedMesh===!0&&tpe(i).append(),this.displacementMap){const o=fd("displacementMap","texture"),l=fd("displacementScale","float"),u=fd("displacementBias","float");Fa.addAssign(kc.normalize().mul(o.x.mul(l).add(u)))}i.isBatchedMesh&&$de(i).append(),i.instanceMatrix&&i.instanceMatrix.isInstancedBufferAttribute===!0&&Jde(i).append(),this.positionNode!==null&&Fa.assign(this.positionNode);const s=D3();return e.context.vertex=e.removeStack(),e.context.mvp=s,s}setupDiffuseColor({object:e,geometry:i}){let n=this.colorNode?Kr(this.colorNode):vde;this.vertexColors===!0&&i.hasAttribute("color")&&(n=Kr(n.xyz.mul(Ju("color","vec3")),n.a)),e.instanceColor&&(n=G1("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=G1("vec3","vBatchColor").mul(n)),Wn.assign(n);const s=this.opacityNode?ei(this.opacityNode):L6;if(Wn.a.assign(Wn.a.mul(s)),this.alphaTestNode!==null||this.alphaTest>0){const o=this.alphaTestNode!==null?ei(this.alphaTestNode):yde;Wn.a.lessThanEqual(o).discard()}this.alphaHash===!0&&Wn.a.lessThan(Ape(Fa)).discard(),this.transparent===!1&&this.blending===Zh&&this.alphaToCoverage===!1&&Wn.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Zt(0):Wn.rgb}setupNormal(){return this.normalNode?Zt(this.normalNode):Sde}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?fd("envMap","cubeTexture"):fd("envMap","texture")),e}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new upe(O6)),i}setupLights(e){const i=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&i.push(n);const s=this.setupLightMap(e);if(s&&s.isLightingNode&&i.push(s),this.aoNode!==null||e.material.aoMap){const l=this.aoNode!==null?this.aoNode:Qde;i.push(new ope(l))}let o=this.lightsNode||e.lightsNode;return i.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...i])),o}setupLightingModel(){}setupLighting(e){const{material:i}=e,{backdropNode:n,backdropAlphaNode:s,emissiveNode:o}=this,l=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let u=this.setupOutgoingLight(e);if(l&&l.getScope().hasLights){const c=this.setupLightingModel(e);u=cpe(l,c,n,s)}else n!==null&&(u=Zt(s!==null?fs(u,n,s):n));return(o&&o.isNode===!0||i.emissive&&i.emissive.isColor===!0)&&(X5.assign(Zt(o||bde)),u=u.add(X5)),u}setupOutput(e,i){if(this.fog===!0){const n=e.fogNode;n&&(i=Kr(n.mix(i.rgb,n.colorNode),i.a))}return i}setDefaultValues(e){for(const n in e){const s=e[n];this[n]===void 0&&(this[n]=s,s&&s.clone&&(this[n]=s.clone()))}const i=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in i)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&i[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,i[n])}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});const n=Vo.prototype.toJSON.call(this,e),s=P1(this);n.inputNodes={};for(const{property:l,childNode:u}of s)n.inputNodes[l]=u.toJSON(e).uuid;function o(l){const u=[];for(const c in l){const d=l[c];delete d.metadata,u.push(d)}return u}if(i){const l=o(e.textures),u=o(e.images),c=o(e.nodes);l.length>0&&(n.textures=l),u.length>0&&(n.images=u),c.length>0&&(n.nodes=c)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.shadowPositionNode=e.shadowPositionNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const ype=new t3;class vpe extends ta{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(ype),this.setValues(e)}}const xpe=new w5;class bpe extends ta{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.setDefaultValues(xpe),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,i=this.dashScaleNode?ei(this.dashScaleNode):Vde,n=this.dashSizeNode?ei(this.dashSizeNode):Gde,s=this.dashSizeNode?ei(this.dashGapNode):Hde;x3.assign(n),J5.assign(s);const o=Ku(Ju("lineDistance").mul(i));(e?o.add(e):o).mod(x3.add(J5)).greaterThan(x3).discard()}}const _pe=r=>wi(r).mul(.5).add(.5),Epe=new b5;class wpe extends ta{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Epe),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?ei(this.opacityNode):L6;Wn.assign(Kr(_pe($s),e))}}class Cpe extends Js{static get type(){return"EquirectUVNode"}constructor(e=E6){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,i=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Yi(i,n)}}const q6=oi(Cpe);class X6 extends vce{constructor(e=1,i={}){super(e,i),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,i){const n=i.minFilter,s=i.generateMipmaps;i.generateMipmaps=!0,this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const o=new $A(5,5,5),l=q6(E6),u=new ta;u.colorNode=Ds(i,l,0),u.side=lc,u.blending=Vm;const c=new Bp(o,u),d=new d5;d.add(c),i.minFilter===Lu&&(i.minFilter=ol);const p=new h5(1,10,this),f=e.getMRT();return e.setMRT(null),p.update(e,d),e.setMRT(f),i.minFilter=n,i.currentGenerateMipmaps=s,c.geometry.dispose(),c.material.dispose(),this}}const by=new WeakMap;class Spe extends Js{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=dy();const i=new ZM;i.isRenderTargetTexture=!0,this._defaultTexture=i,this.updateBeforeType=cn.RENDER}updateBefore(e){const{renderer:i,material:n}=e,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const o=s.isTextureNode?s.value:n[s.property];if(o&&o.isTexture){const l=o.mapping;if(l===FA||l===kA){if(by.has(o)){const u=by.get(o);K6(u,o.mapping),this._cubeTexture=u}else{const u=o.image;if(Tpe(u)){const c=new X6(u.height);c.fromEquirectangularTexture(i,o),K6(c.texture,o.mapping),this._cubeTexture=c.texture,by.set(o,c.texture),o.addEventListener("dispose",Y6)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function Tpe(r){return r==null?!1:r.height>0}function Y6(r){const e=r.target;e.removeEventListener("dispose",Y6);const i=by.get(e);i!==void 0&&(by.delete(e),i.dispose())}function K6(r,e){e===FA?r.mapping=_p:e===kA&&(r.mapping=Hm)}const J6=oi(Spe);class z3 extends _g{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=J6(this.envNode)}}class Mpe extends _g{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const i=ei(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(i)}}class r_{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class Z6 extends r_{constructor(){super()}indirect(e,i,n){const s=e.ambientOcclusion,o=e.reflectedLight,l=n.context.irradianceLightMap;o.indirectDiffuse.assign(Kr(0)),l?o.indirectDiffuse.addAssign(l):o.indirectDiffuse.addAssign(Kr(1,1,1,0)),o.indirectDiffuse.mulAssign(s),o.indirectDiffuse.mulAssign(Wn.rgb)}finish(e,i,n){const s=n.material,o=e.outgoingLight,l=n.context.environment;if(l)switch(s.combine){case c1:o.rgb.assign(fs(o.rgb,o.rgb.mul(l.rgb),i_.mul(L3)));break;case tle:o.rgb.assign(fs(o.rgb,l.rgb,i_.mul(L3)));break;case ile:o.rgb.addAssign(l.rgb.mul(i_.mul(L3)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",s.combine);break}}}const Rpe=new w1;class Ipe extends ta{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Rpe),this.setValues(e)}setupNormal(){return yc}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new z3(i):null}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new Mpe(O6)),i}setupOutgoingLight(){return Wn.rgb}setupLightingModel(){return new Z6}}const _y=ji(({f0:r,f90:e,dotVH:i})=>{const n=i.mul(-5.55473).sub(6.98316).mul(i).exp2();return r.mul(n.oneMinus()).add(e.mul(n))}),Eg=ji(r=>r.diffuseColor.mul(1/Math.PI)),Bpe=()=>ei(.25),Npe=ji(({dotNH:r})=>v3.mul(ei(.5)).add(1).mul(ei(1/Math.PI)).mul(r.pow(v3))),Lpe=ji(({lightDirection:r})=>{const e=r.add(Ts).normalize(),i=$s.dot(e).clamp(),n=Ts.dot(e).clamp(),s=_y({f0:dl,f90:1,dotVH:n}),o=Bpe(),l=Npe({dotNH:i});return s.mul(o).mul(l)});class $6 extends Z6{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:i,reflectedLight:n}){const s=$s.dot(e).clamp().mul(i);n.directDiffuse.addAssign(s.mul(Eg({diffuseColor:Wn.rgb}))),this.specular===!0&&n.directSpecular.addAssign(s.mul(Lpe({lightDirection:e})).mul(i_))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:n}){n.indirectDiffuse.addAssign(i.mul(Eg({diffuseColor:Wn}))),n.indirectDiffuse.mulAssign(e)}}const Dpe=new _5;class Ope extends ta{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Dpe),this.setValues(e)}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new z3(i):null}setupLightingModel(){return new $6(!1)}}const Ppe=new v5;class Fpe extends ta{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Ppe),this.setValues(e)}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new z3(i):null}setupLightingModel(){return new $6}setupVariants(){const e=(this.shininessNode?ei(this.shininessNode):xde).max(1e-4);v3.assign(e);const i=this.specularNode||_de;dl.assign(i)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const kpe=ji(r=>{if(r.geometry.hasAttribute("normal")===!1)return ei(0);const e=yc.dFdx().abs().max(yc.dFdy().abs());return e.x.max(e.y).max(e.z)}),e8=ji(r=>{const{roughness:e}=r,i=kpe();let n=e.max(.0525);return n=n.add(i),n=n.min(1),n}),Upe=ji(({alpha:r,dotNL:e,dotNV:i})=>{const n=r.pow2(),s=e.mul(n.add(n.oneMinus().mul(i.pow2())).sqrt()),o=i.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return ud(.5,s.add(o).max(zue))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),zpe=ji(({alphaT:r,alphaB:e,dotTV:i,dotBV:n,dotTL:s,dotBL:o,dotNV:l,dotNL:u})=>{const c=u.mul(Zt(r.mul(i),e.mul(n),l).length()),d=l.mul(Zt(r.mul(s),e.mul(o),u).length());return ud(.5,c.add(d)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),jpe=ji(({alpha:r,dotNH:e})=>{const i=r.pow2(),n=e.pow2().mul(i.oneMinus()).oneMinus();return i.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Vpe=ei(1/Math.PI),Gpe=ji(({alphaT:r,alphaB:e,dotNH:i,dotTH:n,dotBH:s})=>{const o=r.mul(e),l=Zt(e.mul(n),r.mul(s),o.mul(i)),u=l.dot(l),c=o.div(u);return Vpe.mul(o.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),t8=ji(r=>{const{lightDirection:e,f0:i,f90:n,roughness:s,f:o,USE_IRIDESCENCE:l,USE_ANISOTROPY:u}=r,c=r.normalView||$s,d=s.pow2(),p=e.add(Ts).normalize(),f=c.dot(e).clamp(),m=c.dot(Ts).clamp(),g=c.dot(p).clamp(),y=Ts.dot(p).clamp();let x=_y({f0:i,f90:n,dotVH:y}),v,_;if(G5(l)&&(x=A3.mix(x,o)),G5(u)){const T=Q1.dot(e),w=Q1.dot(Ts),S=Q1.dot(p),R=xg.dot(e),B=xg.dot(Ts),I=xg.dot(p);v=zpe({alphaT:y3,alphaB:d,dotTV:w,dotBV:B,dotTL:T,dotBL:R,dotNV:m,dotNL:f}),_=Gpe({alphaT:y3,alphaB:d,dotNH:g,dotTH:S,dotBH:I})}else v=Upe({alpha:d,dotNL:f,dotNV:m}),_=jpe({alpha:d,dotNH:g});return x.mul(v).mul(_)}),i8=ji(({roughness:r,dotNV:e})=>{const i=Kr(-1,-.0275,-.572,.022),n=Kr(1,.0425,1.04,-.04),s=r.mul(i).add(n),o=s.x.mul(s.x).min(e.mul(-9.28).exp2()).mul(s.x).add(s.y);return Yi(-1.04,1.04).mul(o).add(s.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),r8=ji(r=>{const{dotNV:e,specularColor:i,specularF90:n,roughness:s}=r,o=i8({dotNV:e,roughness:s});return i.mul(o.x).add(n.mul(o.y))}),Hpe=ji(({f:r,f90:e,dotVH:i})=>{const n=i.oneMinus().saturate(),s=n.mul(n),o=n.mul(s,s).clamp(0,.9999);return r.sub(Zt(e).mul(o)).div(o.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Wpe=ji(({roughness:r,dotNH:e})=>{const i=r.pow2(),n=ei(1).div(i),s=e.pow2().oneMinus().max(.0078125);return ei(2).add(n).mul(s.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Qpe=ji(({dotNV:r,dotNL:e})=>ei(1).div(ei(4).mul(e.add(r).sub(e.mul(r))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),qpe=ji(({lightDirection:r})=>{const e=r.add(Ts).normalize(),i=$s.dot(r).clamp(),n=$s.dot(Ts).clamp(),s=$s.dot(e).clamp(),o=Wpe({roughness:g3,dotNH:s}),l=Qpe({dotNV:n,dotNL:i});return vg.mul(o).mul(l)}),Xpe=ji(({N:r,V:e,roughness:i})=>{const n=.0078125,s=r.dot(e).saturate(),o=Yi(i,s.oneMinus().sqrt());return o.assign(o.mul(.984375).add(n)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),Ype=ji(({f:r})=>{const e=r.length();return Bl(e.mul(e).add(r.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),n_=ji(({v1:r,v2:e})=>{const i=r.dot(e),n=i.abs().toVar(),s=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),o=n.add(4.1616724).mul(n).add(3.417594).toVar(),l=s.div(o),u=i.greaterThan(0).select(l,Bl(i.mul(i).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(l));return r.cross(e).mul(u)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),n8=ji(({N:r,V:e,P:i,mInv:n,p0:s,p1:o,p2:l,p3:u})=>{const c=o.sub(s).toVar(),d=u.sub(s).toVar(),p=c.cross(d),f=Zt().toVar();return Pa(p.dot(i.sub(s)).greaterThanEqual(0),()=>{const m=e.sub(r.mul(e.dot(r))).normalize(),g=r.cross(m).negate(),y=n.mul(bo(m,g,r).transpose()).toVar(),x=y.mul(s.sub(i)).normalize().toVar(),v=y.mul(o.sub(i)).normalize().toVar(),_=y.mul(l.sub(i)).normalize().toVar(),T=y.mul(u.sub(i)).normalize().toVar(),w=Zt(0).toVar();w.addAssign(n_({v1:x,v2:v})),w.addAssign(n_({v1:v,v2:_})),w.addAssign(n_({v1:_,v2:T})),w.addAssign(n_({v1:T,v2:x})),f.assign(Zt(Ype({f:w})))}),f}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),s_=1/6,s8=r=>yn(s_,yn(r,yn(r,r.negate().add(3)).sub(3)).add(1)),j3=r=>yn(s_,yn(r,yn(r,yn(3,r).sub(6))).add(4)),a8=r=>yn(s_,yn(r,yn(r,yn(-3,r).add(3)).add(3)).add(1)),V3=r=>yn(s_,Y1(r,3)),o8=r=>s8(r).add(j3(r)),l8=r=>a8(r).add(V3(r)),c8=r=>_o(-1,j3(r).div(s8(r).add(j3(r)))),u8=r=>_o(1,V3(r).div(a8(r).add(V3(r)))),h8=(r,e,i)=>{const n=r.uvNode,s=yn(n,e.zw).add(.5),o=Op(s),l=hd(s),u=o8(l.x),c=l8(l.x),d=c8(l.x),p=u8(l.x),f=c8(l.y),m=u8(l.y),g=Yi(o.x.add(d),o.y.add(f)).sub(.5).mul(e.xy),y=Yi(o.x.add(p),o.y.add(f)).sub(.5).mul(e.xy),x=Yi(o.x.add(d),o.y.add(m)).sub(.5).mul(e.xy),v=Yi(o.x.add(p),o.y.add(m)).sub(.5).mul(e.xy),_=o8(l.y).mul(_o(u.mul(r.uv(g).level(i)),c.mul(r.uv(y).level(i)))),T=l8(l.y).mul(_o(u.mul(r.uv(x).level(i)),c.mul(r.uv(v).level(i))));return _.add(T)},Kpe=ji(([r,e=ei(3)])=>{const i=Yi(r.size(Ls(e))),n=Yi(r.size(Ls(e.add(1)))),s=ud(1,i),o=ud(1,n),l=h8(r,Kr(s,i),Op(e)),u=h8(r,Kr(o,n),E3(e));return hd(e).mix(l,u)}),d8=ji(([r,e,i,n,s])=>{const o=Zt(p6(e.negate(),sy(r),ud(1,n))),l=Zt(pd(s[0].xyz),pd(s[1].xyz),pd(s[2].xyz));return sy(o).mul(i.mul(l))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Jpe=ji(([r,e])=>r.mul(Yu(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Zpe=z6(),$pe=z6(),p8=ji(([r,e,i],{material:n})=>{const s=(n.side==lc?Zpe:$pe).uv(r),o=Xu(F3.x).mul(Jpe(e,i));return Kpe(s,o)}),f8=ji(([r,e,i])=>(Pa(i.notEqual(0),()=>{const n=s6(e).negate().div(i);return n6(n.negate().mul(r))}),Zt(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),efe=ji(([r,e,i,n,s,o,l,u,c,d,p,f,m,g,y])=>{let x,v;if(y){x=Kr().toVar(),v=Zt().toVar();const R=p.sub(1).mul(y.mul(.025)),B=Zt(p.sub(R),p,p.add(R));Uc({start:0,end:3},({i:I})=>{const D=B.element(I),L=d8(r,e,f,D,u),O=l.add(L),U=d.mul(c.mul(Kr(O,1))),J=Yi(U.xy.div(U.w)).toVar();J.addAssign(1),J.divAssign(2),J.assign(Yi(J.x,J.y.oneMinus()));const H=p8(J,i,D);x.element(I).assign(H.element(I)),x.a.addAssign(H.a),v.element(I).assign(n.element(I).mul(f8(pd(L),m,g).element(I)))}),x.a.divAssign(3)}else{const R=d8(r,e,f,p,u),B=l.add(R),I=d.mul(c.mul(Kr(B,1))),D=Yi(I.xy.div(I.w)).toVar();D.addAssign(1),D.divAssign(2),D.assign(Yi(D.x,D.y.oneMinus())),x=p8(D,i,p),v=n.mul(f8(pd(R),m,g))}const _=v.rgb.mul(x.rgb),T=r.dot(e).clamp(),w=Zt(r8({dotNV:T,specularColor:s,specularF90:o,roughness:i})),S=v.r.add(v.g,v.b).div(3);return Kr(w.oneMinus().mul(_),x.a.oneMinus().mul(S).oneMinus())}),tfe=bo(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),ife=r=>{const e=r.sqrt();return Zt(1).add(e).div(Zt(1).sub(e))},m8=(r,e)=>r.sub(e).div(r.add(e)).pow2(),rfe=(r,e)=>{const i=r.mul(2*Math.PI*1e-9),n=Zt(54856e-17,44201e-17,52481e-17),s=Zt(1681e3,1795300,2208400),o=Zt(43278e5,93046e5,66121e5),l=ei(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(i.mul(2239900).add(e.x).cos()).mul(i.pow2().mul(-45282e5).exp());let u=n.mul(o.mul(2*Math.PI).sqrt()).mul(s.mul(i).add(e).cos()).mul(i.pow2().negate().mul(o).exp());return u=Zt(u.x.add(l),u.y,u.z).div(10685e-11),tfe.mul(u)},nfe=ji(({outsideIOR:r,eta2:e,cosTheta1:i,thinFilmThickness:n,baseF0:s})=>{const o=fs(r,e,Pp(0,.03,n)),l=r.div(o).pow2().mul(i.pow2().oneMinus()).oneMinus();Pa(l.lessThan(0),()=>Zt(1));const u=l.sqrt(),c=m8(o,r),d=_y({f0:c,f90:1,dotVH:i}),p=d.oneMinus(),f=o.lessThan(r).select(Math.PI,0),m=ei(Math.PI).sub(f),g=ife(s.clamp(0,.9999)),y=m8(g,o.toVec3()),x=_y({f0:y,f90:1,dotVH:u}),v=Zt(g.x.lessThan(o).select(Math.PI,0),g.y.lessThan(o).select(Math.PI,0),g.z.lessThan(o).select(Math.PI,0)),_=o.mul(n,u,2),T=Zt(m).add(v),w=d.mul(x).clamp(1e-5,.9999),S=w.sqrt(),R=p.pow2().mul(x).div(Zt(1).sub(w)),B=d.add(R).toVar(),I=R.sub(p).toVar();return Uc({start:1,end:2,condition:"<=",name:"m"},({m:D})=>{I.mulAssign(S);const L=rfe(ei(D).mul(_),ei(D).mul(T)).mul(2);B.addAssign(I.mul(L))}),B.max(Zt(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),sfe=ji(({normal:r,viewDir:e,roughness:i})=>{const n=r.dot(e).saturate(),s=i.pow2(),o=Go(i.lessThan(.25),ei(-339.2).mul(s).add(ei(161.4).mul(i)).sub(25.9),ei(-8.48).mul(s).add(ei(14.3).mul(i)).sub(9.95)),l=Go(i.lessThan(.25),ei(44).mul(s).sub(ei(23.7).mul(i)).add(3.26),ei(1.97).mul(s).sub(ei(3.27).mul(i)).add(.72));return Go(i.lessThan(.25),0,ei(.1).mul(i).sub(.025)).add(o.mul(n).add(l).exp()).mul(1/Math.PI).saturate()}),G3=Zt(.04),H3=ei(1);class g8 extends r_{constructor(e=!1,i=!1,n=!1,s=!1,o=!1,l=!1){super(),this.clearcoat=e,this.sheen=i,this.iridescence=n,this.anisotropy=s,this.transmission=o,this.dispersion=l,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Zt().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Zt().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Zt().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Zt().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Zt().toVar("sheenSpecularIndirect")),this.iridescence===!0){const i=$s.dot(Ts).clamp();this.iridescenceFresnel=nfe({outsideIOR:ei(1),eta2:Y5,cosTheta1:i,thinFilmThickness:K5,baseF0:dl}),this.iridescenceF0=Hpe({f:this.iridescenceFresnel,f90:1,dotVH:i})}if(this.transmission===!0){const i=M3,n=qhe.sub(M3).normalize(),s=R3;e.backdrop=efe(s,n,qu,Wn,dl,q1,i,Up,Zu,$1,X1,Z5,e6,$5,this.dispersion?t6:null),e.backdropAlpha=b3,Wn.a.mulAssign(fs(1,e.backdrop.a,b3))}}computeMultiscattering(e,i,n){const s=$s.dot(Ts).clamp(),o=i8({roughness:qu,dotNV:s}),l=(this.iridescenceF0?A3.mix(dl,this.iridescenceF0):dl).mul(o.x).add(n.mul(o.y)),u=o.x.add(o.y).oneMinus(),c=dl.add(dl.oneMinus().mul(.047619)),d=l.mul(c).div(u.mul(c).oneMinus());e.addAssign(l),i.addAssign(d.mul(u))}direct({lightDirection:e,lightColor:i,reflectedLight:n}){const s=$s.dot(e).clamp().mul(i);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(qpe({lightDirection:e}))),this.clearcoat===!0){const o=hy.dot(e).clamp().mul(i);this.clearcoatSpecularDirect.addAssign(o.mul(t8({lightDirection:e,f0:G3,f90:H3,roughness:W1,normalView:hy})))}n.directDiffuse.addAssign(s.mul(Eg({diffuseColor:Wn.rgb}))),n.directSpecular.addAssign(s.mul(t8({lightDirection:e,f0:dl,f90:1,roughness:qu,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:i,halfWidth:n,halfHeight:s,reflectedLight:o,ltc_1:l,ltc_2:u}){const c=i.add(n).sub(s),d=i.sub(n).sub(s),p=i.sub(n).add(s),f=i.add(n).add(s),m=$s,g=Ts,y=ka.toVar(),x=Xpe({N:m,V:g,roughness:qu}),v=l.uv(x).toVar(),_=u.uv(x).toVar(),T=bo(Zt(v.x,0,v.y),Zt(0,1,0),Zt(v.z,0,v.w)).toVar(),w=dl.mul(_.x).add(dl.oneMinus().mul(_.y)).toVar();o.directSpecular.addAssign(e.mul(w).mul(n8({N:m,V:g,P:y,mInv:T,p0:c,p1:d,p2:p,p3:f}))),o.directDiffuse.addAssign(e.mul(Wn).mul(n8({N:m,V:g,P:y,mInv:bo(1,0,0,0,1,0,0,0,1),p0:c,p1:d,p2:p,p3:f})))}indirect(e,i,n){this.indirectDiffuse(e,i,n),this.indirectSpecular(e,i,n),this.ambientOcclusion(e,i,n)}indirectDiffuse({irradiance:e,reflectedLight:i}){i.indirectDiffuse.addAssign(e.mul(Eg({diffuseColor:Wn})))}indirectSpecular({radiance:e,iblIrradiance:i,reflectedLight:n}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(i.mul(vg,sfe({normal:$s,viewDir:Ts,roughness:g3}))),this.clearcoat===!0){const d=hy.dot(Ts).clamp(),p=r8({dotNV:d,specularColor:G3,specularF90:H3,roughness:W1});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(p))}const s=Zt().toVar("singleScattering"),o=Zt().toVar("multiScattering"),l=i.mul(1/Math.PI);this.computeMultiscattering(s,o,q1);const u=s.add(o),c=Wn.mul(u.r.max(u.g).max(u.b).oneMinus());n.indirectSpecular.addAssign(e.mul(s)),n.indirectSpecular.addAssign(o.mul(l)),n.indirectDiffuse.addAssign(c.mul(l))}ambientOcclusion({ambientOcclusion:e,reflectedLight:i}){const n=$s.dot(Ts).clamp().add(e),s=qu.mul(-16).oneMinus().negate().exp2(),o=e.sub(n.pow(s).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),i.indirectDiffuse.mulAssign(e),i.indirectSpecular.mulAssign(o)}finish(e){const{outgoingLight:i}=e;if(this.clearcoat===!0){const n=hy.dot(Ts).clamp(),s=_y({dotVH:n,f0:G3,f90:H3}),o=i.mul(m3.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(m3));i.assign(o)}if(this.sheen===!0){const n=vg.r.max(vg.g).max(vg.b).mul(.157).oneMinus(),s=i.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);i.assign(s)}}}const A8=ei(1),W3=ei(-2),a_=ei(.8),Q3=ei(-1),o_=ei(.4),q3=ei(2),l_=ei(.305),X3=ei(3),y8=ei(.21),afe=ei(4),v8=ei(4),ofe=ei(16),lfe=ji(([r])=>{const e=Zt(gc(r)).toVar(),i=ei(-1).toVar();return Pa(e.x.greaterThan(e.z),()=>{Pa(e.x.greaterThan(e.y),()=>{i.assign(Go(r.x.greaterThan(0),0,3))}).Else(()=>{i.assign(Go(r.y.greaterThan(0),1,4))})}).Else(()=>{Pa(e.z.greaterThan(e.y),()=>{i.assign(Go(r.z.greaterThan(0),2,5))}).Else(()=>{i.assign(Go(r.y.greaterThan(0),1,4))})}),i}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),cfe=ji(([r,e])=>{const i=Yi().toVar();return Pa(e.equal(0),()=>{i.assign(Yi(r.z,r.y).div(gc(r.x)))}).ElseIf(e.equal(1),()=>{i.assign(Yi(r.x.negate(),r.z.negate()).div(gc(r.y)))}).ElseIf(e.equal(2),()=>{i.assign(Yi(r.x.negate(),r.y).div(gc(r.z)))}).ElseIf(e.equal(3),()=>{i.assign(Yi(r.z.negate(),r.y).div(gc(r.x)))}).ElseIf(e.equal(4),()=>{i.assign(Yi(r.x.negate(),r.z).div(gc(r.y)))}).Else(()=>{i.assign(Yi(r.x,r.y).div(gc(r.z)))}),yn(.5,i.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),ufe=ji(([r])=>{const e=ei(0).toVar();return Pa(r.greaterThanEqual(a_),()=>{e.assign(A8.sub(r).mul(Q3.sub(W3)).div(A8.sub(a_)).add(W3))}).ElseIf(r.greaterThanEqual(o_),()=>{e.assign(a_.sub(r).mul(q3.sub(Q3)).div(a_.sub(o_)).add(Q3))}).ElseIf(r.greaterThanEqual(l_),()=>{e.assign(o_.sub(r).mul(X3.sub(q3)).div(o_.sub(l_)).add(q3))}).ElseIf(r.greaterThanEqual(y8),()=>{e.assign(l_.sub(r).mul(afe.sub(X3)).div(l_.sub(y8)).add(X3))}).Else(()=>{e.assign(ei(-2).mul(Xu(yn(1.16,r))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),hfe=ji(([r,e])=>{const i=r.toVar();i.assign(yn(2,i).sub(1));const n=Zt(i,1).toVar();return Pa(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),dfe=ji(([r,e,i,n,s,o])=>{const l=ei(i),u=Zt(e),c=Yu(ufe(l),W3,o),d=hd(c),p=Op(c),f=Zt(Y3(r,u,p,n,s,o)).toVar();return Pa(d.notEqual(0),()=>{const m=Zt(Y3(r,u,p.add(1),n,s,o)).toVar();f.assign(fs(f,m,d))}),f}),Y3=ji(([r,e,i,n,s,o])=>{const l=ei(i).toVar(),u=Zt(e),c=ei(lfe(u)).toVar(),d=ei(Bl(v8.sub(l),0)).toVar();l.assign(Bl(l,v8));const p=ei(ny(l)).toVar(),f=Yi(cfe(u,c).mul(p.sub(2)).add(1)).toVar();return Pa(c.greaterThan(2),()=>{f.y.addAssign(p),c.subAssign(3)}),f.x.addAssign(c.mul(p)),f.x.addAssign(d.mul(yn(3,ofe))),f.y.addAssign(yn(4,ny(o).sub(p))),f.x.mulAssign(n),f.y.mulAssign(s),r.uv(f).grad(Yi(),Yi())}),K3=ji(({envMap:r,mipInt:e,outputDirection:i,theta:n,axis:s,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:u})=>{const c=dd(n),d=i.mul(c).add(s.cross(i).mul(mc(n))).add(s.mul(s.dot(i).mul(c.oneMinus())));return Y3(r,d,e,o,l,u)}),pfe=ji(({n:r,latitudinal:e,poleAxis:i,outputDirection:n,weights:s,samples:o,dTheta:l,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f})=>{const m=Zt(Go(e,i,h6(i,n))).toVar();Pa(r6(m.equals(Zt(0))),()=>{m.assign(Zt(n.z,0,n.x.negate()))}),m.assign(sy(m));const g=Zt().toVar();return g.addAssign(s.element(Ls(0)).mul(K3({theta:0,axis:m,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f}))),Uc({start:Ls(1),end:r},({i:y})=>{Pa(y.greaterThanEqual(o),()=>{rpe()});const x=ei(l.mul(ei(y))).toVar();g.addAssign(s.element(y).mul(K3({theta:x.mul(-1),axis:m,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f}))),g.addAssign(s.element(y).mul(K3({theta:x,axis:m,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f})))}),Kr(g,1)});let c_=null;const x8=new WeakMap;function ffe(r){const e=Math.log2(r)-2,i=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function mfe(r){let e=x8.get(r);if((e!==void 0?e.pmremVersion:-1)!==r.pmremVersion){const i=r.image;if(r.isCubeTexture)if(Afe(i))e=c_.fromCubemap(r,e);else return null;else if(yfe(i))e=c_.fromEquirectangular(r,e);else return null;e.pmremVersion=r.pmremVersion,x8.set(r,e)}return e.texture}class gfe extends Js{static get type(){return"PMREMNode"}constructor(e,i=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=i,this.levelNode=n,this._generator=null;const s=new vo;s.isRenderTargetTexture=!0,this._texture=Ds(s),this._width=Jr(0),this._height=Jr(0),this._maxMip=Jr(0),this.updateBeforeType=cn.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const i=ffe(e.image.height);this._texture.value=e,this._width.value=i.texelWidth,this._height.value=i.texelHeight,this._maxMip.value=i.maxMip}updateBefore(){let e=this._pmrem;const i=e?e.pmremVersion:-1,n=this._value;i!==n.pmremVersion&&(n.isPMREMTexture===!0?e=n:e=mfe(n),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(e){c_===null&&(c_=e.createPMREMGenerator()),this.updateBefore(e);let i=this.uvNode;i===null&&e.context.getUV&&(i=e.context.getUV(this));const n=this.value;e.renderer.coordinateSystem===cc&&n.isPMREMTexture!==!0&&n.isRenderTargetTexture===!0&&(i=Zt(i.x.negate(),i.yz));let s=this.levelNode;return s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),dfe(this._texture,i,s,this._width,this._height,this._maxMip)}}function Afe(r){if(r==null)return!1;let e=0;const i=6;for(let n=0;n<i;n++)r[n]!==void 0&&e++;return e===i}function yfe(r){return r==null?!1:r.height>0}const b8=oi(gfe),_8=new WeakMap;class vfe extends _g{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:i}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const f=n.isTextureNode?n.value:i[n.property];let m=_8.get(f);m===void 0&&(m=b8(f),_8.set(f,m)),n=m}const s=i.envMap?Ms("envMapIntensity","float",e.material):Ms("environmentIntensity","float",e.scene),o=i.useAnisotropy===!0||i.anisotropy>0?hde:$s,l=n.context(E8(qu,o)).mul(s),u=n.context(xfe(R3)).mul(Math.PI).mul(s),c=J1(l),d=J1(u);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(d);const p=e.context.lightingModel.clearcoatRadiance;if(p){const f=n.context(E8(W1,hy)).mul(s),m=J1(f);p.addAssign(m)}}}const E8=(r,e)=>{let i=null;return{getUV:()=>(i===null&&(i=Ts.negate().reflect(e),i=r.mul(r).mix(i,e).normalize(),i=i.transformDirection(Zu)),i),getTextureLevel:()=>r}},xfe=r=>({getUV:()=>r,getTextureLevel:()=>ei(1)}),bfe=new r3;class w8 extends ta{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(bfe),this.setValues(e)}setupEnvironment(e){let i=super.setupEnvironment(e);return i===null&&e.environmentNode&&(i=e.environmentNode),i?new vfe(i):null}setupLightingModel(){return new g8}setupSpecular(){const e=fs(Zt(.04),Wn.rgb,H1);dl.assign(e),q1.assign(1)}setupVariants(){const e=this.metalnessNode?ei(this.metalnessNode):Cde;H1.assign(e);let i=this.roughnessNode?ei(this.roughnessNode):wde;i=e8({roughness:i}),qu.assign(i),this.setupSpecular(),Wn.assign(Kr(Wn.rgb.mul(e.oneMinus()),Wn.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const _fe=new y5;class Efe extends w8{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(_fe),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?ei(this.iorNode):Ude;X1.assign(e),dl.assign(fs(ay(d6(X1.sub(1).div(X1.add(1))).mul(Ede),Zt(1)).mul(D6),Wn.rgb,H1)),q1.assign(fs(D6,1,H1))}setupLightingModel(){return new g8(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const i=this.clearcoatNode?ei(this.clearcoatNode):Tde,n=this.clearcoatRoughnessNode?ei(this.clearcoatRoughnessNode):Mde;m3.assign(i),W1.assign(e8({roughness:n}))}if(this.useSheen){const i=this.sheenNode?Zt(this.sheenNode):Bde,n=this.sheenRoughnessNode?ei(this.sheenRoughnessNode):Nde;vg.assign(i),g3.assign(n)}if(this.useIridescence){const i=this.iridescenceNode?ei(this.iridescenceNode):Dde,n=this.iridescenceIORNode?ei(this.iridescenceIORNode):Ode,s=this.iridescenceThicknessNode?ei(this.iridescenceThicknessNode):Pde;A3.assign(i),Y5.assign(n),K5.assign(s)}if(this.useAnisotropy){const i=(this.anisotropyNode?Yi(this.anisotropyNode):Lde).toVar();Dp.assign(i.length()),Pa(Dp.equal(0),()=>{i.assign(Yi(1,0))}).Else(()=>{i.divAssign(Yi(Dp)),Dp.assign(Dp.saturate())}),y3.assign(Dp.pow2().mix(qu.pow2(),1)),Q1.assign(fy[0].mul(i.x).add(fy[1].mul(i.y))),xg.assign(fy[1].mul(i.x).sub(fy[0].mul(i.y)))}if(this.useTransmission){const i=this.transmissionNode?ei(this.transmissionNode):Fde,n=this.thicknessNode?ei(this.thicknessNode):kde,s=this.attenuationDistanceNode?ei(this.attenuationDistanceNode):zde,o=this.attenuationColorNode?Zt(this.attenuationColorNode):jde;if(b3.assign(i),Z5.assign(n),$5.assign(s),e6.assign(o),this.useDispersion){const l=this.dispersionNode?ei(this.dispersionNode):Wde;t6.assign(l)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Zt(this.clearcoatNormalNode):Rde}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const wfe=ji(({normal:r,lightDirection:e,builder:i})=>{const n=r.dot(e),s=Yi(n.mul(.5).add(.5),0);if(i.material.gradientMap){const o=fd("gradientMap","texture").context({getUV:()=>s});return Zt(o.r)}else{const o=s.fwidth().mul(.5);return fs(Zt(.7),Zt(1),Pp(ei(.7).sub(o.x),ei(.7).add(o.x),s.x))}});class Cfe extends r_{direct({lightDirection:e,lightColor:i,reflectedLight:n},s,o){const l=wfe({normal:w6,lightDirection:e,builder:o}).mul(i);n.directDiffuse.addAssign(l.mul(Eg({diffuseColor:Wn.rgb})))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:n}){n.indirectDiffuse.addAssign(i.mul(Eg({diffuseColor:Wn}))),n.indirectDiffuse.mulAssign(e)}}const Sfe=new x5;class Tfe extends ta{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Sfe),this.setValues(e)}setupLightingModel(){return new Cfe}}class Mfe extends Js{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=Zt(Ts.z,0,Ts.x.negate()).normalize(),i=Ts.cross(e);return Yi(e.dot($s),i.dot($s)).mul(.495).add(.5)}}const Rfe=Xi(Mfe),Ife=new E5;class Bfe extends ta{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(Ife),this.setValues(e)}setupVariants(e){const i=Rfe;let n;e.material.matcap?n=fd("matcap","texture").context({getUV:()=>i}):n=Zt(fs(.2,.8,i.y)),Wn.rgb.mulAssign(n.rgb)}}const Nfe=new g5;class Lfe extends ta{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(Nfe),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}class Dfe extends Js{static get type(){return"RotateNode"}constructor(e,i){super(),this.positionNode=e,this.rotationNode=i}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:i,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const s=i.cos(),o=i.sin();return f3(s,o,o.negate(),s).mul(n)}else{const s=i,o=Ag(Kr(1,0,0,0),Kr(0,dd(s.x),mc(s.x).negate(),0),Kr(0,mc(s.x),dd(s.x),0),Kr(0,0,0,1)),l=Ag(Kr(dd(s.y),0,mc(s.y),0),Kr(0,1,0,0),Kr(mc(s.y).negate(),0,dd(s.y),0),Kr(0,0,0,1)),u=Ag(Kr(dd(s.z),mc(s.z).negate(),0,0),Kr(mc(s.z),dd(s.z),0,0),Kr(0,0,1,0),Kr(0,0,0,1));return o.mul(l).mul(u).mul(Kr(n,1)).xyz}}}const Ofe=oi(Dfe),Pfe=new f5;class Ffe extends ta{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(Pfe),this.setValues(e)}setupPosition({object:e,camera:i,context:n}){const s=this.sizeAttenuation,{positionNode:o,rotationNode:l,scaleNode:u}=this,c=Fa;let d=e_.mul(Zt(o||0)),p=Yi(Up[0].xyz.length(),Up[1].xyz.length());if(u!==null&&(p=p.mul(u)),!s)if(i.isPerspectiveCamera)p=p.mul(d.z.negate());else{const x=ei(2).div($1.element(1).element(1));p=p.mul(x.mul(2))}let f=c.xy;if(e.center&&e.center.isVector2===!0){const x=Mhe("center","vec2");f=f.sub(x.sub(.5))}f=f.mul(p);const m=ei(l||Ide),g=Ofe(f,m);d=Kr(d.xy.add(g),d.zw);const y=$1.mul(d);return n.vertex=c,y}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class kfe extends r_{constructor(){super(),this.shadowNode=ei(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){Wn.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Wn.rgb)}}const Ufe=new A5;class zfe extends ta{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Ufe),this.setValues(e)}setupLightingModel(){return new kfe}}ji(({texture:r,uv:e})=>{const i=Zt().toVar();return Pa(e.x.lessThan(1e-4),()=>{i.assign(Zt(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{i.assign(Zt(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{i.assign(Zt(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{i.assign(Zt(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{i.assign(Zt(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{i.assign(Zt(0,0,-1))}).Else(()=>{const n=r.uv(e.add(Zt(-.01,0,0))).r.sub(r.uv(e.add(Zt(.01,0,0))).r),s=r.uv(e.add(Zt(0,-.01,0))).r.sub(r.uv(e.add(Zt(0,.01,0))).r),o=r.uv(e.add(Zt(0,0,-.01))).r.sub(r.uv(e.add(Zt(0,0,.01))).r);i.assign(Zt(n,s,o))}),i.normalize()});class jfe{constructor(e,i){this.nodes=e,this.info=i,this.animationLoop=null,this.requestId=null,this._init()}_init(){const e=(i,n)=>{this.requestId=self.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.animationLoop!==null&&this.animationLoop(i,n)};e()}dispose(){self.cancelAnimationFrame(this.requestId),this.requestId=null}setAnimationLoop(e){this.animationLoop=e}}class zc{constructor(){this.weakMap=new WeakMap}get(e){let i=this.weakMap;for(let n=0;n<e.length;n++)if(i=i.get(e[n]),i===void 0)return;return i.get(e[e.length-1])}set(e,i){let n=this.weakMap;for(let s=0;s<e.length;s++){const o=e[s];n.has(o)===!1&&n.set(o,new WeakMap),n=n.get(o)}return n.set(e[e.length-1],i)}delete(e){let i=this.weakMap;for(let n=0;n<e.length;n++)if(i=i.get(e[n]),i===void 0)return!1;return i.delete(e[e.length-1])}}const J3=new cd;class Z3{constructor(){this.version=0,this.globalClippingCount=0,this.localClippingCount=0,this.localClippingEnabled=!1,this.localClipIntersection=!1,this.planes=[],this.parentVersion=0,this.viewNormalMatrix=new jo,this.cacheKey=0}projectPlanes(e,i){const n=e.length,s=this.planes;for(let o=0;o<n;o++){J3.copy(e[o]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const l=s[i+o],u=J3.normal;l.x=-u.x,l.y=-u.y,l.z=-u.z,l.w=J3.constant}}updateGlobal(e,i){const n=e.clippingPlanes;this.viewMatrix=i.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix);let s=!1;if(Array.isArray(n)&&n.length!==0){const o=n.length;if(o!==this.globalClippingCount){const l=[];for(let u=0;u<o;u++)l.push(new Kn);this.globalClippingCount=o,this.planes=l,s=!0}this.projectPlanes(n,0)}else this.globalClippingCount!==0&&(this.globalClippingCount=0,this.planes=[],s=!0);e.localClippingEnabled!==this.localClippingEnabled&&(this.localClippingEnabled=e.localClippingEnabled,s=!0),s&&(this.version++,this.cacheKey=O1(this.globalClippingCount,this.localClippingEnabled===!0?1:0))}update(e,i){let n=!1;if(this!==e&&e.version!==this.parentVersion&&(this.globalClippingCount=i.isShadowNodeMaterial?0:e.globalClippingCount,this.localClippingEnabled=e.localClippingEnabled,this.planes=Array.from(e.planes),this.parentVersion=e.version,this.viewMatrix=e.viewMatrix,this.viewNormalMatrix=e.viewNormalMatrix,n=!0),this.localClippingEnabled){const s=i.clippingPlanes;if(Array.isArray(s)&&s.length!==0){const o=s.length,l=this.planes,u=this.globalClippingCount;if(n||o!==this.localClippingCount){l.length=u+o;for(let c=0;c<o;c++)l[u+c]=new Kn;this.localClippingCount=o,n=!0}this.projectPlanes(s,u)}else this.localClippingCount!==0&&(this.localClippingCount=0,n=!0);this.localClipIntersection!==i.clipIntersection&&(this.localClipIntersection=i.clipIntersection,n=!0)}n&&(this.version+=e.version,this.cacheKey=O1(e.cacheKey,this.localClippingCount,this.localClipIntersection===!0?1:0))}}let Vfe=0;function Gfe(r){const e=Object.keys(r);let i=Object.getPrototypeOf(r);for(;i;){const n=Object.getOwnPropertyDescriptors(i);for(const s in n)if(n[s]!==void 0){const o=n[s];o&&typeof o.get=="function"&&e.push(s)}i=Object.getPrototypeOf(i)}return e}class Hfe{constructor(e,i,n,s,o,l,u,c,d){this._nodes=e,this._geometries=i,this.id=Vfe++,this.renderer=n,this.object=s,this.material=o,this.scene=l,this.camera=u,this.lightsNode=c,this.context=d,this.geometry=s.geometry,this.version=o.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.updateClipping(d.clippingContext),this.clippingContextVersion=this.clippingContext.version,this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){const i=this.material;let n=this.clippingContext;Array.isArray(i.clippingPlanes)?((n===e||!n)&&(n=new Z3,this.clippingContext=n),n.update(e,i)):this.clippingContext!==e&&(this.clippingContext=e)}get clippingNeedsUpdate(){return this.clippingContext.version===this.clippingContextVersion?!1:(this.clippingContextVersion=this.clippingContext.version,!0)}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().monitor)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,i=this.geometry,n=[],s=new Set;for(const o of e){const l=o.node&&o.node.attribute?o.node.attribute:i.getAttribute(o.name);if(l===void 0)continue;n.push(l);const u=l.isInterleavedBufferAttribute?l.data:l;s.add(u)}return this.attributes=n,this.vertexBuffers=Array.from(s.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:i,geometry:n,group:s,drawRange:o}=this,l=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),u=this.getIndex(),c=u!==null,d=n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1;if(d===0)return null;if(l.instanceCount=d,e.isBatchedMesh===!0)return l;let p=1;i.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(p=2);let f=o.start*p,m=(o.start+o.count)*p;s!==null&&(f=Math.max(f,s.start*p),m=Math.min(m,(s.start+s.count)*p));const g=n.attributes.position;let y=1/0;c?y=u.count:g!=null&&(y=g.count),f=Math.max(f,0),m=Math.min(m,y);const x=m-f;return x<0||x===1/0?null:(l.vertexCount=x,l.firstVertex=f,l)}getGeometryCacheKey(){const{geometry:e}=this;let i="";for(const n of Object.keys(e.attributes).sort()){const s=e.attributes[n];i+=n+",",s.data&&(i+=s.data.stride+","),s.offset&&(i+=s.offset+","),s.itemSize&&(i+=s.itemSize+","),s.normalized&&(i+="n,")}return e.index&&(i+="index,"),i}getMaterialCacheKey(){const{object:e,material:i}=this;let n=i.customProgramCacheKey();for(const s of Gfe(i)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const o=i[s];let l;if(o!==null){const u=typeof o;u==="number"?l=o!==0?"1":"0":u==="object"?(l="{",o.isTexture&&(l+=o.mapping),l+="}"):l=String(o)}else l=String(o);n+=l+","}return n+=this.clippingContext.cacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.morphTargetInfluences&&(n+=e.morphTargetInfluences.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),kce(n)}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=this._nodes.getCacheKey(this.scene,this.lightsNode);return this.object.receiveShadow&&(e+=1),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const wg=[];class Wfe{constructor(e,i,n,s,o,l){this.renderer=e,this.nodes=i,this.geometries=n,this.pipelines=s,this.bindings=o,this.info=l,this.chainMaps={}}get(e,i,n,s,o,l,u){const c=this.getChainMap(u);wg[0]=e,wg[1]=i,wg[2]=l,wg[3]=o;let d=c.get(wg);return d===void 0?(d=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,i,n,s,o,l,u),c.set(wg,d)):(d.updateClipping(l.clippingContext),(d.version!==i.version||d.needsUpdate)&&(d.initialCacheKey!==d.getCacheKey()?(d.dispose(),d=this.get(e,i,n,s,o,l,u)):d.version=i.version)),d}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new zc)}dispose(){this.chainMaps={}}createRenderObject(e,i,n,s,o,l,u,c,d,p){const f=this.getChainMap(p),m=new Hfe(e,i,n,s,o,l,u,c,d);return m.onDispose=()=>{this.pipelines.delete(m),this.bindings.delete(m),this.nodes.delete(m),f.delete(m.getChainArray())},m}}class gd{constructor(){this.data=new WeakMap}get(e){let i=this.data.get(e);return i===void 0&&(i={},this.data.set(e,i)),i}delete(e){let i;return this.data.has(e)&&(i=this.data.get(e),this.data.delete(e)),i}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const jc={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Ad=16,Qfe=211,qfe=212;class Xfe extends gd{constructor(e){super(),this.backend=e}delete(e){const i=super.delete(e);return i!==void 0&&this.backend.destroyAttribute(e),i}update(e,i){const n=this.get(e);if(n.version===void 0)i===jc.VERTEX?this.backend.createAttribute(e):i===jc.INDEX?this.backend.createIndexAttribute(e):i===jc.STORAGE?this.backend.createStorageAttribute(e):i===jc.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const s=this._getBufferAttribute(e);(n.version<s.version||s.usage===Km)&&(this.backend.updateAttribute(e),n.version=s.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function Yfe(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function C8(r){return r.index!==null?r.index.version:r.attributes.position.version}function S8(r){const e=[],i=r.index,n=r.attributes.position;if(i!==null){const o=i.array;for(let l=0,u=o.length;l<u;l+=3){const c=o[l+0],d=o[l+1],p=o[l+2];e.push(c,d,d,p,p,c)}}else{const o=n.array;for(let l=0,u=o.length/3-1;l<u;l+=3){const c=l+0,d=l+1,p=l+2;e.push(c,d,d,p,p,c)}}const s=new(Yfe(e)?i5:t5)(e,1);return s.version=C8(r),s}class Kfe extends gd{constructor(e,i){super(),this.attributes=e,this.info=i,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const i=e.geometry;return super.has(i)&&this.get(i).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const i=e.geometry,n=this.get(i);n.initialized=!0,this.info.memory.geometries++;const s=()=>{this.info.memory.geometries--;const o=i.index,l=e.getAttributes();o!==null&&this.attributes.delete(o);for(const c of l)this.attributes.delete(c);const u=this.wireframes.get(i);u!==void 0&&this.attributes.delete(u),i.removeEventListener("dispose",s)};i.addEventListener("dispose",s)}updateAttributes(e){const i=e.getAttributes();for(const o of i)o.isStorageBufferAttribute||o.isStorageInstancedBufferAttribute?this.updateAttribute(o,jc.STORAGE):this.updateAttribute(o,jc.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,jc.INDEX);const s=e.geometry.indirect;s!==null&&this.updateAttribute(s,jc.INDIRECT)}updateAttribute(e,i){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,i),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,i),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,i),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:i,material:n}=e;let s=i.index;if(n.wireframe===!0){const o=this.wireframes;let l=o.get(i);l===void 0?(l=S8(i),o.set(i,l)):l.version!==C8(i)&&(this.attributes.delete(l),l=S8(i),o.set(i,l)),s=l}return s}}class Jfe{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.compute={calls:0,frameCalls:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.memory={geometries:0,textures:0}}update(e,i,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(i/3):e.isPoints?this.render.points+=n*i:e.isLineSegments?this.render.lines+=n*(i/2):e.isLine?this.render.lines+=n*(i-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(e,i){this[e].timestampCalls===0&&(this[e].timestamp=0),this[e].timestamp+=i,this[e].timestampCalls++,this[e].timestampCalls>=this[e].previousFrameCalls&&(this[e].timestampCalls=0)}reset(){const e=this.render.frameCalls;this.render.previousFrameCalls=e;const i=this.compute.frameCalls;this.compute.previousFrameCalls=i,this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class T8{constructor(e){this.cacheKey=e,this.usedTimes=0}}class Zfe extends T8{constructor(e,i,n){super(e),this.vertexProgram=i,this.fragmentProgram=n}}class $fe extends T8{constructor(e,i){super(e),this.computeProgram=i,this.isComputePipeline=!0}}let eme=0;class $3{constructor(e,i,n=null,s=null){this.id=eme++,this.code=e,this.stage=i,this.transforms=n,this.attributes=s,this.usedTimes=0}}class tme extends gd{constructor(e,i){super(),this.backend=e,this.nodes=i,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,i){const{backend:n}=this,s=this.get(e);if(this._needsComputeUpdate(e)){const o=s.pipeline;o&&(o.usedTimes--,o.computeProgram.usedTimes--);const l=this.nodes.getForCompute(e);let u=this.programs.compute.get(l.computeShader);u===void 0&&(o&&o.computeProgram.usedTimes===0&&this._releaseProgram(o.computeProgram),u=new $3(l.computeShader,"compute",l.transforms,l.nodeAttributes),this.programs.compute.set(l.computeShader,u),n.createProgram(u));const c=this._getComputeCacheKey(e,u);let d=this.caches.get(c);d===void 0&&(o&&o.usedTimes===0&&this._releasePipeline(o),d=this._getComputePipeline(e,u,c,i)),d.usedTimes++,u.usedTimes++,s.version=e.version,s.pipeline=d}return s.pipeline}getForRender(e,i=null){const{backend:n}=this,s=this.get(e);if(this._needsRenderUpdate(e)){const o=s.pipeline;o&&(o.usedTimes--,o.vertexProgram.usedTimes--,o.fragmentProgram.usedTimes--);const l=e.getNodeBuilderState();let u=this.programs.vertex.get(l.vertexShader);u===void 0&&(o&&o.vertexProgram.usedTimes===0&&this._releaseProgram(o.vertexProgram),u=new $3(l.vertexShader,"vertex"),this.programs.vertex.set(l.vertexShader,u),n.createProgram(u));let c=this.programs.fragment.get(l.fragmentShader);c===void 0&&(o&&o.fragmentProgram.usedTimes===0&&this._releaseProgram(o.fragmentProgram),c=new $3(l.fragmentShader,"fragment"),this.programs.fragment.set(l.fragmentShader,c),n.createProgram(c));const d=this._getRenderCacheKey(e,u,c);let p=this.caches.get(d);p===void 0?(o&&o.usedTimes===0&&this._releasePipeline(o),p=this._getRenderPipeline(e,u,c,d,i)):e.pipeline=p,p.usedTimes++,u.usedTimes++,c.usedTimes++,s.pipeline=p}return s.pipeline}delete(e){const i=this.get(e).pipeline;return i&&(i.usedTimes--,i.usedTimes===0&&this._releasePipeline(i),i.isComputePipeline?(i.computeProgram.usedTimes--,i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram)):(i.fragmentProgram.usedTimes--,i.vertexProgram.usedTimes--,i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,i,n,s){n=n||this._getComputeCacheKey(e,i);let o=this.caches.get(n);return o===void 0&&(o=new $fe(n,i),this.caches.set(n,o),this.backend.createComputePipeline(o,s)),o}_getRenderPipeline(e,i,n,s,o){s=s||this._getRenderCacheKey(e,i,n);let l=this.caches.get(s);return l===void 0&&(l=new Zfe(s,i,n),this.caches.set(s,l),e.pipeline=l,this.backend.createRenderPipeline(e,o)),l}_getComputeCacheKey(e,i){return e.id+","+i.id}_getRenderCacheKey(e,i,n){return i.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const i=e.code,n=e.stage;this.programs[n].delete(i)}_needsComputeUpdate(e){const i=this.get(e);return i.pipeline===void 0||i.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class ime extends gd{constructor(e,i,n,s,o,l){super(),this.backend=e,this.textures=n,this.pipelines=o,this.attributes=s,this.nodes=i,this.info=l,this.pipelines.bindings=this}getForRender(e){const i=e.getBindings();for(const n of i){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,i),s.bindGroup=n)}return i}getForCompute(e){const i=this.nodes.getForCompute(e).bindings;for(const n of i){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,i),s.bindGroup=n)}return i}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const i of e)this._update(i,e)}_init(e){for(const i of e.bindings)if(i.isSampledTexture)this.textures.updateTexture(i.texture);else if(i.isStorageBuffer){const n=i.attribute,s=n.isIndirectStorageBufferAttribute?jc.INDIRECT:jc.STORAGE;this.attributes.update(n,s)}}_update(e,i){const{backend:n}=this;let s=!1;for(const o of e.bindings)if(!(o.isNodeUniformsGroup&&!this.nodes.updateGroup(o))){if(o.isUniformBuffer)o.update()&&n.updateBinding(o);else if(o.isSampler)o.update();else if(o.isSampledTexture){o.needsBindingsUpdate(this.textures.get(o.texture).generation)&&(s=!0);const l=o.update(),u=o.texture;l&&this.textures.updateTexture(u);const c=n.get(u);if(n.isWebGPUBackend===!0&&c.texture===void 0&&c.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",o,l,u,o.textureNode.value,s),this.textures.updateTexture(u),s=!0),u.isStorageTexture===!0){const d=this.get(u);o.store===!0?d.needsMipmap=!0:this.textures.needsMipmaps(u)&&d.needsMipmap===!0&&(this.backend.generateMipmaps(u),d.needsMipmap=!1)}}}s===!0&&this.backend.updateBindings(e,i)}}function rme(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function M8(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function R8(r){return(r.transmission>0||r.transmissionNode)&&r.side===jm&&r.forceSinglePass===!1}class nme{constructor(e,i,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(i,n),this.lightsArray=[],this.scene=i,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,i,n,s,o,l){let u=this.renderItems[this.renderItemsIndex];return u===void 0?(u={id:e.id,object:e,geometry:i,material:n,groupOrder:s,renderOrder:e.renderOrder,z:o,group:l},this.renderItems[this.renderItemsIndex]=u):(u.id=e.id,u.object=e,u.geometry=i,u.material=n,u.groupOrder=s,u.renderOrder=e.renderOrder,u.z=o,u.group=l),this.renderItemsIndex++,u}push(e,i,n,s,o,l){const u=this.getNextRenderItem(e,i,n,s,o,l);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0?(R8(n)&&this.transparentDoublePass.push(u),this.transparent.push(u)):this.opaque.push(u)}unshift(e,i,n,s,o,l){const u=this.getNextRenderItem(e,i,n,s,o,l);n.transparent===!0||n.transmission>0?(R8(n)&&this.transparentDoublePass.unshift(u),this.transparent.unshift(u)):this.opaque.unshift(u)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,i){this.opaque.length>1&&this.opaque.sort(e||rme),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(i||M8),this.transparent.length>1&&this.transparent.sort(i||M8)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,i=this.renderItems.length;e<i;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null}}}class sme{constructor(e){this.lighting=e,this.lists=new zc}get(e,i){const n=this.lists,s=[e,i];let o=n.get(s);return o===void 0&&(o=new nme(this.lighting,e,i),n.set(s,o)),o}dispose(){this.lists=new zc}}let ame=0;class ome{constructor(){this.id=ame++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Kn,this.scissor=!1,this.scissorValue=new Kn,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}getCacheKey(){return I8(this)}}function I8(r){const{textures:e,activeCubeFace:i}=r,n=[i];for(const s of e)n.push(s.id);return R5(n)}class lme{constructor(){this.chainMaps={}}get(e,i,n=null){const s=[e,i];let o;if(n===null)o="default";else{const c=n.texture.format;o=`${n.textures.length}:${c}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const l=this.getChainMap(o);let u=l.get(s);return u===void 0&&(u=new ome,l.set(s,u)),n!==null&&(u.sampleCount=n.samples===0?1:n.samples),u}getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new zc)}dispose(){this.chainMaps={}}}const cme=new It;class ume extends gd{constructor(e,i,n){super(),this.renderer=e,this.backend=i,this.info=n}updateRenderTarget(e,i=0){const n=this.get(e),s=e.samples===0?1:e.samples,o=n.depthTextureMips||(n.depthTextureMips={}),l=e.textures,u=this.getSize(l[0]),c=u.width>>i,d=u.height>>i;let p=e.depthTexture||o[i];const f=e.depthBuffer===!0||e.stencilBuffer===!0;let m=!1;p===void 0&&f&&(p=new dg,p.format=e.stencilBuffer?Ym:Ep,p.type=e.stencilBuffer?jA:Da,p.image.width=c,p.image.height=d,o[i]=p),(n.width!==u.width||u.height!==n.height)&&(m=!0,p&&(p.needsUpdate=!0,p.image.width=c,p.image.height=d)),n.width=u.width,n.height=u.height,n.textures=l,n.depthTexture=p||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==s&&(m=!0,p&&(p.needsUpdate=!0),n.sampleCount=s);const g={sampleCount:s};for(let y=0;y<l.length;y++){const x=l[y];m&&(x.needsUpdate=!0),this.updateTexture(x,g)}if(p&&this.updateTexture(p,g),n.initialized!==!0){n.initialized=!0;const y=()=>{e.removeEventListener("dispose",y);for(let x=0;x<l.length;x++)this._destroyTexture(l[x]);p&&this._destroyTexture(p),this.delete(e)};e.addEventListener("dispose",y)}}updateTexture(e,i={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const s=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,o=this.backend;if(s&&n.initialized===!0&&(o.destroySampler(e),o.destroyTexture(e)),e.isFramebufferTexture){const d=this.renderer.getRenderTarget();d?e.type=d.texture.type:e.type=ed}const{width:l,height:u,depth:c}=this.getSize(e);if(i.width=l,i.height=u,i.depth=c,i.needsMipmaps=this.needsMipmaps(e),i.levels=i.needsMipmaps?this.getMipLevels(e,l,u):1,s||e.isStorageTexture===!0)o.createSampler(e),o.createTexture(e,i),n.generation=e.version;else if(n.initialized!==!0&&o.createSampler(e),e.version>0){const d=e.image;if(d===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(d.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const p=[];for(const f of e.images)p.push(f);i.images=p}else i.image=d;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(o.createTexture(e,i),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&o.updateTexture(e,i),i.needsMipmaps&&e.mipmaps.length===0&&o.generateMipmaps(e)}}else o.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(n.initialized!==!0){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const d=()=>{e.removeEventListener("dispose",d),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",d)}n.version=e.version}getSize(e,i=cme){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),i.width=n.width,i.height=n.height,i.depth=e.isCubeTexture?6:n.depth||1):i.width=i.height=i.depth=1,i}getMipLevels(e,i,n){let s;return e.isCompressedTexture?s=e.mipmaps.length:s=Math.floor(Math.log2(Math.max(i,n)))+1,s}needsMipmaps(e){return this.isEnvironmentTexture(e)||e.isCompressedTexture===!0||e.generateMipmaps}isEnvironmentTexture(e){const i=e.mapping;return i===FA||i===kA||i===_p||i===Hm}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class eR extends Jn{constructor(e,i,n,s=1){super(e,i,n),this.a=s}set(e,i,n,s=1){return this.a=s,super.set(e,i,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class hme extends Zn{static get type(){return"ParameterNode"}constructor(e,i=null){super(e,i),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class dme extends en{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}If(e,i){const n=new z1(i);return this._currentCond=Go(e,n),this.add(this._currentCond)}ElseIf(e,i){const n=new z1(i),s=Go(e,n);return this._currentCond.elseNode=s,this._currentCond=s,this}Else(e){return this._currentCond.elseNode=new z1(e),this}build(e,...i){const n=H5();V1(this);for(const s of this.nodes)s.build(e,"void");return V1(n),this.outputNode?this.outputNode.build(e,...i):super.build(e,...i)}else(...e){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const tR=oi(dme);new cd,new It,new It,new It,new bs,new It(0,0,-1),new Kn,new It,new It,new Kn,new Nn;const pme=new eg;yy.flipX(),pme.depthTexture=new dg(1,1);const iR=new o3(-1,1,1,-1,0,1);class fme extends Rp{constructor(e=!1){super();const i=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Gu([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Gu(i,2))}}const mme=new fme;class B8 extends Bp{constructor(e=null){super(mme,e),this.camera=iR,this.isQuadMesh=!0}renderAsync(e){return e.renderAsync(this,iR)}render(e){e.render(this,iR)}}const Ey=new dc,rR=new bs;class Wo extends en{static get type(){return"SceneNode"}constructor(e=Wo.BACKGROUND_BLURRINESS,i=null){super(),this.scope=e,this.scene=i}setup(e){const i=this.scope,n=this.scene!==null?this.scene:e.scene;let s;return i===Wo.BACKGROUND_BLURRINESS?s=Ms("backgroundBlurriness","float",n):i===Wo.BACKGROUND_INTENSITY?s=Ms("backgroundIntensity","float",n):i===Wo.BACKGROUND_ROTATION?s=Jr("mat4").label("backgroundRotation").setGroup(Cn).onRenderUpdate(()=>{const o=n.background;return o!==null&&o.isTexture&&o.mapping!==tM?(Ey.copy(n.backgroundRotation),Ey.x*=-1,Ey.y*=-1,Ey.z*=-1,rR.makeRotationFromEuler(Ey)):rR.identity(),rR}):console.error("THREE.SceneNode: Unknown scope:",i),s}}Wo.BACKGROUND_BLURRINESS="backgroundBlurriness",Wo.BACKGROUND_INTENSITY="backgroundIntensity",Wo.BACKGROUND_ROTATION="backgroundRotation";const gme=Xi(Wo,Wo.BACKGROUND_BLURRINESS),N8=Xi(Wo,Wo.BACKGROUND_INTENSITY),Ame=Xi(Wo,Wo.BACKGROUND_ROTATION),Cg={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Ua={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},za={Store:"store"},ia={Load:"load",Clear:"clear"},nR={CCW:"ccw"},sR={None:"none",Front:"front",Back:"back"},Sg={Uint16:"uint16",Uint32:"uint32"},ht={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},aR={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},zp={Linear:"linear",Nearest:"nearest"},Wr={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},jp={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},L8={None:0,All:15},yd={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},oR={Storage:"storage",ReadOnlyStorage:"read-only-storage"},D8={WriteOnly:"write-only",ReadOnly:"read-only"},wy={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},O8={TwoD:"2d",ThreeD:"3d"},Nl={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},yme={All:"all"},u_={Vertex:"vertex",Instance:"instance"},lR={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"},vme=new Nn;class xme extends uy{static get type(){return"PassTextureNode"}constructor(e,i){super(i),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class P8 extends xme{static get type(){return"PassMultipleTextureNode"}constructor(e,i,n=!1){super(e,null),this.textureName=i,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class h_ extends Js{static get type(){return"PassNode"}constructor(e,i,n,s={}){super("vec4"),this.scope=e,this.scene=i,this.camera=n,this.options=s,this._pixelRatio=1,this._width=1,this._height=1;const o=new dg;o.isRenderTargetTexture=!0,o.name="depth";const l=new eg(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Du,...s});l.texture.name="output",l.depthTexture=o,this.renderTarget=l,this.updateBeforeType=cn.FRAME,this._textures={output:l.texture,depth:o},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Jr(0),this._cameraFar=Jr(0),this._mrt=null,this.isPassNode=!0}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let i=this._textures[e];return i===void 0&&(i=this.renderTarget.texture.clone(),i.isRenderTargetTexture=!0,i.name=e,this._textures[e]=i,this.renderTarget.textures.push(i)),i}getPreviousTexture(e){let i=this._previousTextures[e];return i===void 0&&(i=this.getTexture(e).clone(),i.isRenderTargetTexture=!0,this._previousTextures[e]=i),i}toggleTexture(e){const i=this._previousTextures[e];if(i!==void 0){const n=this._textures[e],s=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[s]=i,this._textures[e]=i,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let i=this._textureNodes[e];return i===void 0&&(i=wi(new P8(this,e)),i.updateTexture(),this._textureNodes[e]=i),i}getPreviousTextureNode(e="output"){let i=this._previousTextureNodes[e];return i===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),i=wi(new P8(this,e,!0)),i.updateTexture(),this._previousTextureNodes[e]=i),i}getViewZNode(e="depth"){let i=this._viewZNodes[e];if(i===void 0){const n=this._cameraNear,s=this._cameraFar;this._viewZNodes[e]=i=j6(this.getTextureNode(e),n,s)}return i}getLinearDepthNode(e="depth"){let i=this._linearDepthNodes[e];if(i===void 0){const n=this._cameraNear,s=this._cameraFar,o=this.getViewZNode(e);this._linearDepthNodes[e]=i=xy(o,n,s)}return i}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.depthTexture.isMultisampleRenderTargetTexture=this.renderTarget.samples>1,this.scope===h_.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:i}=e,{scene:n,camera:s}=this;this._pixelRatio=i.getPixelRatio();const o=i.getSize(vme);this.setSize(o.width,o.height);const l=i.getRenderTarget(),u=i.getMRT();this._cameraNear.value=s.near,this._cameraFar.value=s.far;for(const c in this._previousTextures)this.toggleTexture(c);i.setRenderTarget(this.renderTarget),i.setMRT(this._mrt),i.render(n,s),i.setRenderTarget(l),i.setMRT(u)}setSize(e,i){this._width=e,this._height=i;const n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget.setSize(n,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}h_.COLOR="color",h_.DEPTH="depth";const bme=ji(([r,e])=>r.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),_me=ji(([r,e])=>(r=r.mul(e),r.div(r.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Eme=ji(([r,e])=>{r=r.mul(e),r=r.sub(.004).max(0);const i=r.mul(r.mul(6.2).add(.5)),n=r.mul(r.mul(6.2).add(1.7)).add(.06);return i.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),wme=ji(([r])=>{const e=r.mul(r.add(.0245786)).sub(90537e-9),i=r.mul(r.add(.432951).mul(.983729)).add(.238081);return e.div(i)}),Cme=ji(([r,e])=>{const i=bo(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=bo(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return r=r.mul(e).div(.6),r=i.mul(r),r=wme(r),r=n.mul(r),r.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Sme=bo(Zt(1.6605,-.1246,-.0182),Zt(-.5876,1.1329,-.1006),Zt(-.0728,-.0083,1.1187)),Tme=bo(Zt(.6274,.0691,.0164),Zt(.3293,.9195,.088),Zt(.0433,.0113,.8956)),Mme=ji(([r])=>{const e=Zt(r).toVar(),i=Zt(e.mul(e)).toVar(),n=Zt(i.mul(i)).toVar();return ei(15.5).mul(n.mul(i)).sub(yn(40.14,n.mul(e))).add(yn(31.96,n).sub(yn(6.868,i.mul(e))).add(yn(.4298,i).add(yn(.1191,e).sub(.00232))))}),Rme=ji(([r,e])=>{const i=Zt(r).toVar(),n=bo(Zt(.856627153315983,.137318972929847,.11189821299995),Zt(.0951212405381588,.761241990602591,.0767994186031903),Zt(.0482516061458583,.101439036467562,.811302368396859)),s=bo(Zt(1.1271005818144368,-.1413297634984383,-.14132976349843826),Zt(-.11060664309660323,1.157823702216272,-.11060664309660294),Zt(-.016493938717834573,-.016493938717834257,1.2519364065950405)),o=ei(-12.47393),l=ei(4.026069);return i.mulAssign(e),i.assign(Tme.mul(i)),i.assign(n.mul(i)),i.assign(Bl(i,1e-10)),i.assign(Xu(i)),i.assign(i.sub(o).div(l.sub(o))),i.assign(Yu(i,0,1)),i.assign(Mme(i)),i.assign(s.mul(i)),i.assign(Y1(Bl(Zt(0),i),Zt(2.2))),i.assign(Sme.mul(i)),i.assign(Yu(i,0,1)),i}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Ime=ji(([r,e])=>{const i=ei(.76),n=ei(.15);r=r.mul(e);const s=ay(r.r,ay(r.g,r.b)),o=Go(s.lessThan(.08),s.sub(yn(6.25,s.mul(s))),.04);r.subAssign(o);const l=Bl(r.r,Bl(r.g,r.b));Pa(l.lessThan(i),()=>r);const u=pl(1,i),c=pl(1,u.mul(u).div(l.add(u.sub(i))));r.mulAssign(c.div(l));const d=pl(1,ud(1,n.mul(l.sub(c)).add(1)));return fs(r,Zt(c),d)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class eo extends en{static get type(){return"CodeNode"}constructor(e="",i=[],n=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=n,this.includes=i}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const i=this.getIncludes(e);for(const s of i)s.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class Bme extends eo{static get type(){return"FunctionNode"}constructor(e="",i=[],n=""){super(e,i,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const i=e.getDataFromNode(this);let n=i.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),i.nodeFunction=n),n}generate(e,i){super.generate(e);const n=this.getNodeFunction(e),s=n.name,o=n.type,l=e.getCodeFromNode(this,o);s!==""&&(l.name=s);const u=e.getPropertyName(l),c=this.getNodeFunction(e).getCode(u);return l.code=c+`
`,i==="property"?u:e.format(`${u}()`,o,i)}}class F8 extends en{static get type(){return"FogNode"}constructor(e,i){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=i}getViewZNode(e){let i;const n=e.context.getViewZ;return n!==void 0&&(i=n(this)),(i||ka.z).negate()}setup(){return this.factorNode}}class Nme extends F8{static get type(){return"FogRangeNode"}constructor(e,i,n){super(e),this.isFogRangeNode=!0,this.nearNode=i,this.farNode=n}setup(e){const i=this.getViewZNode(e);return Pp(this.nearNode,this.farNode,i)}}const Lme=oi(Nme);class Dme extends F8{static get type(){return"FogExp2Node"}constructor(e,i){super(e),this.isFogExp2Node=!0,this.densityNode=i}setup(e){const i=this.getViewZNode(e),n=this.densityNode;return n.mul(n,i,i).negate().exp().oneMinus()}}const Ome=oi(Dme);class Pme extends en{constructor(e){super(),this.scope=e}generate(e){const{scope:i}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${i}Barrier 
`):e.addLineFlowCode(`${i}Barrier()`,this)}}oi(Pme);class Vc extends Js{static get type(){return"AtomicFunctionNode"}constructor(e,i,n,s=null){super("uint"),this.method=e,this.pointerNode=i,this.valueNode=n,this.storeNode=s}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const i=this.method,n=this.getNodeType(e),s=this.getInputType(e),o=this.pointerNode,l=this.valueNode,u=[];u.push(`&${o.build(e,s)}`),u.push(l.build(e,s));const c=`${e.getMethod(i,n)}( ${u.join(", ")} )`;if(this.storeNode!==null){const d=this.storeNode.build(e,s);e.addLineFlowCode(`${d} = ${c}`,this)}else e.addLineFlowCode(c,this)}}Vc.ATOMIC_LOAD="atomicLoad",Vc.ATOMIC_STORE="atomicStore",Vc.ATOMIC_ADD="atomicAdd",Vc.ATOMIC_SUB="atomicSub",Vc.ATOMIC_MAX="atomicMax",Vc.ATOMIC_MIN="atomicMin",Vc.ATOMIC_AND="atomicAnd",Vc.ATOMIC_OR="atomicOr",Vc.ATOMIC_XOR="atomicXor",oi(Vc);let d_;function cR(r){d_=d_||new WeakMap;let e=d_.get(r);return e===void 0&&d_.set(r,e={}),e}function k8(r){const e=cR(r);return e.position||(e.position=Jr(new It).setGroup(Cn).onRenderUpdate((i,n)=>n.value.setFromMatrixPosition(r.matrixWorld)))}function Fme(r){const e=cR(r);return e.targetPosition||(e.targetPosition=Jr(new It).setGroup(Cn).onRenderUpdate((i,n)=>n.value.setFromMatrixPosition(r.target.matrixWorld)))}function uR(r){const e=cR(r);return e.viewPosition||(e.viewPosition=Jr(new It).setGroup(Cn).onRenderUpdate(({camera:i},n)=>{n.value=n.value||new It,n.value.setFromMatrixPosition(r.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}))}const U8=r=>Zu.transformDirection(k8(r).sub(Fme(r))),kme=r=>r.sort((e,i)=>e.id-i.id),Ume=(r,e)=>{for(const i of e)if(i.isAnalyticLightNode&&i.light.id===r)return i;return null},hR=new WeakMap;class z8 extends en{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Zt().toVar("totalDiffuse"),this.totalSpecularNode=Zt().toVar("totalSpecular"),this.outgoingLightNode=Zt().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const i=[];for(const n of this._lightNodes)i.push(n.getSelf().getHash());this._lightNodesHash="lights-"+i.join(",")}return this._lightNodesHash}analyze(e){const i=e.getDataFromNode(this);for(const n of i.nodes)n.build(e)}setupLightsNode(e){const i=[],n=this._lightNodes,s=kme(this._lights),o=e.renderer.library;for(const l of s)if(l.isNode)i.push(wi(l));else{let u=null;if(n!==null&&(u=Ume(l.id,n)),u===null){const c=o.getLightNodeClass(l.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${l.constructor.name}`);continue}let d=null;hR.has(l)?d=hR.get(l):(d=wi(new c(l)),hR.set(l,d)),i.push(d)}}this._lightNodes=i}setupLights(e,i){for(const n of i)n.build(e)}setup(e){this._lightNodes===null&&this.setupLightsNode(e);const i=e.context,n=i.lightingModel;let s=this.outgoingLightNode;if(n){const{_lightNodes:o,totalDiffuseNode:l,totalSpecularNode:u}=this;i.outgoingLight=s;const c=e.addStack(),d=e.getDataFromNode(this);d.nodes=c.nodes,n.start(i,c,e),this.setupLights(e,o),n.indirect(i,c,e);const{backdrop:p,backdropAlpha:f}=i,{directDiffuse:m,directSpecular:g,indirectDiffuse:y,indirectSpecular:x}=i.reflectedLight;let v=m.add(y);p!==null&&(f!==null?v=Zt(f.mix(v,p)):v=Zt(p),i.material.transparent=!0),l.assign(v),u.assign(g.add(x)),s.assign(l.add(u)),n.finish(i,c,e),s=s.bypass(e.removeStack())}return s}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const zme=ji(({depthTexture:r,shadowCoord:e})=>Ds(r,e.xy).compare(e.z)),jme=ji(({depthTexture:r,shadowCoord:e,shadow:i})=>{const n=(x,v)=>Ds(r,x).compare(v),s=Ms("mapSize","vec2",i).setGroup(Cn),o=Ms("radius","float",i).setGroup(Cn),l=Yi(1).div(s),u=l.x.negate().mul(o),c=l.y.negate().mul(o),d=l.x.mul(o),p=l.y.mul(o),f=u.div(2),m=c.div(2),g=d.div(2),y=p.div(2);return _o(n(e.xy.add(Yi(u,c)),e.z),n(e.xy.add(Yi(0,c)),e.z),n(e.xy.add(Yi(d,c)),e.z),n(e.xy.add(Yi(f,m)),e.z),n(e.xy.add(Yi(0,m)),e.z),n(e.xy.add(Yi(g,m)),e.z),n(e.xy.add(Yi(u,0)),e.z),n(e.xy.add(Yi(f,0)),e.z),n(e.xy,e.z),n(e.xy.add(Yi(g,0)),e.z),n(e.xy.add(Yi(d,0)),e.z),n(e.xy.add(Yi(f,y)),e.z),n(e.xy.add(Yi(0,y)),e.z),n(e.xy.add(Yi(g,y)),e.z),n(e.xy.add(Yi(u,p)),e.z),n(e.xy.add(Yi(0,p)),e.z),n(e.xy.add(Yi(d,p)),e.z)).mul(1/17)}),Vme=ji(({depthTexture:r,shadowCoord:e,shadow:i})=>{const n=(p,f)=>Ds(r,p).compare(f),s=Ms("mapSize","vec2",i).setGroup(Cn),o=Yi(1).div(s),l=o.x,u=o.y,c=e.xy,d=hd(c.mul(s).add(.5));return c.subAssign(d.mul(o)),_o(n(c,e.z),n(c.add(Yi(l,0)),e.z),n(c.add(Yi(0,u)),e.z),n(c.add(o),e.z),fs(n(c.add(Yi(l.negate(),0)),e.z),n(c.add(Yi(l.mul(2),0)),e.z),d.x),fs(n(c.add(Yi(l.negate(),u)),e.z),n(c.add(Yi(l.mul(2),u)),e.z),d.x),fs(n(c.add(Yi(0,u.negate())),e.z),n(c.add(Yi(0,u.mul(2))),e.z),d.y),fs(n(c.add(Yi(l,u.negate())),e.z),n(c.add(Yi(l,u.mul(2))),e.z),d.y),fs(fs(n(c.add(Yi(l.negate(),u.negate())),e.z),n(c.add(Yi(l.mul(2),u.negate())),e.z),d.x),fs(n(c.add(Yi(l.negate(),u.mul(2))),e.z),n(c.add(Yi(l.mul(2),u.mul(2))),e.z),d.x),d.y)).mul(1/9)}),Gme=ji(({depthTexture:r,shadowCoord:e})=>{const i=ei(1).toVar(),n=Ds(r).uv(e.xy).rg,s=u6(e.z,n.x);return Pa(s.notEqual(ei(1)),()=>{const o=e.z.sub(n.x),l=Bl(0,n.y.mul(n.y));let u=l.div(l.add(o.mul(o)));u=Yu(pl(u,.3).div(.95-.3)),i.assign(Yu(Bl(s,u)))}),i}),Hme=ji(({samples:r,radius:e,size:i,shadowPass:n})=>{const s=ei(0).toVar(),o=ei(0).toVar(),l=r.lessThanEqual(ei(1)).select(ei(0),ei(2).div(r.sub(1))),u=r.lessThanEqual(ei(1)).select(ei(0),ei(-1));Uc({start:Ls(0),end:Ls(r),type:"int",condition:"<"},({i:d})=>{const p=u.add(ei(d).mul(l)),f=n.uv(_o(k3.xy,Yi(0,p).mul(e)).div(i)).x;s.addAssign(f),o.addAssign(f.mul(f))}),s.divAssign(r),o.divAssign(r);const c=_3(o.sub(s.mul(s)));return Yi(s,c)}),Wme=ji(({samples:r,radius:e,size:i,shadowPass:n})=>{const s=ei(0).toVar(),o=ei(0).toVar(),l=r.lessThanEqual(ei(1)).select(ei(0),ei(2).div(r.sub(1))),u=r.lessThanEqual(ei(1)).select(ei(0),ei(-1));Uc({start:Ls(0),end:Ls(r),type:"int",condition:"<"},({i:d})=>{const p=u.add(ei(d).mul(l)),f=n.uv(_o(k3.xy,Yi(p,0).mul(e)).div(i));s.addAssign(f.x),o.addAssign(_o(f.y.mul(f.y),f.x.mul(f.x)))}),s.divAssign(r),o.divAssign(r);const c=_3(o.sub(s.mul(s)));return Yi(s,c)}),Qme=[zme,jme,Vme,Gme];let Tg=null;const p_=new B8;class qme extends en{static get type(){return"ShadowNode"}constructor(e,i=null){super(),this.light=e,this.shadow=i||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this.updateBeforeType=cn.RENDER,this._node=null,this.isShadowNode=!0}setupShadow(e){const{object:i,renderer:n}=e;Tg===null&&(Tg=new ta,Tg.fragmentNode=Kr(0,0,0,1),Tg.isShadowNodeMaterial=!0,Tg.name="ShadowMaterial");const s=this.shadow,o=n.shadowMap.type,l=new dg(s.mapSize.width,s.mapSize.height);l.compareFunction=RM;const u=e.createRenderTarget(s.mapSize.width,s.mapSize.height);if(u.depthTexture=l,s.camera.updateProjectionMatrix(),o===i1){l.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:VA,type:Du}),this.vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:VA,type:Du});const T=Ds(l),w=Ds(this.vsmShadowMapVertical.texture),S=Ms("blurSamples","float",s).setGroup(Cn),R=Ms("radius","float",s).setGroup(Cn),B=Ms("mapSize","vec2",s).setGroup(Cn);let I=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ta);I.fragmentNode=Hme({samples:S,radius:R,size:B,shadowPass:T}).context(e.getSharedContext()),I.name="VSMVertical",I=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ta),I.fragmentNode=Wme({samples:S,radius:R,size:B,shadowPass:w}).context(e.getSharedContext()),I.name="VSMHorizontal"}const c=Ms("intensity","float",s).setGroup(Cn),d=Ms("bias","float",s).setGroup(Cn),p=Ms("normalBias","float",s).setGroup(Cn),f=i.material.shadowPositionNode||M3;let m=Jr(s.matrix).setGroup(Cn).mul(f.add(R3.mul(p))),g;if(s.camera.isOrthographicCamera||n.logarithmicDepthBuffer!==!0)m=m.xyz.div(m.w),g=m.z,n.coordinateSystem===Sp&&(g=g.mul(2).sub(1));else{const T=m.w;m=m.xy.div(T);const w=Jr("float").onRenderUpdate(()=>s.camera.near),S=Jr("float").onRenderUpdate(()=>s.camera.far);g=V6(T,w,S)}m=Zt(m.x,m.y.oneMinus(),g.add(d));const y=m.x.greaterThanEqual(0).and(m.x.lessThanEqual(1)).and(m.y.greaterThanEqual(0)).and(m.y.lessThanEqual(1)).and(m.z.lessThanEqual(1)),x=s.filterNode||Qme[n.shadowMap.type]||null;if(x===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const v=Ds(u.texture,m),_=y.select(x({depthTexture:o===i1?this.vsmShadowMapHorizontal.texture:l,shadowCoord:m,shadow:s}),ei(1));return this.shadowMap=u,this.shadow.map=u,fs(1,_.rgb.mix(v,1),c.mul(v.a))}setup(e){if(e.renderer.shadowMap.enabled!==!1)return this._node!==null?this._node:this._node=this.setupShadow(e)}updateShadow(e){const{shadowMap:i,light:n,shadow:s}=this,{renderer:o,scene:l,camera:u}=e,c=o.shadowMap.type,d=i.depthTexture.version;this._depthVersionCached=d;const p=l.overrideMaterial;l.overrideMaterial=Tg,i.setSize(s.mapSize.width,s.mapSize.height),s.updateMatrices(n),s.camera.layers.mask=u.layers.mask;const f=o.getRenderTarget(),m=o.getRenderObjectFunction();o.setRenderObjectFunction((g,...y)=>{(g.castShadow===!0||g.receiveShadow&&c===i1)&&o.renderObject(g,...y)}),o.setRenderTarget(i),o.render(l,s.camera),o.setRenderObjectFunction(m),n.isPointLight!==!0&&c===i1&&this.vsmPass(o),o.setRenderTarget(f),l.overrideMaterial=p}vsmPass(e){const{shadow:i}=this;this.vsmShadowMapVertical.setSize(i.mapSize.width,i.mapSize.height),this.vsmShadowMapHorizontal.setSize(i.mapSize.width,i.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),p_.material=this.vsmMaterialVertical,p_.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),p_.material=this.vsmMaterialHorizontal,p_.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),this.updateBeforeType=cn.NONE}updateBefore(e){const{shadow:i}=this;(i.needsUpdate||i.autoUpdate)&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(i.needsUpdate=!1))}}const Xme=(r,e)=>wi(new qme(r,e));class Vp extends _g{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.updateType=cn.FRAME,this.light=e,this.color=new Jn,this.colorNode=Jr(this.color).setGroup(Cn),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0}getCacheKey(){return O1(super.getCacheKey(),this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadow(e){const{renderer:i}=e;if(i.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const s=this.light.shadow.shadowNode;let o;s!==void 0?o=wi(s):o=Xme(this.light),this.shadowNode=o,this.shadowColorNode=n=this.colorNode.mul(o),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&this.shadowNode.dispose()}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const j8=ji(r=>{const{lightDistance:e,cutoffDistance:i,decayExponent:n}=r,s=e.pow(n).max(.01).reciprocal();return i.greaterThan(0).select(s.mul(e.div(i).pow4().oneMinus().clamp().pow2()),s)}),Yme=ji(({color:r,lightViewPosition:e,cutoffDistance:i,decayExponent:n},s)=>{const o=s.context.lightingModel,l=e.sub(ka),u=l.normalize(),c=l.length(),d=j8({lightDistance:c,cutoffDistance:i,decayExponent:n}),p=r.mul(d),f=s.context.reflectedLight;o.direct({lightDirection:u,lightColor:p,reflectedLight:f},s.stack,s)});class Kme extends Vp{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Jr(0).setGroup(Cn),this.decayExponentNode=Jr(0).setGroup(Cn)}update(e){const{light:i}=this;super.update(e),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}setup(){Yme({color:this.colorNode,lightViewPosition:uR(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}const Jme=ji(([r,e])=>{const i=r.x,n=r.y,s=r.z;let o=e.element(0).mul(.886227);return o=o.add(e.element(1).mul(2*.511664).mul(n)),o=o.add(e.element(2).mul(2*.511664).mul(s)),o=o.add(e.element(3).mul(2*.511664).mul(i)),o=o.add(e.element(4).mul(2*.429043).mul(i).mul(n)),o=o.add(e.element(5).mul(2*.429043).mul(n).mul(s)),o=o.add(e.element(6).mul(s.mul(s).mul(.743125).sub(.247708))),o=o.add(e.element(7).mul(2*.429043).mul(i).mul(s)),o=o.add(e.element(8).mul(.429043).mul(yn(i,i).sub(yn(n,n)))),o}),$u=new eR;class Zme extends gd{constructor(e,i){super(),this.renderer=e,this.nodes=i}update(e,i,n){const s=this.renderer,o=this.nodes.getBackgroundNode(e)||e.background;let l=!1;if(o===null)s._clearColor.getRGB($u,id),$u.a=s._clearColor.a;else if(o.isColor===!0)o.getRGB($u,id),$u.a=1,l=!0;else if(o.isNode===!0){const u=this.get(e),c=o;$u.copy(s._clearColor);let d=u.backgroundMesh;if(d===void 0){const f=C3(Kr(c).mul(N8),{getUV:()=>Ame.mul(C6),getTextureLevel:()=>gme});let m=D3();m=m.setZ(m.w);const g=new ta;g.name="Background.material",g.side=lc,g.depthTest=!1,g.depthWrite=!1,g.fog=!1,g.lights=!1,g.vertexNode=m,g.colorNode=f,u.backgroundMeshNode=f,u.backgroundMesh=d=new Bp(new i3(1,32,32),g),d.frustumCulled=!1,d.name="Background.mesh",d.onBeforeRender=function(y,x,v){this.matrixWorld.copyPosition(v.matrixWorld)}}const p=c.getCacheKey();u.backgroundCacheKey!==p&&(u.backgroundMeshNode.node=Kr(c).mul(N8),u.backgroundMeshNode.needsUpdate=!0,d.material.needsUpdate=!0,u.backgroundCacheKey=p),i.unshift(d,d.geometry,d.material,0,0,null)}else console.error("THREE.Renderer: Unsupported background configuration.",o);if(s.autoClear===!0||l===!0){const u=n.clearColorValue;u.r=$u.r,u.g=$u.g,u.b=$u.b,u.a=$u.a,(s.backend.isWebGLBackend===!0||s.alpha===!0)&&(u.r*=u.a,u.g*=u.a,u.b*=u.a),n.depthClearValue=s._clearDepth,n.stencilClearValue=s._clearStencil,n.clearColor=s.autoClearColor===!0,n.clearDepth=s.autoClearDepth===!0,n.clearStencil=s.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let $me=0;class dR{constructor(e="",i=[],n=0,s=[]){this.name=e,this.bindings=i,this.index=n,this.bindingsReference=s,this.id=$me++}}class ege{constructor(e,i,n,s,o,l,u,c,d,p=[]){this.vertexShader=e,this.fragmentShader=i,this.computeShader=n,this.transforms=p,this.nodeAttributes=s,this.bindings=o,this.updateNodes=l,this.updateBeforeNodes=u,this.updateAfterNodes=c,this.monitor=d,this.usedTimes=0}createBindings(){const e=[];for(const i of this.bindings)if(i.bindings[0].groupNode.shared!==!0){const n=new dR(i.name,[],i.index,i);e.push(n);for(const s of i.bindings)n.bindings.push(s.clone())}else e.push(i);return e}}class V8{constructor(e,i,n=null){this.isNodeAttribute=!0,this.name=e,this.type=i,this.node=n}}class tge{constructor(e,i,n){this.isNodeUniform=!0,this.name=e,this.type=i,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class G8{constructor(e,i){this.isNodeVar=!0,this.name=e,this.type=i}}class ige extends G8{constructor(e,i){super(e,i),this.needsInterpolation=!1,this.isNodeVarying=!0}}class rge{constructor(e,i,n=""){this.name=e,this.type=i,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let nge=0;class pR{constructor(e=null){this.id=nge++,this.nodesData=new WeakMap,this.parent=e}getData(e){let i=this.nodesData.get(e);return i===void 0&&this.parent!==null&&(i=this.parent.getData(e)),i}setData(e,i){this.nodesData.set(e,i)}}class Gp{constructor(e,i){this.name=e,this.value=i,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class sge extends Gp{constructor(e,i=0){super(e,i),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class age extends Gp{constructor(e,i=new Nn){super(e,i),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class oge extends Gp{constructor(e,i=new It){super(e,i),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class lge extends Gp{constructor(e,i=new Kn){super(e,i),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class cge extends Gp{constructor(e,i=new Jn){super(e,i),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class uge extends Gp{constructor(e,i=new jo){super(e,i),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class hge extends Gp{constructor(e,i=new bs){super(e,i),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class dge extends sge{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class pge extends age{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class fge extends oge{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class mge extends lge{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class gge extends cge{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Age extends uge{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class yge extends hge{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}const Mg=4,H8=[.125,.215,.35,.446,.526,.582],Hp=20,fR=new o3(-1,1,1,-1,0,1),vge=new Hu(90,1),W8=new Jn;let mR=null,gR=0,AR=0;const Wp=(1+Math.sqrt(5))/2,Rg=1/Wp,Q8=[new It(-Wp,Rg,0),new It(Wp,Rg,0),new It(-Rg,0,Wp),new It(Rg,0,Wp),new It(0,Wp,-Rg),new It(0,Wp,Rg),new It(-1,1,-1),new It(1,1,-1),new It(-1,1,1),new It(1,1,1)],xge=[3,1,5,0,4,2],yR=hfe(Z1(),Ju("faceIndex")).normalize(),vR=Zt(yR.x,yR.y.negate(),yR.z);class bge{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}fromScene(e,i=0,n=.1,s=100){mR=this._renderer.getRenderTarget(),gR=this._renderer.getActiveCubeFace(),AR=this._renderer.getActiveMipmapLevel(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,s,o),i>0&&this._blur(o,0,0,i),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=X8(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Y8(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(mR,gR,AR),e.scissorTest=!1,f_(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===_p||e.mapping===Hm?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),mR=this._renderer.getRenderTarget(),gR=this._renderer.getActiveCubeFace(),AR=this._renderer.getActiveMipmapLevel();const n=i||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:ol,minFilter:ol,generateMipmaps:!1,type:Du,format:Xm,colorSpace:id},s=q8(e,i,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=q8(e,i,n);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=_ge(o)),this._blurMaterial=Ege(o,e,i)}return s}async _compileMaterial(e){const i=new Bp(this._lodPlanes[0],e);await this._renderer.compile(i,fR)}_sceneToCubeUV(e,i,n,s){const o=vge;o.near=i,o.far=n;const l=[-1,1,-1,-1,-1,-1],u=[1,1,1,-1,-1,-1],c=this._renderer,d=c.autoClear;c.getClearColor(W8),c.autoClear=!1;let p=this._backgroundBox;if(p===null){const g=new w1({name:"PMREM.Background",side:lc,depthWrite:!1,depthTest:!1});p=new Bp(new $A,g)}let f=!1;const m=e.background;m?m.isColor&&(p.material.color.copy(m),e.background=null,f=!0):(p.material.color.copy(W8),f=!0),c.setRenderTarget(s),c.clear(),f&&c.render(p,o);for(let g=0;g<6;g++){const y=g%3;y===0?(o.up.set(0,l[g],0),o.lookAt(u[g],0,0)):y===1?(o.up.set(0,0,l[g]),o.lookAt(0,u[g],0)):(o.up.set(0,l[g],0),o.lookAt(0,0,u[g]));const x=this._cubeSize;f_(s,y*x,g>2?x:0,x,x),c.render(e,o)}c.autoClear=d,e.background=m}_textureToCubeUV(e,i){const n=this._renderer,s=e.mapping===_p||e.mapping===Hm;s?this._cubemapMaterial===null&&(this._cubemapMaterial=X8(e)):this._equirectMaterial===null&&(this._equirectMaterial=Y8(e));const o=s?this._cubemapMaterial:this._equirectMaterial;o.fragmentNode.value=e;const l=this._lodMeshes[0];l.material=o;const u=this._cubeSize;f_(i,0,0,3*u,2*u),n.setRenderTarget(i),n.render(l,fR)}_applyPMREM(e){const i=this._renderer,n=i.autoClear;i.autoClear=!1;const s=this._lodPlanes.length;for(let o=1;o<s;o++){const l=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),u=Q8[(s-o-1)%Q8.length];this._blur(e,o-1,o,l,u)}i.autoClear=n}_blur(e,i,n,s,o){const l=this._pingPongRenderTarget;this._halfBlur(e,l,i,n,s,"latitudinal",o),this._halfBlur(l,e,n,n,s,"longitudinal",o)}_halfBlur(e,i,n,s,o,l,u){const c=this._renderer,d=this._blurMaterial;l!=="latitudinal"&&l!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const p=3,f=this._lodMeshes[s];f.material=d;const m=d.uniforms,g=this._sizeLods[n]-1,y=isFinite(o)?Math.PI/(2*g):2*Math.PI/(2*Hp-1),x=o/y,v=isFinite(o)?1+Math.floor(p*x):Hp;v>Hp&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Hp}`);const _=[];let T=0;for(let I=0;I<Hp;++I){const D=I/x,L=Math.exp(-D*D/2);_.push(L),I===0?T+=L:I<v&&(T+=2*L)}for(let I=0;I<_.length;I++)_[I]=_[I]/T;e.texture.frame=(e.texture.frame||0)+1,m.envMap.value=e.texture,m.samples.value=v,m.weights.array=_,m.latitudinal.value=l==="latitudinal"?1:0,u&&(m.poleAxis.value=u);const{_lodMax:w}=this;m.dTheta.value=y,m.mipInt.value=w-n;const S=this._sizeLods[s],R=3*S*(s>w-Mg?s-w+Mg:0),B=4*(this._cubeSize-S);f_(i,R,B,3*S,2*S),c.setRenderTarget(i),c.render(f,fR)}}function _ge(r){const e=[],i=[],n=[],s=[];let o=r;const l=r-Mg+1+H8.length;for(let u=0;u<l;u++){const c=Math.pow(2,o);i.push(c);let d=1/c;u>r-Mg?d=H8[u-r+Mg-1]:u===0&&(d=0),n.push(d);const p=1/(c-2),f=-p,m=1+p,g=[f,f,m,f,m,m,f,f,m,m,f,m],y=6,x=6,v=3,_=2,T=1,w=new Float32Array(v*x*y),S=new Float32Array(_*x*y),R=new Float32Array(T*x*y);for(let I=0;I<y;I++){const D=I%3*2/3-1,L=I>2?0:-1,O=[D,L,0,D+2/3,L,0,D+2/3,L+1,0,D,L,0,D+2/3,L+1,0,D,L+1,0],U=xge[I];w.set(O,v*x*U),S.set(g,_*x*U);const J=[U,U,U,U,U,U];R.set(J,T*x*U)}const B=new Rp;B.setAttribute("position",new Rl(w,v)),B.setAttribute("uv",new Rl(S,_)),B.setAttribute("faceIndex",new Rl(R,T)),e.push(B),s.push(new Bp(B,null)),o>Mg&&o--}return{lodPlanes:e,sizeLods:i,sigmas:n,lodMeshes:s}}function q8(r,e,i){const n=new eg(r,e,i);return n.texture.mapping=iM,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function f_(r,e,i,n,s){r.viewport.set(e,i,n,s),r.scissor.set(e,i,n,s)}function xR(r){const e=new ta;return e.depthTest=!1,e.depthWrite=!1,e.blending=Vm,e.name=`PMREM_${r}`,e}function Ege(r,e,i){const n=py(new Array(Hp).fill(0)),s=Jr(new It(0,1,0)),o=Jr(0),l=ei(Hp),u=Jr(0),c=Jr(1),d=Ds(null),p=Jr(0),f=ei(1/e),m=ei(1/i),g=ei(r),y={n:l,latitudinal:u,weights:n,poleAxis:s,outputDirection:vR,dTheta:o,samples:c,envMap:d,mipInt:p,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:g},x=xR("blur");return x.uniforms=y,x.fragmentNode=pfe({...y,latitudinal:u.equal(1)}),x}function X8(r){const e=xR("cubemap");return e.fragmentNode=dy(r,vR),e}function Y8(r){const e=xR("equirect");return e.fragmentNode=Ds(r,q6(vR),0),e}const K8=new WeakMap,wge=new Map([[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Cge=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),m_=r=>/e/g.test(r)?String(r).replace(/\+/g,""):(r=Number(r),r+(r%1?"":".0"));class J8{constructor(e,i,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=i,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=tR(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new pR,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=K8.get(this.renderer);return e===void 0&&(e=new zc,K8.set(this.renderer,e)),e}createRenderTarget(e,i,n){return new eg(e,i,n)}createCubeRenderTarget(e,i){return new X6(e,i)}createPMREMGenerator(){return new bge(this.renderer)}includes(e){return this.nodes.includes(e)}_getBindGroup(e,i){const n=this.getBindGroupsCache(),s=[];let o=!0;for(const u of i)s.push(u),o=o&&u.groupNode.shared!==!0;let l;return o?(l=n.get(s),l===void 0&&(l=new dR(e,s,this.bindingsIndexes[e].group,s),n.set(s,l))):l=new dR(e,s,this.bindingsIndexes[e].group,s),l}getBindGroupArray(e,i){const n=this.bindings[i];let s=n[e];return s===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=s=[]),s}getBindings(){let e=this.bindGroups;if(e===null){const i={},n=this.bindings;for(const s of D5)for(const o in n[s]){const l=n[s][o];(i[o]||(i[o]=[])).push(...l)}e=[];for(const s in i){const o=i[s],l=this._getBindGroup(s,o);e.push(l)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((i,n)=>i.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let i=0;i<e.length;i++){const n=e[i];this.bindingsIndexes[n.name].group=i,n.index=i}}setHashNode(e,i){this.hashNodes[i]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==cn.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const i=e.getUpdateBeforeType(),n=e.getUpdateAfterType();i!==cn.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==cn.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===ol||e.magFilter===nM||e.magFilter===Qm||e.magFilter===Lu||e.minFilter===ol||e.minFilter===nM||e.minFilter===Qm||e.minFilter===Lu}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,i){return this.flowNodes[e].push(i),i}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,i=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new pR(i?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const i=this.getDataFromNode(e);return i.usageCount=i.usageCount===void 0?1:i.usageCount+1,i.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(e,i=null){if(i===null&&(e==="float"||e==="int"||e==="uint"?i=0:e==="bool"?i=!1:e==="color"?i=new Jn:e==="vec2"?i=new Nn:e==="vec3"?i=new It:e==="vec4"&&(i=new Kn)),e==="float")return m_(i);if(e==="int")return`${Math.round(i)}`;if(e==="uint")return i>=0?`${Math.round(i)}u`:"0u";if(e==="bool")return i?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${m_(i.r)}, ${m_(i.g)}, ${m_(i.b)} )`;const n=this.getTypeLength(e),s=this.getComponentType(e),o=l=>this.generateConst(s,l);if(n===2)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)} )`;if(n===3)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)}, ${o(i.z)} )`;if(n===4)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)}, ${o(i.z)}, ${o(i.w)} )`;if(n>4&&i&&(i.isMatrix3||i.isMatrix4))return`${this.getType(e)}( ${i.elements.map(o).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,i){const n=this.attributes;for(const o of n)if(o.name===e)return o;const s=new V8(e,i);return n.push(s),s}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const i=e.type;if(e.isDataTexture){if(i===Ao)return"int";if(i===Da)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const i=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return i===null?null:i[1]==="b"?"bool":i[1]==="i"?"int":i[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,i="float"){if(e===1)return i;const n=wge.get(e);return(i==="float"?"":i[0])+n}getTypeFromArray(e){return Cge.get(e.constructor)}getTypeFromAttribute(e){let i=e;e.isInterleavedBufferAttribute&&(i=e.data);const n=i.array,s=e.itemSize,o=e.normalized;let l;return!(e instanceof r5)&&o!==!0&&(l=this.getTypeFromArray(n)),this.getTypeFromLength(s,l)}getTypeLength(e){const i=this.getVectorType(e),n=/vec([2-4])/.exec(i);return n!==null?Number(n[1]):i==="float"||i==="bool"||i==="int"||i==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,i){return this.getTypeFromLength(this.getTypeLength(e),i)}getIntegerType(e){const i=this.getComponentType(e);return i==="int"||i==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=tR(this.stack),this.stacks.push(H5()||this.stack),V1(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,V1(this.stacks.pop()),e}getDataFromNode(e,i=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let s=n.getData(e);return s===void 0&&(s={},n.setData(e,s)),s[i]===void 0&&(s[i]={}),s[i]}getNodeProperties(e,i="any"){const n=this.getDataFromNode(e,i);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,i){const n=this.getDataFromNode(e);let s=n.bufferAttribute;if(s===void 0){const o=this.uniforms.index++;s=new V8("nodeAttribute"+o,i,e),this.bufferAttributes.push(s),n.bufferAttribute=s}return s}getStructTypeFromNode(e,i=this.shaderStage){const n=this.getDataFromNode(e,i);if(n.structType===void 0){const s=this.structs.index++;e.name=`StructType${s}`,this.structs[i].push(e),n.structType=e}return e}getUniformFromNode(e,i,n=this.shaderStage,s=null){const o=this.getDataFromNode(e,n,this.globalCache);let l=o.uniform;if(l===void 0){const u=this.uniforms.index++;l=new tge(s||"nodeUniform"+u,i,e),this.uniforms[n].push(l),o.uniform=l}return l}getVarFromNode(e,i=null,n=e.getNodeType(this),s=this.shaderStage){const o=this.getDataFromNode(e,s);let l=o.variable;if(l===void 0){const u=this.vars[s]||(this.vars[s]=[]);i===null&&(i="nodeVar"+u.length),l=new G8(i,n),u.push(l),o.variable=l}return l}getVaryingFromNode(e,i=null,n=e.getNodeType(this)){const s=this.getDataFromNode(e,"any");let o=s.varying;if(o===void 0){const l=this.varyings,u=l.length;i===null&&(i="nodeVarying"+u),o=new ige(i,n),l.push(o),s.varying=o}return o}getCodeFromNode(e,i,n=this.shaderStage){const s=this.getDataFromNode(e);let o=s.code;if(o===void 0){const l=this.codes[n]||(this.codes[n]=[]),u=l.length;o=new rge("nodeCode"+u,i),l.push(o),s.code=o}return o}addFlowCodeHierarchy(e,i){const{flowCodes:n,flowCodeBlock:s}=this.getDataFromNode(e);let o=!0,l=i;for(;l;){if(s.get(l)===!0){o=!1;break}l=this.getDataFromNode(l).parentNodeBlock}if(o)for(const u of n)this.addLineFlowCode(u)}addLineFlowCodeBlock(e,i,n){const s=this.getDataFromNode(e),o=s.flowCodes||(s.flowCodes=[]),l=s.flowCodeBlock||(s.flowCodeBlock=new WeakMap);o.push(i),l.set(n,!0)}addLineFlowCode(e,i=null){return e===""?this:(i!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(i,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const i=e.getNodeType(this),n=this.flowChildNode(e,i);return this.flowsData.set(e,n),n}buildFunctionNode(e){const i=new Bme,n=this.currentFunctionNode;return this.currentFunctionNode=i,i.code=this.buildFunctionCode(e),this.currentFunctionNode=n,i}flowShaderNode(e){const i=e.layout,n={[Symbol.iterator](){let l=0;const u=Object.values(this);return{next:()=>({value:u[l],done:l++>=u.length})}}};for(const l of i.inputs)n[l.name]=new hme(l.type,l.name);e.layout=null;const s=e.call(n),o=this.flowStagesNode(s,i.type);return e.layout=i,o}flowStagesNode(e,i=null){const n=this.flow,s=this.vars,o=this.cache,l=this.buildStage,u=this.stack,c={code:""};this.flow=c,this.vars={},this.cache=new pR,this.stack=tR();for(const d of L5)this.setBuildStage(d),c.result=e.build(this,i);return c.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=s,this.cache=o,this.stack=u,this.setBuildStage(l),c}getFunctionOperator(){return null}flowChildNode(e,i=null){const n=this.flow,s={code:""};return this.flow=s,s.result=e.build(this,i),this.flow=n,s}flowNodeFromShaderStage(e,i,n=null,s=null){const o=this.shaderStage;this.setShaderStage(e);const l=this.flowChildNode(i,n);return s!==null&&(l.code+=`${this.tab+s} = ${l.result};
`),this.flowCode[e]=this.flowCode[e]+l.code,this.setShaderStage(o),l}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,i){return`${this.getType(e)} ${i}`}getVars(e){let i="";const n=this.vars[e];if(n!==void 0)for(const s of n)i+=`${this.getVar(s.type,s.name)}; `;return i}getUniforms(){console.warn("Abstract function.")}getCodes(e){const i=this.codes[e];let n="";if(i!==void 0)for(const s of i)n+=s.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:i,renderer:n}=this;if(i!==null){let s=n.library.fromMaterial(i);s===null&&(console.error(`NodeMaterial: Material "${i.type}" is not compatible.`),s=new ta),s.build(this)}else this.addFlow("compute",e);for(const s of L5){this.setBuildStage(s),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const o of D5){this.setShaderStage(o);const l=this.flowNodes[o];for(const u of l)s==="generate"?this.flowNode(u):u.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,i){if(i==="float"||i==="int"||i==="uint")return new dge(e);if(i==="vec2"||i==="ivec2"||i==="uvec2")return new pge(e);if(i==="vec3"||i==="ivec3"||i==="uvec3")return new fge(e);if(i==="vec4"||i==="ivec4"||i==="uvec4")return new mge(e);if(i==="color")return new gge(e);if(i==="mat3")return new Age(e);if(i==="mat4")return new yge(e);throw new Error(`Uniform "${i}" not declared.`)}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}format(e,i,n){if(i=this.getVectorType(i),n=this.getVectorType(n),i===n||n===null||this.isReference(n))return e;const s=this.getTypeLength(i),o=this.getTypeLength(n);return s===16&&o===9?`${this.getType(n)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:s===9&&o===4?`${this.getType(n)}(${e}[0].xy, ${e}[1].xy)`:s>4||o>4||o===0?e:s===o?`${this.getType(n)}( ${e} )`:s>o?this.format(`${e}.${"xyz".slice(0,o)}`,this.getTypeFromLength(o,this.getComponentType(i)),n):o===4&&s>1?`${this.getType(n)}( ${this.format(e,i,"vec3")}, 1.0 )`:s===2?`${this.getType(n)}( ${this.format(e,i,"vec2")}, 0.0 )`:(s===1&&o>1&&i!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${t1} - Node System
`}}class Z8{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,i){let n=e.get(i);return n===void 0&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(i,n)),n}updateBeforeNode(e){const i=e.getUpdateBeforeType(),n=e.updateReference(this);if(i===cn.FRAME){const{frameMap:s}=this._getMaps(this.updateBeforeMap,n);s.get(n)!==this.frameId&&e.updateBefore(this)!==!1&&s.set(n,this.frameId)}else if(i===cn.RENDER){const{renderMap:s}=this._getMaps(this.updateBeforeMap,n);s.get(n)!==this.renderId&&e.updateBefore(this)!==!1&&s.set(n,this.renderId)}else i===cn.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const i=e.getUpdateAfterType(),n=e.updateReference(this);if(i===cn.FRAME){const{frameMap:s}=this._getMaps(this.updateAfterMap,n);s.get(n)!==this.frameId&&e.updateAfter(this)!==!1&&s.set(n,this.frameId)}else if(i===cn.RENDER){const{renderMap:s}=this._getMaps(this.updateAfterMap,n);s.get(n)!==this.renderId&&e.updateAfter(this)!==!1&&s.set(n,this.renderId)}else i===cn.OBJECT&&e.updateAfter(this)}updateNode(e){const i=e.getUpdateType(),n=e.updateReference(this);if(i===cn.FRAME){const{frameMap:s}=this._getMaps(this.updateMap,n);s.get(n)!==this.frameId&&e.update(this)!==!1&&s.set(n,this.frameId)}else if(i===cn.RENDER){const{renderMap:s}=this._getMaps(this.updateMap,n);s.get(n)!==this.renderId&&e.update(this)!==!1&&s.set(n,this.renderId)}else i===cn.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class bR{constructor(e,i,n=null,s="",o=!1){this.type=e,this.name=i,this.count=n,this.qualifier=s,this.isConst=o}}bR.isNodeFunctionInput=!0;class Sge extends Vp{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setup(e){super.setup(e);const i=e.context.lightingModel,n=this.colorNode,s=U8(this.light),o=e.context.reflectedLight;i.direct({lightDirection:s,lightColor:n,reflectedLight:o},e.stack,e)}}const _R=new bs,g_=new bs;let Cy=null;class Tge extends Vp{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Jr(new It).setGroup(Cn),this.halfWidth=Jr(new It).setGroup(Cn),this.updateType=cn.RENDER}update(e){super.update(e);const{light:i}=this,n=e.camera.matrixWorldInverse;g_.identity(),_R.copy(i.matrixWorld),_R.premultiply(n),g_.extractRotation(_R),this.halfWidth.value.set(i.width*.5,0,0),this.halfHeight.value.set(0,i.height*.5,0),this.halfWidth.value.applyMatrix4(g_),this.halfHeight.value.applyMatrix4(g_)}setup(e){super.setup(e);let i,n;e.isAvailable("float32Filterable")?(i=Ds(Cy.LTC_FLOAT_1),n=Ds(Cy.LTC_FLOAT_2)):(i=Ds(Cy.LTC_HALF_1),n=Ds(Cy.LTC_HALF_2));const{colorNode:s,light:o}=this,l=e.context.lightingModel,u=uR(o),c=e.context.reflectedLight;l.directRectArea({lightColor:s,lightPosition:u,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:c,ltc_1:i,ltc_2:n},e.stack,e)}static setLTC(e){Cy=e}}class $8 extends Vp{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Jr(0).setGroup(Cn),this.penumbraCosNode=Jr(0).setGroup(Cn),this.cutoffDistanceNode=Jr(0).setGroup(Cn),this.decayExponentNode=Jr(0).setGroup(Cn)}update(e){super.update(e);const{light:i}=this;this.coneCosNode.value=Math.cos(i.angle),this.penumbraCosNode.value=Math.cos(i.angle*(1-i.penumbra)),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}getSpotAttenuation(e){const{coneCosNode:i,penumbraCosNode:n}=this;return Pp(i,n,e)}setup(e){super.setup(e);const i=e.context.lightingModel,{colorNode:n,cutoffDistanceNode:s,decayExponentNode:o,light:l}=this,u=uR(l).sub(ka),c=u.normalize(),d=c.dot(U8(l)),p=this.getSpotAttenuation(d),f=u.length(),m=j8({lightDistance:f,cutoffDistance:s,decayExponent:o}),g=n.mul(p).mul(m),y=e.context.reflectedLight;i.direct({lightDirection:c,lightColor:g,reflectedLight:y},e.stack,e)}}class Mge extends $8{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const i=this.light.iesMap;let n=null;if(i&&i.isTexture===!0){const s=e.acos().mul(1/Math.PI);n=Ds(i,Yi(s,0),0).r}else n=super.getSpotAttenuation(e);return n}}class Rge extends Vp{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class Ige extends Vp{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=k8(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Jr(new Jn).setGroup(Cn)}update(e){const{light:i}=this;super.update(e),this.lightPositionNode.object3d=i,this.groundColorNode.value.copy(i.groundColor).multiplyScalar(i.intensity)}setup(e){const{colorNode:i,groundColorNode:n,lightDirectionNode:s}=this,o=yc.dot(s).mul(.5).add(.5),l=fs(n,i,o);e.context.irradiance.addAssign(l)}}class Bge extends Vp{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const i=[];for(let n=0;n<9;n++)i.push(new It);this.lightProbe=py(i)}update(e){const{light:i}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(i.sh.coefficients[n]).multiplyScalar(i.intensity)}setup(e){const i=Jme(C6,this.lightProbe);e.context.irradiance.addAssign(i)}}class ez{parseFunction(){console.warn("Abstract function.")}}class ER{constructor(e,i,n="",s=""){this.type=e,this.inputs=i,this.name=n,this.precision=s}getCode(){console.warn("Abstract function.")}}ER.isNodeFunction=!0;const Nge=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,Lge=/[a-z_0-9]+/ig,tz="#pragma main",Dge=r=>{r=r.trim();const e=r.indexOf(tz),i=e!==-1?r.slice(e+tz.length):r,n=i.match(Nge);if(n!==null&&n.length===5){const s=n[4],o=[];let l=null;for(;(l=Lge.exec(s))!==null;)o.push(l);const u=[];let c=0;for(;c<o.length;){const y=o[c][0]==="const";y===!0&&c++;let x=o[c][0];x==="in"||x==="out"||x==="inout"?c++:x="";const v=o[c++][0];let _=Number.parseInt(o[c][0]);Number.isNaN(_)===!1?c++:_=null;const T=o[c++][0];u.push(new bR(v,T,_,x,y))}const d=i.substring(n[0].length),p=n[3]!==void 0?n[3]:"",f=n[2],m=n[1]!==void 0?n[1]:"",g=e!==-1?r.slice(0,e):"";return{type:f,inputs:u,name:p,precision:m,inputsCode:s,blockCode:d,headerCode:g}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class Oge extends ER{constructor(e){const{type:i,inputs:n,name:s,precision:o,inputsCode:l,blockCode:u,headerCode:c}=Dge(e);super(i,n,s,o),this.inputsCode=l,this.blockCode=u,this.headerCode=c}getCode(e=this.name){let i;const n=this.blockCode;if(n!==""){const{type:s,inputsCode:o,headerCode:l,precision:u}=this;let c=`${s} ${e} ( ${o.trim()} )`;u!==""&&(c=`${u} ${c}`),i=l+c+n}else i="";return i}}class Pge extends ez{parseFunction(e){return new Oge(e)}}const iz=new WeakMap;class Fge extends gd{constructor(e,i){super(),this.renderer=e,this.backend=i,this.nodeFrame=new Z8,this.nodeBuilderCache=new Map,this.callHashCache=new zc,this.groupsData=new zc}updateGroup(e){const i=e.groupNode,n=i.name;if(n===q5.name)return!0;if(n===Cn.name){const l=this.get(e),u=this.nodeFrame.renderId;return l.renderId!==u?(l.renderId=u,!0):!1}if(n===xue.name){const l=this.get(e),u=this.nodeFrame.frameId;return l.frameId!==u?(l.frameId=u,!0):!1}const s=[i,e];let o=this.groupsData.get(s);return o===void 0&&this.groupsData.set(s,o={}),o.version!==i.version?(o.version=i.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const i=this.get(e);let n=i.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:s}=this,o=this.getForRenderCacheKey(e);if(n=s.get(o),n===void 0){const l=this.backend.createNodeBuilder(e.object,this.renderer);l.scene=e.scene,l.material=e.material,l.camera=e.camera,l.context.material=e.material,l.lightsNode=e.lightsNode,l.environmentNode=this.getEnvironmentNode(e.scene),l.fogNode=this.getFogNode(e.scene),l.clippingContext=e.clippingContext,l.build(),n=this._createNodeBuilderState(l),s.set(o,n)}n.usedTimes++,i.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const i=this.get(e).nodeBuilderState;i.usedTimes--,i.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const i=this.get(e);let n=i.nodeBuilderState;if(n===void 0){const s=this.backend.createNodeBuilder(e,this.renderer);s.build(),n=this._createNodeBuilderState(s),i.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new ege(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.monitor,e.transforms)}getEnvironmentNode(e){return e.environmentNode||this.get(e).environmentNode||null}getBackgroundNode(e){return e.backgroundNode||this.get(e).backgroundNode||null}getFogNode(e){return e.fogNode||this.get(e).fogNode||null}getCacheKey(e,i){const n=[e,i],s=this.renderer.info.calls;let o=this.callHashCache.get(n);if(o===void 0||o.callId!==s){const l=this.getEnvironmentNode(e),u=this.getFogNode(e),c=[];i&&c.push(i.getCacheKey(!0)),l&&c.push(l.getCacheKey()),u&&c.push(u.getCacheKey()),c.push(this.renderer.shadowMap.enabled?1:0),o={callId:s,cacheKey:R5(c)},this.callHashCache.set(n,o)}return o.cacheKey}updateScene(e){this.updateEnvironment(e),this.updateFog(e),this.updateBackground(e)}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const i=this.get(e),n=e.background;if(n){const s=e.backgroundBlurriness===0&&i.backgroundBlurriness>0||e.backgroundBlurriness>0&&i.backgroundBlurriness===0;if(i.background!==n||s){let o=null;if(n.isCubeTexture===!0||n.mapping===FA||n.mapping===kA||n.mapping===iM)if(e.backgroundBlurriness>0||n.mapping===iM)o=b8(n);else{let l;n.isCubeTexture===!0?l=dy(n):l=Ds(n),o=J6(l)}else n.isTexture===!0?o=Ds(n,yy.flipY()).setUpdateMatrix(!0):n.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",n);i.backgroundNode=o,i.background=n,i.backgroundBlurriness=e.backgroundBlurriness}}else i.backgroundNode&&(delete i.backgroundNode,delete i.background)}updateFog(e){const i=this.get(e),n=e.fog;if(n){if(i.fog!==n){let s=null;if(n.isFogExp2){const o=Ms("color","color",n).setGroup(Cn),l=Ms("density","float",n).setGroup(Cn);s=Ome(o,l)}else if(n.isFog){const o=Ms("color","color",n).setGroup(Cn),l=Ms("near","float",n).setGroup(Cn),u=Ms("far","float",n).setGroup(Cn);s=Lme(o,l,u)}else console.error("WebGPUNodes: Unsupported fog configuration.",n);i.fogNode=s,i.fog=n}}else delete i.fogNode,delete i.fog}updateEnvironment(e){const i=this.get(e),n=e.environment;if(n){if(i.environment!==n){let s=null;n.isCubeTexture===!0?s=dy(n):n.isTexture===!0?s=Ds(n):console.error("Nodes: Unsupported environment configuration.",n),i.environmentNode=s,i.environment=n}}else i.environmentNode&&(delete i.environmentNode,delete i.environment)}getNodeFrame(e=this.renderer,i=null,n=null,s=null,o=null){const l=this.nodeFrame;return l.renderer=e,l.scene=i,l.object=n,l.camera=s,l.material=o,l}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return iz.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const i=this.renderer,n=this.getOutputCacheKey(),s=Ds(e,yy).renderOutput(i.toneMapping,i.currentColorSpace);return iz.set(e,n),s}updateBefore(e){const i=e.getNodeBuilderState();for(const n of i.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const i=e.getNodeBuilderState();for(const n of i.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const i=this.getNodeFrame(),n=this.getForCompute(e);for(const s of n.updateNodes)i.updateNode(s)}updateForRender(e){const i=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const s of n.updateNodes)i.updateNode(s)}needsRefresh(e){const i=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,i)}dispose(){super.dispose(),this.nodeFrame=new Z8,this.nodeBuilderCache=new Map}}class kge{constructor(e,i){this.scene=e,this.camera=i}clone(){return Object.assign(new this.constructor,this)}}class Uge{constructor(){this.lists=new zc}get(e,i){const n=this.lists,s=[e,i];let o=n.get(s);return o===void 0&&(o=new kge(e,i),n.set(s,o)),o}dispose(){this.lists=new zc}}class rz{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let i=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){i=new n;for(const s in e)i[s]=e[s]}return i}addToneMapping(e,i){this.addType(e,i,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,i){this.addType(e,i.type,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,i){this.addClass(e,i,this.lightNodes)}addType(e,i,n){if(n.has(i)){console.warn(`Redefinition of node ${i}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof i=="function"||typeof i=="object")throw new Error(`Base class ${i} is not a class.`);n.set(i,e)}addClass(e,i,n){if(n.has(i)){console.warn(`Redefinition of node ${i.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof i!="function")throw new Error(`Base class ${i.name} is not a class.`);n.set(i,e)}}const zge=new z8;class jge extends zc{constructor(){super()}createNode(e=[]){return new z8().setLights(e)}getNode(e,i){if(e.isQuadMesh)return zge;const n=[e,i];let s=this.get(n);return s===void 0&&(s=this.createNode(),this.set(n,s)),s}}const nz=new d5,A_=new Nn,wR=new Kn,CR=new m5,y_=new bs,vd=new Kn;class Vge{constructor(e,i={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:s=!0,depth:o=!0,stencil:l=!1,antialias:u=!1,samples:c=0,getFallback:d=null}=i;this.domElement=e.getDomElement(),this.backend=e,this.samples=c||u===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=s,this.logarithmicDepthBuffer=n,this.outputColorSpace=Nr,this.toneMapping=Gm,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=o,this.stencil=l,this.clippingPlanes=[],this.info=new Jfe,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new rz,this.lighting=new jge,this._getFallback=d,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Kn(0,0,this._width,this._height),this._scissor=new Kn(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new B8(new ta),this._quad.material.type="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const p=this.alpha===!0?0:1;this._clearColor=new eR(0,0,0,p),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:Zoe},this.xr={enabled:!1},this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(f,m,g)=>{await this.compileAsync(f,m);const y=this._renderLists.get(f,m),x=this._renderContexts.get(f,m,this._renderTarget),v=f.overrideMaterial||g.material,_=this._objects.get(g,v,f,m,y.lightsNode,x),{fragmentShader:T,vertexShader:w}=_.getNodeBuilderState();return{fragmentShader:T,vertexShader:w}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,i)=>{let n=this.backend;try{await n.init(this)}catch(s){if(this._getFallback!==null)try{this.backend=n=this._getFallback(s),await n.init(this)}catch(o){i(o);return}else{i(s);return}}this._nodes=new Fge(this,n),this._animation=new jfe(this._nodes,this.info),this._attributes=new Xfe(n),this._background=new Zme(this,this._nodes),this._geometries=new Kfe(this._attributes,this.info),this._textures=new ume(this,n,this.info),this._pipelines=new tme(n,this._nodes),this._bindings=new ime(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Wfe(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new sme(this.lighting),this._bundles=new Uge,this._renderContexts=new lme,this._initialized=!0,e()}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,i,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const s=this._nodes.nodeFrame,o=s.renderId,l=this._currentRenderContext,u=this._currentRenderObjectFunction,c=this._compilationPromises,d=e.isScene===!0?e:nz;n===null&&(n=e);const p=this._renderTarget,f=this._renderContexts.get(n,i,p),m=this._activeMipmapLevel,g=[];this._currentRenderContext=f,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=g,s.renderId++,s.update(),f.depth=this.depth,f.stencil=this.stencil,f.clippingContext||(f.clippingContext=new Z3),f.clippingContext.updateGlobal(this,i),d.onBeforeRender(this,e,i,p);const y=this._renderLists.get(e,i);if(y.begin(),this._projectObject(e,i,0,y),n!==e&&n.traverseVisible(function(T){T.isLight&&T.layers.test(i.layers)&&y.pushLight(T)}),y.finish(),p!==null){this._textures.updateRenderTarget(p,m);const T=this._textures.get(p);f.textures=T.textures,f.depthTexture=T.depthTexture}else f.textures=null,f.depthTexture=null;this._nodes.updateScene(d),this._background.update(d,y,f);const x=y.opaque,v=y.transparent,_=y.lightsNode;this.opaque===!0&&x.length>0&&this._renderObjects(x,i,d,_),this.transparent===!0&&v.length>0&&this._renderTransparents(v,i,d,_),s.renderId=o,this._currentRenderContext=l,this._currentRenderObjectFunction=u,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(g)}async renderAsync(e,i){this._initialized===!1&&await this.init();const n=this._renderScene(e,i);await this.backend.resolveTimestampAsync(n,"render")}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}_onDeviceLost(e){let i=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(i+=`
Reason: ${e.reason}`),console.error(i),this._isDeviceLost=!0}_renderBundle(e,i,n){const{bundleGroup:s,camera:o,renderList:l}=e,u=this._currentRenderContext,c=this._bundles.get(s,o),d=this.backend.get(c);d.renderContexts===void 0&&(d.renderContexts=new Set);const p=s.version!==d.version,f=d.renderContexts.has(u)===!1||p;if(d.renderContexts.add(u),f){this.backend.beginBundle(u),(d.renderObjects===void 0||p)&&(d.renderObjects=[]),this._currentRenderBundle=c;const m=l.opaque;this.opaque===!0&&m.length>0&&this._renderObjects(m,o,i,n),this._currentRenderBundle=null,this.backend.finishBundle(u,c),d.version=s.version}else{const{renderObjects:m}=d;for(let g=0,y=m.length;g<y;g++){const x=m[g];this._nodes.needsRefresh(x)&&(this._nodes.updateBefore(x),this._nodes.updateForRender(x),this._bindings.updateForRender(x),this._nodes.updateAfter(x))}}this.backend.addBundle(u,c)}render(e,i){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,i);this._renderScene(e,i)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:i}=this;if(e===Gm&&i===id)return null;const{width:n,height:s}=this.getDrawingBufferSize(A_),{depth:o,stencil:l}=this;let u=this._frameBufferTarget;return u===null&&(u=new eg(n,s,{depthBuffer:o,stencilBuffer:l,type:Du,format:Xm,colorSpace:id,generateMipmaps:!1,minFilter:ol,magFilter:ol,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u),u.depthBuffer=o,u.stencilBuffer=l,u.setSize(n,s),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u}_renderScene(e,i,n=!0){if(this._isDeviceLost===!0)return;const s=n?this._getFrameBufferTarget():null,o=this._nodes.nodeFrame,l=o.renderId,u=this._currentRenderContext,c=this._currentRenderObjectFunction,d=e.isScene===!0?e:nz,p=this._renderTarget,f=this._activeCubeFace,m=this._activeMipmapLevel;let g;s!==null?(g=s,this.setRenderTarget(g)):g=p;const y=this._renderContexts.get(e,i,g);this._currentRenderContext=y,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,o.renderId=this.info.calls;const x=this.coordinateSystem;i.coordinateSystem!==x&&(i.coordinateSystem=x,i.updateProjectionMatrix()),e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),i.parent===null&&i.matrixWorldAutoUpdate===!0&&i.updateMatrixWorld();let v=this._viewport,_=this._scissor,T=this._pixelRatio;g!==null&&(v=g.viewport,_=g.scissor,T=1),this.getDrawingBufferSize(A_),wR.set(0,0,A_.width,A_.height);const w=v.minDepth===void 0?0:v.minDepth,S=v.maxDepth===void 0?1:v.maxDepth;y.viewportValue.copy(v).multiplyScalar(T).floor(),y.viewportValue.width>>=m,y.viewportValue.height>>=m,y.viewportValue.minDepth=w,y.viewportValue.maxDepth=S,y.viewport=y.viewportValue.equals(wR)===!1,y.scissorValue.copy(_).multiplyScalar(T).floor(),y.scissor=this._scissorTest&&y.scissorValue.equals(wR)===!1,y.scissorValue.width>>=m,y.scissorValue.height>>=m,y.clippingContext||(y.clippingContext=new Z3),y.clippingContext.updateGlobal(this,i),d.onBeforeRender(this,e,i,g),y_.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),CR.setFromProjectionMatrix(y_,x);const R=this._renderLists.get(e,i);if(R.begin(),this._projectObject(e,i,0,R),R.finish(),this.sortObjects===!0&&R.sort(this._opaqueSort,this._transparentSort),g!==null){this._textures.updateRenderTarget(g,m);const U=this._textures.get(g);y.textures=U.textures,y.depthTexture=U.depthTexture,y.width=U.width,y.height=U.height,y.renderTarget=g,y.depth=g.depthBuffer,y.stencil=g.stencilBuffer}else y.textures=null,y.depthTexture=null,y.width=this.domElement.width,y.height=this.domElement.height,y.depth=this.depth,y.stencil=this.stencil;y.width>>=m,y.height>>=m,y.activeCubeFace=f,y.activeMipmapLevel=m,y.occlusionQueryCount=R.occlusionQueryCount,this._nodes.updateScene(d),this._background.update(d,R,y),this.backend.beginRender(y);const{bundles:B,lightsNode:I,transparentDoublePass:D,transparent:L,opaque:O}=R;if(B.length>0&&this._renderBundles(B,d,I),this.opaque===!0&&O.length>0&&this._renderObjects(O,i,d,I),this.transparent===!0&&L.length>0&&this._renderTransparents(L,D,i,d,I),this.backend.finishRender(y),o.renderId=l,this._currentRenderContext=u,this._currentRenderObjectFunction=c,s!==null){this.setRenderTarget(p,f,m);const U=this._quad;this._nodes.hasOutputChange(g.texture)&&(U.material.fragmentNode=this._nodes.getOutputNode(g.texture),U.material.needsUpdate=!0),this._renderScene(U,U.camera,!1)}return d.onAfterRender(this,e,i,g),y}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,i,n){this._width=e,this._height=i,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(i*n),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setSize(e,i,n=!0){this._width=e,this._height=i,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(i*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=i+"px"),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const i=this._scissor;return e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height,e}setScissor(e,i,n,s){const o=this._scissor;e.isVector4?o.copy(e):o.set(e,i,n,s)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,i,n,s,o=0,l=1){const u=this._viewport;e.isVector4?u.copy(e):u.set(e,i,n,s),u.minDepth=o,u.maxDepth=l}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,i=1){this._clearColor.set(e),this._clearColor.a=i}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const i=this._currentRenderContext;return i&&this.backend.isOccluded(i,e)}clear(e=!0,i=!0,n=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,i,n);const s=this._renderTarget||this._getFrameBufferTarget();let o=null;if(s!==null&&(this._textures.updateRenderTarget(s),o=this._textures.get(s)),this.backend.clear(e,i,n,o),s!==null&&this._renderTarget===null){const l=this._quad;this._nodes.hasOutputChange(s.texture)&&(l.material.fragmentNode=this._nodes.getOutputNode(s.texture),l.material.needsUpdate=!0),this._renderScene(l,l.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,i=!0,n=!0){this._initialized===!1&&await this.init(),this.clear(e,i,n)}clearColorAsync(){return this.clearAsync(!0,!1,!1)}clearDepthAsync(){return this.clearAsync(!1,!0,!1)}clearStencilAsync(){return this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this._renderTarget!==null?Gm:this.toneMapping}get currentColorSpace(){return this._renderTarget!==null?id:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,i=0,n=0){this._renderTarget=e,this._activeCubeFace=i,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this.isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const i=this._nodes.nodeFrame,n=i.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,i.renderId=this.info.calls;const s=this.backend,o=this._pipelines,l=this._bindings,u=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const d of c){if(o.has(d)===!1){const m=()=>{d.removeEventListener("dispose",m),o.delete(d),l.delete(d),u.delete(d)};d.addEventListener("dispose",m);const g=d.onInitFunction;g!==null&&g.call(d,{renderer:this})}u.updateForCompute(d),l.updateForCompute(d);const p=l.getForCompute(d),f=o.getForCompute(d,p);s.compute(e,d,p,f)}s.finishCompute(e),i.renderId=n}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e),await this.backend.resolveTimestampAsync(e,"compute")}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}copyFramebufferToTexture(e,i=null){if(i!==null)if(i.isVector2)i=vd.set(i.x,i.y,e.image.width,e.image.height).floor();else if(i.isVector4)i=vd.copy(i).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else i=vd.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,s;n!==null?s=n.renderTarget:(s=this._renderTarget||this._getFrameBufferTarget(),s!==null&&(this._textures.updateRenderTarget(s),n=this._textures.get(s))),this._textures.updateTexture(e,{renderTarget:s}),this.backend.copyFramebufferToTexture(e,n,i)}copyTextureToTexture(e,i,n=null,s=null,o=0){this._textures.updateTexture(e),this._textures.updateTexture(i),this.backend.copyTextureToTexture(e,i,n,s,o)}readRenderTargetPixelsAsync(e,i,n,s,o,l=0,u=0){return this.backend.copyTextureToBuffer(e.textures[l],i,n,s,o,u)}_projectObject(e,i,n,s){if(e.visible===!1)return;if(e.layers.test(i.layers)){if(e.isGroup)n=e.renderOrder;else if(e.isLOD)e.autoUpdate===!0&&e.update(i);else if(e.isLight)s.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||CR.intersectsSprite(e)){this.sortObjects===!0&&vd.setFromMatrixPosition(e.matrixWorld).applyMatrix4(y_);const{geometry:l,material:u}=e;u.visible&&s.push(e,l,u,n,vd.z,null)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||CR.intersectsObject(e))){const{geometry:l,material:u}=e;if(this.sortObjects===!0&&(l.boundingSphere===null&&l.computeBoundingSphere(),vd.copy(l.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(y_)),Array.isArray(u)){const c=l.groups;for(let d=0,p=c.length;d<p;d++){const f=c[d],m=u[f.materialIndex];m&&m.visible&&s.push(e,l,m,n,vd.z,f)}}else u.visible&&s.push(e,l,u,n,vd.z,null)}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=s;s=this._renderLists.get(e,i),s.begin(),l.pushBundle({bundleGroup:e,camera:i,renderList:s}),s.finish()}const o=e.children;for(let l=0,u=o.length;l<u;l++)this._projectObject(o[l],i,n,s)}_renderBundles(e,i,n){for(const s of e)this._renderBundle(s,i,n)}_renderTransparents(e,i,n,s,o){if(i.length>0){for(const{material:l}of i)l.side=lc;this._renderObjects(i,n,s,o,"backSide");for(const{material:l}of i)l.side=zm;this._renderObjects(e,n,s,o);for(const{material:l}of i)l.side=jm}else this._renderObjects(e,n,s,o)}_renderObjects(e,i,n,s,o=null){for(let l=0,u=e.length;l<u;l++){const c=e[l],{object:d,geometry:p,material:f,group:m}=c;if(i.isArrayCamera){const g=i.cameras;for(let y=0,x=g.length;y<x;y++){const v=g[y];if(d.layers.test(v.layers)){const _=v.viewport,T=_.minDepth===void 0?0:_.minDepth,w=_.maxDepth===void 0?1:_.maxDepth,S=this._currentRenderContext.viewportValue;S.copy(_).multiplyScalar(this._pixelRatio).floor(),S.minDepth=T,S.maxDepth=w,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(d,n,v,p,f,m,s,o)}}}else this._currentRenderObjectFunction(d,n,i,p,f,m,s,o)}}renderObject(e,i,n,s,o,l,u,c=null){let d,p,f;if(e.onBeforeRender(this,i,n,s,o,l),i.overrideMaterial!==null){const m=i.overrideMaterial;o.positionNode&&o.positionNode.isNode&&(d=m.positionNode,m.positionNode=o.positionNode),m.isShadowNodeMaterial&&(m.side=o.shadowSide===null?o.side:o.shadowSide,o.depthNode&&o.depthNode.isNode&&(f=m.depthNode,m.depthNode=o.depthNode),o.shadowNode&&o.shadowNode.isNode&&(p=m.fragmentNode,m.fragmentNode=o.shadowNode),this.localClippingEnabled&&(o.clipShadows?(m.clippingPlanes!==o.clippingPlanes&&(m.clippingPlanes=o.clippingPlanes,m.needsUpdate=!0),m.clipIntersection!==o.clipIntersection&&(m.clipIntersection=o.clipIntersection)):Array.isArray(m.clippingPlanes)&&(m.clippingPlanes=null,m.needsUpdate=!0))),o=m}o.transparent===!0&&o.side===jm&&o.forceSinglePass===!1?(o.side=lc,this._handleObjectFunction(e,o,i,n,u,l,"backSide"),o.side=zm,this._handleObjectFunction(e,o,i,n,u,l,c),o.side=jm):this._handleObjectFunction(e,o,i,n,u,l,c),d!==void 0&&(i.overrideMaterial.positionNode=d),f!==void 0&&(i.overrideMaterial.depthNode=f),p!==void 0&&(i.overrideMaterial.fragmentNode=p),e.onAfterRender(this,i,n,s,o,l)}_renderObjectDirect(e,i,n,s,o,l,u){const c=this._objects.get(e,i,n,s,o,this._currentRenderContext,u);c.drawRange=e.geometry.drawRange,c.group=l;const d=this._nodes.needsRefresh(c);d&&(this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c)),this._pipelines.updateForRender(c),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(c),c.bundle=this._currentRenderBundle.scene),this.backend.draw(c,this.info),d&&this._nodes.updateAfter(c)}_createObjectPipeline(e,i,n,s,o,l){const u=this._objects.get(e,i,n,s,o,this._currentRenderContext,l);this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class SR{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function Gge(r){return r+(Ad-r%Ad)%Ad}class sz extends SR{constructor(e,i=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=i}get byteLength(){return Gge(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class az extends sz{constructor(e,i=null){super(e,i),this.isUniformBuffer=!0}}let Hge=0;class oz extends az{constructor(e,i){super("UniformBuffer_"+Hge++,e?e.value:null),this.nodeUniform=e,this.groupNode=i}get buffer(){return this.nodeUniform.value}}class Wge extends az{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const i=this.byteLength;e=new Float32Array(new ArrayBuffer(i)),this._buffer=e}return e}get byteLength(){let e=0;for(let i=0,n=this.uniforms.length;i<n;i++){const s=this.uniforms[i],{boundary:o,itemSize:l}=s,u=e%Ad,c=Ad-u;u!==0&&c-o<0?e+=Ad-u:u%o!==0&&(e+=u%o),s.offset=e/this.bytesPerElement,e+=l*this.bytesPerElement}return Math.ceil(e/Ad)*Ad}update(){let e=!1;for(const i of this.uniforms)this.updateByType(i)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o]!==s){const l=this.buffer;l[o]=n[o]=s,i=!0}return i}updateVector2(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.x||n[o+1]!==s.y){const l=this.buffer;l[o+0]=n[o+0]=s.x,l[o+1]=n[o+1]=s.y,i=!0}return i}updateVector3(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.x||n[o+1]!==s.y||n[o+2]!==s.z){const l=this.buffer;l[o+0]=n[o+0]=s.x,l[o+1]=n[o+1]=s.y,l[o+2]=n[o+2]=s.z,i=!0}return i}updateVector4(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.x||n[o+1]!==s.y||n[o+2]!==s.z||n[o+4]!==s.w){const l=this.buffer;l[o+0]=n[o+0]=s.x,l[o+1]=n[o+1]=s.y,l[o+2]=n[o+2]=s.z,l[o+3]=n[o+3]=s.w,i=!0}return i}updateColor(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.r||n[o+1]!==s.g||n[o+2]!==s.b){const l=this.buffer;l[o+0]=n[o+0]=s.r,l[o+1]=n[o+1]=s.g,l[o+2]=n[o+2]=s.b,i=!0}return i}updateMatrix3(e){let i=!1;const n=this.values,s=e.getValue().elements,o=e.offset;if(n[o+0]!==s[0]||n[o+1]!==s[1]||n[o+2]!==s[2]||n[o+4]!==s[3]||n[o+5]!==s[4]||n[o+6]!==s[5]||n[o+8]!==s[6]||n[o+9]!==s[7]||n[o+10]!==s[8]){const l=this.buffer;l[o+0]=n[o+0]=s[0],l[o+1]=n[o+1]=s[1],l[o+2]=n[o+2]=s[2],l[o+4]=n[o+4]=s[3],l[o+5]=n[o+5]=s[4],l[o+6]=n[o+6]=s[5],l[o+8]=n[o+8]=s[6],l[o+9]=n[o+9]=s[7],l[o+10]=n[o+10]=s[8],i=!0}return i}updateMatrix4(e){let i=!1;const n=this.values,s=e.getValue().elements,o=e.offset;return qge(n,s,o)===!1&&(this.buffer.set(s,o),Qge(n,s,o),i=!0),i}}function Qge(r,e,i){for(let n=0,s=e.length;n<s;n++)r[i+n]=e[n]}function qge(r,e,i){for(let n=0,s=e.length;n<s;n++)if(r[i+n]!==e[n])return!1;return!0}let Xge=0;class lz extends Wge{constructor(e,i){super(e),this.id=Xge++,this.groupNode=i,this.isNodeUniformsGroup=!0}getNodes(){const e=[];for(const i of this.uniforms){const n=i.nodeUniform.node;if(!n)throw new Error("NodeUniformsGroup: Uniform has no node.");e.push(n)}return e}}let Yge=0;class Kge extends SR{constructor(e,i){super(e),this.id=Yge++,this.texture=i,this.version=i?i.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:i}=this;return e!==this.generation?(this.generation=e,!0):i.isVideoTexture}update(){const{texture:e,version:i}=this;return i!==e.version?(this.version=e.version,!0):!1}}class v_ extends Kge{constructor(e,i,n,s=null){super(e,i?i.value:null),this.textureNode=i,this.groupNode=n,this.access=s}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class cz extends v_{constructor(e,i,n,s){super(e,i,n,s),this.isSampledCubeTexture=!0}}class uz extends v_{constructor(e,i,n,s){super(e,i,n,s),this.isSampledTexture3D=!0}}const Jge={atan2:"atan",textureDimensions:"textureSize",equals:"equal"},Zge={low:"lowp",medium:"mediump",high:"highp"},hz={swizzleAssign:!0,storageBuffer:!1},dz=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class $ge extends J8{constructor(e,i){super(e,i,new Pge),this.uniformGroups={},this.transforms=[],this.extensions={},this.useComparisonMethod=!0}needsColorSpaceToLinearSRGB(e){return e.isVideoTexture===!0&&e.colorSpace!==wp}getMethod(e){return Jge[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const i=e.layout,n=this.flowShaderNode(e),s=[];for(const o of i.inputs)s.push(this.getType(o.type)+" "+o.name);return`${this.getType(i.type)} ${i.name}( ${s.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const i=e.value;if(i.pbo===void 0){const n=i.array,s=i.count*i.itemSize,{itemSize:o}=i,l=i.array.constructor.name.toLowerCase().includes("int");let u=l?oM:aM;o===2?u=l?lM:VA:o===3?u=l?fle:sM:o===4&&(u=l?cM:Xm);const c={Float32Array:ll,Uint8Array:ed,Uint16Array:qm,Uint32Array:Da,Int8Array:UA,Int16Array:zA,Int32Array:Ao,Uint8ClampedArray:ed},d=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(s/o))));let p=Math.ceil(s/o/d);d*p*o<s&&p++;const f=d*p*o,m=new n.constructor(f);m.set(n,0),i.array=m;const g=new xce(i.array,d,p,u,c[i.array.constructor.name]||ll);g.needsUpdate=!0,g.isPBOTexture=!0;const y=new uy(g,null,null);y.setPrecision("high"),i.pboNode=y,i.pbo=y.value,this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,i=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?i.charAt(0)+"_"+e.name:super.getPropertyName(e,i)}generatePBO(e){const{node:i,indexNode:n}=e,s=i.value;if(this.renderer.backend.has(s)){const p=this.renderer.backend.get(s);p.pbo=s.pbo}const o=this.getUniformFromNode(s.pboNode,"texture",this.shaderStage,this.context.label),l=this.getPropertyName(o);this.increaseUsage(n);const u=n.build(this,"uint"),c=this.getDataFromNode(e);let d=c.propertyName;if(d===void 0){const p=this.getVarFromNode(e);d=this.getPropertyName(p);const f=this.getDataFromNode(i);let m=f.propertySizeName;m===void 0&&(m=d+"Size",this.getVarFromNode(i,m,"uint"),this.addLineFlowCode(`${m} = uint( textureSize( ${l}, 0 ).x )`,e),f.propertySizeName=m);const{itemSize:g}=s,y="."+pg.join("").slice(0,g),x=`ivec2(${u} % ${m}, ${u} / ${m})`,v=this.generateTextureLoad(null,l,x,null,"0");let _="vec4";s.pbo.type===Da?_="uvec4":s.pbo.type===Ao&&(_="ivec4"),this.addLineFlowCode(`${d} = ${_}(${v})${y}`,e),c.propertyName=d}return d}generateTextureLoad(e,i,n,s,o="0"){return s?`texelFetch( ${i}, ivec3( ${n}, ${s} ), ${o} )`:`texelFetch( ${i}, ${n}, ${o} )`}generateTexture(e,i,n,s){return e.isDepthTexture?`texture( ${i}, ${n} ).x`:(s&&(n=`vec3( ${n}, ${s} )`),`texture( ${i}, ${n} )`)}generateTextureLevel(e,i,n,s){return`textureLod( ${i}, ${n}, ${s} )`}generateTextureBias(e,i,n,s){return`texture( ${i}, ${n}, ${s} )`}generateTextureGrad(e,i,n,s){return`textureGrad( ${i}, ${n}, ${s[0]}, ${s[1]} )`}generateTextureCompare(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`texture( ${i}, vec3( ${n}, ${s} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${l} shader.`)}getVars(e){const i=[],n=this.vars[e];if(n!==void 0)for(const s of n)i.push(`${this.getVar(s.type,s.name)};`);return i.join(`
	`)}getUniforms(e){const i=this.uniforms[e],n=[],s={};for(const l of i){let u=null,c=!1;if(l.type==="texture"){const p=l.node.value;let f="";p.isDataTexture===!0&&(p.type===Da?f="u":p.type===Ao&&(f="i")),p.compareFunction?u=`sampler2DShadow ${l.name};`:p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0?u=`${f}sampler2DArray ${l.name};`:u=`${f}sampler2D ${l.name};`}else if(l.type==="cubeTexture")u=`samplerCube ${l.name};`;else if(l.type==="texture3D")u=`sampler3D ${l.name};`;else if(l.type==="buffer"){const p=l.node,f=this.getType(p.bufferType),m=p.bufferCount,g=m>0?m:"";u=`${p.name} {
	${f} ${l.name}[${g}];
};
`}else u=`${this.getVectorType(l.type)} ${this.getPropertyName(l,e)};`,c=!0;const d=l.node.precision;if(d!==null&&(u=Zge[d]+" "+u),c){u="	"+u;const p=l.groupNode.name;(s[p]||(s[p]=[])).push(u)}else u="uniform "+u,n.push(u)}let o="";for(const l in s){const u=s[l];o+=this._getGLSLUniformStruct(e+"_"+l,u.join(`
`))+`
`}return o+=n.join(`
`),o}getTypeFromAttribute(e){let i=super.getTypeFromAttribute(e);if(/^[iu]/.test(i)&&e.gpuType!==Ao){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const s=n.array;s instanceof Uint32Array||s instanceof Int32Array||(i=i.slice(1))}return i}getAttributes(e){let i="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let s=0;for(const o of n)i+=`layout( location = ${s++} ) in ${o.type} ${o.name};
`}return i}getStructMembers(e){const i=[],n=e.getMemberTypes();for(let s=0;s<n.length;s++){const o=n[s];i.push(`layout( location = ${s} ) out ${o} m${s};`)}return i.join(`
`)}getStructs(e){const i=[],n=this.structs[e];if(n.length===0)return`layout( location = 0 ) out vec4 fragColor;
`;for(let s=0,o=n.length;s<o;s++){const l=n[s];let u=`
`;u+=this.getStructMembers(l),u+=`
`,i.push(u)}return i.join(`

`)}getVaryings(e){let i="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const s of n){e==="compute"&&(s.needsInterpolation=!0);const o=s.type,l=o.includes("int")||o.includes("uv")||o.includes("iv")?"flat ":"";i+=`${l}${s.needsInterpolation?"out":"/*out*/"} ${o} ${s.name};
`}else if(e==="fragment"){for(const s of n)if(s.needsInterpolation){const o=s.type,l=o.includes("int")||o.includes("uv")||o.includes("iv")?"flat ":"";i+=`${l}in ${o} ${s.name};
`}}return i}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((e,i)=>e*i,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,i,n=this.shaderStage){const s=this.extensions[n]||(this.extensions[n]=new Map);s.has(e)===!1&&s.set(e,{name:e,behavior:i})}getExtensions(e){const i=[];if(e==="vertex"){const s=this.renderer.backend.extensions;this.object.isBatchedMesh&&s.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:s,behavior:o}of n.values())i.push(`#extension ${s} : ${o}`);return i.join(`
`)}isAvailable(e){let i=hz[e];if(i===void 0){if(e==="float32Filterable"){const n=this.renderer.backend.extensions;n.has("OES_texture_float_linear")?(n.get("OES_texture_float_linear"),i=!0):i=!1}hz[e]=i}return i}isFlipY(){return!0}registerTransform(e,i){this.transforms.push({varyingName:e,attributeNode:i})}getTransforms(){const e=this.transforms;let i="";for(let n=0;n<e.length;n++){const s=e[n],o=this.getPropertyName(s.attributeNode);i+=`${s.varyingName} = ${o};
	`}return i}_getGLSLUniformStruct(e,i){return`
layout( std140 ) uniform ${e} {
${i}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions 
${e.extensions}

// precision
${dz}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${dz}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const i in e){let n=`// code

`;n+=this.flowCode[i];const s=this.flowNodes[i],o=s[s.length-1];for(const u of s){const c=this.getFlowData(u),d=u.name;d&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${d}
	`),n+=`${c.code}
	`,u===o&&i!=="compute"&&(n+=`// result
	`,i==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):i==="fragment"&&(u.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const l=e[i];l.extensions=this.getExtensions(i),l.uniforms=this.getUniforms(i),l.attributes=this.getAttributes(i),l.varyings=this.getVaryings(i),l.vars=this.getVars(i),l.structs=this.getStructs(i),l.codes=this.getCodes(i),l.transforms=this.getTransforms(i),l.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,i,n,s=null){const o=super.getUniformFromNode(e,i,n,s),l=this.getDataFromNode(e,n,this.globalCache);let u=l.uniformGPU;if(u===void 0){const c=e.groupNode,d=c.name,p=this.getBindGroupArray(d,n);if(i==="texture")u=new v_(o.name,o.node,c),p.push(u);else if(i==="cubeTexture")u=new cz(o.name,o.node,c),p.push(u);else if(i==="texture3D")u=new uz(o.name,o.node,c),p.push(u);else if(i==="buffer"){e.name=`NodeBuffer_${e.id}`,o.name=`buffer${e.id}`;const f=new oz(e,c);f.name=e.name,p.push(f),u=f}else{const f=this.uniformGroups[n]||(this.uniformGroups[n]={});let m=f[d];m===void 0&&(m=new lz(n+"_"+d,c),f[d]=m,p.push(m)),u=this.getNodeUniform(o,i),m.addUniform(u)}l.uniformGPU=u}return o}}let TR=null,MR=null,Ig=null;class pz{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(e){this.renderer=e}begin(){}finish(){}draw(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}createRenderPipeline(){}createComputePipeline(){}destroyPipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}createDefaultTexture(){}createTexture(){}copyTextureToBuffer(){}createAttribute(){}createIndexAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}resolveTimestampAsync(){}hasFeatureAsync(){}hasFeature(){}getInstanceCount(e){const{object:i,geometry:n}=e;return n.isInstancedBufferGeometry?n.instanceCount:i.count>1?i.count:1}getDrawingBufferSize(){return TR=TR||new Nn,this.renderer.getDrawingBufferSize(TR)}getScissor(){return MR=MR||new Kn,this.renderer.getScissor(MR)}setScissorTest(){}getClearColor(){const e=this.renderer;return Ig=Ig||new eR,e.getClearColor(Ig),Ig.getRGB(Ig,this.renderer.currentColorSpace),Ig}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:Yle(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${t1} webgpu`),this.domElement=e),e}set(e,i){this.data.set(e,i)}get(e){let i=this.data.get(e);return i===void 0&&(i={},this.data.set(e,i)),i}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let e0e=0;class t0e{constructor(e,i){this.buffers=[e.bufferGPU,i],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class i0e{constructor(e){this.backend=e}createAttribute(e,i){const n=this.backend,{gl:s}=n,o=e.array,l=e.usage||s.STATIC_DRAW,u=e.isInterleavedBufferAttribute?e.data:e,c=n.get(u);let d=c.bufferGPU;d===void 0&&(d=this._createBuffer(s,i,o,l),c.bufferGPU=d,c.bufferType=i,c.version=u.version);let p;if(o instanceof Float32Array)p=s.FLOAT;else if(o instanceof Uint16Array)e.isFloat16BufferAttribute?p=s.HALF_FLOAT:p=s.UNSIGNED_SHORT;else if(o instanceof Int16Array)p=s.SHORT;else if(o instanceof Uint32Array)p=s.UNSIGNED_INT;else if(o instanceof Int32Array)p=s.INT;else if(o instanceof Int8Array)p=s.BYTE;else if(o instanceof Uint8Array)p=s.UNSIGNED_BYTE;else if(o instanceof Uint8ClampedArray)p=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+o);let f={bufferGPU:d,bufferType:i,type:p,byteLength:o.byteLength,bytesPerElement:o.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:p===s.INT||p===s.UNSIGNED_INT||e.gpuType===Ao,id:e0e++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const m=this._createBuffer(s,i,o,l);f=new t0e(f,m)}n.set(e,f)}updateAttribute(e){const i=this.backend,{gl:n}=i,s=e.array,o=e.isInterleavedBufferAttribute?e.data:e,l=i.get(o),u=l.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(u,l.bufferGPU),c.length===0)n.bufferSubData(u,0,s);else{for(let d=0,p=c.length;d<p;d++){const f=c[d];n.bufferSubData(u,f.start*s.BYTES_PER_ELEMENT,s,f.start,f.count)}o.clearUpdateRanges()}n.bindBuffer(u,null),l.version=o.version}destroyAttribute(e){const i=this.backend,{gl:n}=i;e.isInterleavedBufferAttribute&&i.delete(e.data);const s=i.get(e);n.deleteBuffer(s.bufferGPU),i.delete(e)}async getArrayBufferAsync(e){const i=this.backend,{gl:n}=i,s=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:o}=i.get(s),l=e.array,u=l.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,o);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,u,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,u),await i.utils._clientWaitAsync();const d=new e.array.constructor(l.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,d),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),d.buffer}_createBuffer(e,i,n,s){const o=e.createBuffer();return e.bindBuffer(i,o),e.bufferData(i,n,s),e.bindBuffer(i,null),o}}let fz=!1,RR,Sy;class r0e{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},fz===!1&&(this._init(this.gl),fz=!0)}_init(e){RR={[$h]:e.FUNC_ADD,[iU]:e.FUNC_SUBTRACT,[rU]:e.FUNC_REVERSE_SUBTRACT},Sy={[nU]:e.ZERO,[sU]:e.ONE,[aU]:e.SRC_COLOR,[a1]:e.SRC_ALPHA,[dU]:e.SRC_ALPHA_SATURATE,[uU]:e.DST_COLOR,[lU]:e.DST_ALPHA,[oU]:e.ONE_MINUS_SRC_COLOR,[o1]:e.ONE_MINUS_SRC_ALPHA,[hU]:e.ONE_MINUS_DST_COLOR,[cU]:e.ONE_MINUS_DST_ALPHA}}enable(e){const{enabled:i}=this;i[e]!==!0&&(this.gl.enable(e),i[e]=!0)}disable(e){const{enabled:i}=this;i[e]!==!1&&(this.gl.disable(e),i[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:i}=this;e?i.frontFace(i.CW):i.frontFace(i.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:i}=this;e!==Yoe?(this.enable(i.CULL_FACE),e!==this.currentCullFace&&(e===Koe?i.cullFace(i.BACK):e===Joe?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):this.disable(i.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:i,gl:n}=this;e!==i&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,i,n,s,o,l,u,c){const{gl:d}=this;if(e===Vm){this.currentBlendingEnabled===!0&&(this.disable(d.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(d.BLEND),this.currentBlendingEnabled=!0),e!==tU){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==$h||this.currentBlendEquationAlpha!==$h)&&(d.blendEquation(d.FUNC_ADD),this.currentBlendEquation=$h,this.currentBlendEquationAlpha=$h),c)switch(e){case Zh:d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case r1:d.blendFunc(d.ONE,d.ONE);break;case n1:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case s1:d.blendFuncSeparate(d.ZERO,d.SRC_COLOR,d.ZERO,d.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case Zh:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case r1:d.blendFunc(d.SRC_ALPHA,d.ONE);break;case n1:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case s1:d.blendFunc(d.ZERO,d.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}o=o||i,l=l||n,u=u||s,(i!==this.currentBlendEquation||o!==this.currentBlendEquationAlpha)&&(d.blendEquationSeparate(RR[i],RR[o]),this.currentBlendEquation=i,this.currentBlendEquationAlpha=o),(n!==this.currentBlendSrc||s!==this.currentBlendDst||l!==this.currentBlendSrcAlpha||u!==this.currentBlendDstAlpha)&&(d.blendFuncSeparate(Sy[n],Sy[s],Sy[l],Sy[u]),this.currentBlendSrc=n,this.currentBlendDst=s,this.currentBlendSrcAlpha=l,this.currentBlendDstAlpha=u),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:i}=this;e?this.enable(i.DEPTH_TEST):this.disable(i.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:i}=this;switch(e){case pU:i.depthFunc(i.NEVER);break;case fU:i.depthFunc(i.ALWAYS);break;case mU:i.depthFunc(i.LESS);break;case l1:i.depthFunc(i.LEQUAL);break;case gU:i.depthFunc(i.EQUAL);break;case AU:i.depthFunc(i.GEQUAL);break;case yU:i.depthFunc(i.GREATER);break;case vU:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}this.currentDepthFunc=e}}setStencilTest(e){const{gl:i}=this;e?this.enable(i.STENCIL_TEST):this.disable(i.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,i,n){(this.currentStencilFunc!==e||this.currentStencilRef!==i||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,i,n),this.currentStencilFunc=e,this.currentStencilRef=i,this.currentStencilFuncMask=n)}setStencilOp(e,i,n){(this.currentStencilFail!==e||this.currentStencilZFail!==i||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,i,n),this.currentStencilFail=e,this.currentStencilZFail=i,this.currentStencilZPass=n)}setMaterial(e,i){const{gl:n}=this;e.side===jm?this.disable(n.CULL_FACE):this.enable(n.CULL_FACE);let s=e.side===lc;i&&(s=!s),this.setFlipSided(s),e.blending===Zh&&e.transparent===!1?this.setBlending(Vm):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(n.SAMPLE_ALPHA_TO_COVERAGE):this.disable(n.SAMPLE_ALPHA_TO_COVERAGE)}setPolygonOffset(e,i,n){const{gl:s}=this;e?(this.enable(s.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==i||this.currentPolygonOffsetUnits!==n)&&(s.polygonOffset(i,n),this.currentPolygonOffsetFactor=i,this.currentPolygonOffsetUnits=n)):this.disable(s.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}bindFramebuffer(e,i){const{gl:n,currentBoundFramebuffers:s}=this;return s[e]!==i?(n.bindFramebuffer(e,i),s[e]=i,e===n.DRAW_FRAMEBUFFER&&(s[n.FRAMEBUFFER]=i),e===n.FRAMEBUFFER&&(s[n.DRAW_FRAMEBUFFER]=i),!0):!1}drawBuffers(e,i){const{gl:n}=this;let s=[],o=!1;if(e.textures!==null){s=this.currentDrawbuffers.get(i),s===void 0&&(s=[],this.currentDrawbuffers.set(i,s));const l=e.textures;if(s.length!==l.length||s[0]!==n.COLOR_ATTACHMENT0){for(let u=0,c=l.length;u<c;u++)s[u]=n.COLOR_ATTACHMENT0+u;s.length=l.length,o=!0}}else s[0]!==n.BACK&&(s[0]=n.BACK,o=!0);o&&n.drawBuffers(s)}activeTexture(e){const{gl:i,currentTextureSlot:n,maxTextures:s}=this;e===void 0&&(e=i.TEXTURE0+s-1),n!==e&&(i.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,i,n){const{gl:s,currentTextureSlot:o,currentBoundTextures:l,maxTextures:u}=this;n===void 0&&(o===null?n=s.TEXTURE0+u-1:n=o);let c=l[n];c===void 0&&(c={type:void 0,texture:void 0},l[n]=c),(c.type!==e||c.texture!==i)&&(o!==n&&(s.activeTexture(n),this.currentTextureSlot=n),s.bindTexture(e,i),c.type=e,c.texture=i)}bindBufferBase(e,i,n){const{gl:s}=this,o=`${e}-${i}`;return this.currentBoundBufferBases[o]!==n?(s.bindBufferBase(e,i,n),this.currentBoundBufferBases[o]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:i,currentBoundTextures:n}=this,s=n[i];s!==void 0&&s.type!==void 0&&(e.bindTexture(s.type,null),s.type=void 0,s.texture=void 0)}}class n0e{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,i=wp){const{gl:n,extensions:s}=this;let o;if(e===ed)return n.UNSIGNED_BYTE;if(e===cle)return n.UNSIGNED_SHORT_4_4_4_4;if(e===ule)return n.UNSIGNED_SHORT_5_5_5_1;if(e===xU)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===UA)return n.BYTE;if(e===zA)return n.SHORT;if(e===qm)return n.UNSIGNED_SHORT;if(e===Ao)return n.INT;if(e===Da)return n.UNSIGNED_INT;if(e===ll)return n.FLOAT;if(e===Du)return n.HALF_FLOAT;if(e===hle)return n.ALPHA;if(e===sM)return n.RGB;if(e===Xm)return n.RGBA;if(e===dle)return n.LUMINANCE;if(e===ple)return n.LUMINANCE_ALPHA;if(e===Ep)return n.DEPTH_COMPONENT;if(e===Ym)return n.DEPTH_STENCIL;if(e===aM)return n.RED;if(e===oM)return n.RED_INTEGER;if(e===VA)return n.RG;if(e===lM)return n.RG_INTEGER;if(e===cM)return n.RGBA_INTEGER;if(e===uM||e===d1||e===p1||e===f1)if(i===Nr)if(o=s.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(e===uM)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===d1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===p1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===f1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=s.get("WEBGL_compressed_texture_s3tc"),o!==null){if(e===uM)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===d1)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===p1)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===f1)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===bU||e===_U||e===EU||e===wU)if(o=s.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(e===bU)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===_U)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===EU)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===wU)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===CU||e===hM||e===dM)if(o=s.get("WEBGL_compressed_texture_etc"),o!==null){if(e===CU||e===hM)return i===Nr?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(e===dM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===pM||e===fM||e===mM||e===gM||e===AM||e===yM||e===vM||e===xM||e===bM||e===_M||e===EM||e===wM||e===CM||e===SM)if(o=s.get("WEBGL_compressed_texture_astc"),o!==null){if(e===pM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===fM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===mM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===gM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===AM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===yM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===vM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===xM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===bM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===_M)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===EM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===wM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===CM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===SM)return i===Nr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===TM)if(o=s.get("EXT_texture_compression_bptc"),o!==null){if(e===TM)return i===Nr?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===mle||e===SU||e===TU||e===MU)if(o=s.get("EXT_texture_compression_rgtc"),o!==null){if(e===TM)return o.COMPRESSED_RED_RGTC1_EXT;if(e===SU)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===TU)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===MU)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===jA?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,i=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,s)=>{function o(){const l=e.clientWaitSync(i,e.SYNC_FLUSH_COMMANDS_BIT,0);if(l===e.WAIT_FAILED){e.deleteSync(i),s();return}if(l===e.TIMEOUT_EXPIRED){requestAnimationFrame(o);return}e.deleteSync(i),n()}o()})}}let mz=!1,x_,IR,gz;class s0e{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},mz===!1&&(this._init(this.gl),mz=!0)}_init(e){x_={[u1]:e.REPEAT,[Wm]:e.CLAMP_TO_EDGE,[h1]:e.MIRRORED_REPEAT},IR={[Ja]:e.NEAREST,[rM]:e.NEAREST_MIPMAP_NEAREST,[Qm]:e.NEAREST_MIPMAP_LINEAR,[ol]:e.LINEAR,[nM]:e.LINEAR_MIPMAP_NEAREST,[Lu]:e.LINEAR_MIPMAP_LINEAR},gz={[IU]:e.NEVER,[PU]:e.ALWAYS,[RM]:e.LESS,[NU]:e.LEQUAL,[BU]:e.EQUAL,[OU]:e.GEQUAL,[LU]:e.GREATER,[DU]:e.NOTEQUAL}}filterFallback(e){const{gl:i}=this;return e===Ja||e===rM||e===Qm?i.NEAREST:i.LINEAR}getGLTextureType(e){const{gl:i}=this;let n;return e.isCubeTexture===!0?n=i.TEXTURE_CUBE_MAP:e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=i.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=i.TEXTURE_3D:n=i.TEXTURE_2D,n}getInternalFormat(e,i,n,s,o=!1){const{gl:l,extensions:u}=this;if(e!==null){if(l[e]!==void 0)return l[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=i;return i===l.RED&&(n===l.FLOAT&&(c=l.R32F),n===l.HALF_FLOAT&&(c=l.R16F),n===l.UNSIGNED_BYTE&&(c=l.R8),n===l.UNSIGNED_SHORT&&(c=l.R16),n===l.UNSIGNED_INT&&(c=l.R32UI),n===l.BYTE&&(c=l.R8I),n===l.SHORT&&(c=l.R16I),n===l.INT&&(c=l.R32I)),i===l.RED_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.R8UI),n===l.UNSIGNED_SHORT&&(c=l.R16UI),n===l.UNSIGNED_INT&&(c=l.R32UI),n===l.BYTE&&(c=l.R8I),n===l.SHORT&&(c=l.R16I),n===l.INT&&(c=l.R32I)),i===l.RG&&(n===l.FLOAT&&(c=l.RG32F),n===l.HALF_FLOAT&&(c=l.RG16F),n===l.UNSIGNED_BYTE&&(c=l.RG8),n===l.UNSIGNED_SHORT&&(c=l.RG16),n===l.UNSIGNED_INT&&(c=l.RG32UI),n===l.BYTE&&(c=l.RG8I),n===l.SHORT&&(c=l.RG16I),n===l.INT&&(c=l.RG32I)),i===l.RG_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.RG8UI),n===l.UNSIGNED_SHORT&&(c=l.RG16UI),n===l.UNSIGNED_INT&&(c=l.RG32UI),n===l.BYTE&&(c=l.RG8I),n===l.SHORT&&(c=l.RG16I),n===l.INT&&(c=l.RG32I)),i===l.RGB&&(n===l.FLOAT&&(c=l.RGB32F),n===l.HALF_FLOAT&&(c=l.RGB16F),n===l.UNSIGNED_BYTE&&(c=l.RGB8),n===l.UNSIGNED_SHORT&&(c=l.RGB16),n===l.UNSIGNED_INT&&(c=l.RGB32UI),n===l.BYTE&&(c=l.RGB8I),n===l.SHORT&&(c=l.RGB16I),n===l.INT&&(c=l.RGB32I),n===l.UNSIGNED_BYTE&&(c=s===Nr&&o===!1?l.SRGB8:l.RGB8),n===l.UNSIGNED_SHORT_5_6_5&&(c=l.RGB565),n===l.UNSIGNED_SHORT_5_5_5_1&&(c=l.RGB5_A1),n===l.UNSIGNED_SHORT_4_4_4_4&&(c=l.RGB4),n===l.UNSIGNED_INT_5_9_9_9_REV&&(c=l.RGB9_E5)),i===l.RGB_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.RGB8UI),n===l.UNSIGNED_SHORT&&(c=l.RGB16UI),n===l.UNSIGNED_INT&&(c=l.RGB32UI),n===l.BYTE&&(c=l.RGB8I),n===l.SHORT&&(c=l.RGB16I),n===l.INT&&(c=l.RGB32I)),i===l.RGBA&&(n===l.FLOAT&&(c=l.RGBA32F),n===l.HALF_FLOAT&&(c=l.RGBA16F),n===l.UNSIGNED_BYTE&&(c=l.RGBA8),n===l.UNSIGNED_SHORT&&(c=l.RGBA16),n===l.UNSIGNED_INT&&(c=l.RGBA32UI),n===l.BYTE&&(c=l.RGBA8I),n===l.SHORT&&(c=l.RGBA16I),n===l.INT&&(c=l.RGBA32I),n===l.UNSIGNED_BYTE&&(c=s===Nr&&o===!1?l.SRGB8_ALPHA8:l.RGBA8),n===l.UNSIGNED_SHORT_4_4_4_4&&(c=l.RGBA4),n===l.UNSIGNED_SHORT_5_5_5_1&&(c=l.RGB5_A1)),i===l.RGBA_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.RGBA8UI),n===l.UNSIGNED_SHORT&&(c=l.RGBA16UI),n===l.UNSIGNED_INT&&(c=l.RGBA32UI),n===l.BYTE&&(c=l.RGBA8I),n===l.SHORT&&(c=l.RGBA16I),n===l.INT&&(c=l.RGBA32I)),i===l.DEPTH_COMPONENT&&(n===l.UNSIGNED_INT&&(c=l.DEPTH24_STENCIL8),n===l.FLOAT&&(c=l.DEPTH_COMPONENT32F)),i===l.DEPTH_STENCIL&&n===l.UNSIGNED_INT_24_8&&(c=l.DEPTH24_STENCIL8),(c===l.R16F||c===l.R32F||c===l.RG16F||c===l.RG32F||c===l.RGBA16F||c===l.RGBA32F)&&u.get("EXT_color_buffer_float"),c}setTextureParameters(e,i){const{gl:n,extensions:s,backend:o}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,i.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,i.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(e,n.TEXTURE_WRAP_S,x_[i.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,x_[i.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&n.texParameteri(e,n.TEXTURE_WRAP_R,x_[i.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,IR[i.magFilter]);const l=i.mipmaps!==void 0&&i.mipmaps.length>0,u=i.minFilter===ol&&l?Lu:i.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,IR[u]),i.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,gz[i.compareFunction])),s.has("EXT_texture_filter_anisotropic")===!0){if(i.magFilter===Ja||i.minFilter!==Qm&&i.minFilter!==Lu||i.type===ll&&s.has("OES_texture_float_linear")===!1)return;if(i.anisotropy>1){const c=s.get("EXT_texture_filter_anisotropic");n.texParameterf(e,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,o.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:i,backend:n,defaultTextures:s}=this,o=this.getGLTextureType(e);let l=s[o];l===void 0&&(l=i.createTexture(),n.state.bindTexture(o,l),i.texParameteri(o,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(o,i.TEXTURE_MAG_FILTER,i.NEAREST),s[o]=l),n.set(e,{textureGPU:l,glTextureType:o,isDefault:!0})}createTexture(e,i){const{gl:n,backend:s}=this,{levels:o,width:l,height:u,depth:c}=i,d=s.utils.convert(e.format,e.colorSpace),p=s.utils.convert(e.type),f=this.getInternalFormat(e.internalFormat,d,p,e.colorSpace,e.isVideoTexture),m=n.createTexture(),g=this.getGLTextureType(e);s.state.bindTexture(g,m),this.setTextureParameters(g,e),e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,o,f,l,u,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,o,f,l,u,c):e.isVideoTexture||n.texStorage2D(g,o,f,l,u),s.set(e,{textureGPU:m,glTextureType:g,glFormat:d,glType:p,glInternalFormat:f})}copyBufferToTexture(e,i){const{gl:n,backend:s}=this,{textureGPU:o,glTextureType:l,glFormat:u,glType:c}=s.get(i),{width:d,height:p}=i.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),s.state.bindTexture(l,o),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(l,0,0,0,d,p,u,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),s.state.unbindTexture()}updateTexture(e,i){const{gl:n}=this,{width:s,height:o}=i,{textureGPU:l,glTextureType:u,glFormat:c,glType:d,glInternalFormat:p}=this.backend.get(e);if(e.isRenderTargetTexture||l===void 0)return;const f=m=>m.isDataTexture?m.image.data:m instanceof ImageBitmap||m instanceof OffscreenCanvas||m instanceof HTMLImageElement||m instanceof HTMLCanvasElement?m:m.data;if(this.backend.state.bindTexture(u,l),this.setTextureParameters(u,e),e.isCompressedTexture){const m=e.mipmaps,g=i.image;for(let y=0;y<m.length;y++){const x=m[y];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,x.width,x.height,g.depth,c,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,x.width,x.height,g.depth,c,d,x.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,y,0,0,x.width,x.height,c,x.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const m=i.images;for(let g=0;g<6;g++){const y=f(m[g]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,0,0,s,o,c,d,y)}}else if(e.isDataArrayTexture){const m=i.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,c,d,m.data)}else if(e.isData3DTexture){const m=i.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,c,d,m.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(u,0,p,c,d,i.image);else{const m=f(i.image);n.texSubImage2D(u,0,0,0,s,o,c,d,m)}}generateMipmaps(e){const{gl:i,backend:n}=this,{textureGPU:s,glTextureType:o}=n.get(e);n.state.bindTexture(o,s),i.generateMipmap(o)}deallocateRenderBuffers(e){const{gl:i,backend:n}=this;if(e){const s=n.get(e);if(s.renderBufferStorageSetup=void 0,s.framebuffers){for(const o in s.framebuffers)i.deleteFramebuffer(s.framebuffers[o]);delete s.framebuffers}if(s.depthRenderbuffer&&(i.deleteRenderbuffer(s.depthRenderbuffer),delete s.depthRenderbuffer),s.stencilRenderbuffer&&(i.deleteRenderbuffer(s.stencilRenderbuffer),delete s.stencilRenderbuffer),s.msaaFrameBuffer&&(i.deleteFramebuffer(s.msaaFrameBuffer),delete s.msaaFrameBuffer),s.msaaRenderbuffers){for(let o=0;o<s.msaaRenderbuffers.length;o++)i.deleteRenderbuffer(s.msaaRenderbuffers[o]);delete s.msaaRenderbuffers}}}destroyTexture(e){const{gl:i,backend:n}=this,{textureGPU:s,renderTarget:o}=n.get(e);this.deallocateRenderBuffers(o),i.deleteTexture(s),n.delete(e)}copyTextureToTexture(e,i,n=null,s=null,o=0){const{gl:l,backend:u}=this,{state:c}=this.backend,{textureGPU:d,glTextureType:p,glType:f,glFormat:m}=u.get(i);let g,y,x,v,_,T;n!==null?(g=n.max.x-n.min.x,y=n.max.y-n.min.y,x=n.min.x,v=n.min.y):(g=e.image.width,y=e.image.height,x=0,v=0),s!==null?(_=s.x,T=s.y):(_=0,T=0),c.bindTexture(p,d),l.pixelStorei(l.UNPACK_ALIGNMENT,i.unpackAlignment),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i.flipY),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),l.pixelStorei(l.UNPACK_ALIGNMENT,i.unpackAlignment);const w=l.getParameter(l.UNPACK_ROW_LENGTH),S=l.getParameter(l.UNPACK_IMAGE_HEIGHT),R=l.getParameter(l.UNPACK_SKIP_PIXELS),B=l.getParameter(l.UNPACK_SKIP_ROWS),I=l.getParameter(l.UNPACK_SKIP_IMAGES),D=e.isCompressedTexture?e.mipmaps[o]:e.image;if(l.pixelStorei(l.UNPACK_ROW_LENGTH,D.width),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,D.height),l.pixelStorei(l.UNPACK_SKIP_PIXELS,x),l.pixelStorei(l.UNPACK_SKIP_ROWS,v),e.isRenderTargetTexture||e.isDepthTexture){const L=u.get(e),O=u.get(i),U=u.get(L.renderTarget),J=u.get(O.renderTarget),H=U.framebuffers[L.cacheKey],V=J.framebuffers[O.cacheKey];c.bindFramebuffer(l.READ_FRAMEBUFFER,H),c.bindFramebuffer(l.DRAW_FRAMEBUFFER,V);let $=l.COLOR_BUFFER_BIT;e.isDepthTexture&&($=l.DEPTH_BUFFER_BIT),l.blitFramebuffer(x,v,g,y,_,T,g,y,$,l.NEAREST),c.bindFramebuffer(l.READ_FRAMEBUFFER,null),c.bindFramebuffer(l.DRAW_FRAMEBUFFER,null)}else e.isDataTexture?l.texSubImage2D(l.TEXTURE_2D,o,_,T,g,y,m,f,D.data):e.isCompressedTexture?l.compressedTexSubImage2D(l.TEXTURE_2D,o,_,T,D.width,D.height,m,D.data):l.texSubImage2D(l.TEXTURE_2D,o,_,T,g,y,m,f,D);l.pixelStorei(l.UNPACK_ROW_LENGTH,w),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,S),l.pixelStorei(l.UNPACK_SKIP_PIXELS,R),l.pixelStorei(l.UNPACK_SKIP_ROWS,B),l.pixelStorei(l.UNPACK_SKIP_IMAGES,I),o===0&&i.generateMipmaps&&l.generateMipmap(l.TEXTURE_2D),c.unbindTexture()}copyFramebufferToTexture(e,i,n){const{gl:s}=this,{state:o}=this.backend,{textureGPU:l}=this.backend.get(e),{x:u,y:c,z:d,w:p}=n,f=e.isDepthTexture===!0||i.renderTarget&&i.renderTarget.samples>0,m=i.renderTarget?i.renderTarget.height:this.backend.gerDrawingBufferSize().y;if(f){const g=u!==0||c!==0;let y,x;if(e.isDepthTexture===!0?(y=s.DEPTH_BUFFER_BIT,x=s.DEPTH_ATTACHMENT,i.stencil&&(y|=s.STENCIL_BUFFER_BIT)):(y=s.COLOR_BUFFER_BIT,x=s.COLOR_ATTACHMENT0),g){const v=this.backend.get(i.renderTarget),_=v.framebuffers[i.getCacheKey()],T=v.msaaFrameBuffer;o.bindFramebuffer(s.DRAW_FRAMEBUFFER,_),o.bindFramebuffer(s.READ_FRAMEBUFFER,T);const w=m-c-p;s.blitFramebuffer(u,w,u+d,w+p,u,w,u+d,w+p,y,s.NEAREST),o.bindFramebuffer(s.READ_FRAMEBUFFER,_),o.bindTexture(s.TEXTURE_2D,l),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,u,w,d,p),o.unbindTexture()}else{const v=s.createFramebuffer();o.bindFramebuffer(s.DRAW_FRAMEBUFFER,v),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,x,s.TEXTURE_2D,l,0),s.blitFramebuffer(0,0,d,p,0,0,d,p,y,s.NEAREST),s.deleteFramebuffer(v)}}else o.bindTexture(s.TEXTURE_2D,l),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,u,m-p-c,d,p),o.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(i)}setupRenderBufferStorage(e,i){const{gl:n}=this,s=i.renderTarget,{samples:o,depthTexture:l,depthBuffer:u,stencilBuffer:c,width:d,height:p}=s;if(n.bindRenderbuffer(n.RENDERBUFFER,e),u&&!c){let f=n.DEPTH_COMPONENT24;o>0?(l&&l.isDepthTexture&&l.type===n.FLOAT&&(f=n.DEPTH_COMPONENT32F),n.renderbufferStorageMultisample(n.RENDERBUFFER,o,f,d,p)):n.renderbufferStorage(n.RENDERBUFFER,f,d,p),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e)}else u&&c&&(o>0?n.renderbufferStorageMultisample(n.RENDERBUFFER,o,n.DEPTH24_STENCIL8,d,p):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,d,p),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e))}async copyTextureToBuffer(e,i,n,s,o,l){const{backend:u,gl:c}=this,{textureGPU:d,glFormat:p,glType:f}=this.backend.get(e),m=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,m);const g=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+l:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,g,d,0);const y=this._getTypedArrayType(f),x=this._getBytesPerTexel(f,p),v=s*o*x,_=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,_),c.bufferData(c.PIXEL_PACK_BUFFER,v,c.STREAM_READ),c.readPixels(i,n,s,o,p,f,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await u.utils._clientWaitAsync();const T=new y(v/y.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,_),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,T),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(m),T}_getTypedArrayType(e){const{gl:i}=this;if(e===i.UNSIGNED_BYTE)return Uint8Array;if(e===i.UNSIGNED_SHORT_4_4_4_4||e===i.UNSIGNED_SHORT_5_5_5_1||e===i.UNSIGNED_SHORT_5_6_5||e===i.UNSIGNED_SHORT)return Uint16Array;if(e===i.UNSIGNED_INT)return Uint32Array;if(e===i.HALF_FLOAT)return Uint16Array;if(e===i.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,i){const{gl:n}=this;let s=0;if(e===n.UNSIGNED_BYTE&&(s=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(s=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(s=4),i===n.RGBA)return s*4;if(i===n.RGB)return s*3;if(i===n.ALPHA)return s}}class a0e{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let i=this.extensions[e];return i===void 0&&(i=this.gl.getExtension(e),this.extensions[e]=i),i}has(e){return this.availableExtensions.includes(e)}}class o0e{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,i=this.backend.extensions;if(i.has("EXT_texture_filter_anisotropic")===!0){const n=i.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const Az={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class l0e{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,i){const{gl:n,mode:s,object:o,type:l,info:u,index:c}=this;c!==0?n.drawElements(s,i,l,e):n.drawArrays(s,e,i),u.update(o,i,s,1)}renderInstances(e,i,n){const{gl:s,mode:o,type:l,index:u,object:c,info:d}=this;n!==0&&(u!==0?s.drawElementsInstanced(o,i,l,e,n):s.drawArraysInstanced(o,e,i,n),d.update(c,i,o,n))}renderMultiDraw(e,i,n){const{extensions:s,mode:o,object:l,info:u}=this;if(n===0)return;const c=s.get("WEBGL_multi_draw");if(c===null)for(let d=0;d<n;d++)this.render(e[d],i[d]);else{this.index!==0?c.multiDrawElementsWEBGL(o,i,0,this.type,e,0,n):c.multiDrawArraysWEBGL(o,e,0,i,0,n);let d=0;for(let p=0;p<n;p++)d+=i[p];u.update(l,d,o,1)}}renderMultiDrawInstances(e,i,n,s){const{extensions:o,mode:l,object:u,info:c}=this;if(n===0)return;const d=o.get("WEBGL_multi_draw");if(d===null)for(let p=0;p<n;p++)this.renderInstances(e[p],i[p],s[p]);else{this.index!==0?d.multiDrawElementsInstancedWEBGL(l,i,0,this.type,e,0,s,0,n):d.multiDrawArraysInstancedWEBGL(l,e,0,i,0,s,0,n);let p=0;for(let f=0;f<n;f++)p+=i[f]*s[f];c.update(u,p,l,1)}}}class yz extends pz{constructor(e={}){super(e),this.isWebGLBackend=!0}init(e){super.init(e);const i=this.parameters,n=i.context!==void 0?i.context:e.domElement.getContext("webgl2");function s(o){o.preventDefault();const l={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(l)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=n,this.extensions=new a0e(this),this.capabilities=new o0e(this),this.attributeUtils=new i0e(this),this.textureUtils=new s0e(this),this.bufferRenderer=new l0e(this),this.state=new r0e(this),this.utils=new n0e(this),this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.trackTimestamp=i.trackTimestamp===!0,this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this._knownBindings=new WeakSet,this._currentContext=null}get coordinateSystem(){return cc}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);if(this.queryRunning){i.queryQueue||(i.queryQueue=[]),i.queryQueue.push(e);return}i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.activeQuery=null),i.activeQuery=this.gl.createQuery(),i.activeQuery!==null&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,i.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);if(i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.gpuQueries||(i.gpuQueries=[]),i.gpuQueries.push({query:i.activeQuery}),i.activeQuery=null,this.queryRunning=!1,i.queryQueue&&i.queryQueue.length>0)){const n=i.queryQueue.shift();this.initTimestampQuery(n)}}async resolveTimestampAsync(e,i="render"){if(!this.disjoint||!this.trackTimestamp)return;const n=this.get(e);n.gpuQueries||(n.gpuQueries=[]);for(let s=0;s<n.gpuQueries.length;s++){const o=n.gpuQueries[s],l=this.gl.getQueryParameter(o.query,this.gl.QUERY_RESULT_AVAILABLE),u=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(l&&!u){const c=this.gl.getQueryParameter(o.query,this.gl.QUERY_RESULT),d=Number(c)/1e6;this.gl.deleteQuery(o.query),n.gpuQueries.splice(s,1),s--,this.renderer.info.updateTimestamp(i,d)}}}getContext(){return this.gl}beginRender(e){const{gl:i}=this,n=this.get(e);if(this.initTimestampQuery(e),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1),e.viewport?this.updateViewport(e):i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),e.scissor){const{x:o,y:l,width:u,height:c}=e.scissorValue;i.scissor(o,e.height-c-l,u,c)}const s=e.occlusionQueryCount;s>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(s),n.occlusionQueryObjects=new Array(s),n.occlusionQueryIndex=0)}finishRender(e){const{gl:i,state:n}=this,s=this.get(e),o=s.previousContext,l=e.occlusionQueryCount;l>0&&(l>s.occlusionQueryIndex&&i.endQuery(i.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const u=e.textures;if(u!==null)for(let c=0;c<u.length;c++){const d=u[c];d.generateMipmaps&&this.generateMipmaps(d)}if(this._currentContext=o,e.textures!==null&&e.renderTarget){const c=this.get(e.renderTarget),{samples:d}=e.renderTarget;if(d>0){const p=c.framebuffers[e.getCacheKey()],f=i.COLOR_BUFFER_BIT,m=c.msaaFrameBuffer,g=e.textures;n.bindFramebuffer(i.READ_FRAMEBUFFER,m),n.bindFramebuffer(i.DRAW_FRAMEBUFFER,p);for(let y=0;y<g.length;y++)if(e.scissor){const{x,y:v,width:_,height:T}=e.scissorValue,w=e.height-T-v;i.blitFramebuffer(x,w,x+_,w+T,x,w,x+_,w+T,f,i.NEAREST),i.invalidateSubFramebuffer(i.READ_FRAMEBUFFER,c.invalidationArray,x,w,_,T)}else i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,f,i.NEAREST),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,c.invalidationArray)}}o!==null&&(this._setFramebuffer(o),o.viewport?this.updateViewport(o):i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const i=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:s}=i;if(n&&s){const o=new WeakSet,{gl:l}=this;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueries=null;const u=()=>{let c=0;for(let d=0;d<n.length;d++){const p=n[d];p!==null&&l.getQueryParameter(p,l.QUERY_RESULT_AVAILABLE)&&(l.getQueryParameter(p,l.QUERY_RESULT)>0&&o.add(s[d]),n[d]=null,l.deleteQuery(p),c++)}c<n.length?requestAnimationFrame(u):i.occluded=o};u()}}isOccluded(e,i){const n=this.get(e);return n.occluded&&n.occluded.has(i)}updateViewport(e){const i=this.gl,{x:n,y:s,width:o,height:l}=e.viewportValue;i.viewport(n,e.height-l-s,o,l)}setScissorTest(e){const i=this.gl;e?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST)}clear(e,i,n,s=null,o=!0){const{gl:l}=this;if(s===null){const c=this.getClearColor();c.r*=c.a,c.g*=c.a,c.b*=c.a,s={textures:null,clearColorValue:c}}let u=0;if(e&&(u|=l.COLOR_BUFFER_BIT),i&&(u|=l.DEPTH_BUFFER_BIT),n&&(u|=l.STENCIL_BUFFER_BIT),u!==0){let c;if(s.clearColorValue?c=s.clearColorValue:(c=this.getClearColor(),c.r*=c.a,c.g*=c.a,c.b*=c.a),i&&this.state.setDepthMask(!0),s.textures===null)l.clearColor(c.r,c.g,c.b,c.a),l.clear(u);else{if(o&&this._setFramebuffer(s),e)for(let d=0;d<s.textures.length;d++)l.clearBufferfv(l.COLOR,d,[c.r,c.g,c.b,c.a]);i&&n?l.clearBufferfi(l.DEPTH_STENCIL,0,1,0):i?l.clearBufferfv(l.DEPTH,0,[1]):n&&l.clearBufferiv(l.STENCIL,0,[0])}}}beginCompute(e){const{state:i,gl:n}=this;i.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,i,n,s){const{state:o,gl:l}=this;this.discard||(l.enable(l.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:u,transformBuffers:c,attributes:d}=this.get(s),p=this._getVaoKey(null,d),f=this.vaoCache[p];f===void 0?this._createVao(null,d):l.bindVertexArray(f),o.useProgram(u),this._bindUniforms(n);const m=this._getTransformFeedback(c);l.bindTransformFeedback(l.TRANSFORM_FEEDBACK,m),l.beginTransformFeedback(l.POINTS),d[0].isStorageInstancedBufferAttribute?l.drawArraysInstanced(l.POINTS,0,1,i.count):l.drawArrays(l.POINTS,0,i.count),l.endTransformFeedback(),l.bindTransformFeedback(l.TRANSFORM_FEEDBACK,null);for(let g=0;g<c.length;g++){const y=c[g];y.pbo&&this.textureUtils.copyBufferToTexture(y.transformBuffer,y.pbo),y.switchBuffers()}}finishCompute(e){const i=this.gl;this.discard=!1,i.disable(i.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:i,pipeline:n,material:s,context:o}=e,{programGPU:l}=this.get(n),{gl:u,state:c}=this,d=this.get(o),p=e.getDrawParameters();if(p===null)return;this._bindUniforms(e.getBindings());const f=i.isMesh&&i.matrixWorld.determinant()<0;c.setMaterial(s,f),c.useProgram(l);let m=e.staticVao;if(m===void 0){const w=this._getVaoKey(e.getIndex(),e.getAttributes());if(m=this.vaoCache[w],m===void 0){let S;({vaoGPU:m,staticVao:S}=this._createVao(e.getIndex(),e.getAttributes())),S&&(e.staticVao=m)}}u.bindVertexArray(m);const g=e.getIndex(),y=d.lastOcclusionObject;if(y!==i&&y!==void 0){if(y!==null&&y.occlusionTest===!0&&(u.endQuery(u.ANY_SAMPLES_PASSED),d.occlusionQueryIndex++),i.occlusionTest===!0){const w=u.createQuery();u.beginQuery(u.ANY_SAMPLES_PASSED,w),d.occlusionQueries[d.occlusionQueryIndex]=w,d.occlusionQueryObjects[d.occlusionQueryIndex]=i}d.lastOcclusionObject=i}const x=this.bufferRenderer;i.isPoints?x.mode=u.POINTS:i.isLineSegments?x.mode=u.LINES:i.isLine?x.mode=u.LINE_STRIP:i.isLineLoop?x.mode=u.LINE_LOOP:s.wireframe===!0?(c.setLineWidth(s.wireframeLinewidth*this.renderer.getPixelRatio()),x.mode=u.LINES):x.mode=u.TRIANGLES;const{vertexCount:v,instanceCount:_}=p;let{firstVertex:T}=p;if(x.object=i,g!==null){T*=g.array.BYTES_PER_ELEMENT;const w=this.get(g);x.index=g.count,x.type=w.type}else x.index=0;i.isBatchedMesh?i._multiDrawInstances!==null?x.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?x.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount):Kle("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):_>1?x.renderInstances(T,v,_):x.render(T,v),u.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,n,s,o,l){return this.textureUtils.copyTextureToBuffer(e,i,n,s,o,l)}createSampler(){}destroySampler(){}createNodeBuilder(e,i){return new $ge(e,i)}createProgram(e){const i=this.gl,{stage:n,code:s}=e,o=n==="fragment"?i.createShader(i.FRAGMENT_SHADER):i.createShader(i.VERTEX_SHADER);i.shaderSource(o,s),i.compileShader(o),this.set(e,{shaderGPU:o})}destroyProgram(){console.warn("Abstract class.")}createRenderPipeline(e,i){const n=this.gl,s=e.pipeline,{fragmentProgram:o,vertexProgram:l}=s,u=n.createProgram(),c=this.get(o).shaderGPU,d=this.get(l).shaderGPU;if(n.attachShader(u,c),n.attachShader(u,d),n.linkProgram(u),this.set(s,{programGPU:u,fragmentShader:c,vertexShader:d}),i!==null&&this.parallel){const p=new Promise(f=>{const m=this.parallel,g=()=>{n.getProgramParameter(u,m.COMPLETION_STATUS_KHR)?(this._completeCompile(e,s),f()):requestAnimationFrame(g)};g()});i.push(p);return}this._completeCompile(e,s)}_handleSource(e,i){const n=e.split(`
`),s=[],o=Math.max(i-6,0),l=Math.min(i+6,n.length);for(let u=o;u<l;u++){const c=u+1;s.push(`${c===i?">":" "} ${c}: ${n[u]}`)}return s.join(`
`)}_getShaderErrors(e,i,n){const s=e.getShaderParameter(i,e.COMPILE_STATUS),o=e.getShaderInfoLog(i).trim();if(s&&o==="")return"";const l=/ERROR: 0:(\d+)/.exec(o);if(l){const u=parseInt(l[1]);return n.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(i),u)}else return o}_logProgramError(e,i,n){if(this.renderer.debug.checkShaderErrors){const s=this.gl,o=s.getProgramInfoLog(e).trim();if(s.getProgramParameter(e,s.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(s,e,n,i);else{const l=this._getShaderErrors(s,n,"vertex"),u=this._getShaderErrors(s,i,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(e,s.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+l+`
`+u)}else o!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",o)}}_completeCompile(e,i){const{state:n,gl:s}=this,o=this.get(i),{programGPU:l,fragmentShader:u,vertexShader:c}=o;s.getProgramParameter(l,s.LINK_STATUS)===!1&&this._logProgramError(l,u,c),n.useProgram(l);const d=e.getBindings();this._setupBindings(d,l),this.set(i,{programGPU:l})}createComputePipeline(e,i){const{state:n,gl:s}=this,o={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(o);const{computeProgram:l}=e,u=s.createProgram(),c=this.get(o).shaderGPU,d=this.get(l).shaderGPU,p=l.transforms,f=[],m=[];for(let v=0;v<p.length;v++){const _=p[v];f.push(_.varyingName),m.push(_.attributeNode)}s.attachShader(u,c),s.attachShader(u,d),s.transformFeedbackVaryings(u,f,s.SEPARATE_ATTRIBS),s.linkProgram(u),s.getProgramParameter(u,s.LINK_STATUS)===!1&&this._logProgramError(u,c,d),n.useProgram(u),this._setupBindings(i,u);const g=l.attributes,y=[],x=[];for(let v=0;v<g.length;v++){const _=g[v].node.attribute;y.push(_),this.has(_)||this.attributeUtils.createAttribute(_,s.ARRAY_BUFFER)}for(let v=0;v<m.length;v++){const _=m[v].attribute;this.has(_)||this.attributeUtils.createAttribute(_,s.ARRAY_BUFFER);const T=this.get(_);x.push(T)}this.set(e,{programGPU:u,transformBuffers:x,attributes:y})}createBindings(e,i){if(this._knownBindings.has(i)===!1){this._knownBindings.add(i);let n=0,s=0;for(const o of i){this.set(o,{textures:s,uniformBuffers:n});for(const l of o.bindings)l.isUniformBuffer&&n++,l.isSampledTexture&&s++}}this.updateBindings(e,i)}updateBindings(e){const{gl:i}=this,n=this.get(e);let s=n.uniformBuffers,o=n.textures;for(const l of e.bindings)if(l.isUniformsGroup||l.isUniformBuffer){const u=l.buffer,c=i.createBuffer();i.bindBuffer(i.UNIFORM_BUFFER,c),i.bufferData(i.UNIFORM_BUFFER,u,i.DYNAMIC_DRAW),this.set(l,{index:s++,bufferGPU:c})}else if(l.isSampledTexture){const{textureGPU:u,glTextureType:c}=this.get(l.texture);this.set(l,{index:o++,textureGPU:u,glTextureType:c})}}updateBinding(e){const i=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const n=this.get(e).bufferGPU,s=e.buffer;i.bindBuffer(i.UNIFORM_BUFFER,n),i.bufferData(i.UNIFORM_BUFFER,s,i.DYNAMIC_DRAW)}}createIndexAttribute(e){const i=this.gl;this.attributeUtils.createAttribute(e,i.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const i=this.gl;this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const i=this.gl;this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){}hasFeature(e){const i=Object.keys(Az).filter(s=>Az[s]===e),n=this.extensions;for(let s=0;s<i.length;s++)if(n.has(i[s]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,i,n,s,o){this.textureUtils.copyTextureToTexture(e,i,n,s,o)}copyFramebufferToTexture(e,i,n){this.textureUtils.copyFramebufferToTexture(e,i,n)}_setFramebuffer(e){const{gl:i,state:n}=this;let s=null;if(e.textures!==null){const o=e.renderTarget,l=this.get(o),{samples:u,depthBuffer:c,stencilBuffer:d}=o,p=o.isWebGLCubeRenderTarget===!0;let f=l.msaaFrameBuffer,m=l.depthRenderbuffer;const g=I8(e);let y;if(p?(l.cubeFramebuffers||(l.cubeFramebuffers={}),y=l.cubeFramebuffers[g]):(l.framebuffers||(l.framebuffers={}),y=l.framebuffers[g]),y===void 0){y=i.createFramebuffer(),n.bindFramebuffer(i.FRAMEBUFFER,y);const x=e.textures;if(p){l.cubeFramebuffers[g]=y;const{textureGPU:v}=this.get(x[0]),_=this.renderer._activeCubeFace;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+_,v,0)}else{l.framebuffers[g]=y;for(let v=0;v<x.length;v++){const _=x[v],T=this.get(_);T.renderTarget=e.renderTarget,T.cacheKey=g;const w=i.COLOR_ATTACHMENT0+v;i.framebufferTexture2D(i.FRAMEBUFFER,w,i.TEXTURE_2D,T.textureGPU,0)}n.drawBuffers(e,y)}if(e.depthTexture!==null){const v=this.get(e.depthTexture),_=d?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;v.renderTarget=e.renderTarget,v.cacheKey=g,i.framebufferTexture2D(i.FRAMEBUFFER,_,i.TEXTURE_2D,v.textureGPU,0)}}if(u>0){if(f===void 0){const x=[];f=i.createFramebuffer(),n.bindFramebuffer(i.FRAMEBUFFER,f);const v=[],_=e.textures;for(let T=0;T<_.length;T++){if(v[T]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,v[T]),x.push(i.COLOR_ATTACHMENT0+T),c){const R=d?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;x.push(R)}const w=e.textures[T],S=this.get(w);i.renderbufferStorageMultisample(i.RENDERBUFFER,u,S.glInternalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+T,i.RENDERBUFFER,v[T])}if(l.msaaFrameBuffer=f,l.msaaRenderbuffers=v,m===void 0){m=i.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(m,e),l.depthRenderbuffer=m;const T=d?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;x.push(T)}l.invalidationArray=x}s=l.msaaFrameBuffer}else s=y}n.bindFramebuffer(i.FRAMEBUFFER,s)}_getVaoKey(e,i){let n=[];if(e!==null){const s=this.get(e);n+=":"+s.id}for(let s=0;s<i.length;s++){const o=this.get(i[s]);n+=":"+o.id}return n}_createVao(e,i){const{gl:n}=this,s=n.createVertexArray();let o="",l=!0;if(n.bindVertexArray(s),e!==null){const u=this.get(e);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,u.bufferGPU),o+=":"+u.id}for(let u=0;u<i.length;u++){const c=i[u],d=this.get(c);o+=":"+d.id,n.bindBuffer(n.ARRAY_BUFFER,d.bufferGPU),n.enableVertexAttribArray(u),(c.isStorageBufferAttribute||c.isStorageInstancedBufferAttribute)&&(l=!1);let p,f;c.isInterleavedBufferAttribute===!0?(p=c.data.stride*d.bytesPerElement,f=c.offset*d.bytesPerElement):(p=0,f=0),d.isInteger?n.vertexAttribIPointer(u,c.itemSize,d.type,p,f):n.vertexAttribPointer(u,c.itemSize,d.type,c.normalized,p,f),c.isInstancedBufferAttribute&&!c.isInterleavedBufferAttribute?n.vertexAttribDivisor(u,c.meshPerAttribute):c.isInterleavedBufferAttribute&&c.data.isInstancedInterleavedBuffer&&n.vertexAttribDivisor(u,c.data.meshPerAttribute)}return n.bindBuffer(n.ARRAY_BUFFER,null),this.vaoCache[o]=s,{vaoGPU:s,staticVao:l}}_getTransformFeedback(e){let i="";for(let o=0;o<e.length;o++)i+=":"+e[o].id;let n=this.transformFeedbackCache[i];if(n!==void 0)return n;const{gl:s}=this;n=s.createTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.length;o++){const l=e[o];s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,o,l.transformBuffer)}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[i]=n,n}_setupBindings(e,i){const n=this.gl;for(const s of e)for(const o of s.bindings){const l=this.get(o).index;if(o.isUniformsGroup||o.isUniformBuffer){const u=n.getUniformBlockIndex(i,o.name);n.uniformBlockBinding(i,u,l)}else if(o.isSampledTexture){const u=n.getUniformLocation(i,o.name);n.uniform1i(u,l)}}}_bindUniforms(e){const{gl:i,state:n}=this;for(const s of e)for(const o of s.bindings){const l=this.get(o),u=l.index;o.isUniformsGroup||o.isUniformBuffer?n.bindBufferBase(i.UNIFORM_BUFFER,u,l.bufferGPU):o.isSampledTexture&&n.bindTexture(l.glTextureType,l.textureGPU,i.TEXTURE0+u)}}dispose(){this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}class c0e extends SR{constructor(e,i){super(e),this.texture=i,this.version=i?i.version:0,this.isSampler=!0}}class u0e extends c0e{constructor(e,i,n){super(e,i?i.value:null),this.textureNode=i,this.groupNode=n}update(){this.texture=this.textureNode.value}}class h0e extends sz{constructor(e,i){super(e,i?i.array:null),this.attribute=i,this.isStorageBuffer=!0}}let d0e=0;class p0e extends h0e{constructor(e,i){super("StorageBuffer_"+d0e++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:oR.Storage,this.groupNode=i}get buffer(){return this.nodeUniform.value}}class f0e extends gd{constructor(e){super(),this.device=e;const i=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:zp.Linear}),this.flipYSampler=e.createSampler({minFilter:zp.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:i}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:s})}getTransferPipeline(e){let i=this.transferPipelines[e];return i===void 0&&(i=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Cg.TriangleStrip,stripIndexFormat:Sg.Uint32},layout:"auto"}),this.transferPipelines[e]=i),i}getFlipYPipeline(e){let i=this.flipYPipelines[e];return i===void 0&&(i=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Cg.TriangleStrip,stripIndexFormat:Sg.Uint32},layout:"auto"}),this.flipYPipelines[e]=i),i}flipY(e,i,n=0){const s=i.format,{width:o,height:l}=i.size,u=this.getTransferPipeline(s),c=this.getFlipYPipeline(s),d=this.device.createTexture({size:{width:o,height:l,depthOrArrayLayers:1},format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),p=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Nl.TwoD,baseArrayLayer:n}),f=d.createView({baseMipLevel:0,mipLevelCount:1,dimension:Nl.TwoD,baseArrayLayer:0}),m=this.device.createCommandEncoder({}),g=(y,x,v)=>{const _=y.getBindGroupLayout(0),T=this.device.createBindGroup({layout:_,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:x}]}),w=m.beginRenderPass({colorAttachments:[{view:v,loadOp:ia.Clear,storeOp:za.Store,clearValue:[0,0,0,0]}]});w.setPipeline(y),w.setBindGroup(0,T),w.draw(4,1,0,0),w.end()};g(u,p,f),g(c,f,p),this.device.queue.submit([m.finish()]),d.destroy()}generateMipmaps(e,i,n=0){const s=this.get(e);s.useCount===void 0&&(s.useCount=0,s.layers=[]);const o=s.layers[n]||this._mipmapCreateBundles(e,i,n),l=this.device.createCommandEncoder({});this._mipmapRunBundles(l,o),this.device.queue.submit([l.finish()]),s.useCount!==0&&(s.layers[n]=o),s.useCount++}_mipmapCreateBundles(e,i,n){const s=this.getTransferPipeline(i.format),o=s.getBindGroupLayout(0);let l=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Nl.TwoD,baseArrayLayer:n});const u=[];for(let c=1;c<i.mipLevelCount;c++){const d=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:l}]}),p=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:Nl.TwoD,baseArrayLayer:n}),f={colorAttachments:[{view:p,loadOp:ia.Clear,storeOp:za.Store,clearValue:[0,0,0,0]}]},m=this.device.createRenderBundleEncoder({colorFormats:[i.format]});m.setPipeline(s),m.setBindGroup(0,d),m.draw(4,1,0,0),u.push({renderBundles:[m.finish()],passDescriptor:f}),l=p}return u}_mipmapRunBundles(e,i){const n=i.length;for(let s=0;s<n;s++){const o=i[s],l=e.beginRenderPass(o.passDescriptor);l.executeBundles(o.renderBundles),l.end()}}}const m0e={[IU]:"never",[RM]:"less",[BU]:"equal",[NU]:"less-equal",[LU]:"greater",[OU]:"greater-equal",[PU]:"always",[DU]:"not-equal"},g0e=[0,1,3,2,4,5];class A0e{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new dg,this.depthTexture.name="depthBuffer"}createSampler(e){const i=this.backend,n=i.device,s=i.get(e),o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===zp.Linear&&o.minFilter===zp.Linear&&o.mipmapFilter===zp.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=m0e[e.compareFunction]),s.sampler=n.createSampler(o)}createDefaultTexture(e){let i;const n=BR(e);e.isCubeTexture?i=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():i=this._getDefaultTextureGPU(n),this.backend.get(e).texture=i}createTexture(e,i={}){const n=this.backend,s=n.get(e);if(s.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");i.needsMipmaps===void 0&&(i.needsMipmaps=!1),i.levels===void 0&&(i.levels=1),i.depth===void 0&&(i.depth=1);const{width:o,height:l,depth:u,levels:c}=i;e.isFramebufferTexture&&(i.renderTarget?i.format=this.backend.utils.getCurrentColorFormat(i.renderTarget):i.format=this.backend.utils.getPreferredCanvasFormat());const d=this._getDimension(e),p=e.internalFormat||i.format||BR(e,n.device);s.format=p;let f=i.sampleCount!==void 0?i.sampleCount:1;f=n.utils.getSampleCount(f);const m=e.isRenderTargetTexture&&!e.isMultisampleRenderTargetTexture?1:f;let g=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(g|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(g|=GPUTextureUsage.RENDER_ATTACHMENT);const y={label:e.name,size:{width:o,height:l,depthOrArrayLayers:u},mipLevelCount:c,sampleCount:m,dimension:d,format:p,usage:g};if(e.isVideoTexture){const x=e.source.data,v=new VideoFrame(x);y.size.width=v.displayWidth,y.size.height=v.displayHeight,v.close(),s.externalTexture=x}else{if(p===void 0)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);s.texture=n.device.createTexture(y)}if(e.isRenderTargetTexture&&f>1&&!e.isMultisampleRenderTargetTexture){const x=Object.assign({},y);x.label=x.label+"-msaa",x.sampleCount=f,s.msaaTexture=n.device.createTexture(x)}s.initialized=!0,s.textureDescriptorGPU=y}destroyTexture(e){const i=this.backend,n=i.get(e);n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),i.delete(e)}destroySampler(e){const i=this.backend.get(e);delete i.sampler}generateMipmaps(e){const i=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let s=0;s<n;s++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,s)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:i,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:i,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,i=!1){const n=this.backend,{width:s,height:o}=n.getDrawingBufferSize(),l=this.depthTexture,u=n.get(l).texture;let c,d;if(i?(c=Ym,d=jA):e&&(c=Ep,d=Da),u!==void 0){if(l.image.width===s&&l.image.height===o&&l.format===c&&l.type===d)return u;this.destroyTexture(l)}return l.name="depthBuffer",l.format=c,l.type=d,l.image.width=s,l.image.height=o,this.createTexture(l,{sampleCount:n.utils.getSampleCount(n.renderer.samples),width:s,height:o}),n.get(l).texture}updateTexture(e,i){const n=this.backend.get(e),{textureDescriptorGPU:s}=n;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)this._copyBufferToTexture(i.image,n.texture,s,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<i.image.depth;o++)this._copyBufferToTexture(i.image,n.texture,s,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(i.images,n.texture,s,e.flipY);else if(e.isVideoTexture){const o=e.source.data;n.externalTexture=o}else this._copyImageToTexture(i.image,n.texture,s,0,e.flipY);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,i,n,s,o,l){const u=this.backend.device,c=this.backend.get(e),d=c.texture,p=c.textureDescriptorGPU.format,f=this._getBytesPerTexel(p);let m=s*f;m=Math.ceil(m/256)*256;const g=u.createBuffer({size:s*o*f,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),y=u.createCommandEncoder();y.copyTextureToBuffer({texture:d,origin:{x:i,y:n,z:l}},{buffer:g,bytesPerRow:m},{width:s,height:o});const x=this._getTypedArrayType(p);u.queue.submit([y.finish()]),await g.mapAsync(GPUMapMode.READ);const v=g.getMappedRange();return new x(v)}_isEnvironmentTexture(e){const i=e.mapping;return i===FA||i===kA||i===_p||i===Hm}_getDefaultTextureGPU(e){let i=this.defaultTexture[e];if(i===void 0){const n=new vo;n.minFilter=Ja,n.magFilter=Ja,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=i=n}return this.backend.get(i).texture}_getDefaultCubeTextureGPU(e){let i=this.defaultTexture[e];if(i===void 0){const n=new ZM;n.minFilter=Ja,n.magFilter=Ja,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=i=n}return this.backend.get(i).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const i={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),i)}return e}_copyCubeMapToTexture(e,i,n,s){for(let o=0;o<6;o++){const l=e[o],u=s===!0?g0e[o]:o;l.isDataTexture?this._copyBufferToTexture(l.image,i,n,u,s):this._copyImageToTexture(l,i,n,u,s)}}_copyImageToTexture(e,i,n,s,o){this.backend.device.queue.copyExternalImageToTexture({source:e},{texture:i,mipLevel:0,origin:{x:0,y:0,z:s}},{width:e.width,height:e.height,depthOrArrayLayers:1}),o===!0&&this._flipY(i,n,s)}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new f0e(this.backend.device)),e}_generateMipmaps(e,i,n=0){this._getPassUtils().generateMipmaps(e,i,n)}_flipY(e,i,n=0){this._getPassUtils().flipY(e,i,n)}_copyBufferToTexture(e,i,n,s,o,l=0){const u=this.backend.device,c=e.data,d=this._getBytesPerTexel(n.format),p=e.width*d;u.queue.writeTexture({texture:i,mipLevel:0,origin:{x:0,y:0,z:s}},c,{offset:e.width*e.height*d*l,bytesPerRow:p},{width:e.width,height:e.height,depthOrArrayLayers:1}),o===!0&&this._flipY(i,n,s)}_copyCompressedBufferToTexture(e,i,n){const s=this.backend.device,o=this._getBlockData(n.format),l=n.size.depthOrArrayLayers>1;for(let u=0;u<e.length;u++){const c=e[u],d=c.width,p=c.height,f=l?n.size.depthOrArrayLayers:1,m=Math.ceil(d/o.width)*o.byteLength,g=m*Math.ceil(p/o.height);for(let y=0;y<f;y++)s.queue.writeTexture({texture:i,mipLevel:u,origin:{x:0,y:0,z:y}},c.data,{offset:y*g,bytesPerRow:m,rowsPerImage:Math.ceil(p/o.height)},{width:Math.ceil(d/o.width)*o.width,height:Math.ceil(p/o.height)*o.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ht.BC1RGBAUnorm||e===ht.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ht.BC2RGBAUnorm||e===ht.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.BC3RGBAUnorm||e===ht.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.BC4RUnorm||e===ht.BC4RSNorm)return{byteLength:8,width:4,height:4};if(e===ht.BC5RGUnorm||e===ht.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ht.BC6HRGBUFloat||e===ht.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ht.BC7RGBAUnorm||e===ht.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.ETC2RGB8Unorm||e===ht.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ht.ETC2RGB8A1Unorm||e===ht.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ht.ETC2RGBA8Unorm||e===ht.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ht.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ht.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ht.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ht.ASTC4x4Unorm||e===ht.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.ASTC5x4Unorm||e===ht.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ht.ASTC5x5Unorm||e===ht.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ht.ASTC6x5Unorm||e===ht.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ht.ASTC6x6Unorm||e===ht.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ht.ASTC8x5Unorm||e===ht.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ht.ASTC8x6Unorm||e===ht.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ht.ASTC8x8Unorm||e===ht.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ht.ASTC10x5Unorm||e===ht.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ht.ASTC10x6Unorm||e===ht.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ht.ASTC10x8Unorm||e===ht.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ht.ASTC10x10Unorm||e===ht.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ht.ASTC12x10Unorm||e===ht.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ht.ASTC12x12Unorm||e===ht.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let i=aR.ClampToEdge;return e===u1?i=aR.Repeat:e===h1&&(i=aR.MirrorRepeat),i}_convertFilterMode(e){let i=zp.Linear;return(e===Ja||e===rM||e===Qm)&&(i=zp.Nearest),i}_getBytesPerTexel(e){if(e===ht.R8Unorm||e===ht.R8Snorm||e===ht.R8Uint||e===ht.R8Sint)return 1;if(e===ht.R16Uint||e===ht.R16Sint||e===ht.R16Float||e===ht.RG8Unorm||e===ht.RG8Snorm||e===ht.RG8Uint||e===ht.RG8Sint)return 2;if(e===ht.R32Uint||e===ht.R32Sint||e===ht.R32Float||e===ht.RG16Uint||e===ht.RG16Sint||e===ht.RG16Float||e===ht.RGBA8Unorm||e===ht.RGBA8UnormSRGB||e===ht.RGBA8Snorm||e===ht.RGBA8Uint||e===ht.RGBA8Sint||e===ht.BGRA8Unorm||e===ht.BGRA8UnormSRGB||e===ht.RGB9E5UFloat||e===ht.RGB10A2Unorm||e===ht.RG11B10UFloat||e===ht.Depth32Float||e===ht.Depth24Plus||e===ht.Depth24PlusStencil8||e===ht.Depth32FloatStencil8)return 4;if(e===ht.RG32Uint||e===ht.RG32Sint||e===ht.RG32Float||e===ht.RGBA16Uint||e===ht.RGBA16Sint||e===ht.RGBA16Float)return 8;if(e===ht.RGBA32Uint||e===ht.RGBA32Sint||e===ht.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ht.R8Uint)return Uint8Array;if(e===ht.R8Sint)return Int8Array;if(e===ht.R8Unorm)return Uint8Array;if(e===ht.R8Snorm)return Int8Array;if(e===ht.RG8Uint)return Uint8Array;if(e===ht.RG8Sint)return Int8Array;if(e===ht.RG8Unorm)return Uint8Array;if(e===ht.RG8Snorm)return Int8Array;if(e===ht.RGBA8Uint)return Uint8Array;if(e===ht.RGBA8Sint)return Int8Array;if(e===ht.RGBA8Unorm)return Uint8Array;if(e===ht.RGBA8Snorm)return Int8Array;if(e===ht.R16Uint)return Uint16Array;if(e===ht.R16Sint)return Int16Array;if(e===ht.RG16Uint)return Uint16Array;if(e===ht.RG16Sint)return Int16Array;if(e===ht.RGBA16Uint)return Uint16Array;if(e===ht.RGBA16Sint)return Int16Array;if(e===ht.R16Float||e===ht.RG16Float||e===ht.RGBA16Float)return Uint16Array;if(e===ht.R32Uint)return Uint32Array;if(e===ht.R32Sint)return Int32Array;if(e===ht.R32Float)return Float32Array;if(e===ht.RG32Uint)return Uint32Array;if(e===ht.RG32Sint)return Int32Array;if(e===ht.RG32Float)return Float32Array;if(e===ht.RGBA32Uint)return Uint32Array;if(e===ht.RGBA32Sint)return Int32Array;if(e===ht.RGBA32Float)return Float32Array;if(e===ht.BGRA8Unorm||e===ht.BGRA8UnormSRGB)return Uint8Array;if(e===ht.RGB10A2Unorm||e===ht.RGB9E5UFloat||e===ht.RG11B10UFloat)return Uint32Array;if(e===ht.Depth32Float)return Float32Array;if(e===ht.Depth24Plus||e===ht.Depth24PlusStencil8)return Uint32Array;if(e===ht.Depth32FloatStencil8)return Float32Array}_getDimension(e){let i;return e.isData3DTexture?i=O8.ThreeD:i=O8.TwoD,i}}function BR(r,e=null){const i=r.format,n=r.type,s=r.colorSpace;let o;if(r.isCompressedTexture===!0||r.isCompressedArrayTexture===!0)switch(i){case d1:o=s===Nr?ht.BC1RGBAUnormSRGB:ht.BC1RGBAUnorm;break;case p1:o=s===Nr?ht.BC2RGBAUnormSRGB:ht.BC2RGBAUnorm;break;case f1:o=s===Nr?ht.BC3RGBAUnormSRGB:ht.BC3RGBAUnorm;break;case hM:o=s===Nr?ht.ETC2RGB8UnormSRGB:ht.ETC2RGB8Unorm;break;case dM:o=s===Nr?ht.ETC2RGBA8UnormSRGB:ht.ETC2RGBA8Unorm;break;case pM:o=s===Nr?ht.ASTC4x4UnormSRGB:ht.ASTC4x4Unorm;break;case fM:o=s===Nr?ht.ASTC5x4UnormSRGB:ht.ASTC5x4Unorm;break;case mM:o=s===Nr?ht.ASTC5x5UnormSRGB:ht.ASTC5x5Unorm;break;case gM:o=s===Nr?ht.ASTC6x5UnormSRGB:ht.ASTC6x5Unorm;break;case AM:o=s===Nr?ht.ASTC6x6UnormSRGB:ht.ASTC6x6Unorm;break;case yM:o=s===Nr?ht.ASTC8x5UnormSRGB:ht.ASTC8x5Unorm;break;case vM:o=s===Nr?ht.ASTC8x6UnormSRGB:ht.ASTC8x6Unorm;break;case xM:o=s===Nr?ht.ASTC8x8UnormSRGB:ht.ASTC8x8Unorm;break;case bM:o=s===Nr?ht.ASTC10x5UnormSRGB:ht.ASTC10x5Unorm;break;case _M:o=s===Nr?ht.ASTC10x6UnormSRGB:ht.ASTC10x6Unorm;break;case EM:o=s===Nr?ht.ASTC10x8UnormSRGB:ht.ASTC10x8Unorm;break;case wM:o=s===Nr?ht.ASTC10x10UnormSRGB:ht.ASTC10x10Unorm;break;case CM:o=s===Nr?ht.ASTC12x10UnormSRGB:ht.ASTC12x10Unorm;break;case SM:o=s===Nr?ht.ASTC12x12UnormSRGB:ht.ASTC12x12Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",i)}else switch(i){case Xm:switch(n){case UA:o=ht.RGBA8Snorm;break;case zA:o=ht.RGBA16Sint;break;case qm:o=ht.RGBA16Uint;break;case Da:o=ht.RGBA32Uint;break;case Ao:o=ht.RGBA32Sint;break;case ed:o=s===Nr?ht.RGBA8UnormSRGB:ht.RGBA8Unorm;break;case Du:o=ht.RGBA16Float;break;case ll:o=ht.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case sM:switch(n){case xU:o=ht.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case aM:switch(n){case UA:o=ht.R8Snorm;break;case zA:o=ht.R16Sint;break;case qm:o=ht.R16Uint;break;case Da:o=ht.R32Uint;break;case Ao:o=ht.R32Sint;break;case ed:o=ht.R8Unorm;break;case Du:o=ht.R16Float;break;case ll:o=ht.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case VA:switch(n){case UA:o=ht.RG8Snorm;break;case zA:o=ht.RG16Sint;break;case qm:o=ht.RG16Uint;break;case Da:o=ht.RG32Uint;break;case Ao:o=ht.RG32Sint;break;case ed:o=ht.RG8Unorm;break;case Du:o=ht.RG16Float;break;case ll:o=ht.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case Ep:switch(n){case qm:o=ht.Depth16Unorm;break;case Da:o=ht.Depth24Plus;break;case ll:o=ht.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case Ym:switch(n){case jA:o=ht.Depth24PlusStencil8;break;case ll:e&&e.features.has(lR.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=ht.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case oM:switch(n){case Ao:o=ht.R32Sint;break;case Da:o=ht.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case lM:switch(n){case Ao:o=ht.RG32Sint;break;case Da:o=ht.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case cM:switch(n){case Ao:o=ht.RGBA32Sint;break;case Da:o=ht.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",i)}return o}const y0e=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,v0e=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,vz={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},x0e=r=>{r=r.trim();const e=r.match(y0e);if(e!==null&&e.length===4){const i=e[2],n=[];let s=null;for(;(s=v0e.exec(i))!==null;)n.push({name:s[1],type:s[2]});const o=[];for(let d=0;d<n.length;d++){const{name:p,type:f}=n[d];let m=f;m.startsWith("ptr")?m="pointer":(m.startsWith("texture")&&(m=f.split("<")[0]),m=vz[m]),o.push(new bR(m,p))}const l=r.substring(e[0].length),u=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:vz[u]||u,inputs:o,name:c,inputsCode:i,blockCode:l,outputType:u}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class b0e extends ER{constructor(e){const{type:i,inputs:n,name:s,inputsCode:o,blockCode:l,outputType:u}=x0e(e);super(i,n,s),this.inputsCode=o,this.blockCode=l,this.outputType=u}getCode(e=this.name){const i=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${i}`+this.blockCode}}class _0e extends ez{parseFunction(e){return new b0e(e)}}const Bg=self.GPUShaderStage,b_={vertex:Bg?Bg.VERTEX:1,fragment:Bg?Bg.FRAGMENT:2,compute:Bg?Bg.COMPUTE:4},xz={instance:!0,swizzleAssign:!1,storageBuffer:!0},E0e={"^^":"tsl_xor"},w0e={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},eh={tsl_xor:new eo("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new eo("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new eo("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new eo("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new eo("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new eo("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new eo("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new eo("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new eo("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping:new eo(`
fn tsl_repeatWrapping( uv : vec2<f32>, dimension : vec2<u32> ) -> vec2<u32> {

	let uvScaled = vec2<u32>( uv * vec2<f32>( dimension ) );

	return ( ( uvScaled % dimension ) + dimension ) % dimension;

}
`),biquadraticTexture:new eo(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, level : i32 ) -> vec4f {

	let iRes = vec2i( textureDimensions( map, level ) );
	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2i( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2i( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2i( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2i( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},Ty={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};/Windows/g.test(navigator.userAgent)&&(eh.pow_float=new eo("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),eh.pow_vec2=new eo("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[eh.pow_float]),eh.pow_vec3=new eo("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[eh.pow_float]),eh.pow_vec4=new eo("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[eh.pow_float]),Ty.pow_float="tsl_pow_float",Ty.pow_vec2="tsl_pow_vec2",Ty.pow_vec3="tsl_pow_vec3",Ty.pow_vec4="tsl_pow_vec4");let bz="";/Firefox|Deno/g.test(navigator.userAgent)!==!0&&(bz+=`diagnostic( off, derivative_uniformity );
`);class C0e extends J8{constructor(e,i){super(e,i,new _0e),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==wp}_generateTextureSample(e,i,n,s,o=this.shaderStage){return o==="fragment"?s?`textureSample( ${i}, ${i}_sampler, ${n}, ${s} )`:`textureSample( ${i}, ${i}_sampler, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,i,n):this.generateTextureLod(e,i,n,"0")}_generateVideoSample(e,i,n=this.shaderStage){if(n==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${i}.x, 1.0 - ${i}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,i,n,s,o,l=this.shaderStage){return l==="fragment"&&this.isUnfilterable(e)===!1?`textureSampleLevel( ${i}, ${i}_sampler, ${n}, ${s} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,i,n,s):this.generateTextureLod(e,i,n,s)}generateFilteredTexture(e,i,n,s="0"){return this._include("biquadraticTexture"),`tsl_biquadraticTexture( ${i}, ${n}, i32( ${s} ) )`}generateTextureLod(e,i,n,s="0"){this._include("repeatWrapping");const o=e.isMultisampleRenderTargetTexture===!0?`textureDimensions( ${i} )`:`textureDimensions( ${i}, 0 )`;return`textureLoad( ${i}, tsl_repeatWrapping( ${n}, ${o} ), i32( ${s} ) )`}generateTextureLoad(e,i,n,s,o="0u"){return s?`textureLoad( ${i}, ${n}, ${s}, ${o} )`:`textureLoad( ${i}, ${n}, ${o} )`}generateTextureStore(e,i,n,s){return`textureStore( ${i}, ${n}, ${s} )`}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===ll||e.isMultisampleRenderTargetTexture===!0}generateTexture(e,i,n,s,o=this.shaderStage){let l=null;return e.isVideoTexture===!0?l=this._generateVideoSample(i,n,o):this.isUnfilterable(e)?l=this.generateTextureLod(e,i,n,"0",s,o):l=this._generateTextureSample(e,i,n,s,o),l}generateTextureGrad(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`textureSampleGrad( ${i}, ${i}_sampler, ${n},  ${s[0]}, ${s[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${l} shader.`)}generateTextureCompare(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`textureSampleCompare( ${i}, ${i}_sampler, ${n}, ${s} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${l} shader.`)}generateTextureLevel(e,i,n,s,o,l=this.shaderStage){let u=null;return e.isVideoTexture===!0?u=this._generateVideoSample(i,n,l):u=this._generateTextureSampleLevel(e,i,n,s,o,l),u}generateTextureBias(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`textureSampleBias( ${i}, ${i}_sampler, ${n}, ${s} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${l} shader.`)}getPropertyName(e,i=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(i==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,s=e.type;return s==="texture"||s==="cubeTexture"||s==="storageTexture"||s==="texture3D"?n:s==="buffer"||s==="storageBuffer"||s==="indirectStorageBuffer"?`NodeBuffer_${e.id}.${n}`:e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}_getUniformGroupCount(e){return Object.keys(this.uniforms[e]).length}getFunctionOperator(e){const i=E0e[e];return i!==void 0?(this._include(i),i):null}getStorageAccess(e){if(e.isStorageTextureNode)switch(e.access){case D8.ReadOnly:return"read";case D8.WriteOnly:return"write";default:return"read_write"}else switch(e.access){case oR.Storage:return"read_write";case oR.ReadOnlyStorage:return"read";default:return"write"}}getUniformFromNode(e,i,n,s=null){const o=super.getUniformFromNode(e,i,n,s),l=this.getDataFromNode(e,n,this.globalCache);if(l.uniformGPU===void 0){let u;const c=e.groupNode,d=c.name,p=this.getBindGroupArray(d,n);if(i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"){let f=null;if(i==="texture"||i==="storageTexture"?f=new v_(o.name,o.node,c,e.access?e.access:null):i==="cubeTexture"?f=new cz(o.name,o.node,c,e.access?e.access:null):i==="texture3D"&&(f=new uz(o.name,o.node,c,e.access?e.access:null)),f.store=e.isStorageTextureNode===!0,f.setVisibility(b_[n]),n==="fragment"&&this.isUnfilterable(e.value)===!1&&f.store===!1){const m=new u0e(`${o.name}_sampler`,o.node,c);m.setVisibility(b_[n]),p.push(m,f),u=[m,f]}else p.push(f),u=[f]}else if(i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"){const f=i==="buffer"?oz:p0e,m=new f(e,c);m.setVisibility(b_[n]),p.push(m),u=m}else{const f=this.uniformGroups[n]||(this.uniformGroups[n]={});let m=f[d];m===void 0&&(m=new lz(d,c),m.setVisibility(b_[n]),f[d]=m,p.push(m)),u=this.getNodeUniform(o,i),m.addUniform(u)}l.uniformGPU=u}return o}getBuiltin(e,i,n,s=this.shaderStage){const o=this.builtins[s]||(this.builtins[s]=new Map);return o.has(e)===!1&&o.set(e,{name:e,property:i,type:n}),i}hasBuiltin(e,i=this.shaderStage){return this.builtins[i]!==void 0&&this.builtins[i].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const i=e.layout,n=this.flowShaderNode(e),s=[];for(const l of i.inputs)s.push(l.name+" : "+this.getType(l.type));let o=`fn ${i.name}( ${s.join(", ")} ) -> ${this.getType(i.type)} {
${n.vars}
${n.code}
`;return n.result&&(o+=`	return ${n.result};
`),o+=`
}
`,o}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}isFlipY(){return!1}enableDirective(e,i=this.shaderStage){(this.directives[i]||(this.directives[i]=new Set)).add(e)}getDirectives(e){const i=[],n=this.directives[e];if(n!==void 0)for(const s of n)i.push(`enable ${s};`);return i.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}getBuiltins(e){const i=[],n=this.builtins[e];if(n!==void 0)for(const{name:s,property:o,type:l}of n.values())i.push(`@builtin( ${s} ) ${o} : ${l}`);return i.join(`,
	`)}getScopedArray(e,i,n,s){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:i,bufferType:n,bufferCount:s}),e}getScopedArrays(e){if(e!=="compute")return;const i=[];for(const{name:n,scope:s,bufferType:o,bufferCount:l}of this.scopedArrays.values()){const u=this.getType(o);i.push(`var<${s}> ${n}: array< ${u}, ${l} >;`)}return i.join(`
`)}getAttributes(e){const i=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&i.push(n);const s=this.getAttributesArray();for(let o=0,l=s.length;o<l;o++){const u=s[o],c=u.name,d=this.getType(u.type);i.push(`@location( ${o} ) ${c} : ${d}`)}}return i.join(`,
	`)}getStructMembers(e){const i=[],n=e.getMemberTypes();for(let o=0;o<n.length;o++){const l=n[o];i.push(`	@location( ${o} ) m${o} : ${l}<f32>`)}const s=this.getBuiltins("output");return s&&i.push("	"+s),i.join(`,
`)}getStructs(e){const i=[],n=this.structs[e];for(let s=0,o=n.length;s<o;s++){const l=n[s],u=l.name;let c=`struct ${u} {
`;c+=this.getStructMembers(l),c+=`
}`,i.push(c),i.push(`
var<private> output : ${u};

`)}return i.join(`

`)}getVar(e,i){return`var ${i} : ${this.getType(e)}`}getVars(e){const i=[],n=this.vars[e];if(n!==void 0)for(const s of n)i.push(`	${this.getVar(s.type,s.name)};`);return`
${i.join(`
`)}
`}getVaryings(e){const i=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const o=this.varyings,l=this.vars[e];for(let u=0;u<o.length;u++){const c=o[u];if(c.needsInterpolation){let d=`@location( ${u} )`;/^(int|uint|ivec|uvec)/.test(c.type)&&(d+=" @interpolate( flat )"),i.push(`${d} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&l.includes(c)===!1&&l.push(c)}}const n=this.getBuiltins(e);n&&i.push(n);const s=i.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+s):s}getUniforms(e){const i=this.uniforms[e],n=[],s=[],o=[],l={};for(const c of i){const d=c.groupNode.name,p=this.bindingsIndexes[d];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const f=c.node.value;e==="fragment"&&this.isUnfilterable(f)===!1&&c.node.isStorageTextureNode!==!0&&(f.isDepthTexture===!0&&f.compareFunction!==null?n.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler;`));let m,g="";if(f.isMultisampleRenderTargetTexture===!0&&(g="_multisampled"),f.isCubeTexture===!0)m="texture_cube<f32>";else if(f.isDataArrayTexture===!0||f.isCompressedArrayTexture===!0)m="texture_2d_array<f32>";else if(f.isDepthTexture===!0)m=`texture_depth${g}_2d`;else if(f.isVideoTexture===!0)m="texture_external";else if(f.isData3DTexture===!0)m="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const y=BR(f),x=this.getStorageAccess(c.node);m=`texture_storage_2d<${y}, ${x}>`}else{const y=this.getComponentTypeFromTexture(f).charAt(0);m=`texture${g}_2d<${y}32>`}n.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name} : ${m};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const f=c.node,m=this.getType(f.bufferType),g=f.bufferCount,y=g>0&&c.type==="buffer"?", "+g:"",x=f.isAtomic?`atomic<${m}>`:`${m}`,v=`	${c.name} : array< ${x}${y} >
`,_=f.isStorageBufferNode?`storage, ${this.getStorageAccess(f)}`:"uniform";s.push(this._getWGSLStructBinding("NodeBuffer_"+f.id,v,_,p.binding++,p.group))}else{const f=this.getType(this.getVectorType(c.type)),m=c.groupNode.name;(l[m]||(l[m]={index:p.binding++,id:p.group,snippets:[]})).snippets.push(`	${c.name} : ${f}`)}}for(const c in l){const d=l[c];o.push(this._getWGSLStructBinding(c,d.snippets.join(`,
`),"uniform",d.index,d.id))}let u=n.join(`
`);return u+=s.join(`
`),u+=o.join(`
`),u}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const i in e){const n=e[i];n.uniforms=this.getUniforms(i),n.attributes=this.getAttributes(i),n.varyings=this.getVaryings(i),n.structs=this.getStructs(i),n.vars=this.getVars(i),n.codes=this.getCodes(i),n.directives=this.getDirectives(i),n.scopedArrays=this.getScopedArrays(i);let s=`// code

`;s+=this.flowCode[i];const o=this.flowNodes[i],l=o[o.length-1],u=l.outputNode,c=u!==void 0&&u.isOutputStructNode===!0;for(const d of o){const p=this.getFlowData(d),f=d.name;if(f&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${f}
	`),s+=`${p.code}
	`,d===l&&i!=="compute"){if(s+=`// result

	`,i==="vertex")s+=`varyings.Vertex = ${p.result};`;else if(i==="fragment")if(c)n.returnType=u.nodeType,s+=`return ${p.result};`;else{let m="	@location(0) color: vec4<f32>";const g=this.getBuiltins("output");g&&(m+=`,
	`+g),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",m),n.structs+=`
var<private> output : OutputStruct;

`,s+=`output.color = ${p.result};

	return output;`}}}n.flow=s}this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,i=null){let n;return i!==null&&(n=this._getWGSLMethod(e+"_"+i)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getType(e){return w0e[e]||e}isAvailable(e){let i=xz[e];return i===void 0&&(e==="float32Filterable"&&(i=this.renderer.hasFeature("float32-filterable")),xz[e]=i),i}_getWGSLMethod(e){return eh[e]!==void 0&&this._include(e),Ty[e]}_include(e){const i=eh[e];return i.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(i),i}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${bz}

// uniforms
${e.uniforms}

// structs
${e.structs}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,i){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${i} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = id.x + id.y * numWorkgroups.x * u32(${i}) + id.z * numWorkgroups.x * numWorkgroups.y * u32(${i});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,i){return`
struct ${e} {
${i}
};`}_getWGSLStructBinding(e,i,n,s=0,o=0){const l=e+"Struct";return`${this._getWGSLStruct(l,i)}
@binding( ${s} ) @group( ${o} )
var<${n}> ${e} : ${l};`}}class S0e{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let i;return e.depthTexture!==null?i=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?i=ht.Depth24PlusStencil8:e.depth&&(i=ht.Depth24Plus),i}getTextureFormatGPU(e){return this.backend.get(e).format}getCurrentColorFormat(e){let i;return e.textures!==null?i=this.getTextureFormatGPU(e.textures[0]):i=this.getPreferredCanvasFormat(),i}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,i){if(e.isPoints)return Cg.PointList;if(e.isLineSegments||e.isMesh&&i.wireframe===!0)return Cg.LineList;if(e.isLine)return Cg.LineStrip;if(e.isMesh)return Cg.TriangleList}getSampleCount(e){let i=1;return e>1&&(i=Math.pow(2,Math.floor(Math.log2(e))),i===2&&(i=4)),i}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){return navigator.userAgent.includes("Quest")?ht.BGRA8Unorm:navigator.gpu.getPreferredCanvasFormat()}}const T0e=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),M0e=new Map([[r5,["float16"]]]),R0e=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class I0e{constructor(e){this.backend=e}createAttribute(e,i){const n=this._getBufferAttribute(e),s=this.backend,o=s.get(n);let l=o.buffer;if(l===void 0){const u=s.device;let c=n.array;if(e.normalized===!1&&(c.constructor===Int16Array||c.constructor===Uint16Array)){const p=new Uint32Array(c.length);for(let f=0;f<c.length;f++)p[f]=c[f];c=p}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let p=0;p<n.count;p++)c.set(n.array.subarray(p*3,p*3+3),p*4);n.itemSize=4,n.array=c}const d=c.byteLength+(4-c.byteLength%4)%4;l=u.createBuffer({label:n.name,size:d,usage:i,mappedAtCreation:!0}),new c.constructor(l.getMappedRange()).set(c),l.unmap(),o.buffer=l}}updateAttribute(e){const i=this._getBufferAttribute(e),n=this.backend,s=n.device,o=n.get(i).buffer,l=i.array,u=i.updateRanges;if(u.length===0)s.queue.writeBuffer(o,0,l,0);else{for(let c=0,d=u.length;c<d;c++){const p=u[c];s.queue.writeBuffer(o,0,l,p.start*l.BYTES_PER_ELEMENT,p.count*l.BYTES_PER_ELEMENT)}i.clearUpdateRanges()}}createShaderVertexBuffers(e){const i=e.getAttributes(),n=new Map;for(let s=0;s<i.length;s++){const o=i[s],l=o.array.BYTES_PER_ELEMENT,u=this._getBufferAttribute(o);let c=n.get(u);if(c===void 0){let f,m;o.isInterleavedBufferAttribute===!0?(f=o.data.stride*l,m=o.data.isInstancedInterleavedBuffer?u_.Instance:u_.Vertex):(f=o.itemSize*l,m=o.isInstancedBufferAttribute?u_.Instance:u_.Vertex),o.normalized===!1&&(o.array.constructor===Int16Array||o.array.constructor===Uint16Array)&&(f=4),c={arrayStride:f,attributes:[],stepMode:m},n.set(u,c)}const d=this._getVertexFormat(o),p=o.isInterleavedBufferAttribute===!0?o.offset*l:0;c.attributes.push({shaderLocation:s,offset:p,format:d})}return Array.from(n.values())}destroyAttribute(e){const i=this.backend;i.get(this._getBufferAttribute(e)).buffer.destroy(),i.delete(e)}async getArrayBufferAsync(e){const i=this.backend,n=i.device,s=i.get(this._getBufferAttribute(e)).buffer,o=s.size,l=n.createBuffer({label:e.name,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),u=n.createCommandEncoder({});u.copyBufferToBuffer(s,0,l,0,o),l.unmap();const c=u.finish();return n.queue.submit([c]),await l.mapAsync(GPUMapMode.READ),l.getMappedRange()}_getVertexFormat(e){const{itemSize:i,normalized:n}=e,s=e.array.constructor,o=e.constructor;let l;if(i==1)l=R0e.get(s);else{const u=(M0e.get(o)||T0e.get(s))[n?1:0];if(u){const c=s.BYTES_PER_ELEMENT*i,d=Math.floor((c+3)/4)*4/s.BYTES_PER_ELEMENT;if(d%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");l=`${u}x${d}`}}return l||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),l}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class B0e{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const i=this.backend.device,n=[];let s=0;for(const o of e.bindings){const l={binding:s++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const u={};o.isStorageBuffer&&(u.type=o.access),l.buffer=u}else if(o.isSampler){const u={};o.texture.isDepthTexture&&o.texture.compareFunction!==null&&(u.type="comparison"),l.sampler=u}else if(o.isSampledTexture&&o.texture.isVideoTexture)l.externalTexture={};else if(o.isSampledTexture&&o.store){const u=this.backend.get(o.texture).texture.format,c=o.access;l.storageTexture={format:u,access:c}}else if(o.isSampledTexture){const u={};if(o.texture.isMultisampleRenderTargetTexture===!0&&(u.multisampled=!0),o.texture.isDepthTexture)u.sampleType=wy.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const c=o.texture.type;c===Ao?u.sampleType=wy.SInt:c===Da?u.sampleType=wy.UInt:c===ll&&(this.backend.hasFeature("float32-filterable")?u.sampleType=wy.Float:u.sampleType=wy.UnfilterableFloat)}o.isSampledCubeTexture?u.viewDimension=Nl.Cube:o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?u.viewDimension=Nl.TwoDArray:o.isSampledTexture3D&&(u.viewDimension=Nl.ThreeD),l.texture=u}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);n.push(l)}return i.createBindGroupLayout({entries:n})}createBindings(e){const{backend:i,bindGroupLayoutCache:n}=this,s=i.get(e);let o=n.get(e.bindingsReference);o===void 0&&(o=this.createBindingsLayout(e),n.set(e.bindingsReference,o));const l=this.createBindGroup(e,o);s.layout=o,s.group=l}updateBinding(e){const i=this.backend,n=i.device,s=e.buffer,o=i.get(e).buffer;n.queue.writeBuffer(o,0,s,0)}createBindGroup(e,i){const n=this.backend,s=n.device;let o=0;const l=[];for(const u of e.bindings){if(u.isUniformBuffer){const c=n.get(u);if(c.buffer===void 0){const d=u.byteLength,p=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,f=s.createBuffer({label:"bindingBuffer_"+u.name,size:d,usage:p});c.buffer=f}l.push({binding:o,resource:{buffer:c.buffer}})}else if(u.isStorageBuffer){const c=n.get(u);if(c.buffer===void 0){const d=u.attribute;c.buffer=n.get(d).buffer}l.push({binding:o,resource:{buffer:c.buffer}})}else if(u.isSampler){const c=n.get(u.texture);l.push({binding:o,resource:c.sampler})}else if(u.isSampledTexture){const c=n.get(u.texture);let d;if(c.externalTexture!==void 0)d=s.importExternalTexture({source:c.externalTexture});else{const p=u.store?1:c.texture.mipLevelCount,f=`view-${c.texture.width}-${c.texture.height}-${p}`;if(d=c[f],d===void 0){const m=yme.All;let g;u.isSampledCubeTexture?g=Nl.Cube:u.isSampledTexture3D?g=Nl.ThreeD:u.texture.isDataArrayTexture||u.texture.isCompressedArrayTexture?g=Nl.TwoDArray:g=Nl.TwoD,d=c[f]=c.texture.createView({aspect:m,dimension:g,mipLevelCount:p})}}l.push({binding:o,resource:d})}o++}return s.createBindGroup({label:"bindGroup_"+e.name,layout:i,entries:l})}}class N0e{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,i){const{object:n,material:s,geometry:o,pipeline:l}=e,{vertexProgram:u,fragmentProgram:c}=l,d=this.backend,p=d.device,f=d.utils,m=d.get(l),g=[];for(const H of e.getBindings()){const V=d.get(H);g.push(V.layout)}const y=d.attributeUtils.createShaderVertexBuffers(e);let x;s.transparent===!0&&s.blending!==Vm&&(x=this._getBlending(s));let v={};s.stencilWrite===!0&&(v={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});const _=this._getColorWriteMask(s),T=[];if(e.context.textures!==null){const H=e.context.textures;for(let V=0;V<H.length;V++){const $=f.getTextureFormatGPU(H[V]);T.push({format:$,blend:x,writeMask:_})}}else{const H=f.getCurrentColorFormat(e.context);T.push({format:H,blend:x,writeMask:_})}const w=d.get(u).module,S=d.get(c).module,R=this._getPrimitiveState(n,o,s),B=this._getDepthCompare(s),I=f.getCurrentDepthStencilFormat(e.context),D=this._getSampleCount(e.context),L={label:`renderPipeline_${s.name||s.type}_${s.id}`,vertex:Object.assign({},w,{buffers:y}),fragment:Object.assign({},S,{targets:T}),primitive:R,multisample:{count:D,alphaToCoverageEnabled:s.alphaToCoverage&&D>1},layout:p.createPipelineLayout({bindGroupLayouts:g})},O={},U=e.context.depth,J=e.context.stencil;if((U===!0||J===!0)&&(U===!0&&(O.format=I,O.depthWriteEnabled=s.depthWrite,O.depthCompare=B),J===!0&&(O.stencilFront=v,O.stencilBack={},O.stencilReadMask=s.stencilFuncMask,O.stencilWriteMask=s.stencilWriteMask),L.depthStencil=O),i===null)m.pipeline=p.createRenderPipeline(L);else{const H=new Promise(V=>{p.createRenderPipelineAsync(L).then($=>{m.pipeline=$,V()})});i.push(H)}}createBundleEncoder(e){const i=this.backend,{utils:n,device:s}=i,o=n.getCurrentDepthStencilFormat(e),l=n.getCurrentColorFormat(e),u=this._getSampleCount(e),c={label:"renderBundleEncoder",colorFormats:[l],depthStencilFormat:o,sampleCount:u};return s.createRenderBundleEncoder(c)}createComputePipeline(e,i){const n=this.backend,s=n.device,o=n.get(e.computeProgram).module,l=n.get(e),u=[];for(const c of i){const d=n.get(c);u.push(d.layout)}l.pipeline=s.createComputePipeline({compute:o,layout:s.createPipelineLayout({bindGroupLayouts:u})})}_getBlending(e){let i,n;const s=e.blending,o=e.blendSrc,l=e.blendDst,u=e.blendEquation;if(s===tU){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:o,d=e.blendDstAlpha!==null?e.blendDstAlpha:l,p=e.blendEquationAlpha!==null?e.blendEquationAlpha:u;i={srcFactor:this._getBlendFactor(o),dstFactor:this._getBlendFactor(l),operation:this._getBlendOperation(u)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(d),operation:this._getBlendOperation(p)}}else{const c=e.premultipliedAlpha,d=(p,f,m,g)=>{i={srcFactor:p,dstFactor:f,operation:jp.Add},n={srcFactor:m,dstFactor:g,operation:jp.Add}};if(c)switch(s){case Zh:d(Wr.One,Wr.OneMinusSrcAlpha,Wr.One,Wr.OneMinusSrcAlpha);break;case r1:d(Wr.One,Wr.One,Wr.One,Wr.One);break;case n1:d(Wr.Zero,Wr.OneMinusSrc,Wr.Zero,Wr.One);break;case s1:d(Wr.Zero,Wr.Src,Wr.Zero,Wr.SrcAlpha);break}else switch(s){case Zh:d(Wr.SrcAlpha,Wr.OneMinusSrcAlpha,Wr.One,Wr.OneMinusSrcAlpha);break;case r1:d(Wr.SrcAlpha,Wr.One,Wr.SrcAlpha,Wr.One);break;case n1:d(Wr.Zero,Wr.OneMinusSrc,Wr.Zero,Wr.One);break;case s1:d(Wr.Zero,Wr.Src,Wr.Zero,Wr.Src);break}}if(i!==void 0&&n!==void 0)return{color:i,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",s)}_getBlendFactor(e){let i;switch(e){case nU:i=Wr.Zero;break;case sU:i=Wr.One;break;case aU:i=Wr.Src;break;case oU:i=Wr.OneMinusSrc;break;case a1:i=Wr.SrcAlpha;break;case o1:i=Wr.OneMinusSrcAlpha;break;case uU:i=Wr.Dst;break;case hU:i=Wr.OneMinusDstColor;break;case lU:i=Wr.DstAlpha;break;case cU:i=Wr.OneMinusDstAlpha;break;case dU:i=Wr.SrcAlphaSaturated;break;case Qfe:i=Wr.Constant;break;case qfe:i=Wr.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return i}_getStencilCompare(e){let i;const n=e.stencilFunc;switch(n){case wle:i=Ua.Never;break;case MM:i=Ua.Always;break;case Cle:i=Ua.Less;break;case Tle:i=Ua.LessEqual;break;case Sle:i=Ua.Equal;break;case Ile:i=Ua.GreaterEqual;break;case Mle:i=Ua.Greater;break;case Rle:i=Ua.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return i}_getStencilOperation(e){let i;switch(e){case Cp:i=yd.Keep;break;case Ale:i=yd.Zero;break;case yle:i=yd.Replace;break;case Ele:i=yd.Invert;break;case vle:i=yd.IncrementClamp;break;case xle:i=yd.DecrementClamp;break;case ble:i=yd.IncrementWrap;break;case _le:i=yd.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",i)}return i}_getBlendOperation(e){let i;switch(e){case $h:i=jp.Add;break;case iU:i=jp.Subtract;break;case rU:i=jp.ReverseSubtract;break;case $oe:i=jp.Min;break;case ele:i=jp.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return i}_getPrimitiveState(e,i,n){const s={},o=this.backend.utils;switch(s.topology=o.getPrimitiveTopology(e,n),i.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(s.stripIndexFormat=i.index.array instanceof Uint16Array?Sg.Uint16:Sg.Uint32),n.side){case zm:s.frontFace=nR.CCW,s.cullMode=sR.Back;break;case lc:s.frontFace=nR.CCW,s.cullMode=sR.Front;break;case jm:s.frontFace=nR.CCW,s.cullMode=sR.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side);break}return s}_getColorWriteMask(e){return e.colorWrite===!0?L8.All:L8.None}_getDepthCompare(e){let i;if(e.depthTest===!1)i=Ua.Always;else{const n=e.depthFunc;switch(n){case pU:i=Ua.Never;break;case fU:i=Ua.Always;break;case mU:i=Ua.Less;break;case l1:i=Ua.LessEqual;break;case gU:i=Ua.Equal;break;case AU:i=Ua.GreaterEqual;break;case yU:i=Ua.Greater;break;case vU:i=Ua.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return i}}class L0e extends pz{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.trackTimestamp=e.trackTimestamp===!0,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new S0e(this),this.attributeUtils=new I0e(this),this.bindingUtils=new B0e(this),this.pipelineUtils=new N0e(this),this.textureUtils=new A0e(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const i=this.parameters;let n;if(i.device===void 0){const l={powerPreference:i.powerPreference},u=await navigator.gpu.requestAdapter(l);if(u===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const c=Object.values(lR),d=[];for(const f of c)u.features.has(f)&&d.push(f);const p={requiredFeatures:d,requiredLimits:i.requiredLimits};n=await u.requestDevice(p)}else n=i.device;n.lost.then(l=>{const u={api:"WebGPU",message:l.message||"Unknown reason",reason:l.reason||null,originalEvent:l};e.onDeviceLost(u)});const s=i.context!==void 0?i.context:e.domElement.getContext("webgpu");this.device=n,this.context=s;const o=i.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(lR.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:o}),this.updateSize()}get coordinateSystem(){return Sp}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const n=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()});const s=e.colorAttachments[0];this.renderer.samples>0?s.view=this.colorBuffer.createView():s.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const i=e.colorAttachments[0];return this.renderer.samples>0?i.resolveTarget=this.context.getCurrentTexture().createView():i.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e){const i=e.renderTarget,n=this.get(i);let s=n.descriptors;if(s===void 0||n.width!==i.width||n.height!==i.height||n.activeMipmapLevel!==i.activeMipmapLevel||n.samples!==i.samples){s={},n.descriptors=s;const u=()=>{i.removeEventListener("dispose",u),this.delete(i)};i.addEventListener("dispose",u)}const o=e.getCacheKey();let l=s[o];if(l===void 0){const u=e.textures,c=[];for(let d=0;d<u.length;d++){const p=this.get(u[d]),f=p.texture.createView({baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,dimension:Nl.TwoD});let m,g;p.msaaTexture!==void 0?(m=p.msaaTexture.createView(),g=f):(m=f,g=void 0),c.push({view:m,resolveTarget:g,loadOp:ia.Load,storeOp:za.Store})}if(l={colorAttachments:c},e.depth){const d={view:this.get(e.depthTexture).texture.createView()};l.depthStencilAttachment=d}s[o]=l,n.width=i.width,n.height=i.height,n.samples=i.samples,n.activeMipmapLevel=i.activeMipmapLevel}return l}beginRender(e){const i=this.get(e),n=this.device,s=e.occlusionQueryCount;let o;s>0&&(i.currentOcclusionQuerySet&&i.currentOcclusionQuerySet.destroy(),i.currentOcclusionQueryBuffer&&i.currentOcclusionQueryBuffer.destroy(),i.currentOcclusionQuerySet=i.occlusionQuerySet,i.currentOcclusionQueryBuffer=i.occlusionQueryBuffer,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,o=n.createQuerySet({type:"occlusion",count:s}),i.occlusionQuerySet=o,i.occlusionQueryIndex=0,i.occlusionQueryObjects=new Array(s),i.lastOcclusionObject=null);let l;e.textures===null?l=this._getDefaultRenderPassDescriptor():l=this._getRenderPassDescriptor(e),this.initTimestampQuery(e,l),l.occlusionQuerySet=o;const u=l.depthStencilAttachment;if(e.textures!==null){const p=l.colorAttachments;for(let f=0;f<p.length;f++){const m=p[f];e.clearColor?(m.clearValue=f===0?e.clearColorValue:{r:0,g:0,b:0,a:1},m.loadOp=ia.Clear,m.storeOp=za.Store):(m.loadOp=ia.Load,m.storeOp=za.Store)}}else{const p=l.colorAttachments[0];e.clearColor?(p.clearValue=e.clearColorValue,p.loadOp=ia.Clear,p.storeOp=za.Store):(p.loadOp=ia.Load,p.storeOp=za.Store)}e.depth&&(e.clearDepth?(u.depthClearValue=e.clearDepthValue,u.depthLoadOp=ia.Clear,u.depthStoreOp=za.Store):(u.depthLoadOp=ia.Load,u.depthStoreOp=za.Store)),e.stencil&&(e.clearStencil?(u.stencilClearValue=e.clearStencilValue,u.stencilLoadOp=ia.Clear,u.stencilStoreOp=za.Store):(u.stencilLoadOp=ia.Load,u.stencilStoreOp=za.Store));const c=n.createCommandEncoder({label:"renderContext_"+e.id}),d=c.beginRenderPass(l);if(i.descriptor=l,i.encoder=c,i.currentPass=d,i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},i.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:p,y:f,width:m,height:g}=e.scissorValue;d.setScissorRect(p,f,m,g)}}finishRender(e){const i=this.get(e),n=e.occlusionQueryCount;if(i.renderBundles.length>0&&i.currentPass.executeBundles(i.renderBundles),n>i.occlusionQueryIndex&&i.currentPass.endOcclusionQuery(),i.currentPass.end(),n>0){const s=n*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const l=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});i.encoder.resolveQuerySet(i.occlusionQuerySet,0,n,o,0),i.encoder.copyBufferToBuffer(o,0,l,0,s),i.occlusionQueryBuffer=l,this.resolveOccludedAsync(e)}if(this.prepareTimestampBuffer(e,i.encoder),this.device.queue.submit([i.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const l=s[o];l.generateMipmaps===!0&&this.textureUtils.generateMipmaps(l)}}}isOccluded(e,i){const n=this.get(e);return n.occluded&&n.occluded.has(i)}async resolveOccludedAsync(e){const i=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:s}=i;if(n&&s){const o=new WeakSet;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const l=n.getMappedRange(),u=new BigUint64Array(l);for(let c=0;c<s.length;c++)u[c]!==BigInt(0)&&o.add(s[c]);n.destroy(),i.occluded=o}}updateViewport(e){const{currentPass:i}=this.get(e),{x:n,y:s,width:o,height:l,minDepth:u,maxDepth:c}=e.viewportValue;i.setViewport(n,s,o,l,u,c)}clear(e,i,n,s=null){const o=this.device,l=this.renderer;let u=[],c,d,p,f;if(e){const g=this.getClearColor();if(this.renderer.alpha===!0){const y=g.a;d={r:g.r*y,g:g.g*y,b:g.b*y,a:y}}else d={r:g.r,g:g.g,b:g.b,a:g.a}}if(s===null){p=l.depth,f=l.stencil;const g=this._getDefaultRenderPassDescriptor();if(e){u=g.colorAttachments;const y=u[0];y.clearValue=d,y.loadOp=ia.Clear,y.storeOp=za.Store}(p||f)&&(c=g.depthStencilAttachment)}else{if(p=s.depth,f=s.stencil,e)for(const g of s.textures){const y=this.get(g),x=y.texture.createView();let v,_;y.msaaTexture!==void 0?(v=y.msaaTexture.createView(),_=x):(v=x,_=void 0),u.push({view:v,resolveTarget:_,clearValue:d,loadOp:ia.Clear,storeOp:za.Store})}(p||f)&&(c={view:this.get(s.depthTexture).texture.createView()})}p&&(i?(c.depthLoadOp=ia.Clear,c.depthClearValue=l.getClearDepth(),c.depthStoreOp=za.Store):(c.depthLoadOp=ia.Load,c.depthStoreOp=za.Store)),f&&(n?(c.stencilLoadOp=ia.Clear,c.stencilClearValue=l.getClearStencil(),c.stencilStoreOp=za.Store):(c.stencilLoadOp=ia.Load,c.stencilStoreOp=za.Store));const m=o.createCommandEncoder({});m.beginRenderPass({colorAttachments:u,depthStencilAttachment:c}).end(),o.queue.submit([m.finish()])}beginCompute(e){const i=this.get(e),n={};this.initTimestampQuery(e,n),i.cmdEncoderGPU=this.device.createCommandEncoder(),i.passEncoderGPU=i.cmdEncoderGPU.beginComputePass(n)}compute(e,i,n,s){const{passEncoderGPU:o}=this.get(e),l=this.get(s).pipeline;o.setPipeline(l);for(let p=0,f=n.length;p<f;p++){const m=n[p],g=this.get(m);o.setBindGroup(p,g.group)}const u=this.device.limits.maxComputeWorkgroupsPerDimension,c=this.get(i);c.dispatchSize===void 0&&(c.dispatchSize={x:0,y:1,z:1});const{dispatchSize:d}=c;i.dispatchCount>u?(d.x=Math.min(i.dispatchCount,u),d.y=Math.ceil(i.dispatchCount/u)):d.x=i.dispatchCount,o.dispatchWorkgroups(d.x,d.y,d.z)}finishCompute(e){const i=this.get(e);i.passEncoderGPU.end(),this.prepareTimestampBuffer(e,i.cmdEncoderGPU),this.device.queue.submit([i.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,i){const{object:n,context:s,pipeline:o}=e,l=e.getBindings(),u=this.get(s),c=this.get(o).pipeline,d=u.currentSets,p=u.currentPass,f=e.getDrawParameters();if(f===null)return;d.pipeline!==c&&(p.setPipeline(c),d.pipeline=c);const m=d.bindingGroups;for(let v=0,_=l.length;v<_;v++){const T=l[v],w=this.get(T);m[T.index]!==T.id&&(p.setBindGroup(T.index,w.group),m[T.index]=T.id)}const g=e.getIndex(),y=g!==null;if(y===!0&&d.index!==g){const v=this.get(g).buffer,_=g.array instanceof Uint16Array?Sg.Uint16:Sg.Uint32;p.setIndexBuffer(v,_),d.index=g}const x=e.getVertexBuffers();for(let v=0,_=x.length;v<_;v++){const T=x[v];if(d.attributes[v]!==T){const w=this.get(T).buffer;p.setVertexBuffer(v,w),d.attributes[v]=T}}if(u.occlusionQuerySet!==void 0){const v=u.lastOcclusionObject;v!==n&&(v!==null&&v.occlusionTest===!0&&(p.endOcclusionQuery(),u.occlusionQueryIndex++),n.occlusionTest===!0&&(p.beginOcclusionQuery(u.occlusionQueryIndex),u.occlusionQueryObjects[u.occlusionQueryIndex]=n),u.lastOcclusionObject=n)}if(n.isBatchedMesh===!0){const v=n._multiDrawStarts,_=n._multiDrawCounts,T=n._multiDrawCount,w=n._multiDrawInstances,S=y?g.array.BYTES_PER_ELEMENT:1;for(let R=0;R<T;R++){const B=w?w[R]:1,I=B>1?0:R;p.drawIndexed(_[R],B,v[R]/S,0,I)}}else if(y===!0){const{vertexCount:v,instanceCount:_,firstVertex:T}=f,w=e.getIndirect();if(w!==null){const S=this.get(w).buffer;p.drawIndexedIndirect(S,0)}else p.drawIndexed(v,_,T,0,0);i.update(n,v,_)}else{const{vertexCount:v,instanceCount:_,firstVertex:T}=f,w=e.getIndirect();if(w!==null){const S=this.get(w).buffer;p.drawIndirect(S,0)}else p.draw(v,_,T,0);i.update(n,v,_)}}needsRenderUpdate(e){const i=this.get(e),{object:n,material:s}=e,o=this.utils,l=o.getSampleCountRenderContext(e.context),u=o.getCurrentColorSpace(e.context),c=o.getCurrentColorFormat(e.context),d=o.getCurrentDepthStencilFormat(e.context),p=o.getPrimitiveTopology(n,s);let f=!1;return(i.material!==s||i.materialVersion!==s.version||i.transparent!==s.transparent||i.blending!==s.blending||i.premultipliedAlpha!==s.premultipliedAlpha||i.blendSrc!==s.blendSrc||i.blendDst!==s.blendDst||i.blendEquation!==s.blendEquation||i.blendSrcAlpha!==s.blendSrcAlpha||i.blendDstAlpha!==s.blendDstAlpha||i.blendEquationAlpha!==s.blendEquationAlpha||i.colorWrite!==s.colorWrite||i.depthWrite!==s.depthWrite||i.depthTest!==s.depthTest||i.depthFunc!==s.depthFunc||i.stencilWrite!==s.stencilWrite||i.stencilFunc!==s.stencilFunc||i.stencilFail!==s.stencilFail||i.stencilZFail!==s.stencilZFail||i.stencilZPass!==s.stencilZPass||i.stencilFuncMask!==s.stencilFuncMask||i.stencilWriteMask!==s.stencilWriteMask||i.side!==s.side||i.alphaToCoverage!==s.alphaToCoverage||i.sampleCount!==l||i.colorSpace!==u||i.colorFormat!==c||i.depthStencilFormat!==d||i.primitiveTopology!==p||i.clippingContextCacheKey!==e.clippingContext.cacheKey)&&(i.material=s,i.materialVersion=s.version,i.transparent=s.transparent,i.blending=s.blending,i.premultipliedAlpha=s.premultipliedAlpha,i.blendSrc=s.blendSrc,i.blendDst=s.blendDst,i.blendEquation=s.blendEquation,i.blendSrcAlpha=s.blendSrcAlpha,i.blendDstAlpha=s.blendDstAlpha,i.blendEquationAlpha=s.blendEquationAlpha,i.colorWrite=s.colorWrite,i.depthWrite=s.depthWrite,i.depthTest=s.depthTest,i.depthFunc=s.depthFunc,i.stencilWrite=s.stencilWrite,i.stencilFunc=s.stencilFunc,i.stencilFail=s.stencilFail,i.stencilZFail=s.stencilZFail,i.stencilZPass=s.stencilZPass,i.stencilFuncMask=s.stencilFuncMask,i.stencilWriteMask=s.stencilWriteMask,i.side=s.side,i.alphaToCoverage=s.alphaToCoverage,i.sampleCount=l,i.colorSpace=u,i.colorFormat=c,i.depthStencilFormat=d,i.primitiveTopology=p,i.clippingContextCacheKey=e.clippingContext.cacheKey,f=!0),f}getRenderCacheKey(e){const{object:i,material:n}=e,s=this.utils,o=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,s.getSampleCountRenderContext(o),s.getCurrentColorSpace(o),s.getCurrentColorFormat(o),s.getCurrentDepthStencilFormat(o),s.getPrimitiveTopology(i,n),e.getGeometryCacheKey(),e.clippingContext.cacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,n,s,o,l){return this.textureUtils.copyTextureToBuffer(e,i,n,s,o,l)}initTimestampQuery(e,i){if(!this.trackTimestamp)return;const n=this.get(e);if(!n.timeStampQuerySet){const s=this.device.createQuerySet({type:"timestamp",count:2});Object.assign(i,{timestampWrites:{querySet:s,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}),n.timeStampQuerySet=s}}prepareTimestampBuffer(e,i){if(!this.trackTimestamp)return;const n=this.get(e),s=2*BigInt64Array.BYTES_PER_ELEMENT;n.currentTimestampQueryBuffers===void 0&&(n.currentTimestampQueryBuffers={resolveBuffer:this.device.createBuffer({label:"timestamp resolve buffer",size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),resultBuffer:this.device.createBuffer({label:"timestamp result buffer",size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),isMappingPending:!1});const{resolveBuffer:o,resultBuffer:l,isMappingPending:u}=n.currentTimestampQueryBuffers;u!==!0&&(i.resolveQuerySet(n.timeStampQuerySet,0,2,o,0),i.copyBufferToBuffer(o,0,l,0,s))}async resolveTimestampAsync(e,i="render"){if(!this.trackTimestamp)return;const n=this.get(e);if(n.currentTimestampQueryBuffers===void 0)return;const{resultBuffer:s,isMappingPending:o}=n.currentTimestampQueryBuffers;o!==!0&&(n.currentTimestampQueryBuffers.isMappingPending=!0,s.mapAsync(GPUMapMode.READ).then(()=>{const l=new BigUint64Array(s.getMappedRange()),u=Number(l[1]-l[0])/1e6;this.renderer.info.updateTimestamp(i,u),s.unmap(),n.currentTimestampQueryBuffers.isMappingPending=!1}))}createNodeBuilder(e,i){return new C0e(e,i)}createProgram(e){const i=this.get(e);i.module={module:this.device.createShaderModule({code:e.code,label:e.stage}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,i){this.pipelineUtils.createRenderPipeline(e,i)}createComputePipeline(e,i){this.pipelineUtils.createComputePipeline(e,i)}beginBundle(e){const i=this.get(e);i._currentPass=i.currentPass,i._currentSets=i.currentSets,i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},i.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,i){const n=this.get(e),s=n.currentPass.finish();this.get(i).bundleGPU=s,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,i){this.get(e).renderBundles.push(this.get(i).bundleGPU)}createBindings(e){this.bindingUtils.createBindings(e)}updateBindings(e){this.bindingUtils.createBindings(e)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,i,n=null,s=null,o=0){let l=0,u=0,c=0,d=0,p=0,f=0,m=e.image.width,g=e.image.height;n!==null&&(d=n.x,p=n.y,f=n.z||0,m=n.width,g=n.height),s!==null&&(l=s.x,u=s.y,c=s.z||0);const y=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+i.id}),x=this.get(e).texture,v=this.get(i).texture;y.copyTextureToTexture({texture:x,mipLevel:o,origin:{x:d,y:p,z:f}},{texture:v,mipLevel:o,origin:{x:l,y:u,z:c}},[m,g,1]),this.device.queue.submit([y.finish()])}copyFramebufferToTexture(e,i,n){const s=this.get(i);let o=null;i.renderTarget?e.isDepthTexture?o=this.get(i.depthTexture).texture:o=this.get(i.textures[0]).texture:e.isDepthTexture?o=this.textureUtils.getDepthBuffer(i.depth,i.stencil):o=this.context.getCurrentTexture();const l=this.get(e).texture;if(o.format!==l.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",o.format,l.format);return}let u;if(s.currentPass?(s.currentPass.end(),u=s.encoder):u=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),u.copyTextureToTexture({texture:o,origin:{x:n.x,y:n.y,z:0}},{texture:l},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),s.currentPass){const{descriptor:c}=s;for(let d=0;d<c.colorAttachments.length;d++)c.colorAttachments[d].loadOp=ia.Load;i.depth&&(c.depthStencilAttachment.depthLoadOp=ia.Load),i.stencil&&(c.depthStencilAttachment.stencilLoadOp=ia.Load),s.currentPass=u.beginRenderPass(c),s.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null}}else this.device.queue.submit([u.finish()])}}class D0e extends T5{constructor(e,i,n,s,o,l){super(e,i,n,s,o,l),this.iesMap=null}copy(e,i){return super.copy(e,i),this.iesMap=e.iesMap,this}}class O0e extends rz{constructor(){super(),this.addMaterial(Fpe,v5),this.addMaterial(w8,r3),this.addMaterial(Efe,y5),this.addMaterial(Tfe,x5),this.addMaterial(Ipe,w1),this.addMaterial(Ope,_5),this.addMaterial(wpe,b5),this.addMaterial(Bfe,E5),this.addMaterial(vpe,t3),this.addMaterial(bpe,w5),this.addMaterial(Lfe,g5),this.addMaterial(Ffe,f5),this.addMaterial(zfe,A5),this.addLight(Kme,Mce),this.addLight(Sge,Ice),this.addLight(Tge,Nce),this.addLight($8,T5),this.addLight(Rge,Bce),this.addLight(Ige,Cce),this.addLight(Bge,Dce),this.addLight(Mge,D0e),this.addToneMapping(bme,rle),this.addToneMapping(_me,nle),this.addToneMapping(Eme,sle),this.addToneMapping(Cme,ale),this.addToneMapping(Rme,ole),this.addToneMapping(Ime,lle)}}class P0e extends Vge{constructor(e={}){let i;e.forceWebGL?i=yz:(i=L0e,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new yz(e)));const n=new i(e);super(n,e),this.library=new O0e,this.isWebGPURenderer=!0}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t1}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t1);const NR={type:"change"},LR={type:"start"},DR={type:"end"},_z=1e-6,Qn={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},__=new zi,xd=new zi,F0e=new at,E_=new at,OR=new at,Ng=new Nc,Ez=new at,w_=new at,PR=new at,C_=new at;class k0e extends Mb{constructor(e,i=null){super(e,i),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Na.ROTATE,MIDDLE:Na.DOLLY,RIGHT:Na.PAN},this.state=Qn.NONE,this.keyState=Qn.NONE,this.target=new at,this._lastPosition=new at,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new at,this._movePrev=new zi,this._moveCurr=new zi,this._lastAxis=new at,this._zoomStart=new zi,this._zoomEnd=new zi,this._panStart=new zi,this._panEnd=new zi,this._pointers=[],this._pointerPositions={},this._onPointerMove=z0e.bind(this),this._onPointerDown=U0e.bind(this),this._onPointerUp=j0e.bind(this),this._onPointerCancel=V0e.bind(this),this._onContextMenu=Y0e.bind(this),this._onMouseWheel=X0e.bind(this),this._onKeyDown=H0e.bind(this),this._onKeyUp=G0e.bind(this),this._onTouchStart=K0e.bind(this),this._onTouchMove=J0e.bind(this),this._onTouchEnd=Z0e.bind(this),this._onMouseDown=W0e.bind(this),this._onMouseMove=Q0e.bind(this),this._onMouseUp=q0e.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,i!==null&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),i=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-i.clientLeft,this.screen.top=e.top+window.pageYOffset-i.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>_z&&(this.dispatchEvent(NR),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>_z||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(NR),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Qn.NONE,this.keyState=Qn.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(NR),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(xd.copy(this._panEnd).sub(this._panStart),xd.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,i=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;xd.x*=e,xd.y*=i}xd.multiplyScalar(this._eye.length()*this.panSpeed),E_.copy(this._eye).cross(this.object.up).setLength(xd.x),E_.add(F0e.copy(this.object.up).setLength(xd.y)),this.object.position.add(E_),this.target.add(E_),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(xd.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){C_.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=C_.length();e?(this._eye.copy(this.object.position).sub(this.target),Ez.copy(this._eye).normalize(),w_.copy(this.object.up).normalize(),PR.crossVectors(w_,Ez).normalize(),w_.setLength(this._moveCurr.y-this._movePrev.y),PR.setLength(this._moveCurr.x-this._movePrev.x),C_.copy(w_.add(PR)),OR.crossVectors(C_,this._eye).normalize(),e*=this.rotateSpeed,Ng.setFromAxisAngle(OR,e),this._eye.applyQuaternion(Ng),this.object.up.applyQuaternion(Ng),this._lastAxis.copy(OR),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Ng.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Ng),this.object.up.applyQuaternion(Ng)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Qn.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=rS.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=rS.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,i){return __.set((e-this.screen.left)/this.screen.width,(i-this.screen.top)/this.screen.height),__}_getMouseOnCircle(e,i){return __.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-i))/this.screen.width),__}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i].pointerId==e.pointerId){this._pointers.splice(i,1);return}}_trackPointer(e){let i=this._pointerPositions[e.pointerId];i===void 0&&(i=new zi,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const i=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[i.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function U0e(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r))}function z0e(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function j0e(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchEnd(r):this._onMouseUp(),this._removePointer(r),this._pointers.length===0&&(this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function V0e(r){this._removePointer(r)}function G0e(){this.enabled!==!1&&(this.keyState=Qn.NONE,window.addEventListener("keydown",this._onKeyDown))}function H0e(r){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Qn.NONE&&(r.code===this.keys[Qn.ROTATE]&&!this.noRotate?this.keyState=Qn.ROTATE:r.code===this.keys[Qn.ZOOM]&&!this.noZoom?this.keyState=Qn.ZOOM:r.code===this.keys[Qn.PAN]&&!this.noPan&&(this.keyState=Qn.PAN)))}function W0e(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Na.DOLLY:this.state=Qn.ZOOM;break;case Na.ROTATE:this.state=Qn.ROTATE;break;case Na.PAN:this.state=Qn.PAN;break;default:this.state=Qn.NONE}const i=this.keyState!==Qn.NONE?this.keyState:this.state;i===Qn.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr)):i===Qn.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(r.pageX,r.pageY)),this._zoomEnd.copy(this._zoomStart)):i===Qn.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(r.pageX,r.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(LR)}function Q0e(r){const e=this.keyState!==Qn.NONE?this.keyState:this.state;e===Qn.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY))):e===Qn.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(r.pageX,r.pageY)):e===Qn.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(r.pageX,r.pageY))}function q0e(){this.state=Qn.NONE,this.dispatchEvent(DR)}function X0e(r){if(this.enabled!==!1&&this.noZoom!==!0){switch(r.preventDefault(),r.deltaMode){case 2:this._zoomStart.y-=r.deltaY*.025;break;case 1:this._zoomStart.y-=r.deltaY*.01;break;default:this._zoomStart.y-=r.deltaY*25e-5;break}this.dispatchEvent(LR),this.dispatchEvent(DR)}}function Y0e(r){this.enabled!==!1&&r.preventDefault()}function K0e(r){switch(this._trackPointer(r),this._pointers.length){case 1:this.state=Qn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Qn.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,i=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+i*i);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,s=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,s)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(LR)}function J0e(r){switch(this._trackPointer(r),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY));break;default:const e=this._getSecondPointerPosition(r),i=r.pageX-e.x,n=r.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(i*i+n*n);const s=(r.pageX+e.x)/2,o=(r.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(s,o));break}}function Z0e(r){switch(this._pointers.length){case 0:this.state=Qn.NONE;break;case 1:this.state=Qn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Qn.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==r.pointerId){const i=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(i.x,i.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(DR)}const wz={type:"change"},FR={type:"start"},Cz={type:"end"},S_=new $x,Sz=new ic,$0e=Math.cos(70*rS.DEG2RAD),ha=new at,Qo=2*Math.PI,as={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},kR=1e-6;class eAe extends Mb{constructor(e,i=null){super(e,i),this.state=as.NONE,this.enabled=!0,this.target=new at,this.cursor=new at,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Na.ROTATE,MIDDLE:Na.DOLLY,RIGHT:Na.PAN},this.touches={ONE:du.ROTATE,TWO:du.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new at,this._lastQuaternion=new Nc,this._lastTargetPosition=new at,this._quat=new Nc().setFromUnitVectors(e.up,new at(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new D4,this._sphericalDelta=new D4,this._scale=1,this._panOffset=new at,this._rotateStart=new zi,this._rotateEnd=new zi,this._rotateDelta=new zi,this._panStart=new zi,this._panEnd=new zi,this._panDelta=new zi,this._dollyStart=new zi,this._dollyEnd=new zi,this._dollyDelta=new zi,this._dollyDirection=new at,this._mouse=new zi,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=iAe.bind(this),this._onPointerDown=tAe.bind(this),this._onPointerUp=rAe.bind(this),this._onContextMenu=uAe.bind(this),this._onMouseWheel=aAe.bind(this),this._onKeyDown=oAe.bind(this),this._onTouchStart=lAe.bind(this),this._onTouchMove=cAe.bind(this),this._onMouseDown=nAe.bind(this),this._onMouseMove=sAe.bind(this),this._interceptControlDown=hAe.bind(this),this._interceptControlUp=dAe.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(wz),this.update(),this.state=as.NONE}update(e=null){const i=this.object.position;ha.copy(i).sub(this.target),ha.applyQuaternion(this._quat),this._spherical.setFromVector3(ha),this.autoRotate&&this.state===as.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(n)&&isFinite(s)&&(n<-Math.PI?n+=Qo:n>Math.PI&&(n-=Qo),s<-Math.PI?s+=Qo:s>Math.PI&&(s-=Qo),n<=s?this._spherical.theta=Math.max(n,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+s)/2?Math.max(n,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const l=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=l!=this._spherical.radius}if(ha.setFromSpherical(this._spherical),ha.applyQuaternion(this._quatInverse),i.copy(this.target).add(ha),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let l=null;if(this.object.isPerspectiveCamera){const u=ha.length();l=this._clampDistance(u*this._scale);const c=u-l;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),o=!!c}else if(this.object.isOrthographicCamera){const u=new at(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=c!==this.object.zoom;const d=new at(this._mouse.x,this._mouse.y,0);d.unproject(this.object),this.object.position.sub(d).add(u),this.object.updateMatrixWorld(),l=ha.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;l!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(l).add(this.object.position):(S_.origin.copy(this.object.position),S_.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(S_.direction))<$0e?this.object.lookAt(this.target):(Sz.setFromNormalAndCoplanarPoint(this.object.up,this.target),S_.intersectPlane(Sz,this.target))))}else if(this.object.isOrthographicCamera){const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),l!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>kR||8*(1-this._lastQuaternion.dot(this.object.quaternion))>kR||this._lastTargetPosition.distanceToSquared(this.target)>kR?(this.dispatchEvent(wz),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Qo/60*this.autoRotateSpeed*e:Qo/60/60*this.autoRotateSpeed}_getZoomScale(e){const i=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*i)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,i){ha.setFromMatrixColumn(i,0),ha.multiplyScalar(-e),this._panOffset.add(ha)}_panUp(e,i){this.screenSpacePanning===!0?ha.setFromMatrixColumn(i,1):(ha.setFromMatrixColumn(i,0),ha.crossVectors(this.object.up,ha)),ha.multiplyScalar(e),this._panOffset.add(ha)}_pan(e,i){const n=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;ha.copy(s).sub(this.target);let o=ha.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/n.clientHeight,this.object.matrix),this._panUp(2*i*o/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(i*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,i){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),s=e-n.left,o=i-n.top,l=n.width,u=n.height;this._mouse.x=s/l*2-1,this._mouse.y=-(o/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(Qo*this._rotateDelta.x/i.clientHeight),this._rotateUp(Qo*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let i=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(Qo*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),i=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-Qo*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),i=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(Qo*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),i=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-Qo*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),i=!0;break}i&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateStart.set(n,s)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._panStart.set(n,s)}}_handleTouchStartDolly(e){const i=this._getSecondPointerPosition(e),n=e.pageX-i.x,s=e.pageY-i.y,o=Math.sqrt(n*n+s*s);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),o=.5*(e.pageY+n.y);this._rotateEnd.set(s,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(Qo*this._rotateDelta.x/i.clientHeight),this._rotateUp(Qo*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._panEnd.set(n,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const i=this._getSecondPointerPosition(e),n=e.pageX-i.x,s=e.pageY-i.y,o=Math.sqrt(n*n+s*s);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const l=(e.pageX+i.x)*.5,u=(e.pageY+i.y)*.5;this._updateZoomParameters(l,u)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId){this._pointers.splice(i,1);return}}_isTrackingPointer(e){for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId)return!0;return!1}_trackPointer(e){let i=this._pointerPositions[e.pointerId];i===void 0&&(i=new zi,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const i=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[i]}_customWheelEvent(e){const i=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(i){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function tAe(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(r)&&(this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r)))}function iAe(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function rAe(r){switch(this._removePointer(r),this._pointers.length){case 0:this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Cz),this.state=as.NONE;break;case 1:const e=this._pointers[0],i=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:i.x,pageY:i.y});break}}function nAe(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Na.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(r),this.state=as.DOLLY;break;case Na.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=as.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=as.ROTATE}break;case Na.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=as.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=as.PAN}break;default:this.state=as.NONE}this.state!==as.NONE&&this.dispatchEvent(FR)}function sAe(r){switch(this.state){case as.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(r);break;case as.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(r);break;case as.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(r);break}}function aAe(r){this.enabled===!1||this.enableZoom===!1||this.state!==as.NONE||(r.preventDefault(),this.dispatchEvent(FR),this._handleMouseWheel(this._customWheelEvent(r)),this.dispatchEvent(Cz))}function oAe(r){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(r)}function lAe(r){switch(this._trackPointer(r),this._pointers.length){case 1:switch(this.touches.ONE){case du.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(r),this.state=as.TOUCH_ROTATE;break;case du.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(r),this.state=as.TOUCH_PAN;break;default:this.state=as.NONE}break;case 2:switch(this.touches.TWO){case du.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(r),this.state=as.TOUCH_DOLLY_PAN;break;case du.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(r),this.state=as.TOUCH_DOLLY_ROTATE;break;default:this.state=as.NONE}break;default:this.state=as.NONE}this.state!==as.NONE&&this.dispatchEvent(FR)}function cAe(r){switch(this._trackPointer(r),this.state){case as.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(r),this.update();break;case as.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(r),this.update();break;case as.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(r),this.update();break;case as.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(r),this.update();break;default:this.state=as.NONE}}function uAe(r){this.enabled!==!1&&r.preventDefault()}function hAe(r){r.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function dAe(r){r.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const pAe={type:"change"},Tz=1e-6,Mz=new Nc;class fAe extends Mb{constructor(e,i=null){super(e,i),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new at(0,0,0),this._rotationVector=new at(0,0,0),this._lastQuaternion=new Nc,this._lastPosition=new at,this._status=0,this._onKeyDown=mAe.bind(this),this._onKeyUp=gAe.bind(this),this._onPointerMove=yAe.bind(this),this._onPointerDown=AAe.bind(this),this._onPointerUp=vAe.bind(this),this._onPointerCancel=xAe.bind(this),this._onContextMenu=bAe.bind(this),i!==null&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const i=this.object,n=e*this.movementSpeed,s=e*this.rollSpeed;i.translateX(this._moveVector.x*n),i.translateY(this._moveVector.y*n),i.translateZ(this._moveVector.z*n),Mz.set(this._rotationVector.x*s,this._rotationVector.y*s,this._rotationVector.z*s,1).normalize(),i.quaternion.multiply(Mz),(this._lastPosition.distanceToSquared(i.position)>Tz||8*(1-this._lastQuaternion.dot(i.quaternion))>Tz)&&(this.dispatchEvent(pAe),this._lastQuaternion.copy(i.quaternion),this._lastPosition.copy(i.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function mAe(r){if(!(r.altKey||this.enabled===!1)){switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function gAe(r){if(this.enabled!==!1){switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function AAe(r){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(r.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function yAe(r){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),i=e.size[0]/2,n=e.size[1]/2;this._moveState.yawLeft=-(r.pageX-e.offset[0]-i)/i,this._moveState.pitchDown=(r.pageY-e.offset[1]-n)/n,this._updateRotationVector()}}function vAe(r){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(r.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function xAe(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function bAe(r){this.enabled!==!1&&r.preventDefault()}const _Ae={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class T_{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const EAe=new SS(-1,1,1,-1,0,1);class wAe extends Po{constructor(){super(),this.setAttribute("position",new la([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new la([0,2,0,0,2,0],2))}}const CAe=new wAe;class SAe{constructor(e){this._mesh=new La(CAe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,EAe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class TAe extends T_{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof Lc?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=NP.clone(e.uniforms),this.material=new Lc({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new SAe(this.material)}render(e,i,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class Rz extends T_{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,n){const s=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0);let l,u;this.inverse?(l=0,u=1):(l=1,u=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.buffers.stencil.setFunc(s.ALWAYS,l,4294967295),o.buffers.stencil.setClear(u),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.color.setMask(!0),o.buffers.depth.setMask(!0),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(s.EQUAL,1,4294967295),o.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.buffers.stencil.setLocked(!0)}}class MAe extends T_{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class RAe{constructor(e,i){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),i===void 0){const n=e.getSize(new zi);this._width=n.width,this._height=n.height,i=new Fh(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:am}),i.texture.name="EffectComposer.rt1"}else this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new TAe(_Ae),this.copyPass.material.blending=mu,this.clock=new R4}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let n=!1;for(let s=0,o=this.passes.length;s<o;s++){const l=this.passes[s];if(l.enabled!==!1){if(l.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),l.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),l.needsSwap){if(n){const u=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(u.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(u.EQUAL,1,4294967295)}this.swapBuffers()}Rz!==void 0&&(l instanceof Rz?n=!0:l instanceof MAe&&(n=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new zi);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(n,s),this.renderTarget2.setSize(n,s);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(n,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class IAe extends T_{constructor(e,i,n=null,s=null,o=null){super(),this.scene=e,this.camera=i,this.overrideMaterial=n,this.clearColor=s,this.clearAlpha=o,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new wn}render(e,i,n){const s=e.autoClear;e.autoClear=!1;let o,l;this.overrideMaterial!==null&&(l=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(o=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(o),this.overrideMaterial!==null&&(this.scene.overrideMaterial=l),e.autoClear=s}}var th=Object.freeze({Linear:Object.freeze({None:function(r){return r},In:function(r){return r},Out:function(r){return r},InOut:function(r){return r}}),Quadratic:Object.freeze({In:function(r){return r*r},Out:function(r){return r*(2-r)},InOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}}),Cubic:Object.freeze({In:function(r){return r*r*r},Out:function(r){return--r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}}),Quartic:Object.freeze({In:function(r){return r*r*r*r},Out:function(r){return 1- --r*r*r*r},InOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}}),Quintic:Object.freeze({In:function(r){return r*r*r*r*r},Out:function(r){return--r*r*r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}}),Sinusoidal:Object.freeze({In:function(r){return 1-Math.sin((1-r)*Math.PI/2)},Out:function(r){return Math.sin(r*Math.PI/2)},InOut:function(r){return .5*(1-Math.sin(Math.PI*(.5-r)))}}),Exponential:Object.freeze({In:function(r){return r===0?0:Math.pow(1024,r-1)},Out:function(r){return r===1?1:1-Math.pow(2,-10*r)},InOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}}),Circular:Object.freeze({In:function(r){return 1-Math.sqrt(1-r*r)},Out:function(r){return Math.sqrt(1- --r*r)},InOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}}),Elastic:Object.freeze({In:function(r){return r===0?0:r===1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out:function(r){return r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut:function(r){return r===0?0:r===1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(r){var e=1.70158;return r===1?1:r*r*((e+1)*r-e)},Out:function(r){var e=1.70158;return r===0?0:--r*r*((e+1)*r+e)+1},InOut:function(r){var e=2.5949095;return(r*=2)<1?.5*(r*r*((e+1)*r-e)):.5*((r-=2)*r*((e+1)*r+e)+2)}}),Bounce:Object.freeze({In:function(r){return 1-th.Bounce.Out(1-r)},Out:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut:function(r){return r<.5?th.Bounce.In(r*2)*.5:th.Bounce.Out(r*2-1)*.5+.5}}),generatePow:function(r){return r===void 0&&(r=4),r=r<Number.EPSILON?Number.EPSILON:r,r=r>1e4?1e4:r,{In:function(e){return Math.pow(e,r)},Out:function(e){return 1-Math.pow(1-e,r)},InOut:function(e){return e<.5?Math.pow(e*2,r)/2:(1-Math.pow(2-e*2,r))/2+.5}}}}),My=function(){return performance.now()},UR=function(){function r(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return r.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(i){return e._tweens[i]})},r.prototype.removeAll=function(){this._tweens={}},r.prototype.add=function(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];for(var s=0,o=i;s<o.length;s++){var l=o[s];(e=l._group)===null||e===void 0||e.remove(l),l._group=this,this._tweens[l.getId()]=l,this._tweensAddedDuringUpdate[l.getId()]=l}},r.prototype.remove=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];for(var n=0,s=e;n<s.length;n++){var o=s[n];o._group=void 0,delete this._tweens[o.getId()],delete this._tweensAddedDuringUpdate[o.getId()]}},r.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},r.prototype.update=function(e,i){e===void 0&&(e=My()),i===void 0&&(i=!0);var n=Object.keys(this._tweens);if(n.length!==0)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<n.length;s++){var o=this._tweens[n[s]],l=!i;o&&o.update(e,l)===!1&&!i&&this.remove(o)}n=Object.keys(this._tweensAddedDuringUpdate)}},r}(),zR={Linear:function(r,e){var i=r.length-1,n=i*e,s=Math.floor(n),o=zR.Utils.Linear;return e<0?o(r[0],r[1],n):e>1?o(r[i],r[i-1],i-n):o(r[s],r[s+1>i?i:s+1],n-s)},Utils:{Linear:function(r,e,i){return(e-r)*i+r}}},Iz=function(){function r(){}return r.nextId=function(){return r._nextId++},r._nextId=0,r}(),jR=new UR,M_=function(){function r(e,i){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=th.Linear.None,this._interpolationFunction=zR.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Iz.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof i=="object"?(this._group=i,i.add(this)):i===!0&&(this._group=jR,jR.add(this))}return r.prototype.getId=function(){return this._id},r.prototype.isPlaying=function(){return this._isPlaying},r.prototype.isPaused=function(){return this._isPaused},r.prototype.getDuration=function(){return this._duration},r.prototype.to=function(e,i){if(i===void 0&&(i=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=i<0?0:i,this},r.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},r.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},r.prototype.start=function(e,i){if(e===void 0&&(e=My()),i===void 0&&(i=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||i){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var o in this._valuesEnd)s[o]=this._valuesEnd[o];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,i)}return this},r.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},r.prototype._setupProperties=function(e,i,n,s,o){for(var l in n){var u=e[l],c=Array.isArray(u),d=c?"array":typeof u,p=!c&&Array.isArray(n[l]);if(!(d==="undefined"||d==="function")){if(p){var f=n[l];if(f.length===0)continue;for(var m=[u],g=0,y=f.length;g<y;g+=1){var x=this._handleRelativeValue(u,f[g]);if(isNaN(x)){p=!1,console.warn("Found invalid interpolation list. Skipping.");break}m.push(x)}p&&(n[l]=m)}if((d==="object"||c)&&u&&!p){i[l]=c?[]:{};var v=u;for(var _ in v)i[l][_]=v[_];s[l]=c?[]:{};var f=n[l];if(!this._isDynamic){var T={};for(var _ in f)T[_]=f[_];n[l]=f=T}this._setupProperties(v,i[l],f,s[l],o)}else(typeof i[l]>"u"||o)&&(i[l]=u),c||(i[l]*=1),p?s[l]=n[l].slice().reverse():s[l]=i[l]||0}}},r.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},r.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},r.prototype.pause=function(e){return e===void 0&&(e=My()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},r.prototype.resume=function(e){return e===void 0&&(e=My()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},r.prototype.stopChainedTweens=function(){for(var e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].stop();return this},r.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},r.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},r.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},r.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},r.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},r.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},r.prototype.easing=function(e){return e===void 0&&(e=th.Linear.None),this._easingFunction=e,this},r.prototype.interpolation=function(e){return e===void 0&&(e=zR.Linear),this._interpolationFunction=e,this},r.prototype.chain=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this._chainedTweens=e,this},r.prototype.onStart=function(e){return this._onStartCallback=e,this},r.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},r.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},r.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},r.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},r.prototype.onStop=function(e){return this._onStopCallback=e,this},r.prototype.update=function(e,i){var n=this,s;if(e===void 0&&(e=My()),i===void 0&&(i=r.autoStartOnUpdate),this._isPaused)return!0;var o;if(!this._goToEnd&&!this._isPlaying)if(i)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var l=e-this._startTime,u=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),c=this._duration+this._repeat*u,d=function(){if(n._duration===0||l>c)return 1;var x=Math.trunc(l/u),v=l-x*u,_=Math.min(v/n._duration,1);return _===0&&l===n._duration?1:_},p=d(),f=this._easingFunction(p);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,f),this._onUpdateCallback&&this._onUpdateCallback(this._object,p),this._duration===0||l>=this._duration)if(this._repeat>0){var m=Math.min(Math.trunc((l-this._duration)/u)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=m);for(o in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[o]=="string"&&(this._valuesStartRepeat[o]=this._valuesStartRepeat[o]+parseFloat(this._valuesEnd[o])),this._yoyo&&this._swapEndStartRepeatValues(o),this._valuesStart[o]=this._valuesStartRepeat[o];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=u*m,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var g=0,y=this._chainedTweens.length;g<y;g++)this._chainedTweens[g].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},r.prototype._updateProperties=function(e,i,n,s){for(var o in n)if(i[o]!==void 0){var l=i[o]||0,u=n[o],c=Array.isArray(e[o]),d=Array.isArray(u),p=!c&&d;p?e[o]=this._interpolationFunction(u,s):typeof u=="object"&&u?this._updateProperties(e[o],l,u,s):(u=this._handleRelativeValue(l,u),typeof u=="number"&&(e[o]=l+(u-l)*s))}},r.prototype._handleRelativeValue=function(e,i){return typeof i!="string"?i:i.charAt(0)==="+"||i.charAt(0)==="-"?e+parseFloat(i):parseFloat(i)},r.prototype._swapEndStartRepeatValues=function(e){var i=this._valuesStartRepeat[e],n=this._valuesEnd[e];typeof n=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=i},r.autoStartOnUpdate=!1,r}();Iz.nextId;var Gc=jR;Gc.getAll.bind(Gc),Gc.removeAll.bind(Gc),Gc.add.bind(Gc),Gc.remove.bind(Gc),Gc.update.bind(Gc);function BAe(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var NAe=`.scene-nav-info {
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
}

.scene-tooltip {
  top: 0;
  color: lavender;
  font-size: 15px;
}

.scene-nav-info, .scene-tooltip {
  position: absolute;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;BAe(NAe);function VR(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function LAe(r){if(Array.isArray(r))return r}function DAe(r){if(Array.isArray(r))return VR(r)}function OAe(r,e,i){return(e=VAe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function PAe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function FAe(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function kAe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UAe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zAe(r,e){return LAe(r)||FAe(r,e)||Bz(r,e)||kAe()}function Ry(r){return DAe(r)||PAe(r)||Bz(r)||UAe()}function jAe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function VAe(r){var e=jAe(r,"string");return typeof e=="symbol"?e:e+""}function Bz(r,e){if(r){if(typeof r=="string")return VR(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?VR(r,e):void 0}}var Es=window.THREE?window.THREE:{WebGLRenderer:bte,Scene:_te,PerspectiveCamera:Ml,Raycaster:N4,SRGBColorSpace:Do,TextureLoader:Wte,Vector2:zi,Vector3:at,Box3:np,Color:wn,Mesh:La,SphereGeometry:Tb,MeshBasicMaterial:Hh,BackSide:ho,Clock:R4},Nz=gp({props:{width:{default:window.innerWidth,onChange:function(r,e,i){isNaN(r)&&(e.width=i)}},height:{default:window.innerHeight,onChange:function(r,e,i){isNaN(r)&&(e.height=i)}},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(r,e){e.hoverObj=null,e.toolTipElem&&(e.toolTipElem.innerHTML="")},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{default:function(){return-1},triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(r){if(r.initialised){if(r.controls.update&&r.controls.update(Math.min(1,r.clock.getDelta())),r.postProcessingComposer?r.postProcessingComposer.render():r.renderer.render(r.scene,r.camera),r.extraRenderers.forEach(function(s){return s.render(r.scene,r.camera)}),r.enablePointerInteraction){var e=null;if(r.hoverDuringDrag||!r.isPointerDragging){var i=this.intersectingObjects(r.pointerPos.x,r.pointerPos.y).filter(function(s){return r.hoverFilter(s.object)}).sort(function(s,o){return r.hoverOrderComparator(s.object,o.object)}),n=i.length?i[0]:null;e=n?n.object:null,r.intersectionPoint=n?n.point:null}e!==r.hoverObj&&(r.onHover(e,r.hoverObj),r.toolTipElem.innerHTML=e&&mr(r.tooltipContent)(e)||"",r.hoverObj=e)}r.tweenGroup.update()}return this},getPointerPos:function(r){var e=r.pointerPos,i=e.x,n=e.y;return{x:i,y:n}},cameraPosition:function(r,e,i,n){var s=r.camera;if(e&&r.initialised){var o=e,l=i||{x:0,y:0,z:0};if(!n)d(o),p(l);else{var u=Object.assign({},s.position),c=f();r.tweenGroup.add(new M_(u).to(o,n).easing(th.Quadratic.Out).onUpdate(d).start()),r.tweenGroup.add(new M_(c).to(l,n/3).easing(th.Quadratic.Out).onUpdate(p).start())}return this}return Object.assign({},s.position,{lookAt:f()});function d(m){var g=m.x,y=m.y,x=m.z;g!==void 0&&(s.position.x=g),y!==void 0&&(s.position.y=y),x!==void 0&&(s.position.z=x)}function p(m){var g=new Es.Vector3(m.x,m.y,m.z);r.controls.target?r.controls.target=g:s.lookAt(g)}function f(){return Object.assign(new Es.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(r){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,n=arguments.length,s=new Array(n>3?n-3:0),o=3;o<n;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),e,i)},fitToBbox:function(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=r.camera;if(e){var o=new Es.Vector3(0,0,0),l=Math.max.apply(Math,Ry(Object.entries(e).map(function(m){var g=zAe(m,2),y=g[0],x=g[1];return Math.max.apply(Math,Ry(x.map(function(v){return Math.abs(o[y]-v)})))})))*2,u=(1-n*2/r.height)*s.fov,c=l/Math.atan(u*Math.PI/180),d=c/s.aspect,p=Math.max(c,d);if(p>0){var f=o.clone().sub(s.position).normalize().multiplyScalar(-p);this.cameraPosition(f,o,i)}}return this},getBbox:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=new Es.Box3(new Es.Vector3(0,0,0),new Es.Vector3(0,0,0)),n=r.objects.filter(e);return n.length?(n.forEach(function(s){return i.expandByObject(s)}),Object.assign.apply(Object,Ry(["x","y","z"].map(function(s){return OAe({},s,[i.min[s],i.max[s]])})))):null},getScreenCoords:function(r,e,i,n){var s=new Es.Vector3(e,i,n);return s.project(this.camera()),{x:(s.x+1)*r.width/2,y:-(s.y-1)*r.height/2}},getSceneCoords:function(r,e,i){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new Es.Vector2(e/r.width*2-1,-(i/r.height)*2+1),o=new Es.Raycaster;return o.setFromCamera(s,r.camera),Object.assign({},o.ray.at(n,new Es.Vector3))},intersectingObjects:function(r,e,i){var n=new Es.Vector2(e/r.width*2-1,-(i/r.height)*2+1),s=new Es.Raycaster;return s.params.Line.threshold=r.lineHoverPrecision,s.setFromCamera(n,r.camera),s.intersectObjects(r.objects,!0)},renderer:function(r){return r.renderer},scene:function(r){return r.scene},camera:function(r){return r.camera},postProcessingComposer:function(r){return r.postProcessingComposer},controls:function(r){return r.controls},tbControls:function(r){return r.controls}},stateInit:function(){return{scene:new Es.Scene,camera:new Es.PerspectiveCamera,clock:new Es.Clock,tweenGroup:new UR}},init:function(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.controlType,s=n===void 0?"trackball":n,o=i.useWebGPU,l=o===void 0?!1:o,u=i.rendererConfig,c=u===void 0?{}:u,d=i.extraRenderers,p=d===void 0?[]:d,f=i.waitForLoadComplete,m=f===void 0?!0:f;r.innerHTML="",r.appendChild(e.container=document.createElement("div")),e.container.className="scene-container",e.container.style.position="relative",e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="scene-nav-info",e.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",e.navInfo.style.display=e.showNavInfo?null:"none",e.toolTipElem=document.createElement("div"),e.toolTipElem.classList.add("scene-tooltip"),e.container.appendChild(e.toolTipElem),e.pointerPos=new Es.Vector2,e.pointerPos.x=-2,e.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(g){return e.container.addEventListener(g,function(y){if(g==="pointerdown"&&(e.isPointerPressed=!0),!e.isPointerDragging&&y.type==="pointermove"&&(y.pressure>0||e.isPointerPressed)&&(y.pointerType!=="touch"||y.movementX===void 0||[y.movementX,y.movementY].some(function(_){return Math.abs(_)>1}))&&(e.isPointerDragging=!0),e.enablePointerInteraction){var x=v(e.container);e.pointerPos.x=y.pageX-x.left,e.pointerPos.y=y.pageY-x.top,e.toolTipElem.style.top="".concat(e.pointerPos.y,"px"),e.toolTipElem.style.left="".concat(e.pointerPos.x,"px"),e.toolTipElem.style.transform="translate(-".concat(e.pointerPos.x/e.width*100,"%, ").concat(e.height-e.pointerPos.y<100?"calc(-100% - 8px)":"21px",")")}function v(_){var T=_.getBoundingClientRect(),w=window.pageXOffset||document.documentElement.scrollLeft,S=window.pageYOffset||document.documentElement.scrollTop;return{top:T.top+S,left:T.left+w}}},{passive:!0})}),e.container.addEventListener("pointerup",function(g){e.isPointerPressed=!1,!(e.isPointerDragging&&(e.isPointerDragging=!1,!e.clickAfterDrag))&&requestAnimationFrame(function(){g.button===0&&e.onClick(e.hoverObj||null,g,e.intersectionPoint),g.button===2&&e.onRightClick&&e.onRightClick(e.hoverObj||null,g,e.intersectionPoint)})},{passive:!0,capture:!0}),e.container.addEventListener("contextmenu",function(g){e.onRightClick&&g.preventDefault()}),e.renderer=new(l?P0e:Es.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},c)),e.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),e.container.appendChild(e.renderer.domElement),e.extraRenderers=p,e.extraRenderers.forEach(function(g){g.domElement.style.position="absolute",g.domElement.style.top="0px",g.domElement.style.pointerEvents="none",e.container.appendChild(g.domElement)}),e.postProcessingComposer=new RAe(e.renderer),e.postProcessingComposer.addPass(new IAe(e.scene,e.camera)),e.controls=new{trackball:k0e,orbit:eAe,fly:fAe}[s](e.camera,e.renderer.domElement),s==="fly"&&(e.controls.movementSpeed=300,e.controls.rollSpeed=Math.PI/6,e.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(e.controls.minDistance=.1,e.controls.maxDistance=e.skyRadius,e.controls.addEventListener("start",function(){e.controlsEngaged=!0}),e.controls.addEventListener("change",function(){e.controlsEngaged&&(e.controlsDragging=!0)}),e.controls.addEventListener("end",function(){e.controlsEngaged=!1,e.controlsDragging=!1})),[e.renderer,e.postProcessingComposer].concat(Ry(e.extraRenderers)).forEach(function(g){return g.setSize(e.width,e.height)}),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix(),e.camera.position.z=1e3,e.scene.add(e.skysphere=new Es.Mesh),e.skysphere.visible=!1,e.loadComplete=e.scene.visible=!m,window.scene=e.scene},update:function(r,e){if(r.width&&r.height&&(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&(r.container.style.width="".concat(r.width,"px"),r.container.style.height="".concat(r.height,"px"),[r.renderer,r.postProcessingComposer].concat(Ry(r.extraRenderers)).forEach(function(s){return s.setSize(r.width,r.height)}),r.camera.aspect=r.width/r.height,r.camera.updateProjectionMatrix()),e.hasOwnProperty("skyRadius")&&r.skyRadius&&(r.controls.hasOwnProperty("maxDistance")&&e.skyRadius&&(r.controls.maxDistance=Math.min(r.controls.maxDistance,r.skyRadius)),r.camera.far=r.skyRadius*2.5,r.camera.updateProjectionMatrix(),r.skysphere.geometry=new Es.SphereGeometry(r.skyRadius)),e.hasOwnProperty("backgroundColor")){var i=xp(r.backgroundColor).alpha;i===void 0&&(i=1),r.renderer.setClearColor(new Es.Color(Ik(1,r.backgroundColor)),i)}e.hasOwnProperty("backgroundImageUrl")&&(r.backgroundImageUrl?new Es.TextureLoader().load(r.backgroundImageUrl,function(s){s.colorSpace=Es.SRGBColorSpace,r.skysphere.material=new Es.MeshBasicMaterial({map:s,side:Es.BackSide}),r.skysphere.visible=!0,r.onBackgroundImageLoaded&&setTimeout(r.onBackgroundImageLoaded),!r.loadComplete&&n()}):(r.skysphere.visible=!1,r.skysphere.material.map=null,!r.loadComplete&&n())),e.hasOwnProperty("showNavInfo")&&(r.navInfo.style.display=r.showNavInfo?null:"none"),e.hasOwnProperty("lights")&&((e.lights||[]).forEach(function(s){return r.scene.remove(s)}),r.lights.forEach(function(s){return r.scene.add(s)})),e.hasOwnProperty("objects")&&((e.objects||[]).forEach(function(s){return r.scene.remove(s)}),r.objects.forEach(function(s){return r.scene.add(s)}));function n(){r.loadComplete=r.scene.visible=!0}}});function GAe(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var HAe=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;GAe(HAe);function GR(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function WAe(r){if(Array.isArray(r))return GR(r)}function Iy(r,e,i){return(e=YAe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function QAe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function qAe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lz(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function R_(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Lz(Object(i),!0).forEach(function(n){Iy(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Lz(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function I_(r){return WAe(r)||QAe(r)||KAe(r)||qAe()}function XAe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function YAe(r){var e=XAe(r,"string");return typeof e=="symbol"?e:e+""}function KAe(r,e){if(r){if(typeof r=="string")return GR(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?GR(r,e):void 0}}function Dz(r,e){var i=new e;return i._destructor&&i._destructor(),{linkProp:function(n){return{default:i[n](),onChange:function(s,o){o[r][n](s)},triggerUpdate:!1}},linkMethod:function(n){return function(s){for(var o=s[r],l=arguments.length,u=new Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];var d=o[n].apply(o,u);return d===o?this:d}}}}var HR=window.THREE?window.THREE:{AmbientLight:Yte,DirectionalLight:Xte,REVISION:Fx},JAe=170,Oz=Dz("forceGraph",LT),ZAe=Object.assign.apply(Object,I_(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(r){return Iy({},r,Oz.linkProp(r))}))),$Ae=Object.assign.apply(Object,I_(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(r){return Iy({},r,Oz.linkMethod(r))}))),B_=Dz("renderObjs",Nz),eye=Object.assign.apply(Object,I_(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(r){return Iy({},r,B_.linkProp(r))}))),tye=Object.assign.apply(Object,I_(["lights","cameraPosition","postProcessingComposer"].map(function(r){return Iy({},r,B_.linkMethod(r))})).concat([{graph2ScreenCoords:B_.linkMethod("getScreenCoords"),screen2GraphCoords:B_.linkMethod("getSceneCoords")}])),iye=gp({props:R_(R_({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(r,e){return e.renderObjs.lineHoverPrecision(r)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(r,e){var i=e.renderObjs.controls();i&&(i.enabled=r,r&&i.domElement&&i.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},ZAe),eye),methods:R_(R_({zoomToFit:function(r,e,i){for(var n,s=arguments.length,o=new Array(s>3?s-3:0),l=3;l<s;l++)o[l-3]=arguments[l];return r.renderObjs.fitToBbox((n=r.forceGraph).getGraphBbox.apply(n,o),e,i),this},pauseAnimation:function(r){return r.animationFrameRequestId!==null&&(cancelAnimationFrame(r.animationFrameRequestId),r.animationFrameRequestId=null),this},resumeAnimation:function(r){return r.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(r){r.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),r.forceGraph.tickFrame(),r.renderObjs.tick(),r.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(r){return r.renderObjs.scene()},camera:function(r){return r.renderObjs.camera()},renderer:function(r){return r.renderObjs.renderer()},controls:function(r){return r.renderObjs.controls()},tbControls:function(r){return r.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},$Ae),tye),stateInit:function(r){var e=r.controlType,i=r.rendererConfig,n=r.extraRenderers,s=new LT;return{forceGraph:s,renderObjs:Nz({controlType:e,rendererConfig:i,extraRenderers:n}).objects([s]).lights([new HR.AmbientLight(13421772,Math.PI),new HR.DirectionalLight(16777215,.6*Math.PI)])}},init:function(r,e){r.innerHTML="",r.appendChild(e.container=document.createElement("div")),e.container.style.position="relative";var i=document.createElement("div");e.container.appendChild(i),e.renderObjs(i);var n=e.renderObjs.camera(),s=e.renderObjs.renderer(),o=e.renderObjs.controls();o.enabled=!!e.enableNavigationControls,e.lastSetCameraZ=n.position.z;var l;e.container.appendChild(l=document.createElement("div")),l.className="graph-info-msg",l.textContent="",e.forceGraph.onLoading(function(){l.textContent="Loading..."}).onFinishLoading(function(){l.textContent=""}).onUpdate(function(){e.graphData=e.forceGraph.graphData(),n.position.x===0&&n.position.y===0&&n.position.z===e.lastSetCameraZ&&e.graphData.nodes.length&&(n.lookAt(e.forceGraph.position),e.lastSetCameraZ=n.position.z=Math.cbrt(e.graphData.nodes.length)*JAe)}).onFinishUpdate(function(){if(e._dragControls){var u=e.graphData.nodes.find(function(d){return d.__initialFixedPos&&!d.__disposeControlsAfterDrag});u?u.__disposeControlsAfterDrag=!0:e._dragControls.dispose(),e._dragControls=void 0}if(e.enableNodeDrag&&e.enablePointerInteraction&&e.forceEngine==="d3"){var c=e._dragControls=new Hoe(e.graphData.nodes.map(function(d){return d.__threeObj}).filter(function(d){return d}),n,s.domElement);c.addEventListener("dragstart",function(d){o.enabled=!1,d.object.__initialPos=d.object.position.clone(),d.object.__prevPos=d.object.position.clone();var p=ih(d.object).__data;!p.__initialFixedPos&&(p.__initialFixedPos={fx:p.fx,fy:p.fy,fz:p.fz}),!p.__initialPos&&(p.__initialPos={x:p.x,y:p.y,z:p.z}),["x","y","z"].forEach(function(f){return p["f".concat(f)]=p[f]}),s.domElement.classList.add("grabbable")}),c.addEventListener("drag",function(d){var p=ih(d.object);if(!d.object.hasOwnProperty("__graphObjType")){var f=d.object.__initialPos,m=d.object.__prevPos,g=d.object.position;p.position.add(g.clone().sub(m)),m.copy(g),g.copy(f)}var y=p.__data,x=p.position,v={x:x.x-y.x,y:x.y-y.y,z:x.z-y.z};["x","y","z"].forEach(function(_){return y["f".concat(_)]=y[_]=x[_]}),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),y.__dragged=!0,e.onNodeDrag(y,v)}),c.addEventListener("dragend",function(d){delete d.object.__initialPos,delete d.object.__prevPos;var p=ih(d.object).__data;p.__disposeControlsAfterDrag&&(c.dispose(),delete p.__disposeControlsAfterDrag);var f=p.__initialFixedPos,m=p.__initialPos,g={x:m.x-p.x,y:m.y-p.y,z:m.z-p.z};f&&(["x","y","z"].forEach(function(y){var x="f".concat(y);f[x]===void 0&&delete p[x]}),delete p.__initialFixedPos,delete p.__initialPos,p.__dragged&&(delete p.__dragged,e.onNodeDragEnd(p,g))),e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),s.domElement.classList.remove("grabbable")})}}),HR.REVISION<155&&(e.renderObjs.renderer().useLegacyLights=!1),e.renderObjs.hoverOrderComparator(function(u,c){var d=ih(u);if(!d)return 1;var p=ih(c);if(!p)return-1;var f=function(m){return m.__graphObjType==="node"};return f(p)-f(d)}).tooltipContent(function(u){var c=ih(u);return c&&mr(e["".concat(c.__graphObjType,"Label")])(c.__data)||""}).hoverDuringDrag(!1).onHover(function(u){var c=ih(u);if(c!==e.hoverObj){var d=e.hoverObj?e.hoverObj.__graphObjType:null,p=e.hoverObj?e.hoverObj.__data:null,f=c?c.__graphObjType:null,m=c?c.__data:null;if(d&&d!==f){var g=e["on".concat(d==="node"?"Node":"Link","Hover")];g&&g(null,p)}if(f){var y=e["on".concat(f==="node"?"Node":"Link","Hover")];y&&y(m,d===f?p:null)}s.domElement.classList[c&&e["on".concat(f==="node"?"Node":"Link","Click")]||!c&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=c}}).clickAfterDrag(!1).onClick(function(u,c){var d=ih(u);if(d){var p=e["on".concat(d.__graphObjType==="node"?"Node":"Link","Click")];p&&p(d.__data,c)}else e.onBackgroundClick&&e.onBackgroundClick(c)}).onRightClick(function(u,c){var d=ih(u);if(d){var p=e["on".concat(d.__graphObjType==="node"?"Node":"Link","RightClick")];p&&p(d.__data,c)}else e.onBackgroundRightClick&&e.onBackgroundRightClick(c)}),this._animationCycle()}});function ih(r){for(var e=r;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var WR="http://www.w3.org/1999/xhtml";const Pz={svg:"http://www.w3.org/2000/svg",xhtml:WR,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function N_(r){var e=r+="",i=e.indexOf(":");return i>=0&&(e=r.slice(0,i))!=="xmlns"&&(r=r.slice(i+1)),Pz.hasOwnProperty(e)?{space:Pz[e],local:r}:r}function rye(r){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===WR&&e.documentElement.namespaceURI===WR?e.createElement(r):e.createElementNS(i,r)}}function nye(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function Fz(r){var e=N_(r);return(e.local?nye:rye)(e)}function sye(){}function QR(r){return r==null?sye:function(){return this.querySelector(r)}}function aye(r){typeof r!="function"&&(r=QR(r));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var o=e[s],l=o.length,u=n[s]=new Array(l),c,d,p=0;p<l;++p)(c=o[p])&&(d=r.call(c,c.__data__,p,o))&&("__data__"in c&&(d.__data__=c.__data__),u[p]=d);return new ml(n,this._parents)}function oye(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function lye(){return[]}function kz(r){return r==null?lye:function(){return this.querySelectorAll(r)}}function cye(r){return function(){return oye(r.apply(this,arguments))}}function uye(r){typeof r=="function"?r=cye(r):r=kz(r);for(var e=this._groups,i=e.length,n=[],s=[],o=0;o<i;++o)for(var l=e[o],u=l.length,c,d=0;d<u;++d)(c=l[d])&&(n.push(r.call(c,c.__data__,d,l)),s.push(c));return new ml(n,s)}function Uz(r){return function(){return this.matches(r)}}function zz(r){return function(e){return e.matches(r)}}var hye=Array.prototype.find;function dye(r){return function(){return hye.call(this.children,r)}}function pye(){return this.firstElementChild}function fye(r){return this.select(r==null?pye:dye(typeof r=="function"?r:zz(r)))}var mye=Array.prototype.filter;function gye(){return Array.from(this.children)}function Aye(r){return function(){return mye.call(this.children,r)}}function yye(r){return this.selectAll(r==null?gye:Aye(typeof r=="function"?r:zz(r)))}function vye(r){typeof r!="function"&&(r=Uz(r));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var o=e[s],l=o.length,u=n[s]=[],c,d=0;d<l;++d)(c=o[d])&&r.call(c,c.__data__,d,o)&&u.push(c);return new ml(n,this._parents)}function jz(r){return new Array(r.length)}function xye(){return new ml(this._enter||this._groups.map(jz),this._parents)}function L_(r,e){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=e}L_.prototype={constructor:L_,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,e){return this._parent.insertBefore(r,e)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function bye(r){return function(){return r}}function _ye(r,e,i,n,s,o){for(var l=0,u,c=e.length,d=o.length;l<d;++l)(u=e[l])?(u.__data__=o[l],n[l]=u):i[l]=new L_(r,o[l]);for(;l<c;++l)(u=e[l])&&(s[l]=u)}function Eye(r,e,i,n,s,o,l){var u,c,d=new Map,p=e.length,f=o.length,m=new Array(p),g;for(u=0;u<p;++u)(c=e[u])&&(m[u]=g=l.call(c,c.__data__,u,e)+"",d.has(g)?s[u]=c:d.set(g,c));for(u=0;u<f;++u)g=l.call(r,o[u],u,o)+"",(c=d.get(g))?(n[u]=c,c.__data__=o[u],d.delete(g)):i[u]=new L_(r,o[u]);for(u=0;u<p;++u)(c=e[u])&&d.get(m[u])===c&&(s[u]=c)}function wye(r){return r.__data__}function Cye(r,e){if(!arguments.length)return Array.from(this,wye);var i=e?Eye:_ye,n=this._parents,s=this._groups;typeof r!="function"&&(r=bye(r));for(var o=s.length,l=new Array(o),u=new Array(o),c=new Array(o),d=0;d<o;++d){var p=n[d],f=s[d],m=f.length,g=Sye(r.call(p,p&&p.__data__,d,n)),y=g.length,x=u[d]=new Array(y),v=l[d]=new Array(y),_=c[d]=new Array(m);i(p,f,x,v,_,g,e);for(var T=0,w=0,S,R;T<y;++T)if(S=x[T]){for(T>=w&&(w=T+1);!(R=v[w])&&++w<y;);S._next=R||null}}return l=new ml(l,n),l._enter=u,l._exit=c,l}function Sye(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function Tye(){return new ml(this._exit||this._groups.map(jz),this._parents)}function Mye(r,e,i){var n=this.enter(),s=this,o=this.exit();return typeof r=="function"?(n=r(n),n&&(n=n.selection())):n=n.append(r+""),e!=null&&(s=e(s),s&&(s=s.selection())),i==null?o.remove():i(o),n&&s?n.merge(s).order():s}function Rye(r){for(var e=r.selection?r.selection():r,i=this._groups,n=e._groups,s=i.length,o=n.length,l=Math.min(s,o),u=new Array(s),c=0;c<l;++c)for(var d=i[c],p=n[c],f=d.length,m=u[c]=new Array(f),g,y=0;y<f;++y)(g=d[y]||p[y])&&(m[y]=g);for(;c<s;++c)u[c]=i[c];return new ml(u,this._parents)}function Iye(){for(var r=this._groups,e=-1,i=r.length;++e<i;)for(var n=r[e],s=n.length-1,o=n[s],l;--s>=0;)(l=n[s])&&(o&&l.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(l,o),o=l);return this}function Bye(r){r||(r=Nye);function e(f,m){return f&&m?r(f.__data__,m.__data__):!f-!m}for(var i=this._groups,n=i.length,s=new Array(n),o=0;o<n;++o){for(var l=i[o],u=l.length,c=s[o]=new Array(u),d,p=0;p<u;++p)(d=l[p])&&(c[p]=d);c.sort(e)}return new ml(s,this._parents).order()}function Nye(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function Lye(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function Dye(){return Array.from(this)}function Oye(){for(var r=this._groups,e=0,i=r.length;e<i;++e)for(var n=r[e],s=0,o=n.length;s<o;++s){var l=n[s];if(l)return l}return null}function Pye(){let r=0;for(const e of this)++r;return r}function Fye(){return!this.node()}function kye(r){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var s=e[i],o=0,l=s.length,u;o<l;++o)(u=s[o])&&r.call(u,u.__data__,o,s);return this}function Uye(r){return function(){this.removeAttribute(r)}}function zye(r){return function(){this.removeAttributeNS(r.space,r.local)}}function jye(r,e){return function(){this.setAttribute(r,e)}}function Vye(r,e){return function(){this.setAttributeNS(r.space,r.local,e)}}function Gye(r,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(r):this.setAttribute(r,i)}}function Hye(r,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,i)}}function Wye(r,e){var i=N_(r);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?zye:Uye:typeof e=="function"?i.local?Hye:Gye:i.local?Vye:jye)(i,e))}function Vz(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function Qye(r){return function(){this.style.removeProperty(r)}}function qye(r,e,i){return function(){this.style.setProperty(r,e,i)}}function Xye(r,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(r):this.style.setProperty(r,n,i)}}function Yye(r,e,i){return arguments.length>1?this.each((e==null?Qye:typeof e=="function"?Xye:qye)(r,e,i??"")):Lg(this.node(),r)}function Lg(r,e){return r.style.getPropertyValue(e)||Vz(r).getComputedStyle(r,null).getPropertyValue(e)}function Kye(r){return function(){delete this[r]}}function Jye(r,e){return function(){this[r]=e}}function Zye(r,e){return function(){var i=e.apply(this,arguments);i==null?delete this[r]:this[r]=i}}function $ye(r,e){return arguments.length>1?this.each((e==null?Kye:typeof e=="function"?Zye:Jye)(r,e)):this.node()[r]}function Gz(r){return r.trim().split(/^|\s+/)}function qR(r){return r.classList||new Hz(r)}function Hz(r){this._node=r,this._names=Gz(r.getAttribute("class")||"")}Hz.prototype={add:function(r){var e=this._names.indexOf(r);e<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var e=this._names.indexOf(r);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function Wz(r,e){for(var i=qR(r),n=-1,s=e.length;++n<s;)i.add(e[n])}function Qz(r,e){for(var i=qR(r),n=-1,s=e.length;++n<s;)i.remove(e[n])}function eve(r){return function(){Wz(this,r)}}function tve(r){return function(){Qz(this,r)}}function ive(r,e){return function(){(e.apply(this,arguments)?Wz:Qz)(this,r)}}function rve(r,e){var i=Gz(r+"");if(arguments.length<2){for(var n=qR(this.node()),s=-1,o=i.length;++s<o;)if(!n.contains(i[s]))return!1;return!0}return this.each((typeof e=="function"?ive:e?eve:tve)(i,e))}function nve(){this.textContent=""}function sve(r){return function(){this.textContent=r}}function ave(r){return function(){var e=r.apply(this,arguments);this.textContent=e??""}}function ove(r){return arguments.length?this.each(r==null?nve:(typeof r=="function"?ave:sve)(r)):this.node().textContent}function lve(){this.innerHTML=""}function cve(r){return function(){this.innerHTML=r}}function uve(r){return function(){var e=r.apply(this,arguments);this.innerHTML=e??""}}function hve(r){return arguments.length?this.each(r==null?lve:(typeof r=="function"?uve:cve)(r)):this.node().innerHTML}function dve(){this.nextSibling&&this.parentNode.appendChild(this)}function pve(){return this.each(dve)}function fve(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function mve(){return this.each(fve)}function gve(r){var e=typeof r=="function"?r:Fz(r);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Ave(){return null}function yve(r,e){var i=typeof r=="function"?r:Fz(r),n=e==null?Ave:typeof e=="function"?e:QR(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function vve(){var r=this.parentNode;r&&r.removeChild(this)}function xve(){return this.each(vve)}function bve(){var r=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function _ve(){var r=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function Eve(r){return this.select(r?_ve:bve)}function wve(r){return arguments.length?this.property("__data__",r):this.node().__data__}function Cve(r){return function(e){r.call(this,e,this.__data__)}}function Sve(r){return r.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function Tve(r){return function(){var e=this.__on;if(e){for(var i=0,n=-1,s=e.length,o;i<s;++i)o=e[i],(!r.type||o.type===r.type)&&o.name===r.name?this.removeEventListener(o.type,o.listener,o.options):e[++n]=o;++n?e.length=n:delete this.__on}}}function Mve(r,e,i){return function(){var n=this.__on,s,o=Cve(e);if(n){for(var l=0,u=n.length;l<u;++l)if((s=n[l]).type===r.type&&s.name===r.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=o,s.options=i),s.value=e;return}}this.addEventListener(r.type,o,i),s={type:r.type,name:r.name,value:e,listener:o,options:i},n?n.push(s):this.__on=[s]}}function Rve(r,e,i){var n=Sve(r+""),s,o=n.length,l;if(arguments.length<2){var u=this.node().__on;if(u){for(var c=0,d=u.length,p;c<d;++c)for(s=0,p=u[c];s<o;++s)if((l=n[s]).type===p.type&&l.name===p.name)return p.value}return}for(u=e?Mve:Tve,s=0;s<o;++s)this.each(u(n[s],e,i));return this}function qz(r,e,i){var n=Vz(r),s=n.CustomEvent;typeof s=="function"?s=new s(e,i):(s=n.document.createEvent("Event"),i?(s.initEvent(e,i.bubbles,i.cancelable),s.detail=i.detail):s.initEvent(e,!1,!1)),r.dispatchEvent(s)}function Ive(r,e){return function(){return qz(this,r,e)}}function Bve(r,e){return function(){return qz(this,r,e.apply(this,arguments))}}function Nve(r,e){return this.each((typeof e=="function"?Bve:Ive)(r,e))}function*Lve(){for(var r=this._groups,e=0,i=r.length;e<i;++e)for(var n=r[e],s=0,o=n.length,l;s<o;++s)(l=n[s])&&(yield l)}var Xz=[null];function ml(r,e){this._groups=r,this._parents=e}function By(){return new ml([[document.documentElement]],Xz)}function Dve(){return this}ml.prototype=By.prototype={constructor:ml,select:aye,selectAll:uye,selectChild:fye,selectChildren:yye,filter:vye,data:Cye,enter:xye,exit:Tye,join:Mye,merge:Rye,selection:Dve,order:Iye,sort:Bye,call:Lye,nodes:Dye,node:Oye,size:Pye,empty:Fye,each:kye,attr:Wye,style:Yye,property:$ye,classed:rve,text:ove,html:hve,raise:pve,lower:mve,append:gve,insert:yve,remove:xve,clone:Eve,datum:wve,on:Rve,dispatch:Nve,[Symbol.iterator]:Lve};function vc(r){return typeof r=="string"?new ml([[document.querySelector(r)]],[document.documentElement]):new ml([[r]],Xz)}function Ove(r){let e;for(;e=r.sourceEvent;)r=e;return r}function rh(r,e){if(r=Ove(r),e===void 0&&(e=r.currentTarget),e){var i=e.ownerSVGElement||e;if(i.createSVGPoint){var n=i.createSVGPoint();return n.x=r.clientX,n.y=r.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[r.clientX-s.left-e.clientLeft,r.clientY-s.top-e.clientTop]}}return[r.pageX,r.pageY]}const Pve={passive:!1},Ny={capture:!0,passive:!1};function XR(r){r.stopImmediatePropagation()}function Dg(r){r.preventDefault(),r.stopImmediatePropagation()}function Yz(r){var e=r.document.documentElement,i=vc(r).on("dragstart.drag",Dg,Ny);"onselectstart"in e?i.on("selectstart.drag",Dg,Ny):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Kz(r,e){var i=r.document.documentElement,n=vc(r).on("dragstart.drag",null);e&&(n.on("click.drag",Dg,Ny),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in i?n.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}const D_=r=>()=>r;function YR(r,{sourceEvent:e,subject:i,target:n,identifier:s,active:o,x:l,y:u,dx:c,dy:d,dispatch:p}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:l,enumerable:!0,configurable:!0},y:{value:u,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:p}})}YR.prototype.on=function(){var r=this._.on.apply(this._,arguments);return r===this._?this:r};function Fve(r){return!r.ctrlKey&&!r.button}function kve(){return this.parentNode}function Uve(r,e){return e??{x:r.x,y:r.y}}function zve(){return navigator.maxTouchPoints||"ontouchstart"in this}function jve(){var r=Fve,e=kve,i=Uve,n=zve,s={},o=xA("start","drag","end"),l=0,u,c,d,p,f=0;function m(S){S.on("mousedown.drag",g).filter(n).on("touchstart.drag",v).on("touchmove.drag",_,Pve).on("touchend.drag touchcancel.drag",T).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(S,R){if(!(p||!r.call(this,S,R))){var B=w(this,e.call(this,S,R),S,R,"mouse");B&&(vc(S.view).on("mousemove.drag",y,Ny).on("mouseup.drag",x,Ny),Yz(S.view),XR(S),d=!1,u=S.clientX,c=S.clientY,B("start",S))}}function y(S){if(Dg(S),!d){var R=S.clientX-u,B=S.clientY-c;d=R*R+B*B>f}s.mouse("drag",S)}function x(S){vc(S.view).on("mousemove.drag mouseup.drag",null),Kz(S.view,d),Dg(S),s.mouse("end",S)}function v(S,R){if(r.call(this,S,R)){var B=S.changedTouches,I=e.call(this,S,R),D=B.length,L,O;for(L=0;L<D;++L)(O=w(this,I,S,R,B[L].identifier,B[L]))&&(XR(S),O("start",S,B[L]))}}function _(S){var R=S.changedTouches,B=R.length,I,D;for(I=0;I<B;++I)(D=s[R[I].identifier])&&(Dg(S),D("drag",S,R[I]))}function T(S){var R=S.changedTouches,B=R.length,I,D;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),I=0;I<B;++I)(D=s[R[I].identifier])&&(XR(S),D("end",S,R[I]))}function w(S,R,B,I,D,L){var O=o.copy(),U=rh(L||B,R),J,H,V;if((V=i.call(S,new YR("beforestart",{sourceEvent:B,target:m,identifier:D,active:l,x:U[0],y:U[1],dx:0,dy:0,dispatch:O}),I))!=null)return J=V.x-U[0]||0,H=V.y-U[1]||0,function $(Q,G,j){var ie=U,Y;switch(Q){case"start":s[D]=$,Y=l++;break;case"end":delete s[D],--l;case"drag":U=rh(j||G,R),Y=l;break}O.call(Q,S,new YR(Q,{sourceEvent:G,subject:V,target:m,identifier:D,active:Y,x:U[0]+J,y:U[1]+H,dx:U[0]-ie[0],dy:U[1]-ie[1],dispatch:O}),I)}}return m.filter=function(S){return arguments.length?(r=typeof S=="function"?S:D_(!!S),m):r},m.container=function(S){return arguments.length?(e=typeof S=="function"?S:D_(S),m):e},m.subject=function(S){return arguments.length?(i=typeof S=="function"?S:D_(S),m):i},m.touchable=function(S){return arguments.length?(n=typeof S=="function"?S:D_(!!S),m):n},m.on=function(){var S=o.on.apply(o,arguments);return S===o?m:S},m.clickDistance=function(S){return arguments.length?(f=(S=+S)*S,m):Math.sqrt(f)},m}var Vve=xA("start","end","cancel","interrupt"),Gve=[],Jz=0,Zz=1,KR=2,O_=3,$z=4,JR=5,P_=6;function F_(r,e,i,n,s,o){var l=r.__transition;if(!l)r.__transition={};else if(i in l)return;Hve(r,i,{name:e,index:n,group:s,on:Vve,tween:Gve,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Jz})}function ZR(r,e){var i=xc(r,e);if(i.state>Jz)throw new Error("too late; already scheduled");return i}function Hc(r,e){var i=xc(r,e);if(i.state>O_)throw new Error("too late; already running");return i}function xc(r,e){var i=r.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function Hve(r,e,i){var n=r.__transition,s;n[e]=i,i.timer=eT(o,0,i.time);function o(d){i.state=Zz,i.timer.restart(l,i.delay,i.time),i.delay<=d&&l(d-i.delay)}function l(d){var p,f,m,g;if(i.state!==Zz)return c();for(p in n)if(g=n[p],g.name===i.name){if(g.state===O_)return Z4(l);g.state===$z?(g.state=P_,g.timer.stop(),g.on.call("interrupt",r,r.__data__,g.index,g.group),delete n[p]):+p<e&&(g.state=P_,g.timer.stop(),g.on.call("cancel",r,r.__data__,g.index,g.group),delete n[p])}if(Z4(function(){i.state===O_&&(i.state=$z,i.timer.restart(u,i.delay,i.time),u(d))}),i.state=KR,i.on.call("start",r,r.__data__,i.index,i.group),i.state===KR){for(i.state=O_,s=new Array(m=i.tween.length),p=0,f=-1;p<m;++p)(g=i.tween[p].value.call(r,r.__data__,i.index,i.group))&&(s[++f]=g);s.length=f+1}}function u(d){for(var p=d<i.duration?i.ease.call(null,d/i.duration):(i.timer.restart(c),i.state=JR,1),f=-1,m=s.length;++f<m;)s[f].call(r,p);i.state===JR&&(i.on.call("end",r,r.__data__,i.index,i.group),c())}function c(){i.state=P_,i.timer.stop(),delete n[e];for(var d in n)return;delete r.__transition}}function k_(r,e){var i=r.__transition,n,s,o=!0,l;if(i){e=e==null?null:e+"";for(l in i){if((n=i[l]).name!==e){o=!1;continue}s=n.state>KR&&n.state<JR,n.state=P_,n.timer.stop(),n.on.call(s?"interrupt":"cancel",r,r.__data__,n.index,n.group),delete i[l]}o&&delete r.__transition}}function Wve(r){return this.each(function(){k_(this,r)})}function Qve(r,e){var i,n;return function(){var s=Hc(this,r),o=s.tween;if(o!==i){n=i=o;for(var l=0,u=n.length;l<u;++l)if(n[l].name===e){n=n.slice(),n.splice(l,1);break}}s.tween=n}}function qve(r,e,i){var n,s;if(typeof i!="function")throw new Error;return function(){var o=Hc(this,r),l=o.tween;if(l!==n){s=(n=l).slice();for(var u={name:e,value:i},c=0,d=s.length;c<d;++c)if(s[c].name===e){s[c]=u;break}c===d&&s.push(u)}o.tween=s}}function Xve(r,e){var i=this._id;if(r+="",arguments.length<2){for(var n=xc(this.node(),i).tween,s=0,o=n.length,l;s<o;++s)if((l=n[s]).name===r)return l.value;return null}return this.each((e==null?Qve:qve)(i,r,e))}function $R(r,e,i){var n=r._id;return r.each(function(){var s=Hc(this,n);(s.value||(s.value={}))[e]=i.apply(this,arguments)}),function(s){return xc(s,n).value[e]}}function e7(r,e){var i;return(typeof e=="number"?Xh:e instanceof BA?ek:(i=BA(e))?(e=i,ek):Sse)(r,e)}function Yve(r){return function(){this.removeAttribute(r)}}function Kve(r){return function(){this.removeAttributeNS(r.space,r.local)}}function Jve(r,e,i){var n,s=i+"",o;return function(){var l=this.getAttribute(r);return l===s?null:l===n?o:o=e(n=l,i)}}function Zve(r,e,i){var n,s=i+"",o;return function(){var l=this.getAttributeNS(r.space,r.local);return l===s?null:l===n?o:o=e(n=l,i)}}function $ve(r,e,i){var n,s,o;return function(){var l,u=i(this),c;return u==null?void this.removeAttribute(r):(l=this.getAttribute(r),c=u+"",l===c?null:l===n&&c===s?o:(s=c,o=e(n=l,u)))}}function exe(r,e,i){var n,s,o;return function(){var l,u=i(this),c;return u==null?void this.removeAttributeNS(r.space,r.local):(l=this.getAttributeNS(r.space,r.local),c=u+"",l===c?null:l===n&&c===s?o:(s=c,o=e(n=l,u)))}}function txe(r,e){var i=N_(r),n=i==="transform"?Ise:e7;return this.attrTween(r,typeof e=="function"?(i.local?exe:$ve)(i,n,$R(this,"attr."+r,e)):e==null?(i.local?Kve:Yve)(i):(i.local?Zve:Jve)(i,n,e))}function ixe(r,e){return function(i){this.setAttribute(r,e.call(this,i))}}function rxe(r,e){return function(i){this.setAttributeNS(r.space,r.local,e.call(this,i))}}function nxe(r,e){var i,n;function s(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&rxe(r,o)),i}return s._value=e,s}function sxe(r,e){var i,n;function s(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&ixe(r,o)),i}return s._value=e,s}function axe(r,e){var i="attr."+r;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=N_(r);return this.tween(i,(n.local?nxe:sxe)(n,e))}function oxe(r,e){return function(){ZR(this,r).delay=+e.apply(this,arguments)}}function lxe(r,e){return e=+e,function(){ZR(this,r).delay=e}}function cxe(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?oxe:lxe)(e,r)):xc(this.node(),e).delay}function uxe(r,e){return function(){Hc(this,r).duration=+e.apply(this,arguments)}}function hxe(r,e){return e=+e,function(){Hc(this,r).duration=e}}function dxe(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?uxe:hxe)(e,r)):xc(this.node(),e).duration}function pxe(r,e){if(typeof e!="function")throw new Error;return function(){Hc(this,r).ease=e}}function fxe(r){var e=this._id;return arguments.length?this.each(pxe(e,r)):xc(this.node(),e).ease}function mxe(r,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;Hc(this,r).ease=i}}function gxe(r){if(typeof r!="function")throw new Error;return this.each(mxe(this._id,r))}function Axe(r){typeof r!="function"&&(r=Uz(r));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var o=e[s],l=o.length,u=n[s]=[],c,d=0;d<l;++d)(c=o[d])&&r.call(c,c.__data__,d,o)&&u.push(c);return new nh(n,this._parents,this._name,this._id)}function yxe(r){if(r._id!==this._id)throw new Error;for(var e=this._groups,i=r._groups,n=e.length,s=i.length,o=Math.min(n,s),l=new Array(n),u=0;u<o;++u)for(var c=e[u],d=i[u],p=c.length,f=l[u]=new Array(p),m,g=0;g<p;++g)(m=c[g]||d[g])&&(f[g]=m);for(;u<n;++u)l[u]=e[u];return new nh(l,this._parents,this._name,this._id)}function vxe(r){return(r+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function xxe(r,e,i){var n,s,o=vxe(e)?ZR:Hc;return function(){var l=o(this,r),u=l.on;u!==n&&(s=(n=u).copy()).on(e,i),l.on=s}}function bxe(r,e){var i=this._id;return arguments.length<2?xc(this.node(),i).on.on(r):this.each(xxe(i,r,e))}function _xe(r){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==r)return;e&&e.removeChild(this)}}function Exe(){return this.on("end.remove",_xe(this._id))}function wxe(r){var e=this._name,i=this._id;typeof r!="function"&&(r=QR(r));for(var n=this._groups,s=n.length,o=new Array(s),l=0;l<s;++l)for(var u=n[l],c=u.length,d=o[l]=new Array(c),p,f,m=0;m<c;++m)(p=u[m])&&(f=r.call(p,p.__data__,m,u))&&("__data__"in p&&(f.__data__=p.__data__),d[m]=f,F_(d[m],e,i,m,d,xc(p,i)));return new nh(o,this._parents,e,i)}function Cxe(r){var e=this._name,i=this._id;typeof r!="function"&&(r=kz(r));for(var n=this._groups,s=n.length,o=[],l=[],u=0;u<s;++u)for(var c=n[u],d=c.length,p,f=0;f<d;++f)if(p=c[f]){for(var m=r.call(p,p.__data__,f,c),g,y=xc(p,i),x=0,v=m.length;x<v;++x)(g=m[x])&&F_(g,e,i,x,m,y);o.push(m),l.push(p)}return new nh(o,l,e,i)}var Sxe=By.prototype.constructor;function Txe(){return new Sxe(this._groups,this._parents)}function Mxe(r,e){var i,n,s;return function(){var o=Lg(this,r),l=(this.style.removeProperty(r),Lg(this,r));return o===l?null:o===i&&l===n?s:s=e(i=o,n=l)}}function t7(r){return function(){this.style.removeProperty(r)}}function Rxe(r,e,i){var n,s=i+"",o;return function(){var l=Lg(this,r);return l===s?null:l===n?o:o=e(n=l,i)}}function Ixe(r,e,i){var n,s,o;return function(){var l=Lg(this,r),u=i(this),c=u+"";return u==null&&(c=u=(this.style.removeProperty(r),Lg(this,r))),l===c?null:l===n&&c===s?o:(s=c,o=e(n=l,u))}}function Bxe(r,e){var i,n,s,o="style."+e,l="end."+o,u;return function(){var c=Hc(this,r),d=c.on,p=c.value[o]==null?u||(u=t7(e)):void 0;(d!==i||s!==p)&&(n=(i=d).copy()).on(l,s=p),c.on=n}}function Nxe(r,e,i){var n=(r+="")=="transform"?Rse:e7;return e==null?this.styleTween(r,Mxe(r,n)).on("end.style."+r,t7(r)):typeof e=="function"?this.styleTween(r,Ixe(r,n,$R(this,"style."+r,e))).each(Bxe(this._id,r)):this.styleTween(r,Rxe(r,n,e),i).on("end.style."+r,null)}function Lxe(r,e,i){return function(n){this.style.setProperty(r,e.call(this,n),i)}}function Dxe(r,e,i){var n,s;function o(){var l=e.apply(this,arguments);return l!==s&&(n=(s=l)&&Lxe(r,l,i)),n}return o._value=e,o}function Oxe(r,e,i){var n="style."+(r+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,Dxe(r,e,i??""))}function Pxe(r){return function(){this.textContent=r}}function Fxe(r){return function(){var e=r(this);this.textContent=e??""}}function kxe(r){return this.tween("text",typeof r=="function"?Fxe($R(this,"text",r)):Pxe(r==null?"":r+""))}function Uxe(r){return function(e){this.textContent=r.call(this,e)}}function zxe(r){var e,i;function n(){var s=r.apply(this,arguments);return s!==i&&(e=(i=s)&&Uxe(s)),e}return n._value=r,n}function jxe(r){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(r==null)return this.tween(e,null);if(typeof r!="function")throw new Error;return this.tween(e,zxe(r))}function Vxe(){for(var r=this._name,e=this._id,i=i7(),n=this._groups,s=n.length,o=0;o<s;++o)for(var l=n[o],u=l.length,c,d=0;d<u;++d)if(c=l[d]){var p=xc(c,e);F_(c,r,i,d,l,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new nh(n,this._parents,r,i)}function Gxe(){var r,e,i=this,n=i._id,s=i.size();return new Promise(function(o,l){var u={value:l},c={value:function(){--s===0&&o()}};i.each(function(){var d=Hc(this,n),p=d.on;p!==r&&(e=(r=p).copy(),e._.cancel.push(u),e._.interrupt.push(u),e._.end.push(c)),d.on=e}),s===0&&o()})}var Hxe=0;function nh(r,e,i,n){this._groups=r,this._parents=e,this._name=i,this._id=n}function i7(){return++Hxe}var sh=By.prototype;nh.prototype={constructor:nh,select:wxe,selectAll:Cxe,selectChild:sh.selectChild,selectChildren:sh.selectChildren,filter:Axe,merge:yxe,selection:Txe,transition:Vxe,call:sh.call,nodes:sh.nodes,node:sh.node,size:sh.size,empty:sh.empty,each:sh.each,on:bxe,attr:txe,attrTween:axe,style:Nxe,styleTween:Oxe,text:kxe,textTween:jxe,remove:Exe,tween:Xve,delay:cxe,duration:dxe,ease:fxe,easeVarying:gxe,end:Gxe,[Symbol.iterator]:sh[Symbol.iterator]};function Wxe(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var Qxe={time:null,delay:0,duration:250,ease:Wxe};function qxe(r,e){for(var i;!(i=r.__transition)||!(i=i[e]);)if(!(r=r.parentNode))throw new Error(`transition ${e} not found`);return i}function Xxe(r){var e,i;r instanceof nh?(e=r._id,r=r._name):(e=i7(),(i=Qxe).time=$S(),r=r==null?null:r+"");for(var n=this._groups,s=n.length,o=0;o<s;++o)for(var l=n[o],u=l.length,c,d=0;d<u;++d)(c=l[d])&&F_(c,r,e,d,l,i||qxe(c,e));return new nh(n,this._parents,r,e)}By.prototype.interrupt=Wve,By.prototype.transition=Xxe;const U_=r=>()=>r;function Yxe(r,{sourceEvent:e,target:i,transform:n,dispatch:s}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:s}})}function ah(r,e,i){this.k=r,this.x=e,this.y=i}ah.prototype={constructor:ah,scale:function(r){return r===1?this:new ah(this.k*r,this.x,this.y)},translate:function(r,e){return r===0&e===0?this:new ah(this.k,this.x+this.k*r,this.y+this.k*e)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var eI=new ah(1,0,0);Wc.prototype=ah.prototype;function Wc(r){for(;!r.__zoom;)if(!(r=r.parentNode))return eI;return r.__zoom}function tI(r){r.stopImmediatePropagation()}function Ly(r){r.preventDefault(),r.stopImmediatePropagation()}function Kxe(r){return(!r.ctrlKey||r.type==="wheel")&&!r.button}function Jxe(){var r=this;return r instanceof SVGElement?(r=r.ownerSVGElement||r,r.hasAttribute("viewBox")?(r=r.viewBox.baseVal,[[r.x,r.y],[r.x+r.width,r.y+r.height]]):[[0,0],[r.width.baseVal.value,r.height.baseVal.value]]):[[0,0],[r.clientWidth,r.clientHeight]]}function r7(){return this.__zoom||eI}function Zxe(r){return-r.deltaY*(r.deltaMode===1?.05:r.deltaMode?1:.002)*(r.ctrlKey?10:1)}function $xe(){return navigator.maxTouchPoints||"ontouchstart"in this}function ebe(r,e,i){var n=r.invertX(e[0][0])-i[0][0],s=r.invertX(e[1][0])-i[1][0],o=r.invertY(e[0][1])-i[0][1],l=r.invertY(e[1][1])-i[1][1];return r.translate(s>n?(n+s)/2:Math.min(0,n)||Math.max(0,s),l>o?(o+l)/2:Math.min(0,o)||Math.max(0,l))}function tbe(){var r=Kxe,e=Jxe,i=ebe,n=Zxe,s=$xe,o=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],u=250,c=Dse,d=xA("start","zoom","end"),p,f,m,g=500,y=150,x=0,v=10;function _(V){V.property("__zoom",r7).on("wheel.zoom",D,{passive:!1}).on("mousedown.zoom",L).on("dblclick.zoom",O).filter(s).on("touchstart.zoom",U).on("touchmove.zoom",J).on("touchend.zoom touchcancel.zoom",H).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(V,$,Q,G){var j=V.selection?V.selection():V;j.property("__zoom",r7),V!==j?R(V,$,Q,G):j.interrupt().each(function(){B(this,arguments).event(G).start().zoom(null,typeof $=="function"?$.apply(this,arguments):$).end()})},_.scaleBy=function(V,$,Q,G){_.scaleTo(V,function(){var j=this.__zoom.k,ie=typeof $=="function"?$.apply(this,arguments):$;return j*ie},Q,G)},_.scaleTo=function(V,$,Q,G){_.transform(V,function(){var j=e.apply(this,arguments),ie=this.__zoom,Y=Q==null?S(j):typeof Q=="function"?Q.apply(this,arguments):Q,ae=ie.invert(Y),xe=typeof $=="function"?$.apply(this,arguments):$;return i(w(T(ie,xe),Y,ae),j,l)},Q,G)},_.translateBy=function(V,$,Q,G){_.transform(V,function(){return i(this.__zoom.translate(typeof $=="function"?$.apply(this,arguments):$,typeof Q=="function"?Q.apply(this,arguments):Q),e.apply(this,arguments),l)},null,G)},_.translateTo=function(V,$,Q,G,j){_.transform(V,function(){var ie=e.apply(this,arguments),Y=this.__zoom,ae=G==null?S(ie):typeof G=="function"?G.apply(this,arguments):G;return i(eI.translate(ae[0],ae[1]).scale(Y.k).translate(typeof $=="function"?-$.apply(this,arguments):-$,typeof Q=="function"?-Q.apply(this,arguments):-Q),ie,l)},G,j)};function T(V,$){return $=Math.max(o[0],Math.min(o[1],$)),$===V.k?V:new ah($,V.x,V.y)}function w(V,$,Q){var G=$[0]-Q[0]*V.k,j=$[1]-Q[1]*V.k;return G===V.x&&j===V.y?V:new ah(V.k,G,j)}function S(V){return[(+V[0][0]+ +V[1][0])/2,(+V[0][1]+ +V[1][1])/2]}function R(V,$,Q,G){V.on("start.zoom",function(){B(this,arguments).event(G).start()}).on("interrupt.zoom end.zoom",function(){B(this,arguments).event(G).end()}).tween("zoom",function(){var j=this,ie=arguments,Y=B(j,ie).event(G),ae=e.apply(j,ie),xe=Q==null?S(ae):typeof Q=="function"?Q.apply(j,ie):Q,fe=Math.max(ae[1][0]-ae[0][0],ae[1][1]-ae[0][1]),de=j.__zoom,Ie=typeof $=="function"?$.apply(j,ie):$,Ge=c(de.invert(xe).concat(fe/de.k),Ie.invert(xe).concat(fe/Ie.k));return function(Xe){if(Xe===1)Xe=Ie;else{var $e=Ge(Xe),lt=fe/$e[2];Xe=new ah(lt,xe[0]-$e[0]*lt,xe[1]-$e[1]*lt)}Y.zoom(null,Xe)}})}function B(V,$,Q){return!Q&&V.__zooming||new I(V,$)}function I(V,$){this.that=V,this.args=$,this.active=0,this.sourceEvent=null,this.extent=e.apply(V,$),this.taps=0}I.prototype={event:function(V){return V&&(this.sourceEvent=V),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(V,$){return this.mouse&&V!=="mouse"&&(this.mouse[1]=$.invert(this.mouse[0])),this.touch0&&V!=="touch"&&(this.touch0[1]=$.invert(this.touch0[0])),this.touch1&&V!=="touch"&&(this.touch1[1]=$.invert(this.touch1[0])),this.that.__zoom=$,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(V){var $=vc(this.that).datum();d.call(V,this.that,new Yxe(V,{sourceEvent:this.sourceEvent,target:_,transform:this.that.__zoom,dispatch:d}),$)}};function D(V,...$){if(!r.apply(this,arguments))return;var Q=B(this,$).event(V),G=this.__zoom,j=Math.max(o[0],Math.min(o[1],G.k*Math.pow(2,n.apply(this,arguments)))),ie=rh(V);if(Q.wheel)(Q.mouse[0][0]!==ie[0]||Q.mouse[0][1]!==ie[1])&&(Q.mouse[1]=G.invert(Q.mouse[0]=ie)),clearTimeout(Q.wheel);else{if(G.k===j)return;Q.mouse=[ie,G.invert(ie)],k_(this),Q.start()}Ly(V),Q.wheel=setTimeout(Y,y),Q.zoom("mouse",i(w(T(G,j),Q.mouse[0],Q.mouse[1]),Q.extent,l));function Y(){Q.wheel=null,Q.end()}}function L(V,...$){if(m||!r.apply(this,arguments))return;var Q=V.currentTarget,G=B(this,$,!0).event(V),j=vc(V.view).on("mousemove.zoom",xe,!0).on("mouseup.zoom",fe,!0),ie=rh(V,Q),Y=V.clientX,ae=V.clientY;Yz(V.view),tI(V),G.mouse=[ie,this.__zoom.invert(ie)],k_(this),G.start();function xe(de){if(Ly(de),!G.moved){var Ie=de.clientX-Y,Ge=de.clientY-ae;G.moved=Ie*Ie+Ge*Ge>x}G.event(de).zoom("mouse",i(w(G.that.__zoom,G.mouse[0]=rh(de,Q),G.mouse[1]),G.extent,l))}function fe(de){j.on("mousemove.zoom mouseup.zoom",null),Kz(de.view,G.moved),Ly(de),G.event(de).end()}}function O(V,...$){if(r.apply(this,arguments)){var Q=this.__zoom,G=rh(V.changedTouches?V.changedTouches[0]:V,this),j=Q.invert(G),ie=Q.k*(V.shiftKey?.5:2),Y=i(w(T(Q,ie),G,j),e.apply(this,$),l);Ly(V),u>0?vc(this).transition().duration(u).call(R,Y,G,V):vc(this).call(_.transform,Y,G,V)}}function U(V,...$){if(r.apply(this,arguments)){var Q=V.touches,G=Q.length,j=B(this,$,V.changedTouches.length===G).event(V),ie,Y,ae,xe;for(tI(V),Y=0;Y<G;++Y)ae=Q[Y],xe=rh(ae,this),xe=[xe,this.__zoom.invert(xe),ae.identifier],j.touch0?!j.touch1&&j.touch0[2]!==xe[2]&&(j.touch1=xe,j.taps=0):(j.touch0=xe,ie=!0,j.taps=1+!!p);p&&(p=clearTimeout(p)),ie&&(j.taps<2&&(f=xe[0],p=setTimeout(function(){p=null},g)),k_(this),j.start())}}function J(V,...$){if(this.__zooming){var Q=B(this,$).event(V),G=V.changedTouches,j=G.length,ie,Y,ae,xe;for(Ly(V),ie=0;ie<j;++ie)Y=G[ie],ae=rh(Y,this),Q.touch0&&Q.touch0[2]===Y.identifier?Q.touch0[0]=ae:Q.touch1&&Q.touch1[2]===Y.identifier&&(Q.touch1[0]=ae);if(Y=Q.that.__zoom,Q.touch1){var fe=Q.touch0[0],de=Q.touch0[1],Ie=Q.touch1[0],Ge=Q.touch1[1],Xe=(Xe=Ie[0]-fe[0])*Xe+(Xe=Ie[1]-fe[1])*Xe,$e=($e=Ge[0]-de[0])*$e+($e=Ge[1]-de[1])*$e;Y=T(Y,Math.sqrt(Xe/$e)),ae=[(fe[0]+Ie[0])/2,(fe[1]+Ie[1])/2],xe=[(de[0]+Ge[0])/2,(de[1]+Ge[1])/2]}else if(Q.touch0)ae=Q.touch0[0],xe=Q.touch0[1];else return;Q.zoom("touch",i(w(Y,ae,xe),Q.extent,l))}}function H(V,...$){if(this.__zooming){var Q=B(this,$).event(V),G=V.changedTouches,j=G.length,ie,Y;for(tI(V),m&&clearTimeout(m),m=setTimeout(function(){m=null},g),ie=0;ie<j;++ie)Y=G[ie],Q.touch0&&Q.touch0[2]===Y.identifier?delete Q.touch0:Q.touch1&&Q.touch1[2]===Y.identifier&&delete Q.touch1;if(Q.touch1&&!Q.touch0&&(Q.touch0=Q.touch1,delete Q.touch1),Q.touch0)Q.touch0[1]=this.__zoom.invert(Q.touch0[0]);else if(Q.end(),Q.taps===2&&(Y=rh(Y,this),Math.hypot(f[0]-Y[0],f[1]-Y[1])<v)){var ae=vc(this).on("dblclick.zoom");ae&&ae.apply(this,arguments)}}}return _.wheelDelta=function(V){return arguments.length?(n=typeof V=="function"?V:U_(+V),_):n},_.filter=function(V){return arguments.length?(r=typeof V=="function"?V:U_(!!V),_):r},_.touchable=function(V){return arguments.length?(s=typeof V=="function"?V:U_(!!V),_):s},_.extent=function(V){return arguments.length?(e=typeof V=="function"?V:U_([[+V[0][0],+V[0][1]],[+V[1][0],+V[1][1]]]),_):e},_.scaleExtent=function(V){return arguments.length?(o[0]=+V[0],o[1]=+V[1],_):[o[0],o[1]]},_.translateExtent=function(V){return arguments.length?(l[0][0]=+V[0][0],l[1][0]=+V[1][0],l[0][1]=+V[0][1],l[1][1]=+V[1][1],_):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},_.constrain=function(V){return arguments.length?(i=V,_):i},_.duration=function(V){return arguments.length?(u=+V,_):u},_.interpolate=function(V){return arguments.length?(c=V,_):c},_.on=function(){var V=d.on.apply(d,arguments);return V===d?_:V},_.clickDistance=function(V){return arguments.length?(x=(V=+V)*V,_):Math.sqrt(x)},_.tapDistance=function(V){return arguments.length?(v=+V,_):v},_}var ibe="Expected a function";function rbe(r,e,i){var n=!0,s=!0;if(typeof r!="function")throw new TypeError(ibe);return Ob(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),NF(r,e,{leading:n,maxWait:e,trailing:s})}function iI(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function nbe(r){if(Array.isArray(r))return iI(r)}function n7(r,e,i){if(typeof r=="function"?r===e:r.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}function sbe(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function abe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Ll(r,e){return r.get(n7(r,e))}function s7(r,e,i){sbe(r,e),e.set(r,i)}function a7(r,e,i){return r.set(n7(r,e),i),i}function obe(r,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,pbe(n.key),n)}}function lbe(r,e,i){return e&&obe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function cbe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function ube(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hbe(r){return nbe(r)||cbe(r)||fbe(r)||ube()}function dbe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function pbe(r){var e=dbe(r,"string");return typeof e=="symbol"?e:e+""}function fbe(r,e){if(r){if(typeof r=="string")return iI(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?iI(r,e):void 0}}var mbe=123,gbe=function(r){return"#".concat(Math.min(r,Math.pow(2,24)).toString(16).padStart(6,"0"))},o7=function(r,e,i){return(r<<16)+(e<<8)+i},Abe=function(r){var e=xr(r).toRgb(),i=e.r,n=e.g,s=e.b;return o7(i,n,s)},l7=function(r,e){return r*mbe%Math.pow(2,e)},Qp=new WeakMap,oh=new WeakMap,ybe=function(){function r(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:6;abe(this,r),s7(this,Qp,void 0),s7(this,oh,void 0),a7(oh,this,e),this.reset()}return lbe(r,[{key:"reset",value:function(){a7(Qp,this,["__reserved for background__"])}},{key:"register",value:function(e){if(Ll(Qp,this).length>=Math.pow(2,24-Ll(oh,this)))return null;var i=Ll(Qp,this).length,n=l7(i,Ll(oh,this)),s=gbe(i+(n<<24-Ll(oh,this)));return Ll(Qp,this).push(e),s}},{key:"lookup",value:function(e){if(!e)return null;var i=typeof e=="string"?Abe(e):o7.apply(void 0,hbe(e));if(!i)return null;var n=i&Math.pow(2,24-Ll(oh,this))-1,s=i>>24-Ll(oh,this)&Math.pow(2,Ll(oh,this))-1;return l7(n,Ll(oh,this))!==s||n>=Ll(Qp,this).length?null:Ll(Qp,this)[n]}}])}();const{abs:Dy,cos:lh,sin:Og,acos:vbe,atan2:Oy,sqrt:bd,pow:Dl}=Math;function Py(r){return r<0?-Dl(-r,1/3):Dl(r,1/3)}const c7=Math.PI,z_=2*c7,_d=c7/2,xbe=1e-6,rI=Number.MAX_SAFE_INTEGER||9007199254740991,nI=Number.MIN_SAFE_INTEGER||-9007199254740991,bbe={x:0,y:0,z:0},Ci={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(r,e){const i=e(r);let n=i.x*i.x+i.y*i.y;return typeof i.z<"u"&&(n+=i.z*i.z),bd(n)},compute:function(r,e,i){if(r===0)return e[0].t=0,e[0];const n=e.length-1;if(r===1)return e[n].t=1,e[n];const s=1-r;let o=e;if(n===0)return e[0].t=r,e[0];if(n===1){const u={x:s*o[0].x+r*o[1].x,y:s*o[0].y+r*o[1].y,t:r};return i&&(u.z=s*o[0].z+r*o[1].z),u}if(n<4){let u=s*s,c=r*r,d,p,f,m=0;n===2?(o=[o[0],o[1],o[2],bbe],d=u,p=s*r*2,f=c):n===3&&(d=u*s,p=u*r*3,f=s*c*3,m=r*c);const g={x:d*o[0].x+p*o[1].x+f*o[2].x+m*o[3].x,y:d*o[0].y+p*o[1].y+f*o[2].y+m*o[3].y,t:r};return i&&(g.z=d*o[0].z+p*o[1].z+f*o[2].z+m*o[3].z),g}const l=JSON.parse(JSON.stringify(e));for(;l.length>1;){for(let u=0;u<l.length-1;u++)l[u]={x:l[u].x+(l[u+1].x-l[u].x)*r,y:l[u].y+(l[u+1].y-l[u].y)*r},typeof l[u].z<"u"&&(l[u].z=l[u].z+(l[u+1].z-l[u].z)*r);l.splice(l.length-1,1)}return l[0].t=r,l[0]},computeWithRatios:function(r,e,i,n){const s=1-r,o=i,l=e;let u=o[0],c=o[1],d=o[2],p=o[3],f;if(u*=s,c*=r,l.length===2)return f=u+c,{x:(u*l[0].x+c*l[1].x)/f,y:(u*l[0].y+c*l[1].y)/f,z:n?(u*l[0].z+c*l[1].z)/f:!1,t:r};if(u*=s,c*=2*s,d*=r*r,l.length===3)return f=u+c+d,{x:(u*l[0].x+c*l[1].x+d*l[2].x)/f,y:(u*l[0].y+c*l[1].y+d*l[2].y)/f,z:n?(u*l[0].z+c*l[1].z+d*l[2].z)/f:!1,t:r};if(u*=s,c*=1.5*s,d*=3*s,p*=r*r*r,l.length===4)return f=u+c+d+p,{x:(u*l[0].x+c*l[1].x+d*l[2].x+p*l[3].x)/f,y:(u*l[0].y+c*l[1].y+d*l[2].y+p*l[3].y)/f,z:n?(u*l[0].z+c*l[1].z+d*l[2].z+p*l[3].z)/f:!1,t:r}},derive:function(r,e){const i=[];for(let n=r,s=n.length,o=s-1;s>1;s--,o--){const l=[];for(let u=0,c;u<o;u++)c={x:o*(n[u+1].x-n[u].x),y:o*(n[u+1].y-n[u].y)},e&&(c.z=o*(n[u+1].z-n[u].z)),l.push(c);i.push(l),n=l}return i},between:function(r,e,i){return e<=r&&r<=i||Ci.approximately(r,e)||Ci.approximately(r,i)},approximately:function(r,e,i){return Dy(r-e)<=(i||xbe)},length:function(r){const e=Ci.Tvalues.length;let i=0;for(let n=0,s;n<e;n++)s=.5*Ci.Tvalues[n]+.5,i+=Ci.Cvalues[n]*Ci.arcfn(s,r);return .5*i},map:function(r,e,i,n,s){const o=i-e,l=s-n,u=r-e,c=u/o;return n+l*c},lerp:function(r,e,i){const n={x:e.x+r*(i.x-e.x),y:e.y+r*(i.y-e.y)};return e.z!==void 0&&i.z!==void 0&&(n.z=e.z+r*(i.z-e.z)),n},pointToString:function(r){let e=r.x+"/"+r.y;return typeof r.z<"u"&&(e+="/"+r.z),e},pointsToString:function(r){return"["+r.map(Ci.pointToString).join(", ")+"]"},copy:function(r){return JSON.parse(JSON.stringify(r))},angle:function(r,e,i){const n=e.x-r.x,s=e.y-r.y,o=i.x-r.x,l=i.y-r.y,u=n*l-s*o,c=n*o+s*l;return Oy(u,c)},round:function(r,e){const i=""+r,n=i.indexOf(".");return parseFloat(i.substring(0,n+1+e))},dist:function(r,e){const i=r.x-e.x,n=r.y-e.y;return bd(i*i+n*n)},closest:function(r,e){let i=Dl(2,63),n,s;return r.forEach(function(o,l){s=Ci.dist(e,o),s<i&&(i=s,n=l)}),{mdist:i,mpos:n}},abcratio:function(r,e){if(e!==2&&e!==3)return!1;if(typeof r>"u")r=.5;else if(r===0||r===1)return r;const i=Dl(r,e)+Dl(1-r,e),n=i-1;return Dy(n/i)},projectionratio:function(r,e){if(e!==2&&e!==3)return!1;if(typeof r>"u")r=.5;else if(r===0||r===1)return r;const i=Dl(1-r,e),n=Dl(r,e)+i;return i/n},lli8:function(r,e,i,n,s,o,l,u){const c=(r*n-e*i)*(s-l)-(r-i)*(s*u-o*l),d=(r*n-e*i)*(o-u)-(e-n)*(s*u-o*l),p=(r-i)*(o-u)-(e-n)*(s-l);return p==0?!1:{x:c/p,y:d/p}},lli4:function(r,e,i,n){const s=r.x,o=r.y,l=e.x,u=e.y,c=i.x,d=i.y,p=n.x,f=n.y;return Ci.lli8(s,o,l,u,c,d,p,f)},lli:function(r,e){return Ci.lli4(r,r.c,e,e.c)},makeline:function(r,e){return new ms(r.x,r.y,(r.x+e.x)/2,(r.y+e.y)/2,e.x,e.y)},findbbox:function(r){let e=rI,i=rI,n=nI,s=nI;return r.forEach(function(o){const l=o.bbox();e>l.x.min&&(e=l.x.min),i>l.y.min&&(i=l.y.min),n<l.x.max&&(n=l.x.max),s<l.y.max&&(s=l.y.max)}),{x:{min:e,mid:(e+n)/2,max:n,size:n-e},y:{min:i,mid:(i+s)/2,max:s,size:s-i}}},shapeintersections:function(r,e,i,n,s){if(!Ci.bboxoverlap(e,n))return[];const o=[],l=[r.startcap,r.forward,r.back,r.endcap],u=[i.startcap,i.forward,i.back,i.endcap];return l.forEach(function(c){c.virtual||u.forEach(function(d){if(d.virtual)return;const p=c.intersects(d,s);p.length>0&&(p.c1=c,p.c2=d,p.s1=r,p.s2=i,o.push(p))})}),o},makeshape:function(r,e,i){const n=e.points.length,s=r.points.length,o=Ci.makeline(e.points[n-1],r.points[0]),l=Ci.makeline(r.points[s-1],e.points[0]),u={startcap:o,forward:r,back:e,endcap:l,bbox:Ci.findbbox([o,r,e,l])};return u.intersections=function(c){return Ci.shapeintersections(u,u.bbox,c,c.bbox,i)},u},getminmax:function(r,e,i){if(!i)return{min:0,max:0};let n=rI,s=nI,o,l;i.indexOf(0)===-1&&(i=[0].concat(i)),i.indexOf(1)===-1&&i.push(1);for(let u=0,c=i.length;u<c;u++)o=i[u],l=r.get(o),l[e]<n&&(n=l[e]),l[e]>s&&(s=l[e]);return{min:n,mid:(n+s)/2,max:s,size:s-n}},align:function(r,e){const i=e.p1.x,n=e.p1.y,s=-Oy(e.p2.y-n,e.p2.x-i),o=function(l){return{x:(l.x-i)*lh(s)-(l.y-n)*Og(s),y:(l.x-i)*Og(s)+(l.y-n)*lh(s)}};return r.map(o)},roots:function(r,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const i=r.length-1,n=Ci.align(r,e),s=function(I){return 0<=I&&I<=1};if(i===2){const I=n[0].y,D=n[1].y,L=n[2].y,O=I-2*D+L;if(O!==0){const U=-bd(D*D-I*L),J=-I+D,H=-(U+J)/O,V=-(-U+J)/O;return[H,V].filter(s)}else if(D!==L&&O===0)return[(2*D-L)/(2*D-2*L)].filter(s);return[]}const o=n[0].y,l=n[1].y,u=n[2].y,c=n[3].y;let d=-o+3*l-3*u+c,p=3*o-6*l+3*u,f=-3*o+3*l,m=o;if(Ci.approximately(d,0)){if(Ci.approximately(p,0))return Ci.approximately(f,0)?[]:[-m/f].filter(s);const I=bd(f*f-4*p*m),D=2*p;return[(I-f)/D,(-f-I)/D].filter(s)}p/=d,f/=d,m/=d;const g=(3*f-p*p)/3,y=g/3,x=(2*p*p*p-9*p*f+27*m)/27,v=x/2,_=v*v+y*y*y;let T,w,S,R,B;if(_<0){const I=-g/3,D=I*I*I,L=bd(D),O=-x/(2*L),U=O<-1?-1:O>1?1:O,J=vbe(U),H=Py(L),V=2*H;return S=V*lh(J/3)-p/3,R=V*lh((J+z_)/3)-p/3,B=V*lh((J+2*z_)/3)-p/3,[S,R,B].filter(s)}else{if(_===0)return T=v<0?Py(-v):-Py(v),S=2*T-p/3,R=-T-p/3,[S,R].filter(s);{const I=bd(_);return T=Py(-v+I),w=Py(v+I),[T-w-p/3].filter(s)}}},droots:function(r){if(r.length===3){const e=r[0],i=r[1],n=r[2],s=e-2*i+n;if(s!==0){const o=-bd(i*i-e*n),l=-e+i,u=-(o+l)/s,c=-(-o+l)/s;return[u,c]}else if(i!==n&&s===0)return[(2*i-n)/(2*(i-n))];return[]}if(r.length===2){const e=r[0],i=r[1];return e!==i?[e/(e-i)]:[]}return[]},curvature:function(r,e,i,n,s){let o,l,u,c,d=0,p=0;const f=Ci.compute(r,e),m=Ci.compute(r,i),g=f.x*f.x+f.y*f.y;if(n?(o=bd(Dl(f.y*m.z-m.y*f.z,2)+Dl(f.z*m.x-m.z*f.x,2)+Dl(f.x*m.y-m.x*f.y,2)),l=Dl(g+f.z*f.z,3/2)):(o=f.x*m.y-f.y*m.x,l=Dl(g,3/2)),o===0||l===0)return{k:0,r:0};if(d=o/l,p=l/o,!s){const y=Ci.curvature(r-.001,e,i,n,!0).k,x=Ci.curvature(r+.001,e,i,n,!0).k;c=(x-d+(d-y))/2,u=(Dy(x-d)+Dy(d-y))/2}return{k:d,r:p,dk:c,adk:u}},inflections:function(r){if(r.length<4)return[];const e=Ci.align(r,{p1:r[0],p2:r.slice(-1)[0]}),i=e[2].x*e[1].y,n=e[3].x*e[1].y,s=e[1].x*e[2].y,o=e[3].x*e[2].y,l=18*(-3*i+2*n+3*s-o),u=18*(3*i-n-3*s),c=18*(s-i);if(Ci.approximately(l,0)){if(!Ci.approximately(u,0)){let m=-c/u;if(0<=m&&m<=1)return[m]}return[]}const d=2*l;if(Ci.approximately(d,0))return[];const p=u*u-4*l*c;if(p<0)return[];const f=Math.sqrt(p);return[(f-u)/d,-(u+f)/d].filter(function(m){return 0<=m&&m<=1})},bboxoverlap:function(r,e){const i=["x","y"],n=i.length;for(let s=0,o,l,u,c;s<n;s++)if(o=i[s],l=r[o].mid,u=e[o].mid,c=(r[o].size+e[o].size)/2,Dy(l-u)>=c)return!1;return!0},expandbox:function(r,e){e.x.min<r.x.min&&(r.x.min=e.x.min),e.y.min<r.y.min&&(r.y.min=e.y.min),e.z&&e.z.min<r.z.min&&(r.z.min=e.z.min),e.x.max>r.x.max&&(r.x.max=e.x.max),e.y.max>r.y.max&&(r.y.max=e.y.max),e.z&&e.z.max>r.z.max&&(r.z.max=e.z.max),r.x.mid=(r.x.min+r.x.max)/2,r.y.mid=(r.y.min+r.y.max)/2,r.z&&(r.z.mid=(r.z.min+r.z.max)/2),r.x.size=r.x.max-r.x.min,r.y.size=r.y.max-r.y.min,r.z&&(r.z.size=r.z.max-r.z.min)},pairiteration:function(r,e,i){const n=r.bbox(),s=e.bbox(),o=1e5,l=i||.5;if(n.x.size+n.y.size<l&&s.x.size+s.y.size<l)return[(o*(r._t1+r._t2)/2|0)/o+"/"+(o*(e._t1+e._t2)/2|0)/o];let u=r.split(.5),c=e.split(.5),d=[{left:u.left,right:c.left},{left:u.left,right:c.right},{left:u.right,right:c.right},{left:u.right,right:c.left}];d=d.filter(function(f){return Ci.bboxoverlap(f.left.bbox(),f.right.bbox())});let p=[];return d.length===0||(d.forEach(function(f){p=p.concat(Ci.pairiteration(f.left,f.right,l))}),p=p.filter(function(f,m){return p.indexOf(f)===m})),p},getccenter:function(r,e,i){const n=e.x-r.x,s=e.y-r.y,o=i.x-e.x,l=i.y-e.y,u=n*lh(_d)-s*Og(_d),c=n*Og(_d)+s*lh(_d),d=o*lh(_d)-l*Og(_d),p=o*Og(_d)+l*lh(_d),f=(r.x+e.x)/2,m=(r.y+e.y)/2,g=(e.x+i.x)/2,y=(e.y+i.y)/2,x=f+u,v=m+c,_=g+d,T=y+p,w=Ci.lli8(f,m,x,v,g,y,_,T),S=Ci.dist(w,r);let R=Oy(r.y-w.y,r.x-w.x),B=Oy(e.y-w.y,e.x-w.x),I=Oy(i.y-w.y,i.x-w.x),D;return R<I?((R>B||B>I)&&(R+=z_),R>I&&(D=I,I=R,R=D)):I<B&&B<R?(D=I,I=R,R=D):I+=z_,w.s=R,w.e=I,w.r=S,w},numberSort:function(r,e){return r-e}};class Fy{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(e){return Ci.pointsToString(e.points)}).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map(function(e){return e.length()}).reduce(function(e,i){return e+i})}curve(e){return this.curves[e]}bbox(){const e=this.curves;for(var i=e[0].bbox(),n=1;n<e.length;n++)Ci.expandbox(i,e[n].bbox());return i}offset(e){const i=[];return this.curves.forEach(function(n){i.push(...n.offset(e))}),new Fy(i)}}const{abs:ky,min:u7,max:h7,cos:_be,sin:Ebe,acos:wbe,sqrt:Uy}=Math,Cbe=Math.PI;class ms{constructor(e){let i=e&&e.forEach?e:Array.from(arguments).slice(),n=!1;if(typeof i[0]=="object"){n=i.length;const g=[];i.forEach(function(y){["x","y","z"].forEach(function(x){typeof y[x]<"u"&&g.push(y[x])})}),i=g}let s=!1;const o=i.length;if(n){if(n>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(o!==6&&o!==8&&o!==9&&o!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const l=this._3d=!s&&(o===9||o===12)||e&&e[0]&&typeof e[0].z<"u",u=this.points=[];for(let g=0,y=l?3:2;g<o;g+=y){var c={x:i[g],y:i[g+1]};l&&(c.z=i[g+2]),u.push(c)}const d=this.order=u.length-1,p=this.dims=["x","y"];l&&p.push("z"),this.dimlen=p.length;const f=Ci.align(u,{p1:u[0],p2:u[d]}),m=Ci.dist(u[0],u[d]);this._linear=f.reduce((g,y)=>g+ky(y.y),0)<m/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,i,n,s){if(typeof s>"u"&&(s=.5),s===0)return new ms(i,i,n);if(s===1)return new ms(e,i,i);const o=ms.getABC(2,e,i,n,s);return new ms(e,o.A,n)}static cubicFromPoints(e,i,n,s,o){typeof s>"u"&&(s=.5);const l=ms.getABC(3,e,i,n,s);typeof o>"u"&&(o=Ci.dist(i,l.C));const u=o*(1-s)/s,c=Ci.dist(e,n),d=(n.x-e.x)/c,p=(n.y-e.y)/c,f=o*d,m=o*p,g=u*d,y=u*p,x={x:i.x-f,y:i.y-m},v={x:i.x+g,y:i.y+y},_=l.A,T={x:_.x+(x.x-_.x)/(1-s),y:_.y+(x.y-_.y)/(1-s)},w={x:_.x+(v.x-_.x)/s,y:_.y+(v.y-_.y)/s},S={x:e.x+(T.x-e.x)/s,y:e.y+(T.y-e.y)/s},R={x:n.x+(w.x-n.x)/(1-s),y:n.y+(w.y-n.y)/(1-s)};return new ms(e,S,R,n)}static getUtils(){return Ci}getUtils(){return ms.getUtils()}static get PolyBezier(){return Fy}valueOf(){return this.toString()}toString(){return Ci.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const e=this.points,i=e[0].x,n=e[0].y,s=["M",i,n,this.order===2?"Q":"C"];for(let o=1,l=e.length;o<l;o++)s.push(e[o].x),s.push(e[o].y);return s.join(" ")}setRatios(e){if(e.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){const e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map(function(e,i){return""+i+e.x+e.y+(e.z?e.z:0)}).join("")}update(){this._lut=[],this.dpoints=Ci.derive(this.points,this._3d),this.computedirection()}computedirection(){const e=this.points,i=Ci.angle(e[0],e[this.order],e[1]);this.clockwise=i>0}length(){return Ci.length(this.derivative.bind(this))}static getABC(e=2,i,n,s,o=.5){const l=Ci.projectionratio(o,e),u=1-l,c={x:l*i.x+u*s.x,y:l*i.y+u*s.y},d=Ci.abcratio(o,e);return{A:{x:n.x+(n.x-c.x)/d,y:n.y+(n.y-c.y)/d},B:n,C:c,S:i,E:s}}getABC(e,i){i=i||this.get(e);let n=this.points[0],s=this.points[this.order];return ms.getABC(this.order,n,i,s,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let i=0,n,s;i<e;i++)s=i/(e-1),n=this.compute(s),n.t=s,this._lut.push(n);return this._lut}on(e,i){i=i||5;const n=this.getLUT(),s=[];for(let o=0,l,u=0;o<n.length;o++)l=n[o],Ci.dist(l,e)<i&&(s.push(l),u+=o/n.length);return s.length?t/=s.length:!1}project(e){const i=this.getLUT(),n=i.length-1,s=Ci.closest(i,e),o=s.mpos,l=(o-1)/n,u=(o+1)/n,c=.1/n;let d=s.mdist,p=l,f=p,m;d+=1;for(let g;p<u+c;p+=c)m=this.compute(p),g=Ci.dist(e,m),g<d&&(d=g,f=p);return f=f<0?0:f>1?1:f,m=this.compute(f),m.t=f,m.d=d,m}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?Ci.computeWithRatios(e,this.points,this.ratios,this._3d):Ci.compute(e,this.points,this._3d,this.ratios)}raise(){const e=this.points,i=[e[0]],n=e.length;for(let s=1,o,l;s<n;s++)o=e[s],l=e[s-1],i[s]={x:(n-s)/n*o.x+s/n*l.x,y:(n-s)/n*o.y+s/n*l.y};return i[n]=e[n-1],new ms(i)}derivative(e){return Ci.compute(e,this.dpoints[0],this._3d)}dderivative(e){return Ci.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new ms(Ci.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return Ci.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return Ci.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){const i=this.derivative(e),n=Uy(i.x*i.x+i.y*i.y);return{t:e,x:-i.y/n,y:i.x/n}}__normal3(e){const i=this.derivative(e),n=this.derivative(e+.01),s=Uy(i.x*i.x+i.y*i.y+i.z*i.z),o=Uy(n.x*n.x+n.y*n.y+n.z*n.z);i.x/=s,i.y/=s,i.z/=s,n.x/=o,n.y/=o,n.z/=o;const l={x:n.y*i.z-n.z*i.y,y:n.z*i.x-n.x*i.z,z:n.x*i.y-n.y*i.x},u=Uy(l.x*l.x+l.y*l.y+l.z*l.z);l.x/=u,l.y/=u,l.z/=u;const c=[l.x*l.x,l.x*l.y-l.z,l.x*l.z+l.y,l.x*l.y+l.z,l.y*l.y,l.y*l.z-l.x,l.x*l.z-l.y,l.y*l.z+l.x,l.z*l.z];return{t:e,x:c[0]*i.x+c[1]*i.y+c[2]*i.z,y:c[3]*i.x+c[4]*i.y+c[5]*i.z,z:c[6]*i.x+c[7]*i.y+c[8]*i.z}}hull(e){let i=this.points,n=[],s=[],o=0;for(s[o++]=i[0],s[o++]=i[1],s[o++]=i[2],this.order===3&&(s[o++]=i[3]);i.length>1;){n=[];for(let l=0,u,c=i.length-1;l<c;l++)u=Ci.lerp(e,i[l],i[l+1]),s[o++]=u,n.push(u);i=n}return s}split(e,i){if(e===0&&i)return this.split(i).left;if(i===1)return this.split(e).right;const n=this.hull(e),s={left:this.order===2?new ms([n[0],n[3],n[5]]):new ms([n[0],n[4],n[7],n[9]]),right:this.order===2?new ms([n[5],n[4],n[2]]):new ms([n[9],n[8],n[6],n[3]]),span:n};return s.left._t1=Ci.map(0,0,1,this._t1,this._t2),s.left._t2=Ci.map(e,0,1,this._t1,this._t2),s.right._t1=Ci.map(e,0,1,this._t1,this._t2),s.right._t2=Ci.map(1,0,1,this._t1,this._t2),i?(i=Ci.map(i,e,1,0,1),s.right.split(i).left):s}extrema(){const e={};let i=[];return this.dims.forEach((function(n){let s=function(l){return l[n]},o=this.dpoints[0].map(s);e[n]=Ci.droots(o),this.order===3&&(o=this.dpoints[1].map(s),e[n]=e[n].concat(Ci.droots(o))),e[n]=e[n].filter(function(l){return l>=0&&l<=1}),i=i.concat(e[n].sort(Ci.numberSort))}).bind(this)),e.values=i.sort(Ci.numberSort).filter(function(n,s){return i.indexOf(n)===s}),e}bbox(){const e=this.extrema(),i={};return this.dims.forEach((function(n){i[n]=Ci.getminmax(this,n,e[n])}).bind(this)),i}overlaps(e){const i=this.bbox(),n=e.bbox();return Ci.bboxoverlap(i,n)}offset(e,i){if(typeof i<"u"){const n=this.get(e),s=this.normal(e),o={c:n,n:s,x:n.x+s.x*i,y:n.y+s.y*i};return this._3d&&(o.z=n.z+s.z*i),o}if(this._linear){const n=this.normal(0),s=this.points.map(function(o){const l={x:o.x+e*n.x,y:o.y+e*n.y};return o.z&&n.z&&(l.z=o.z+e*n.z),l});return[new ms(s)]}return this.reduce().map(function(n){return n._linear?n.offset(e)[0]:n.scale(e)})}simple(){if(this.order===3){const s=Ci.angle(this.points[0],this.points[3],this.points[1]),o=Ci.angle(this.points[0],this.points[3],this.points[2]);if(s>0&&o<0||s<0&&o>0)return!1}const e=this.normal(0),i=this.normal(1);let n=e.x*i.x+e.y*i.y;return this._3d&&(n+=e.z*i.z),ky(wbe(n))<Cbe/3}reduce(){let e,i=0,n=0,s=.01,o,l=[],u=[],c=this.extrema().values;for(c.indexOf(0)===-1&&(c=[0].concat(c)),c.indexOf(1)===-1&&c.push(1),i=c[0],e=1;e<c.length;e++)n=c[e],o=this.split(i,n),o._t1=i,o._t2=n,l.push(o),i=n;return l.forEach(function(d){for(i=0,n=0;n<=1;)for(n=i+s;n<=1+s;n+=s)if(o=d.split(i,n),!o.simple()){if(n-=s,ky(i-n)<s)return[];o=d.split(i,n),o._t1=Ci.map(i,0,1,d._t1,d._t2),o._t2=Ci.map(n,0,1,d._t1,d._t2),u.push(o),i=n;break}i<1&&(o=d.split(i,1),o._t1=Ci.map(i,0,1,d._t1,d._t2),o._t2=d._t2,u.push(o))}),u}translate(e,i,n){n=typeof n=="number"?n:i;const s=this.order;let o=this.points.map((l,u)=>(1-u/s)*i+u/s*n);return new ms(this.points.map((l,u)=>({x:l.x+e.x*o[u],y:l.y+e.y*o[u]})))}scale(e){const i=this.order;let n=!1;if(typeof e=="function"&&(n=e),n&&i===2)return this.raise().scale(n);const s=this.clockwise,o=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):e,n?n(1):e);const l=n?n(0):e,u=n?n(1):e,c=[this.offset(0,10),this.offset(1,10)],d=[],p=Ci.lli4(c[0],c[0].c,c[1],c[1].c);if(!p)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(f){const m=d[f*i]=Ci.copy(o[f*i]);m.x+=(f?u:l)*c[f].n.x,m.y+=(f?u:l)*c[f].n.y}),n?([0,1].forEach(function(f){if(!(i===2&&f)){var m=o[f+1],g={x:m.x-p.x,y:m.y-p.y},y=n?n((f+1)/i):e;n&&!s&&(y=-y);var x=Uy(g.x*g.x+g.y*g.y);g.x/=x,g.y/=x,d[f+1]={x:m.x+y*g.x,y:m.y+y*g.y}}}),new ms(d)):([0,1].forEach(f=>{if(i===2&&f)return;const m=d[f*i],g=this.derivative(f),y={x:m.x+g.x,y:m.y+g.y};d[f+1]=Ci.lli4(m,y,p,o[f+1])}),new ms(d))}outline(e,i,n,s){if(i=i===void 0?e:i,this._linear){const R=this.normal(0),B=this.points[0],I=this.points[this.points.length-1];let D,L,O;n===void 0&&(n=e,s=i),D={x:B.x+R.x*e,y:B.y+R.y*e},O={x:I.x+R.x*n,y:I.y+R.y*n},L={x:(D.x+O.x)/2,y:(D.y+O.y)/2};const U=[D,L,O];D={x:B.x-R.x*i,y:B.y-R.y*i},O={x:I.x-R.x*s,y:I.y-R.y*s},L={x:(D.x+O.x)/2,y:(D.y+O.y)/2};const J=[O,L,D],H=Ci.makeline(J[2],U[0]),V=Ci.makeline(U[2],J[0]),$=[H,new ms(U),V,new ms(J)];return new Fy($)}const o=this.reduce(),l=o.length,u=[];let c=[],d,p=0,f=this.length();const m=typeof n<"u"&&typeof s<"u";function g(R,B,I,D,L){return function(O){const U=D/I,J=(D+L)/I,H=B-R;return Ci.map(O,0,1,R+U*H,R+J*H)}}o.forEach(function(R){const B=R.length();m?(u.push(R.scale(g(e,n,f,p,B))),c.push(R.scale(g(-i,-s,f,p,B)))):(u.push(R.scale(e)),c.push(R.scale(-i))),p+=B}),c=c.map(function(R){return d=R.points,d[3]?R.points=[d[3],d[2],d[1],d[0]]:R.points=[d[2],d[1],d[0]],R}).reverse();const y=u[0].points[0],x=u[l-1].points[u[l-1].points.length-1],v=c[l-1].points[c[l-1].points.length-1],_=c[0].points[0],T=Ci.makeline(v,y),w=Ci.makeline(x,_),S=[T].concat(u).concat([w]).concat(c);return new Fy(S)}outlineshapes(e,i,n){i=i||e;const s=this.outline(e,i).curves,o=[];for(let l=1,u=s.length;l<u/2;l++){const c=Ci.makeshape(s[l],s[u-l],n);c.startcap.virtual=l>1,c.endcap.virtual=l<u/2-1,o.push(c)}return o}intersects(e,i){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof ms&&(e=e.reduce()),this.curveintersects(this.reduce(),e,i)):this.selfintersects(i)}lineIntersects(e){const i=u7(e.p1.x,e.p2.x),n=u7(e.p1.y,e.p2.y),s=h7(e.p1.x,e.p2.x),o=h7(e.p1.y,e.p2.y);return Ci.roots(this.points,e).filter(l=>{var u=this.get(l);return Ci.between(u.x,i,s)&&Ci.between(u.y,n,o)})}selfintersects(e){const i=this.reduce(),n=i.length-2,s=[];for(let o=0,l,u,c;o<n;o++)u=i.slice(o,o+1),c=i.slice(o+2),l=this.curveintersects(u,c,e),s.push(...l);return s}curveintersects(e,i,n){const s=[];e.forEach(function(l){i.forEach(function(u){l.overlaps(u)&&s.push({left:l,right:u})})});let o=[];return s.forEach(function(l){const u=Ci.pairiteration(l.left,l.right,n);u.length>0&&(o=o.concat(u))}),o}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,i,n,s){const o=(s-n)/4,l=this.get(n+o),u=this.get(s-o),c=Ci.dist(e,i),d=Ci.dist(e,l),p=Ci.dist(e,u);return ky(d-c)+ky(p-c)}_iterate(e,i){let n=0,s=1,o;do{o=0,s=1;let l=this.get(n),u,c,d,p,f=!1,m=!1,g,y=s,x=1;do if(m=f,p=d,y=(n+s)/2,u=this.get(y),c=this.get(s),d=Ci.getccenter(l,u,c),d.interval={start:n,end:s},f=this._error(d,l,n,s)<=e,g=m&&!f,g||(x=s),f){if(s>=1){if(d.interval.end=x=1,p=d,s>1){let v={x:d.x+d.r*_be(d.e),y:d.y+d.r*Ebe(d.e)};d.e+=Ci.angle({x:d.x,y:d.y},v,this.get(1))}break}s=s+(s-n)/2}else s=y;while(!g&&o++<100);if(o>=100)break;p=p||d,i.push(p),n=x}while(s<1);return i}}function Sbe(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var Tbe=`.force-graph-container canvas {
  display: block;
  user-select: none;
  outline: none;
  -webkit-tap-highlight-color: transparent;
}

.force-graph-container .graph-tooltip {
  position: absolute;
  top: 0;
  font-family: sans-serif;
  font-size: 16px;
  padding: 4px;
  border-radius: 3px;
  color: #eee;
  background: rgba(0,0,0,0.65);
  visibility: hidden; /* by default */
}

.force-graph-container .clickable {
  cursor: pointer;
}

.force-graph-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.force-graph-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}
`;Sbe(Tbe);function sI(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function Mbe(r){if(Array.isArray(r))return r}function Rbe(r){if(Array.isArray(r))return sI(r)}function d7(r,e,i){if(p7())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return s}function zy(r,e,i){return(e=Obe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function p7(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(p7=function(){return!!r})()}function Ibe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Bbe(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function Nbe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lbe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f7(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function Pg(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?f7(Object(i),!0).forEach(function(n){zy(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):f7(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function jy(r,e){return Mbe(r)||Bbe(r,e)||m7(r,e)||Nbe()}function Ol(r){return Rbe(r)||Ibe(r)||m7(r)||Lbe()}function Dbe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Obe(r){var e=Dbe(r,"string");return typeof e=="symbol"?e:e+""}function aI(r){"@babel/helpers - typeof";return aI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},aI(r)}function m7(r,e){if(r){if(typeof r=="string")return sI(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?sI(r,e):void 0}}var Pbe=yT(ak);function g7(r,e,i){!e||typeof i!="string"||r.filter(function(n){return!n[i]}).forEach(function(n){n[i]=Pbe(e(n))})}function Fbe(r,e){var i=r.nodes,n=r.links,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.nodeFilter,l=o===void 0?function(){return!0}:o,u=s.onLoopError,c=u===void 0?function(g){throw"Invalid DAG structure! Found cycle in node path: ".concat(g.join(" -> "),".")}:u,d={};i.forEach(function(g){return d[e(g)]={data:g,out:[],depth:-1,skip:!l(g)}}),n.forEach(function(g){var y=g.source,x=g.target,v=S(y),_=S(x);if(!d.hasOwnProperty(v))throw"Missing source node with id: ".concat(v);if(!d.hasOwnProperty(_))throw"Missing target node with id: ".concat(_);var T=d[v],w=d[_];T.out.push(w);function S(R){return aI(R)==="object"?e(R):R}});var p=[];m(Object.values(d));var f=Object.assign.apply(Object,[{}].concat(Ol(Object.entries(d).filter(function(g){var y=jy(g,2),x=y[1];return!x.skip}).map(function(g){var y=jy(g,2),x=y[0],v=y[1];return zy({},x,v.depth)}))));return f;function m(g){for(var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=function(){var w=g[_];if(y.indexOf(w)!==-1){var S=[].concat(Ol(y.slice(y.indexOf(w))),[w]).map(function(R){return e(R.data)});return p.some(function(R){return R.length===S.length&&R.every(function(B,I){return B===S[I]})})||(p.push(S),c(S)),1}x>w.depth&&(w.depth=x,m(w.out,[].concat(Ol(y),[w]),x+(w.skip?0:1)))},_=0,T=g.length;_<T;_++)v()}}var kbe=2,to=function(r,e){return e.onNeedsRedraw&&e.onNeedsRedraw()},A7=function(r,e){if(!e.isShadow){var i=mr(e.linkDirectionalParticles);e.graphData.links.forEach(function(n){var s=Math.round(Math.abs(i(n)));s?n.__photons=Ol(Array(s)).map(function(){return{}}):delete n.__photons})}},j_=gp({props:{graphData:{default:{nodes:[],links:[]},onChange:function(r,e){e.engineRunning=!1,A7(r,e)}},dagMode:{onChange:function(r,e){!r&&(e.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(r){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4,triggerUpdate:!1,onChange:to},nodeId:{default:"id"},nodeVal:{default:"val",triggerUpdate:!1,onChange:to},nodeColor:{default:"color",triggerUpdate:!1,onChange:to},nodeAutoColorBy:{},nodeCanvasObject:{triggerUpdate:!1,onChange:to},nodeCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:to},nodeVisibility:{default:!0,triggerUpdate:!1,onChange:to},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0,triggerUpdate:!1,onChange:to},linkColor:{default:"color",triggerUpdate:!1,onChange:to},linkAutoColorBy:{},linkLineDash:{triggerUpdate:!1,onChange:to},linkWidth:{default:1,triggerUpdate:!1,onChange:to},linkCurvature:{default:0,triggerUpdate:!1,onChange:to},linkCanvasObject:{triggerUpdate:!1,onChange:to},linkCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:to},linkDirectionalArrowLength:{default:0,triggerUpdate:!1,onChange:to},linkDirectionalArrowColor:{triggerUpdate:!1,onChange:to},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1,onChange:to},linkDirectionalParticles:{default:0,triggerUpdate:!1,onChange:A7},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:4,triggerUpdate:!1},linkDirectionalParticleColor:{triggerUpdate:!1},globalScale:{default:1,triggerUpdate:!1},d3AlphaMin:{default:0,triggerUpdate:!1},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(r,e){e.forceLayout.alphaDecay(r)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(r,e){e.forceLayout.alphaTarget(r)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(r,e){e.forceLayout.velocityDecay(r)}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1},onNeedsRedraw:{triggerUpdate:!1},isShadow:{default:!1,triggerUpdate:!1}},methods:{d3Force:function(r,e,i){return i===void 0?r.forceLayout.force(e):(r.forceLayout.force(e,i),this)},d3ReheatSimulation:function(r){return r.forceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(r){return r.cntTicks=0,r.startTickTime=new Date,r.engineRunning=!0,this},isEngineRunning:function(r){return!!r.engineRunning},tickFrame:function(r){return!r.isShadow&&e(),n(),!r.isShadow&&s(),!r.isShadow&&o(),i(),this;function e(){r.engineRunning&&(++r.cntTicks>r.cooldownTicks||new Date-r.startTickTime>r.cooldownTime||r.d3AlphaMin>0&&r.forceLayout.alpha()<r.d3AlphaMin?(r.engineRunning=!1,r.onEngineStop()):(r.forceLayout.tick(),r.onEngineTick()))}function i(){var l=mr(r.nodeVisibility),u=mr(r.nodeVal),c=mr(r.nodeColor),d=mr(r.nodeCanvasObjectMode),p=r.ctx,f=r.isShadow/r.globalScale,m=r.graphData.nodes.filter(l);p.save(),m.forEach(function(g){var y=d(g);if(r.nodeCanvasObject&&(y==="before"||y==="replace")&&(r.nodeCanvasObject(g,p,r.globalScale),y==="replace")){p.restore();return}var x=Math.sqrt(Math.max(0,u(g)||1))*r.nodeRelSize+f;p.beginPath(),p.arc(g.x,g.y,x,0,2*Math.PI,!1),p.fillStyle=c(g)||"rgba(31, 120, 180, 0.92)",p.fill(),r.nodeCanvasObject&&y==="after"&&r.nodeCanvasObject(g,r.ctx,r.globalScale)}),p.restore()}function n(){var l=mr(r.linkVisibility),u=mr(r.linkColor),c=mr(r.linkWidth),d=mr(r.linkLineDash),p=mr(r.linkCurvature),f=mr(r.linkCanvasObjectMode),m=r.ctx,g=r.isShadow*2,y=r.graphData.links.filter(l);y.forEach(R);var x=[],v=[],_=y;if(r.linkCanvasObject){var T=[],w=[];y.forEach(function(B){return({before:x,after:v,replace:T}[f(B)]||w).push(B)}),_=[].concat(Ol(x),v,w),x=x.concat(T)}m.save(),x.forEach(function(B){return r.linkCanvasObject(B,m,r.globalScale)}),m.restore();var S=gT(_,[u,c,d]);m.save(),Object.entries(S).forEach(function(B){var I=jy(B,2),D=I[0],L=I[1],O=!D||D==="undefined"?"rgba(0,0,0,0.15)":D;Object.entries(L).forEach(function(U){var J=jy(U,2),H=J[0],V=J[1],$=(H||1)/r.globalScale+g;Object.entries(V).forEach(function(Q){var G=jy(Q,2);G[0];var j=G[1],ie=d(j[0]);m.beginPath(),j.forEach(function(Y){var ae=Y.source,xe=Y.target;if(!(!ae||!xe||!ae.hasOwnProperty("x")||!xe.hasOwnProperty("x"))){m.moveTo(ae.x,ae.y);var fe=Y.__controlPoints;fe?m[fe.length===2?"quadraticCurveTo":"bezierCurveTo"].apply(m,Ol(fe).concat([xe.x,xe.y])):m.lineTo(xe.x,xe.y)}}),m.strokeStyle=O,m.lineWidth=$,m.setLineDash(ie||[]),m.stroke()})})}),m.restore(),m.save(),v.forEach(function(B){return r.linkCanvasObject(B,m,r.globalScale)}),m.restore();function R(B){var I=p(B);if(!I){B.__controlPoints=null;return}var D=B.source,L=B.target;if(!(!D||!L||!D.hasOwnProperty("x")||!L.hasOwnProperty("x"))){var O=Math.sqrt(Math.pow(L.x-D.x,2)+Math.pow(L.y-D.y,2));if(O>0){var U=Math.atan2(L.y-D.y,L.x-D.x),J=O*I,H={x:(D.x+L.x)/2+J*Math.cos(U-Math.PI/2),y:(D.y+L.y)/2+J*Math.sin(U-Math.PI/2)};B.__controlPoints=[H.x,H.y]}else{var V=I*70;B.__controlPoints=[L.x,L.y-V,L.x+V,L.y]}}}}function s(){var l=1.6,u=.2,c=mr(r.linkDirectionalArrowLength),d=mr(r.linkDirectionalArrowRelPos),p=mr(r.linkVisibility),f=mr(r.linkDirectionalArrowColor||r.linkColor),m=mr(r.nodeVal),g=r.ctx;g.save(),r.graphData.links.filter(p).forEach(function(y){var x=c(y);if(!(!x||x<0)){var v=y.source,_=y.target;if(!(!v||!_||!v.hasOwnProperty("x")||!_.hasOwnProperty("x"))){var T=Math.sqrt(Math.max(0,m(v)||1))*r.nodeRelSize,w=Math.sqrt(Math.max(0,m(_)||1))*r.nodeRelSize,S=Math.min(1,Math.max(0,d(y))),R=f(y)||"rgba(0,0,0,0.28)",B=x/l/2,I=y.__controlPoints&&d7(ms,[v.x,v.y].concat(Ol(y.__controlPoints),[_.x,_.y])),D=I?function($){return I.get($)}:function($){return{x:v.x+(_.x-v.x)*$||0,y:v.y+(_.y-v.y)*$||0}},L=I?I.length():Math.sqrt(Math.pow(_.x-v.x,2)+Math.pow(_.y-v.y,2)),O=T+x+(L-T-w-x)*S,U=D(O/L),J=D((O-x)/L),H=D((O-x*(1-u))/L),V=Math.atan2(U.y-J.y,U.x-J.x)-Math.PI/2;g.beginPath(),g.moveTo(U.x,U.y),g.lineTo(J.x+B*Math.cos(V),J.y+B*Math.sin(V)),g.lineTo(H.x,H.y),g.lineTo(J.x-B*Math.cos(V),J.y-B*Math.sin(V)),g.fillStyle=R,g.fill()}}}),g.restore()}function o(){var l=mr(r.linkDirectionalParticles),u=mr(r.linkDirectionalParticleSpeed),c=mr(r.linkDirectionalParticleWidth),d=mr(r.linkVisibility),p=mr(r.linkDirectionalParticleColor||r.linkColor),f=r.ctx;f.save(),r.graphData.links.filter(d).forEach(function(m){var g=l(m);if(!(!m.hasOwnProperty("__photons")||!m.__photons.length)){var y=m.source,x=m.target;if(!(!y||!x||!y.hasOwnProperty("x")||!x.hasOwnProperty("x"))){var v=u(m),_=m.__photons||[],T=Math.max(0,c(m)/2)/Math.sqrt(r.globalScale),w=p(m)||"rgba(0,0,0,0.28)";f.fillStyle=w;var S=m.__controlPoints?d7(ms,[y.x,y.y].concat(Ol(m.__controlPoints),[x.x,x.y])):null,R=0,B=!1;_.forEach(function(I){var D=!!I.__singleHop;if(I.hasOwnProperty("__progressRatio")||(I.__progressRatio=D?0:R/g),!D&&R++,I.__progressRatio+=v,I.__progressRatio>=1)if(!D)I.__progressRatio=I.__progressRatio%1;else{B=!0;return}var L=I.__progressRatio,O=S?S.get(L):{x:y.x+(x.x-y.x)*L||0,y:y.y+(x.y-y.y)*L||0};f.beginPath(),f.arc(O.x,O.y,T,0,2*Math.PI,!1),f.fill()}),B&&(m.__photons=m.__photons.filter(function(I){return!I.__singleHop||I.__progressRatio<=1}))}}}),f.restore()}},emitParticle:function(r,e){return e&&(!e.__photons&&(e.__photons=[]),e.__photons.push({__singleHop:!0})),this}},stateInit:function(){return{forceLayout:iF().force("link",q4()).force("charge",rF()).force("center",P4()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(r,e){e.ctx=r},update:function(r,e){r.engineRunning=!1,r.onUpdate(),r.nodeAutoColorBy!==null&&g7(r.graphData.nodes,mr(r.nodeAutoColorBy),r.nodeColor),r.linkAutoColorBy!==null&&g7(r.graphData.links,mr(r.linkAutoColorBy),r.linkColor),r.graphData.links.forEach(function(f){f.source=f[r.linkSource],f.target=f[r.linkTarget]}),r.forceLayout.stop().alpha(1).nodes(r.graphData.nodes);var i=r.forceLayout.force("link");i&&i.id(function(f){return f[r.nodeId]}).links(r.graphData.links);var n=r.dagMode&&Fbe(r.graphData,function(f){return f[r.nodeId]},{nodeFilter:r.dagNodeFilter,onLoopError:r.onDagError||void 0}),s=Math.max.apply(Math,Ol(Object.values(n||[]))),o=r.dagLevelDistance||r.graphData.nodes.length/(s||1)*kbe*(["radialin","radialout"].indexOf(r.dagMode)!==-1?.7:1);if(["lr","rl","td","bu"].includes(e.dagMode)){var l=["lr","rl"].includes(e.dagMode)?"fx":"fy";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(f){return delete f[l]})}if(["lr","rl","td","bu"].includes(r.dagMode)){var u=["rl","bu"].includes(r.dagMode),c=function(f){return(n[f[r.nodeId]]-s/2)*o*(u?-1:1)},d=["lr","rl"].includes(r.dagMode)?"fx":"fy";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(f){return f[d]=c(f)})}r.forceLayout.force("dagRadial",["radialin","radialout"].indexOf(r.dagMode)!==-1?nF(function(f){var m=n[f[r.nodeId]]||-1;return(r.dagMode==="radialin"?s-m:m)*o}).strength(function(f){return r.dagNodeFilter(f)?1:0}):null);for(var p=0;p<r.warmupTicks&&!(r.d3AlphaMin>0&&r.forceLayout.alpha()<r.d3AlphaMin);p++)r.forceLayout.tick();this.resetCountdown(),r.onFinishUpdate()}});function y7(r,e){var i=r instanceof Array?r:[r],n=new e;return n._destructor&&n._destructor(),{linkProp:function(s){return{default:n[s](),onChange:function(o,l){i.forEach(function(u){return l[u][s](o)})},triggerUpdate:!1}},linkMethod:function(s){return function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];var d=[];return i.forEach(function(p){var f=o[p],m=f[s].apply(f,u);m!==f&&d.push(m)}),d.length?d[0]:this}}}}var Ube=800,zbe=4,v7=y7("forceGraph",j_),jbe=y7(["forceGraph","shadowGraph"],j_),Vbe=Object.assign.apply(Object,Ol(["nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","dagMode","dagLevelDistance","dagNodeFilter","onDagError","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(r){return zy({},r,v7.linkProp(r))})).concat(Ol(["nodeRelSize","nodeId","nodeVal","nodeVisibility","linkSource","linkTarget","linkVisibility","linkCurvature"].map(function(r){return zy({},r,jbe.linkProp(r))})))),Gbe=Object.assign.apply(Object,Ol(["d3Force","d3ReheatSimulation","emitParticle"].map(function(r){return zy({},r,v7.linkMethod(r))})));function oI(r){if(r.canvas){var e=r.canvas.width,i=r.canvas.height;e===300&&i===150&&(e=i=0);var n=window.devicePixelRatio;e/=n,i/=n,[r.canvas,r.shadowCanvas].forEach(function(o){o.style.width="".concat(r.width,"px"),o.style.height="".concat(r.height,"px"),o.width=r.width*n,o.height=r.height*n,!e&&!i&&o.getContext("2d").scale(n,n)});var s=Wc(r.canvas).k;r.zoom.translateBy(r.zoom.__baseElem,(r.width-e)/2/s,(r.height-i)/2/s),r.needsRedraw=!0}}function x7(r){var e=window.devicePixelRatio;r.setTransform(e,0,0,e,0,0)}function b7(r,e,i){r.save(),x7(r),r.clearRect(0,0,e,i),r.restore()}var Hbe=gp({props:Pg({width:{default:window.innerWidth,onChange:function(r,e){return oI(e)},triggerUpdate:!1},height:{default:window.innerHeight,onChange:function(r,e){return oI(e)},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(r,e){[r.nodes,r.links].every(function(n){return(n||[]).every(function(s){return!s.hasOwnProperty("__indexColor")})})&&e.colorTracker.reset(),[{type:"Node",objs:r.nodes},{type:"Link",objs:r.links}].forEach(i),e.forceGraph.graphData(r),e.shadowGraph.graphData(r);function i(n){var s=n.type,o=n.objs;o.filter(function(l){if(!l.hasOwnProperty("__indexColor"))return!0;var u=e.colorTracker.lookup(l.__indexColor);return!u||!u.hasOwnProperty("d")||u.d!==l}).forEach(function(l){l.__indexColor=e.colorTracker.register({type:s,d:l})})}},triggerUpdate:!1},backgroundColor:{onChange:function(r,e){e.canvas&&r&&(e.canvas.style.background=r)},triggerUpdate:!1},nodeLabel:{default:"name",triggerUpdate:!1},nodePointerAreaPaint:{onChange:function(r,e){e.shadowGraph.nodeCanvasObject(r?function(i,n,s){return r(i,i.__indexColor,n,s)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkPointerAreaPaint:{onChange:function(r,e){e.shadowGraph.linkCanvasObject(r?function(i,n,s){return r(i,i.__indexColor,n,s)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:4,triggerUpdate:!1},minZoom:{default:.01,onChange:function(r,e){e.zoom.scaleExtent([r,e.zoom.scaleExtent()[1]])},triggerUpdate:!1},maxZoom:{default:1e3,onChange:function(r,e){e.zoom.scaleExtent([e.zoom.scaleExtent()[0],r])},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},enableZoomInteraction:{default:!0,triggerUpdate:!1},enablePanInteraction:{default:!0,triggerUpdate:!1},enableZoomPanInteraction:{default:!0,triggerUpdate:!1},enablePointerInteraction:{default:!0,onChange:function(r,e){e.hoverObj=null},triggerUpdate:!1},autoPauseRedraw:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},onZoom:{triggerUpdate:!1},onZoomEnd:{triggerUpdate:!1},onRenderFramePre:{triggerUpdate:!1},onRenderFramePost:{triggerUpdate:!1}},Vbe),aliases:{stopAnimation:"pauseAnimation"},methods:Pg({graph2ScreenCoords:function(r,e,i){var n=Wc(r.canvas);return{x:e*n.k+n.x,y:i*n.k+n.y}},screen2GraphCoords:function(r,e,i){var n=Wc(r.canvas);return{x:(e-n.x)/n.k,y:(i-n.y)/n.k}},centerAt:function(r,e,i,n){if(!r.canvas)return null;if(e!==void 0||i!==void 0){var s=Object.assign({},e!==void 0?{x:e}:{},i!==void 0?{y:i}:{});return n?r.tweenGroup.add(new M_(o()).to(s,n).easing(th.Quadratic.Out).onUpdate(l).start()):l(s),this}return o();function o(){var u=Wc(r.canvas);return{x:(r.width/2-u.x)/u.k,y:(r.height/2-u.y)/u.k}}function l(u){var c=u.x,d=u.y;r.zoom.translateTo(r.zoom.__baseElem,c===void 0?o().x:c,d===void 0?o().y:d),r.needsRedraw=!0}},zoom:function(r,e,i){if(!r.canvas)return null;if(e!==void 0)return i?r.tweenGroup.add(new M_({k:n()}).to({k:e},i).easing(th.Quadratic.Out).onUpdate(function(o){var l=o.k;return s(l)}).start()):s(e),this;return n();function n(){return Wc(r.canvas).k}function s(o){r.zoom.scaleTo(r.zoom.__baseElem,o),r.needsRedraw=!0}},zoomToFit:function(r){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,n=arguments.length,s=new Array(n>3?n-3:0),o=3;o<n;o++)s[o-3]=arguments[o];var l=this.getGraphBbox.apply(this,s);if(l){var u={x:(l.x[0]+l.x[1])/2,y:(l.y[0]+l.y[1])/2},c=Math.max(1e-12,Math.min(1e12,(r.width-i*2)/(l.x[1]-l.x[0]),(r.height-i*2)/(l.y[1]-l.y[0])));this.centerAt(u.x,u.y,e),this.zoom(c,e)}return this},getGraphBbox:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=mr(r.nodeVal),n=function(o){return Math.sqrt(Math.max(0,i(o)||1))*r.nodeRelSize},s=r.graphData.nodes.filter(e).map(function(o){return{x:o.x,y:o.y,r:n(o)}});return s.length?{x:[fT(s,function(o){return o.x-o.r}),pT(s,function(o){return o.x+o.r})],y:[fT(s,function(o){return o.y-o.r}),pT(s,function(o){return o.y+o.r})]}:null},pauseAnimation:function(r){return r.animationFrameRequestId&&(cancelAnimationFrame(r.animationFrameRequestId),r.animationFrameRequestId=null),this},resumeAnimation:function(r){return r.animationFrameRequestId||this._animationCycle(),this},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Gbe),stateInit:function(){return{lastSetZoom:1,zoom:tbe(),forceGraph:new j_,shadowGraph:new j_().cooldownTicks(0).nodeColor("__indexColor").linkColor("__indexColor").isShadow(!0),colorTracker:new ybe,tweenGroup:new UR}},init:function(r,e){var i=this;r.innerHTML="";var n=document.createElement("div");n.classList.add("force-graph-container"),n.style.position="relative",r.appendChild(n),e.canvas=document.createElement("canvas"),e.backgroundColor&&(e.canvas.style.background=e.backgroundColor),n.appendChild(e.canvas),e.shadowCanvas=document.createElement("canvas");var s=e.canvas.getContext("2d"),o=e.shadowCanvas.getContext("2d",{willReadFrequently:!0}),l={x:-1e12,y:-1e12},u=function(){var p=null,f=window.devicePixelRatio,m=l.x>0&&l.y>0?o.getImageData(l.x*f,l.y*f,1,1):null;return m&&(p=e.colorTracker.lookup(m.data)),p};vc(e.canvas).call(jve().subject(function(){if(!e.enableNodeDrag)return null;var p=u();return p&&p.type==="Node"?p.d:null}).on("start",function(p){var f=p.subject;f.__initialDragPos={x:f.x,y:f.y,fx:f.fx,fy:f.fy},p.active||(f.fx=f.x,f.fy=f.y),e.canvas.classList.add("grabbable")}).on("drag",function(p){var f=p.subject,m=f.__initialDragPos,g=p,y=Wc(e.canvas).k,x={x:m.x+(g.x-m.x)/y-f.x,y:m.y+(g.y-m.y)/y-f.y};["x","y"].forEach(function(v){return f["f".concat(v)]=f[v]=m[v]+(g[v]-m[v])/y}),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),e.isPointerDragging=!0,f.__dragged=!0,e.onNodeDrag(f,x)}).on("end",function(p){var f=p.subject,m=f.__initialDragPos,g={x:f.x-m.x,y:f.y-m.y};m.fx===void 0&&(f.fx=void 0),m.fy===void 0&&(f.fy=void 0),delete f.__initialDragPos,e.forceGraph.d3AlphaTarget()&&e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.canvas.classList.remove("grabbable"),e.isPointerDragging=!1,f.__dragged&&(delete f.__dragged,e.onNodeDragEnd(f,g))})),e.zoom(e.zoom.__baseElem=vc(e.canvas)),e.zoom.__baseElem.on("dblclick.zoom",null),e.zoom.filter(function(p){return!p.button&&e.enableZoomPanInteraction&&(p.type!=="wheel"||mr(e.enableZoomInteraction)(p))&&(p.type==="wheel"||mr(e.enablePanInteraction)(p))}).on("zoom",function(p){var f=p.transform;[s,o].forEach(function(m){x7(m),m.translate(f.x,f.y),m.scale(f.k,f.k)}),e.onZoom&&e.onZoom(Pg(Pg({},f),i.centerAt())),e.needsRedraw=!0}).on("end",function(p){return e.onZoomEnd&&e.onZoomEnd(Pg(Pg({},p.transform),i.centerAt()))}),oI(e),e.forceGraph.onNeedsRedraw(function(){return e.needsRedraw=!0}).onFinishUpdate(function(){Wc(e.canvas).k===e.lastSetZoom&&e.graphData.nodes.length&&(e.zoom.scaleTo(e.zoom.__baseElem,e.lastSetZoom=zbe/Math.cbrt(e.graphData.nodes.length)),e.needsRedraw=!0)});var c=document.createElement("div");c.classList.add("graph-tooltip"),n.appendChild(c),["pointermove","pointerdown"].forEach(function(p){return n.addEventListener(p,function(f){p==="pointerdown"&&(e.isPointerPressed=!0,e.pointerDownEvent=f),!e.isPointerDragging&&f.type==="pointermove"&&e.onBackgroundClick&&(f.pressure>0||e.isPointerPressed)&&(f.pointerType!=="touch"||f.movementX===void 0||[f.movementX,f.movementY].some(function(y){return Math.abs(y)>1}))&&(e.isPointerDragging=!0);var m=g(n);l.x=f.pageX-m.left,l.y=f.pageY-m.top,c.style.top="".concat(l.y,"px"),c.style.left="".concat(l.x,"px"),c.style.transform="translate(-".concat(l.x/e.width*100,"%, ").concat(e.height-l.y<100?"calc(-100% - 8px)":"21px",")");function g(y){var x=y.getBoundingClientRect(),v=window.pageXOffset||document.documentElement.scrollLeft,_=window.pageYOffset||document.documentElement.scrollTop;return{top:x.top+_,left:x.left+v}}},{passive:!0})}),n.addEventListener("pointerup",function(p){if(e.isPointerPressed=!1,e.isPointerDragging){e.isPointerDragging=!1;return}var f=[p,e.pointerDownEvent];requestAnimationFrame(function(){if(p.button===0)if(e.hoverObj){var m=e["on".concat(e.hoverObj.type,"Click")];m&&m.apply(void 0,[e.hoverObj.d].concat(f))}else e.onBackgroundClick&&e.onBackgroundClick.apply(e,f);if(p.button===2)if(e.hoverObj){var g=e["on".concat(e.hoverObj.type,"RightClick")];g&&g.apply(void 0,[e.hoverObj.d].concat(f))}else e.onBackgroundRightClick&&e.onBackgroundRightClick.apply(e,f)})},{passive:!0}),n.addEventListener("contextmenu",function(p){return!e.onBackgroundRightClick&&!e.onNodeRightClick&&!e.onLinkRightClick?!0:(p.preventDefault(),!1)}),e.forceGraph(s),e.shadowGraph(o);var d=rbe(function(){b7(o,e.width,e.height),e.shadowGraph.linkWidth(function(f){return mr(e.linkWidth)(f)+e.linkHoverPrecision});var p=Wc(e.canvas);e.shadowGraph.globalScale(p.k).tickFrame()},Ube);e.flushShadowCanvas=d.flush,(this._animationCycle=function p(){var f=!e.autoPauseRedraw||!!e.needsRedraw||e.forceGraph.isEngineRunning()||e.graphData.links.some(function(S){return S.__photons&&S.__photons.length});if(e.needsRedraw=!1,e.enablePointerInteraction){var m=e.isPointerDragging?null:u();if(m!==e.hoverObj){var g=e.hoverObj,y=g?g.type:null,x=m?m.type:null;if(y&&y!==x){var v=e["on".concat(y,"Hover")];v&&v(null,g.d)}if(x){var _=e["on".concat(x,"Hover")];_&&_(m.d,y===x?g.d:null)}var T=m&&mr(e["".concat(m.type.toLowerCase(),"Label")])(m.d)||"";c.style.visibility=T?"visible":"hidden",c.innerHTML=T,e.canvas.classList[m&&e["on".concat(x,"Click")]||!m&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=m}f&&d()}if(f){b7(s,e.width,e.height);var w=Wc(e.canvas).k;e.onRenderFramePre&&e.onRenderFramePre(s,w),e.forceGraph.globalScale(w).tickFrame(),e.onRenderFramePost&&e.onRenderFramePost(s,w)}e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(p)})()},update:function(r){}}),V_={width:xt.number,height:xt.number,graphData:xt.shape({nodes:xt.arrayOf(xt.object).isRequired,links:xt.arrayOf(xt.object).isRequired}),backgroundColor:xt.string,nodeRelSize:xt.number,nodeId:xt.string,nodeLabel:xt.oneOfType([xt.string,xt.func]),nodeVal:xt.oneOfType([xt.number,xt.string,xt.func]),nodeVisibility:xt.oneOfType([xt.bool,xt.string,xt.func]),nodeColor:xt.oneOfType([xt.string,xt.func]),nodeAutoColorBy:xt.oneOfType([xt.string,xt.func]),onNodeHover:xt.func,onNodeClick:xt.func,linkSource:xt.string,linkTarget:xt.string,linkLabel:xt.oneOfType([xt.string,xt.func]),linkVisibility:xt.oneOfType([xt.bool,xt.string,xt.func]),linkColor:xt.oneOfType([xt.string,xt.func]),linkAutoColorBy:xt.oneOfType([xt.string,xt.func]),linkWidth:xt.oneOfType([xt.number,xt.string,xt.func]),linkCurvature:xt.oneOfType([xt.number,xt.string,xt.func]),linkDirectionalArrowLength:xt.oneOfType([xt.number,xt.string,xt.func]),linkDirectionalArrowColor:xt.oneOfType([xt.string,xt.func]),linkDirectionalArrowRelPos:xt.oneOfType([xt.number,xt.string,xt.func]),linkDirectionalParticles:xt.oneOfType([xt.number,xt.string,xt.func]),linkDirectionalParticleSpeed:xt.oneOfType([xt.number,xt.string,xt.func]),linkDirectionalParticleWidth:xt.oneOfType([xt.number,xt.string,xt.func]),linkDirectionalParticleColor:xt.oneOfType([xt.string,xt.func]),onLinkHover:xt.func,onLinkClick:xt.func,dagMode:xt.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:xt.number,dagNodeFilter:xt.func,onDagError:xt.func,d3AlphaMin:xt.number,d3AlphaDecay:xt.number,d3VelocityDecay:xt.number,warmupTicks:xt.number,cooldownTicks:xt.number,cooldownTime:xt.number,onEngineTick:xt.func,onEngineStop:xt.func,getGraphBbox:xt.func},_7={zoomToFit:xt.func,onNodeRightClick:xt.func,onNodeDrag:xt.func,onNodeDragEnd:xt.func,onLinkRightClick:xt.func,linkHoverPrecision:xt.number,onBackgroundClick:xt.func,onBackgroundRightClick:xt.func,enablePointerInteraction:xt.bool,enableNodeDrag:xt.bool},lI={showNavInfo:xt.bool,nodeOpacity:xt.number,nodeResolution:xt.number,nodeThreeObject:xt.oneOfType([xt.object,xt.string,xt.func]),nodeThreeObjectExtend:xt.oneOfType([xt.bool,xt.string,xt.func]),linkOpacity:xt.number,linkResolution:xt.number,linkCurveRotation:xt.oneOfType([xt.number,xt.string,xt.func]),linkMaterial:xt.oneOfType([xt.object,xt.string,xt.func]),linkThreeObject:xt.oneOfType([xt.object,xt.string,xt.func]),linkThreeObjectExtend:xt.oneOfType([xt.bool,xt.string,xt.func]),linkPositionUpdate:xt.func,linkDirectionalArrowResolution:xt.number,linkDirectionalParticleResolution:xt.number,forceEngine:xt.oneOf(["d3","ngraph"]),ngraphPhysics:xt.object,numDimensions:xt.oneOf([1,2,3])},Wbe=Object.assign({},V_,_7,{linkLineDash:xt.oneOfType([xt.arrayOf(xt.number),xt.string,xt.func]),nodeCanvasObjectMode:xt.oneOfType([xt.string,xt.func]),nodeCanvasObject:xt.func,nodePointerAreaPaint:xt.func,linkCanvasObjectMode:xt.oneOfType([xt.string,xt.func]),linkCanvasObject:xt.func,linkPointerAreaPaint:xt.func,autoPauseRedraw:xt.bool,minZoom:xt.number,maxZoom:xt.number,enableZoomInteraction:xt.oneOfType([xt.bool,xt.func]),enablePanInteraction:xt.oneOfType([xt.bool,xt.func]),onZoom:xt.func,onZoomEnd:xt.func,onRenderFramePre:xt.func,onRenderFramePost:xt.func}),Qbe=Object.assign({},V_,_7,lI,{enableNavigationControls:xt.bool,controlType:xt.oneOf(["trackball","orbit","fly"]),rendererConfig:xt.object,extraRenderers:xt.arrayOf(xt.shape({render:xt.func.isRequired}))}),qbe=Object.assign({},V_,lI,{nodeDesc:xt.oneOfType([xt.string,xt.func]),linkDesc:xt.oneOfType([xt.string,xt.func])}),Xbe=Object.assign({},V_,lI,{markerAttrs:xt.object,yOffset:xt.number,glScale:xt.number});const E7=Yv(Dk,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"]});E7.displayName="ForceGraphVR",E7.propTypes=qbe;const w7=Yv(Goe,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"],initPropNames:["markerAttrs"]});w7.displayName="ForceGraphAR",w7.propTypes=Xbe;const cI=Yv(iye,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});cI.displayName="ForceGraph3D",cI.propTypes=Qbe;const uI=Yv(Hbe,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","centerAt","zoom","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords"]});uI.displayName="ForceGraph2D",uI.propTypes=Wbe;function hI(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function Ybe(r){if(Array.isArray(r))return r}function Kbe(r){if(Array.isArray(r))return hI(r)}function Jbe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Zbe(r,e,i){return e=G_(e),o1e(r,C7()?Reflect.construct(e,i||[],G_(r).constructor):e.apply(r,i))}function $be(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function e1e(r,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,c1e(n.key),n)}}function t1e(r,e,i){return e&&e1e(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function G_(r){return G_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G_(r)}function i1e(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&dI(r,e)}function C7(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(C7=function(){return!!r})()}function r1e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function n1e(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,d=!1;try{if(o=(i=i.call(r)).next,e===0){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){d=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw s}}return u}}function s1e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a1e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o1e(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jbe(r)}function dI(r,e){return dI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},dI(r,e)}function S7(r,e){return Ybe(r)||n1e(r,e)||T7(r,e)||s1e()}function H_(r){return Kbe(r)||r1e(r)||T7(r)||a1e()}function l1e(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function c1e(r){var e=l1e(r,"string");return typeof e=="symbol"?e:e+""}function T7(r,e){if(r){if(typeof r=="string")return hI(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?hI(r,e):void 0}}var Vy=typeof window<"u"&&window.THREE?window.THREE:{CanvasTexture:Cte,Sprite:wte,SpriteMaterial:m4,SRGBColorSpace:Do},u1e=function(r){function e(){var i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"rgba(255, 255, 255, 1)";return $be(this,e),i=Zbe(this,e,[new Vy.SpriteMaterial]),i._text="".concat(n),i._textHeight=s,i._color=o,i._backgroundColor=!1,i._padding=0,i._borderWidth=0,i._borderRadius=0,i._borderColor="white",i._strokeWidth=0,i._strokeColor="white",i._fontFace="system-ui",i._fontSize=90,i._fontWeight="normal",i._canvas=document.createElement("canvas"),i._genCanvas(),i}return i1e(e,r),t1e(e,[{key:"text",get:function(){return this._text},set:function(i){this._text=i,this._genCanvas()}},{key:"textHeight",get:function(){return this._textHeight},set:function(i){this._textHeight=i,this._genCanvas()}},{key:"color",get:function(){return this._color},set:function(i){this._color=i,this._genCanvas()}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(i){this._backgroundColor=i,this._genCanvas()}},{key:"padding",get:function(){return this._padding},set:function(i){this._padding=i,this._genCanvas()}},{key:"borderWidth",get:function(){return this._borderWidth},set:function(i){this._borderWidth=i,this._genCanvas()}},{key:"borderRadius",get:function(){return this._borderRadius},set:function(i){this._borderRadius=i,this._genCanvas()}},{key:"borderColor",get:function(){return this._borderColor},set:function(i){this._borderColor=i,this._genCanvas()}},{key:"fontFace",get:function(){return this._fontFace},set:function(i){this._fontFace=i,this._genCanvas()}},{key:"fontSize",get:function(){return this._fontSize},set:function(i){this._fontSize=i,this._genCanvas()}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(i){this._fontWeight=i,this._genCanvas()}},{key:"strokeWidth",get:function(){return this._strokeWidth},set:function(i){this._strokeWidth=i,this._genCanvas()}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(i){this._strokeColor=i,this._genCanvas()}},{key:"_genCanvas",value:function(){var i=this,n=this._canvas,s=n.getContext("2d"),o=1/this.textHeight,l=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],u=l.map(function(I){return I*i.fontSize*o}),c=Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius],d=c.map(function(I){return I*i.fontSize*o}),p=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],f=p.map(function(I){return I*i.fontSize*o}),m=this.text.split(`
`),g="".concat(this.fontWeight," ").concat(this.fontSize,"px ").concat(this.fontFace);s.font=g;var y=Math.max.apply(Math,H_(m.map(function(I){return s.measureText(I).width}))),x=this.fontSize*m.length;if(n.width=y+u[0]*2+f[0]*2,n.height=x+u[1]*2+f[1]*2,this.borderWidth){if(s.strokeStyle=this.borderColor,u[0]){var v=u[0]/2;s.lineWidth=u[0],s.beginPath(),s.moveTo(v,d[0]),s.lineTo(v,n.height-d[3]),s.moveTo(n.width-v,d[1]),s.lineTo(n.width-v,n.height-d[2]),s.stroke()}if(u[1]){var _=u[1]/2;s.lineWidth=u[1],s.beginPath(),s.moveTo(Math.max(u[0],d[0]),_),s.lineTo(n.width-Math.max(u[0],d[1]),_),s.moveTo(Math.max(u[0],d[3]),n.height-_),s.lineTo(n.width-Math.max(u[0],d[2]),n.height-_),s.stroke()}if(this.borderRadius){var T=Math.max.apply(Math,H_(u)),w=T/2;s.lineWidth=T,s.beginPath(),[!!d[0]&&[d[0],w,w,d[0]],!!d[1]&&[n.width-d[1],n.width-w,w,d[1]],!!d[2]&&[n.width-d[2],n.width-w,n.height-w,n.height-d[2]],!!d[3]&&[d[3],w,n.height-w,n.height-d[3]]].filter(function(I){return I}).forEach(function(I){var D=S7(I,4),L=D[0],O=D[1],U=D[2],J=D[3];s.moveTo(L,U),s.quadraticCurveTo(O,U,O,J)}),s.stroke()}}this.backgroundColor&&(s.fillStyle=this.backgroundColor,this.borderRadius?(s.beginPath(),s.moveTo(u[0],d[0]),[[u[0],d[0],n.width-d[1],u[1],u[1],u[1]],[n.width-u[0],n.width-u[0],n.width-u[0],u[1],d[1],n.height-d[2]],[n.width-u[0],n.width-d[2],d[3],n.height-u[1],n.height-u[1],n.height-u[1]],[u[0],u[0],u[0],n.height-u[1],n.height-d[3],d[0]]].forEach(function(I){var D=S7(I,6),L=D[0],O=D[1],U=D[2],J=D[3],H=D[4],V=D[5];s.quadraticCurveTo(L,J,O,H),s.lineTo(U,V)}),s.closePath(),s.fill()):s.fillRect(u[0],u[1],n.width-u[0]*2,n.height-u[1]*2)),s.translate.apply(s,H_(u)),s.translate.apply(s,H_(f)),s.font=g,s.fillStyle=this.color,s.textBaseline="bottom";var S=this.strokeWidth>0;S&&(s.lineWidth=this.strokeWidth*this.fontSize/10,s.strokeStyle=this.strokeColor),m.forEach(function(I,D){var L=(y-s.measureText(I).width)/2,O=(D+1)*i.fontSize;S&&s.strokeText(I,L,O),s.fillText(I,L,O)}),this.material.map&&this.material.map.dispose();var R=this.material.map=new Vy.CanvasTexture(n);R.colorSpace=Vy.SRGBColorSpace;var B=this.textHeight*m.length+l[1]*2+p[1]*2;this.scale.set(B*n.width/n.height,B,0)}},{key:"clone",value:function(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}},{key:"copy",value:function(i){return Vy.Sprite.prototype.copy.call(this,i),this.color=i.color,this.backgroundColor=i.backgroundColor,this.padding=i.padding,this.borderWidth=i.borderWidth,this.borderColor=i.borderColor,this.fontFace=i.fontFace,this.fontSize=i.fontSize,this.fontWeight=i.fontWeight,this.strokeWidth=i.strokeWidth,this.strokeColor=i.strokeColor,this}}])}(Vy.Sprite);class Fg extends Error{constructor(e,i){const n=`${Fg.extractMessage(e)}: ${JSON.stringify({response:e,request:i})}`;super(n),N0(this,"response"),N0(this,"request"),Object.setPrototypeOf(this,Fg.prototype),this.response=e,this.request=i,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Fg)}static extractMessage(e){var i,n;return((n=(i=e.errors)==null?void 0:i[0])==null?void 0:n.message)??`GraphQL Error (Code: ${String(e.status)})`}}const M7=r=>r.toUpperCase(),pI=r=>typeof r=="function"?r():r,R7=(r,e)=>r.map((i,n)=>[i,e[n]]),kg=r=>{let e={};return r instanceof Headers?e=h1e(r):Array.isArray(r)?r.forEach(([i,n])=>{i&&n!==void 0&&(e[i]=n)}):r&&(e=r),e},h1e=r=>{const e={};return r.forEach((i,n)=>{e[n]=i}),e},d1e=r=>{try{const e=r();return p1e(e)?e.catch(i=>I7(i)):e}catch(e){return I7(e)}},I7=r=>r instanceof Error?r:new Error(String(r)),p1e=r=>typeof r=="object"&&r!==null&&"then"in r&&typeof r.then=="function"&&"catch"in r&&typeof r.catch=="function"&&"finally"in r&&typeof r.finally=="function",fI=r=>{throw new Error(`Unhandled case: ${String(r)}`)},W_=r=>typeof r=="object"&&r!==null&&!Array.isArray(r),f1e=(r,e)=>r.documents?r:{documents:r,requestHeaders:e,signal:void 0},m1e=(r,e,i)=>r.query?r:{query:r,variables:e,requestHeaders:i,signal:void 0};function Q_(r,e){throw new Error(e)}function g1e(r){return typeof r=="object"&&r!==null}function A1e(r,e){throw new Error("Unexpected invariant triggered.")}const y1e=/\r\n|[\n\r]/g;function mI(r,e){let i=0,n=1;for(const s of r.body.matchAll(y1e)){if(typeof s.index=="number"||A1e(),s.index>=e)break;i=s.index+s[0].length,n+=1}return{line:n,column:e+1-i}}function v1e(r){return B7(r.source,mI(r.source,r.start))}function B7(r,e){const i=r.locationOffset.column-1,n="".padStart(i)+r.body,s=e.line-1,o=r.locationOffset.line-1,l=e.line+o,u=e.line===1?i:0,c=e.column+u,d=`${r.name}:${l}:${c}
`,p=n.split(/\r\n|[\n\r]/g),f=p[s];if(f.length>120){const m=Math.floor(c/80),g=c%80,y=[];for(let x=0;x<f.length;x+=80)y.push(f.slice(x,x+80));return d+N7([[`${l} |`,y[0]],...y.slice(1,m+1).map(x=>["|",x]),["|","^".padStart(g)],["|",y[m+1]]])}return d+N7([[`${l-1} |`,p[s-1]],[`${l} |`,f],["|","^".padStart(c)],[`${l+1} |`,p[s+1]]])}function N7(r){const e=r.filter(([n,s])=>s!==void 0),i=Math.max(...e.map(([n])=>n.length));return e.map(([n,s])=>n.padStart(i)+(s?" "+s:"")).join(`
`)}function x1e(r){const e=r[0];return e==null||"kind"in e||"length"in e?{nodes:e,source:r[1],positions:r[2],path:r[3],originalError:r[4],extensions:r[5]}:e}class gI extends Error{constructor(e,...i){var n,s,o;const{nodes:l,source:u,positions:c,path:d,originalError:p,extensions:f}=x1e(i);super(e),this.name="GraphQLError",this.path=d??void 0,this.originalError=p??void 0,this.nodes=L7(Array.isArray(l)?l:l?[l]:void 0);const m=L7((n=this.nodes)===null||n===void 0?void 0:n.map(y=>y.loc).filter(y=>y!=null));this.source=u??(m==null||(s=m[0])===null||s===void 0?void 0:s.source),this.positions=c??(m==null?void 0:m.map(y=>y.start)),this.locations=c&&u?c.map(y=>mI(u,y)):m==null?void 0:m.map(y=>mI(y.source,y.start));const g=g1e(p==null?void 0:p.extensions)?p==null?void 0:p.extensions:void 0;this.extensions=(o=f??g)!==null&&o!==void 0?o:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),p!=null&&p.stack?Object.defineProperty(this,"stack",{value:p.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,gI):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let e=this.message;if(this.nodes)for(const i of this.nodes)i.loc&&(e+=`

`+v1e(i.loc));else if(this.source&&this.locations)for(const i of this.locations)e+=`

`+B7(this.source,i);return e}toJSON(){const e={message:this.message};return this.locations!=null&&(e.locations=this.locations),this.path!=null&&(e.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(e.extensions=this.extensions),e}}function L7(r){return r===void 0||r.length===0?void 0:r}function Ca(r,e,i){return new gI(`Syntax Error: ${i}`,{source:r,positions:[e]})}class b1e{constructor(e,i,n){this.start=e.start,this.end=i.end,this.startToken=e,this.endToken=i,this.source=n}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class D7{constructor(e,i,n,s,o,l){this.kind=e,this.start=i,this.end=n,this.line=s,this.column=o,this.value=l,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const O7={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},_1e=new Set(Object.keys(O7));function P7(r){const e=r==null?void 0:r.kind;return typeof e=="string"&&_1e.has(e)}var qp;(function(r){r.QUERY="query",r.MUTATION="mutation",r.SUBSCRIPTION="subscription"})(qp||(qp={}));var AI;(function(r){r.QUERY="QUERY",r.MUTATION="MUTATION",r.SUBSCRIPTION="SUBSCRIPTION",r.FIELD="FIELD",r.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",r.FRAGMENT_SPREAD="FRAGMENT_SPREAD",r.INLINE_FRAGMENT="INLINE_FRAGMENT",r.VARIABLE_DEFINITION="VARIABLE_DEFINITION",r.SCHEMA="SCHEMA",r.SCALAR="SCALAR",r.OBJECT="OBJECT",r.FIELD_DEFINITION="FIELD_DEFINITION",r.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",r.INTERFACE="INTERFACE",r.UNION="UNION",r.ENUM="ENUM",r.ENUM_VALUE="ENUM_VALUE",r.INPUT_OBJECT="INPUT_OBJECT",r.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"})(AI||(AI={}));var Or;(function(r){r.NAME="Name",r.DOCUMENT="Document",r.OPERATION_DEFINITION="OperationDefinition",r.VARIABLE_DEFINITION="VariableDefinition",r.SELECTION_SET="SelectionSet",r.FIELD="Field",r.ARGUMENT="Argument",r.FRAGMENT_SPREAD="FragmentSpread",r.INLINE_FRAGMENT="InlineFragment",r.FRAGMENT_DEFINITION="FragmentDefinition",r.VARIABLE="Variable",r.INT="IntValue",r.FLOAT="FloatValue",r.STRING="StringValue",r.BOOLEAN="BooleanValue",r.NULL="NullValue",r.ENUM="EnumValue",r.LIST="ListValue",r.OBJECT="ObjectValue",r.OBJECT_FIELD="ObjectField",r.DIRECTIVE="Directive",r.NAMED_TYPE="NamedType",r.LIST_TYPE="ListType",r.NON_NULL_TYPE="NonNullType",r.SCHEMA_DEFINITION="SchemaDefinition",r.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",r.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",r.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",r.FIELD_DEFINITION="FieldDefinition",r.INPUT_VALUE_DEFINITION="InputValueDefinition",r.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",r.UNION_TYPE_DEFINITION="UnionTypeDefinition",r.ENUM_TYPE_DEFINITION="EnumTypeDefinition",r.ENUM_VALUE_DEFINITION="EnumValueDefinition",r.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",r.DIRECTIVE_DEFINITION="DirectiveDefinition",r.SCHEMA_EXTENSION="SchemaExtension",r.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",r.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",r.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",r.UNION_TYPE_EXTENSION="UnionTypeExtension",r.ENUM_TYPE_EXTENSION="EnumTypeExtension",r.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"})(Or||(Or={}));function yI(r){return r===9||r===32}function Gy(r){return r>=48&&r<=57}function F7(r){return r>=97&&r<=122||r>=65&&r<=90}function k7(r){return F7(r)||r===95}function E1e(r){return F7(r)||Gy(r)||r===95}function w1e(r){var e;let i=Number.MAX_SAFE_INTEGER,n=null,s=-1;for(let l=0;l<r.length;++l){var o;const u=r[l],c=C1e(u);c!==u.length&&(n=(o=n)!==null&&o!==void 0?o:l,s=l,l!==0&&c<i&&(i=c))}return r.map((l,u)=>u===0?l:l.slice(i)).slice((e=n)!==null&&e!==void 0?e:0,s+1)}function C1e(r){let e=0;for(;e<r.length&&yI(r.charCodeAt(e));)++e;return e}function S1e(r,e){const i=r.replace(/"""/g,'\\"""'),n=i.split(/\r\n|[\n\r]/g),s=n.length===1,o=n.length>1&&n.slice(1).every(g=>g.length===0||yI(g.charCodeAt(0))),l=i.endsWith('\\"""'),u=r.endsWith('"')&&!l,c=r.endsWith("\\"),d=u||c,p=!s||r.length>70||d||o||l;let f="";const m=s&&yI(r.charCodeAt(0));return(p&&!m||o)&&(f+=`
`),f+=i,(p||d)&&(f+=`
`),'"""'+f+'"""'}var ri;(function(r){r.SOF="<SOF>",r.EOF="<EOF>",r.BANG="!",r.DOLLAR="$",r.AMP="&",r.PAREN_L="(",r.PAREN_R=")",r.SPREAD="...",r.COLON=":",r.EQUALS="=",r.AT="@",r.BRACKET_L="[",r.BRACKET_R="]",r.BRACE_L="{",r.PIPE="|",r.BRACE_R="}",r.NAME="Name",r.INT="Int",r.FLOAT="Float",r.STRING="String",r.BLOCK_STRING="BlockString",r.COMMENT="Comment"})(ri||(ri={}));class T1e{constructor(e){const i=new D7(ri.SOF,0,0,0,0);this.source=e,this.lastToken=i,this.token=i,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){return this.lastToken=this.token,this.token=this.lookahead()}lookahead(){let e=this.token;if(e.kind!==ri.EOF)do if(e.next)e=e.next;else{const i=R1e(this,e.end);e.next=i,i.prev=e,e=i}while(e.kind===ri.COMMENT);return e}}function M1e(r){return r===ri.BANG||r===ri.DOLLAR||r===ri.AMP||r===ri.PAREN_L||r===ri.PAREN_R||r===ri.SPREAD||r===ri.COLON||r===ri.EQUALS||r===ri.AT||r===ri.BRACKET_L||r===ri.BRACKET_R||r===ri.BRACE_L||r===ri.PIPE||r===ri.BRACE_R}function Ug(r){return r>=0&&r<=55295||r>=57344&&r<=1114111}function q_(r,e){return U7(r.charCodeAt(e))&&z7(r.charCodeAt(e+1))}function U7(r){return r>=55296&&r<=56319}function z7(r){return r>=56320&&r<=57343}function Xp(r,e){const i=r.source.body.codePointAt(e);if(i===void 0)return ri.EOF;if(i>=32&&i<=126){const n=String.fromCodePoint(i);return n==='"'?`'"'`:`"${n}"`}return"U+"+i.toString(16).toUpperCase().padStart(4,"0")}function ra(r,e,i,n,s){const o=r.line,l=1+i-r.lineStart;return new D7(e,i,n,o,l,s)}function R1e(r,e){const i=r.source.body,n=i.length;let s=e;for(;s<n;){const o=i.charCodeAt(s);switch(o){case 65279:case 9:case 32:case 44:++s;continue;case 10:++s,++r.line,r.lineStart=s;continue;case 13:i.charCodeAt(s+1)===10?s+=2:++s,++r.line,r.lineStart=s;continue;case 35:return I1e(r,s);case 33:return ra(r,ri.BANG,s,s+1);case 36:return ra(r,ri.DOLLAR,s,s+1);case 38:return ra(r,ri.AMP,s,s+1);case 40:return ra(r,ri.PAREN_L,s,s+1);case 41:return ra(r,ri.PAREN_R,s,s+1);case 46:if(i.charCodeAt(s+1)===46&&i.charCodeAt(s+2)===46)return ra(r,ri.SPREAD,s,s+3);break;case 58:return ra(r,ri.COLON,s,s+1);case 61:return ra(r,ri.EQUALS,s,s+1);case 64:return ra(r,ri.AT,s,s+1);case 91:return ra(r,ri.BRACKET_L,s,s+1);case 93:return ra(r,ri.BRACKET_R,s,s+1);case 123:return ra(r,ri.BRACE_L,s,s+1);case 124:return ra(r,ri.PIPE,s,s+1);case 125:return ra(r,ri.BRACE_R,s,s+1);case 34:return i.charCodeAt(s+1)===34&&i.charCodeAt(s+2)===34?P1e(r,s):N1e(r,s)}if(Gy(o)||o===45)return B1e(r,s,o);if(k7(o))return F1e(r,s);throw Ca(r.source,s,o===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:Ug(o)||q_(i,s)?`Unexpected character: ${Xp(r,s)}.`:`Invalid character: ${Xp(r,s)}.`)}return ra(r,ri.EOF,n,n)}function I1e(r,e){const i=r.source.body,n=i.length;let s=e+1;for(;s<n;){const o=i.charCodeAt(s);if(o===10||o===13)break;if(Ug(o))++s;else if(q_(i,s))s+=2;else break}return ra(r,ri.COMMENT,e,s,i.slice(e+1,s))}function B1e(r,e,i){const n=r.source.body;let s=e,o=i,l=!1;if(o===45&&(o=n.charCodeAt(++s)),o===48){if(o=n.charCodeAt(++s),Gy(o))throw Ca(r.source,s,`Invalid number, unexpected digit after 0: ${Xp(r,s)}.`)}else s=vI(r,s,o),o=n.charCodeAt(s);if(o===46&&(l=!0,o=n.charCodeAt(++s),s=vI(r,s,o),o=n.charCodeAt(s)),(o===69||o===101)&&(l=!0,o=n.charCodeAt(++s),(o===43||o===45)&&(o=n.charCodeAt(++s)),s=vI(r,s,o),o=n.charCodeAt(s)),o===46||k7(o))throw Ca(r.source,s,`Invalid number, expected digit but got: ${Xp(r,s)}.`);return ra(r,l?ri.FLOAT:ri.INT,e,s,n.slice(e,s))}function vI(r,e,i){if(!Gy(i))throw Ca(r.source,e,`Invalid number, expected digit but got: ${Xp(r,e)}.`);const n=r.source.body;let s=e+1;for(;Gy(n.charCodeAt(s));)++s;return s}function N1e(r,e){const i=r.source.body,n=i.length;let s=e+1,o=s,l="";for(;s<n;){const u=i.charCodeAt(s);if(u===34)return l+=i.slice(o,s),ra(r,ri.STRING,e,s+1,l);if(u===92){l+=i.slice(o,s);const c=i.charCodeAt(s+1)===117?i.charCodeAt(s+2)===123?L1e(r,s):D1e(r,s):O1e(r,s);l+=c.value,s+=c.size,o=s;continue}if(u===10||u===13)break;if(Ug(u))++s;else if(q_(i,s))s+=2;else throw Ca(r.source,s,`Invalid character within String: ${Xp(r,s)}.`)}throw Ca(r.source,s,"Unterminated string.")}function L1e(r,e){const i=r.source.body;let n=0,s=3;for(;s<12;){const o=i.charCodeAt(e+s++);if(o===125){if(s<5||!Ug(n))break;return{value:String.fromCodePoint(n),size:s}}if(n=n<<4|Hy(o),n<0)break}throw Ca(r.source,e,`Invalid Unicode escape sequence: "${i.slice(e,e+s)}".`)}function D1e(r,e){const i=r.source.body,n=j7(i,e+2);if(Ug(n))return{value:String.fromCodePoint(n),size:6};if(U7(n)&&i.charCodeAt(e+6)===92&&i.charCodeAt(e+7)===117){const s=j7(i,e+8);if(z7(s))return{value:String.fromCodePoint(n,s),size:12}}throw Ca(r.source,e,`Invalid Unicode escape sequence: "${i.slice(e,e+6)}".`)}function j7(r,e){return Hy(r.charCodeAt(e))<<12|Hy(r.charCodeAt(e+1))<<8|Hy(r.charCodeAt(e+2))<<4|Hy(r.charCodeAt(e+3))}function Hy(r){return r>=48&&r<=57?r-48:r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:-1}function O1e(r,e){const i=r.source.body;switch(i.charCodeAt(e+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:`
`,size:2};case 114:return{value:"\r",size:2};case 116:return{value:"	",size:2}}throw Ca(r.source,e,`Invalid character escape sequence: "${i.slice(e,e+2)}".`)}function P1e(r,e){const i=r.source.body,n=i.length;let s=r.lineStart,o=e+3,l=o,u="";const c=[];for(;o<n;){const d=i.charCodeAt(o);if(d===34&&i.charCodeAt(o+1)===34&&i.charCodeAt(o+2)===34){u+=i.slice(l,o),c.push(u);const p=ra(r,ri.BLOCK_STRING,e,o+3,w1e(c).join(`
`));return r.line+=c.length-1,r.lineStart=s,p}if(d===92&&i.charCodeAt(o+1)===34&&i.charCodeAt(o+2)===34&&i.charCodeAt(o+3)===34){u+=i.slice(l,o),l=o+1,o+=4;continue}if(d===10||d===13){u+=i.slice(l,o),c.push(u),d===13&&i.charCodeAt(o+1)===10?o+=2:++o,u="",l=o,s=o;continue}if(Ug(d))++o;else if(q_(i,o))o+=2;else throw Ca(r.source,o,`Invalid character within String: ${Xp(r,o)}.`)}throw Ca(r.source,o,"Unterminated string.")}function F1e(r,e){const i=r.source.body,n=i.length;let s=e+1;for(;s<n;){const o=i.charCodeAt(s);if(E1e(o))++s;else break}return ra(r,ri.NAME,e,s,i.slice(e,s))}const k1e=10,V7=2;function xI(r){return X_(r,[])}function X_(r,e){switch(typeof r){case"string":return JSON.stringify(r);case"function":return r.name?`[function ${r.name}]`:"[function]";case"object":return U1e(r,e);default:return String(r)}}function U1e(r,e){if(r===null)return"null";if(e.includes(r))return"[Circular]";const i=[...e,r];if(z1e(r)){const n=r.toJSON();if(n!==r)return typeof n=="string"?n:X_(n,i)}else if(Array.isArray(r))return V1e(r,i);return j1e(r,i)}function z1e(r){return typeof r.toJSON=="function"}function j1e(r,e){const i=Object.entries(r);return i.length===0?"{}":e.length>V7?"["+G1e(r)+"]":"{ "+i.map(([n,s])=>n+": "+X_(s,e)).join(", ")+" }"}function V1e(r,e){if(r.length===0)return"[]";if(e.length>V7)return"[Array]";const i=Math.min(k1e,r.length),n=r.length-i,s=[];for(let o=0;o<i;++o)s.push(X_(r[o],e));return n===1?s.push("... 1 more item"):n>1&&s.push(`... ${n} more items`),"["+s.join(", ")+"]"}function G1e(r){const e=Object.prototype.toString.call(r).replace(/^\[object /,"").replace(/]$/,"");if(e==="Object"&&typeof r.constructor=="function"){const i=r.constructor.name;if(typeof i=="string"&&i!=="")return i}return e}const H1e=globalThis.process&&process.env.NODE_ENV==="production",W1e=H1e?function(r,e){return r instanceof e}:function(r,e){if(r instanceof e)return!0;if(typeof r=="object"&&r!==null){var i;const n=e.prototype[Symbol.toStringTag],s=Symbol.toStringTag in r?r[Symbol.toStringTag]:(i=r.constructor)===null||i===void 0?void 0:i.name;if(n===s){const o=xI(r);throw new Error(`Cannot use ${n} "${o}" from another module or realm.

Ensure that there is only one instance of "graphql" in the node_modules
directory. If different versions of "graphql" are the dependencies of other
relied on modules, use "resolutions" to ensure only one version is installed.

https://yarnpkg.com/en/docs/selective-version-resolutions

Duplicate "graphql" modules cannot be used at the same time since different
versions may have different capabilities and behavior. The data from one
version used in the function from another could produce confusing and
spurious results.`)}}return!1};class G7{constructor(e,i="GraphQL request",n={line:1,column:1}){typeof e=="string"||Q_(!1,`Body must be a string. Received: ${xI(e)}.`),this.body=e,this.name=i,this.locationOffset=n,this.locationOffset.line>0||Q_(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||Q_(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}function Q1e(r){return W1e(r,G7)}function q1e(r,e){return new X1e(r,e).parseDocument()}class X1e{constructor(e,i={}){const n=Q1e(e)?e:new G7(e);this._lexer=new T1e(n),this._options=i,this._tokenCounter=0}parseName(){const e=this.expectToken(ri.NAME);return this.node(e,{kind:Or.NAME,value:e.value})}parseDocument(){return this.node(this._lexer.token,{kind:Or.DOCUMENT,definitions:this.many(ri.SOF,this.parseDefinition,ri.EOF)})}parseDefinition(){if(this.peek(ri.BRACE_L))return this.parseOperationDefinition();const e=this.peekDescription(),i=e?this._lexer.lookahead():this._lexer.token;if(i.kind===ri.NAME){switch(i.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(e)throw Ca(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(i.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(i)}parseOperationDefinition(){const e=this._lexer.token;if(this.peek(ri.BRACE_L))return this.node(e,{kind:Or.OPERATION_DEFINITION,operation:qp.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const i=this.parseOperationType();let n;return this.peek(ri.NAME)&&(n=this.parseName()),this.node(e,{kind:Or.OPERATION_DEFINITION,operation:i,name:n,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const e=this.expectToken(ri.NAME);switch(e.value){case"query":return qp.QUERY;case"mutation":return qp.MUTATION;case"subscription":return qp.SUBSCRIPTION}throw this.unexpected(e)}parseVariableDefinitions(){return this.optionalMany(ri.PAREN_L,this.parseVariableDefinition,ri.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:Or.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(ri.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(ri.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const e=this._lexer.token;return this.expectToken(ri.DOLLAR),this.node(e,{kind:Or.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:Or.SELECTION_SET,selections:this.many(ri.BRACE_L,this.parseSelection,ri.BRACE_R)})}parseSelection(){return this.peek(ri.SPREAD)?this.parseFragment():this.parseField()}parseField(){const e=this._lexer.token,i=this.parseName();let n,s;return this.expectOptionalToken(ri.COLON)?(n=i,s=this.parseName()):s=i,this.node(e,{kind:Or.FIELD,alias:n,name:s,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(ri.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(e){const i=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(ri.PAREN_L,i,ri.PAREN_R)}parseArgument(e=!1){const i=this._lexer.token,n=this.parseName();return this.expectToken(ri.COLON),this.node(i,{kind:Or.ARGUMENT,name:n,value:this.parseValueLiteral(e)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const e=this._lexer.token;this.expectToken(ri.SPREAD);const i=this.expectOptionalKeyword("on");return!i&&this.peek(ri.NAME)?this.node(e,{kind:Or.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(e,{kind:Or.INLINE_FRAGMENT,typeCondition:i?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const e=this._lexer.token;return this.expectKeyword("fragment"),this._options.allowLegacyFragmentVariables===!0?this.node(e,{kind:Or.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(e,{kind:Or.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()}parseValueLiteral(e){const i=this._lexer.token;switch(i.kind){case ri.BRACKET_L:return this.parseList(e);case ri.BRACE_L:return this.parseObject(e);case ri.INT:return this.advanceLexer(),this.node(i,{kind:Or.INT,value:i.value});case ri.FLOAT:return this.advanceLexer(),this.node(i,{kind:Or.FLOAT,value:i.value});case ri.STRING:case ri.BLOCK_STRING:return this.parseStringLiteral();case ri.NAME:switch(this.advanceLexer(),i.value){case"true":return this.node(i,{kind:Or.BOOLEAN,value:!0});case"false":return this.node(i,{kind:Or.BOOLEAN,value:!1});case"null":return this.node(i,{kind:Or.NULL});default:return this.node(i,{kind:Or.ENUM,value:i.value})}case ri.DOLLAR:if(e)if(this.expectToken(ri.DOLLAR),this._lexer.token.kind===ri.NAME){const n=this._lexer.token.value;throw Ca(this._lexer.source,i.start,`Unexpected variable "$${n}" in constant value.`)}else throw this.unexpected(i);return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const e=this._lexer.token;return this.advanceLexer(),this.node(e,{kind:Or.STRING,value:e.value,block:e.kind===ri.BLOCK_STRING})}parseList(e){const i=()=>this.parseValueLiteral(e);return this.node(this._lexer.token,{kind:Or.LIST,values:this.any(ri.BRACKET_L,i,ri.BRACKET_R)})}parseObject(e){const i=()=>this.parseObjectField(e);return this.node(this._lexer.token,{kind:Or.OBJECT,fields:this.any(ri.BRACE_L,i,ri.BRACE_R)})}parseObjectField(e){const i=this._lexer.token,n=this.parseName();return this.expectToken(ri.COLON),this.node(i,{kind:Or.OBJECT_FIELD,name:n,value:this.parseValueLiteral(e)})}parseDirectives(e){const i=[];for(;this.peek(ri.AT);)i.push(this.parseDirective(e));return i}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(e){const i=this._lexer.token;return this.expectToken(ri.AT),this.node(i,{kind:Or.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e)})}parseTypeReference(){const e=this._lexer.token;let i;if(this.expectOptionalToken(ri.BRACKET_L)){const n=this.parseTypeReference();this.expectToken(ri.BRACKET_R),i=this.node(e,{kind:Or.LIST_TYPE,type:n})}else i=this.parseNamedType();return this.expectOptionalToken(ri.BANG)?this.node(e,{kind:Or.NON_NULL_TYPE,type:i}):i}parseNamedType(){return this.node(this._lexer.token,{kind:Or.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(ri.STRING)||this.peek(ri.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("schema");const n=this.parseConstDirectives(),s=this.many(ri.BRACE_L,this.parseOperationTypeDefinition,ri.BRACE_R);return this.node(e,{kind:Or.SCHEMA_DEFINITION,description:i,directives:n,operationTypes:s})}parseOperationTypeDefinition(){const e=this._lexer.token,i=this.parseOperationType();this.expectToken(ri.COLON);const n=this.parseNamedType();return this.node(e,{kind:Or.OPERATION_TYPE_DEFINITION,operation:i,type:n})}parseScalarTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("scalar");const n=this.parseName(),s=this.parseConstDirectives();return this.node(e,{kind:Or.SCALAR_TYPE_DEFINITION,description:i,name:n,directives:s})}parseObjectTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("type");const n=this.parseName(),s=this.parseImplementsInterfaces(),o=this.parseConstDirectives(),l=this.parseFieldsDefinition();return this.node(e,{kind:Or.OBJECT_TYPE_DEFINITION,description:i,name:n,interfaces:s,directives:o,fields:l})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(ri.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(ri.BRACE_L,this.parseFieldDefinition,ri.BRACE_R)}parseFieldDefinition(){const e=this._lexer.token,i=this.parseDescription(),n=this.parseName(),s=this.parseArgumentDefs();this.expectToken(ri.COLON);const o=this.parseTypeReference(),l=this.parseConstDirectives();return this.node(e,{kind:Or.FIELD_DEFINITION,description:i,name:n,arguments:s,type:o,directives:l})}parseArgumentDefs(){return this.optionalMany(ri.PAREN_L,this.parseInputValueDef,ri.PAREN_R)}parseInputValueDef(){const e=this._lexer.token,i=this.parseDescription(),n=this.parseName();this.expectToken(ri.COLON);const s=this.parseTypeReference();let o;this.expectOptionalToken(ri.EQUALS)&&(o=this.parseConstValueLiteral());const l=this.parseConstDirectives();return this.node(e,{kind:Or.INPUT_VALUE_DEFINITION,description:i,name:n,type:s,defaultValue:o,directives:l})}parseInterfaceTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("interface");const n=this.parseName(),s=this.parseImplementsInterfaces(),o=this.parseConstDirectives(),l=this.parseFieldsDefinition();return this.node(e,{kind:Or.INTERFACE_TYPE_DEFINITION,description:i,name:n,interfaces:s,directives:o,fields:l})}parseUnionTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("union");const n=this.parseName(),s=this.parseConstDirectives(),o=this.parseUnionMemberTypes();return this.node(e,{kind:Or.UNION_TYPE_DEFINITION,description:i,name:n,directives:s,types:o})}parseUnionMemberTypes(){return this.expectOptionalToken(ri.EQUALS)?this.delimitedMany(ri.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("enum");const n=this.parseName(),s=this.parseConstDirectives(),o=this.parseEnumValuesDefinition();return this.node(e,{kind:Or.ENUM_TYPE_DEFINITION,description:i,name:n,directives:s,values:o})}parseEnumValuesDefinition(){return this.optionalMany(ri.BRACE_L,this.parseEnumValueDefinition,ri.BRACE_R)}parseEnumValueDefinition(){const e=this._lexer.token,i=this.parseDescription(),n=this.parseEnumValueName(),s=this.parseConstDirectives();return this.node(e,{kind:Or.ENUM_VALUE_DEFINITION,description:i,name:n,directives:s})}parseEnumValueName(){if(this._lexer.token.value==="true"||this._lexer.token.value==="false"||this._lexer.token.value==="null")throw Ca(this._lexer.source,this._lexer.token.start,`${Y_(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("input");const n=this.parseName(),s=this.parseConstDirectives(),o=this.parseInputFieldsDefinition();return this.node(e,{kind:Or.INPUT_OBJECT_TYPE_DEFINITION,description:i,name:n,directives:s,fields:o})}parseInputFieldsDefinition(){return this.optionalMany(ri.BRACE_L,this.parseInputValueDef,ri.BRACE_R)}parseTypeSystemExtension(){const e=this._lexer.lookahead();if(e.kind===ri.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)}parseSchemaExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const i=this.parseConstDirectives(),n=this.optionalMany(ri.BRACE_L,this.parseOperationTypeDefinition,ri.BRACE_R);if(i.length===0&&n.length===0)throw this.unexpected();return this.node(e,{kind:Or.SCHEMA_EXTENSION,directives:i,operationTypes:n})}parseScalarTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const i=this.parseName(),n=this.parseConstDirectives();if(n.length===0)throw this.unexpected();return this.node(e,{kind:Or.SCALAR_TYPE_EXTENSION,name:i,directives:n})}parseObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();if(n.length===0&&s.length===0&&o.length===0)throw this.unexpected();return this.node(e,{kind:Or.OBJECT_TYPE_EXTENSION,name:i,interfaces:n,directives:s,fields:o})}parseInterfaceTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();if(n.length===0&&s.length===0&&o.length===0)throw this.unexpected();return this.node(e,{kind:Or.INTERFACE_TYPE_EXTENSION,name:i,interfaces:n,directives:s,fields:o})}parseUnionTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const i=this.parseName(),n=this.parseConstDirectives(),s=this.parseUnionMemberTypes();if(n.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:Or.UNION_TYPE_EXTENSION,name:i,directives:n,types:s})}parseEnumTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const i=this.parseName(),n=this.parseConstDirectives(),s=this.parseEnumValuesDefinition();if(n.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:Or.ENUM_TYPE_EXTENSION,name:i,directives:n,values:s})}parseInputObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const i=this.parseName(),n=this.parseConstDirectives(),s=this.parseInputFieldsDefinition();if(n.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:Or.INPUT_OBJECT_TYPE_EXTENSION,name:i,directives:n,fields:s})}parseDirectiveDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("directive"),this.expectToken(ri.AT);const n=this.parseName(),s=this.parseArgumentDefs(),o=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const l=this.parseDirectiveLocations();return this.node(e,{kind:Or.DIRECTIVE_DEFINITION,description:i,name:n,arguments:s,repeatable:o,locations:l})}parseDirectiveLocations(){return this.delimitedMany(ri.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const e=this._lexer.token,i=this.parseName();if(Object.prototype.hasOwnProperty.call(AI,i.value))return i;throw this.unexpected(e)}node(e,i){return this._options.noLocation!==!0&&(i.loc=new b1e(e,this._lexer.lastToken,this._lexer.source)),i}peek(e){return this._lexer.token.kind===e}expectToken(e){const i=this._lexer.token;if(i.kind===e)return this.advanceLexer(),i;throw Ca(this._lexer.source,i.start,`Expected ${H7(e)}, found ${Y_(i)}.`)}expectOptionalToken(e){return this._lexer.token.kind===e?(this.advanceLexer(),!0):!1}expectKeyword(e){const i=this._lexer.token;if(i.kind===ri.NAME&&i.value===e)this.advanceLexer();else throw Ca(this._lexer.source,i.start,`Expected "${e}", found ${Y_(i)}.`)}expectOptionalKeyword(e){const i=this._lexer.token;return i.kind===ri.NAME&&i.value===e?(this.advanceLexer(),!0):!1}unexpected(e){const i=e??this._lexer.token;return Ca(this._lexer.source,i.start,`Unexpected ${Y_(i)}.`)}any(e,i,n){this.expectToken(e);const s=[];for(;!this.expectOptionalToken(n);)s.push(i.call(this));return s}optionalMany(e,i,n){if(this.expectOptionalToken(e)){const s=[];do s.push(i.call(this));while(!this.expectOptionalToken(n));return s}return[]}many(e,i,n){this.expectToken(e);const s=[];do s.push(i.call(this));while(!this.expectOptionalToken(n));return s}delimitedMany(e,i){this.expectOptionalToken(e);const n=[];do n.push(i.call(this));while(this.expectOptionalToken(e));return n}advanceLexer(){const{maxTokens:e}=this._options,i=this._lexer.advance();if(e!==void 0&&i.kind!==ri.EOF&&(++this._tokenCounter,this._tokenCounter>e))throw Ca(this._lexer.source,i.start,`Document contains more that ${e} tokens. Parsing aborted.`)}}function Y_(r){const e=r.value;return H7(r.kind)+(e!=null?` "${e}"`:"")}function H7(r){return M1e(r)?`"${r}"`:r}function Y1e(r){return`"${r.replace(K1e,J1e)}"`}const K1e=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function J1e(r){return Z1e[r.charCodeAt(0)]}const Z1e=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"],$1e=Object.freeze({});function e_e(r,e,i=O7){const n=new Map;for(const _ of Object.values(Or))n.set(_,t_e(e,_));let s,o=Array.isArray(r),l=[r],u=-1,c=[],d=r,p,f;const m=[],g=[];do{u++;const _=u===l.length,T=_&&c.length!==0;if(_){if(p=g.length===0?void 0:m[m.length-1],d=f,f=g.pop(),T)if(o){d=d.slice();let S=0;for(const[R,B]of c){const I=R-S;B===null?(d.splice(I,1),S++):d[I]=B}}else{d=Object.defineProperties({},Object.getOwnPropertyDescriptors(d));for(const[S,R]of c)d[S]=R}u=s.index,l=s.keys,c=s.edits,o=s.inArray,s=s.prev}else if(f){if(p=o?u:l[u],d=f[p],d==null)continue;m.push(p)}let w;if(!Array.isArray(d)){var y,x;P7(d)||Q_(!1,`Invalid AST Node: ${xI(d)}.`);const S=_?(y=n.get(d.kind))===null||y===void 0?void 0:y.leave:(x=n.get(d.kind))===null||x===void 0?void 0:x.enter;if(w=S==null?void 0:S.call(e,d,p,f,m,g),w===$1e)break;if(w===!1){if(!_){m.pop();continue}}else if(w!==void 0&&(c.push([p,w]),!_))if(P7(w))d=w;else{m.pop();continue}}if(w===void 0&&T&&c.push([p,d]),_)m.pop();else{var v;s={inArray:o,index:u,keys:l,edits:c,prev:s},o=Array.isArray(d),l=o?d:(v=i[d.kind])!==null&&v!==void 0?v:[],u=-1,c=[],f&&g.push(f),f=d}}while(s!==void 0);return c.length!==0?c[c.length-1][1]:r}function t_e(r,e){const i=r[e];return typeof i=="object"?i:typeof i=="function"?{enter:i,leave:void 0}:{enter:r.enter,leave:r.leave}}function i_e(r){return e_e(r,n_e)}const r_e=80,n_e={Name:{leave:r=>r.value},Variable:{leave:r=>"$"+r.name},Document:{leave:r=>gr(r.definitions,`

`)},OperationDefinition:{leave(r){const e=Sn("(",gr(r.variableDefinitions,", "),")"),i=gr([r.operation,gr([r.name,e]),gr(r.directives," ")]," ");return(i==="query"?"":i+" ")+r.selectionSet}},VariableDefinition:{leave:({variable:r,type:e,defaultValue:i,directives:n})=>r+": "+e+Sn(" = ",i)+Sn(" ",gr(n," "))},SelectionSet:{leave:({selections:r})=>bc(r)},Field:{leave({alias:r,name:e,arguments:i,directives:n,selectionSet:s}){const o=Sn("",r,": ")+e;let l=o+Sn("(",gr(i,", "),")");return l.length>r_e&&(l=o+Sn(`(
`,K_(gr(i,`
`)),`
)`)),gr([l,gr(n," "),s]," ")}},Argument:{leave:({name:r,value:e})=>r+": "+e},FragmentSpread:{leave:({name:r,directives:e})=>"..."+r+Sn(" ",gr(e," "))},InlineFragment:{leave:({typeCondition:r,directives:e,selectionSet:i})=>gr(["...",Sn("on ",r),gr(e," "),i]," ")},FragmentDefinition:{leave:({name:r,typeCondition:e,variableDefinitions:i,directives:n,selectionSet:s})=>`fragment ${r}${Sn("(",gr(i,", "),")")} on ${e} ${Sn("",gr(n," ")," ")}`+s},IntValue:{leave:({value:r})=>r},FloatValue:{leave:({value:r})=>r},StringValue:{leave:({value:r,block:e})=>e?S1e(r):Y1e(r)},BooleanValue:{leave:({value:r})=>r?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:r})=>r},ListValue:{leave:({values:r})=>"["+gr(r,", ")+"]"},ObjectValue:{leave:({fields:r})=>"{"+gr(r,", ")+"}"},ObjectField:{leave:({name:r,value:e})=>r+": "+e},Directive:{leave:({name:r,arguments:e})=>"@"+r+Sn("(",gr(e,", "),")")},NamedType:{leave:({name:r})=>r},ListType:{leave:({type:r})=>"["+r+"]"},NonNullType:{leave:({type:r})=>r+"!"},SchemaDefinition:{leave:({description:r,directives:e,operationTypes:i})=>Sn("",r,`
`)+gr(["schema",gr(e," "),bc(i)]," ")},OperationTypeDefinition:{leave:({operation:r,type:e})=>r+": "+e},ScalarTypeDefinition:{leave:({description:r,name:e,directives:i})=>Sn("",r,`
`)+gr(["scalar",e,gr(i," ")]," ")},ObjectTypeDefinition:{leave:({description:r,name:e,interfaces:i,directives:n,fields:s})=>Sn("",r,`
`)+gr(["type",e,Sn("implements ",gr(i," & ")),gr(n," "),bc(s)]," ")},FieldDefinition:{leave:({description:r,name:e,arguments:i,type:n,directives:s})=>Sn("",r,`
`)+e+(W7(i)?Sn(`(
`,K_(gr(i,`
`)),`
)`):Sn("(",gr(i,", "),")"))+": "+n+Sn(" ",gr(s," "))},InputValueDefinition:{leave:({description:r,name:e,type:i,defaultValue:n,directives:s})=>Sn("",r,`
`)+gr([e+": "+i,Sn("= ",n),gr(s," ")]," ")},InterfaceTypeDefinition:{leave:({description:r,name:e,interfaces:i,directives:n,fields:s})=>Sn("",r,`
`)+gr(["interface",e,Sn("implements ",gr(i," & ")),gr(n," "),bc(s)]," ")},UnionTypeDefinition:{leave:({description:r,name:e,directives:i,types:n})=>Sn("",r,`
`)+gr(["union",e,gr(i," "),Sn("= ",gr(n," | "))]," ")},EnumTypeDefinition:{leave:({description:r,name:e,directives:i,values:n})=>Sn("",r,`
`)+gr(["enum",e,gr(i," "),bc(n)]," ")},EnumValueDefinition:{leave:({description:r,name:e,directives:i})=>Sn("",r,`
`)+gr([e,gr(i," ")]," ")},InputObjectTypeDefinition:{leave:({description:r,name:e,directives:i,fields:n})=>Sn("",r,`
`)+gr(["input",e,gr(i," "),bc(n)]," ")},DirectiveDefinition:{leave:({description:r,name:e,arguments:i,repeatable:n,locations:s})=>Sn("",r,`
`)+"directive @"+e+(W7(i)?Sn(`(
`,K_(gr(i,`
`)),`
)`):Sn("(",gr(i,", "),")"))+(n?" repeatable":"")+" on "+gr(s," | ")},SchemaExtension:{leave:({directives:r,operationTypes:e})=>gr(["extend schema",gr(r," "),bc(e)]," ")},ScalarTypeExtension:{leave:({name:r,directives:e})=>gr(["extend scalar",r,gr(e," ")]," ")},ObjectTypeExtension:{leave:({name:r,interfaces:e,directives:i,fields:n})=>gr(["extend type",r,Sn("implements ",gr(e," & ")),gr(i," "),bc(n)]," ")},InterfaceTypeExtension:{leave:({name:r,interfaces:e,directives:i,fields:n})=>gr(["extend interface",r,Sn("implements ",gr(e," & ")),gr(i," "),bc(n)]," ")},UnionTypeExtension:{leave:({name:r,directives:e,types:i})=>gr(["extend union",r,gr(e," "),Sn("= ",gr(i," | "))]," ")},EnumTypeExtension:{leave:({name:r,directives:e,values:i})=>gr(["extend enum",r,gr(e," "),bc(i)]," ")},InputObjectTypeExtension:{leave:({name:r,directives:e,fields:i})=>gr(["extend input",r,gr(e," "),bc(i)]," ")}};function gr(r,e=""){var i;return(i=r==null?void 0:r.filter(n=>n).join(e))!==null&&i!==void 0?i:""}function bc(r){return Sn(`{
`,K_(gr(r,`
`)),`
}`)}function Sn(r,e,i=""){return e!=null&&e!==""?r+e+i:""}function K_(r){return Sn("  ",r.replace(/\n/g,`
  `))}function W7(r){var e;return(e=r==null?void 0:r.some(i=>i.includes(`
`)))!==null&&e!==void 0?e:!1}const Q7="Accept",bI="Content-Type",_I="application/json",q7="application/graphql-response+json",X7=r=>r.replace(/([\s,]|#[^\n\r]+)+/g," ").trim(),s_e=r=>{const e=r.toLowerCase();return e.includes(q7)||e.includes(_I)},Y7=r=>{try{if(Array.isArray(r))return{_tag:"Batch",executionResults:r.map(K7)};if(W_(r))return{_tag:"Single",executionResult:K7(r)};throw new Error(`Invalid execution result: result is not object or array. 
Got:
${String(r)}`)}catch(e){return e}},K7=r=>{if(typeof r!="object"||r===null)throw new Error("Invalid execution result: result is not object");let e,i,n;if("errors"in r){if(!W_(r.errors)&&!Array.isArray(r.errors))throw new Error("Invalid execution result: errors is not plain object OR array");e=r.errors}if("data"in r){if(!W_(r.data)&&r.data!==null)throw new Error("Invalid execution result: data is not plain object");i=r.data}if("extensions"in r){if(!W_(r.extensions))throw new Error("Invalid execution result: extensions is not plain object");n=r.extensions}return{data:i,errors:e,extensions:n}},a_e=r=>r._tag==="Batch"?r.executionResults.some(J7):J7(r.executionResult),J7=r=>Array.isArray(r.errors)?r.errors.length>0:!!r.errors,Z7=r=>typeof r=="object"&&r!==null&&"kind"in r&&r.kind===Or.OPERATION_DEFINITION,o_e=r=>{var e;let i;const n=r.definitions.filter(Z7);return n.length===1&&(i=(e=n[0].name)==null?void 0:e.value),i},l_e=r=>{let e=!1;const i=r.definitions.filter(Z7);return i.length===1&&(e=i[0].operation===qp.MUTATION),e},EI=(r,e)=>{const i=typeof r=="string"?r:i_e(r);let n=!1,s;if(e)return{expression:i,isMutation:n,operationName:s};const o=d1e(()=>typeof r=="string"?q1e(r):r);return o instanceof Error?{expression:i,isMutation:n,operationName:s}:(s=o_e(o),n=l_e(o),{expression:i,operationName:s,isMutation:n})},wI=JSON,CI=async r=>{const e={...r,method:r.request._tag==="Single"?r.request.document.isMutation?"POST":M7(r.method??"post"):r.request.hasMutations?"POST":M7(r.method??"post"),fetchOptions:{...r.fetchOptions,errorPolicy:r.fetchOptions.errorPolicy??"none"}},i=await u_e(e.method)(e);if(!i.ok)return new Fg({status:i.status,headers:i.headers},{query:r.request._tag==="Single"?r.request.document.expression:r.request.query,variables:r.request.variables});const n=await c_e(i,r.fetchOptions.jsonSerializer??wI);if(n instanceof Error)throw n;const s={status:i.status,headers:i.headers};if(a_e(n)&&e.fetchOptions.errorPolicy==="none"){const o=n._tag==="Batch"?{...n.executionResults,...s}:{...n.executionResult,...s};return new Fg(o,{query:r.request._tag==="Single"?r.request.document.expression:r.request.query,variables:r.request.variables})}switch(n._tag){case"Single":return{...s,...$7(e)(n.executionResult)};case"Batch":return{...s,data:n.executionResults.map($7(e))};default:fI(n)}},$7=r=>e=>({extensions:e.extensions,data:e.data,errors:r.fetchOptions.errorPolicy==="all"?e.errors:void 0}),c_e=async(r,e)=>{const i=r.headers.get(bI),n=await r.text();return i&&s_e(i)?Y7(e.parse(n)):Y7(n)},u_e=r=>async e=>{const i=new Headers(e.headers);let n=null,s;i.has(Q7)||i.set(Q7,[q7,_I].join(", ")),r==="POST"?(s=(e.fetchOptions.jsonSerializer??wI).stringify(h_e(e)),typeof s=="string"&&!i.has(bI)&&i.set(bI,_I)):n=d_e(e);const o={method:r,headers:i,body:s,...e.fetchOptions};let l=new URL(e.url),u=o;if(e.middleware){const c=await Promise.resolve(e.middleware({...o,url:e.url,operationName:e.request._tag==="Single"?e.request.document.operationName:void 0,variables:e.request.variables})),{url:d,...p}=c;l=new URL(d),u=p}return n&&n.forEach((c,d)=>{l.searchParams.append(d,c)}),await(e.fetch??fetch)(l,u)},h_e=r=>{switch(r.request._tag){case"Single":return{query:r.request.document.expression,variables:r.request.variables,operationName:r.request.document.operationName};case"Batch":return R7(r.request.query,r.request.variables??[]).map(([e,i])=>({query:e,variables:i}));default:throw fI(r.request)}},d_e=r=>{var e;const i=r.fetchOptions.jsonSerializer??wI,n=new URLSearchParams;switch(r.request._tag){case"Single":return n.append("query",X7(r.request.document.expression)),r.request.variables&&n.append("variables",i.stringify(r.request.variables)),r.request.document.operationName&&n.append("operationName",r.request.document.operationName),n;case"Batch":{const s=((e=r.request.variables)==null?void 0:e.map(u=>i.stringify(u)))??[],o=r.request.query.map(X7),l=R7(o,s).map(([u,c])=>({query:u,variables:c}));return n.append("query",i.stringify(l)),n}default:throw fI(r.request)}};class e9{constructor(e,i={}){N0(this,"url"),N0(this,"requestConfig"),N0(this,"rawRequest",async(...n)=>{const[s,o,l]=n,u=m1e(s,o,l),{headers:c,fetch:d=globalThis.fetch,method:p="POST",requestMiddleware:f,responseMiddleware:m,excludeOperationName:g,...y}=this.requestConfig,{url:x}=this;u.signal!==void 0&&(y.signal=u.signal);const v=EI(u.query,g),_=await CI({url:x,request:{_tag:"Single",document:v,variables:u.variables},headers:{...kg(pI(c)),...kg(u.requestHeaders)},fetch:d,method:p,fetchOptions:y,middleware:f});if(m&&await m(_,{operationName:v.operationName,variables:o,url:this.url}),_ instanceof Error)throw _;return _}),this.url=e,this.requestConfig=i}async request(e,...i){const[n,s]=i,o=p_e(e,n,s),{headers:l,fetch:u=globalThis.fetch,method:c="POST",requestMiddleware:d,responseMiddleware:p,excludeOperationName:f,...m}=this.requestConfig,{url:g}=this;o.signal!==void 0&&(m.signal=o.signal);const y=EI(o.document,f),x=await CI({url:g,request:{_tag:"Single",document:y,variables:o.variables},headers:{...kg(pI(l)),...kg(o.requestHeaders)},fetch:u,method:c,fetchOptions:m,middleware:d});if(p&&await p(x,{operationName:y.operationName,variables:o.variables,url:this.url}),x instanceof Error)throw x;return x.data}async batchRequests(e,i){const n=f1e(e,i),{headers:s,excludeOperationName:o,...l}=this.requestConfig;n.signal!==void 0&&(l.signal=n.signal);const u=n.documents.map(({document:m})=>EI(m,o)),c=u.map(({expression:m})=>m),d=u.some(({isMutation:m})=>m),p=n.documents.map(({variables:m})=>m),f=await CI({url:this.url,request:{_tag:"Batch",operationName:void 0,query:c,hasMutations:d,variables:p},headers:{...kg(pI(s)),...kg(n.requestHeaders)},fetch:this.requestConfig.fetch??globalThis.fetch,method:this.requestConfig.method||"POST",fetchOptions:l,middleware:this.requestConfig.requestMiddleware});if(this.requestConfig.responseMiddleware&&await this.requestConfig.responseMiddleware(f,{operationName:void 0,variables:p,url:this.url}),f instanceof Error)throw f;return f.data}setHeaders(e){return this.requestConfig.headers=e,this}setHeader(e,i){const{headers:n}=this.requestConfig;return n?n[e]=i:this.requestConfig.headers={[e]:i},this}setEndpoint(e){return this.url=e,this}}const p_e=(r,e,i)=>r.document?r:{document:r,variables:e,requestHeaders:i,signal:void 0},Ed=(r,...e)=>r.reduce((i,n,s)=>`${i}${n}${s in e?String(e[s]):""}`,""),t9={base:{url:" https://prod.base.intuition-api.com/v1/graphql",displayName:"Base Mainnet"}},Wy=r=>new e9(t9[r].url),f_e=async(r,e="baseSepolia")=>{const i=Wy(e);let n;n=Ed`
    query GetAtom($atomId: numeric!) {
      atom(id: $atomId) {
        id
        image
        label
        emoji
        type
        creator_id
        vault {
          total_shares
        }
      }
    }
  `;const s={atomId:r};try{return(await i.request(n,s)).atom}catch(o){throw console.error("Error fetching atom details:",o),o}},m_e=async(r="baseSepolia")=>{const e=Wy(r);let i,n;return i=Ed`
    query {
      triples(limit: 1000) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,n=await e.request(i),{items:n.triples}.items},g_e=async(r,e="baseSepolia")=>{const i=Wy(e);let n,s,o;return n=Ed`
    query Triples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,o={where:{_or:[{predicate_id:{_eq:r}},{subject_id:{_eq:r}},{object_id:{_eq:r}}]}},s=await i.request(n,o),s.triples},A_e=async(r,e="baseSepolia")=>{const i=Wy(e),n=Ed`
    query SearchTriples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,s={_and:[]};r.subject&&s._and.push({subject:{label:{_ilike:`%${r.subject}%`}}}),r.predicate&&s._and.push({predicate:{label:{_ilike:`%${r.predicate}%`}}}),r.object&&s._and.push({object:{label:{_ilike:`%${r.object}%`}}});const o={where:s._and.length>0?s:{}};console.log("Executing search query with variables:",o);try{const l=await i.request(n,o);return console.log("Search query response:",l),l.triples}catch(l){throw console.error("Error executing search query:",l),l}},i9=Object.freeze(Object.defineProperty({__proto__:null,ENDPOINTS:t9,createClient:Wy,fetchAtomDetails:f_e,fetchTriples:m_e,fetchTriplesForNode:g_e,searchTriples:A_e},Symbol.toStringTag,{value:"Module"})),r9={baseSepolia:{url:" https://dev.base.intuition-api.com/v1/graphql",displayName:"Base Testnet"}},Qy=r=>new e9(r9[r].url),y_e=async(r,e="baseSepolia")=>{const i=Qy(e);let n;n=Ed`
    query GetAtom($atomId: numeric!) {
      atom(id: $atomId) {
        id
        image
        label
        emoji
        type
        creator_id
        vault {
          total_shares
        }
      }
    }
  `;const s={atomId:r};try{return(await i.request(n,s)).atom}catch(o){throw console.error("Error fetching atom details:",o),o}},v_e=async(r="baseSepolia")=>{const e=Qy(r);let i,n;return i=Ed`
    query {
      triples(limit: 1000) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,n=await e.request(i),{items:n.triples}.items},x_e=async(r,e="baseSepolia")=>{const i=Qy(e);let n,s,o;return n=Ed`
    query Triples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,o={where:{_or:[{predicate_id:{_eq:r}},{subject_id:{_eq:r}},{object_id:{_eq:r}}]}},s=await i.request(n,o),s.triples},b_e=async(r,e="baseSepolia")=>{const i=Qy(e),n=Ed`
    query SearchTriples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,s={_and:[]};r.subject&&s._and.push({subject:{label:{_ilike:`%${r.subject}%`}}}),r.predicate&&s._and.push({predicate:{label:{_ilike:`%${r.predicate}%`}}}),r.object&&s._and.push({object:{label:{_ilike:`%${r.object}%`}}});const o={where:s._and.length>0?s:{}};console.log("Executing search query with variables:",o);try{const l=await i.request(n,o);return console.log("Search query response:",l),l.triples}catch(l){throw console.error("Error executing search query:",l),l}},__e=Object.freeze(Object.defineProperty({__proto__:null,ENDPOINTS:r9,createClient:Qy,fetchAtomDetails:y_e,fetchTriples:v_e,fetchTriplesForNode:x_e,searchTriples:b_e},Symbol.toStringTag,{value:"Module"})),qy={railsMockApi:{url:"https://api-i7n.thp-lab.org/api/v1/graph",displayName:"[OffChain] Playground API",module:i9},baseSepolia:{url:"https://api.i7n.dev/v1/graphql",displayName:"Base Testnet",module:__e},base:{url:"https://prod.base.intuition-api.com/v1/graphql",displayName:"Base Mainnet",module:i9}},J_=r=>{if(!qy[r]||!qy[r].module)throw new Error(`No module defined for endpoint '${r}'.`);return qy[r].module},n9=async(r="base")=>{const e=J_(r);try{return e.fetchTriples(r)}catch(i){throw console.error(`Error fetching triples for endpoint ${r}:`,i),i}},E_e=async(r,e="base")=>{const i=J_(e);try{return i.fetchTriplesForNode(r,e)}catch(n){throw console.error(`Error fetching triples for node ${r} with endpoint ${e}:`,n),n}},w_e=async(r,e="base")=>{const i=J_(e);try{return i.fetchAtomDetails(r,e)}catch(n){throw console.error(`Error fetching atom details for ${r} with endpoint ${e}:`,n),n}},C_e=async(r,e="base")=>{const i=J_(e);try{return i.searchTriples(r,e)}catch(n){throw console.error(`Error searching triples with endpoint ${e}:`,n),n}},Yp={SUBJECT:"#4361EE",PREDICATE:"#FF7300",OBJECT:"#9D4EDD",CREATOR:"#00FF00"},SI=r=>{switch(r){case"subject":return Yp.SUBJECT;case"predicate":return Yp.PREDICATE;case"object":return Yp.OBJECT;case"creator":return Yp.CREATOR;default:return Yp.DEFAULT}},TI=r=>{const e=[],i=[],n=new Map;return r.forEach(({subject:s,predicate:o,object:l})=>{if(!n.has(s.id)){const u={id:s.id,label:s.label,isTriple:!1,color:SI("subject"),role:"subject"};n.set(s.id,u),e.push(u)}if(!n.has(o.id)){const u={id:o.id,label:o.label,isTriple:!1,color:SI("predicate"),role:"predicate"};n.set(o.id,u),e.push(u)}if(!n.has(l.id)){const u={id:l.id,label:l.label,isTriple:!1,color:SI("object"),role:"object"};n.set(l.id,u),e.push(u)}i.push({source:s.id,target:o.id,type:"subject-to-predicate"}),i.push({source:o.id,target:l.id,type:"predicate-to-object"})}),{nodes:e,links:i}},S_e=({showCreators:r=!1})=>{const e=Object.entries(Yp).filter(([i])=>i!=="CREATOR"||r).map(([i,n])=>({role:i.toLowerCase(),color:n}));return ir.jsxs("div",{style:{position:"absolute",bottom:"20px",right:"10px",zIndex:10,background:"#222",color:"#fff",padding:"10px",borderRadius:"4px",boxShadow:"0px 4px 6px rgba(0, 0, 0, 0.2)",fontSize:"14px"},children:[ir.jsx("h4",{style:{margin:"0 0 10px 0",fontSize:"16px"},children:"Graph Legend"}),ir.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:e.map(({role:i,color:n})=>ir.jsxs("li",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[ir.jsx("span",{style:{width:"15px",height:"15px",backgroundColor:n,borderRadius:"50%",display:"inline-block",marginRight:"10px"}}),i.charAt(0).toUpperCase()+i.slice(1)]},i))})]})},T_e=({graphData:r,onNodeClick:e})=>{const i=Ei.useRef();return Ei.useEffect(()=>{if(i.current){const n=Dk()(i.current);n.graphData(r),n.nodeLabel(s=>s.label||s.id).nodeAutoColorBy("group"),e&&n.onNodeClick(e)}},[r,e]),ir.jsx("div",{ref:i,style:{width:"100vw",height:"100vh",overflow:"hidden"}})},M_e=({triple:r,endpoint:e,onClose:i})=>{var n,s;const[o,l]=Ei.useState(null),[u,c]=Ei.useState(null),[d,p]=Ei.useState(!1),[f,m]=Ei.useState(null);Ei.useEffect(()=>{r&&(p(!0),m(null),c(null),(async()=>{try{console.log("Received triple:",r);const y=(await n9(e)).filter(x=>{var v,_,T;return x.id===r.id||((v=x.subject)==null?void 0:v.id)===r.id||((_=x.predicate)==null?void 0:_.id)===r.id||((T=x.object)==null?void 0:T.id)===r.id});if(l(y),r.id){console.log("Fetching atom details for ID:",r.id);const x=await w_e(parseInt(r.id),e);console.log("Received atom details:",x),c(x)}}catch(y){console.error("Error fetching sidebar data:",y),m("Failed to fetch data")}finally{p(!1)}})())},[r,e]);const g=y=>`${(y/1e18).toFixed(4)} ETH`;return r?(console.log("Rendering sidebar with triple:",r),ir.jsxs("div",{className:"node-details-sidebar",children:[ir.jsxs("h2",{children:[r.label||"No Label"," Details"]}),d&&ir.jsx("p",{children:"Loading..."}),f&&ir.jsx("p",{children:f}),u&&ir.jsxs(ir.Fragment,{children:[ir.jsx("h4",{children:"Atom Info"}),ir.jsxs("p",{children:[ir.jsx("strong",{children:"ID:"})," ",u.id]}),ir.jsxs("p",{children:[ir.jsx("strong",{children:"Label:"})," ",u.label]}),ir.jsxs("p",{children:[ir.jsx("strong",{children:"Type:"})," ",u.type]}),ir.jsxs("p",{children:[ir.jsx("strong",{children:"Emoji:"})," ",u.emoji||"N/A"]}),ir.jsxs("p",{children:[ir.jsx("strong",{children:"Creator:"})," ",((n=u.creator)==null?void 0:n.label)||"Unknown"]}),ir.jsxs("p",{children:[ir.jsx("strong",{children:"Vault Shares:"})," ",g(((s=u.vault)==null?void 0:s.total_shares)||0)]})]}),o&&o.length>0?ir.jsxs("div",{className:"related-triples",children:[ir.jsx("h4",{children:"Related Data:"}),ir.jsx("ul",{children:o.map(y=>{var x,v,_;return ir.jsxs("li",{children:[ir.jsx("strong",{children:"Subject:"})," ",(x=y.subject)==null?void 0:x.label," |"," ",ir.jsx("strong",{children:"Predicate:"})," ",(v=y.predicate)==null?void 0:v.label," |"," ",ir.jsx("strong",{children:"Object:"})," ",(_=y.object)==null?void 0:_.label]},y.id)})})]}):!d&&ir.jsx("p",{children:"No additional related data found."}),ir.jsx("button",{onClick:i,children:"Close"})]})):(console.log("No triple provided to sidebar"),null)},s9=()=>{const[r,e]=Ei.useState([]),i=200;Ei.useEffect(()=>{let s;const o=()=>{const l=Date.now()/1e3,u=[];for(let c=0;c<3;c++){const d=l*.8+c*2*Math.PI/3;u.push({x:Math.cos(d)*150+200,y:Math.sin(d)*150+200,color:"#00fff2"})}for(let c=0;c<3;c++){const d=-l*1.2+c*2*Math.PI/3;u.push({x:Math.cos(d)*100+200,y:Math.sin(d)*100+200,color:"#ff00ff"})}for(let c=0;c<3;c++){const d=l*1.5+c*2*Math.PI/3;u.push({x:Math.cos(d)*50+200,y:Math.sin(d)*50+200,color:"#ffff00"})}e(u),s=requestAnimationFrame(o)};return o(),()=>cancelAnimationFrame(s)},[]);const n=r.flatMap((s,o)=>r.slice(o+1).map((l,u)=>{const c=l.x-s.x,d=l.y-s.y,p=Math.sqrt(c*c+d*d);if(p<i){const f=1-p/i;return{x1:s.x,y1:s.y,x2:l.x,y2:l.y,opacity:f*.8,gradient:`link-gradient-${o}-${u}`,color1:s.color,color2:l.color}}return null}).filter(Boolean));return ir.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",background:"rgba(0, 0, 0, 0.9)",zIndex:1e3,overflow:"hidden"},children:[ir.jsxs("div",{style:{position:"relative",width:"400px",height:"400px",display:"flex",flexDirection:"column",alignItems:"center"},children:[ir.jsxs("svg",{width:"400",height:"400",children:[ir.jsx("defs",{children:n.map(s=>ir.jsxs("linearGradient",{id:s.gradient,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[ir.jsx("stop",{offset:"0%",stopColor:s.color1,stopOpacity:s.opacity}),ir.jsx("stop",{offset:"100%",stopColor:s.color2,stopOpacity:s.opacity})]},s.gradient))}),n.map((s,o)=>ir.jsx("line",{x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,stroke:`url(#${s.gradient})`,strokeWidth:"3",style:{filter:"brightness(1.5) blur(1px)"}},o))]}),ir.jsx("div",{style:{color:"#00fff2",fontSize:"40px",fontFamily:"sans-serif",letterSpacing:"-2px",textShadow:`
            0 0 5px #00fff2,
            0 0 10px #00fff2,
            0 0 20px #00fff2,
            0 0 40px #00fff2
          `,animation:"textPulse 1.5s ease-in-out infinite",whiteSpace:"nowrap",marginTop:"20px"},children:"Connecting I7n Dots..."})]}),ir.jsx("style",{children:`
          @keyframes textPulse {
            0% { 
              opacity: 0.5;
              transform: scale(0.98) translateY(0);
            }
            50% { 
              opacity: 1;
              transform: scale(1.02) translateY(-5px);
            }
            100% { 
              opacity: 0.5;
              transform: scale(0.98) translateY(0);
            }
          }
        `})]})},R_e=({endpoint:r})=>{const[e,i]=Ei.useState({nodes:[],links:[]}),[n,s]=Ei.useState(null),[o,l]=Ei.useState(!0),[u,c]=Ei.useState("2D"),[d,p]=Ei.useState(null),[f,m]=Ei.useState(!1),[g,y]=Ei.useState(!1),x=Ei.useRef(),[v,_]=Ei.useState([]),[T,w]=Ei.useState(0),S=Ei.useRef(null),[R,B]=Ei.useState(""),[I,D]=Ei.useState(""),[L,O]=Ei.useState(""),[U,J]=Ei.useState(!1),[H,V]=Ei.useState(!1),$=Ei.useCallback((fe,de)=>{const Ie=[],Ge=[];return de.forEach(Xe=>{[Xe.subject,Xe.predicate,Xe.object].forEach($e=>{$e.creator_id&&(Ie.find(lt=>lt.id===`creator-${$e.creator_id}`)||Ie.push({id:`creator-${$e.creator_id}`,label:`${$e.creator_id}`,type:"creator",color:Yp.CREATOR}),Ge.push({source:`creator-${$e.creator_id}`,target:$e.id,label:"created"}))})}),{nodes:[...fe.nodes,...Ie],links:[...fe.links,...Ge]}},[]);Ei.useEffect(()=>{(async()=>{y(!0);try{const fe=await n9(r);let de=TI(fe);f&&(de=$(de,fe)),i(de),s(de)}catch(fe){console.error("Error loading graph data:",fe)}finally{y(!1)}})()},[f,r,$]);const Q=Ei.useCallback(()=>{i(n),p(null),B(""),D(""),O(""),V(!1)},[n]),G=Ei.useCallback(async fe=>{if(console.log("Node clicked:",fe),p(fe),x.current)try{const de={x:fe.x,y:fe.y,z:fe.z||0},Ie=await E_e(fe.id,r),Ge=TI(Ie),Xe=Ge.nodes.find($e=>$e.id===fe.id);Xe&&(Xe.x=de.x,Xe.y=de.y,u==="3D"&&(Xe.z=de.z),Xe.fx=de.x,Xe.fy=de.y,u==="3D"&&(Xe.fz=de.z)),_($e=>{const lt=$e.slice(0,T+1);return lt.push({graphData:e,selectedTriple:fe}),lt}),w($e=>$e+1),i(Ge)}catch(de){console.error("Error fetching triples:",de)}},[u,e,T,r]),j=Ei.useCallback(()=>{o&&x.current&&l(!1)},[o]),ie=Ei.useCallback(()=>{if(T>0){const{graphData:fe,selectedTriple:de}=v[T-1];i(fe),p(de),w(Ie=>Ie-1)}},[T,v]),Y=Ei.useCallback(()=>{if(T<v.length-1){const{graphData:fe,selectedTriple:de}=v[T+1];i(fe),p(de),w(Ie=>Ie+1)}},[T,v]),ae=Ei.useCallback(async()=>{if(H){if(console.log("Applying filters:",{subjectFilter:R,predicateFilter:I,objectFilter:L}),!R&&!I&&!L){Q();return}J(!0);try{const fe={subject:R,predicate:I,object:L};console.log("Sending search request with filters:",fe);const de=await C_e(fe,r);if(console.log("Search results:",de),!de||de.length===0){console.log("No results found"),i({nodes:[],links:[]});return}const Ie=TI(de);if(console.log("Transformed graph data:",Ie),f){const Ge=$(Ie,de);console.log("Enhanced graph data with creators:",Ge),i(Ge)}else i(Ie);_(Ge=>{const Xe=Ge.slice(0,T+1);return Xe.push({graphData:Ie,selectedTriple:null}),Xe}),w(Ge=>Ge+1)}catch(fe){console.error("Error searching triples:",fe)}finally{J(!1),V(!1)}}},[R,I,L,r,f,$,Q,T,H]),xe=Ei.useCallback((fe,de)=>{switch(console.log(`Search input changed - type: ${fe}, value: ${de}`),S.current&&clearTimeout(S.current),fe){case"subject":B(de);break;case"predicate":D(de);break;case"object":O(de);break}S.current=setTimeout(()=>{V(!0)},500)},[]);return Ei.useEffect(()=>{H&&ae()},[H,ae]),ir.jsxs("div",{children:[(g||U)&&ir.jsx(s9,{}),ir.jsx("button",{className:"navigation-button",onClick:Q,style:{position:"absolute",top:"75px",left:"10px",zIndex:50,width:"143px"},children:"Return to initial graph"}),ir.jsx("button",{className:"navigation-button",onClick:ie,style:{position:"absolute",top:"110px",left:"10px",width:"70px",zIndex:50},disabled:T<=0,children:"Previous"}),ir.jsx("button",{className:"navigation-button",onClick:Y,style:{position:"absolute",top:"110px",left:"83px",width:"70px",zIndex:50},disabled:T>=v.length-1,children:"Next"}),ir.jsxs("div",{style:{position:"absolute",top:"10px",right:"10px",zIndex:10,display:"flex",alignItems:"center",gap:"10px",background:"#444",color:"black",padding:"10px",borderRadius:"4px"},children:[ir.jsx("label",{htmlFor:"viewMode",style:{fontSize:"14px"},children:"View Mode:"}),ir.jsxs("select",{id:"viewMode",value:u,onChange:fe=>c(fe.target.value),style:{padding:"5px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"14px"},children:[ir.jsx("option",{value:"2D",children:"2D"}),ir.jsx("option",{value:"3D",children:"3D"}),ir.jsx("option",{value:"VR",children:"VR"})]}),ir.jsxs("label",{style:{fontSize:"14px",marginLeft:"10px"},children:["Show Creators",ir.jsx("input",{type:"checkbox",checked:f,onChange:fe=>m(fe.target.checked),style:{marginLeft:"8px"}})]}),ir.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[ir.jsx("input",{type:"text",value:R,onChange:fe=>xe("subject",fe.target.value),placeholder:"Subject",style:{padding:"5px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"14px",width:"100px"}}),ir.jsx("input",{type:"text",value:I,onChange:fe=>xe("predicate",fe.target.value),placeholder:"Predicate",style:{padding:"5px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"14px",width:"100px"}}),ir.jsx("input",{type:"text",value:L,onChange:fe=>xe("object",fe.target.value),placeholder:"Object",style:{padding:"5px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"14px",width:"100px"}})]})]}),u==="2D"&&ir.jsx(uI,{ref:fe=>x.current=fe,graphData:e,nodeCanvasObject:(fe,de,Ie)=>{const Ge=fe.label||"",Xe=12/Ie;de.font=`${Xe}px Sans-Serif`;const $e=de.measureText(Ge).width,lt=10/Ie,At=5/Ie;de.fillStyle=fe.color+"CC";const Gt=fe.x-$e/2-lt,gt=fe.y-Xe/2-lt,yi=$e+lt*2,Ze=Xe+lt*2,ki=[yi,Ze];de.beginPath(),de.arc(Gt+At,gt+At,At,Math.PI,1.5*Math.PI),de.arc(Gt+yi-At,gt+At,At,1.5*Math.PI,2*Math.PI),de.arc(Gt+yi-At,gt+Ze-At,At,0,.5*Math.PI),de.arc(Gt+At,gt+Ze-At,At,.5*Math.PI,Math.PI),de.closePath(),de.fill(),de.fillStyle="#fff",de.textAlign="center",de.textBaseline="middle",de.fillText(Ge,fe.x,fe.y),fe.__bckgDimensions=ki},nodePointerAreaPaint:(fe,de,Ie)=>{Ie.fillStyle=de;const Ge=fe.__bckgDimensions;Ge&&Ie.fillRect(fe.x-Ge[0]/2,fe.y-Ge[1]/2,...Ge)},linkColor:()=>"#666",linkDirectionalParticles:1,linkDirectionalParticleSpeed:.02,linkDirectionalParticleColor:()=>"#fff",nodeAutoColorBy:"type",onNodeClick:G,onEngineStop:j}),u==="3D"&&ir.jsx(cI,{ref:fe=>x.current=fe,graphData:e,controlType:"fly",nodeLabel:"label",onNodeClick:G,linkColor:()=>"#666",linkDirectionalParticles:2,linkDirectionalParticleSpeed:.005,nodeAutoColorBy:"type",nodeThreeObject:fe=>{const de=new u1e(fe.label||"");return de.borderRadius=1,de.backgroundColor=fe.color+"CC",de.padding=1,de.color="#fff",de.textHeight=2,de},onEngineStop:j}),u==="VR"&&ir.jsx(T_e,{graphData:e,onNodeClick:G,onBack:ie,onForward:Y,selectedTriple:d}),ir.jsx(S_e,{showCreators:f}),d&&ir.jsx(M_e,{triple:d,endpoint:r,onClose:()=>p(null)})]})},I_e=({currentEndpoint:r,onEndpointChange:e})=>ir.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:10,display:"flex",alignItems:"center",gap:"10px",background:"#444",color:"black",padding:"10px",borderRadius:"4px",width:"270px",height:"25px"},children:[ir.jsx("label",{htmlFor:"endpoint",style:{fontSize:"14px"},children:"Endpoint:"}),ir.jsx("select",{id:"endpoint",value:r,onChange:i=>e(i.target.value),style:{padding:"5px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"14px",flex:1},children:Object.entries(qy).map(([i,n])=>ir.jsx("option",{value:i,children:n.displayName},i))})]}),B_e=()=>{const[r,e]=Ei.useState(null),[i,n]=Ei.useState("base"),[s,o]=Ei.useState(!1);return Mt.jsx("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#101020"},children:Mt.jsxs("div",{style:{flex:1,position:"relative"},children:[Mt.jsx("div",{style:{position:"absolute",top:20,left:20,zIndex:1},children:Mt.jsx(I_e,{endpoints:qy,selectedEndpoint:i,onEndpointChange:n})}),Mt.jsx(R_e,{endpoint:i,onNodeSelect:e,onLoadingChange:o}),s&&Mt.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:2},children:Mt.jsx(s9,{})})]})})};var zg=(r=>(r.MAINNET="mainnet",r.TESTNET="testnet",r))(zg||{});const a9={mainnet:"https://prod.base.intuition-api.com/v1/graphql",testnet:"https://dev.base-sepolia.intuition-api.com/v1/graphql"},N_e=`
  query GetTriplesByCreator($creatorId: String!, $predicateId: numeric!, $objectId: numeric!) {
    triples(where: {
      subject: { creator_id: { _eq: $creatorId } },
      predicate_id: { _eq: $predicateId },
      object_id: { _eq: $objectId }
    }) {
      id
      subject_id
      predicate_id
      object_id
      subject {
        id
        label
        type
        creator_id
      }
      predicate {
        id
        label
        type
      }
      object {
        id
        label
        type
      }
      block_number
      block_timestamp
      transaction_hash
    }
  }
`,L_e=async(r,e=24442,i=24441,n=zg.MAINNET)=>{var l;const s=a9[n],o={creatorId:r,predicateId:e,objectId:i};console.log(`[fetchTriplesByCreator] Requte directe vers ${s} avec variables:`,o);try{const c=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:N_e,variables:o})})).json();if(console.log("[fetchTriplesByCreator] Rponse brute:",c),c.errors)throw new Error(((l=c.errors[0])==null?void 0:l.message)||"Erreur GraphQL inconnue");return c.data}catch(u){throw console.error(`[fetchTriplesByCreator] Erreur lors de la requte directe vers ${s}:`,u),u}},D_e=(r,e=24442,i=24441,n=zg.MAINNET)=>{const[s,o]=Ei.useState(null),[l,u]=Ei.useState(!0),[c,d]=Ei.useState(null);Ei.useEffect(()=>{(async()=>{if(!r){u(!1);return}console.log(`[useTripleByCreator] Dmarrage de la requte pour creatorId=${r}, predicateId=${e}, objectId=${i} sur le rseau ${n}`);try{const m=await L_e(r,e,i,n);o(m)}catch(m){console.error(`[${n}] Erreur lors de la rcupration des triples:`,m),d(m instanceof Error?m:new Error(String(m)))}finally{u(!1)}})()},[r,e,i,n]);const p=(s==null?void 0:s.triples)||[];return{loading:l,error:c,triples:p,network:n,rawData:s}},O_e=({walletConnected:r=!1,walletAddress:e="",onCreatePlayer:i})=>{var m;const[n,s]=Ei.useState(zg.TESTNET),o=e?e.toLowerCase():"",{loading:l,error:u,triples:c}=D_e(o,24442,24441,n);if(!r||!e)return Mt.jsxs("div",{className:"player-map-container",style:{margin:"20px",padding:"30px",borderRadius:"8px",backgroundColor:"#1a1a2e",color:"#fff",textAlign:"center"},children:[Mt.jsx("h2",{style:{color:"#6c5ce7",marginBottom:"20px"},children:"Player Map"}),Mt.jsxs("div",{style:{padding:"30px",backgroundColor:"#151525",borderRadius:"6px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[Mt.jsx("p",{style:{fontSize:"18px",marginBottom:"20px"},children:"Connectez votre portefeuille pour accder  la Player Map"}),Mt.jsx("button",{style:{padding:"12px 24px",backgroundColor:"#6c5ce7",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px"},disabled:!0,children:"Connecter Wallet"})]})]});const d=c.length>0,p=l,f=u;return p?Mt.jsxs("div",{className:"player-map-container",style:{margin:"20px",padding:"30px",borderRadius:"8px",backgroundColor:"#1a1a2e",color:"#fff"},children:[Mt.jsx("h2",{style:{color:"#6c5ce7",marginBottom:"20px"},children:"Player Map"}),Mt.jsx("div",{style:{padding:"20px",backgroundColor:"#151525",borderRadius:"6px",textAlign:"center"},children:Mt.jsx("p",{children:"Chargement des donnes joueur..."})})]}):f?Mt.jsxs("div",{className:"player-map-container",style:{margin:"20px",padding:"30px",borderRadius:"8px",backgroundColor:"#1a1a2e",color:"#fff"},children:[Mt.jsx("h2",{style:{color:"#6c5ce7",marginBottom:"20px"},children:"Player Map"}),Mt.jsxs("div",{style:{padding:"20px",backgroundColor:"#151525",borderRadius:"6px",color:"#ff6b6b"},children:[Mt.jsx("h3",{children:"Erreur lors du chargement des donnes"}),Mt.jsx("p",{children:(u==null?void 0:u.message)||"Erreur inconnue"})]})]}):Mt.jsxs("div",{className:"player-map-container",style:{margin:"20px",padding:"30px",borderRadius:"8px",backgroundColor:"#1a1a2e",color:"#fff"},children:[Mt.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[Mt.jsx("h2",{style:{color:"#6c5ce7",margin:0},children:"Player Map"}),Mt.jsxs("select",{value:n,onChange:g=>s(g.target.value),style:{padding:"5px 10px",backgroundColor:"#151525",color:"#fff",border:"1px solid #333",borderRadius:"4px"},children:[Mt.jsx("option",{value:zg.MAINNET,children:"Mainnet"}),Mt.jsx("option",{value:zg.TESTNET,children:"Testnet"})]})]}),Mt.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9em",color:"#aaa"},children:["Wallet connect:"," ",Mt.jsx("span",{style:{color:"#fff"},children:o})]}),Mt.jsxs("div",{style:{padding:"20px",backgroundColor:"#151525",borderRadius:"6px",marginBottom:"15px"},children:[Mt.jsx("h3",{style:{borderBottom:"1px solid #333",paddingBottom:"10px",marginTop:0},children:"Vrification du Joueur"}),d?Mt.jsxs("div",{children:[Mt.jsx("p",{style:{color:"#4CAF50"},children:" Joueur dtect"}),Mt.jsxs("p",{children:["Triple joueur trouv:"," ",Mt.jsx("span",{style:{color:"#6c5ce7"},children:(m=c[0])==null?void 0:m.id})]}),c.length>0&&Mt.jsxs("div",{children:[Mt.jsxs("p",{children:["Sujet: ",c[0].subject.label," (ID:"," ",c[0].subject_id,")"]}),Mt.jsxs("p",{children:["Prdicat: ",c[0].predicate.label," (ID:"," ",c[0].predicate_id,")"]}),Mt.jsxs("p",{children:["Objet: ",c[0].object.label," (ID:"," ",c[0].object_id,")"]})]})]}):Mt.jsxs("div",{children:[Mt.jsx("p",{style:{color:"#ff6b6b"},children:" Aucun joueur dtect pour ce jeu"}),Mt.jsx("button",{onClick:i,style:{padding:"10px 20px",backgroundColor:"#FFD32A",color:"#000",border:"none",borderRadius:"4px",cursor:"pointer",marginTop:"10px",fontWeight:"bold"},children:"CRER VOTRE JOUEUR"})]})]}),Mt.jsxs("div",{style:{padding:"20px",backgroundColor:"#151525",borderRadius:"6px",opacity:d?1:.5,textAlign:"center"},children:[Mt.jsx("h3",{style:{borderBottom:"1px solid #333",paddingBottom:"10px",marginTop:0},children:"Accs  la Player Map"}),d?Mt.jsxs("div",{children:[Mt.jsx("p",{style:{color:"#4CAF50",marginBottom:"20px"},children:" Toutes les conditions sont remplies"}),Mt.jsx("button",{style:{padding:"12px 24px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px"},children:"Voir la Player Map"})]}):Mt.jsx("p",{children:"Crez votre joueur pour accder  la Player Map"})]}),Mt.jsxs("div",{style:{marginTop:"20px",fontSize:"0.8em",color:"#666",textAlign:"center"},children:["Utilisation de l'API ",n,": ",a9[n]]})]})},Z_={IS_PLAYER:{predicateId:24442n,objectId:24441n},HAS_LEVEL:{predicateId:377n,objectId:24403n}},P_e=({walletConnected:r,walletAddress:e,publicClient:i})=>{const n=async(l,u,c)=>{if(!r||!e)throw new Error("Wallet not connected");try{return await(i||r).readContract({address:Vl,abi:eu,functionName:"isTriple",args:[l,u,c]})}catch(d){if(console.error("Error checking if triple exists:",d),i&&i!==r)try{return await i.readContract({address:Vl,abi:eu,functionName:"isTriple",args:[l,u,c]})}catch(p){console.error("Second attempt failed when checking if triple exists:",p)}return!1}},s=async l=>{if(!r||!e)throw new Error("Wallet not connected");try{const u=l.map(m=>m.subjectId),c=l.map(m=>m.predicateId),d=l.map(m=>m.objectId);console.log("Creating batch triples...",{address:Vl,count:l.length,subjectIds:u.map(m=>m.toString()),predicateIds:c.map(m=>m.toString()),objectIds:d.map(m=>m.toString()),value:kN*BigInt(l.length)});const p=await r.writeContract({address:Vl,abi:eu,functionName:"batchCreateTriple",args:[u,c,d],value:kN*BigInt(l.length)});console.log("Transaction hash:",p);let f;return r.waitForTransactionReceipt?f=await r.waitForTransactionReceipt({hash:p}):p.wait?f=await p.wait():(console.log("No wait method available, waiting 3 seconds..."),await new Promise(m=>setTimeout(m,3e3))),console.log("Batch triple creation successful:",f),{hash:typeof p=="string"?p:p.hash,receipt:f}}catch(u){throw console.error("Error batch creating triples:",u),u}};return{checkTripleExists:n,batchCreateTriple:s,createPlayerTriples:async l=>{console.log(`Creating player triples for atom ID: ${l}`);const u=[{subjectId:l,predicateId:Z_.IS_PLAYER.predicateId,objectId:Z_.IS_PLAYER.objectId},{subjectId:l,predicateId:Z_.HAS_LEVEL.predicateId,objectId:Z_.HAS_LEVEL.objectId}];return console.log("Cration de 2 triples pour le joueur:",u.map(c=>`${c.subjectId.toString()} => ${c.predicateId.toString()} => ${c.objectId.toString()}`)),s(u)}}},F_e=(r,e,i)=>{const{createAtom:n}=HL({walletConnected:r,walletAddress:e,publicClient:i}),{createPlayerTriples:s}=P_e({walletConnected:r,walletAddress:e,publicClient:i});return{createPlayer:async l=>{try{console.log("tape 1: Cration de l'atome joueur...",l);const u=await n({name:l.pseudo,description:l.userId,image:l.image}),c=u.atomId;console.log(`Atome joueur cr avec succs! ID: ${c}, Hash IPFS: ${u.ipfsHash}`),console.log("Pause de 2 secondes avant de crer les triples..."),await new Promise(d=>setTimeout(d,2e3)),console.log(`tape 2: Cration des triples pour le joueur (atomId: ${c})...`);try{const d=await s(c);return console.log("Triples crs avec succs:",d),{atomId:c,ipfsHash:u.ipfsHash,tripleCreated:!0,transactionHash:d.hash}}catch(d){return console.error("Erreur lors de la cration des triples:",d),{atomId:c,ipfsHash:u.ipfsHash,tripleCreated:!1,transactionHash:void 0}}}catch(u){throw console.error("Erreur lors de la cration du joueur:",u),u}}}},k_e=({src:r})=>{const[e,i]=Ei.useState(null);return Ei.useEffect(()=>{(async()=>{if(qv(r)){const s=await e2(r);i(s)}else i(r)})()},[r]),e?Mt.jsx("img",{src:e,alt:"preview",style:{width:"100%",maxHeight:"150px",objectFit:"contain"}}):Mt.jsx("div",{children:"Loading image..."})},U_e=({isOpen:r,onClose:e,walletConnected:i,walletAddress:n,wagmiConfig:s,publicClient:o,walletHooks:l})=>{const[u,c]=Ei.useState({pseudo:"",userId:"",image:""}),[d,p]=Ei.useState(!1),[f,m]=Ei.useState(!1),[g,y]=Ei.useState(!1),[x,v]=Ei.useState(!1),[_,T]=Ei.useState(!1),[w,S]=Ei.useState(null),[R,B]=Ei.useState(!1),[I,D]=Ei.useState(!1),[L,O]=Ei.useState(1),U=Ei.useRef(null),J=o||(l==null?void 0:l.usePublicClient)&&l.usePublicClient(),{createPlayer:H}=F_e(i,n||"",J);Ei.useEffect(()=>{(async()=>{if(!(!n||!i))try{const ie=await(J||i).readContract({address:Vl,abi:eu,functionName:"balanceOf",args:[n]});p(ie>0)}catch(j){console.error("Error checking atom balance:",j)}})()},[n,i,J]);const V=G=>{const{name:j,value:ie}=G.target;c(Y=>({...Y,[j]:ie}))},$=async G=>{if(!G.target.files||G.target.files.length===0)return;const j=G.target.files[0];try{D(!0);const ie=await GL(j);c(Y=>({...Y,image:ie})),D(!1)}catch(ie){console.error("Erreur lors du tlversement de l'image:",ie),alert("Erreur lors du tlversement de l'image. Veuillez ressayer."),D(!1)}},Q=async()=>{if(!n||!i){alert("Veuillez connecter votre portefeuille d'abord");return}if(d){alert("Vous avez dj un atome !");return}if(!u.pseudo||!u.userId){alert("Veuillez remplir tous les champs obligatoires");return}try{m(!0),y(!0),O(1),console.log("Dmarrage de la cration du joueur...");const G=await H(u);S(G.atomId.toString()),y(!1),v(!0),O(2),G.tripleCreated?(B(!0),T(!0),v(!1),m(!1),O(3),setTimeout(()=>{e()},3e3)):(B(!1),v(!1),m(!1),O(3),alert("Votre identit a t cre, mais la cration des triples associs a chou. Vous pourrez ressayer plus tard."))}catch(G){console.error("Erreur lors de la cration du joueur:",G),alert(g?"Erreur lors de la cration de l'atome. Veuillez ressayer.":x?"Erreur lors de la cration des triples. Votre identit a t cre, mais les triples ont chou.":"Erreur lors de la cration du joueur. Veuillez ressayer."),y(!1),v(!1),m(!1)}};return r?Mt.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:Mt.jsxs("div",{style:{backgroundColor:"#101020",color:"#fff",padding:"30px",borderRadius:"10px",maxWidth:"760px",width:"90%",position:"relative",border:"1px solid #FFD32A"},children:[Mt.jsxs("div",{style:{position:"absolute",top:"40px",right:"10px",fontSize:"10px",color:"#666",textAlign:"left",backgroundColor:"rgba(0,0,0,0.3)",padding:"5px",borderRadius:"3px",maxWidth:"200px",overflow:"hidden"},children:[Mt.jsxs("div",{children:["Wallet:"," ",n?n.slice(0,6)+"..."+n.slice(-4):"Non connect"]}),Mt.jsxs("div",{children:["Connected: ",String(!!i)]}),Mt.jsxs("div",{children:["Has Atom: ",String(d)]}),Mt.jsxs("div",{children:["Step: ",L]})]}),Mt.jsx("button",{onClick:e,style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"transparent",border:"none",color:"#fff",fontSize:"20px",cursor:"pointer"},children:""}),Mt.jsxs("div",{style:{textAlign:"center",marginBottom:"20px"},children:[Mt.jsx("img",{src:Pw,alt:"Intuition Logo",style:{width:"120px",marginBottom:"10px"}}),Mt.jsx("h3",{style:{color:"#FFD32A",fontSize:"1em",margin:"10px 0"},children:"CRER VOTRE JOUEUR"}),Mt.jsxs("p",{style:{fontSize:"0.8em",color:"#aaa"},children:["Rseau: Base Sepolia (Chain ID: ",PN,")"]})]}),Mt.jsxs("div",{style:{marginBottom:"20px"},children:[Mt.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[Mt.jsxs("div",{style:{textAlign:"center",flex:1},children:[Mt.jsx("div",{style:{width:"30px",height:"30px",borderRadius:"15px",backgroundColor:g||L>1?"#FFD32A":"#2e2e40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",color:g||L>1?"#000":"#fff"},children:L>1?"":"1"}),Mt.jsx("p",{style:{fontSize:"0.8em",marginTop:"5px"},children:"Cration Atom"})]}),Mt.jsxs("div",{style:{textAlign:"center",flex:1},children:[Mt.jsx("div",{style:{width:"30px",height:"30px",borderRadius:"15px",backgroundColor:x||L>2?"#FFD32A":"#2e2e40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",color:x||L>2?"#000":"#fff"},children:L>2?"":"2"}),Mt.jsx("p",{style:{fontSize:"0.8em",marginTop:"5px"},children:"Cration Triples"})]}),Mt.jsxs("div",{style:{textAlign:"center",flex:1},children:[Mt.jsx("div",{style:{width:"30px",height:"30px",borderRadius:"15px",backgroundColor:L===3?"#4CAF50":"#2e2e40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",color:L===3?"#000":"#fff"},children:L===3?"":"3"}),Mt.jsx("p",{style:{fontSize:"0.8em",marginTop:"5px"},children:"Succs"})]})]}),Mt.jsx("div",{style:{height:"4px",backgroundColor:"#2e2e40",position:"relative",marginBottom:"20px"},children:Mt.jsx("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:`${(L-1)*50}%`,backgroundColor:"#FFD32A",transition:"width 0.3s ease"}})})]}),_?Mt.jsxs("div",{style:{textAlign:"center",color:"#4CAF50"},children:[Mt.jsx("h3",{style:{color:"#4CAF50",marginBottom:"10px"},children:"Succs!"}),Mt.jsx("p",{children:"Votre joueur a t cr avec succs."}),Mt.jsxs("p",{children:["Atom ID: ",w]}),Mt.jsxs("p",{children:["Triples crs: ",R?"Oui":"Non"]}),Mt.jsx("p",{children:"Cette fentre se fermera automatiquement..."})]}):n?d?Mt.jsx("p",{style:{textAlign:"center",color:"#ff4444"},children:"Vous avez dj un atome associ  ce portefeuille"}):Mt.jsxs(Mt.Fragment,{children:[Mt.jsxs("div",{style:{marginBottom:"15px"},children:[Mt.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Pseudo"}),Mt.jsx("input",{type:"text",name:"pseudo",value:u.pseudo,onChange:V,placeholder:"Entrez votre pseudo",style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"}})]}),Mt.jsxs("div",{style:{marginBottom:"15px"},children:[Mt.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"User ID"}),Mt.jsx("input",{type:"text",name:"userId",value:u.userId,onChange:V,placeholder:"Entrez votre ID BossFighters",style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"}})]}),Mt.jsxs("div",{style:{marginBottom:"15px"},children:[Mt.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Photo de profil (optionnel)"}),Mt.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[Mt.jsxs("div",{children:[Mt.jsx("button",{onClick:()=>{var G;return(G=U.current)==null?void 0:G.click()},style:{padding:"8px 15px",backgroundColor:"#2e2e40",color:"#fff",border:"1px solid #333",borderRadius:"4px",cursor:"pointer",marginRight:"10px"},disabled:I,children:I?"Upload en cours...":"Choisir une image"}),Mt.jsx("input",{ref:U,type:"file",accept:"image/*",onChange:$,style:{display:"none"}})]}),Mt.jsx("p",{style:{fontSize:"0.8em",color:"#aaa",marginTop:"0px"},children:"Cette image sera utilise comme photo de profil de votre joueur."}),u.image&&Mt.jsxs("div",{style:{marginTop:"10px"},children:[Mt.jsx("p",{style:{fontSize:"0.8em",color:"#aaa",marginBottom:"5px"},children:"Aperu de l'image:"}),Mt.jsx(k_e,{src:u.image})]})]})]}),Mt.jsx("div",{style:{textAlign:"center"},children:Mt.jsx("button",{onClick:Q,disabled:f||I,style:{padding:"8px 20px",backgroundColor:"#FFD32A",color:"#000",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",opacity:f||I?.7:1},children:f?g?"Cration de l'atome...":x?"Cration des triples...":"Cration en cours...":"CRER VOTRE JOUEUR"})})]}):Mt.jsx("div",{children:Mt.jsx("p",{style:{textAlign:"center",color:"#ff4444"},children:"Veuillez connecter votre portefeuille d'abord"})})]})}):null},z_e={init:r=>{if(!r.apiUrl)throw new Error("L'URL de l'API est obligatoire pour initialiser Player-map");return _W(r),!0},get:Qv},j_e={setAuthToken:VL,getAuthToken:Zw,isAuthenticated:Hv,clearAuthToken:bW,initialize:r=>r?(VL(r),!0):!1};Ro.GraphComponent=O_e,Ro.PlayerCreationForm=U_e,Ro.PlayerMapConfig=z_e,Ro.PlayerMapGraph=B_e,Ro.PlayerMapHome=QL,Ro.RegistrationForm=WL,Ro.auth=j_e,Ro.default=QL,Object.defineProperties(Ro,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
